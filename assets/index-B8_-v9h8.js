var Nl=Object.defineProperty;var _a=xt=>{throw TypeError(xt)};var Ul=(xt,e,At)=>e in xt?Nl(xt,e,{enumerable:!0,configurable:!0,writable:!0,value:At}):xt[e]=At;var Ll=(xt,e)=>()=>(e||xt((e={exports:{}}).exports,e),e.exports);var wn=(xt,e,At)=>Ul(xt,typeof e!="symbol"?e+"":e,At),Ws=(xt,e,At)=>e.has(xt)||_a("Cannot "+At);var ln=(xt,e,At)=>(Ws(xt,e,"read from private field"),At?At.call(xt):e.get(xt)),no=(xt,e,At)=>e.has(xt)?_a("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(xt):e.set(xt,At),Gn=(xt,e,At,kt)=>(Ws(xt,e,"write to private field"),kt?kt.call(xt,At):e.set(xt,At),At),jn=(xt,e,At)=>(Ws(xt,e,"access private method"),At);var Fs=(xt,e,At,kt)=>({set _(Bt){Gn(xt,e,Bt,At)},get _(){return ln(xt,e,kt)}});var Fl=Ll(exports=>{function _mergeNamespaces(xt,e){for(var At=0;At<e.length;At++){const kt=e[At];if(typeof kt!="string"&&!Array.isArray(kt)){for(const Bt in kt)if(Bt!=="default"&&!(Bt in xt)){const Nt=Object.getOwnPropertyDescriptor(kt,Bt);Nt&&Object.defineProperty(xt,Bt,Nt.get?Nt:{enumerable:!0,get:()=>kt[Bt]})}}}return Object.freeze(Object.defineProperty(xt,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const Bt of document.querySelectorAll('link[rel="modulepreload"]'))kt(Bt);new MutationObserver(Bt=>{for(const Nt of Bt)if(Nt.type==="childList")for(const jt of Nt.addedNodes)jt.tagName==="LINK"&&jt.rel==="modulepreload"&&kt(jt)}).observe(document,{childList:!0,subtree:!0});function At(Bt){const Nt={};return Bt.integrity&&(Nt.integrity=Bt.integrity),Bt.referrerPolicy&&(Nt.referrerPolicy=Bt.referrerPolicy),Bt.crossOrigin==="use-credentials"?Nt.credentials="include":Bt.crossOrigin==="anonymous"?Nt.credentials="omit":Nt.credentials="same-origin",Nt}function kt(Bt){if(Bt.ep)return;Bt.ep=!0;const Nt=At(Bt);fetch(Bt.href,Nt)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function getDefaultExportFromCjs(xt){return xt&&xt.__esModule&&Object.prototype.hasOwnProperty.call(xt,"default")?xt.default:xt}function getAugmentedNamespace(xt){if(xt.__esModule)return xt;var e=xt.default;if(typeof e=="function"){var At=function kt(){return this instanceof kt?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};At.prototype=e.prototype}else At={};return Object.defineProperty(At,"__esModule",{value:!0}),Object.keys(xt).forEach(function(kt){var Bt=Object.getOwnPropertyDescriptor(xt,kt);Object.defineProperty(At,kt,Bt.get?Bt:{enumerable:!0,get:function(){return xt[kt]}})}),At}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$2=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$2=Symbol.for("react.strict_mode"),r$4=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$3=Symbol.for("react.forward_ref"),w$2=Symbol.for("react.suspense"),x$1=Symbol.for("react.memo"),y$2=Symbol.for("react.lazy"),z$2=Symbol.iterator;function A$2(xt){return xt===null||typeof xt!="object"?null:(xt=z$2&&xt[z$2]||xt["@@iterator"],typeof xt=="function"?xt:null)}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$3={};function E$5(xt,e,At){this.props=xt,this.context=e,this.refs=D$3,this.updater=At||B$2}E$5.prototype.isReactComponent={};E$5.prototype.setState=function(xt,e){if(typeof xt!="object"&&typeof xt!="function"&&xt!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xt,e,"setState")};E$5.prototype.forceUpdate=function(xt){this.updater.enqueueForceUpdate(this,xt,"forceUpdate")};function F$1(){}F$1.prototype=E$5.prototype;function G$5(xt,e,At){this.props=xt,this.context=e,this.refs=D$3,this.updater=At||B$2}var H$2=G$5.prototype=new F$1;H$2.constructor=G$5;C$2(H$2,E$5.prototype);H$2.isPureReactComponent=!0;var I$4=Array.isArray,J$1=Object.prototype.hasOwnProperty,K$7={current:null},L$3={key:!0,ref:!0,__self:!0,__source:!0};function M$2(xt,e,At){var kt,Bt={},Nt=null,jt=null;if(e!=null)for(kt in e.ref!==void 0&&(jt=e.ref),e.key!==void 0&&(Nt=""+e.key),e)J$1.call(e,kt)&&!L$3.hasOwnProperty(kt)&&(Bt[kt]=e[kt]);var Lt=arguments.length-2;if(Lt===1)Bt.children=At;else if(1<Lt){for(var er=Array(Lt),tr=0;tr<Lt;tr++)er[tr]=arguments[tr+2];Bt.children=er}if(xt&&xt.defaultProps)for(kt in Lt=xt.defaultProps,Lt)Bt[kt]===void 0&&(Bt[kt]=Lt[kt]);return{$$typeof:l$2,type:xt,key:Nt,ref:jt,props:Bt,_owner:K$7.current}}function N$4(xt,e){return{$$typeof:l$2,type:xt.type,key:e,ref:xt.ref,props:xt.props,_owner:xt._owner}}function O$2(xt){return typeof xt=="object"&&xt!==null&&xt.$$typeof===l$2}function escape(xt){var e={"=":"=0",":":"=2"};return"$"+xt.replace(/[=:]/g,function(At){return e[At]})}var P$5=/\/+/g;function Q$2(xt,e){return typeof xt=="object"&&xt!==null&&xt.key!=null?escape(""+xt.key):e.toString(36)}function R$3(xt,e,At,kt,Bt){var Nt=typeof xt;(Nt==="undefined"||Nt==="boolean")&&(xt=null);var jt=!1;if(xt===null)jt=!0;else switch(Nt){case"string":case"number":jt=!0;break;case"object":switch(xt.$$typeof){case l$2:case n$2:jt=!0}}if(jt)return jt=xt,Bt=Bt(jt),xt=kt===""?"."+Q$2(jt,0):kt,I$4(Bt)?(At="",xt!=null&&(At=xt.replace(P$5,"$&/")+"/"),R$3(Bt,e,At,"",function(tr){return tr})):Bt!=null&&(O$2(Bt)&&(Bt=N$4(Bt,At+(!Bt.key||jt&&jt.key===Bt.key?"":(""+Bt.key).replace(P$5,"$&/")+"/")+xt)),e.push(Bt)),1;if(jt=0,kt=kt===""?".":kt+":",I$4(xt))for(var Lt=0;Lt<xt.length;Lt++){Nt=xt[Lt];var er=kt+Q$2(Nt,Lt);jt+=R$3(Nt,e,At,er,Bt)}else if(er=A$2(xt),typeof er=="function")for(xt=er.call(xt),Lt=0;!(Nt=xt.next()).done;)Nt=Nt.value,er=kt+Q$2(Nt,Lt++),jt+=R$3(Nt,e,At,er,Bt);else if(Nt==="object")throw e=String(xt),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(xt).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return jt}function S$2(xt,e,At){if(xt==null)return xt;var kt=[],Bt=0;return R$3(xt,kt,"","",function(Nt){return e.call(At,Nt,Bt++)}),kt}function T$2(xt){if(xt._status===-1){var e=xt._result;e=e(),e.then(function(At){(xt._status===0||xt._status===-1)&&(xt._status=1,xt._result=At)},function(At){(xt._status===0||xt._status===-1)&&(xt._status=2,xt._result=At)}),xt._status===-1&&(xt._status=0,xt._result=e)}if(xt._status===1)return xt._result.default;throw xt._result}var U$3={current:null},V$2={transition:null},W$a={ReactCurrentDispatcher:U$3,ReactCurrentBatchConfig:V$2,ReactCurrentOwner:K$7};function X$3(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$2,forEach:function(xt,e,At){S$2(xt,function(){e.apply(this,arguments)},At)},count:function(xt){var e=0;return S$2(xt,function(){e++}),e},toArray:function(xt){return S$2(xt,function(e){return e})||[]},only:function(xt){if(!O$2(xt))throw Error("React.Children.only expected to receive a single React element child.");return xt}};react_production_min.Component=E$5;react_production_min.Fragment=p$3;react_production_min.Profiler=r$4;react_production_min.PureComponent=G$5;react_production_min.StrictMode=q$2;react_production_min.Suspense=w$2;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$a;react_production_min.act=X$3;react_production_min.cloneElement=function(xt,e,At){if(xt==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+xt+".");var kt=C$2({},xt.props),Bt=xt.key,Nt=xt.ref,jt=xt._owner;if(e!=null){if(e.ref!==void 0&&(Nt=e.ref,jt=K$7.current),e.key!==void 0&&(Bt=""+e.key),xt.type&&xt.type.defaultProps)var Lt=xt.type.defaultProps;for(er in e)J$1.call(e,er)&&!L$3.hasOwnProperty(er)&&(kt[er]=e[er]===void 0&&Lt!==void 0?Lt[er]:e[er])}var er=arguments.length-2;if(er===1)kt.children=At;else if(1<er){Lt=Array(er);for(var tr=0;tr<er;tr++)Lt[tr]=arguments[tr+2];kt.children=Lt}return{$$typeof:l$2,type:xt.type,key:Bt,ref:Nt,props:kt,_owner:jt}};react_production_min.createContext=function(xt){return xt={$$typeof:u$1,_currentValue:xt,_currentValue2:xt,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},xt.Provider={$$typeof:t$1,_context:xt},xt.Consumer=xt};react_production_min.createElement=M$2;react_production_min.createFactory=function(xt){var e=M$2.bind(null,xt);return e.type=xt,e};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(xt){return{$$typeof:v$3,render:xt}};react_production_min.isValidElement=O$2;react_production_min.lazy=function(xt){return{$$typeof:y$2,_payload:{_status:-1,_result:xt},_init:T$2}};react_production_min.memo=function(xt,e){return{$$typeof:x$1,type:xt,compare:e===void 0?null:e}};react_production_min.startTransition=function(xt){var e=V$2.transition;V$2.transition={};try{xt()}finally{V$2.transition=e}};react_production_min.unstable_act=X$3;react_production_min.useCallback=function(xt,e){return U$3.current.useCallback(xt,e)};react_production_min.useContext=function(xt){return U$3.current.useContext(xt)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(xt){return U$3.current.useDeferredValue(xt)};react_production_min.useEffect=function(xt,e){return U$3.current.useEffect(xt,e)};react_production_min.useId=function(){return U$3.current.useId()};react_production_min.useImperativeHandle=function(xt,e,At){return U$3.current.useImperativeHandle(xt,e,At)};react_production_min.useInsertionEffect=function(xt,e){return U$3.current.useInsertionEffect(xt,e)};react_production_min.useLayoutEffect=function(xt,e){return U$3.current.useLayoutEffect(xt,e)};react_production_min.useMemo=function(xt,e){return U$3.current.useMemo(xt,e)};react_production_min.useReducer=function(xt,e,At){return U$3.current.useReducer(xt,e,At)};react_production_min.useRef=function(xt){return U$3.current.useRef(xt)};react_production_min.useState=function(xt){return U$3.current.useState(xt)};react_production_min.useSyncExternalStore=function(xt,e,At){return U$3.current.useSyncExternalStore(xt,e,At)};react_production_min.useTransition=function(){return U$3.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$3=reactExports,k$1=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$3=Object.prototype.hasOwnProperty,n$1=f$3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q$1(xt,e,At){var kt,Bt={},Nt=null,jt=null;At!==void 0&&(Nt=""+At),e.key!==void 0&&(Nt=""+e.key),e.ref!==void 0&&(jt=e.ref);for(kt in e)m$3.call(e,kt)&&!p$2.hasOwnProperty(kt)&&(Bt[kt]=e[kt]);if(xt&&xt.defaultProps)for(kt in e=xt.defaultProps,e)Bt[kt]===void 0&&(Bt[kt]=e[kt]);return{$$typeof:k$1,type:xt,key:Nt,ref:jt,props:Bt,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$1;reactJsxRuntime_production_min.jsx=q$1;reactJsxRuntime_production_min.jsxs=q$1;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(xt){function e(Ir,$r){var vr=Ir.length;Ir.push($r);e:for(;0<vr;){var Er=vr-1>>>1,Tr=Ir[Er];if(0<Bt(Tr,$r))Ir[Er]=$r,Ir[vr]=Tr,vr=Er;else break e}}function At(Ir){return Ir.length===0?null:Ir[0]}function kt(Ir){if(Ir.length===0)return null;var $r=Ir[0],vr=Ir.pop();if(vr!==$r){Ir[0]=vr;e:for(var Er=0,Tr=Ir.length,Rr=Tr>>>1;Er<Rr;){var Mr=2*(Er+1)-1,Gr=Ir[Mr],Br=Mr+1,Cr=Ir[Br];if(0>Bt(Gr,vr))Br<Tr&&0>Bt(Cr,Gr)?(Ir[Er]=Cr,Ir[Br]=vr,Er=Br):(Ir[Er]=Gr,Ir[Mr]=vr,Er=Mr);else if(Br<Tr&&0>Bt(Cr,vr))Ir[Er]=Cr,Ir[Br]=vr,Er=Br;else break e}}return $r}function Bt(Ir,$r){var vr=Ir.sortIndex-$r.sortIndex;return vr!==0?vr:Ir.id-$r.id}if(typeof performance=="object"&&typeof performance.now=="function"){var Nt=performance;xt.unstable_now=function(){return Nt.now()}}else{var jt=Date,Lt=jt.now();xt.unstable_now=function(){return jt.now()-Lt}}var er=[],tr=[],zt=1,rr=null,nr=3,ir=!1,ar=!1,dr=!1,ur=typeof setTimeout=="function"?setTimeout:null,fr=typeof clearTimeout=="function"?clearTimeout:null,pr=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function lr(Ir){for(var $r=At(tr);$r!==null;){if($r.callback===null)kt(tr);else if($r.startTime<=Ir)kt(tr),$r.sortIndex=$r.expirationTime,e(er,$r);else break;$r=At(tr)}}function yr(Ir){if(dr=!1,lr(Ir),!ar)if(At(er)!==null)ar=!0,Dr(br);else{var $r=At(tr);$r!==null&&xr(yr,$r.startTime-Ir)}}function br(Ir,$r){ar=!1,dr&&(dr=!1,fr(kr),kr=-1),ir=!0;var vr=nr;try{for(lr($r),rr=At(er);rr!==null&&(!(rr.expirationTime>$r)||Ir&&!Lr());){var Er=rr.callback;if(typeof Er=="function"){rr.callback=null,nr=rr.priorityLevel;var Tr=Er(rr.expirationTime<=$r);$r=xt.unstable_now(),typeof Tr=="function"?rr.callback=Tr:rr===At(er)&&kt(er),lr($r)}else kt(er);rr=At(er)}if(rr!==null)var Rr=!0;else{var Mr=At(tr);Mr!==null&&xr(yr,Mr.startTime-$r),Rr=!1}return Rr}finally{rr=null,nr=vr,ir=!1}}var Ar=!1,Pr=null,kr=-1,Ur=5,Hr=-1;function Lr(){return!(xt.unstable_now()-Hr<Ur)}function Sr(){if(Pr!==null){var Ir=xt.unstable_now();Hr=Ir;var $r=!0;try{$r=Pr(!0,Ir)}finally{$r?_r():(Ar=!1,Pr=null)}}else Ar=!1}var _r;if(typeof pr=="function")_r=function(){pr(Sr)};else if(typeof MessageChannel<"u"){var gr=new MessageChannel,wr=gr.port2;gr.port1.onmessage=Sr,_r=function(){wr.postMessage(null)}}else _r=function(){ur(Sr,0)};function Dr(Ir){Pr=Ir,Ar||(Ar=!0,_r())}function xr(Ir,$r){kr=ur(function(){Ir(xt.unstable_now())},$r)}xt.unstable_IdlePriority=5,xt.unstable_ImmediatePriority=1,xt.unstable_LowPriority=4,xt.unstable_NormalPriority=3,xt.unstable_Profiling=null,xt.unstable_UserBlockingPriority=2,xt.unstable_cancelCallback=function(Ir){Ir.callback=null},xt.unstable_continueExecution=function(){ar||ir||(ar=!0,Dr(br))},xt.unstable_forceFrameRate=function(Ir){0>Ir||125<Ir?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ur=0<Ir?Math.floor(1e3/Ir):5},xt.unstable_getCurrentPriorityLevel=function(){return nr},xt.unstable_getFirstCallbackNode=function(){return At(er)},xt.unstable_next=function(Ir){switch(nr){case 1:case 2:case 3:var $r=3;break;default:$r=nr}var vr=nr;nr=$r;try{return Ir()}finally{nr=vr}},xt.unstable_pauseExecution=function(){},xt.unstable_requestPaint=function(){},xt.unstable_runWithPriority=function(Ir,$r){switch(Ir){case 1:case 2:case 3:case 4:case 5:break;default:Ir=3}var vr=nr;nr=Ir;try{return $r()}finally{nr=vr}},xt.unstable_scheduleCallback=function(Ir,$r,vr){var Er=xt.unstable_now();switch(typeof vr=="object"&&vr!==null?(vr=vr.delay,vr=typeof vr=="number"&&0<vr?Er+vr:Er):vr=Er,Ir){case 1:var Tr=-1;break;case 2:Tr=250;break;case 5:Tr=1073741823;break;case 4:Tr=1e4;break;default:Tr=5e3}return Tr=vr+Tr,Ir={id:zt++,callback:$r,priorityLevel:Ir,startTime:vr,expirationTime:Tr,sortIndex:-1},vr>Er?(Ir.sortIndex=vr,e(tr,Ir),At(er)===null&&Ir===At(tr)&&(dr?(fr(kr),kr=-1):dr=!0,xr(yr,vr-Er))):(Ir.sortIndex=Tr,e(er,Ir),ar||ir||(ar=!0,Dr(br))),Ir},xt.unstable_shouldYield=Lr,xt.unstable_wrapCallback=function(Ir){var $r=nr;return function(){var vr=nr;nr=$r;try{return Ir.apply(this,arguments)}finally{nr=vr}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p$1(xt){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+xt,At=1;At<arguments.length;At++)e+="&args[]="+encodeURIComponent(arguments[At]);return"Minified React error #"+xt+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(xt,e){ha(xt,e),ha(xt+"Capture",e)}function ha(xt,e){for(ea[xt]=e,xt=0;xt<e.length;xt++)da.add(e[xt])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(xt){return ja.call(ma,xt)?!0:ja.call(la,xt)?!1:ka.test(xt)?ma[xt]=!0:(la[xt]=!0,!1)}function pa(xt,e,At,kt){if(At!==null&&At.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return kt?!1:At!==null?!At.acceptsBooleans:(xt=xt.toLowerCase().slice(0,5),xt!=="data-"&&xt!=="aria-");default:return!1}}function qa(xt,e,At,kt){if(e===null||typeof e>"u"||pa(xt,e,At,kt))return!0;if(kt)return!1;if(At!==null)switch(At.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function v$2(xt,e,At,kt,Bt,Nt,jt){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=kt,this.attributeNamespace=Bt,this.mustUseProperty=At,this.propertyName=xt,this.type=e,this.sanitizeURL=Nt,this.removeEmptyString=jt}var z$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(xt){z$1[xt]=new v$2(xt,0,!1,xt,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(xt){var e=xt[0];z$1[e]=new v$2(e,1,!1,xt[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(xt){z$1[xt]=new v$2(xt,2,!1,xt.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(xt){z$1[xt]=new v$2(xt,2,!1,xt,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(xt){z$1[xt]=new v$2(xt,3,!1,xt.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(xt){z$1[xt]=new v$2(xt,3,!0,xt,null,!1,!1)});["capture","download"].forEach(function(xt){z$1[xt]=new v$2(xt,4,!1,xt,null,!1,!1)});["cols","rows","size","span"].forEach(function(xt){z$1[xt]=new v$2(xt,6,!1,xt,null,!1,!1)});["rowSpan","start"].forEach(function(xt){z$1[xt]=new v$2(xt,5,!1,xt.toLowerCase(),null,!1,!1)});var ra$1=/[\-:]([a-z])/g;function sa(xt){return xt[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(xt){var e=xt.replace(ra$1,sa);z$1[e]=new v$2(e,1,!1,xt,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(xt){var e=xt.replace(ra$1,sa);z$1[e]=new v$2(e,1,!1,xt,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(xt){var e=xt.replace(ra$1,sa);z$1[e]=new v$2(e,1,!1,xt,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(xt){z$1[xt]=new v$2(xt,1,!1,xt.toLowerCase(),null,!1,!1)});z$1.xlinkHref=new v$2("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(xt){z$1[xt]=new v$2(xt,1,!1,xt.toLowerCase(),null,!0,!0)});function ta(xt,e,At,kt){var Bt=z$1.hasOwnProperty(e)?z$1[e]:null;(Bt!==null?Bt.type!==0:kt||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qa(e,At,Bt,kt)&&(At=null),kt||Bt===null?oa(e)&&(At===null?xt.removeAttribute(e):xt.setAttribute(e,""+At)):Bt.mustUseProperty?xt[Bt.propertyName]=At===null?Bt.type===3?!1:"":At:(e=Bt.attributeName,kt=Bt.attributeNamespace,At===null?xt.removeAttribute(e):(Bt=Bt.type,At=Bt===3||Bt===4&&At===!0?"":""+At,kt?xt.setAttributeNS(kt,e,At):xt.setAttribute(e,At))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(xt){return xt===null||typeof xt!="object"?null:(xt=Ja&&xt[Ja]||xt["@@iterator"],typeof xt=="function"?xt:null)}var A$1=Object.assign,La;function Ma(xt){if(La===void 0)try{throw Error()}catch(At){var e=At.stack.trim().match(/\n( *(at )?)/);La=e&&e[1]||""}return`
`+La+xt}var Na=!1;function Oa(xt,e){if(!xt||Na)return"";Na=!0;var At=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(tr){var kt=tr}Reflect.construct(xt,[],e)}else{try{e.call()}catch(tr){kt=tr}xt.call(e.prototype)}else{try{throw Error()}catch(tr){kt=tr}xt()}}catch(tr){if(tr&&kt&&typeof tr.stack=="string"){for(var Bt=tr.stack.split(`
`),Nt=kt.stack.split(`
`),jt=Bt.length-1,Lt=Nt.length-1;1<=jt&&0<=Lt&&Bt[jt]!==Nt[Lt];)Lt--;for(;1<=jt&&0<=Lt;jt--,Lt--)if(Bt[jt]!==Nt[Lt]){if(jt!==1||Lt!==1)do if(jt--,Lt--,0>Lt||Bt[jt]!==Nt[Lt]){var er=`
`+Bt[jt].replace(" at new "," at ");return xt.displayName&&er.includes("<anonymous>")&&(er=er.replace("<anonymous>",xt.displayName)),er}while(1<=jt&&0<=Lt);break}}}finally{Na=!1,Error.prepareStackTrace=At}return(xt=xt?xt.displayName||xt.name:"")?Ma(xt):""}function Pa(xt){switch(xt.tag){case 5:return Ma(xt.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return xt=Oa(xt.type,!1),xt;case 11:return xt=Oa(xt.type.render,!1),xt;case 1:return xt=Oa(xt.type,!0),xt;default:return""}}function Qa(xt){if(xt==null)return null;if(typeof xt=="function")return xt.displayName||xt.name||null;if(typeof xt=="string")return xt;switch(xt){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof xt=="object")switch(xt.$$typeof){case Ca:return(xt.displayName||"Context")+".Consumer";case Ba:return(xt._context.displayName||"Context")+".Provider";case Da:var e=xt.render;return xt=xt.displayName,xt||(xt=e.displayName||e.name||"",xt=xt!==""?"ForwardRef("+xt+")":"ForwardRef"),xt;case Ga:return e=xt.displayName||null,e!==null?e:Qa(xt.type)||"Memo";case Ha:e=xt._payload,xt=xt._init;try{return Qa(xt(e))}catch{}}return null}function Ra(xt){var e=xt.type;switch(xt.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return xt=e.render,xt=xt.displayName||xt.name||"",e.displayName||(xt!==""?"ForwardRef("+xt+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(e);case 8:return e===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Sa(xt){switch(typeof xt){case"boolean":case"number":case"string":case"undefined":return xt;case"object":return xt;default:return""}}function Ta(xt){var e=xt.type;return(xt=xt.nodeName)&&xt.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Ua(xt){var e=Ta(xt)?"checked":"value",At=Object.getOwnPropertyDescriptor(xt.constructor.prototype,e),kt=""+xt[e];if(!xt.hasOwnProperty(e)&&typeof At<"u"&&typeof At.get=="function"&&typeof At.set=="function"){var Bt=At.get,Nt=At.set;return Object.defineProperty(xt,e,{configurable:!0,get:function(){return Bt.call(this)},set:function(jt){kt=""+jt,Nt.call(this,jt)}}),Object.defineProperty(xt,e,{enumerable:At.enumerable}),{getValue:function(){return kt},setValue:function(jt){kt=""+jt},stopTracking:function(){xt._valueTracker=null,delete xt[e]}}}}function Va(xt){xt._valueTracker||(xt._valueTracker=Ua(xt))}function Wa(xt){if(!xt)return!1;var e=xt._valueTracker;if(!e)return!0;var At=e.getValue(),kt="";return xt&&(kt=Ta(xt)?xt.checked?"true":"false":xt.value),xt=kt,xt!==At?(e.setValue(xt),!0):!1}function Xa(xt){if(xt=xt||(typeof document<"u"?document:void 0),typeof xt>"u")return null;try{return xt.activeElement||xt.body}catch{return xt.body}}function Ya(xt,e){var At=e.checked;return A$1({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:At??xt._wrapperState.initialChecked})}function Za(xt,e){var At=e.defaultValue==null?"":e.defaultValue,kt=e.checked!=null?e.checked:e.defaultChecked;At=Sa(e.value!=null?e.value:At),xt._wrapperState={initialChecked:kt,initialValue:At,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function ab(xt,e){e=e.checked,e!=null&&ta(xt,"checked",e,!1)}function bb(xt,e){ab(xt,e);var At=Sa(e.value),kt=e.type;if(At!=null)kt==="number"?(At===0&&xt.value===""||xt.value!=At)&&(xt.value=""+At):xt.value!==""+At&&(xt.value=""+At);else if(kt==="submit"||kt==="reset"){xt.removeAttribute("value");return}e.hasOwnProperty("value")?cb(xt,e.type,At):e.hasOwnProperty("defaultValue")&&cb(xt,e.type,Sa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(xt.defaultChecked=!!e.defaultChecked)}function db(xt,e,At){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var kt=e.type;if(!(kt!=="submit"&&kt!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+xt._wrapperState.initialValue,At||e===xt.value||(xt.value=e),xt.defaultValue=e}At=xt.name,At!==""&&(xt.name=""),xt.defaultChecked=!!xt._wrapperState.initialChecked,At!==""&&(xt.name=At)}function cb(xt,e,At){(e!=="number"||Xa(xt.ownerDocument)!==xt)&&(At==null?xt.defaultValue=""+xt._wrapperState.initialValue:xt.defaultValue!==""+At&&(xt.defaultValue=""+At))}var eb=Array.isArray;function fb(xt,e,At,kt){if(xt=xt.options,e){e={};for(var Bt=0;Bt<At.length;Bt++)e["$"+At[Bt]]=!0;for(At=0;At<xt.length;At++)Bt=e.hasOwnProperty("$"+xt[At].value),xt[At].selected!==Bt&&(xt[At].selected=Bt),Bt&&kt&&(xt[At].defaultSelected=!0)}else{for(At=""+Sa(At),e=null,Bt=0;Bt<xt.length;Bt++){if(xt[Bt].value===At){xt[Bt].selected=!0,kt&&(xt[Bt].defaultSelected=!0);return}e!==null||xt[Bt].disabled||(e=xt[Bt])}e!==null&&(e.selected=!0)}}function gb(xt,e){if(e.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A$1({},e,{value:void 0,defaultValue:void 0,children:""+xt._wrapperState.initialValue})}function hb(xt,e){var At=e.value;if(At==null){if(At=e.children,e=e.defaultValue,At!=null){if(e!=null)throw Error(p$1(92));if(eb(At)){if(1<At.length)throw Error(p$1(93));At=At[0]}e=At}e==null&&(e=""),At=e}xt._wrapperState={initialValue:Sa(At)}}function ib(xt,e){var At=Sa(e.value),kt=Sa(e.defaultValue);At!=null&&(At=""+At,At!==xt.value&&(xt.value=At),e.defaultValue==null&&xt.defaultValue!==At&&(xt.defaultValue=At)),kt!=null&&(xt.defaultValue=""+kt)}function jb(xt){var e=xt.textContent;e===xt._wrapperState.initialValue&&e!==""&&e!==null&&(xt.value=e)}function kb(xt){switch(xt){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(xt,e){return xt==null||xt==="http://www.w3.org/1999/xhtml"?kb(e):xt==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":xt}var mb,nb=function(xt){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,At,kt,Bt){MSApp.execUnsafeLocalFunction(function(){return xt(e,At,kt,Bt)})}:xt}(function(xt,e){if(xt.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in xt)xt.innerHTML=e;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mb.firstChild;xt.firstChild;)xt.removeChild(xt.firstChild);for(;e.firstChild;)xt.appendChild(e.firstChild)}});function ob(xt,e){if(e){var At=xt.firstChild;if(At&&At===xt.lastChild&&At.nodeType===3){At.nodeValue=e;return}}xt.textContent=e}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(xt){qb.forEach(function(e){e=e+xt.charAt(0).toUpperCase()+xt.substring(1),pb[e]=pb[xt]})});function rb(xt,e,At){return e==null||typeof e=="boolean"||e===""?"":At||typeof e!="number"||e===0||pb.hasOwnProperty(xt)&&pb[xt]?(""+e).trim():e+"px"}function sb(xt,e){xt=xt.style;for(var At in e)if(e.hasOwnProperty(At)){var kt=At.indexOf("--")===0,Bt=rb(At,e[At],kt);At==="float"&&(At="cssFloat"),kt?xt.setProperty(At,Bt):xt[At]=Bt}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(xt,e){if(e){if(tb[xt]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(p$1(137,xt));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(p$1(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(p$1(61))}if(e.style!=null&&typeof e.style!="object")throw Error(p$1(62))}}function vb(xt,e){if(xt.indexOf("-")===-1)return typeof e.is=="string";switch(xt){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(xt){return xt=xt.target||xt.srcElement||window,xt.correspondingUseElement&&(xt=xt.correspondingUseElement),xt.nodeType===3?xt.parentNode:xt}var yb=null,zb=null,Ab=null;function Bb(xt){if(xt=Cb(xt)){if(typeof yb!="function")throw Error(p$1(280));var e=xt.stateNode;e&&(e=Db(e),yb(xt.stateNode,xt.type,e))}}function Eb(xt){zb?Ab?Ab.push(xt):Ab=[xt]:zb=xt}function Fb(){if(zb){var xt=zb,e=Ab;if(Ab=zb=null,Bb(xt),e)for(xt=0;xt<e.length;xt++)Bb(e[xt])}}function Gb(xt,e){return xt(e)}function Hb(){}var Ib=!1;function Jb(xt,e,At){if(Ib)return xt(e,At);Ib=!0;try{return Gb(xt,e,At)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(xt,e){var At=xt.stateNode;if(At===null)return null;var kt=Db(At);if(kt===null)return null;At=kt[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(kt=!kt.disabled)||(xt=xt.type,kt=!(xt==="button"||xt==="input"||xt==="select"||xt==="textarea")),xt=!kt;break e;default:xt=!1}if(xt)return null;if(At&&typeof At!="function")throw Error(p$1(231,e,typeof At));return At}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(xt,e,At,kt,Bt,Nt,jt,Lt,er){var tr=Array.prototype.slice.call(arguments,3);try{e.apply(At,tr)}catch(zt){this.onError(zt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(xt){Ob=!0,Pb=xt}};function Tb(xt,e,At,kt,Bt,Nt,jt,Lt,er){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(xt,e,At,kt,Bt,Nt,jt,Lt,er){if(Tb.apply(this,arguments),Ob){if(Ob){var tr=Pb;Ob=!1,Pb=null}else throw Error(p$1(198));Qb||(Qb=!0,Rb=tr)}}function Vb(xt){var e=xt,At=xt;if(xt.alternate)for(;e.return;)e=e.return;else{xt=e;do e=xt,e.flags&4098&&(At=e.return),xt=e.return;while(xt)}return e.tag===3?At:null}function Wb(xt){if(xt.tag===13){var e=xt.memoizedState;if(e===null&&(xt=xt.alternate,xt!==null&&(e=xt.memoizedState)),e!==null)return e.dehydrated}return null}function Xb(xt){if(Vb(xt)!==xt)throw Error(p$1(188))}function Yb(xt){var e=xt.alternate;if(!e){if(e=Vb(xt),e===null)throw Error(p$1(188));return e!==xt?null:xt}for(var At=xt,kt=e;;){var Bt=At.return;if(Bt===null)break;var Nt=Bt.alternate;if(Nt===null){if(kt=Bt.return,kt!==null){At=kt;continue}break}if(Bt.child===Nt.child){for(Nt=Bt.child;Nt;){if(Nt===At)return Xb(Bt),xt;if(Nt===kt)return Xb(Bt),e;Nt=Nt.sibling}throw Error(p$1(188))}if(At.return!==kt.return)At=Bt,kt=Nt;else{for(var jt=!1,Lt=Bt.child;Lt;){if(Lt===At){jt=!0,At=Bt,kt=Nt;break}if(Lt===kt){jt=!0,kt=Bt,At=Nt;break}Lt=Lt.sibling}if(!jt){for(Lt=Nt.child;Lt;){if(Lt===At){jt=!0,At=Nt,kt=Bt;break}if(Lt===kt){jt=!0,kt=Nt,At=Bt;break}Lt=Lt.sibling}if(!jt)throw Error(p$1(189))}}if(At.alternate!==kt)throw Error(p$1(190))}if(At.tag!==3)throw Error(p$1(188));return At.stateNode.current===At?xt:e}function Zb(xt){return xt=Yb(xt),xt!==null?$b(xt):null}function $b(xt){if(xt.tag===5||xt.tag===6)return xt;for(xt=xt.child;xt!==null;){var e=$b(xt);if(e!==null)return e;xt=xt.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$1=ca.unstable_now,ec$1=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(xt){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,xt,void 0,(xt.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(xt){return xt>>>=0,xt===0?32:31-(pc(xt)/qc|0)|0}var rc=64,sc=4194304;function tc(xt){switch(xt&-xt){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return xt&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return xt&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return xt}}function uc(xt,e){var At=xt.pendingLanes;if(At===0)return 0;var kt=0,Bt=xt.suspendedLanes,Nt=xt.pingedLanes,jt=At&268435455;if(jt!==0){var Lt=jt&~Bt;Lt!==0?kt=tc(Lt):(Nt&=jt,Nt!==0&&(kt=tc(Nt)))}else jt=At&~Bt,jt!==0?kt=tc(jt):Nt!==0&&(kt=tc(Nt));if(kt===0)return 0;if(e!==0&&e!==kt&&!(e&Bt)&&(Bt=kt&-kt,Nt=e&-e,Bt>=Nt||Bt===16&&(Nt&4194240)!==0))return e;if(kt&4&&(kt|=At&16),e=xt.entangledLanes,e!==0)for(xt=xt.entanglements,e&=kt;0<e;)At=31-oc(e),Bt=1<<At,kt|=xt[At],e&=~Bt;return kt}function vc(xt,e){switch(xt){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(xt,e){for(var At=xt.suspendedLanes,kt=xt.pingedLanes,Bt=xt.expirationTimes,Nt=xt.pendingLanes;0<Nt;){var jt=31-oc(Nt),Lt=1<<jt,er=Bt[jt];er===-1?(!(Lt&At)||Lt&kt)&&(Bt[jt]=vc(Lt,e)):er<=e&&(xt.expiredLanes|=Lt),Nt&=~Lt}}function xc(xt){return xt=xt.pendingLanes&-1073741825,xt!==0?xt:xt&1073741824?1073741824:0}function yc(){var xt=rc;return rc<<=1,!(rc&4194240)&&(rc=64),xt}function zc(xt){for(var e=[],At=0;31>At;At++)e.push(xt);return e}function Ac(xt,e,At){xt.pendingLanes|=e,e!==536870912&&(xt.suspendedLanes=0,xt.pingedLanes=0),xt=xt.eventTimes,e=31-oc(e),xt[e]=At}function Bc(xt,e){var At=xt.pendingLanes&~e;xt.pendingLanes=e,xt.suspendedLanes=0,xt.pingedLanes=0,xt.expiredLanes&=e,xt.mutableReadLanes&=e,xt.entangledLanes&=e,e=xt.entanglements;var kt=xt.eventTimes;for(xt=xt.expirationTimes;0<At;){var Bt=31-oc(At),Nt=1<<Bt;e[Bt]=0,kt[Bt]=-1,xt[Bt]=-1,At&=~Nt}}function Cc(xt,e){var At=xt.entangledLanes|=e;for(xt=xt.entanglements;At;){var kt=31-oc(At),Bt=1<<kt;Bt&e|xt[kt]&e&&(xt[kt]|=e),At&=~Bt}}var C$1=0;function Dc(xt){return xt&=-xt,1<xt?4<xt?xt&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(xt,e){switch(xt){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(e.pointerId)}}function Tc(xt,e,At,kt,Bt,Nt){return xt===null||xt.nativeEvent!==Nt?(xt={blockedOn:e,domEventName:At,eventSystemFlags:kt,nativeEvent:Nt,targetContainers:[Bt]},e!==null&&(e=Cb(e),e!==null&&Fc(e)),xt):(xt.eventSystemFlags|=kt,e=xt.targetContainers,Bt!==null&&e.indexOf(Bt)===-1&&e.push(Bt),xt)}function Uc(xt,e,At,kt,Bt){switch(e){case"focusin":return Lc=Tc(Lc,xt,e,At,kt,Bt),!0;case"dragenter":return Mc=Tc(Mc,xt,e,At,kt,Bt),!0;case"mouseover":return Nc=Tc(Nc,xt,e,At,kt,Bt),!0;case"pointerover":var Nt=Bt.pointerId;return Oc.set(Nt,Tc(Oc.get(Nt)||null,xt,e,At,kt,Bt)),!0;case"gotpointercapture":return Nt=Bt.pointerId,Pc.set(Nt,Tc(Pc.get(Nt)||null,xt,e,At,kt,Bt)),!0}return!1}function Vc(xt){var e=Wc(xt.target);if(e!==null){var At=Vb(e);if(At!==null){if(e=At.tag,e===13){if(e=Wb(At),e!==null){xt.blockedOn=e,Ic(xt.priority,function(){Gc(At)});return}}else if(e===3&&At.stateNode.current.memoizedState.isDehydrated){xt.blockedOn=At.tag===3?At.stateNode.containerInfo:null;return}}}xt.blockedOn=null}function Xc(xt){if(xt.blockedOn!==null)return!1;for(var e=xt.targetContainers;0<e.length;){var At=Yc(xt.domEventName,xt.eventSystemFlags,e[0],xt.nativeEvent);if(At===null){At=xt.nativeEvent;var kt=new At.constructor(At.type,At);wb=kt,At.target.dispatchEvent(kt),wb=null}else return e=Cb(At),e!==null&&Fc(e),xt.blockedOn=At,!1;e.shift()}return!0}function Zc(xt,e,At){Xc(xt)&&At.delete(e)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(xt,e){xt.blockedOn===e&&(xt.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(xt){function e(Bt){return ad(Bt,xt)}if(0<Kc.length){ad(Kc[0],xt);for(var At=1;At<Kc.length;At++){var kt=Kc[At];kt.blockedOn===xt&&(kt.blockedOn=null)}}for(Lc!==null&&ad(Lc,xt),Mc!==null&&ad(Mc,xt),Nc!==null&&ad(Nc,xt),Oc.forEach(e),Pc.forEach(e),At=0;At<Qc.length;At++)kt=Qc[At],kt.blockedOn===xt&&(kt.blockedOn=null);for(;0<Qc.length&&(At=Qc[0],At.blockedOn===null);)Vc(At),At.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(xt,e,At,kt){var Bt=C$1,Nt=cd.transition;cd.transition=null;try{C$1=1,fd(xt,e,At,kt)}finally{C$1=Bt,cd.transition=Nt}}function gd(xt,e,At,kt){var Bt=C$1,Nt=cd.transition;cd.transition=null;try{C$1=4,fd(xt,e,At,kt)}finally{C$1=Bt,cd.transition=Nt}}function fd(xt,e,At,kt){if(dd){var Bt=Yc(xt,e,At,kt);if(Bt===null)hd(xt,e,kt,id$1,At),Sc(xt,kt);else if(Uc(Bt,xt,e,At,kt))kt.stopPropagation();else if(Sc(xt,kt),e&4&&-1<Rc.indexOf(xt)){for(;Bt!==null;){var Nt=Cb(Bt);if(Nt!==null&&Ec(Nt),Nt=Yc(xt,e,At,kt),Nt===null&&hd(xt,e,kt,id$1,At),Nt===Bt)break;Bt=Nt}Bt!==null&&kt.stopPropagation()}else hd(xt,e,kt,null,At)}}var id$1=null;function Yc(xt,e,At,kt){if(id$1=null,xt=xb(kt),xt=Wc(xt),xt!==null)if(e=Vb(xt),e===null)xt=null;else if(At=e.tag,At===13){if(xt=Wb(e),xt!==null)return xt;xt=null}else if(At===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;xt=null}else e!==xt&&(xt=null);return id$1=xt,null}function jd(xt){switch(xt){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec$1()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var xt,e=ld,At=e.length,kt,Bt="value"in kd?kd.value:kd.textContent,Nt=Bt.length;for(xt=0;xt<At&&e[xt]===Bt[xt];xt++);var jt=At-xt;for(kt=1;kt<=jt&&e[At-kt]===Bt[Nt-kt];kt++);return md=Bt.slice(xt,1<kt?1-kt:void 0)}function od(xt){var e=xt.keyCode;return"charCode"in xt?(xt=xt.charCode,xt===0&&e===13&&(xt=13)):xt=e,xt===10&&(xt=13),32<=xt||xt===13?xt:0}function pd(){return!0}function qd(){return!1}function rd(xt){function e(At,kt,Bt,Nt,jt){this._reactName=At,this._targetInst=Bt,this.type=kt,this.nativeEvent=Nt,this.target=jt,this.currentTarget=null;for(var Lt in xt)xt.hasOwnProperty(Lt)&&(At=xt[Lt],this[Lt]=At?At(Nt):Nt[Lt]);return this.isDefaultPrevented=(Nt.defaultPrevented!=null?Nt.defaultPrevented:Nt.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var At=this.nativeEvent;At&&(At.preventDefault?At.preventDefault():typeof At.returnValue!="unknown"&&(At.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var At=this.nativeEvent;At&&(At.stopPropagation?At.stopPropagation():typeof At.cancelBubble!="unknown"&&(At.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),e}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(xt){return xt.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(xt){return xt.relatedTarget===void 0?xt.fromElement===xt.srcElement?xt.toElement:xt.fromElement:xt.relatedTarget},movementX:function(xt){return"movementX"in xt?xt.movementX:(xt!==yd&&(yd&&xt.type==="mousemove"?(wd=xt.screenX-yd.screenX,xd=xt.screenY-yd.screenY):xd=wd=0,yd=xt),wd)},movementY:function(xt){return"movementY"in xt?xt.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id$1=A$1({},sd,{clipboardData:function(xt){return"clipboardData"in xt?xt.clipboardData:window.clipboardData}}),Jd=rd(Id$1),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(xt){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(xt):(xt=Od[xt])?!!e[xt]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(xt){if(xt.key){var e=Md[xt.key]||xt.key;if(e!=="Unidentified")return e}return xt.type==="keypress"?(xt=od(xt),xt===13?"Enter":String.fromCharCode(xt)):xt.type==="keydown"||xt.type==="keyup"?Nd[xt.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(xt){return xt.type==="keypress"?od(xt):0},keyCode:function(xt){return xt.type==="keydown"||xt.type==="keyup"?xt.keyCode:0},which:function(xt){return xt.type==="keypress"?od(xt):xt.type==="keydown"||xt.type==="keyup"?xt.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(xt){return"deltaX"in xt?xt.deltaX:"wheelDeltaX"in xt?-xt.wheelDeltaX:0},deltaY:function(xt){return"deltaY"in xt?xt.deltaY:"wheelDeltaY"in xt?-xt.wheelDeltaY:"wheelDelta"in xt?-xt.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae$2=ia&&"CompositionEvent"in window,be$1=null;ia&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be$1,de$1=ia&&(!ae$2||be$1&&8<be$1&&11>=be$1),ee$2=" ",fe$2=!1;function ge$2(xt,e){switch(xt){case"keyup":return $d.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(xt){return xt=xt.detail,typeof xt=="object"&&"data"in xt?xt.data:null}var ie$1=!1;function je$1(xt,e){switch(xt){case"compositionend":return he$1(e);case"keypress":return e.which!==32?null:(fe$2=!0,ee$2);case"textInput":return xt=e.data,xt===ee$2&&fe$2?null:xt;default:return null}}function ke$1(xt,e){if(ie$1)return xt==="compositionend"||!ae$2&&ge$2(xt,e)?(xt=nd(),md=ld=kd=null,ie$1=!1,xt):null;switch(xt){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return de$1&&e.locale!=="ko"?null:e.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(xt){var e=xt&&xt.nodeName&&xt.nodeName.toLowerCase();return e==="input"?!!le$1[xt.type]:e==="textarea"}function ne$2(xt,e,At,kt){Eb(kt),e=oe$2(e,"onChange"),0<e.length&&(At=new td("onChange","change",null,At,kt),xt.push({event:At,listeners:e}))}var pe$1=null,qe$1=null;function re$1(xt){se$2(xt,0)}function te$2(xt){var e=ue$1(xt);if(Wa(e))return xt}function ve$1(xt,e){if(xt==="change")return e}var we$1=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze$1=document.createElement("div");ze$1.setAttribute("oninput","return;"),ye$1=typeof ze$1.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be$1),qe$1=pe$1=null)}function Be$1(xt){if(xt.propertyName==="value"&&te$2(qe$1)){var e=[];ne$2(e,qe$1,xt,xb(xt)),Jb(re$1,e)}}function Ce$1(xt,e,At){xt==="focusin"?(Ae$1(),pe$1=e,qe$1=At,pe$1.attachEvent("onpropertychange",Be$1)):xt==="focusout"&&Ae$1()}function De$1(xt){if(xt==="selectionchange"||xt==="keyup"||xt==="keydown")return te$2(qe$1)}function Ee$1(xt,e){if(xt==="click")return te$2(e)}function Fe$1(xt,e){if(xt==="input"||xt==="change")return te$2(e)}function Ge$1(xt,e){return xt===e&&(xt!==0||1/xt===1/e)||xt!==xt&&e!==e}var He$1=typeof Object.is=="function"?Object.is:Ge$1;function Ie$1(xt,e){if(He$1(xt,e))return!0;if(typeof xt!="object"||xt===null||typeof e!="object"||e===null)return!1;var At=Object.keys(xt),kt=Object.keys(e);if(At.length!==kt.length)return!1;for(kt=0;kt<At.length;kt++){var Bt=At[kt];if(!ja.call(e,Bt)||!He$1(xt[Bt],e[Bt]))return!1}return!0}function Je$1(xt){for(;xt&&xt.firstChild;)xt=xt.firstChild;return xt}function Ke$1(xt,e){var At=Je$1(xt);xt=0;for(var kt;At;){if(At.nodeType===3){if(kt=xt+At.textContent.length,xt<=e&&kt>=e)return{node:At,offset:e-xt};xt=kt}e:{for(;At;){if(At.nextSibling){At=At.nextSibling;break e}At=At.parentNode}At=void 0}At=Je$1(At)}}function Le$1(xt,e){return xt&&e?xt===e?!0:xt&&xt.nodeType===3?!1:e&&e.nodeType===3?Le$1(xt,e.parentNode):"contains"in xt?xt.contains(e):xt.compareDocumentPosition?!!(xt.compareDocumentPosition(e)&16):!1:!1}function Me$1(){for(var xt=window,e=Xa();e instanceof xt.HTMLIFrameElement;){try{var At=typeof e.contentWindow.location.href=="string"}catch{At=!1}if(At)xt=e.contentWindow;else break;e=Xa(xt.document)}return e}function Ne$1(xt){var e=xt&&xt.nodeName&&xt.nodeName.toLowerCase();return e&&(e==="input"&&(xt.type==="text"||xt.type==="search"||xt.type==="tel"||xt.type==="url"||xt.type==="password")||e==="textarea"||xt.contentEditable==="true")}function Oe$1(xt){var e=Me$1(),At=xt.focusedElem,kt=xt.selectionRange;if(e!==At&&At&&At.ownerDocument&&Le$1(At.ownerDocument.documentElement,At)){if(kt!==null&&Ne$1(At)){if(e=kt.start,xt=kt.end,xt===void 0&&(xt=e),"selectionStart"in At)At.selectionStart=e,At.selectionEnd=Math.min(xt,At.value.length);else if(xt=(e=At.ownerDocument||document)&&e.defaultView||window,xt.getSelection){xt=xt.getSelection();var Bt=At.textContent.length,Nt=Math.min(kt.start,Bt);kt=kt.end===void 0?Nt:Math.min(kt.end,Bt),!xt.extend&&Nt>kt&&(Bt=kt,kt=Nt,Nt=Bt),Bt=Ke$1(At,Nt);var jt=Ke$1(At,kt);Bt&&jt&&(xt.rangeCount!==1||xt.anchorNode!==Bt.node||xt.anchorOffset!==Bt.offset||xt.focusNode!==jt.node||xt.focusOffset!==jt.offset)&&(e=e.createRange(),e.setStart(Bt.node,Bt.offset),xt.removeAllRanges(),Nt>kt?(xt.addRange(e),xt.extend(jt.node,jt.offset)):(e.setEnd(jt.node,jt.offset),xt.addRange(e)))}}for(e=[],xt=At;xt=xt.parentNode;)xt.nodeType===1&&e.push({element:xt,left:xt.scrollLeft,top:xt.scrollTop});for(typeof At.focus=="function"&&At.focus(),At=0;At<e.length;At++)xt=e[At],xt.element.scrollLeft=xt.left,xt.element.scrollTop=xt.top}}var Pe$1=ia&&"documentMode"in document&&11>=document.documentMode,Qe$1=null,Re$1=null,Se$1=null,Te$2=!1;function Ue$1(xt,e,At){var kt=At.window===At?At.document:At.nodeType===9?At:At.ownerDocument;Te$2||Qe$1==null||Qe$1!==Xa(kt)||(kt=Qe$1,"selectionStart"in kt&&Ne$1(kt)?kt={start:kt.selectionStart,end:kt.selectionEnd}:(kt=(kt.ownerDocument&&kt.ownerDocument.defaultView||window).getSelection(),kt={anchorNode:kt.anchorNode,anchorOffset:kt.anchorOffset,focusNode:kt.focusNode,focusOffset:kt.focusOffset}),Se$1&&Ie$1(Se$1,kt)||(Se$1=kt,kt=oe$2(Re$1,"onSelect"),0<kt.length&&(e=new td("onSelect","select",null,e,At),xt.push({event:e,listeners:kt}),e.target=Qe$1)))}function Ve$1(xt,e){var At={};return At[xt.toLowerCase()]=e.toLowerCase(),At["Webkit"+xt]="webkit"+e,At["Moz"+xt]="moz"+e,At}var We$1={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe$1={},Ye$1={};ia&&(Ye$1=document.createElement("div").style,"AnimationEvent"in window||(delete We$1.animationend.animation,delete We$1.animationiteration.animation,delete We$1.animationstart.animation),"TransitionEvent"in window||delete We$1.transitionend.transition);function Ze$1(xt){if(Xe$1[xt])return Xe$1[xt];if(!We$1[xt])return xt;var e=We$1[xt],At;for(At in e)if(e.hasOwnProperty(At)&&At in Ye$1)return Xe$1[xt]=e[At];return xt}var $e$1=Ze$1("animationend"),af=Ze$1("animationiteration"),bf=Ze$1("animationstart"),cf=Ze$1("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(xt,e){df.set(xt,e),fa(e,[xt])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(xt,e,At){var kt=xt.type||"unknown-event";xt.currentTarget=At,Ub(kt,e,void 0,xt),xt.currentTarget=null}function se$2(xt,e){e=(e&4)!==0;for(var At=0;At<xt.length;At++){var kt=xt[At],Bt=kt.event;kt=kt.listeners;e:{var Nt=void 0;if(e)for(var jt=kt.length-1;0<=jt;jt--){var Lt=kt[jt],er=Lt.instance,tr=Lt.currentTarget;if(Lt=Lt.listener,er!==Nt&&Bt.isPropagationStopped())break e;nf(Bt,Lt,tr),Nt=er}else for(jt=0;jt<kt.length;jt++){if(Lt=kt[jt],er=Lt.instance,tr=Lt.currentTarget,Lt=Lt.listener,er!==Nt&&Bt.isPropagationStopped())break e;nf(Bt,Lt,tr),Nt=er}}}if(Qb)throw xt=Rb,Qb=!1,Rb=null,xt}function D$2(xt,e){var At=e[of];At===void 0&&(At=e[of]=new Set);var kt=xt+"__bubble";At.has(kt)||(pf(e,xt,2,!1),At.add(kt))}function qf(xt,e,At){var kt=0;e&&(kt|=4),pf(At,xt,kt,e)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(xt){if(!xt[rf]){xt[rf]=!0,da.forEach(function(At){At!=="selectionchange"&&(mf.has(At)||qf(At,!1,xt),qf(At,!0,xt))});var e=xt.nodeType===9?xt:xt.ownerDocument;e===null||e[rf]||(e[rf]=!0,qf("selectionchange",!1,e))}}function pf(xt,e,At,kt){switch(jd(e)){case 1:var Bt=ed;break;case 4:Bt=gd;break;default:Bt=fd}At=Bt.bind(null,e,At,xt),Bt=void 0,!Lb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(Bt=!0),kt?Bt!==void 0?xt.addEventListener(e,At,{capture:!0,passive:Bt}):xt.addEventListener(e,At,!0):Bt!==void 0?xt.addEventListener(e,At,{passive:Bt}):xt.addEventListener(e,At,!1)}function hd(xt,e,At,kt,Bt){var Nt=kt;if(!(e&1)&&!(e&2)&&kt!==null)e:for(;;){if(kt===null)return;var jt=kt.tag;if(jt===3||jt===4){var Lt=kt.stateNode.containerInfo;if(Lt===Bt||Lt.nodeType===8&&Lt.parentNode===Bt)break;if(jt===4)for(jt=kt.return;jt!==null;){var er=jt.tag;if((er===3||er===4)&&(er=jt.stateNode.containerInfo,er===Bt||er.nodeType===8&&er.parentNode===Bt))return;jt=jt.return}for(;Lt!==null;){if(jt=Wc(Lt),jt===null)return;if(er=jt.tag,er===5||er===6){kt=Nt=jt;continue e}Lt=Lt.parentNode}}kt=kt.return}Jb(function(){var tr=Nt,zt=xb(At),rr=[];e:{var nr=df.get(xt);if(nr!==void 0){var ir=td,ar=xt;switch(xt){case"keypress":if(od(At)===0)break e;case"keydown":case"keyup":ir=Rd;break;case"focusin":ar="focus",ir=Fd;break;case"focusout":ar="blur",ir=Fd;break;case"beforeblur":case"afterblur":ir=Fd;break;case"click":if(At.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ir=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ir=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ir=Vd;break;case $e$1:case af:case bf:ir=Hd;break;case cf:ir=Xd;break;case"scroll":ir=vd;break;case"wheel":ir=Zd;break;case"copy":case"cut":case"paste":ir=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ir=Td}var dr=(e&4)!==0,ur=!dr&&xt==="scroll",fr=dr?nr!==null?nr+"Capture":null:nr;dr=[];for(var pr=tr,lr;pr!==null;){lr=pr;var yr=lr.stateNode;if(lr.tag===5&&yr!==null&&(lr=yr,fr!==null&&(yr=Kb(pr,fr),yr!=null&&dr.push(tf(pr,yr,lr)))),ur)break;pr=pr.return}0<dr.length&&(nr=new ir(nr,ar,null,At,zt),rr.push({event:nr,listeners:dr}))}}if(!(e&7)){e:{if(nr=xt==="mouseover"||xt==="pointerover",ir=xt==="mouseout"||xt==="pointerout",nr&&At!==wb&&(ar=At.relatedTarget||At.fromElement)&&(Wc(ar)||ar[uf]))break e;if((ir||nr)&&(nr=zt.window===zt?zt:(nr=zt.ownerDocument)?nr.defaultView||nr.parentWindow:window,ir?(ar=At.relatedTarget||At.toElement,ir=tr,ar=ar?Wc(ar):null,ar!==null&&(ur=Vb(ar),ar!==ur||ar.tag!==5&&ar.tag!==6)&&(ar=null)):(ir=null,ar=tr),ir!==ar)){if(dr=Bd,yr="onMouseLeave",fr="onMouseEnter",pr="mouse",(xt==="pointerout"||xt==="pointerover")&&(dr=Td,yr="onPointerLeave",fr="onPointerEnter",pr="pointer"),ur=ir==null?nr:ue$1(ir),lr=ar==null?nr:ue$1(ar),nr=new dr(yr,pr+"leave",ir,At,zt),nr.target=ur,nr.relatedTarget=lr,yr=null,Wc(zt)===tr&&(dr=new dr(fr,pr+"enter",ar,At,zt),dr.target=lr,dr.relatedTarget=ur,yr=dr),ur=yr,ir&&ar)t:{for(dr=ir,fr=ar,pr=0,lr=dr;lr;lr=vf(lr))pr++;for(lr=0,yr=fr;yr;yr=vf(yr))lr++;for(;0<pr-lr;)dr=vf(dr),pr--;for(;0<lr-pr;)fr=vf(fr),lr--;for(;pr--;){if(dr===fr||fr!==null&&dr===fr.alternate)break t;dr=vf(dr),fr=vf(fr)}dr=null}else dr=null;ir!==null&&wf(rr,nr,ir,dr,!1),ar!==null&&ur!==null&&wf(rr,ur,ar,dr,!0)}}e:{if(nr=tr?ue$1(tr):window,ir=nr.nodeName&&nr.nodeName.toLowerCase(),ir==="select"||ir==="input"&&nr.type==="file")var br=ve$1;else if(me$1(nr))if(we$1)br=Fe$1;else{br=De$1;var Ar=Ce$1}else(ir=nr.nodeName)&&ir.toLowerCase()==="input"&&(nr.type==="checkbox"||nr.type==="radio")&&(br=Ee$1);if(br&&(br=br(xt,tr))){ne$2(rr,br,At,zt);break e}Ar&&Ar(xt,nr,tr),xt==="focusout"&&(Ar=nr._wrapperState)&&Ar.controlled&&nr.type==="number"&&cb(nr,"number",nr.value)}switch(Ar=tr?ue$1(tr):window,xt){case"focusin":(me$1(Ar)||Ar.contentEditable==="true")&&(Qe$1=Ar,Re$1=tr,Se$1=null);break;case"focusout":Se$1=Re$1=Qe$1=null;break;case"mousedown":Te$2=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$2=!1,Ue$1(rr,At,zt);break;case"selectionchange":if(Pe$1)break;case"keydown":case"keyup":Ue$1(rr,At,zt)}var Pr;if(ae$2)e:{switch(xt){case"compositionstart":var kr="onCompositionStart";break e;case"compositionend":kr="onCompositionEnd";break e;case"compositionupdate":kr="onCompositionUpdate";break e}kr=void 0}else ie$1?ge$2(xt,At)&&(kr="onCompositionEnd"):xt==="keydown"&&At.keyCode===229&&(kr="onCompositionStart");kr&&(de$1&&At.locale!=="ko"&&(ie$1||kr!=="onCompositionStart"?kr==="onCompositionEnd"&&ie$1&&(Pr=nd()):(kd=zt,ld="value"in kd?kd.value:kd.textContent,ie$1=!0)),Ar=oe$2(tr,kr),0<Ar.length&&(kr=new Ld(kr,xt,null,At,zt),rr.push({event:kr,listeners:Ar}),Pr?kr.data=Pr:(Pr=he$1(At),Pr!==null&&(kr.data=Pr)))),(Pr=ce$1?je$1(xt,At):ke$1(xt,At))&&(tr=oe$2(tr,"onBeforeInput"),0<tr.length&&(zt=new Ld("onBeforeInput","beforeinput",null,At,zt),rr.push({event:zt,listeners:tr}),zt.data=Pr))}se$2(rr,e)})}function tf(xt,e,At){return{instance:xt,listener:e,currentTarget:At}}function oe$2(xt,e){for(var At=e+"Capture",kt=[];xt!==null;){var Bt=xt,Nt=Bt.stateNode;Bt.tag===5&&Nt!==null&&(Bt=Nt,Nt=Kb(xt,At),Nt!=null&&kt.unshift(tf(xt,Nt,Bt)),Nt=Kb(xt,e),Nt!=null&&kt.push(tf(xt,Nt,Bt))),xt=xt.return}return kt}function vf(xt){if(xt===null)return null;do xt=xt.return;while(xt&&xt.tag!==5);return xt||null}function wf(xt,e,At,kt,Bt){for(var Nt=e._reactName,jt=[];At!==null&&At!==kt;){var Lt=At,er=Lt.alternate,tr=Lt.stateNode;if(er!==null&&er===kt)break;Lt.tag===5&&tr!==null&&(Lt=tr,Bt?(er=Kb(At,Nt),er!=null&&jt.unshift(tf(At,er,Lt))):Bt||(er=Kb(At,Nt),er!=null&&jt.push(tf(At,er,Lt)))),At=At.return}jt.length!==0&&xt.push({event:e,listeners:jt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(xt){return(typeof xt=="string"?xt:""+xt).replace(xf,`
`).replace(yf,"")}function Af(xt,e,At){if(e=zf(e),zf(xt)!==e&&At)throw Error(p$1(425))}function Bf(){}var Cf=null,Df=null;function Ef(xt,e){return xt==="textarea"||xt==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(xt){return Hf.resolve(null).then(xt).catch(If)}:Ff;function If(xt){setTimeout(function(){throw xt})}function Kf(xt,e){var At=e,kt=0;do{var Bt=At.nextSibling;if(xt.removeChild(At),Bt&&Bt.nodeType===8)if(At=Bt.data,At==="/$"){if(kt===0){xt.removeChild(Bt),bd(e);return}kt--}else At!=="$"&&At!=="$?"&&At!=="$!"||kt++;At=Bt}while(At);bd(e)}function Lf(xt){for(;xt!=null;xt=xt.nextSibling){var e=xt.nodeType;if(e===1||e===3)break;if(e===8){if(e=xt.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return xt}function Mf(xt){xt=xt.previousSibling;for(var e=0;xt;){if(xt.nodeType===8){var At=xt.data;if(At==="$"||At==="$!"||At==="$?"){if(e===0)return xt;e--}else At==="/$"&&e++}xt=xt.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(xt){var e=xt[Of];if(e)return e;for(var At=xt.parentNode;At;){if(e=At[uf]||At[Of]){if(At=e.alternate,e.child!==null||At!==null&&At.child!==null)for(xt=Mf(xt);xt!==null;){if(At=xt[Of])return At;xt=Mf(xt)}return e}xt=At,At=xt.parentNode}return null}function Cb(xt){return xt=xt[Of]||xt[uf],!xt||xt.tag!==5&&xt.tag!==6&&xt.tag!==13&&xt.tag!==3?null:xt}function ue$1(xt){if(xt.tag===5||xt.tag===6)return xt.stateNode;throw Error(p$1(33))}function Db(xt){return xt[Pf]||null}var Sf=[],Tf=-1;function Uf(xt){return{current:xt}}function E$4(xt){0>Tf||(xt.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$4(xt,e){Tf++,Sf[Tf]=xt.current,xt.current=e}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(xt,e){var At=xt.type.contextTypes;if(!At)return Vf;var kt=xt.stateNode;if(kt&&kt.__reactInternalMemoizedUnmaskedChildContext===e)return kt.__reactInternalMemoizedMaskedChildContext;var Bt={},Nt;for(Nt in At)Bt[Nt]=e[Nt];return kt&&(xt=xt.stateNode,xt.__reactInternalMemoizedUnmaskedChildContext=e,xt.__reactInternalMemoizedMaskedChildContext=Bt),Bt}function Zf(xt){return xt=xt.childContextTypes,xt!=null}function $f(){E$4(Wf),E$4(H$1)}function ag(xt,e,At){if(H$1.current!==Vf)throw Error(p$1(168));G$4(H$1,e),G$4(Wf,At)}function bg(xt,e,At){var kt=xt.stateNode;if(e=e.childContextTypes,typeof kt.getChildContext!="function")return At;kt=kt.getChildContext();for(var Bt in kt)if(!(Bt in e))throw Error(p$1(108,Ra(xt)||"Unknown",Bt));return A$1({},At,kt)}function cg(xt){return xt=(xt=xt.stateNode)&&xt.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G$4(H$1,xt),G$4(Wf,Wf.current),!0}function dg(xt,e,At){var kt=xt.stateNode;if(!kt)throw Error(p$1(169));At?(xt=bg(xt,e,Xf),kt.__reactInternalMemoizedMergedChildContext=xt,E$4(Wf),E$4(H$1),G$4(H$1,xt)):E$4(Wf),G$4(Wf,At)}var eg=null,fg=!1,gg=!1;function hg(xt){eg===null?eg=[xt]:eg.push(xt)}function ig(xt){fg=!0,hg(xt)}function jg(){if(!gg&&eg!==null){gg=!0;var xt=0,e=C$1;try{var At=eg;for(C$1=1;xt<At.length;xt++){var kt=At[xt];do kt=kt(!0);while(kt!==null)}eg=null,fg=!1}catch(Bt){throw eg!==null&&(eg=eg.slice(xt+1)),ac(fc,jg),Bt}finally{C$1=e,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(xt,e){kg[lg++]=ng,kg[lg++]=mg,mg=xt,ng=e}function ug(xt,e,At){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=xt;var kt=rg;xt=sg;var Bt=32-oc(kt)-1;kt&=~(1<<Bt),At+=1;var Nt=32-oc(e)+Bt;if(30<Nt){var jt=Bt-Bt%5;Nt=(kt&(1<<jt)-1).toString(32),kt>>=jt,Bt-=jt,rg=1<<32-oc(e)+Bt|At<<Bt|kt,sg=Nt+xt}else rg=1<<Nt|At<<Bt|kt,sg=xt}function vg(xt){xt.return!==null&&(tg(xt,1),ug(xt,1,0))}function wg(xt){for(;xt===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;xt===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$3=!1,zg=null;function Ag(xt,e){var At=Bg(5,null,null,0);At.elementType="DELETED",At.stateNode=e,At.return=xt,e=xt.deletions,e===null?(xt.deletions=[At],xt.flags|=16):e.push(At)}function Cg(xt,e){switch(xt.tag){case 5:var At=xt.type;return e=e.nodeType!==1||At.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(xt.stateNode=e,xg=xt,yg=Lf(e.firstChild),!0):!1;case 6:return e=xt.pendingProps===""||e.nodeType!==3?null:e,e!==null?(xt.stateNode=e,xg=xt,yg=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(At=qg!==null?{id:rg,overflow:sg}:null,xt.memoizedState={dehydrated:e,treeContext:At,retryLane:1073741824},At=Bg(18,null,null,0),At.stateNode=e,At.return=xt,xt.child=At,xg=xt,yg=null,!0):!1;default:return!1}}function Dg(xt){return(xt.mode&1)!==0&&(xt.flags&128)===0}function Eg(xt){if(I$3){var e=yg;if(e){var At=e;if(!Cg(xt,e)){if(Dg(xt))throw Error(p$1(418));e=Lf(At.nextSibling);var kt=xg;e&&Cg(xt,e)?Ag(kt,At):(xt.flags=xt.flags&-4097|2,I$3=!1,xg=xt)}}else{if(Dg(xt))throw Error(p$1(418));xt.flags=xt.flags&-4097|2,I$3=!1,xg=xt}}}function Fg(xt){for(xt=xt.return;xt!==null&&xt.tag!==5&&xt.tag!==3&&xt.tag!==13;)xt=xt.return;xg=xt}function Gg(xt){if(xt!==xg)return!1;if(!I$3)return Fg(xt),I$3=!0,!1;var e;if((e=xt.tag!==3)&&!(e=xt.tag!==5)&&(e=xt.type,e=e!=="head"&&e!=="body"&&!Ef(xt.type,xt.memoizedProps)),e&&(e=yg)){if(Dg(xt))throw Hg(),Error(p$1(418));for(;e;)Ag(xt,e),e=Lf(e.nextSibling)}if(Fg(xt),xt.tag===13){if(xt=xt.memoizedState,xt=xt!==null?xt.dehydrated:null,!xt)throw Error(p$1(317));e:{for(xt=xt.nextSibling,e=0;xt;){if(xt.nodeType===8){var At=xt.data;if(At==="/$"){if(e===0){yg=Lf(xt.nextSibling);break e}e--}else At!=="$"&&At!=="$!"&&At!=="$?"||e++}xt=xt.nextSibling}yg=null}}else yg=xg?Lf(xt.stateNode.nextSibling):null;return!0}function Hg(){for(var xt=yg;xt;)xt=Lf(xt.nextSibling)}function Ig(){yg=xg=null,I$3=!1}function Jg(xt){zg===null?zg=[xt]:zg.push(xt)}var Kg=ua.ReactCurrentBatchConfig;function Lg(xt,e,At){if(xt=At.ref,xt!==null&&typeof xt!="function"&&typeof xt!="object"){if(At._owner){if(At=At._owner,At){if(At.tag!==1)throw Error(p$1(309));var kt=At.stateNode}if(!kt)throw Error(p$1(147,xt));var Bt=kt,Nt=""+xt;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===Nt?e.ref:(e=function(jt){var Lt=Bt.refs;jt===null?delete Lt[Nt]:Lt[Nt]=jt},e._stringRef=Nt,e)}if(typeof xt!="string")throw Error(p$1(284));if(!At._owner)throw Error(p$1(290,xt))}return xt}function Mg(xt,e){throw xt=Object.prototype.toString.call(e),Error(p$1(31,xt==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":xt))}function Ng(xt){var e=xt._init;return e(xt._payload)}function Og(xt){function e(fr,pr){if(xt){var lr=fr.deletions;lr===null?(fr.deletions=[pr],fr.flags|=16):lr.push(pr)}}function At(fr,pr){if(!xt)return null;for(;pr!==null;)e(fr,pr),pr=pr.sibling;return null}function kt(fr,pr){for(fr=new Map;pr!==null;)pr.key!==null?fr.set(pr.key,pr):fr.set(pr.index,pr),pr=pr.sibling;return fr}function Bt(fr,pr){return fr=Pg(fr,pr),fr.index=0,fr.sibling=null,fr}function Nt(fr,pr,lr){return fr.index=lr,xt?(lr=fr.alternate,lr!==null?(lr=lr.index,lr<pr?(fr.flags|=2,pr):lr):(fr.flags|=2,pr)):(fr.flags|=1048576,pr)}function jt(fr){return xt&&fr.alternate===null&&(fr.flags|=2),fr}function Lt(fr,pr,lr,yr){return pr===null||pr.tag!==6?(pr=Qg(lr,fr.mode,yr),pr.return=fr,pr):(pr=Bt(pr,lr),pr.return=fr,pr)}function er(fr,pr,lr,yr){var br=lr.type;return br===ya?zt(fr,pr,lr.props.children,yr,lr.key):pr!==null&&(pr.elementType===br||typeof br=="object"&&br!==null&&br.$$typeof===Ha&&Ng(br)===pr.type)?(yr=Bt(pr,lr.props),yr.ref=Lg(fr,pr,lr),yr.return=fr,yr):(yr=Rg(lr.type,lr.key,lr.props,null,fr.mode,yr),yr.ref=Lg(fr,pr,lr),yr.return=fr,yr)}function tr(fr,pr,lr,yr){return pr===null||pr.tag!==4||pr.stateNode.containerInfo!==lr.containerInfo||pr.stateNode.implementation!==lr.implementation?(pr=Sg(lr,fr.mode,yr),pr.return=fr,pr):(pr=Bt(pr,lr.children||[]),pr.return=fr,pr)}function zt(fr,pr,lr,yr,br){return pr===null||pr.tag!==7?(pr=Tg(lr,fr.mode,yr,br),pr.return=fr,pr):(pr=Bt(pr,lr),pr.return=fr,pr)}function rr(fr,pr,lr){if(typeof pr=="string"&&pr!==""||typeof pr=="number")return pr=Qg(""+pr,fr.mode,lr),pr.return=fr,pr;if(typeof pr=="object"&&pr!==null){switch(pr.$$typeof){case va:return lr=Rg(pr.type,pr.key,pr.props,null,fr.mode,lr),lr.ref=Lg(fr,null,pr),lr.return=fr,lr;case wa:return pr=Sg(pr,fr.mode,lr),pr.return=fr,pr;case Ha:var yr=pr._init;return rr(fr,yr(pr._payload),lr)}if(eb(pr)||Ka(pr))return pr=Tg(pr,fr.mode,lr,null),pr.return=fr,pr;Mg(fr,pr)}return null}function nr(fr,pr,lr,yr){var br=pr!==null?pr.key:null;if(typeof lr=="string"&&lr!==""||typeof lr=="number")return br!==null?null:Lt(fr,pr,""+lr,yr);if(typeof lr=="object"&&lr!==null){switch(lr.$$typeof){case va:return lr.key===br?er(fr,pr,lr,yr):null;case wa:return lr.key===br?tr(fr,pr,lr,yr):null;case Ha:return br=lr._init,nr(fr,pr,br(lr._payload),yr)}if(eb(lr)||Ka(lr))return br!==null?null:zt(fr,pr,lr,yr,null);Mg(fr,lr)}return null}function ir(fr,pr,lr,yr,br){if(typeof yr=="string"&&yr!==""||typeof yr=="number")return fr=fr.get(lr)||null,Lt(pr,fr,""+yr,br);if(typeof yr=="object"&&yr!==null){switch(yr.$$typeof){case va:return fr=fr.get(yr.key===null?lr:yr.key)||null,er(pr,fr,yr,br);case wa:return fr=fr.get(yr.key===null?lr:yr.key)||null,tr(pr,fr,yr,br);case Ha:var Ar=yr._init;return ir(fr,pr,lr,Ar(yr._payload),br)}if(eb(yr)||Ka(yr))return fr=fr.get(lr)||null,zt(pr,fr,yr,br,null);Mg(pr,yr)}return null}function ar(fr,pr,lr,yr){for(var br=null,Ar=null,Pr=pr,kr=pr=0,Ur=null;Pr!==null&&kr<lr.length;kr++){Pr.index>kr?(Ur=Pr,Pr=null):Ur=Pr.sibling;var Hr=nr(fr,Pr,lr[kr],yr);if(Hr===null){Pr===null&&(Pr=Ur);break}xt&&Pr&&Hr.alternate===null&&e(fr,Pr),pr=Nt(Hr,pr,kr),Ar===null?br=Hr:Ar.sibling=Hr,Ar=Hr,Pr=Ur}if(kr===lr.length)return At(fr,Pr),I$3&&tg(fr,kr),br;if(Pr===null){for(;kr<lr.length;kr++)Pr=rr(fr,lr[kr],yr),Pr!==null&&(pr=Nt(Pr,pr,kr),Ar===null?br=Pr:Ar.sibling=Pr,Ar=Pr);return I$3&&tg(fr,kr),br}for(Pr=kt(fr,Pr);kr<lr.length;kr++)Ur=ir(Pr,fr,kr,lr[kr],yr),Ur!==null&&(xt&&Ur.alternate!==null&&Pr.delete(Ur.key===null?kr:Ur.key),pr=Nt(Ur,pr,kr),Ar===null?br=Ur:Ar.sibling=Ur,Ar=Ur);return xt&&Pr.forEach(function(Lr){return e(fr,Lr)}),I$3&&tg(fr,kr),br}function dr(fr,pr,lr,yr){var br=Ka(lr);if(typeof br!="function")throw Error(p$1(150));if(lr=br.call(lr),lr==null)throw Error(p$1(151));for(var Ar=br=null,Pr=pr,kr=pr=0,Ur=null,Hr=lr.next();Pr!==null&&!Hr.done;kr++,Hr=lr.next()){Pr.index>kr?(Ur=Pr,Pr=null):Ur=Pr.sibling;var Lr=nr(fr,Pr,Hr.value,yr);if(Lr===null){Pr===null&&(Pr=Ur);break}xt&&Pr&&Lr.alternate===null&&e(fr,Pr),pr=Nt(Lr,pr,kr),Ar===null?br=Lr:Ar.sibling=Lr,Ar=Lr,Pr=Ur}if(Hr.done)return At(fr,Pr),I$3&&tg(fr,kr),br;if(Pr===null){for(;!Hr.done;kr++,Hr=lr.next())Hr=rr(fr,Hr.value,yr),Hr!==null&&(pr=Nt(Hr,pr,kr),Ar===null?br=Hr:Ar.sibling=Hr,Ar=Hr);return I$3&&tg(fr,kr),br}for(Pr=kt(fr,Pr);!Hr.done;kr++,Hr=lr.next())Hr=ir(Pr,fr,kr,Hr.value,yr),Hr!==null&&(xt&&Hr.alternate!==null&&Pr.delete(Hr.key===null?kr:Hr.key),pr=Nt(Hr,pr,kr),Ar===null?br=Hr:Ar.sibling=Hr,Ar=Hr);return xt&&Pr.forEach(function(Sr){return e(fr,Sr)}),I$3&&tg(fr,kr),br}function ur(fr,pr,lr,yr){if(typeof lr=="object"&&lr!==null&&lr.type===ya&&lr.key===null&&(lr=lr.props.children),typeof lr=="object"&&lr!==null){switch(lr.$$typeof){case va:e:{for(var br=lr.key,Ar=pr;Ar!==null;){if(Ar.key===br){if(br=lr.type,br===ya){if(Ar.tag===7){At(fr,Ar.sibling),pr=Bt(Ar,lr.props.children),pr.return=fr,fr=pr;break e}}else if(Ar.elementType===br||typeof br=="object"&&br!==null&&br.$$typeof===Ha&&Ng(br)===Ar.type){At(fr,Ar.sibling),pr=Bt(Ar,lr.props),pr.ref=Lg(fr,Ar,lr),pr.return=fr,fr=pr;break e}At(fr,Ar);break}else e(fr,Ar);Ar=Ar.sibling}lr.type===ya?(pr=Tg(lr.props.children,fr.mode,yr,lr.key),pr.return=fr,fr=pr):(yr=Rg(lr.type,lr.key,lr.props,null,fr.mode,yr),yr.ref=Lg(fr,pr,lr),yr.return=fr,fr=yr)}return jt(fr);case wa:e:{for(Ar=lr.key;pr!==null;){if(pr.key===Ar)if(pr.tag===4&&pr.stateNode.containerInfo===lr.containerInfo&&pr.stateNode.implementation===lr.implementation){At(fr,pr.sibling),pr=Bt(pr,lr.children||[]),pr.return=fr,fr=pr;break e}else{At(fr,pr);break}else e(fr,pr);pr=pr.sibling}pr=Sg(lr,fr.mode,yr),pr.return=fr,fr=pr}return jt(fr);case Ha:return Ar=lr._init,ur(fr,pr,Ar(lr._payload),yr)}if(eb(lr))return ar(fr,pr,lr,yr);if(Ka(lr))return dr(fr,pr,lr,yr);Mg(fr,lr)}return typeof lr=="string"&&lr!==""||typeof lr=="number"?(lr=""+lr,pr!==null&&pr.tag===6?(At(fr,pr.sibling),pr=Bt(pr,lr),pr.return=fr,fr=pr):(At(fr,pr),pr=Qg(lr,fr.mode,yr),pr.return=fr,fr=pr),jt(fr)):At(fr,pr)}return ur}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(xt){var e=Wg.current;E$4(Wg),xt._currentValue=e}function bh(xt,e,At){for(;xt!==null;){var kt=xt.alternate;if((xt.childLanes&e)!==e?(xt.childLanes|=e,kt!==null&&(kt.childLanes|=e)):kt!==null&&(kt.childLanes&e)!==e&&(kt.childLanes|=e),xt===At)break;xt=xt.return}}function ch$1(xt,e){Xg=xt,Zg=Yg=null,xt=xt.dependencies,xt!==null&&xt.firstContext!==null&&(xt.lanes&e&&(dh$1=!0),xt.firstContext=null)}function eh(xt){var e=xt._currentValue;if(Zg!==xt)if(xt={context:xt,memoizedValue:e,next:null},Yg===null){if(Xg===null)throw Error(p$1(308));Yg=xt,Xg.dependencies={lanes:0,firstContext:xt}}else Yg=Yg.next=xt;return e}var fh=null;function gh(xt){fh===null?fh=[xt]:fh.push(xt)}function hh(xt,e,At,kt){var Bt=e.interleaved;return Bt===null?(At.next=At,gh(e)):(At.next=Bt.next,Bt.next=At),e.interleaved=At,ih(xt,kt)}function ih(xt,e){xt.lanes|=e;var At=xt.alternate;for(At!==null&&(At.lanes|=e),At=xt,xt=xt.return;xt!==null;)xt.childLanes|=e,At=xt.alternate,At!==null&&(At.childLanes|=e),At=xt,xt=xt.return;return At.tag===3?At.stateNode:null}var jh=!1;function kh(xt){xt.updateQueue={baseState:xt.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(xt,e){xt=xt.updateQueue,e.updateQueue===xt&&(e.updateQueue={baseState:xt.baseState,firstBaseUpdate:xt.firstBaseUpdate,lastBaseUpdate:xt.lastBaseUpdate,shared:xt.shared,effects:xt.effects})}function mh(xt,e){return{eventTime:xt,lane:e,tag:0,payload:null,callback:null,next:null}}function nh(xt,e,At){var kt=xt.updateQueue;if(kt===null)return null;if(kt=kt.shared,K$6&2){var Bt=kt.pending;return Bt===null?e.next=e:(e.next=Bt.next,Bt.next=e),kt.pending=e,ih(xt,At)}return Bt=kt.interleaved,Bt===null?(e.next=e,gh(kt)):(e.next=Bt.next,Bt.next=e),kt.interleaved=e,ih(xt,At)}function oh(xt,e,At){if(e=e.updateQueue,e!==null&&(e=e.shared,(At&4194240)!==0)){var kt=e.lanes;kt&=xt.pendingLanes,At|=kt,e.lanes=At,Cc(xt,At)}}function ph(xt,e){var At=xt.updateQueue,kt=xt.alternate;if(kt!==null&&(kt=kt.updateQueue,At===kt)){var Bt=null,Nt=null;if(At=At.firstBaseUpdate,At!==null){do{var jt={eventTime:At.eventTime,lane:At.lane,tag:At.tag,payload:At.payload,callback:At.callback,next:null};Nt===null?Bt=Nt=jt:Nt=Nt.next=jt,At=At.next}while(At!==null);Nt===null?Bt=Nt=e:Nt=Nt.next=e}else Bt=Nt=e;At={baseState:kt.baseState,firstBaseUpdate:Bt,lastBaseUpdate:Nt,shared:kt.shared,effects:kt.effects},xt.updateQueue=At;return}xt=At.lastBaseUpdate,xt===null?At.firstBaseUpdate=e:xt.next=e,At.lastBaseUpdate=e}function qh(xt,e,At,kt){var Bt=xt.updateQueue;jh=!1;var Nt=Bt.firstBaseUpdate,jt=Bt.lastBaseUpdate,Lt=Bt.shared.pending;if(Lt!==null){Bt.shared.pending=null;var er=Lt,tr=er.next;er.next=null,jt===null?Nt=tr:jt.next=tr,jt=er;var zt=xt.alternate;zt!==null&&(zt=zt.updateQueue,Lt=zt.lastBaseUpdate,Lt!==jt&&(Lt===null?zt.firstBaseUpdate=tr:Lt.next=tr,zt.lastBaseUpdate=er))}if(Nt!==null){var rr=Bt.baseState;jt=0,zt=tr=er=null,Lt=Nt;do{var nr=Lt.lane,ir=Lt.eventTime;if((kt&nr)===nr){zt!==null&&(zt=zt.next={eventTime:ir,lane:0,tag:Lt.tag,payload:Lt.payload,callback:Lt.callback,next:null});e:{var ar=xt,dr=Lt;switch(nr=e,ir=At,dr.tag){case 1:if(ar=dr.payload,typeof ar=="function"){rr=ar.call(ir,rr,nr);break e}rr=ar;break e;case 3:ar.flags=ar.flags&-65537|128;case 0:if(ar=dr.payload,nr=typeof ar=="function"?ar.call(ir,rr,nr):ar,nr==null)break e;rr=A$1({},rr,nr);break e;case 2:jh=!0}}Lt.callback!==null&&Lt.lane!==0&&(xt.flags|=64,nr=Bt.effects,nr===null?Bt.effects=[Lt]:nr.push(Lt))}else ir={eventTime:ir,lane:nr,tag:Lt.tag,payload:Lt.payload,callback:Lt.callback,next:null},zt===null?(tr=zt=ir,er=rr):zt=zt.next=ir,jt|=nr;if(Lt=Lt.next,Lt===null){if(Lt=Bt.shared.pending,Lt===null)break;nr=Lt,Lt=nr.next,nr.next=null,Bt.lastBaseUpdate=nr,Bt.shared.pending=null}}while(!0);if(zt===null&&(er=rr),Bt.baseState=er,Bt.firstBaseUpdate=tr,Bt.lastBaseUpdate=zt,e=Bt.shared.interleaved,e!==null){Bt=e;do jt|=Bt.lane,Bt=Bt.next;while(Bt!==e)}else Nt===null&&(Bt.shared.lanes=0);rh$1|=jt,xt.lanes=jt,xt.memoizedState=rr}}function sh$1(xt,e,At){if(xt=e.effects,e.effects=null,xt!==null)for(e=0;e<xt.length;e++){var kt=xt[e],Bt=kt.callback;if(Bt!==null){if(kt.callback=null,kt=At,typeof Bt!="function")throw Error(p$1(191,Bt));Bt.call(kt)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(xt){if(xt===th)throw Error(p$1(174));return xt}function yh(xt,e){switch(G$4(wh,e),G$4(vh,xt),G$4(uh,th),xt=e.nodeType,xt){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lb(null,"");break;default:xt=xt===8?e.parentNode:e,e=xt.namespaceURI||null,xt=xt.tagName,e=lb(e,xt)}E$4(uh),G$4(uh,e)}function zh(){E$4(uh),E$4(vh),E$4(wh)}function Ah(xt){xh(wh.current);var e=xh(uh.current),At=lb(e,xt.type);e!==At&&(G$4(vh,xt),G$4(uh,At))}function Bh(xt){vh.current===xt&&(E$4(uh),E$4(vh))}var L$2=Uf(0);function Ch$1(xt){for(var e=xt;e!==null;){if(e.tag===13){var At=e.memoizedState;if(At!==null&&(At=At.dehydrated,At===null||At.data==="$?"||At.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===xt)break;for(;e.sibling===null;){if(e.return===null||e.return===xt)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Dh=[];function Eh(){for(var xt=0;xt<Dh.length;xt++)Dh[xt]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N$3=null,O$1=null,Ih=!1,Jh=!1,Kh$1=0,Lh=0;function P$4(){throw Error(p$1(321))}function Mh(xt,e){if(e===null)return!1;for(var At=0;At<e.length&&At<xt.length;At++)if(!He$1(xt[At],e[At]))return!1;return!0}function Nh(xt,e,At,kt,Bt,Nt){if(Hh=Nt,M$1=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Fh.current=xt===null||xt.memoizedState===null?Oh:Ph,xt=At(kt,Bt),Jh){Nt=0;do{if(Jh=!1,Kh$1=0,25<=Nt)throw Error(p$1(301));Nt+=1,O$1=N$3=null,e.updateQueue=null,Fh.current=Qh,xt=At(kt,Bt)}while(Jh)}if(Fh.current=Rh,e=N$3!==null&&N$3.next!==null,Hh=0,O$1=N$3=M$1=null,Ih=!1,e)throw Error(p$1(300));return xt}function Sh(){var xt=Kh$1!==0;return Kh$1=0,xt}function Th(){var xt={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O$1===null?M$1.memoizedState=O$1=xt:O$1=O$1.next=xt,O$1}function Uh(){if(N$3===null){var xt=M$1.alternate;xt=xt!==null?xt.memoizedState:null}else xt=N$3.next;var e=O$1===null?M$1.memoizedState:O$1.next;if(e!==null)O$1=e,N$3=xt;else{if(xt===null)throw Error(p$1(310));N$3=xt,xt={memoizedState:N$3.memoizedState,baseState:N$3.baseState,baseQueue:N$3.baseQueue,queue:N$3.queue,next:null},O$1===null?M$1.memoizedState=O$1=xt:O$1=O$1.next=xt}return O$1}function Vh(xt,e){return typeof e=="function"?e(xt):e}function Wh(xt){var e=Uh(),At=e.queue;if(At===null)throw Error(p$1(311));At.lastRenderedReducer=xt;var kt=N$3,Bt=kt.baseQueue,Nt=At.pending;if(Nt!==null){if(Bt!==null){var jt=Bt.next;Bt.next=Nt.next,Nt.next=jt}kt.baseQueue=Bt=Nt,At.pending=null}if(Bt!==null){Nt=Bt.next,kt=kt.baseState;var Lt=jt=null,er=null,tr=Nt;do{var zt=tr.lane;if((Hh&zt)===zt)er!==null&&(er=er.next={lane:0,action:tr.action,hasEagerState:tr.hasEagerState,eagerState:tr.eagerState,next:null}),kt=tr.hasEagerState?tr.eagerState:xt(kt,tr.action);else{var rr={lane:zt,action:tr.action,hasEagerState:tr.hasEagerState,eagerState:tr.eagerState,next:null};er===null?(Lt=er=rr,jt=kt):er=er.next=rr,M$1.lanes|=zt,rh$1|=zt}tr=tr.next}while(tr!==null&&tr!==Nt);er===null?jt=kt:er.next=Lt,He$1(kt,e.memoizedState)||(dh$1=!0),e.memoizedState=kt,e.baseState=jt,e.baseQueue=er,At.lastRenderedState=kt}if(xt=At.interleaved,xt!==null){Bt=xt;do Nt=Bt.lane,M$1.lanes|=Nt,rh$1|=Nt,Bt=Bt.next;while(Bt!==xt)}else Bt===null&&(At.lanes=0);return[e.memoizedState,At.dispatch]}function Xh(xt){var e=Uh(),At=e.queue;if(At===null)throw Error(p$1(311));At.lastRenderedReducer=xt;var kt=At.dispatch,Bt=At.pending,Nt=e.memoizedState;if(Bt!==null){At.pending=null;var jt=Bt=Bt.next;do Nt=xt(Nt,jt.action),jt=jt.next;while(jt!==Bt);He$1(Nt,e.memoizedState)||(dh$1=!0),e.memoizedState=Nt,e.baseQueue===null&&(e.baseState=Nt),At.lastRenderedState=Nt}return[Nt,kt]}function Yh(){}function Zh(xt,e){var At=M$1,kt=Uh(),Bt=e(),Nt=!He$1(kt.memoizedState,Bt);if(Nt&&(kt.memoizedState=Bt,dh$1=!0),kt=kt.queue,$h(ai.bind(null,At,kt,xt),[xt]),kt.getSnapshot!==e||Nt||O$1!==null&&O$1.memoizedState.tag&1){if(At.flags|=2048,bi(9,ci.bind(null,At,kt,Bt,e),void 0,null),Q$1===null)throw Error(p$1(349));Hh&30||di(At,e,Bt)}return Bt}function di(xt,e,At){xt.flags|=16384,xt={getSnapshot:e,value:At},e=M$1.updateQueue,e===null?(e={lastEffect:null,stores:null},M$1.updateQueue=e,e.stores=[xt]):(At=e.stores,At===null?e.stores=[xt]:At.push(xt))}function ci(xt,e,At,kt){e.value=At,e.getSnapshot=kt,ei(e)&&fi(xt)}function ai(xt,e,At){return At(function(){ei(e)&&fi(xt)})}function ei(xt){var e=xt.getSnapshot;xt=xt.value;try{var At=e();return!He$1(xt,At)}catch{return!0}}function fi(xt){var e=ih(xt,1);e!==null&&gi(e,xt,1,-1)}function hi(xt){var e=Th();return typeof xt=="function"&&(xt=xt()),e.memoizedState=e.baseState=xt,xt={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:xt},e.queue=xt,xt=xt.dispatch=ii.bind(null,M$1,xt),[e.memoizedState,xt]}function bi(xt,e,At,kt){return xt={tag:xt,create:e,destroy:At,deps:kt,next:null},e=M$1.updateQueue,e===null?(e={lastEffect:null,stores:null},M$1.updateQueue=e,e.lastEffect=xt.next=xt):(At=e.lastEffect,At===null?e.lastEffect=xt.next=xt:(kt=At.next,At.next=xt,xt.next=kt,e.lastEffect=xt)),xt}function ji(){return Uh().memoizedState}function ki(xt,e,At,kt){var Bt=Th();M$1.flags|=xt,Bt.memoizedState=bi(1|e,At,void 0,kt===void 0?null:kt)}function li(xt,e,At,kt){var Bt=Uh();kt=kt===void 0?null:kt;var Nt=void 0;if(N$3!==null){var jt=N$3.memoizedState;if(Nt=jt.destroy,kt!==null&&Mh(kt,jt.deps)){Bt.memoizedState=bi(e,At,Nt,kt);return}}M$1.flags|=xt,Bt.memoizedState=bi(1|e,At,Nt,kt)}function mi(xt,e){return ki(8390656,8,xt,e)}function $h(xt,e){return li(2048,8,xt,e)}function ni(xt,e){return li(4,2,xt,e)}function oi(xt,e){return li(4,4,xt,e)}function pi(xt,e){if(typeof e=="function")return xt=xt(),e(xt),function(){e(null)};if(e!=null)return xt=xt(),e.current=xt,function(){e.current=null}}function qi(xt,e,At){return At=At!=null?At.concat([xt]):null,li(4,4,pi.bind(null,e,xt),At)}function ri(){}function si(xt,e){var At=Uh();e=e===void 0?null:e;var kt=At.memoizedState;return kt!==null&&e!==null&&Mh(e,kt[1])?kt[0]:(At.memoizedState=[xt,e],xt)}function ti(xt,e){var At=Uh();e=e===void 0?null:e;var kt=At.memoizedState;return kt!==null&&e!==null&&Mh(e,kt[1])?kt[0]:(xt=xt(),At.memoizedState=[xt,e],xt)}function ui(xt,e,At){return Hh&21?(He$1(At,e)||(At=yc(),M$1.lanes|=At,rh$1|=At,xt.baseState=!0),e):(xt.baseState&&(xt.baseState=!1,dh$1=!0),xt.memoizedState=At)}function vi(xt,e){var At=C$1;C$1=At!==0&&4>At?At:4,xt(!0);var kt=Gh.transition;Gh.transition={};try{xt(!1),e()}finally{C$1=At,Gh.transition=kt}}function wi(){return Uh().memoizedState}function xi(xt,e,At){var kt=yi(xt);if(At={lane:kt,action:At,hasEagerState:!1,eagerState:null,next:null},zi(xt))Ai(e,At);else if(At=hh(xt,e,At,kt),At!==null){var Bt=R$2();gi(At,xt,kt,Bt),Bi(At,e,kt)}}function ii(xt,e,At){var kt=yi(xt),Bt={lane:kt,action:At,hasEagerState:!1,eagerState:null,next:null};if(zi(xt))Ai(e,Bt);else{var Nt=xt.alternate;if(xt.lanes===0&&(Nt===null||Nt.lanes===0)&&(Nt=e.lastRenderedReducer,Nt!==null))try{var jt=e.lastRenderedState,Lt=Nt(jt,At);if(Bt.hasEagerState=!0,Bt.eagerState=Lt,He$1(Lt,jt)){var er=e.interleaved;er===null?(Bt.next=Bt,gh(e)):(Bt.next=er.next,er.next=Bt),e.interleaved=Bt;return}}catch{}finally{}At=hh(xt,e,Bt,kt),At!==null&&(Bt=R$2(),gi(At,xt,kt,Bt),Bi(At,e,kt))}}function zi(xt){var e=xt.alternate;return xt===M$1||e!==null&&e===M$1}function Ai(xt,e){Jh=Ih=!0;var At=xt.pending;At===null?e.next=e:(e.next=At.next,At.next=e),xt.pending=e}function Bi(xt,e,At){if(At&4194240){var kt=e.lanes;kt&=xt.pendingLanes,At|=kt,e.lanes=At,Cc(xt,At)}}var Rh={readContext:eh,useCallback:P$4,useContext:P$4,useEffect:P$4,useImperativeHandle:P$4,useInsertionEffect:P$4,useLayoutEffect:P$4,useMemo:P$4,useReducer:P$4,useRef:P$4,useState:P$4,useDebugValue:P$4,useDeferredValue:P$4,useTransition:P$4,useMutableSource:P$4,useSyncExternalStore:P$4,useId:P$4,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(xt,e){return Th().memoizedState=[xt,e===void 0?null:e],xt},useContext:eh,useEffect:mi,useImperativeHandle:function(xt,e,At){return At=At!=null?At.concat([xt]):null,ki(4194308,4,pi.bind(null,e,xt),At)},useLayoutEffect:function(xt,e){return ki(4194308,4,xt,e)},useInsertionEffect:function(xt,e){return ki(4,2,xt,e)},useMemo:function(xt,e){var At=Th();return e=e===void 0?null:e,xt=xt(),At.memoizedState=[xt,e],xt},useReducer:function(xt,e,At){var kt=Th();return e=At!==void 0?At(e):e,kt.memoizedState=kt.baseState=e,xt={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xt,lastRenderedState:e},kt.queue=xt,xt=xt.dispatch=xi.bind(null,M$1,xt),[kt.memoizedState,xt]},useRef:function(xt){var e=Th();return xt={current:xt},e.memoizedState=xt},useState:hi,useDebugValue:ri,useDeferredValue:function(xt){return Th().memoizedState=xt},useTransition:function(){var xt=hi(!1),e=xt[0];return xt=vi.bind(null,xt[1]),Th().memoizedState=xt,[e,xt]},useMutableSource:function(){},useSyncExternalStore:function(xt,e,At){var kt=M$1,Bt=Th();if(I$3){if(At===void 0)throw Error(p$1(407));At=At()}else{if(At=e(),Q$1===null)throw Error(p$1(349));Hh&30||di(kt,e,At)}Bt.memoizedState=At;var Nt={value:At,getSnapshot:e};return Bt.queue=Nt,mi(ai.bind(null,kt,Nt,xt),[xt]),kt.flags|=2048,bi(9,ci.bind(null,kt,Nt,At,e),void 0,null),At},useId:function(){var xt=Th(),e=Q$1.identifierPrefix;if(I$3){var At=sg,kt=rg;At=(kt&~(1<<32-oc(kt)-1)).toString(32)+At,e=":"+e+"R"+At,At=Kh$1++,0<At&&(e+="H"+At.toString(32)),e+=":"}else At=Lh++,e=":"+e+"r"+At.toString(32)+":";return xt.memoizedState=e},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(xt){var e=Uh();return ui(e,N$3.memoizedState,xt)},useTransition:function(){var xt=Wh(Vh)[0],e=Uh().memoizedState;return[xt,e]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(xt){var e=Uh();return N$3===null?e.memoizedState=xt:ui(e,N$3.memoizedState,xt)},useTransition:function(){var xt=Xh(Vh)[0],e=Uh().memoizedState;return[xt,e]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(xt,e){if(xt&&xt.defaultProps){e=A$1({},e),xt=xt.defaultProps;for(var At in xt)e[At]===void 0&&(e[At]=xt[At]);return e}return e}function Di(xt,e,At,kt){e=xt.memoizedState,At=At(kt,e),At=At==null?e:A$1({},e,At),xt.memoizedState=At,xt.lanes===0&&(xt.updateQueue.baseState=At)}var Ei={isMounted:function(xt){return(xt=xt._reactInternals)?Vb(xt)===xt:!1},enqueueSetState:function(xt,e,At){xt=xt._reactInternals;var kt=R$2(),Bt=yi(xt),Nt=mh(kt,Bt);Nt.payload=e,At!=null&&(Nt.callback=At),e=nh(xt,Nt,Bt),e!==null&&(gi(e,xt,Bt,kt),oh(e,xt,Bt))},enqueueReplaceState:function(xt,e,At){xt=xt._reactInternals;var kt=R$2(),Bt=yi(xt),Nt=mh(kt,Bt);Nt.tag=1,Nt.payload=e,At!=null&&(Nt.callback=At),e=nh(xt,Nt,Bt),e!==null&&(gi(e,xt,Bt,kt),oh(e,xt,Bt))},enqueueForceUpdate:function(xt,e){xt=xt._reactInternals;var At=R$2(),kt=yi(xt),Bt=mh(At,kt);Bt.tag=2,e!=null&&(Bt.callback=e),e=nh(xt,Bt,kt),e!==null&&(gi(e,xt,kt,At),oh(e,xt,kt))}};function Fi(xt,e,At,kt,Bt,Nt,jt){return xt=xt.stateNode,typeof xt.shouldComponentUpdate=="function"?xt.shouldComponentUpdate(kt,Nt,jt):e.prototype&&e.prototype.isPureReactComponent?!Ie$1(At,kt)||!Ie$1(Bt,Nt):!0}function Gi(xt,e,At){var kt=!1,Bt=Vf,Nt=e.contextType;return typeof Nt=="object"&&Nt!==null?Nt=eh(Nt):(Bt=Zf(e)?Xf:H$1.current,kt=e.contextTypes,Nt=(kt=kt!=null)?Yf(xt,Bt):Vf),e=new e(At,Nt),xt.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ei,xt.stateNode=e,e._reactInternals=xt,kt&&(xt=xt.stateNode,xt.__reactInternalMemoizedUnmaskedChildContext=Bt,xt.__reactInternalMemoizedMaskedChildContext=Nt),e}function Hi(xt,e,At,kt){xt=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(At,kt),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(At,kt),e.state!==xt&&Ei.enqueueReplaceState(e,e.state,null)}function Ii(xt,e,At,kt){var Bt=xt.stateNode;Bt.props=At,Bt.state=xt.memoizedState,Bt.refs={},kh(xt);var Nt=e.contextType;typeof Nt=="object"&&Nt!==null?Bt.context=eh(Nt):(Nt=Zf(e)?Xf:H$1.current,Bt.context=Yf(xt,Nt)),Bt.state=xt.memoizedState,Nt=e.getDerivedStateFromProps,typeof Nt=="function"&&(Di(xt,e,Nt,At),Bt.state=xt.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof Bt.getSnapshotBeforeUpdate=="function"||typeof Bt.UNSAFE_componentWillMount!="function"&&typeof Bt.componentWillMount!="function"||(e=Bt.state,typeof Bt.componentWillMount=="function"&&Bt.componentWillMount(),typeof Bt.UNSAFE_componentWillMount=="function"&&Bt.UNSAFE_componentWillMount(),e!==Bt.state&&Ei.enqueueReplaceState(Bt,Bt.state,null),qh(xt,At,Bt,kt),Bt.state=xt.memoizedState),typeof Bt.componentDidMount=="function"&&(xt.flags|=4194308)}function Ji(xt,e){try{var At="",kt=e;do At+=Pa(kt),kt=kt.return;while(kt);var Bt=At}catch(Nt){Bt=`
Error generating stack: `+Nt.message+`
`+Nt.stack}return{value:xt,source:e,stack:Bt,digest:null}}function Ki(xt,e,At){return{value:xt,source:null,stack:At??null,digest:e??null}}function Li(xt,e){try{console.error(e.value)}catch(At){setTimeout(function(){throw At})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(xt,e,At){At=mh(-1,At),At.tag=3,At.payload={element:null};var kt=e.value;return At.callback=function(){Oi||(Oi=!0,Pi$1=kt),Li(xt,e)},At}function Qi(xt,e,At){At=mh(-1,At),At.tag=3;var kt=xt.type.getDerivedStateFromError;if(typeof kt=="function"){var Bt=e.value;At.payload=function(){return kt(Bt)},At.callback=function(){Li(xt,e)}}var Nt=xt.stateNode;return Nt!==null&&typeof Nt.componentDidCatch=="function"&&(At.callback=function(){Li(xt,e),typeof kt!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var jt=e.stack;this.componentDidCatch(e.value,{componentStack:jt!==null?jt:""})}),At}function Si(xt,e,At){var kt=xt.pingCache;if(kt===null){kt=xt.pingCache=new Mi;var Bt=new Set;kt.set(e,Bt)}else Bt=kt.get(e),Bt===void 0&&(Bt=new Set,kt.set(e,Bt));Bt.has(At)||(Bt.add(At),xt=Ti.bind(null,xt,e,At),e.then(xt,xt))}function Ui(xt){do{var e;if((e=xt.tag===13)&&(e=xt.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return xt;xt=xt.return}while(xt!==null);return null}function Vi(xt,e,At,kt,Bt){return xt.mode&1?(xt.flags|=65536,xt.lanes=Bt,xt):(xt===e?xt.flags|=65536:(xt.flags|=128,At.flags|=131072,At.flags&=-52805,At.tag===1&&(At.alternate===null?At.tag=17:(e=mh(-1,1),e.tag=2,nh(At,e,1))),At.lanes|=1),xt)}var Wi=ua.ReactCurrentOwner,dh$1=!1;function Xi(xt,e,At,kt){e.child=xt===null?Vg(e,null,At,kt):Ug(e,xt.child,At,kt)}function Yi(xt,e,At,kt,Bt){At=At.render;var Nt=e.ref;return ch$1(e,Bt),kt=Nh(xt,e,At,kt,Nt,Bt),At=Sh(),xt!==null&&!dh$1?(e.updateQueue=xt.updateQueue,e.flags&=-2053,xt.lanes&=~Bt,Zi(xt,e,Bt)):(I$3&&At&&vg(e),e.flags|=1,Xi(xt,e,kt,Bt),e.child)}function $i(xt,e,At,kt,Bt){if(xt===null){var Nt=At.type;return typeof Nt=="function"&&!aj(Nt)&&Nt.defaultProps===void 0&&At.compare===null&&At.defaultProps===void 0?(e.tag=15,e.type=Nt,bj(xt,e,Nt,kt,Bt)):(xt=Rg(At.type,null,kt,e,e.mode,Bt),xt.ref=e.ref,xt.return=e,e.child=xt)}if(Nt=xt.child,!(xt.lanes&Bt)){var jt=Nt.memoizedProps;if(At=At.compare,At=At!==null?At:Ie$1,At(jt,kt)&&xt.ref===e.ref)return Zi(xt,e,Bt)}return e.flags|=1,xt=Pg(Nt,kt),xt.ref=e.ref,xt.return=e,e.child=xt}function bj(xt,e,At,kt,Bt){if(xt!==null){var Nt=xt.memoizedProps;if(Ie$1(Nt,kt)&&xt.ref===e.ref)if(dh$1=!1,e.pendingProps=kt=Nt,(xt.lanes&Bt)!==0)xt.flags&131072&&(dh$1=!0);else return e.lanes=xt.lanes,Zi(xt,e,Bt)}return cj(xt,e,At,kt,Bt)}function dj(xt,e,At){var kt=e.pendingProps,Bt=kt.children,Nt=xt!==null?xt.memoizedState:null;if(kt.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$4(ej,fj),fj|=At;else{if(!(At&1073741824))return xt=Nt!==null?Nt.baseLanes|At:At,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:xt,cachePool:null,transitions:null},e.updateQueue=null,G$4(ej,fj),fj|=xt,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},kt=Nt!==null?Nt.baseLanes:At,G$4(ej,fj),fj|=kt}else Nt!==null?(kt=Nt.baseLanes|At,e.memoizedState=null):kt=At,G$4(ej,fj),fj|=kt;return Xi(xt,e,Bt,At),e.child}function gj(xt,e){var At=e.ref;(xt===null&&At!==null||xt!==null&&xt.ref!==At)&&(e.flags|=512,e.flags|=2097152)}function cj(xt,e,At,kt,Bt){var Nt=Zf(At)?Xf:H$1.current;return Nt=Yf(e,Nt),ch$1(e,Bt),At=Nh(xt,e,At,kt,Nt,Bt),kt=Sh(),xt!==null&&!dh$1?(e.updateQueue=xt.updateQueue,e.flags&=-2053,xt.lanes&=~Bt,Zi(xt,e,Bt)):(I$3&&kt&&vg(e),e.flags|=1,Xi(xt,e,At,Bt),e.child)}function hj(xt,e,At,kt,Bt){if(Zf(At)){var Nt=!0;cg(e)}else Nt=!1;if(ch$1(e,Bt),e.stateNode===null)ij(xt,e),Gi(e,At,kt),Ii(e,At,kt,Bt),kt=!0;else if(xt===null){var jt=e.stateNode,Lt=e.memoizedProps;jt.props=Lt;var er=jt.context,tr=At.contextType;typeof tr=="object"&&tr!==null?tr=eh(tr):(tr=Zf(At)?Xf:H$1.current,tr=Yf(e,tr));var zt=At.getDerivedStateFromProps,rr=typeof zt=="function"||typeof jt.getSnapshotBeforeUpdate=="function";rr||typeof jt.UNSAFE_componentWillReceiveProps!="function"&&typeof jt.componentWillReceiveProps!="function"||(Lt!==kt||er!==tr)&&Hi(e,jt,kt,tr),jh=!1;var nr=e.memoizedState;jt.state=nr,qh(e,kt,jt,Bt),er=e.memoizedState,Lt!==kt||nr!==er||Wf.current||jh?(typeof zt=="function"&&(Di(e,At,zt,kt),er=e.memoizedState),(Lt=jh||Fi(e,At,Lt,kt,nr,er,tr))?(rr||typeof jt.UNSAFE_componentWillMount!="function"&&typeof jt.componentWillMount!="function"||(typeof jt.componentWillMount=="function"&&jt.componentWillMount(),typeof jt.UNSAFE_componentWillMount=="function"&&jt.UNSAFE_componentWillMount()),typeof jt.componentDidMount=="function"&&(e.flags|=4194308)):(typeof jt.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=kt,e.memoizedState=er),jt.props=kt,jt.state=er,jt.context=tr,kt=Lt):(typeof jt.componentDidMount=="function"&&(e.flags|=4194308),kt=!1)}else{jt=e.stateNode,lh(xt,e),Lt=e.memoizedProps,tr=e.type===e.elementType?Lt:Ci(e.type,Lt),jt.props=tr,rr=e.pendingProps,nr=jt.context,er=At.contextType,typeof er=="object"&&er!==null?er=eh(er):(er=Zf(At)?Xf:H$1.current,er=Yf(e,er));var ir=At.getDerivedStateFromProps;(zt=typeof ir=="function"||typeof jt.getSnapshotBeforeUpdate=="function")||typeof jt.UNSAFE_componentWillReceiveProps!="function"&&typeof jt.componentWillReceiveProps!="function"||(Lt!==rr||nr!==er)&&Hi(e,jt,kt,er),jh=!1,nr=e.memoizedState,jt.state=nr,qh(e,kt,jt,Bt);var ar=e.memoizedState;Lt!==rr||nr!==ar||Wf.current||jh?(typeof ir=="function"&&(Di(e,At,ir,kt),ar=e.memoizedState),(tr=jh||Fi(e,At,tr,kt,nr,ar,er)||!1)?(zt||typeof jt.UNSAFE_componentWillUpdate!="function"&&typeof jt.componentWillUpdate!="function"||(typeof jt.componentWillUpdate=="function"&&jt.componentWillUpdate(kt,ar,er),typeof jt.UNSAFE_componentWillUpdate=="function"&&jt.UNSAFE_componentWillUpdate(kt,ar,er)),typeof jt.componentDidUpdate=="function"&&(e.flags|=4),typeof jt.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof jt.componentDidUpdate!="function"||Lt===xt.memoizedProps&&nr===xt.memoizedState||(e.flags|=4),typeof jt.getSnapshotBeforeUpdate!="function"||Lt===xt.memoizedProps&&nr===xt.memoizedState||(e.flags|=1024),e.memoizedProps=kt,e.memoizedState=ar),jt.props=kt,jt.state=ar,jt.context=er,kt=tr):(typeof jt.componentDidUpdate!="function"||Lt===xt.memoizedProps&&nr===xt.memoizedState||(e.flags|=4),typeof jt.getSnapshotBeforeUpdate!="function"||Lt===xt.memoizedProps&&nr===xt.memoizedState||(e.flags|=1024),kt=!1)}return jj(xt,e,At,kt,Nt,Bt)}function jj(xt,e,At,kt,Bt,Nt){gj(xt,e);var jt=(e.flags&128)!==0;if(!kt&&!jt)return Bt&&dg(e,At,!1),Zi(xt,e,Nt);kt=e.stateNode,Wi.current=e;var Lt=jt&&typeof At.getDerivedStateFromError!="function"?null:kt.render();return e.flags|=1,xt!==null&&jt?(e.child=Ug(e,xt.child,null,Nt),e.child=Ug(e,null,Lt,Nt)):Xi(xt,e,Lt,Nt),e.memoizedState=kt.state,Bt&&dg(e,At,!0),e.child}function kj(xt){var e=xt.stateNode;e.pendingContext?ag(xt,e.pendingContext,e.pendingContext!==e.context):e.context&&ag(xt,e.context,!1),yh(xt,e.containerInfo)}function lj(xt,e,At,kt,Bt){return Ig(),Jg(Bt),e.flags|=256,Xi(xt,e,At,kt),e.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(xt){return{baseLanes:xt,cachePool:null,transitions:null}}function oj(xt,e,At){var kt=e.pendingProps,Bt=L$2.current,Nt=!1,jt=(e.flags&128)!==0,Lt;if((Lt=jt)||(Lt=xt!==null&&xt.memoizedState===null?!1:(Bt&2)!==0),Lt?(Nt=!0,e.flags&=-129):(xt===null||xt.memoizedState!==null)&&(Bt|=1),G$4(L$2,Bt&1),xt===null)return Eg(e),xt=e.memoizedState,xt!==null&&(xt=xt.dehydrated,xt!==null)?(e.mode&1?xt.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(jt=kt.children,xt=kt.fallback,Nt?(kt=e.mode,Nt=e.child,jt={mode:"hidden",children:jt},!(kt&1)&&Nt!==null?(Nt.childLanes=0,Nt.pendingProps=jt):Nt=pj(jt,kt,0,null),xt=Tg(xt,kt,At,null),Nt.return=e,xt.return=e,Nt.sibling=xt,e.child=Nt,e.child.memoizedState=nj(At),e.memoizedState=mj,xt):qj(e,jt));if(Bt=xt.memoizedState,Bt!==null&&(Lt=Bt.dehydrated,Lt!==null))return rj(xt,e,jt,kt,Lt,Bt,At);if(Nt){Nt=kt.fallback,jt=e.mode,Bt=xt.child,Lt=Bt.sibling;var er={mode:"hidden",children:kt.children};return!(jt&1)&&e.child!==Bt?(kt=e.child,kt.childLanes=0,kt.pendingProps=er,e.deletions=null):(kt=Pg(Bt,er),kt.subtreeFlags=Bt.subtreeFlags&14680064),Lt!==null?Nt=Pg(Lt,Nt):(Nt=Tg(Nt,jt,At,null),Nt.flags|=2),Nt.return=e,kt.return=e,kt.sibling=Nt,e.child=kt,kt=Nt,Nt=e.child,jt=xt.child.memoizedState,jt=jt===null?nj(At):{baseLanes:jt.baseLanes|At,cachePool:null,transitions:jt.transitions},Nt.memoizedState=jt,Nt.childLanes=xt.childLanes&~At,e.memoizedState=mj,kt}return Nt=xt.child,xt=Nt.sibling,kt=Pg(Nt,{mode:"visible",children:kt.children}),!(e.mode&1)&&(kt.lanes=At),kt.return=e,kt.sibling=null,xt!==null&&(At=e.deletions,At===null?(e.deletions=[xt],e.flags|=16):At.push(xt)),e.child=kt,e.memoizedState=null,kt}function qj(xt,e){return e=pj({mode:"visible",children:e},xt.mode,0,null),e.return=xt,xt.child=e}function sj(xt,e,At,kt){return kt!==null&&Jg(kt),Ug(e,xt.child,null,At),xt=qj(e,e.pendingProps.children),xt.flags|=2,e.memoizedState=null,xt}function rj(xt,e,At,kt,Bt,Nt,jt){if(At)return e.flags&256?(e.flags&=-257,kt=Ki(Error(p$1(422))),sj(xt,e,jt,kt)):e.memoizedState!==null?(e.child=xt.child,e.flags|=128,null):(Nt=kt.fallback,Bt=e.mode,kt=pj({mode:"visible",children:kt.children},Bt,0,null),Nt=Tg(Nt,Bt,jt,null),Nt.flags|=2,kt.return=e,Nt.return=e,kt.sibling=Nt,e.child=kt,e.mode&1&&Ug(e,xt.child,null,jt),e.child.memoizedState=nj(jt),e.memoizedState=mj,Nt);if(!(e.mode&1))return sj(xt,e,jt,null);if(Bt.data==="$!"){if(kt=Bt.nextSibling&&Bt.nextSibling.dataset,kt)var Lt=kt.dgst;return kt=Lt,Nt=Error(p$1(419)),kt=Ki(Nt,kt,void 0),sj(xt,e,jt,kt)}if(Lt=(jt&xt.childLanes)!==0,dh$1||Lt){if(kt=Q$1,kt!==null){switch(jt&-jt){case 4:Bt=2;break;case 16:Bt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Bt=32;break;case 536870912:Bt=268435456;break;default:Bt=0}Bt=Bt&(kt.suspendedLanes|jt)?0:Bt,Bt!==0&&Bt!==Nt.retryLane&&(Nt.retryLane=Bt,ih(xt,Bt),gi(kt,xt,Bt,-1))}return tj(),kt=Ki(Error(p$1(421))),sj(xt,e,jt,kt)}return Bt.data==="$?"?(e.flags|=128,e.child=xt.child,e=uj.bind(null,xt),Bt._reactRetry=e,null):(xt=Nt.treeContext,yg=Lf(Bt.nextSibling),xg=e,I$3=!0,zg=null,xt!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=xt.id,sg=xt.overflow,qg=e),e=qj(e,kt.children),e.flags|=4096,e)}function vj(xt,e,At){xt.lanes|=e;var kt=xt.alternate;kt!==null&&(kt.lanes|=e),bh(xt.return,e,At)}function wj(xt,e,At,kt,Bt){var Nt=xt.memoizedState;Nt===null?xt.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:kt,tail:At,tailMode:Bt}:(Nt.isBackwards=e,Nt.rendering=null,Nt.renderingStartTime=0,Nt.last=kt,Nt.tail=At,Nt.tailMode=Bt)}function xj(xt,e,At){var kt=e.pendingProps,Bt=kt.revealOrder,Nt=kt.tail;if(Xi(xt,e,kt.children,At),kt=L$2.current,kt&2)kt=kt&1|2,e.flags|=128;else{if(xt!==null&&xt.flags&128)e:for(xt=e.child;xt!==null;){if(xt.tag===13)xt.memoizedState!==null&&vj(xt,At,e);else if(xt.tag===19)vj(xt,At,e);else if(xt.child!==null){xt.child.return=xt,xt=xt.child;continue}if(xt===e)break e;for(;xt.sibling===null;){if(xt.return===null||xt.return===e)break e;xt=xt.return}xt.sibling.return=xt.return,xt=xt.sibling}kt&=1}if(G$4(L$2,kt),!(e.mode&1))e.memoizedState=null;else switch(Bt){case"forwards":for(At=e.child,Bt=null;At!==null;)xt=At.alternate,xt!==null&&Ch$1(xt)===null&&(Bt=At),At=At.sibling;At=Bt,At===null?(Bt=e.child,e.child=null):(Bt=At.sibling,At.sibling=null),wj(e,!1,Bt,At,Nt);break;case"backwards":for(At=null,Bt=e.child,e.child=null;Bt!==null;){if(xt=Bt.alternate,xt!==null&&Ch$1(xt)===null){e.child=Bt;break}xt=Bt.sibling,Bt.sibling=At,At=Bt,Bt=xt}wj(e,!0,At,null,Nt);break;case"together":wj(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ij(xt,e){!(e.mode&1)&&xt!==null&&(xt.alternate=null,e.alternate=null,e.flags|=2)}function Zi(xt,e,At){if(xt!==null&&(e.dependencies=xt.dependencies),rh$1|=e.lanes,!(At&e.childLanes))return null;if(xt!==null&&e.child!==xt.child)throw Error(p$1(153));if(e.child!==null){for(xt=e.child,At=Pg(xt,xt.pendingProps),e.child=At,At.return=e;xt.sibling!==null;)xt=xt.sibling,At=At.sibling=Pg(xt,xt.pendingProps),At.return=e;At.sibling=null}return e.child}function yj(xt,e,At){switch(e.tag){case 3:kj(e),Ig();break;case 5:Ah(e);break;case 1:Zf(e.type)&&cg(e);break;case 4:yh(e,e.stateNode.containerInfo);break;case 10:var kt=e.type._context,Bt=e.memoizedProps.value;G$4(Wg,kt._currentValue),kt._currentValue=Bt;break;case 13:if(kt=e.memoizedState,kt!==null)return kt.dehydrated!==null?(G$4(L$2,L$2.current&1),e.flags|=128,null):At&e.child.childLanes?oj(xt,e,At):(G$4(L$2,L$2.current&1),xt=Zi(xt,e,At),xt!==null?xt.sibling:null);G$4(L$2,L$2.current&1);break;case 19:if(kt=(At&e.childLanes)!==0,xt.flags&128){if(kt)return xj(xt,e,At);e.flags|=128}if(Bt=e.memoizedState,Bt!==null&&(Bt.rendering=null,Bt.tail=null,Bt.lastEffect=null),G$4(L$2,L$2.current),kt)break;return null;case 22:case 23:return e.lanes=0,dj(xt,e,At)}return Zi(xt,e,At)}var zj,Aj,Bj,Cj;zj=function(xt,e){for(var At=e.child;At!==null;){if(At.tag===5||At.tag===6)xt.appendChild(At.stateNode);else if(At.tag!==4&&At.child!==null){At.child.return=At,At=At.child;continue}if(At===e)break;for(;At.sibling===null;){if(At.return===null||At.return===e)return;At=At.return}At.sibling.return=At.return,At=At.sibling}};Aj=function(){};Bj=function(xt,e,At,kt){var Bt=xt.memoizedProps;if(Bt!==kt){xt=e.stateNode,xh(uh.current);var Nt=null;switch(At){case"input":Bt=Ya(xt,Bt),kt=Ya(xt,kt),Nt=[];break;case"select":Bt=A$1({},Bt,{value:void 0}),kt=A$1({},kt,{value:void 0}),Nt=[];break;case"textarea":Bt=gb(xt,Bt),kt=gb(xt,kt),Nt=[];break;default:typeof Bt.onClick!="function"&&typeof kt.onClick=="function"&&(xt.onclick=Bf)}ub(At,kt);var jt;At=null;for(tr in Bt)if(!kt.hasOwnProperty(tr)&&Bt.hasOwnProperty(tr)&&Bt[tr]!=null)if(tr==="style"){var Lt=Bt[tr];for(jt in Lt)Lt.hasOwnProperty(jt)&&(At||(At={}),At[jt]="")}else tr!=="dangerouslySetInnerHTML"&&tr!=="children"&&tr!=="suppressContentEditableWarning"&&tr!=="suppressHydrationWarning"&&tr!=="autoFocus"&&(ea.hasOwnProperty(tr)?Nt||(Nt=[]):(Nt=Nt||[]).push(tr,null));for(tr in kt){var er=kt[tr];if(Lt=Bt!=null?Bt[tr]:void 0,kt.hasOwnProperty(tr)&&er!==Lt&&(er!=null||Lt!=null))if(tr==="style")if(Lt){for(jt in Lt)!Lt.hasOwnProperty(jt)||er&&er.hasOwnProperty(jt)||(At||(At={}),At[jt]="");for(jt in er)er.hasOwnProperty(jt)&&Lt[jt]!==er[jt]&&(At||(At={}),At[jt]=er[jt])}else At||(Nt||(Nt=[]),Nt.push(tr,At)),At=er;else tr==="dangerouslySetInnerHTML"?(er=er?er.__html:void 0,Lt=Lt?Lt.__html:void 0,er!=null&&Lt!==er&&(Nt=Nt||[]).push(tr,er)):tr==="children"?typeof er!="string"&&typeof er!="number"||(Nt=Nt||[]).push(tr,""+er):tr!=="suppressContentEditableWarning"&&tr!=="suppressHydrationWarning"&&(ea.hasOwnProperty(tr)?(er!=null&&tr==="onScroll"&&D$2("scroll",xt),Nt||Lt===er||(Nt=[])):(Nt=Nt||[]).push(tr,er))}At&&(Nt=Nt||[]).push("style",At);var tr=Nt;(e.updateQueue=tr)&&(e.flags|=4)}};Cj=function(xt,e,At,kt){At!==kt&&(e.flags|=4)};function Dj(xt,e){if(!I$3)switch(xt.tailMode){case"hidden":e=xt.tail;for(var At=null;e!==null;)e.alternate!==null&&(At=e),e=e.sibling;At===null?xt.tail=null:At.sibling=null;break;case"collapsed":At=xt.tail;for(var kt=null;At!==null;)At.alternate!==null&&(kt=At),At=At.sibling;kt===null?e||xt.tail===null?xt.tail=null:xt.tail.sibling=null:kt.sibling=null}}function S$1(xt){var e=xt.alternate!==null&&xt.alternate.child===xt.child,At=0,kt=0;if(e)for(var Bt=xt.child;Bt!==null;)At|=Bt.lanes|Bt.childLanes,kt|=Bt.subtreeFlags&14680064,kt|=Bt.flags&14680064,Bt.return=xt,Bt=Bt.sibling;else for(Bt=xt.child;Bt!==null;)At|=Bt.lanes|Bt.childLanes,kt|=Bt.subtreeFlags,kt|=Bt.flags,Bt.return=xt,Bt=Bt.sibling;return xt.subtreeFlags|=kt,xt.childLanes=At,e}function Ej(xt,e,At){var kt=e.pendingProps;switch(wg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(e),null;case 1:return Zf(e.type)&&$f(),S$1(e),null;case 3:return kt=e.stateNode,zh(),E$4(Wf),E$4(H$1),Eh(),kt.pendingContext&&(kt.context=kt.pendingContext,kt.pendingContext=null),(xt===null||xt.child===null)&&(Gg(e)?e.flags|=4:xt===null||xt.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(xt,e),S$1(e),null;case 5:Bh(e);var Bt=xh(wh.current);if(At=e.type,xt!==null&&e.stateNode!=null)Bj(xt,e,At,kt,Bt),xt.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!kt){if(e.stateNode===null)throw Error(p$1(166));return S$1(e),null}if(xt=xh(uh.current),Gg(e)){kt=e.stateNode,At=e.type;var Nt=e.memoizedProps;switch(kt[Of]=e,kt[Pf]=Nt,xt=(e.mode&1)!==0,At){case"dialog":D$2("cancel",kt),D$2("close",kt);break;case"iframe":case"object":case"embed":D$2("load",kt);break;case"video":case"audio":for(Bt=0;Bt<lf.length;Bt++)D$2(lf[Bt],kt);break;case"source":D$2("error",kt);break;case"img":case"image":case"link":D$2("error",kt),D$2("load",kt);break;case"details":D$2("toggle",kt);break;case"input":Za(kt,Nt),D$2("invalid",kt);break;case"select":kt._wrapperState={wasMultiple:!!Nt.multiple},D$2("invalid",kt);break;case"textarea":hb(kt,Nt),D$2("invalid",kt)}ub(At,Nt),Bt=null;for(var jt in Nt)if(Nt.hasOwnProperty(jt)){var Lt=Nt[jt];jt==="children"?typeof Lt=="string"?kt.textContent!==Lt&&(Nt.suppressHydrationWarning!==!0&&Af(kt.textContent,Lt,xt),Bt=["children",Lt]):typeof Lt=="number"&&kt.textContent!==""+Lt&&(Nt.suppressHydrationWarning!==!0&&Af(kt.textContent,Lt,xt),Bt=["children",""+Lt]):ea.hasOwnProperty(jt)&&Lt!=null&&jt==="onScroll"&&D$2("scroll",kt)}switch(At){case"input":Va(kt),db(kt,Nt,!0);break;case"textarea":Va(kt),jb(kt);break;case"select":case"option":break;default:typeof Nt.onClick=="function"&&(kt.onclick=Bf)}kt=Bt,e.updateQueue=kt,kt!==null&&(e.flags|=4)}else{jt=Bt.nodeType===9?Bt:Bt.ownerDocument,xt==="http://www.w3.org/1999/xhtml"&&(xt=kb(At)),xt==="http://www.w3.org/1999/xhtml"?At==="script"?(xt=jt.createElement("div"),xt.innerHTML="<script><\/script>",xt=xt.removeChild(xt.firstChild)):typeof kt.is=="string"?xt=jt.createElement(At,{is:kt.is}):(xt=jt.createElement(At),At==="select"&&(jt=xt,kt.multiple?jt.multiple=!0:kt.size&&(jt.size=kt.size))):xt=jt.createElementNS(xt,At),xt[Of]=e,xt[Pf]=kt,zj(xt,e,!1,!1),e.stateNode=xt;e:{switch(jt=vb(At,kt),At){case"dialog":D$2("cancel",xt),D$2("close",xt),Bt=kt;break;case"iframe":case"object":case"embed":D$2("load",xt),Bt=kt;break;case"video":case"audio":for(Bt=0;Bt<lf.length;Bt++)D$2(lf[Bt],xt);Bt=kt;break;case"source":D$2("error",xt),Bt=kt;break;case"img":case"image":case"link":D$2("error",xt),D$2("load",xt),Bt=kt;break;case"details":D$2("toggle",xt),Bt=kt;break;case"input":Za(xt,kt),Bt=Ya(xt,kt),D$2("invalid",xt);break;case"option":Bt=kt;break;case"select":xt._wrapperState={wasMultiple:!!kt.multiple},Bt=A$1({},kt,{value:void 0}),D$2("invalid",xt);break;case"textarea":hb(xt,kt),Bt=gb(xt,kt),D$2("invalid",xt);break;default:Bt=kt}ub(At,Bt),Lt=Bt;for(Nt in Lt)if(Lt.hasOwnProperty(Nt)){var er=Lt[Nt];Nt==="style"?sb(xt,er):Nt==="dangerouslySetInnerHTML"?(er=er?er.__html:void 0,er!=null&&nb(xt,er)):Nt==="children"?typeof er=="string"?(At!=="textarea"||er!=="")&&ob(xt,er):typeof er=="number"&&ob(xt,""+er):Nt!=="suppressContentEditableWarning"&&Nt!=="suppressHydrationWarning"&&Nt!=="autoFocus"&&(ea.hasOwnProperty(Nt)?er!=null&&Nt==="onScroll"&&D$2("scroll",xt):er!=null&&ta(xt,Nt,er,jt))}switch(At){case"input":Va(xt),db(xt,kt,!1);break;case"textarea":Va(xt),jb(xt);break;case"option":kt.value!=null&&xt.setAttribute("value",""+Sa(kt.value));break;case"select":xt.multiple=!!kt.multiple,Nt=kt.value,Nt!=null?fb(xt,!!kt.multiple,Nt,!1):kt.defaultValue!=null&&fb(xt,!!kt.multiple,kt.defaultValue,!0);break;default:typeof Bt.onClick=="function"&&(xt.onclick=Bf)}switch(At){case"button":case"input":case"select":case"textarea":kt=!!kt.autoFocus;break e;case"img":kt=!0;break e;default:kt=!1}}kt&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return S$1(e),null;case 6:if(xt&&e.stateNode!=null)Cj(xt,e,xt.memoizedProps,kt);else{if(typeof kt!="string"&&e.stateNode===null)throw Error(p$1(166));if(At=xh(wh.current),xh(uh.current),Gg(e)){if(kt=e.stateNode,At=e.memoizedProps,kt[Of]=e,(Nt=kt.nodeValue!==At)&&(xt=xg,xt!==null))switch(xt.tag){case 3:Af(kt.nodeValue,At,(xt.mode&1)!==0);break;case 5:xt.memoizedProps.suppressHydrationWarning!==!0&&Af(kt.nodeValue,At,(xt.mode&1)!==0)}Nt&&(e.flags|=4)}else kt=(At.nodeType===9?At:At.ownerDocument).createTextNode(kt),kt[Of]=e,e.stateNode=kt}return S$1(e),null;case 13:if(E$4(L$2),kt=e.memoizedState,xt===null||xt.memoizedState!==null&&xt.memoizedState.dehydrated!==null){if(I$3&&yg!==null&&e.mode&1&&!(e.flags&128))Hg(),Ig(),e.flags|=98560,Nt=!1;else if(Nt=Gg(e),kt!==null&&kt.dehydrated!==null){if(xt===null){if(!Nt)throw Error(p$1(318));if(Nt=e.memoizedState,Nt=Nt!==null?Nt.dehydrated:null,!Nt)throw Error(p$1(317));Nt[Of]=e}else Ig(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;S$1(e),Nt=!1}else zg!==null&&(Fj(zg),zg=null),Nt=!0;if(!Nt)return e.flags&65536?e:null}return e.flags&128?(e.lanes=At,e):(kt=kt!==null,kt!==(xt!==null&&xt.memoizedState!==null)&&kt&&(e.child.flags|=8192,e.mode&1&&(xt===null||L$2.current&1?T$1===0&&(T$1=3):tj())),e.updateQueue!==null&&(e.flags|=4),S$1(e),null);case 4:return zh(),Aj(xt,e),xt===null&&sf(e.stateNode.containerInfo),S$1(e),null;case 10:return ah(e.type._context),S$1(e),null;case 17:return Zf(e.type)&&$f(),S$1(e),null;case 19:if(E$4(L$2),Nt=e.memoizedState,Nt===null)return S$1(e),null;if(kt=(e.flags&128)!==0,jt=Nt.rendering,jt===null)if(kt)Dj(Nt,!1);else{if(T$1!==0||xt!==null&&xt.flags&128)for(xt=e.child;xt!==null;){if(jt=Ch$1(xt),jt!==null){for(e.flags|=128,Dj(Nt,!1),kt=jt.updateQueue,kt!==null&&(e.updateQueue=kt,e.flags|=4),e.subtreeFlags=0,kt=At,At=e.child;At!==null;)Nt=At,xt=kt,Nt.flags&=14680066,jt=Nt.alternate,jt===null?(Nt.childLanes=0,Nt.lanes=xt,Nt.child=null,Nt.subtreeFlags=0,Nt.memoizedProps=null,Nt.memoizedState=null,Nt.updateQueue=null,Nt.dependencies=null,Nt.stateNode=null):(Nt.childLanes=jt.childLanes,Nt.lanes=jt.lanes,Nt.child=jt.child,Nt.subtreeFlags=0,Nt.deletions=null,Nt.memoizedProps=jt.memoizedProps,Nt.memoizedState=jt.memoizedState,Nt.updateQueue=jt.updateQueue,Nt.type=jt.type,xt=jt.dependencies,Nt.dependencies=xt===null?null:{lanes:xt.lanes,firstContext:xt.firstContext}),At=At.sibling;return G$4(L$2,L$2.current&1|2),e.child}xt=xt.sibling}Nt.tail!==null&&B$1()>Gj&&(e.flags|=128,kt=!0,Dj(Nt,!1),e.lanes=4194304)}else{if(!kt)if(xt=Ch$1(jt),xt!==null){if(e.flags|=128,kt=!0,At=xt.updateQueue,At!==null&&(e.updateQueue=At,e.flags|=4),Dj(Nt,!0),Nt.tail===null&&Nt.tailMode==="hidden"&&!jt.alternate&&!I$3)return S$1(e),null}else 2*B$1()-Nt.renderingStartTime>Gj&&At!==1073741824&&(e.flags|=128,kt=!0,Dj(Nt,!1),e.lanes=4194304);Nt.isBackwards?(jt.sibling=e.child,e.child=jt):(At=Nt.last,At!==null?At.sibling=jt:e.child=jt,Nt.last=jt)}return Nt.tail!==null?(e=Nt.tail,Nt.rendering=e,Nt.tail=e.sibling,Nt.renderingStartTime=B$1(),e.sibling=null,At=L$2.current,G$4(L$2,kt?At&1|2:At&1),e):(S$1(e),null);case 22:case 23:return Hj(),kt=e.memoizedState!==null,xt!==null&&xt.memoizedState!==null!==kt&&(e.flags|=8192),kt&&e.mode&1?fj&1073741824&&(S$1(e),e.subtreeFlags&6&&(e.flags|=8192)):S$1(e),null;case 24:return null;case 25:return null}throw Error(p$1(156,e.tag))}function Ij(xt,e){switch(wg(e),e.tag){case 1:return Zf(e.type)&&$f(),xt=e.flags,xt&65536?(e.flags=xt&-65537|128,e):null;case 3:return zh(),E$4(Wf),E$4(H$1),Eh(),xt=e.flags,xt&65536&&!(xt&128)?(e.flags=xt&-65537|128,e):null;case 5:return Bh(e),null;case 13:if(E$4(L$2),xt=e.memoizedState,xt!==null&&xt.dehydrated!==null){if(e.alternate===null)throw Error(p$1(340));Ig()}return xt=e.flags,xt&65536?(e.flags=xt&-65537|128,e):null;case 19:return E$4(L$2),null;case 4:return zh(),null;case 10:return ah(e.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U$2=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Lj(xt,e){var At=xt.ref;if(At!==null)if(typeof At=="function")try{At(null)}catch(kt){W$9(xt,e,kt)}else At.current=null}function Mj(xt,e,At){try{At()}catch(kt){W$9(xt,e,kt)}}var Nj=!1;function Oj(xt,e){if(Cf=dd,xt=Me$1(),Ne$1(xt)){if("selectionStart"in xt)var At={start:xt.selectionStart,end:xt.selectionEnd};else e:{At=(At=xt.ownerDocument)&&At.defaultView||window;var kt=At.getSelection&&At.getSelection();if(kt&&kt.rangeCount!==0){At=kt.anchorNode;var Bt=kt.anchorOffset,Nt=kt.focusNode;kt=kt.focusOffset;try{At.nodeType,Nt.nodeType}catch{At=null;break e}var jt=0,Lt=-1,er=-1,tr=0,zt=0,rr=xt,nr=null;t:for(;;){for(var ir;rr!==At||Bt!==0&&rr.nodeType!==3||(Lt=jt+Bt),rr!==Nt||kt!==0&&rr.nodeType!==3||(er=jt+kt),rr.nodeType===3&&(jt+=rr.nodeValue.length),(ir=rr.firstChild)!==null;)nr=rr,rr=ir;for(;;){if(rr===xt)break t;if(nr===At&&++tr===Bt&&(Lt=jt),nr===Nt&&++zt===kt&&(er=jt),(ir=rr.nextSibling)!==null)break;rr=nr,nr=rr.parentNode}rr=ir}At=Lt===-1||er===-1?null:{start:Lt,end:er}}else At=null}At=At||{start:0,end:0}}else At=null;for(Df={focusedElem:xt,selectionRange:At},dd=!1,V$1=e;V$1!==null;)if(e=V$1,xt=e.child,(e.subtreeFlags&1028)!==0&&xt!==null)xt.return=e,V$1=xt;else for(;V$1!==null;){e=V$1;try{var ar=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(ar!==null){var dr=ar.memoizedProps,ur=ar.memoizedState,fr=e.stateNode,pr=fr.getSnapshotBeforeUpdate(e.elementType===e.type?dr:Ci(e.type,dr),ur);fr.__reactInternalSnapshotBeforeUpdate=pr}break;case 3:var lr=e.stateNode.containerInfo;lr.nodeType===1?lr.textContent="":lr.nodeType===9&&lr.documentElement&&lr.removeChild(lr.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(yr){W$9(e,e.return,yr)}if(xt=e.sibling,xt!==null){xt.return=e.return,V$1=xt;break}V$1=e.return}return ar=Nj,Nj=!1,ar}function Pj(xt,e,At){var kt=e.updateQueue;if(kt=kt!==null?kt.lastEffect:null,kt!==null){var Bt=kt=kt.next;do{if((Bt.tag&xt)===xt){var Nt=Bt.destroy;Bt.destroy=void 0,Nt!==void 0&&Mj(e,At,Nt)}Bt=Bt.next}while(Bt!==kt)}}function Qj(xt,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var At=e=e.next;do{if((At.tag&xt)===xt){var kt=At.create;At.destroy=kt()}At=At.next}while(At!==e)}}function Rj(xt){var e=xt.ref;if(e!==null){var At=xt.stateNode;switch(xt.tag){case 5:xt=At;break;default:xt=At}typeof e=="function"?e(xt):e.current=xt}}function Sj(xt){var e=xt.alternate;e!==null&&(xt.alternate=null,Sj(e)),xt.child=null,xt.deletions=null,xt.sibling=null,xt.tag===5&&(e=xt.stateNode,e!==null&&(delete e[Of],delete e[Pf],delete e[of],delete e[Qf],delete e[Rf])),xt.stateNode=null,xt.return=null,xt.dependencies=null,xt.memoizedProps=null,xt.memoizedState=null,xt.pendingProps=null,xt.stateNode=null,xt.updateQueue=null}function Tj(xt){return xt.tag===5||xt.tag===3||xt.tag===4}function Uj(xt){e:for(;;){for(;xt.sibling===null;){if(xt.return===null||Tj(xt.return))return null;xt=xt.return}for(xt.sibling.return=xt.return,xt=xt.sibling;xt.tag!==5&&xt.tag!==6&&xt.tag!==18;){if(xt.flags&2||xt.child===null||xt.tag===4)continue e;xt.child.return=xt,xt=xt.child}if(!(xt.flags&2))return xt.stateNode}}function Vj(xt,e,At){var kt=xt.tag;if(kt===5||kt===6)xt=xt.stateNode,e?At.nodeType===8?At.parentNode.insertBefore(xt,e):At.insertBefore(xt,e):(At.nodeType===8?(e=At.parentNode,e.insertBefore(xt,At)):(e=At,e.appendChild(xt)),At=At._reactRootContainer,At!=null||e.onclick!==null||(e.onclick=Bf));else if(kt!==4&&(xt=xt.child,xt!==null))for(Vj(xt,e,At),xt=xt.sibling;xt!==null;)Vj(xt,e,At),xt=xt.sibling}function Wj(xt,e,At){var kt=xt.tag;if(kt===5||kt===6)xt=xt.stateNode,e?At.insertBefore(xt,e):At.appendChild(xt);else if(kt!==4&&(xt=xt.child,xt!==null))for(Wj(xt,e,At),xt=xt.sibling;xt!==null;)Wj(xt,e,At),xt=xt.sibling}var X$2=null,Xj=!1;function Yj(xt,e,At){for(At=At.child;At!==null;)Zj(xt,e,At),At=At.sibling}function Zj(xt,e,At){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,At)}catch{}switch(At.tag){case 5:U$2||Lj(At,e);case 6:var kt=X$2,Bt=Xj;X$2=null,Yj(xt,e,At),X$2=kt,Xj=Bt,X$2!==null&&(Xj?(xt=X$2,At=At.stateNode,xt.nodeType===8?xt.parentNode.removeChild(At):xt.removeChild(At)):X$2.removeChild(At.stateNode));break;case 18:X$2!==null&&(Xj?(xt=X$2,At=At.stateNode,xt.nodeType===8?Kf(xt.parentNode,At):xt.nodeType===1&&Kf(xt,At),bd(xt)):Kf(X$2,At.stateNode));break;case 4:kt=X$2,Bt=Xj,X$2=At.stateNode.containerInfo,Xj=!0,Yj(xt,e,At),X$2=kt,Xj=Bt;break;case 0:case 11:case 14:case 15:if(!U$2&&(kt=At.updateQueue,kt!==null&&(kt=kt.lastEffect,kt!==null))){Bt=kt=kt.next;do{var Nt=Bt,jt=Nt.destroy;Nt=Nt.tag,jt!==void 0&&(Nt&2||Nt&4)&&Mj(At,e,jt),Bt=Bt.next}while(Bt!==kt)}Yj(xt,e,At);break;case 1:if(!U$2&&(Lj(At,e),kt=At.stateNode,typeof kt.componentWillUnmount=="function"))try{kt.props=At.memoizedProps,kt.state=At.memoizedState,kt.componentWillUnmount()}catch(Lt){W$9(At,e,Lt)}Yj(xt,e,At);break;case 21:Yj(xt,e,At);break;case 22:At.mode&1?(U$2=(kt=U$2)||At.memoizedState!==null,Yj(xt,e,At),U$2=kt):Yj(xt,e,At);break;default:Yj(xt,e,At)}}function ak(xt){var e=xt.updateQueue;if(e!==null){xt.updateQueue=null;var At=xt.stateNode;At===null&&(At=xt.stateNode=new Kj),e.forEach(function(kt){var Bt=bk.bind(null,xt,kt);At.has(kt)||(At.add(kt),kt.then(Bt,Bt))})}}function ck(xt,e){var At=e.deletions;if(At!==null)for(var kt=0;kt<At.length;kt++){var Bt=At[kt];try{var Nt=xt,jt=e,Lt=jt;e:for(;Lt!==null;){switch(Lt.tag){case 5:X$2=Lt.stateNode,Xj=!1;break e;case 3:X$2=Lt.stateNode.containerInfo,Xj=!0;break e;case 4:X$2=Lt.stateNode.containerInfo,Xj=!0;break e}Lt=Lt.return}if(X$2===null)throw Error(p$1(160));Zj(Nt,jt,Bt),X$2=null,Xj=!1;var er=Bt.alternate;er!==null&&(er.return=null),Bt.return=null}catch(tr){W$9(Bt,e,tr)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)dk(e,xt),e=e.sibling}function dk(xt,e){var At=xt.alternate,kt=xt.flags;switch(xt.tag){case 0:case 11:case 14:case 15:if(ck(e,xt),ek(xt),kt&4){try{Pj(3,xt,xt.return),Qj(3,xt)}catch(dr){W$9(xt,xt.return,dr)}try{Pj(5,xt,xt.return)}catch(dr){W$9(xt,xt.return,dr)}}break;case 1:ck(e,xt),ek(xt),kt&512&&At!==null&&Lj(At,At.return);break;case 5:if(ck(e,xt),ek(xt),kt&512&&At!==null&&Lj(At,At.return),xt.flags&32){var Bt=xt.stateNode;try{ob(Bt,"")}catch(dr){W$9(xt,xt.return,dr)}}if(kt&4&&(Bt=xt.stateNode,Bt!=null)){var Nt=xt.memoizedProps,jt=At!==null?At.memoizedProps:Nt,Lt=xt.type,er=xt.updateQueue;if(xt.updateQueue=null,er!==null)try{Lt==="input"&&Nt.type==="radio"&&Nt.name!=null&&ab(Bt,Nt),vb(Lt,jt);var tr=vb(Lt,Nt);for(jt=0;jt<er.length;jt+=2){var zt=er[jt],rr=er[jt+1];zt==="style"?sb(Bt,rr):zt==="dangerouslySetInnerHTML"?nb(Bt,rr):zt==="children"?ob(Bt,rr):ta(Bt,zt,rr,tr)}switch(Lt){case"input":bb(Bt,Nt);break;case"textarea":ib(Bt,Nt);break;case"select":var nr=Bt._wrapperState.wasMultiple;Bt._wrapperState.wasMultiple=!!Nt.multiple;var ir=Nt.value;ir!=null?fb(Bt,!!Nt.multiple,ir,!1):nr!==!!Nt.multiple&&(Nt.defaultValue!=null?fb(Bt,!!Nt.multiple,Nt.defaultValue,!0):fb(Bt,!!Nt.multiple,Nt.multiple?[]:"",!1))}Bt[Pf]=Nt}catch(dr){W$9(xt,xt.return,dr)}}break;case 6:if(ck(e,xt),ek(xt),kt&4){if(xt.stateNode===null)throw Error(p$1(162));Bt=xt.stateNode,Nt=xt.memoizedProps;try{Bt.nodeValue=Nt}catch(dr){W$9(xt,xt.return,dr)}}break;case 3:if(ck(e,xt),ek(xt),kt&4&&At!==null&&At.memoizedState.isDehydrated)try{bd(e.containerInfo)}catch(dr){W$9(xt,xt.return,dr)}break;case 4:ck(e,xt),ek(xt);break;case 13:ck(e,xt),ek(xt),Bt=xt.child,Bt.flags&8192&&(Nt=Bt.memoizedState!==null,Bt.stateNode.isHidden=Nt,!Nt||Bt.alternate!==null&&Bt.alternate.memoizedState!==null||(fk=B$1())),kt&4&&ak(xt);break;case 22:if(zt=At!==null&&At.memoizedState!==null,xt.mode&1?(U$2=(tr=U$2)||zt,ck(e,xt),U$2=tr):ck(e,xt),ek(xt),kt&8192){if(tr=xt.memoizedState!==null,(xt.stateNode.isHidden=tr)&&!zt&&xt.mode&1)for(V$1=xt,zt=xt.child;zt!==null;){for(rr=V$1=zt;V$1!==null;){switch(nr=V$1,ir=nr.child,nr.tag){case 0:case 11:case 14:case 15:Pj(4,nr,nr.return);break;case 1:Lj(nr,nr.return);var ar=nr.stateNode;if(typeof ar.componentWillUnmount=="function"){kt=nr,At=nr.return;try{e=kt,ar.props=e.memoizedProps,ar.state=e.memoizedState,ar.componentWillUnmount()}catch(dr){W$9(kt,At,dr)}}break;case 5:Lj(nr,nr.return);break;case 22:if(nr.memoizedState!==null){gk(rr);continue}}ir!==null?(ir.return=nr,V$1=ir):gk(rr)}zt=zt.sibling}e:for(zt=null,rr=xt;;){if(rr.tag===5){if(zt===null){zt=rr;try{Bt=rr.stateNode,tr?(Nt=Bt.style,typeof Nt.setProperty=="function"?Nt.setProperty("display","none","important"):Nt.display="none"):(Lt=rr.stateNode,er=rr.memoizedProps.style,jt=er!=null&&er.hasOwnProperty("display")?er.display:null,Lt.style.display=rb("display",jt))}catch(dr){W$9(xt,xt.return,dr)}}}else if(rr.tag===6){if(zt===null)try{rr.stateNode.nodeValue=tr?"":rr.memoizedProps}catch(dr){W$9(xt,xt.return,dr)}}else if((rr.tag!==22&&rr.tag!==23||rr.memoizedState===null||rr===xt)&&rr.child!==null){rr.child.return=rr,rr=rr.child;continue}if(rr===xt)break e;for(;rr.sibling===null;){if(rr.return===null||rr.return===xt)break e;zt===rr&&(zt=null),rr=rr.return}zt===rr&&(zt=null),rr.sibling.return=rr.return,rr=rr.sibling}}break;case 19:ck(e,xt),ek(xt),kt&4&&ak(xt);break;case 21:break;default:ck(e,xt),ek(xt)}}function ek(xt){var e=xt.flags;if(e&2){try{e:{for(var At=xt.return;At!==null;){if(Tj(At)){var kt=At;break e}At=At.return}throw Error(p$1(160))}switch(kt.tag){case 5:var Bt=kt.stateNode;kt.flags&32&&(ob(Bt,""),kt.flags&=-33);var Nt=Uj(xt);Wj(xt,Nt,Bt);break;case 3:case 4:var jt=kt.stateNode.containerInfo,Lt=Uj(xt);Vj(xt,Lt,jt);break;default:throw Error(p$1(161))}}catch(er){W$9(xt,xt.return,er)}xt.flags&=-3}e&4096&&(xt.flags&=-4097)}function hk(xt,e,At){V$1=xt,ik(xt)}function ik(xt,e,At){for(var kt=(xt.mode&1)!==0;V$1!==null;){var Bt=V$1,Nt=Bt.child;if(Bt.tag===22&&kt){var jt=Bt.memoizedState!==null||Jj;if(!jt){var Lt=Bt.alternate,er=Lt!==null&&Lt.memoizedState!==null||U$2;Lt=Jj;var tr=U$2;if(Jj=jt,(U$2=er)&&!tr)for(V$1=Bt;V$1!==null;)jt=V$1,er=jt.child,jt.tag===22&&jt.memoizedState!==null?jk(Bt):er!==null?(er.return=jt,V$1=er):jk(Bt);for(;Nt!==null;)V$1=Nt,ik(Nt),Nt=Nt.sibling;V$1=Bt,Jj=Lt,U$2=tr}kk(xt)}else Bt.subtreeFlags&8772&&Nt!==null?(Nt.return=Bt,V$1=Nt):kk(xt)}}function kk(xt){for(;V$1!==null;){var e=V$1;if(e.flags&8772){var At=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:U$2||Qj(5,e);break;case 1:var kt=e.stateNode;if(e.flags&4&&!U$2)if(At===null)kt.componentDidMount();else{var Bt=e.elementType===e.type?At.memoizedProps:Ci(e.type,At.memoizedProps);kt.componentDidUpdate(Bt,At.memoizedState,kt.__reactInternalSnapshotBeforeUpdate)}var Nt=e.updateQueue;Nt!==null&&sh$1(e,Nt,kt);break;case 3:var jt=e.updateQueue;if(jt!==null){if(At=null,e.child!==null)switch(e.child.tag){case 5:At=e.child.stateNode;break;case 1:At=e.child.stateNode}sh$1(e,jt,At)}break;case 5:var Lt=e.stateNode;if(At===null&&e.flags&4){At=Lt;var er=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":er.autoFocus&&At.focus();break;case"img":er.src&&(At.src=er.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var tr=e.alternate;if(tr!==null){var zt=tr.memoizedState;if(zt!==null){var rr=zt.dehydrated;rr!==null&&bd(rr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U$2||e.flags&512&&Rj(e)}catch(nr){W$9(e,e.return,nr)}}if(e===xt){V$1=null;break}if(At=e.sibling,At!==null){At.return=e.return,V$1=At;break}V$1=e.return}}function gk(xt){for(;V$1!==null;){var e=V$1;if(e===xt){V$1=null;break}var At=e.sibling;if(At!==null){At.return=e.return,V$1=At;break}V$1=e.return}}function jk(xt){for(;V$1!==null;){var e=V$1;try{switch(e.tag){case 0:case 11:case 15:var At=e.return;try{Qj(4,e)}catch(er){W$9(e,At,er)}break;case 1:var kt=e.stateNode;if(typeof kt.componentDidMount=="function"){var Bt=e.return;try{kt.componentDidMount()}catch(er){W$9(e,Bt,er)}}var Nt=e.return;try{Rj(e)}catch(er){W$9(e,Nt,er)}break;case 5:var jt=e.return;try{Rj(e)}catch(er){W$9(e,jt,er)}}}catch(er){W$9(e,e.return,er)}if(e===xt){V$1=null;break}var Lt=e.sibling;if(Lt!==null){Lt.return=e.return,V$1=Lt;break}V$1=e.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K$6=0,Q$1=null,Y$1=null,Z$1=0,fj=0,ej=Uf(0),T$1=0,pk=null,rh$1=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi$1=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R$2(){return K$6&6?B$1():Ak!==-1?Ak:Ak=B$1()}function yi(xt){return xt.mode&1?K$6&2&&Z$1!==0?Z$1&-Z$1:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(xt=C$1,xt!==0||(xt=window.event,xt=xt===void 0?16:jd(xt.type)),xt):1}function gi(xt,e,At,kt){if(50<yk)throw yk=0,zk=null,Error(p$1(185));Ac(xt,At,kt),(!(K$6&2)||xt!==Q$1)&&(xt===Q$1&&(!(K$6&2)&&(qk|=At),T$1===4&&Ck(xt,Z$1)),Dk(xt,kt),At===1&&K$6===0&&!(e.mode&1)&&(Gj=B$1()+500,fg&&jg()))}function Dk(xt,e){var At=xt.callbackNode;wc(xt,e);var kt=uc(xt,xt===Q$1?Z$1:0);if(kt===0)At!==null&&bc(At),xt.callbackNode=null,xt.callbackPriority=0;else if(e=kt&-kt,xt.callbackPriority!==e){if(At!=null&&bc(At),e===1)xt.tag===0?ig(Ek.bind(null,xt)):hg(Ek.bind(null,xt)),Jf(function(){!(K$6&6)&&jg()}),At=null;else{switch(Dc(kt)){case 1:At=fc;break;case 4:At=gc;break;case 16:At=hc;break;case 536870912:At=jc;break;default:At=hc}At=Fk(At,Gk.bind(null,xt))}xt.callbackPriority=e,xt.callbackNode=At}}function Gk(xt,e){if(Ak=-1,Bk=0,K$6&6)throw Error(p$1(327));var At=xt.callbackNode;if(Hk()&&xt.callbackNode!==At)return null;var kt=uc(xt,xt===Q$1?Z$1:0);if(kt===0)return null;if(kt&30||kt&xt.expiredLanes||e)e=Ik(xt,kt);else{e=kt;var Bt=K$6;K$6|=2;var Nt=Jk();(Q$1!==xt||Z$1!==e)&&(uk=null,Gj=B$1()+500,Kk(xt,e));do try{Lk();break}catch(Lt){Mk(xt,Lt)}while(!0);$g(),mk.current=Nt,K$6=Bt,Y$1!==null?e=0:(Q$1=null,Z$1=0,e=T$1)}if(e!==0){if(e===2&&(Bt=xc(xt),Bt!==0&&(kt=Bt,e=Nk(xt,Bt))),e===1)throw At=pk,Kk(xt,0),Ck(xt,kt),Dk(xt,B$1()),At;if(e===6)Ck(xt,kt);else{if(Bt=xt.current.alternate,!(kt&30)&&!Ok(Bt)&&(e=Ik(xt,kt),e===2&&(Nt=xc(xt),Nt!==0&&(kt=Nt,e=Nk(xt,Nt))),e===1))throw At=pk,Kk(xt,0),Ck(xt,kt),Dk(xt,B$1()),At;switch(xt.finishedWork=Bt,xt.finishedLanes=kt,e){case 0:case 1:throw Error(p$1(345));case 2:Pk(xt,tk,uk);break;case 3:if(Ck(xt,kt),(kt&130023424)===kt&&(e=fk+500-B$1(),10<e)){if(uc(xt,0)!==0)break;if(Bt=xt.suspendedLanes,(Bt&kt)!==kt){R$2(),xt.pingedLanes|=xt.suspendedLanes&Bt;break}xt.timeoutHandle=Ff(Pk.bind(null,xt,tk,uk),e);break}Pk(xt,tk,uk);break;case 4:if(Ck(xt,kt),(kt&4194240)===kt)break;for(e=xt.eventTimes,Bt=-1;0<kt;){var jt=31-oc(kt);Nt=1<<jt,jt=e[jt],jt>Bt&&(Bt=jt),kt&=~Nt}if(kt=Bt,kt=B$1()-kt,kt=(120>kt?120:480>kt?480:1080>kt?1080:1920>kt?1920:3e3>kt?3e3:4320>kt?4320:1960*lk(kt/1960))-kt,10<kt){xt.timeoutHandle=Ff(Pk.bind(null,xt,tk,uk),kt);break}Pk(xt,tk,uk);break;case 5:Pk(xt,tk,uk);break;default:throw Error(p$1(329))}}}return Dk(xt,B$1()),xt.callbackNode===At?Gk.bind(null,xt):null}function Nk(xt,e){var At=sk;return xt.current.memoizedState.isDehydrated&&(Kk(xt,e).flags|=256),xt=Ik(xt,e),xt!==2&&(e=tk,tk=At,e!==null&&Fj(e)),xt}function Fj(xt){tk===null?tk=xt:tk.push.apply(tk,xt)}function Ok(xt){for(var e=xt;;){if(e.flags&16384){var At=e.updateQueue;if(At!==null&&(At=At.stores,At!==null))for(var kt=0;kt<At.length;kt++){var Bt=At[kt],Nt=Bt.getSnapshot;Bt=Bt.value;try{if(!He$1(Nt(),Bt))return!1}catch{return!1}}}if(At=e.child,e.subtreeFlags&16384&&At!==null)At.return=e,e=At;else{if(e===xt)break;for(;e.sibling===null;){if(e.return===null||e.return===xt)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ck(xt,e){for(e&=~rk,e&=~qk,xt.suspendedLanes|=e,xt.pingedLanes&=~e,xt=xt.expirationTimes;0<e;){var At=31-oc(e),kt=1<<At;xt[At]=-1,e&=~kt}}function Ek(xt){if(K$6&6)throw Error(p$1(327));Hk();var e=uc(xt,0);if(!(e&1))return Dk(xt,B$1()),null;var At=Ik(xt,e);if(xt.tag!==0&&At===2){var kt=xc(xt);kt!==0&&(e=kt,At=Nk(xt,kt))}if(At===1)throw At=pk,Kk(xt,0),Ck(xt,e),Dk(xt,B$1()),At;if(At===6)throw Error(p$1(345));return xt.finishedWork=xt.current.alternate,xt.finishedLanes=e,Pk(xt,tk,uk),Dk(xt,B$1()),null}function Qk(xt,e){var At=K$6;K$6|=1;try{return xt(e)}finally{K$6=At,K$6===0&&(Gj=B$1()+500,fg&&jg())}}function Rk(xt){wk!==null&&wk.tag===0&&!(K$6&6)&&Hk();var e=K$6;K$6|=1;var At=ok.transition,kt=C$1;try{if(ok.transition=null,C$1=1,xt)return xt()}finally{C$1=kt,ok.transition=At,K$6=e,!(K$6&6)&&jg()}}function Hj(){fj=ej.current,E$4(ej)}function Kk(xt,e){xt.finishedWork=null,xt.finishedLanes=0;var At=xt.timeoutHandle;if(At!==-1&&(xt.timeoutHandle=-1,Gf(At)),Y$1!==null)for(At=Y$1.return;At!==null;){var kt=At;switch(wg(kt),kt.tag){case 1:kt=kt.type.childContextTypes,kt!=null&&$f();break;case 3:zh(),E$4(Wf),E$4(H$1),Eh();break;case 5:Bh(kt);break;case 4:zh();break;case 13:E$4(L$2);break;case 19:E$4(L$2);break;case 10:ah(kt.type._context);break;case 22:case 23:Hj()}At=At.return}if(Q$1=xt,Y$1=xt=Pg(xt.current,null),Z$1=fj=e,T$1=0,pk=null,rk=qk=rh$1=0,tk=sk=null,fh!==null){for(e=0;e<fh.length;e++)if(At=fh[e],kt=At.interleaved,kt!==null){At.interleaved=null;var Bt=kt.next,Nt=At.pending;if(Nt!==null){var jt=Nt.next;Nt.next=Bt,kt.next=jt}At.pending=kt}fh=null}return xt}function Mk(xt,e){do{var At=Y$1;try{if($g(),Fh.current=Rh,Ih){for(var kt=M$1.memoizedState;kt!==null;){var Bt=kt.queue;Bt!==null&&(Bt.pending=null),kt=kt.next}Ih=!1}if(Hh=0,O$1=N$3=M$1=null,Jh=!1,Kh$1=0,nk.current=null,At===null||At.return===null){T$1=1,pk=e,Y$1=null;break}e:{var Nt=xt,jt=At.return,Lt=At,er=e;if(e=Z$1,Lt.flags|=32768,er!==null&&typeof er=="object"&&typeof er.then=="function"){var tr=er,zt=Lt,rr=zt.tag;if(!(zt.mode&1)&&(rr===0||rr===11||rr===15)){var nr=zt.alternate;nr?(zt.updateQueue=nr.updateQueue,zt.memoizedState=nr.memoizedState,zt.lanes=nr.lanes):(zt.updateQueue=null,zt.memoizedState=null)}var ir=Ui(jt);if(ir!==null){ir.flags&=-257,Vi(ir,jt,Lt,Nt,e),ir.mode&1&&Si(Nt,tr,e),e=ir,er=tr;var ar=e.updateQueue;if(ar===null){var dr=new Set;dr.add(er),e.updateQueue=dr}else ar.add(er);break e}else{if(!(e&1)){Si(Nt,tr,e),tj();break e}er=Error(p$1(426))}}else if(I$3&&Lt.mode&1){var ur=Ui(jt);if(ur!==null){!(ur.flags&65536)&&(ur.flags|=256),Vi(ur,jt,Lt,Nt,e),Jg(Ji(er,Lt));break e}}Nt=er=Ji(er,Lt),T$1!==4&&(T$1=2),sk===null?sk=[Nt]:sk.push(Nt),Nt=jt;do{switch(Nt.tag){case 3:Nt.flags|=65536,e&=-e,Nt.lanes|=e;var fr=Ni(Nt,er,e);ph(Nt,fr);break e;case 1:Lt=er;var pr=Nt.type,lr=Nt.stateNode;if(!(Nt.flags&128)&&(typeof pr.getDerivedStateFromError=="function"||lr!==null&&typeof lr.componentDidCatch=="function"&&(Ri===null||!Ri.has(lr)))){Nt.flags|=65536,e&=-e,Nt.lanes|=e;var yr=Qi(Nt,Lt,e);ph(Nt,yr);break e}}Nt=Nt.return}while(Nt!==null)}Sk(At)}catch(br){e=br,Y$1===At&&At!==null&&(Y$1=At=At.return);continue}break}while(!0)}function Jk(){var xt=mk.current;return mk.current=Rh,xt===null?Rh:xt}function tj(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),Q$1===null||!(rh$1&268435455)&&!(qk&268435455)||Ck(Q$1,Z$1)}function Ik(xt,e){var At=K$6;K$6|=2;var kt=Jk();(Q$1!==xt||Z$1!==e)&&(uk=null,Kk(xt,e));do try{Tk();break}catch(Bt){Mk(xt,Bt)}while(!0);if($g(),K$6=At,mk.current=kt,Y$1!==null)throw Error(p$1(261));return Q$1=null,Z$1=0,T$1}function Tk(){for(;Y$1!==null;)Uk(Y$1)}function Lk(){for(;Y$1!==null&&!cc();)Uk(Y$1)}function Uk(xt){var e=Vk(xt.alternate,xt,fj);xt.memoizedProps=xt.pendingProps,e===null?Sk(xt):Y$1=e,nk.current=null}function Sk(xt){var e=xt;do{var At=e.alternate;if(xt=e.return,e.flags&32768){if(At=Ij(At,e),At!==null){At.flags&=32767,Y$1=At;return}if(xt!==null)xt.flags|=32768,xt.subtreeFlags=0,xt.deletions=null;else{T$1=6,Y$1=null;return}}else if(At=Ej(At,e,fj),At!==null){Y$1=At;return}if(e=e.sibling,e!==null){Y$1=e;return}Y$1=e=xt}while(e!==null);T$1===0&&(T$1=5)}function Pk(xt,e,At){var kt=C$1,Bt=ok.transition;try{ok.transition=null,C$1=1,Wk(xt,e,At,kt)}finally{ok.transition=Bt,C$1=kt}return null}function Wk(xt,e,At,kt){do Hk();while(wk!==null);if(K$6&6)throw Error(p$1(327));At=xt.finishedWork;var Bt=xt.finishedLanes;if(At===null)return null;if(xt.finishedWork=null,xt.finishedLanes=0,At===xt.current)throw Error(p$1(177));xt.callbackNode=null,xt.callbackPriority=0;var Nt=At.lanes|At.childLanes;if(Bc(xt,Nt),xt===Q$1&&(Y$1=Q$1=null,Z$1=0),!(At.subtreeFlags&2064)&&!(At.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),Nt=(At.flags&15990)!==0,At.subtreeFlags&15990||Nt){Nt=ok.transition,ok.transition=null;var jt=C$1;C$1=1;var Lt=K$6;K$6|=4,nk.current=null,Oj(xt,At),dk(At,xt),Oe$1(Df),dd=!!Cf,Df=Cf=null,xt.current=At,hk(At),dc(),K$6=Lt,C$1=jt,ok.transition=Nt}else xt.current=At;if(vk&&(vk=!1,wk=xt,xk=Bt),Nt=xt.pendingLanes,Nt===0&&(Ri=null),mc(At.stateNode),Dk(xt,B$1()),e!==null)for(kt=xt.onRecoverableError,At=0;At<e.length;At++)Bt=e[At],kt(Bt.value,{componentStack:Bt.stack,digest:Bt.digest});if(Oi)throw Oi=!1,xt=Pi$1,Pi$1=null,xt;return xk&1&&xt.tag!==0&&Hk(),Nt=xt.pendingLanes,Nt&1?xt===zk?yk++:(yk=0,zk=xt):yk=0,jg(),null}function Hk(){if(wk!==null){var xt=Dc(xk),e=ok.transition,At=C$1;try{if(ok.transition=null,C$1=16>xt?16:xt,wk===null)var kt=!1;else{if(xt=wk,wk=null,xk=0,K$6&6)throw Error(p$1(331));var Bt=K$6;for(K$6|=4,V$1=xt.current;V$1!==null;){var Nt=V$1,jt=Nt.child;if(V$1.flags&16){var Lt=Nt.deletions;if(Lt!==null){for(var er=0;er<Lt.length;er++){var tr=Lt[er];for(V$1=tr;V$1!==null;){var zt=V$1;switch(zt.tag){case 0:case 11:case 15:Pj(8,zt,Nt)}var rr=zt.child;if(rr!==null)rr.return=zt,V$1=rr;else for(;V$1!==null;){zt=V$1;var nr=zt.sibling,ir=zt.return;if(Sj(zt),zt===tr){V$1=null;break}if(nr!==null){nr.return=ir,V$1=nr;break}V$1=ir}}}var ar=Nt.alternate;if(ar!==null){var dr=ar.child;if(dr!==null){ar.child=null;do{var ur=dr.sibling;dr.sibling=null,dr=ur}while(dr!==null)}}V$1=Nt}}if(Nt.subtreeFlags&2064&&jt!==null)jt.return=Nt,V$1=jt;else e:for(;V$1!==null;){if(Nt=V$1,Nt.flags&2048)switch(Nt.tag){case 0:case 11:case 15:Pj(9,Nt,Nt.return)}var fr=Nt.sibling;if(fr!==null){fr.return=Nt.return,V$1=fr;break e}V$1=Nt.return}}var pr=xt.current;for(V$1=pr;V$1!==null;){jt=V$1;var lr=jt.child;if(jt.subtreeFlags&2064&&lr!==null)lr.return=jt,V$1=lr;else e:for(jt=pr;V$1!==null;){if(Lt=V$1,Lt.flags&2048)try{switch(Lt.tag){case 0:case 11:case 15:Qj(9,Lt)}}catch(br){W$9(Lt,Lt.return,br)}if(Lt===jt){V$1=null;break e}var yr=Lt.sibling;if(yr!==null){yr.return=Lt.return,V$1=yr;break e}V$1=Lt.return}}if(K$6=Bt,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,xt)}catch{}kt=!0}return kt}finally{C$1=At,ok.transition=e}}return!1}function Xk(xt,e,At){e=Ji(At,e),e=Ni(xt,e,1),xt=nh(xt,e,1),e=R$2(),xt!==null&&(Ac(xt,1,e),Dk(xt,e))}function W$9(xt,e,At){if(xt.tag===3)Xk(xt,xt,At);else for(;e!==null;){if(e.tag===3){Xk(e,xt,At);break}else if(e.tag===1){var kt=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof kt.componentDidCatch=="function"&&(Ri===null||!Ri.has(kt))){xt=Ji(At,xt),xt=Qi(e,xt,1),e=nh(e,xt,1),xt=R$2(),e!==null&&(Ac(e,1,xt),Dk(e,xt));break}}e=e.return}}function Ti(xt,e,At){var kt=xt.pingCache;kt!==null&&kt.delete(e),e=R$2(),xt.pingedLanes|=xt.suspendedLanes&At,Q$1===xt&&(Z$1&At)===At&&(T$1===4||T$1===3&&(Z$1&130023424)===Z$1&&500>B$1()-fk?Kk(xt,0):rk|=At),Dk(xt,e)}function Yk(xt,e){e===0&&(xt.mode&1?(e=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):e=1);var At=R$2();xt=ih(xt,e),xt!==null&&(Ac(xt,e,At),Dk(xt,At))}function uj(xt){var e=xt.memoizedState,At=0;e!==null&&(At=e.retryLane),Yk(xt,At)}function bk(xt,e){var At=0;switch(xt.tag){case 13:var kt=xt.stateNode,Bt=xt.memoizedState;Bt!==null&&(At=Bt.retryLane);break;case 19:kt=xt.stateNode;break;default:throw Error(p$1(314))}kt!==null&&kt.delete(e),Yk(xt,At)}var Vk;Vk=function(xt,e,At){if(xt!==null)if(xt.memoizedProps!==e.pendingProps||Wf.current)dh$1=!0;else{if(!(xt.lanes&At)&&!(e.flags&128))return dh$1=!1,yj(xt,e,At);dh$1=!!(xt.flags&131072)}else dh$1=!1,I$3&&e.flags&1048576&&ug(e,ng,e.index);switch(e.lanes=0,e.tag){case 2:var kt=e.type;ij(xt,e),xt=e.pendingProps;var Bt=Yf(e,H$1.current);ch$1(e,At),Bt=Nh(null,e,kt,xt,Bt,At);var Nt=Sh();return e.flags|=1,typeof Bt=="object"&&Bt!==null&&typeof Bt.render=="function"&&Bt.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Zf(kt)?(Nt=!0,cg(e)):Nt=!1,e.memoizedState=Bt.state!==null&&Bt.state!==void 0?Bt.state:null,kh(e),Bt.updater=Ei,e.stateNode=Bt,Bt._reactInternals=e,Ii(e,kt,xt,At),e=jj(null,e,kt,!0,Nt,At)):(e.tag=0,I$3&&Nt&&vg(e),Xi(null,e,Bt,At),e=e.child),e;case 16:kt=e.elementType;e:{switch(ij(xt,e),xt=e.pendingProps,Bt=kt._init,kt=Bt(kt._payload),e.type=kt,Bt=e.tag=Zk(kt),xt=Ci(kt,xt),Bt){case 0:e=cj(null,e,kt,xt,At);break e;case 1:e=hj(null,e,kt,xt,At);break e;case 11:e=Yi(null,e,kt,xt,At);break e;case 14:e=$i(null,e,kt,Ci(kt.type,xt),At);break e}throw Error(p$1(306,kt,""))}return e;case 0:return kt=e.type,Bt=e.pendingProps,Bt=e.elementType===kt?Bt:Ci(kt,Bt),cj(xt,e,kt,Bt,At);case 1:return kt=e.type,Bt=e.pendingProps,Bt=e.elementType===kt?Bt:Ci(kt,Bt),hj(xt,e,kt,Bt,At);case 3:e:{if(kj(e),xt===null)throw Error(p$1(387));kt=e.pendingProps,Nt=e.memoizedState,Bt=Nt.element,lh(xt,e),qh(e,kt,null,At);var jt=e.memoizedState;if(kt=jt.element,Nt.isDehydrated)if(Nt={element:kt,isDehydrated:!1,cache:jt.cache,pendingSuspenseBoundaries:jt.pendingSuspenseBoundaries,transitions:jt.transitions},e.updateQueue.baseState=Nt,e.memoizedState=Nt,e.flags&256){Bt=Ji(Error(p$1(423)),e),e=lj(xt,e,kt,At,Bt);break e}else if(kt!==Bt){Bt=Ji(Error(p$1(424)),e),e=lj(xt,e,kt,At,Bt);break e}else for(yg=Lf(e.stateNode.containerInfo.firstChild),xg=e,I$3=!0,zg=null,At=Vg(e,null,kt,At),e.child=At;At;)At.flags=At.flags&-3|4096,At=At.sibling;else{if(Ig(),kt===Bt){e=Zi(xt,e,At);break e}Xi(xt,e,kt,At)}e=e.child}return e;case 5:return Ah(e),xt===null&&Eg(e),kt=e.type,Bt=e.pendingProps,Nt=xt!==null?xt.memoizedProps:null,jt=Bt.children,Ef(kt,Bt)?jt=null:Nt!==null&&Ef(kt,Nt)&&(e.flags|=32),gj(xt,e),Xi(xt,e,jt,At),e.child;case 6:return xt===null&&Eg(e),null;case 13:return oj(xt,e,At);case 4:return yh(e,e.stateNode.containerInfo),kt=e.pendingProps,xt===null?e.child=Ug(e,null,kt,At):Xi(xt,e,kt,At),e.child;case 11:return kt=e.type,Bt=e.pendingProps,Bt=e.elementType===kt?Bt:Ci(kt,Bt),Yi(xt,e,kt,Bt,At);case 7:return Xi(xt,e,e.pendingProps,At),e.child;case 8:return Xi(xt,e,e.pendingProps.children,At),e.child;case 12:return Xi(xt,e,e.pendingProps.children,At),e.child;case 10:e:{if(kt=e.type._context,Bt=e.pendingProps,Nt=e.memoizedProps,jt=Bt.value,G$4(Wg,kt._currentValue),kt._currentValue=jt,Nt!==null)if(He$1(Nt.value,jt)){if(Nt.children===Bt.children&&!Wf.current){e=Zi(xt,e,At);break e}}else for(Nt=e.child,Nt!==null&&(Nt.return=e);Nt!==null;){var Lt=Nt.dependencies;if(Lt!==null){jt=Nt.child;for(var er=Lt.firstContext;er!==null;){if(er.context===kt){if(Nt.tag===1){er=mh(-1,At&-At),er.tag=2;var tr=Nt.updateQueue;if(tr!==null){tr=tr.shared;var zt=tr.pending;zt===null?er.next=er:(er.next=zt.next,zt.next=er),tr.pending=er}}Nt.lanes|=At,er=Nt.alternate,er!==null&&(er.lanes|=At),bh(Nt.return,At,e),Lt.lanes|=At;break}er=er.next}}else if(Nt.tag===10)jt=Nt.type===e.type?null:Nt.child;else if(Nt.tag===18){if(jt=Nt.return,jt===null)throw Error(p$1(341));jt.lanes|=At,Lt=jt.alternate,Lt!==null&&(Lt.lanes|=At),bh(jt,At,e),jt=Nt.sibling}else jt=Nt.child;if(jt!==null)jt.return=Nt;else for(jt=Nt;jt!==null;){if(jt===e){jt=null;break}if(Nt=jt.sibling,Nt!==null){Nt.return=jt.return,jt=Nt;break}jt=jt.return}Nt=jt}Xi(xt,e,Bt.children,At),e=e.child}return e;case 9:return Bt=e.type,kt=e.pendingProps.children,ch$1(e,At),Bt=eh(Bt),kt=kt(Bt),e.flags|=1,Xi(xt,e,kt,At),e.child;case 14:return kt=e.type,Bt=Ci(kt,e.pendingProps),Bt=Ci(kt.type,Bt),$i(xt,e,kt,Bt,At);case 15:return bj(xt,e,e.type,e.pendingProps,At);case 17:return kt=e.type,Bt=e.pendingProps,Bt=e.elementType===kt?Bt:Ci(kt,Bt),ij(xt,e),e.tag=1,Zf(kt)?(xt=!0,cg(e)):xt=!1,ch$1(e,At),Gi(e,kt,Bt),Ii(e,kt,Bt,At),jj(null,e,kt,!0,xt,At);case 19:return xj(xt,e,At);case 22:return dj(xt,e,At)}throw Error(p$1(156,e.tag))};function Fk(xt,e){return ac(xt,e)}function $k(xt,e,At,kt){this.tag=xt,this.key=At,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=kt,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(xt,e,At,kt){return new $k(xt,e,At,kt)}function aj(xt){return xt=xt.prototype,!(!xt||!xt.isReactComponent)}function Zk(xt){if(typeof xt=="function")return aj(xt)?1:0;if(xt!=null){if(xt=xt.$$typeof,xt===Da)return 11;if(xt===Ga)return 14}return 2}function Pg(xt,e){var At=xt.alternate;return At===null?(At=Bg(xt.tag,e,xt.key,xt.mode),At.elementType=xt.elementType,At.type=xt.type,At.stateNode=xt.stateNode,At.alternate=xt,xt.alternate=At):(At.pendingProps=e,At.type=xt.type,At.flags=0,At.subtreeFlags=0,At.deletions=null),At.flags=xt.flags&14680064,At.childLanes=xt.childLanes,At.lanes=xt.lanes,At.child=xt.child,At.memoizedProps=xt.memoizedProps,At.memoizedState=xt.memoizedState,At.updateQueue=xt.updateQueue,e=xt.dependencies,At.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},At.sibling=xt.sibling,At.index=xt.index,At.ref=xt.ref,At}function Rg(xt,e,At,kt,Bt,Nt){var jt=2;if(kt=xt,typeof xt=="function")aj(xt)&&(jt=1);else if(typeof xt=="string")jt=5;else e:switch(xt){case ya:return Tg(At.children,Bt,Nt,e);case za:jt=8,Bt|=8;break;case Aa:return xt=Bg(12,At,e,Bt|2),xt.elementType=Aa,xt.lanes=Nt,xt;case Ea:return xt=Bg(13,At,e,Bt),xt.elementType=Ea,xt.lanes=Nt,xt;case Fa:return xt=Bg(19,At,e,Bt),xt.elementType=Fa,xt.lanes=Nt,xt;case Ia:return pj(At,Bt,Nt,e);default:if(typeof xt=="object"&&xt!==null)switch(xt.$$typeof){case Ba:jt=10;break e;case Ca:jt=9;break e;case Da:jt=11;break e;case Ga:jt=14;break e;case Ha:jt=16,kt=null;break e}throw Error(p$1(130,xt==null?xt:typeof xt,""))}return e=Bg(jt,At,e,Bt),e.elementType=xt,e.type=kt,e.lanes=Nt,e}function Tg(xt,e,At,kt){return xt=Bg(7,xt,kt,e),xt.lanes=At,xt}function pj(xt,e,At,kt){return xt=Bg(22,xt,kt,e),xt.elementType=Ia,xt.lanes=At,xt.stateNode={isHidden:!1},xt}function Qg(xt,e,At){return xt=Bg(6,xt,null,e),xt.lanes=At,xt}function Sg(xt,e,At){return e=Bg(4,xt.children!==null?xt.children:[],xt.key,e),e.lanes=At,e.stateNode={containerInfo:xt.containerInfo,pendingChildren:null,implementation:xt.implementation},e}function al(xt,e,At,kt,Bt){this.tag=e,this.containerInfo=xt,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=kt,this.onRecoverableError=Bt,this.mutableSourceEagerHydrationData=null}function bl(xt,e,At,kt,Bt,Nt,jt,Lt,er){return xt=new al(xt,e,At,Lt,er),e===1?(e=1,Nt===!0&&(e|=8)):e=0,Nt=Bg(3,null,null,e),xt.current=Nt,Nt.stateNode=xt,Nt.memoizedState={element:kt,isDehydrated:At,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(Nt),xt}function cl(xt,e,At){var kt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:kt==null?null:""+kt,children:xt,containerInfo:e,implementation:At}}function dl(xt){if(!xt)return Vf;xt=xt._reactInternals;e:{if(Vb(xt)!==xt||xt.tag!==1)throw Error(p$1(170));var e=xt;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Zf(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(p$1(171))}if(xt.tag===1){var At=xt.type;if(Zf(At))return bg(xt,At,e)}return e}function el(xt,e,At,kt,Bt,Nt,jt,Lt,er){return xt=bl(At,kt,!0,xt,Bt,Nt,jt,Lt,er),xt.context=dl(null),At=xt.current,kt=R$2(),Bt=yi(At),Nt=mh(kt,Bt),Nt.callback=e??null,nh(At,Nt,Bt),xt.current.lanes=Bt,Ac(xt,Bt,kt),Dk(xt,kt),xt}function fl(xt,e,At,kt){var Bt=e.current,Nt=R$2(),jt=yi(Bt);return At=dl(At),e.context===null?e.context=At:e.pendingContext=At,e=mh(Nt,jt),e.payload={element:xt},kt=kt===void 0?null:kt,kt!==null&&(e.callback=kt),xt=nh(Bt,e,jt),xt!==null&&(gi(xt,Bt,jt,Nt),oh(xt,Bt,jt)),jt}function gl(xt){if(xt=xt.current,!xt.child)return null;switch(xt.child.tag){case 5:return xt.child.stateNode;default:return xt.child.stateNode}}function hl$1(xt,e){if(xt=xt.memoizedState,xt!==null&&xt.dehydrated!==null){var At=xt.retryLane;xt.retryLane=At!==0&&At<e?At:e}}function il(xt,e){hl$1(xt,e),(xt=xt.alternate)&&hl$1(xt,e)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(xt){console.error(xt)};function ll(xt){this._internalRoot=xt}ml.prototype.render=ll.prototype.render=function(xt){var e=this._internalRoot;if(e===null)throw Error(p$1(409));fl(xt,e,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var xt=this._internalRoot;if(xt!==null){this._internalRoot=null;var e=xt.containerInfo;Rk(function(){fl(null,xt,null,null)}),e[uf]=null}};function ml(xt){this._internalRoot=xt}ml.prototype.unstable_scheduleHydration=function(xt){if(xt){var e=Hc();xt={blockedOn:null,target:xt,priority:e};for(var At=0;At<Qc.length&&e!==0&&e<Qc[At].priority;At++);Qc.splice(At,0,xt),At===0&&Vc(xt)}};function nl(xt){return!(!xt||xt.nodeType!==1&&xt.nodeType!==9&&xt.nodeType!==11)}function ol(xt){return!(!xt||xt.nodeType!==1&&xt.nodeType!==9&&xt.nodeType!==11&&(xt.nodeType!==8||xt.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(xt,e,At,kt,Bt){if(Bt){if(typeof kt=="function"){var Nt=kt;kt=function(){var tr=gl(jt);Nt.call(tr)}}var jt=el(e,kt,xt,0,null,!1,!1,"",pl);return xt._reactRootContainer=jt,xt[uf]=jt.current,sf(xt.nodeType===8?xt.parentNode:xt),Rk(),jt}for(;Bt=xt.lastChild;)xt.removeChild(Bt);if(typeof kt=="function"){var Lt=kt;kt=function(){var tr=gl(er);Lt.call(tr)}}var er=bl(xt,0,!1,null,null,!1,!1,"",pl);return xt._reactRootContainer=er,xt[uf]=er.current,sf(xt.nodeType===8?xt.parentNode:xt),Rk(function(){fl(e,er,At,kt)}),er}function rl(xt,e,At,kt,Bt){var Nt=At._reactRootContainer;if(Nt){var jt=Nt;if(typeof Bt=="function"){var Lt=Bt;Bt=function(){var er=gl(jt);Lt.call(er)}}fl(e,jt,xt,Bt)}else jt=ql(At,e,xt,Bt,kt);return gl(jt)}Ec=function(xt){switch(xt.tag){case 3:var e=xt.stateNode;if(e.current.memoizedState.isDehydrated){var At=tc(e.pendingLanes);At!==0&&(Cc(e,At|1),Dk(e,B$1()),!(K$6&6)&&(Gj=B$1()+500,jg()))}break;case 13:Rk(function(){var kt=ih(xt,1);if(kt!==null){var Bt=R$2();gi(kt,xt,1,Bt)}}),il(xt,1)}};Fc=function(xt){if(xt.tag===13){var e=ih(xt,134217728);if(e!==null){var At=R$2();gi(e,xt,134217728,At)}il(xt,134217728)}};Gc=function(xt){if(xt.tag===13){var e=yi(xt),At=ih(xt,e);if(At!==null){var kt=R$2();gi(At,xt,e,kt)}il(xt,e)}};Hc=function(){return C$1};Ic=function(xt,e){var At=C$1;try{return C$1=xt,e()}finally{C$1=At}};yb=function(xt,e,At){switch(e){case"input":if(bb(xt,At),e=At.name,At.type==="radio"&&e!=null){for(At=xt;At.parentNode;)At=At.parentNode;for(At=At.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<At.length;e++){var kt=At[e];if(kt!==xt&&kt.form===xt.form){var Bt=Db(kt);if(!Bt)throw Error(p$1(90));Wa(kt),bb(kt,Bt)}}}break;case"textarea":ib(xt,At);break;case"select":e=At.value,e!=null&&fb(xt,!!At.multiple,e,!1)}};Gb=Qk;Hb=Rk;var sl$1={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(xt){return xt=Zb(xt),xt===null?null:xt.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl$1;reactDom_production_min.createPortal=function(xt,e){var At=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(e))throw Error(p$1(200));return cl(xt,e,null,At)};reactDom_production_min.createRoot=function(xt,e){if(!nl(xt))throw Error(p$1(299));var At=!1,kt="",Bt=kl;return e!=null&&(e.unstable_strictMode===!0&&(At=!0),e.identifierPrefix!==void 0&&(kt=e.identifierPrefix),e.onRecoverableError!==void 0&&(Bt=e.onRecoverableError)),e=bl(xt,1,!1,null,null,At,!1,kt,Bt),xt[uf]=e.current,sf(xt.nodeType===8?xt.parentNode:xt),new ll(e)};reactDom_production_min.findDOMNode=function(xt){if(xt==null)return null;if(xt.nodeType===1)return xt;var e=xt._reactInternals;if(e===void 0)throw typeof xt.render=="function"?Error(p$1(188)):(xt=Object.keys(xt).join(","),Error(p$1(268,xt)));return xt=Zb(e),xt=xt===null?null:xt.stateNode,xt};reactDom_production_min.flushSync=function(xt){return Rk(xt)};reactDom_production_min.hydrate=function(xt,e,At){if(!ol(e))throw Error(p$1(200));return rl(null,xt,e,!0,At)};reactDom_production_min.hydrateRoot=function(xt,e,At){if(!nl(xt))throw Error(p$1(405));var kt=At!=null&&At.hydratedSources||null,Bt=!1,Nt="",jt=kl;if(At!=null&&(At.unstable_strictMode===!0&&(Bt=!0),At.identifierPrefix!==void 0&&(Nt=At.identifierPrefix),At.onRecoverableError!==void 0&&(jt=At.onRecoverableError)),e=el(e,null,xt,1,At??null,Bt,!1,Nt,jt),xt[uf]=e.current,sf(xt),kt)for(xt=0;xt<kt.length;xt++)At=kt[xt],Bt=At._getVersion,Bt=Bt(At._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[At,Bt]:e.mutableSourceEagerHydrationData.push(At,Bt);return new ml(e)};reactDom_production_min.render=function(xt,e,At){if(!ol(e))throw Error(p$1(200));return rl(null,xt,e,!1,At)};reactDom_production_min.unmountComponentAtNode=function(xt){if(!ol(xt))throw Error(p$1(40));return xt._reactRootContainer?(Rk(function(){rl(null,null,xt,!1,function(){xt._reactRootContainer=null,xt[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(xt,e,At,kt){if(!ol(At))throw Error(p$1(200));if(xt==null||xt._reactInternals===void 0)throw Error(p$1(38));return rl(xt,e,At,!1,kt)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(xt){console.error(xt)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const ReactDOM=getDefaultExportFromCjs(reactDomExports);var m$2=reactDomExports;client.createRoot=m$2.createRoot,client.hydrateRoot=m$2.hydrateRoot;/**
 * @remix-run/router v1.18.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(xt){for(var e=1;e<arguments.length;e++){var At=arguments[e];for(var kt in At)Object.prototype.hasOwnProperty.call(At,kt)&&(xt[kt]=At[kt])}return xt},_extends$1.apply(this,arguments)}var Action;(function(xt){xt.Pop="POP",xt.Push="PUSH",xt.Replace="REPLACE"})(Action||(Action={}));const PopStateEventType="popstate";function createBrowserHistory(xt){xt===void 0&&(xt={});function e(kt,Bt){let{pathname:Nt,search:jt,hash:Lt}=kt.location;return createLocation("",{pathname:Nt,search:jt,hash:Lt},Bt.state&&Bt.state.usr||null,Bt.state&&Bt.state.key||"default")}function At(kt,Bt){return typeof Bt=="string"?Bt:createPath(Bt)}return getUrlBasedHistory(e,At,null,xt)}function invariant(xt,e){if(xt===!1||xt===null||typeof xt>"u")throw new Error(e)}function warning(xt,e){if(!xt){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function createKey(){return Math.random().toString(36).substr(2,8)}function getHistoryState(xt,e){return{usr:xt.state,key:xt.key,idx:e}}function createLocation(xt,e,At,kt){return At===void 0&&(At=null),_extends$1({pathname:typeof xt=="string"?xt:xt.pathname,search:"",hash:""},typeof e=="string"?parsePath(e):e,{state:At,key:e&&e.key||kt||createKey()})}function createPath(xt){let{pathname:e="/",search:At="",hash:kt=""}=xt;return At&&At!=="?"&&(e+=At.charAt(0)==="?"?At:"?"+At),kt&&kt!=="#"&&(e+=kt.charAt(0)==="#"?kt:"#"+kt),e}function parsePath(xt){let e={};if(xt){let At=xt.indexOf("#");At>=0&&(e.hash=xt.substr(At),xt=xt.substr(0,At));let kt=xt.indexOf("?");kt>=0&&(e.search=xt.substr(kt),xt=xt.substr(0,kt)),xt&&(e.pathname=xt)}return e}function getUrlBasedHistory(xt,e,At,kt){kt===void 0&&(kt={});let{window:Bt=document.defaultView,v5Compat:Nt=!1}=kt,jt=Bt.history,Lt=Action.Pop,er=null,tr=zt();tr==null&&(tr=0,jt.replaceState(_extends$1({},jt.state,{idx:tr}),""));function zt(){return(jt.state||{idx:null}).idx}function rr(){Lt=Action.Pop;let ur=zt(),fr=ur==null?null:ur-tr;tr=ur,er&&er({action:Lt,location:dr.location,delta:fr})}function nr(ur,fr){Lt=Action.Push;let pr=createLocation(dr.location,ur,fr);tr=zt()+1;let lr=getHistoryState(pr,tr),yr=dr.createHref(pr);try{jt.pushState(lr,"",yr)}catch(br){if(br instanceof DOMException&&br.name==="DataCloneError")throw br;Bt.location.assign(yr)}Nt&&er&&er({action:Lt,location:dr.location,delta:1})}function ir(ur,fr){Lt=Action.Replace;let pr=createLocation(dr.location,ur,fr);tr=zt();let lr=getHistoryState(pr,tr),yr=dr.createHref(pr);jt.replaceState(lr,"",yr),Nt&&er&&er({action:Lt,location:dr.location,delta:0})}function ar(ur){let fr=Bt.location.origin!=="null"?Bt.location.origin:Bt.location.href,pr=typeof ur=="string"?ur:createPath(ur);return pr=pr.replace(/ $/,"%20"),invariant(fr,"No window.location.(origin|href) available to create URL for href: "+pr),new URL(pr,fr)}let dr={get action(){return Lt},get location(){return xt(Bt,jt)},listen(ur){if(er)throw new Error("A history only accepts one active listener");return Bt.addEventListener(PopStateEventType,rr),er=ur,()=>{Bt.removeEventListener(PopStateEventType,rr),er=null}},createHref(ur){return e(Bt,ur)},createURL:ar,encodeLocation(ur){let fr=ar(ur);return{pathname:fr.pathname,search:fr.search,hash:fr.hash}},push:nr,replace:ir,go(ur){return jt.go(ur)}};return dr}var ResultType;(function(xt){xt.data="data",xt.deferred="deferred",xt.redirect="redirect",xt.error="error"})(ResultType||(ResultType={}));function matchRoutes(xt,e,At){return At===void 0&&(At="/"),matchRoutesImpl(xt,e,At,!1)}function matchRoutesImpl(xt,e,At,kt){let Bt=typeof e=="string"?parsePath(e):e,Nt=stripBasename(Bt.pathname||"/",At);if(Nt==null)return null;let jt=flattenRoutes(xt);rankRouteBranches(jt);let Lt=null;for(let er=0;Lt==null&&er<jt.length;++er){let tr=decodePath(Nt);Lt=matchRouteBranch(jt[er],tr,kt)}return Lt}function flattenRoutes(xt,e,At,kt){e===void 0&&(e=[]),At===void 0&&(At=[]),kt===void 0&&(kt="");let Bt=(Nt,jt,Lt)=>{let er={relativePath:Lt===void 0?Nt.path||"":Lt,caseSensitive:Nt.caseSensitive===!0,childrenIndex:jt,route:Nt};er.relativePath.startsWith("/")&&(invariant(er.relativePath.startsWith(kt),'Absolute route path "'+er.relativePath+'" nested under path '+('"'+kt+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),er.relativePath=er.relativePath.slice(kt.length));let tr=joinPaths([kt,er.relativePath]),zt=At.concat(er);Nt.children&&Nt.children.length>0&&(invariant(Nt.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+tr+'".')),flattenRoutes(Nt.children,e,zt,tr)),!(Nt.path==null&&!Nt.index)&&e.push({path:tr,score:computeScore(tr,Nt.index),routesMeta:zt})};return xt.forEach((Nt,jt)=>{var Lt;if(Nt.path===""||!((Lt=Nt.path)!=null&&Lt.includes("?")))Bt(Nt,jt);else for(let er of explodeOptionalSegments(Nt.path))Bt(Nt,jt,er)}),e}function explodeOptionalSegments(xt){let e=xt.split("/");if(e.length===0)return[];let[At,...kt]=e,Bt=At.endsWith("?"),Nt=At.replace(/\?$/,"");if(kt.length===0)return Bt?[Nt,""]:[Nt];let jt=explodeOptionalSegments(kt.join("/")),Lt=[];return Lt.push(...jt.map(er=>er===""?Nt:[Nt,er].join("/"))),Bt&&Lt.push(...jt),Lt.map(er=>xt.startsWith("/")&&er===""?"/":er)}function rankRouteBranches(xt){xt.sort((e,At)=>e.score!==At.score?At.score-e.score:compareIndexes(e.routesMeta.map(kt=>kt.childrenIndex),At.routesMeta.map(kt=>kt.childrenIndex)))}const paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=xt=>xt==="*";function computeScore(xt,e){let At=xt.split("/"),kt=At.length;return At.some(isSplat)&&(kt+=splatPenalty),e&&(kt+=indexRouteValue),At.filter(Bt=>!isSplat(Bt)).reduce((Bt,Nt)=>Bt+(paramRe.test(Nt)?dynamicSegmentValue:Nt===""?emptySegmentValue:staticSegmentValue),kt)}function compareIndexes(xt,e){return xt.length===e.length&&xt.slice(0,-1).every((kt,Bt)=>kt===e[Bt])?xt[xt.length-1]-e[e.length-1]:0}function matchRouteBranch(xt,e,At){let{routesMeta:kt}=xt,Bt={},Nt="/",jt=[];for(let Lt=0;Lt<kt.length;++Lt){let er=kt[Lt],tr=Lt===kt.length-1,zt=Nt==="/"?e:e.slice(Nt.length)||"/",rr=matchPath({path:er.relativePath,caseSensitive:er.caseSensitive,end:tr},zt),nr=er.route;if(!rr&&tr&&At&&!kt[kt.length-1].route.index&&(rr=matchPath({path:er.relativePath,caseSensitive:er.caseSensitive,end:!1},zt)),!rr)return null;Object.assign(Bt,rr.params),jt.push({params:Bt,pathname:joinPaths([Nt,rr.pathname]),pathnameBase:normalizePathname(joinPaths([Nt,rr.pathnameBase])),route:nr}),rr.pathnameBase!=="/"&&(Nt=joinPaths([Nt,rr.pathnameBase]))}return jt}function matchPath(xt,e){typeof xt=="string"&&(xt={path:xt,caseSensitive:!1,end:!0});let[At,kt]=compilePath(xt.path,xt.caseSensitive,xt.end),Bt=e.match(At);if(!Bt)return null;let Nt=Bt[0],jt=Nt.replace(/(.)\/+$/,"$1"),Lt=Bt.slice(1);return{params:kt.reduce((tr,zt,rr)=>{let{paramName:nr,isOptional:ir}=zt;if(nr==="*"){let dr=Lt[rr]||"";jt=Nt.slice(0,Nt.length-dr.length).replace(/(.)\/+$/,"$1")}const ar=Lt[rr];return ir&&!ar?tr[nr]=void 0:tr[nr]=(ar||"").replace(/%2F/g,"/"),tr},{}),pathname:Nt,pathnameBase:jt,pattern:xt}}function compilePath(xt,e,At){e===void 0&&(e=!1),At===void 0&&(At=!0),warning(xt==="*"||!xt.endsWith("*")||xt.endsWith("/*"),'Route path "'+xt+'" will be treated as if it were '+('"'+xt.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+xt.replace(/\*$/,"/*")+'".'));let kt=[],Bt="^"+xt.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(jt,Lt,er)=>(kt.push({paramName:Lt,isOptional:er!=null}),er?"/?([^\\/]+)?":"/([^\\/]+)"));return xt.endsWith("*")?(kt.push({paramName:"*"}),Bt+=xt==="*"||xt==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):At?Bt+="\\/*$":xt!==""&&xt!=="/"&&(Bt+="(?:(?=\\/|$))"),[new RegExp(Bt,e?void 0:"i"),kt]}function decodePath(xt){try{return xt.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return warning(!1,'The URL path "'+xt+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),xt}}function stripBasename(xt,e){if(e==="/")return xt;if(!xt.toLowerCase().startsWith(e.toLowerCase()))return null;let At=e.endsWith("/")?e.length-1:e.length,kt=xt.charAt(At);return kt&&kt!=="/"?null:xt.slice(At)||"/"}function resolvePath(xt,e){e===void 0&&(e="/");let{pathname:At,search:kt="",hash:Bt=""}=typeof xt=="string"?parsePath(xt):xt;return{pathname:At?At.startsWith("/")?At:resolvePathname(At,e):e,search:normalizeSearch(kt),hash:normalizeHash(Bt)}}function resolvePathname(xt,e){let At=e.replace(/\/+$/,"").split("/");return xt.split("/").forEach(Bt=>{Bt===".."?At.length>1&&At.pop():Bt!=="."&&At.push(Bt)}),At.length>1?At.join("/"):"/"}function getInvalidPathError(xt,e,At,kt){return"Cannot include a '"+xt+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(kt)+"].  Please separate it out to the ")+("`to."+At+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function getPathContributingMatches(xt){return xt.filter((e,At)=>At===0||e.route.path&&e.route.path.length>0)}function getResolveToMatches(xt,e){let At=getPathContributingMatches(xt);return e?At.map((kt,Bt)=>Bt===At.length-1?kt.pathname:kt.pathnameBase):At.map(kt=>kt.pathnameBase)}function resolveTo(xt,e,At,kt){kt===void 0&&(kt=!1);let Bt;typeof xt=="string"?Bt=parsePath(xt):(Bt=_extends$1({},xt),invariant(!Bt.pathname||!Bt.pathname.includes("?"),getInvalidPathError("?","pathname","search",Bt)),invariant(!Bt.pathname||!Bt.pathname.includes("#"),getInvalidPathError("#","pathname","hash",Bt)),invariant(!Bt.search||!Bt.search.includes("#"),getInvalidPathError("#","search","hash",Bt)));let Nt=xt===""||Bt.pathname==="",jt=Nt?"/":Bt.pathname,Lt;if(jt==null)Lt=At;else{let rr=e.length-1;if(!kt&&jt.startsWith("..")){let nr=jt.split("/");for(;nr[0]==="..";)nr.shift(),rr-=1;Bt.pathname=nr.join("/")}Lt=rr>=0?e[rr]:"/"}let er=resolvePath(Bt,Lt),tr=jt&&jt!=="/"&&jt.endsWith("/"),zt=(Nt||jt===".")&&At.endsWith("/");return!er.pathname.endsWith("/")&&(tr||zt)&&(er.pathname+="/"),er}const joinPaths=xt=>xt.join("/").replace(/\/\/+/g,"/"),normalizePathname=xt=>xt.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=xt=>!xt||xt==="?"?"":xt.startsWith("?")?xt:"?"+xt,normalizeHash=xt=>!xt||xt==="#"?"":xt.startsWith("#")?xt:"#"+xt;function isRouteErrorResponse(xt){return xt!=null&&typeof xt.status=="number"&&typeof xt.statusText=="string"&&typeof xt.internal=="boolean"&&"data"in xt}const validMutationMethodsArr=["post","put","patch","delete"];new Set(validMutationMethodsArr);const validRequestMethodsArr=["get",...validMutationMethodsArr];new Set(validRequestMethodsArr);/**
 * React Router v6.25.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends(){return _extends=Object.assign?Object.assign.bind():function(xt){for(var e=1;e<arguments.length;e++){var At=arguments[e];for(var kt in At)Object.prototype.hasOwnProperty.call(At,kt)&&(xt[kt]=At[kt])}return xt},_extends.apply(this,arguments)}const DataRouterContext=reactExports.createContext(null),DataRouterStateContext=reactExports.createContext(null),NavigationContext=reactExports.createContext(null),LocationContext=reactExports.createContext(null),RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1}),RouteErrorContext=reactExports.createContext(null);function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return useInRouterContext()||invariant(!1),reactExports.useContext(LocationContext).location}function useIsomorphicLayoutEffect$1(xt){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(xt)}function useNavigate(){let{isDataRoute:xt}=reactExports.useContext(RouteContext);return xt?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){useInRouterContext()||invariant(!1);let xt=reactExports.useContext(DataRouterContext),{basename:e,future:At,navigator:kt}=reactExports.useContext(NavigationContext),{matches:Bt}=reactExports.useContext(RouteContext),{pathname:Nt}=useLocation(),jt=JSON.stringify(getResolveToMatches(Bt,At.v7_relativeSplatPath)),Lt=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>{Lt.current=!0}),reactExports.useCallback(function(tr,zt){if(zt===void 0&&(zt={}),!Lt.current)return;if(typeof tr=="number"){kt.go(tr);return}let rr=resolveTo(tr,JSON.parse(jt),Nt,zt.relative==="path");xt==null&&e!=="/"&&(rr.pathname=rr.pathname==="/"?e:joinPaths([e,rr.pathname])),(zt.replace?kt.replace:kt.push)(rr,zt.state,zt)},[e,kt,jt,Nt,xt])}function useRoutes(xt,e){return useRoutesImpl(xt,e)}function useRoutesImpl(xt,e,At,kt){useInRouterContext()||invariant(!1);let{navigator:Bt}=reactExports.useContext(NavigationContext),{matches:Nt}=reactExports.useContext(RouteContext),jt=Nt[Nt.length-1],Lt=jt?jt.params:{};jt&&jt.pathname;let er=jt?jt.pathnameBase:"/";jt&&jt.route;let tr=useLocation(),zt;if(e){var rr;let ur=typeof e=="string"?parsePath(e):e;er==="/"||(rr=ur.pathname)!=null&&rr.startsWith(er)||invariant(!1),zt=ur}else zt=tr;let nr=zt.pathname||"/",ir=nr;if(er!=="/"){let ur=er.replace(/^\//,"").split("/");ir="/"+nr.replace(/^\//,"").split("/").slice(ur.length).join("/")}let ar=matchRoutes(xt,{pathname:ir}),dr=_renderMatches(ar&&ar.map(ur=>Object.assign({},ur,{params:Object.assign({},Lt,ur.params),pathname:joinPaths([er,Bt.encodeLocation?Bt.encodeLocation(ur.pathname).pathname:ur.pathname]),pathnameBase:ur.pathnameBase==="/"?er:joinPaths([er,Bt.encodeLocation?Bt.encodeLocation(ur.pathnameBase).pathname:ur.pathnameBase])})),Nt,At,kt);return e&&dr?reactExports.createElement(LocationContext.Provider,{value:{location:_extends({pathname:"/",search:"",hash:"",state:null,key:"default"},zt),navigationType:Action.Pop}},dr):dr}function DefaultErrorComponent(){let xt=useRouteError(),e=isRouteErrorResponse(xt)?xt.status+" "+xt.statusText:xt instanceof Error?xt.message:JSON.stringify(xt),At=xt instanceof Error?xt.stack:null,Bt={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},e),At?reactExports.createElement("pre",{style:Bt},At):null,null)}const defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null);class RenderErrorBoundary extends reactExports.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,At){return At.location!==e.location||At.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:At.error,location:At.location,revalidation:e.revalidation||At.revalidation}}componentDidCatch(e,At){console.error("React Router caught the following error during render",e,At)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RenderedRoute(xt){let{routeContext:e,match:At,children:kt}=xt,Bt=reactExports.useContext(DataRouterContext);return Bt&&Bt.static&&Bt.staticContext&&(At.route.errorElement||At.route.ErrorBoundary)&&(Bt.staticContext._deepestRenderedBoundaryId=At.route.id),reactExports.createElement(RouteContext.Provider,{value:e},kt)}function _renderMatches(xt,e,At,kt){var Bt;if(e===void 0&&(e=[]),At===void 0&&(At=null),kt===void 0&&(kt=null),xt==null){var Nt;if((Nt=At)!=null&&Nt.errors)xt=At.matches;else return null}let jt=xt,Lt=(Bt=At)==null?void 0:Bt.errors;if(Lt!=null){let zt=jt.findIndex(rr=>rr.route.id&&(Lt==null?void 0:Lt[rr.route.id])!==void 0);zt>=0||invariant(!1),jt=jt.slice(0,Math.min(jt.length,zt+1))}let er=!1,tr=-1;if(At&&kt&&kt.v7_partialHydration)for(let zt=0;zt<jt.length;zt++){let rr=jt[zt];if((rr.route.HydrateFallback||rr.route.hydrateFallbackElement)&&(tr=zt),rr.route.id){let{loaderData:nr,errors:ir}=At,ar=rr.route.loader&&nr[rr.route.id]===void 0&&(!ir||ir[rr.route.id]===void 0);if(rr.route.lazy||ar){er=!0,tr>=0?jt=jt.slice(0,tr+1):jt=[jt[0]];break}}}return jt.reduceRight((zt,rr,nr)=>{let ir,ar=!1,dr=null,ur=null;At&&(ir=Lt&&rr.route.id?Lt[rr.route.id]:void 0,dr=rr.route.errorElement||defaultErrorElement,er&&(tr<0&&nr===0?(ar=!0,ur=null):tr===nr&&(ar=!0,ur=rr.route.hydrateFallbackElement||null)));let fr=e.concat(jt.slice(0,nr+1)),pr=()=>{let lr;return ir?lr=dr:ar?lr=ur:rr.route.Component?lr=reactExports.createElement(rr.route.Component,null):rr.route.element?lr=rr.route.element:lr=zt,reactExports.createElement(RenderedRoute,{match:rr,routeContext:{outlet:zt,matches:fr,isDataRoute:At!=null},children:lr})};return At&&(rr.route.ErrorBoundary||rr.route.errorElement||nr===0)?reactExports.createElement(RenderErrorBoundary,{location:At.location,revalidation:At.revalidation,component:dr,error:ir,children:pr(),routeContext:{outlet:null,matches:fr,isDataRoute:!0}}):pr()},null)}var DataRouterHook$1=function(xt){return xt.UseBlocker="useBlocker",xt.UseRevalidator="useRevalidator",xt.UseNavigateStable="useNavigate",xt}(DataRouterHook$1||{}),DataRouterStateHook$1=function(xt){return xt.UseBlocker="useBlocker",xt.UseLoaderData="useLoaderData",xt.UseActionData="useActionData",xt.UseRouteError="useRouteError",xt.UseNavigation="useNavigation",xt.UseRouteLoaderData="useRouteLoaderData",xt.UseMatches="useMatches",xt.UseRevalidator="useRevalidator",xt.UseNavigateStable="useNavigate",xt.UseRouteId="useRouteId",xt}(DataRouterStateHook$1||{});function useDataRouterContext(xt){let e=reactExports.useContext(DataRouterContext);return e||invariant(!1),e}function useDataRouterState(xt){let e=reactExports.useContext(DataRouterStateContext);return e||invariant(!1),e}function useRouteContext(xt){let e=reactExports.useContext(RouteContext);return e||invariant(!1),e}function useCurrentRouteId(xt){let e=useRouteContext(),At=e.matches[e.matches.length-1];return At.route.id||invariant(!1),At.route.id}function useRouteError(){var xt;let e=reactExports.useContext(RouteErrorContext),At=useDataRouterState(DataRouterStateHook$1.UseRouteError),kt=useCurrentRouteId(DataRouterStateHook$1.UseRouteError);return e!==void 0?e:(xt=At.errors)==null?void 0:xt[kt]}function useNavigateStable(){let{router:xt}=useDataRouterContext(DataRouterHook$1.UseNavigateStable),e=useCurrentRouteId(DataRouterStateHook$1.UseNavigateStable),At=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>{At.current=!0}),reactExports.useCallback(function(Bt,Nt){Nt===void 0&&(Nt={}),At.current&&(typeof Bt=="number"?xt.navigate(Bt):xt.navigate(Bt,_extends({fromRouteId:e},Nt)))},[xt,e])}function Route(xt){invariant(!1)}function Router(xt){let{basename:e="/",children:At=null,location:kt,navigationType:Bt=Action.Pop,navigator:Nt,static:jt=!1,future:Lt}=xt;useInRouterContext()&&invariant(!1);let er=e.replace(/^\/*/,"/"),tr=reactExports.useMemo(()=>({basename:er,navigator:Nt,static:jt,future:_extends({v7_relativeSplatPath:!1},Lt)}),[er,Lt,Nt,jt]);typeof kt=="string"&&(kt=parsePath(kt));let{pathname:zt="/",search:rr="",hash:nr="",state:ir=null,key:ar="default"}=kt,dr=reactExports.useMemo(()=>{let ur=stripBasename(zt,er);return ur==null?null:{location:{pathname:ur,search:rr,hash:nr,state:ir,key:ar},navigationType:Bt}},[er,zt,rr,nr,ir,ar,Bt]);return dr==null?null:reactExports.createElement(NavigationContext.Provider,{value:tr},reactExports.createElement(LocationContext.Provider,{children:At,value:dr}))}function Routes(xt){let{children:e,location:At}=xt;return useRoutes(createRoutesFromChildren(e),At)}new Promise(()=>{});function createRoutesFromChildren(xt,e){e===void 0&&(e=[]);let At=[];return reactExports.Children.forEach(xt,(kt,Bt)=>{if(!reactExports.isValidElement(kt))return;let Nt=[...e,Bt];if(kt.type===reactExports.Fragment){At.push.apply(At,createRoutesFromChildren(kt.props.children,Nt));return}kt.type!==Route&&invariant(!1),!kt.props.index||!kt.props.children||invariant(!1);let jt={id:kt.props.id||Nt.join("-"),caseSensitive:kt.props.caseSensitive,element:kt.props.element,Component:kt.props.Component,index:kt.props.index,path:kt.props.path,loader:kt.props.loader,action:kt.props.action,errorElement:kt.props.errorElement,ErrorBoundary:kt.props.ErrorBoundary,hasErrorBoundary:kt.props.ErrorBoundary!=null||kt.props.errorElement!=null,shouldRevalidate:kt.props.shouldRevalidate,handle:kt.props.handle,lazy:kt.props.lazy};kt.props.children&&(jt.children=createRoutesFromChildren(kt.props.children,Nt)),At.push(jt)}),At}/**
 * React Router DOM v6.25.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const REACT_ROUTER_VERSION="6";try{window.__reactRouterVersion=REACT_ROUTER_VERSION}catch{}const START_TRANSITION="startTransition",startTransitionImpl=React$1[START_TRANSITION];function BrowserRouter(xt){let{basename:e,children:At,future:kt,window:Bt}=xt,Nt=reactExports.useRef();Nt.current==null&&(Nt.current=createBrowserHistory({window:Bt,v5Compat:!0}));let jt=Nt.current,[Lt,er]=reactExports.useState({action:jt.action,location:jt.location}),{v7_startTransition:tr}=kt||{},zt=reactExports.useCallback(rr=>{tr&&startTransitionImpl?startTransitionImpl(()=>er(rr)):er(rr)},[er,tr]);return reactExports.useLayoutEffect(()=>jt.listen(zt),[jt,zt]),reactExports.createElement(Router,{basename:e,children:At,location:Lt.location,navigationType:Lt.action,navigator:jt,future:kt})}var DataRouterHook;(function(xt){xt.UseScrollRestoration="useScrollRestoration",xt.UseSubmit="useSubmit",xt.UseSubmitFetcher="useSubmitFetcher",xt.UseFetcher="useFetcher",xt.useViewTransitionState="useViewTransitionState"})(DataRouterHook||(DataRouterHook={}));var DataRouterStateHook;(function(xt){xt.UseFetcher="useFetcher",xt.UseFetchers="useFetchers",xt.UseScrollRestoration="useScrollRestoration"})(DataRouterStateHook||(DataRouterStateHook={}));const scriptRel="modulepreload",assetsURL=function(xt){return"/dwa-demo/"+xt},seen={},__vitePreload=function(e,At,kt){let Bt=Promise.resolve();if(At&&At.length>0){document.getElementsByTagName("link");const Nt=document.querySelector("meta[property=csp-nonce]"),jt=(Nt==null?void 0:Nt.nonce)||(Nt==null?void 0:Nt.getAttribute("nonce"));Bt=Promise.all(At.map(Lt=>{if(Lt=assetsURL(Lt),Lt in seen)return;seen[Lt]=!0;const er=Lt.endsWith(".css"),tr=er?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Lt}"]${tr}`))return;const zt=document.createElement("link");if(zt.rel=er?"stylesheet":scriptRel,er||(zt.as="script",zt.crossOrigin=""),zt.href=Lt,jt&&zt.setAttribute("nonce",jt),document.head.appendChild(zt),er)return new Promise((rr,nr)=>{zt.addEventListener("load",rr),zt.addEventListener("error",()=>nr(new Error(`Unable to preload CSS for ${Lt}`)))})}))}return Bt.then(()=>e()).catch(Nt=>{const jt=new Event("vite:preloadError",{cancelable:!0});if(jt.payload=Nt,window.dispatchEvent(jt),!jt.defaultPrevented)throw Nt})};function registerSW(xt={}){const{immediate:e=!1,onNeedRefresh:At,onOfflineReady:kt,onRegistered:Bt,onRegisteredSW:Nt,onRegisterError:jt}=xt;let Lt,er,tr;const zt=async(nr=!0)=>{await er,await(tr==null?void 0:tr())};async function rr(){if("serviceWorker"in navigator){if(Lt=await __vitePreload(async()=>{const{Workbox:nr}=await import("./workbox-window.prod.es5-D5gOYdM7.js");return{Workbox:nr}},[]).then(({Workbox:nr})=>new nr("/dwa-demo/sw.js",{scope:"/dwa-demo/",type:"classic"})).catch(nr=>{jt==null||jt(nr)}),!Lt)return;tr=async()=>{await(Lt==null?void 0:Lt.messageSkipWaiting())};{let nr=!1;const ir=()=>{nr=!0,Lt==null||Lt.addEventListener("controlling",ar=>{ar.isUpdate&&window.location.reload()}),At==null||At()};Lt.addEventListener("installed",ar=>{typeof ar.isUpdate>"u"?typeof ar.isExternal<"u"?ar.isExternal?ir():!nr&&(kt==null||kt()):ar.isExternal?window.location.reload():!nr&&(kt==null||kt()):ar.isUpdate||kt==null||kt()}),Lt.addEventListener("waiting",ir),Lt.addEventListener("externalwaiting",ir)}Lt.register({immediate:e}).then(nr=>{Nt?Nt("/dwa-demo/sw.js",nr):Bt==null||Bt(nr)}).catch(nr=>{jt==null||jt(nr)})}}return er=rr(),zt}function useRegisterSW(xt={}){const{immediate:e=!0,onNeedRefresh:At,onOfflineReady:kt,onRegistered:Bt,onRegisteredSW:Nt,onRegisterError:jt}=xt,[Lt,er]=reactExports.useState(!1),[tr,zt]=reactExports.useState(!1),[rr]=reactExports.useState(()=>registerSW({immediate:e,onOfflineReady(){zt(!0),kt==null||kt()},onNeedRefresh(){er(!0),At==null||At()},onRegistered:Bt,onRegisteredSW:Nt,onRegisterError:jt}));return{needRefresh:[Lt,er],offlineReady:[tr,zt],updateServiceWorker:rr}}function setRef(xt,e){typeof xt=="function"?xt(e):xt!=null&&(xt.current=e)}function composeRefs(...xt){return e=>xt.forEach(At=>setRef(At,e))}function useComposedRefs(...xt){return reactExports.useCallback(composeRefs(...xt),xt)}var Slot=reactExports.forwardRef((xt,e)=>{const{children:At,...kt}=xt,Bt=reactExports.Children.toArray(At),Nt=Bt.find(isSlottable);if(Nt){const jt=Nt.props.children,Lt=Bt.map(er=>er===Nt?reactExports.Children.count(jt)>1?reactExports.Children.only(null):reactExports.isValidElement(jt)?jt.props.children:null:er);return jsxRuntimeExports.jsx(SlotClone,{...kt,ref:e,children:reactExports.isValidElement(jt)?reactExports.cloneElement(jt,void 0,Lt):null})}return jsxRuntimeExports.jsx(SlotClone,{...kt,ref:e,children:At})});Slot.displayName="Slot";var SlotClone=reactExports.forwardRef((xt,e)=>{const{children:At,...kt}=xt;if(reactExports.isValidElement(At)){const Bt=getElementRef$1(At);return reactExports.cloneElement(At,{...mergeProps(kt,At.props),ref:e?composeRefs(e,Bt):Bt})}return reactExports.Children.count(At)>1?reactExports.Children.only(null):null});SlotClone.displayName="SlotClone";var Slottable=({children:xt})=>jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:xt});function isSlottable(xt){return reactExports.isValidElement(xt)&&xt.type===Slottable}function mergeProps(xt,e){const At={...e};for(const kt in e){const Bt=xt[kt],Nt=e[kt];/^on[A-Z]/.test(kt)?Bt&&Nt?At[kt]=(...Lt)=>{Nt(...Lt),Bt(...Lt)}:Bt&&(At[kt]=Bt):kt==="style"?At[kt]={...Bt,...Nt}:kt==="className"&&(At[kt]=[Bt,Nt].filter(Boolean).join(" "))}return{...xt,...At}}function getElementRef$1(xt){var kt,Bt;let e=(kt=Object.getOwnPropertyDescriptor(xt.props,"ref"))==null?void 0:kt.get,At=e&&"isReactWarning"in e&&e.isReactWarning;return At?xt.ref:(e=(Bt=Object.getOwnPropertyDescriptor(xt,"ref"))==null?void 0:Bt.get,At=e&&"isReactWarning"in e&&e.isReactWarning,At?xt.props.ref:xt.props.ref||xt.ref)}function r$3(xt){var e,At,kt="";if(typeof xt=="string"||typeof xt=="number")kt+=xt;else if(typeof xt=="object")if(Array.isArray(xt))for(e=0;e<xt.length;e++)xt[e]&&(At=r$3(xt[e]))&&(kt&&(kt+=" "),kt+=At);else for(e in xt)xt[e]&&(kt&&(kt+=" "),kt+=e);return kt}function clsx$1(){for(var xt,e,At=0,kt="";At<arguments.length;)(xt=arguments[At++])&&(e=r$3(xt))&&(kt&&(kt+=" "),kt+=e);return kt}const falsyToString=xt=>typeof xt=="boolean"?"".concat(xt):xt===0?"0":xt,cx=clsx$1,cva=(xt,e)=>At=>{var kt;if((e==null?void 0:e.variants)==null)return cx(xt,At==null?void 0:At.class,At==null?void 0:At.className);const{variants:Bt,defaultVariants:Nt}=e,jt=Object.keys(Bt).map(tr=>{const zt=At==null?void 0:At[tr],rr=Nt==null?void 0:Nt[tr];if(zt===null)return null;const nr=falsyToString(zt)||falsyToString(rr);return Bt[tr][nr]}),Lt=At&&Object.entries(At).reduce((tr,zt)=>{let[rr,nr]=zt;return nr===void 0||(tr[rr]=nr),tr},{}),er=e==null||(kt=e.compoundVariants)===null||kt===void 0?void 0:kt.reduce((tr,zt)=>{let{class:rr,className:nr,...ir}=zt;return Object.entries(ir).every(ar=>{let[dr,ur]=ar;return Array.isArray(ur)?ur.includes({...Nt,...Lt}[dr]):{...Nt,...Lt}[dr]===ur})?[...tr,rr,nr]:tr},[]);return cx(xt,jt,er,At==null?void 0:At.class,At==null?void 0:At.className)};function r$2(xt){var e,At,kt="";if(typeof xt=="string"||typeof xt=="number")kt+=xt;else if(typeof xt=="object")if(Array.isArray(xt)){var Bt=xt.length;for(e=0;e<Bt;e++)xt[e]&&(At=r$2(xt[e]))&&(kt&&(kt+=" "),kt+=At)}else for(At in xt)xt[At]&&(kt&&(kt+=" "),kt+=At);return kt}function clsx(){for(var xt,e,At=0,kt="",Bt=arguments.length;At<Bt;At++)(xt=arguments[At])&&(e=r$2(xt))&&(kt&&(kt+=" "),kt+=e);return kt}const CLASS_PART_SEPARATOR="-";function createClassGroupUtils(xt){const e=createClassMap(xt),{conflictingClassGroups:At,conflictingClassGroupModifiers:kt}=xt;function Bt(jt){const Lt=jt.split(CLASS_PART_SEPARATOR);return Lt[0]===""&&Lt.length!==1&&Lt.shift(),getGroupRecursive(Lt,e)||getGroupIdForArbitraryProperty(jt)}function Nt(jt,Lt){const er=At[jt]||[];return Lt&&kt[jt]?[...er,...kt[jt]]:er}return{getClassGroupId:Bt,getConflictingClassGroupIds:Nt}}function getGroupRecursive(xt,e){var jt;if(xt.length===0)return e.classGroupId;const At=xt[0],kt=e.nextPart.get(At),Bt=kt?getGroupRecursive(xt.slice(1),kt):void 0;if(Bt)return Bt;if(e.validators.length===0)return;const Nt=xt.join(CLASS_PART_SEPARATOR);return(jt=e.validators.find(({validator:Lt})=>Lt(Nt)))==null?void 0:jt.classGroupId}const arbitraryPropertyRegex=/^\[(.+)\]$/;function getGroupIdForArbitraryProperty(xt){if(arbitraryPropertyRegex.test(xt)){const e=arbitraryPropertyRegex.exec(xt)[1],At=e==null?void 0:e.substring(0,e.indexOf(":"));if(At)return"arbitrary.."+At}}function createClassMap(xt){const{theme:e,prefix:At}=xt,kt={nextPart:new Map,validators:[]};return getPrefixedClassGroupEntries(Object.entries(xt.classGroups),At).forEach(([Nt,jt])=>{processClassesRecursively(jt,kt,Nt,e)}),kt}function processClassesRecursively(xt,e,At,kt){xt.forEach(Bt=>{if(typeof Bt=="string"){const Nt=Bt===""?e:getPart(e,Bt);Nt.classGroupId=At;return}if(typeof Bt=="function"){if(isThemeGetter(Bt)){processClassesRecursively(Bt(kt),e,At,kt);return}e.validators.push({validator:Bt,classGroupId:At});return}Object.entries(Bt).forEach(([Nt,jt])=>{processClassesRecursively(jt,getPart(e,Nt),At,kt)})})}function getPart(xt,e){let At=xt;return e.split(CLASS_PART_SEPARATOR).forEach(kt=>{At.nextPart.has(kt)||At.nextPart.set(kt,{nextPart:new Map,validators:[]}),At=At.nextPart.get(kt)}),At}function isThemeGetter(xt){return xt.isThemeGetter}function getPrefixedClassGroupEntries(xt,e){return e?xt.map(([At,kt])=>{const Bt=kt.map(Nt=>typeof Nt=="string"?e+Nt:typeof Nt=="object"?Object.fromEntries(Object.entries(Nt).map(([jt,Lt])=>[e+jt,Lt])):Nt);return[At,Bt]}):xt}function createLruCache(xt){if(xt<1)return{get:()=>{},set:()=>{}};let e=0,At=new Map,kt=new Map;function Bt(Nt,jt){At.set(Nt,jt),e++,e>xt&&(e=0,kt=At,At=new Map)}return{get(Nt){let jt=At.get(Nt);if(jt!==void 0)return jt;if((jt=kt.get(Nt))!==void 0)return Bt(Nt,jt),jt},set(Nt,jt){At.has(Nt)?At.set(Nt,jt):Bt(Nt,jt)}}}const IMPORTANT_MODIFIER="!";function createParseClassName(xt){const{separator:e,experimentalParseClassName:At}=xt,kt=e.length===1,Bt=e[0],Nt=e.length;function jt(Lt){const er=[];let tr=0,zt=0,rr;for(let ur=0;ur<Lt.length;ur++){let fr=Lt[ur];if(tr===0){if(fr===Bt&&(kt||Lt.slice(ur,ur+Nt)===e)){er.push(Lt.slice(zt,ur)),zt=ur+Nt;continue}if(fr==="/"){rr=ur;continue}}fr==="["?tr++:fr==="]"&&tr--}const nr=er.length===0?Lt:Lt.substring(zt),ir=nr.startsWith(IMPORTANT_MODIFIER),ar=ir?nr.substring(1):nr,dr=rr&&rr>zt?rr-zt:void 0;return{modifiers:er,hasImportantModifier:ir,baseClassName:ar,maybePostfixModifierPosition:dr}}return At?function(er){return At({className:er,parseClassName:jt})}:jt}function sortModifiers(xt){if(xt.length<=1)return xt;const e=[];let At=[];return xt.forEach(kt=>{kt[0]==="["?(e.push(...At.sort(),kt),At=[]):At.push(kt)}),e.push(...At.sort()),e}function createConfigUtils(xt){return{cache:createLruCache(xt.cacheSize),parseClassName:createParseClassName(xt),...createClassGroupUtils(xt)}}const SPLIT_CLASSES_REGEX=/\s+/;function mergeClassList(xt,e){const{parseClassName:At,getClassGroupId:kt,getConflictingClassGroupIds:Bt}=e,Nt=new Set;return xt.trim().split(SPLIT_CLASSES_REGEX).map(jt=>{const{modifiers:Lt,hasImportantModifier:er,baseClassName:tr,maybePostfixModifierPosition:zt}=At(jt);let rr=!!zt,nr=kt(rr?tr.substring(0,zt):tr);if(!nr){if(!rr)return{isTailwindClass:!1,originalClassName:jt};if(nr=kt(tr),!nr)return{isTailwindClass:!1,originalClassName:jt};rr=!1}const ir=sortModifiers(Lt).join(":");return{isTailwindClass:!0,modifierId:er?ir+IMPORTANT_MODIFIER:ir,classGroupId:nr,originalClassName:jt,hasPostfixModifier:rr}}).reverse().filter(jt=>{if(!jt.isTailwindClass)return!0;const{modifierId:Lt,classGroupId:er,hasPostfixModifier:tr}=jt,zt=Lt+er;return Nt.has(zt)?!1:(Nt.add(zt),Bt(er,tr).forEach(rr=>Nt.add(Lt+rr)),!0)}).reverse().map(jt=>jt.originalClassName).join(" ")}function twJoin(){let xt=0,e,At,kt="";for(;xt<arguments.length;)(e=arguments[xt++])&&(At=toValue(e))&&(kt&&(kt+=" "),kt+=At);return kt}function toValue(xt){if(typeof xt=="string")return xt;let e,At="";for(let kt=0;kt<xt.length;kt++)xt[kt]&&(e=toValue(xt[kt]))&&(At&&(At+=" "),At+=e);return At}function createTailwindMerge(xt,...e){let At,kt,Bt,Nt=jt;function jt(er){const tr=e.reduce((zt,rr)=>rr(zt),xt());return At=createConfigUtils(tr),kt=At.cache.get,Bt=At.cache.set,Nt=Lt,Lt(er)}function Lt(er){const tr=kt(er);if(tr)return tr;const zt=mergeClassList(er,At);return Bt(er,zt),zt}return function(){return Nt(twJoin.apply(null,arguments))}}function fromTheme(xt){const e=At=>At[xt]||[];return e.isThemeGetter=!0,e}const arbitraryValueRegex=/^\[(?:([a-z-]+):)?(.+)\]$/i,fractionRegex=/^\d+\/\d+$/,stringLengths=new Set(["px","full","screen"]),tshirtUnitRegex=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,lengthUnitRegex=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,colorFunctionRegex=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,shadowRegex=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,imageRegex=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/;function isLength(xt){return isNumber$1(xt)||stringLengths.has(xt)||fractionRegex.test(xt)}function isArbitraryLength(xt){return getIsArbitraryValue(xt,"length",isLengthOnly)}function isNumber$1(xt){return!!xt&&!Number.isNaN(Number(xt))}function isArbitraryNumber(xt){return getIsArbitraryValue(xt,"number",isNumber$1)}function isInteger(xt){return!!xt&&Number.isInteger(Number(xt))}function isPercent(xt){return xt.endsWith("%")&&isNumber$1(xt.slice(0,-1))}function isArbitraryValue(xt){return arbitraryValueRegex.test(xt)}function isTshirtSize(xt){return tshirtUnitRegex.test(xt)}const sizeLabels=new Set(["length","size","percentage"]);function isArbitrarySize(xt){return getIsArbitraryValue(xt,sizeLabels,isNever)}function isArbitraryPosition(xt){return getIsArbitraryValue(xt,"position",isNever)}const imageLabels=new Set(["image","url"]);function isArbitraryImage(xt){return getIsArbitraryValue(xt,imageLabels,isImage)}function isArbitraryShadow(xt){return getIsArbitraryValue(xt,"",isShadow)}function isAny(){return!0}function getIsArbitraryValue(xt,e,At){const kt=arbitraryValueRegex.exec(xt);return kt?kt[1]?typeof e=="string"?kt[1]===e:e.has(kt[1]):At(kt[2]):!1}function isLengthOnly(xt){return lengthUnitRegex.test(xt)&&!colorFunctionRegex.test(xt)}function isNever(){return!1}function isShadow(xt){return shadowRegex.test(xt)}function isImage(xt){return imageRegex.test(xt)}function getDefaultConfig(){const xt=fromTheme("colors"),e=fromTheme("spacing"),At=fromTheme("blur"),kt=fromTheme("brightness"),Bt=fromTheme("borderColor"),Nt=fromTheme("borderRadius"),jt=fromTheme("borderSpacing"),Lt=fromTheme("borderWidth"),er=fromTheme("contrast"),tr=fromTheme("grayscale"),zt=fromTheme("hueRotate"),rr=fromTheme("invert"),nr=fromTheme("gap"),ir=fromTheme("gradientColorStops"),ar=fromTheme("gradientColorStopPositions"),dr=fromTheme("inset"),ur=fromTheme("margin"),fr=fromTheme("opacity"),pr=fromTheme("padding"),lr=fromTheme("saturate"),yr=fromTheme("scale"),br=fromTheme("sepia"),Ar=fromTheme("skew"),Pr=fromTheme("space"),kr=fromTheme("translate"),Ur=()=>["auto","contain","none"],Hr=()=>["auto","hidden","clip","visible","scroll"],Lr=()=>["auto",isArbitraryValue,e],Sr=()=>[isArbitraryValue,e],_r=()=>["",isLength,isArbitraryLength],gr=()=>["auto",isNumber$1,isArbitraryValue],wr=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Dr=()=>["solid","dashed","dotted","double","none"],xr=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ir=()=>["start","end","center","between","around","evenly","stretch"],$r=()=>["","0",isArbitraryValue],vr=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Er=()=>[isNumber$1,isArbitraryNumber],Tr=()=>[isNumber$1,isArbitraryValue];return{cacheSize:500,separator:":",theme:{colors:[isAny],spacing:[isLength,isArbitraryLength],blur:["none","",isTshirtSize,isArbitraryValue],brightness:Er(),borderColor:[xt],borderRadius:["none","","full",isTshirtSize,isArbitraryValue],borderSpacing:Sr(),borderWidth:_r(),contrast:Er(),grayscale:$r(),hueRotate:Tr(),invert:$r(),gap:Sr(),gradientColorStops:[xt],gradientColorStopPositions:[isPercent,isArbitraryLength],inset:Lr(),margin:Lr(),opacity:Er(),padding:Sr(),saturate:Er(),scale:Er(),sepia:$r(),skew:Tr(),space:Sr(),translate:Sr()},classGroups:{aspect:[{aspect:["auto","square","video",isArbitraryValue]}],container:["container"],columns:[{columns:[isTshirtSize]}],"break-after":[{"break-after":vr()}],"break-before":[{"break-before":vr()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...wr(),isArbitraryValue]}],overflow:[{overflow:Hr()}],"overflow-x":[{"overflow-x":Hr()}],"overflow-y":[{"overflow-y":Hr()}],overscroll:[{overscroll:Ur()}],"overscroll-x":[{"overscroll-x":Ur()}],"overscroll-y":[{"overscroll-y":Ur()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[dr]}],"inset-x":[{"inset-x":[dr]}],"inset-y":[{"inset-y":[dr]}],start:[{start:[dr]}],end:[{end:[dr]}],top:[{top:[dr]}],right:[{right:[dr]}],bottom:[{bottom:[dr]}],left:[{left:[dr]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",isInteger,isArbitraryValue]}],basis:[{basis:Lr()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",isArbitraryValue]}],grow:[{grow:$r()}],shrink:[{shrink:$r()}],order:[{order:["first","last","none",isInteger,isArbitraryValue]}],"grid-cols":[{"grid-cols":[isAny]}],"col-start-end":[{col:["auto",{span:["full",isInteger,isArbitraryValue]},isArbitraryValue]}],"col-start":[{"col-start":gr()}],"col-end":[{"col-end":gr()}],"grid-rows":[{"grid-rows":[isAny]}],"row-start-end":[{row:["auto",{span:[isInteger,isArbitraryValue]},isArbitraryValue]}],"row-start":[{"row-start":gr()}],"row-end":[{"row-end":gr()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",isArbitraryValue]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",isArbitraryValue]}],gap:[{gap:[nr]}],"gap-x":[{"gap-x":[nr]}],"gap-y":[{"gap-y":[nr]}],"justify-content":[{justify:["normal",...Ir()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ir(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ir(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[pr]}],px:[{px:[pr]}],py:[{py:[pr]}],ps:[{ps:[pr]}],pe:[{pe:[pr]}],pt:[{pt:[pr]}],pr:[{pr:[pr]}],pb:[{pb:[pr]}],pl:[{pl:[pr]}],m:[{m:[ur]}],mx:[{mx:[ur]}],my:[{my:[ur]}],ms:[{ms:[ur]}],me:[{me:[ur]}],mt:[{mt:[ur]}],mr:[{mr:[ur]}],mb:[{mb:[ur]}],ml:[{ml:[ur]}],"space-x":[{"space-x":[Pr]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Pr]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",isArbitraryValue,e]}],"min-w":[{"min-w":[isArbitraryValue,e,"min","max","fit"]}],"max-w":[{"max-w":[isArbitraryValue,e,"none","full","min","max","fit","prose",{screen:[isTshirtSize]},isTshirtSize]}],h:[{h:[isArbitraryValue,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[isArbitraryValue,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[isArbitraryValue,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[isArbitraryValue,e,"auto","min","max","fit"]}],"font-size":[{text:["base",isTshirtSize,isArbitraryLength]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",isArbitraryNumber]}],"font-family":[{font:[isAny]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",isArbitraryValue]}],"line-clamp":[{"line-clamp":["none",isNumber$1,isArbitraryNumber]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",isLength,isArbitraryValue]}],"list-image":[{"list-image":["none",isArbitraryValue]}],"list-style-type":[{list:["none","disc","decimal",isArbitraryValue]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[xt]}],"placeholder-opacity":[{"placeholder-opacity":[fr]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[xt]}],"text-opacity":[{"text-opacity":[fr]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Dr(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",isLength,isArbitraryLength]}],"underline-offset":[{"underline-offset":["auto",isLength,isArbitraryValue]}],"text-decoration-color":[{decoration:[xt]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Sr()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",isArbitraryValue]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",isArbitraryValue]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[fr]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...wr(),isArbitraryPosition]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",isArbitrarySize]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},isArbitraryImage]}],"bg-color":[{bg:[xt]}],"gradient-from-pos":[{from:[ar]}],"gradient-via-pos":[{via:[ar]}],"gradient-to-pos":[{to:[ar]}],"gradient-from":[{from:[ir]}],"gradient-via":[{via:[ir]}],"gradient-to":[{to:[ir]}],rounded:[{rounded:[Nt]}],"rounded-s":[{"rounded-s":[Nt]}],"rounded-e":[{"rounded-e":[Nt]}],"rounded-t":[{"rounded-t":[Nt]}],"rounded-r":[{"rounded-r":[Nt]}],"rounded-b":[{"rounded-b":[Nt]}],"rounded-l":[{"rounded-l":[Nt]}],"rounded-ss":[{"rounded-ss":[Nt]}],"rounded-se":[{"rounded-se":[Nt]}],"rounded-ee":[{"rounded-ee":[Nt]}],"rounded-es":[{"rounded-es":[Nt]}],"rounded-tl":[{"rounded-tl":[Nt]}],"rounded-tr":[{"rounded-tr":[Nt]}],"rounded-br":[{"rounded-br":[Nt]}],"rounded-bl":[{"rounded-bl":[Nt]}],"border-w":[{border:[Lt]}],"border-w-x":[{"border-x":[Lt]}],"border-w-y":[{"border-y":[Lt]}],"border-w-s":[{"border-s":[Lt]}],"border-w-e":[{"border-e":[Lt]}],"border-w-t":[{"border-t":[Lt]}],"border-w-r":[{"border-r":[Lt]}],"border-w-b":[{"border-b":[Lt]}],"border-w-l":[{"border-l":[Lt]}],"border-opacity":[{"border-opacity":[fr]}],"border-style":[{border:[...Dr(),"hidden"]}],"divide-x":[{"divide-x":[Lt]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[Lt]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[fr]}],"divide-style":[{divide:Dr()}],"border-color":[{border:[Bt]}],"border-color-x":[{"border-x":[Bt]}],"border-color-y":[{"border-y":[Bt]}],"border-color-t":[{"border-t":[Bt]}],"border-color-r":[{"border-r":[Bt]}],"border-color-b":[{"border-b":[Bt]}],"border-color-l":[{"border-l":[Bt]}],"divide-color":[{divide:[Bt]}],"outline-style":[{outline:["",...Dr()]}],"outline-offset":[{"outline-offset":[isLength,isArbitraryValue]}],"outline-w":[{outline:[isLength,isArbitraryLength]}],"outline-color":[{outline:[xt]}],"ring-w":[{ring:_r()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[xt]}],"ring-opacity":[{"ring-opacity":[fr]}],"ring-offset-w":[{"ring-offset":[isLength,isArbitraryLength]}],"ring-offset-color":[{"ring-offset":[xt]}],shadow:[{shadow:["","inner","none",isTshirtSize,isArbitraryShadow]}],"shadow-color":[{shadow:[isAny]}],opacity:[{opacity:[fr]}],"mix-blend":[{"mix-blend":[...xr(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":xr()}],filter:[{filter:["","none"]}],blur:[{blur:[At]}],brightness:[{brightness:[kt]}],contrast:[{contrast:[er]}],"drop-shadow":[{"drop-shadow":["","none",isTshirtSize,isArbitraryValue]}],grayscale:[{grayscale:[tr]}],"hue-rotate":[{"hue-rotate":[zt]}],invert:[{invert:[rr]}],saturate:[{saturate:[lr]}],sepia:[{sepia:[br]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[At]}],"backdrop-brightness":[{"backdrop-brightness":[kt]}],"backdrop-contrast":[{"backdrop-contrast":[er]}],"backdrop-grayscale":[{"backdrop-grayscale":[tr]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[zt]}],"backdrop-invert":[{"backdrop-invert":[rr]}],"backdrop-opacity":[{"backdrop-opacity":[fr]}],"backdrop-saturate":[{"backdrop-saturate":[lr]}],"backdrop-sepia":[{"backdrop-sepia":[br]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[jt]}],"border-spacing-x":[{"border-spacing-x":[jt]}],"border-spacing-y":[{"border-spacing-y":[jt]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",isArbitraryValue]}],duration:[{duration:Tr()}],ease:[{ease:["linear","in","out","in-out",isArbitraryValue]}],delay:[{delay:Tr()}],animate:[{animate:["none","spin","ping","pulse","bounce",isArbitraryValue]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[yr]}],"scale-x":[{"scale-x":[yr]}],"scale-y":[{"scale-y":[yr]}],rotate:[{rotate:[isInteger,isArbitraryValue]}],"translate-x":[{"translate-x":[kr]}],"translate-y":[{"translate-y":[kr]}],"skew-x":[{"skew-x":[Ar]}],"skew-y":[{"skew-y":[Ar]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",isArbitraryValue]}],accent:[{accent:["auto",xt]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",isArbitraryValue]}],"caret-color":[{caret:[xt]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Sr()}],"scroll-mx":[{"scroll-mx":Sr()}],"scroll-my":[{"scroll-my":Sr()}],"scroll-ms":[{"scroll-ms":Sr()}],"scroll-me":[{"scroll-me":Sr()}],"scroll-mt":[{"scroll-mt":Sr()}],"scroll-mr":[{"scroll-mr":Sr()}],"scroll-mb":[{"scroll-mb":Sr()}],"scroll-ml":[{"scroll-ml":Sr()}],"scroll-p":[{"scroll-p":Sr()}],"scroll-px":[{"scroll-px":Sr()}],"scroll-py":[{"scroll-py":Sr()}],"scroll-ps":[{"scroll-ps":Sr()}],"scroll-pe":[{"scroll-pe":Sr()}],"scroll-pt":[{"scroll-pt":Sr()}],"scroll-pr":[{"scroll-pr":Sr()}],"scroll-pb":[{"scroll-pb":Sr()}],"scroll-pl":[{"scroll-pl":Sr()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",isArbitraryValue]}],fill:[{fill:[xt,"none"]}],"stroke-w":[{stroke:[isLength,isArbitraryLength,isArbitraryNumber]}],stroke:[{stroke:[xt,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}const twMerge=createTailwindMerge(getDefaultConfig);var Ct$1=xt=>{switch(xt){case"success":return $t;case"info":return _t;case"warning":return Wt;case"error":return Ut;default:return null}},Ft$1=Array(12).fill(0),It$1=({visible:xt})=>React.createElement("div",{className:"sonner-loading-wrapper","data-visible":xt},React.createElement("div",{className:"sonner-spinner"},Ft$1.map((e,At)=>React.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${At}`})))),$t=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Wt=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),_t=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Ut=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Dt$1=()=>{let[xt,e]=React.useState(document.hidden);return React.useEffect(()=>{let At=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",At),()=>window.removeEventListener("visibilitychange",At)},[]),xt},ct$1=1,ut$3=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let At=this.subscribers.indexOf(e);this.subscribers.splice(At,1)}),this.publish=e=>{this.subscribers.forEach(At=>At(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var At;let{message:kt,...Bt}=e,Nt=typeof(e==null?void 0:e.id)=="number"||((At=e.id)==null?void 0:At.length)>0?e.id:ct$1++,jt=this.toasts.find(er=>er.id===Nt),Lt=e.dismissible===void 0?!0:e.dismissible;return jt?this.toasts=this.toasts.map(er=>er.id===Nt?(this.publish({...er,...e,id:Nt,title:kt}),{...er,...e,id:Nt,dismissible:Lt,title:kt}):er):this.addToast({title:kt,...Bt,dismissible:Lt,id:Nt}),Nt},this.dismiss=e=>(e||this.toasts.forEach(At=>{this.subscribers.forEach(kt=>kt({id:At.id,dismiss:!0}))}),this.subscribers.forEach(At=>At({id:e,dismiss:!0})),e),this.message=(e,At)=>this.create({...At,message:e}),this.error=(e,At)=>this.create({...At,message:e,type:"error"}),this.success=(e,At)=>this.create({...At,type:"success",message:e}),this.info=(e,At)=>this.create({...At,type:"info",message:e}),this.warning=(e,At)=>this.create({...At,type:"warning",message:e}),this.loading=(e,At)=>this.create({...At,type:"loading",message:e}),this.promise=(e,At)=>{if(!At)return;let kt;At.loading!==void 0&&(kt=this.create({...At,promise:e,type:"loading",message:At.loading,description:typeof At.description!="function"?At.description:void 0}));let Bt=e instanceof Promise?e:e(),Nt=kt!==void 0;return Bt.then(async jt=>{if(Ot$1(jt)&&!jt.ok){Nt=!1;let Lt=typeof At.error=="function"?await At.error(`HTTP error! status: ${jt.status}`):At.error,er=typeof At.description=="function"?await At.description(`HTTP error! status: ${jt.status}`):At.description;this.create({id:kt,type:"error",message:Lt,description:er})}else if(At.success!==void 0){Nt=!1;let Lt=typeof At.success=="function"?await At.success(jt):At.success,er=typeof At.description=="function"?await At.description(jt):At.description;this.create({id:kt,type:"success",message:Lt,description:er})}}).catch(async jt=>{if(At.error!==void 0){Nt=!1;let Lt=typeof At.error=="function"?await At.error(jt):At.error,er=typeof At.description=="function"?await At.description(jt):At.description;this.create({id:kt,type:"error",message:Lt,description:er})}}).finally(()=>{var jt;Nt&&(this.dismiss(kt),kt=void 0),(jt=At.finally)==null||jt.call(At)}),kt},this.custom=(e,At)=>{let kt=(At==null?void 0:At.id)||ct$1++;return this.create({jsx:e(kt),id:kt,...At}),kt},this.subscribers=[],this.toasts=[]}},v$1=new ut$3,Vt=(xt,e)=>{let At=(e==null?void 0:e.id)||ct$1++;return v$1.addToast({title:xt,...e,id:At}),At},Ot$1=xt=>xt&&typeof xt=="object"&&"ok"in xt&&typeof xt.ok=="boolean"&&"status"in xt&&typeof xt.status=="number",Kt=Vt,Xt=()=>v$1.toasts,Jt=Object.assign(Kt,{success:v$1.success,info:v$1.info,warning:v$1.warning,error:v$1.error,custom:v$1.custom,message:v$1.message,promise:v$1.promise,dismiss:v$1.dismiss,loading:v$1.loading},{getHistory:Xt});function ft$3(xt,{insertAt:e}={}){if(typeof document>"u")return;let At=document.head||document.getElementsByTagName("head")[0],kt=document.createElement("style");kt.type="text/css",e==="top"&&At.firstChild?At.insertBefore(kt,At.firstChild):At.appendChild(kt),kt.styleSheet?kt.styleSheet.cssText=xt:kt.appendChild(document.createTextNode(xt))}ft$3(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function U$1(xt){return xt.label!==void 0}var qt=3,Qt="32px",Zt$1=4e3,te$1=356,ee$1=14,oe$1=20,ae$1=200;function ne$1(...xt){return xt.filter(Boolean).join(" ")}var se$1=xt=>{var e,At,kt,Bt,Nt,jt,Lt,er,tr,zt;let{invert:rr,toast:nr,unstyled:ir,interacting:ar,setHeights:dr,visibleToasts:ur,heights:fr,index:pr,toasts:lr,expanded:yr,removeToast:br,defaultRichColors:Ar,closeButton:Pr,style:kr,cancelButtonStyle:Ur,actionButtonStyle:Hr,className:Lr="",descriptionClassName:Sr="",duration:_r,position:gr,gap:wr,loadingIcon:Dr,expandByDefault:xr,classNames:Ir,icons:$r,closeButtonAriaLabel:vr="Close toast",pauseWhenPageIsHidden:Er,cn:Tr}=xt,[Rr,Mr]=React.useState(!1),[Gr,Br]=React.useState(!1),[Cr,jr]=React.useState(!1),[Yr,Qr]=React.useState(!1),[Jr,Wr]=React.useState(0),[Nr,Vr]=React.useState(0),Xr=React.useRef(null),qr=React.useRef(null),Or=pr===0,Fr=pr+1<=ur,Zr=nr.type,rn=nr.dismissible!==!1,un=nr.className||"",dn=nr.descriptionClassName||"",vn=React.useMemo(()=>fr.findIndex(Pn=>Pn.toastId===nr.id)||0,[fr,nr.id]),$n=React.useMemo(()=>{var Pn;return(Pn=nr.closeButton)!=null?Pn:Pr},[nr.closeButton,Pr]),en=React.useMemo(()=>nr.duration||_r||Zt$1,[nr.duration,_r]),tn=React.useRef(0),hn=React.useRef(0),mn=React.useRef(0),yn=React.useRef(null),[xn,In]=gr.split("-"),On=React.useMemo(()=>fr.reduce((Pn,Rn,Nn)=>Nn>=vn?Pn:Pn+Rn.height,0),[fr,vn]),Dn=Dt$1(),Yn=nr.invert||rr,Hn=Zr==="loading";hn.current=React.useMemo(()=>vn*wr+On,[vn,On]),React.useEffect(()=>{Mr(!0)},[]),React.useLayoutEffect(()=>{if(!Rr)return;let Pn=qr.current,Rn=Pn.style.height;Pn.style.height="auto";let Nn=Pn.getBoundingClientRect().height;Pn.style.height=Rn,Vr(Nn),dr(Wn=>Wn.find(kn=>kn.toastId===nr.id)?Wn.map(kn=>kn.toastId===nr.id?{...kn,height:Nn}:kn):[{toastId:nr.id,height:Nn,position:nr.position},...Wn])},[Rr,nr.title,nr.description,dr,nr.id]);let Mn=React.useCallback(()=>{Br(!0),Wr(hn.current),dr(Pn=>Pn.filter(Rn=>Rn.toastId!==nr.id)),setTimeout(()=>{br(nr)},ae$1)},[nr,br,dr,hn]);React.useEffect(()=>{if(nr.promise&&Zr==="loading"||nr.duration===1/0||nr.type==="loading")return;let Pn,Rn=en;return yr||ar||Er&&Dn?(()=>{if(mn.current<tn.current){let Nn=new Date().getTime()-tn.current;Rn=Rn-Nn}mn.current=new Date().getTime()})():Rn!==1/0&&(tn.current=new Date().getTime(),Pn=setTimeout(()=>{var Nn;(Nn=nr.onAutoClose)==null||Nn.call(nr,nr),Mn()},Rn)),()=>clearTimeout(Pn)},[yr,ar,xr,nr,en,Mn,nr.promise,Zr,Er,Dn]),React.useEffect(()=>{let Pn=qr.current;if(Pn){let Rn=Pn.getBoundingClientRect().height;return Vr(Rn),dr(Nn=>[{toastId:nr.id,height:Rn,position:nr.position},...Nn]),()=>dr(Nn=>Nn.filter(Wn=>Wn.toastId!==nr.id))}},[dr,nr.id]),React.useEffect(()=>{nr.delete&&Mn()},[Mn,nr.delete]);function zn(){return $r!=null&&$r.loading?React.createElement("div",{className:"sonner-loader","data-visible":Zr==="loading"},$r.loading):Dr?React.createElement("div",{className:"sonner-loader","data-visible":Zr==="loading"},Dr):React.createElement(It$1,{visible:Zr==="loading"})}return React.createElement("li",{"aria-live":nr.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:qr,className:Tr(Lr,un,Ir==null?void 0:Ir.toast,(e=nr==null?void 0:nr.classNames)==null?void 0:e.toast,Ir==null?void 0:Ir.default,Ir==null?void 0:Ir[Zr],(At=nr==null?void 0:nr.classNames)==null?void 0:At[Zr]),"data-sonner-toast":"","data-rich-colors":(kt=nr.richColors)!=null?kt:Ar,"data-styled":!(nr.jsx||nr.unstyled||ir),"data-mounted":Rr,"data-promise":!!nr.promise,"data-removed":Gr,"data-visible":Fr,"data-y-position":xn,"data-x-position":In,"data-index":pr,"data-front":Or,"data-swiping":Cr,"data-dismissible":rn,"data-type":Zr,"data-invert":Yn,"data-swipe-out":Yr,"data-expanded":!!(yr||xr&&Rr),style:{"--index":pr,"--toasts-before":pr,"--z-index":lr.length-pr,"--offset":`${Gr?Jr:hn.current}px`,"--initial-height":xr?"auto":`${Nr}px`,...kr,...nr.style},onPointerDown:Pn=>{Hn||!rn||(Xr.current=new Date,Wr(hn.current),Pn.target.setPointerCapture(Pn.pointerId),Pn.target.tagName!=="BUTTON"&&(jr(!0),yn.current={x:Pn.clientX,y:Pn.clientY}))},onPointerUp:()=>{var Pn,Rn,Nn,Wn;if(Yr||!rn)return;yn.current=null;let kn=Number(((Pn=qr.current)==null?void 0:Pn.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Zn=new Date().getTime()-((Rn=Xr.current)==null?void 0:Rn.getTime()),eo=Math.abs(kn)/Zn;if(Math.abs(kn)>=oe$1||eo>.11){Wr(hn.current),(Nn=nr.onDismiss)==null||Nn.call(nr,nr),Mn(),Qr(!0);return}(Wn=qr.current)==null||Wn.style.setProperty("--swipe-amount","0px"),jr(!1)},onPointerMove:Pn=>{var Rn;if(!yn.current||!rn)return;let Nn=Pn.clientY-yn.current.y,Wn=Pn.clientX-yn.current.x,kn=(xn==="top"?Math.min:Math.max)(0,Nn),Zn=Pn.pointerType==="touch"?10:2;Math.abs(kn)>Zn?(Rn=qr.current)==null||Rn.style.setProperty("--swipe-amount",`${Nn}px`):Math.abs(Wn)>Zn&&(yn.current=null)}},$n&&!nr.jsx?React.createElement("button",{"aria-label":vr,"data-disabled":Hn,"data-close-button":!0,onClick:Hn||!rn?()=>{}:()=>{var Pn;Mn(),(Pn=nr.onDismiss)==null||Pn.call(nr,nr)},className:Tr(Ir==null?void 0:Ir.closeButton,(Bt=nr==null?void 0:nr.classNames)==null?void 0:Bt.closeButton)},React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,nr.jsx||React.isValidElement(nr.title)?nr.jsx||nr.title:React.createElement(React.Fragment,null,Zr||nr.icon||nr.promise?React.createElement("div",{"data-icon":"",className:Tr(Ir==null?void 0:Ir.icon,(Nt=nr==null?void 0:nr.classNames)==null?void 0:Nt.icon)},nr.promise||nr.type==="loading"&&!nr.icon?nr.icon||zn():null,nr.type!=="loading"?nr.icon||($r==null?void 0:$r[Zr])||Ct$1(Zr):null):null,React.createElement("div",{"data-content":"",className:Tr(Ir==null?void 0:Ir.content,(jt=nr==null?void 0:nr.classNames)==null?void 0:jt.content)},React.createElement("div",{"data-title":"",className:Tr(Ir==null?void 0:Ir.title,(Lt=nr==null?void 0:nr.classNames)==null?void 0:Lt.title)},nr.title),nr.description?React.createElement("div",{"data-description":"",className:Tr(Sr,dn,Ir==null?void 0:Ir.description,(er=nr==null?void 0:nr.classNames)==null?void 0:er.description)},nr.description):null),React.isValidElement(nr.cancel)?nr.cancel:nr.cancel&&U$1(nr.cancel)?React.createElement("button",{"data-button":!0,"data-cancel":!0,style:nr.cancelButtonStyle||Ur,onClick:Pn=>{var Rn,Nn;U$1(nr.cancel)&&rn&&((Nn=(Rn=nr.cancel).onClick)==null||Nn.call(Rn,Pn),Mn())},className:Tr(Ir==null?void 0:Ir.cancelButton,(tr=nr==null?void 0:nr.classNames)==null?void 0:tr.cancelButton)},nr.cancel.label):null,React.isValidElement(nr.action)?nr.action:nr.action&&U$1(nr.action)?React.createElement("button",{"data-button":!0,"data-action":!0,style:nr.actionButtonStyle||Hr,onClick:Pn=>{var Rn,Nn;U$1(nr.action)&&(Pn.defaultPrevented||((Nn=(Rn=nr.action).onClick)==null||Nn.call(Rn,Pn),Mn()))},className:Tr(Ir==null?void 0:Ir.actionButton,(zt=nr==null?void 0:nr.classNames)==null?void 0:zt.actionButton)},nr.action.label):null))};function Ht(){if(typeof window>"u"||typeof document>"u")return"ltr";let xt=document.documentElement.getAttribute("dir");return xt==="auto"||!xt?window.getComputedStyle(document.documentElement).direction:xt}var Te$1=xt=>{let{invert:e,position:At="bottom-right",hotkey:kt=["altKey","KeyT"],expand:Bt,closeButton:Nt,className:jt,offset:Lt,theme:er="light",richColors:tr,duration:zt,style:rr,visibleToasts:nr=qt,toastOptions:ir,dir:ar=Ht(),gap:dr=ee$1,loadingIcon:ur,icons:fr,containerAriaLabel:pr="Notifications",pauseWhenPageIsHidden:lr,cn:yr=ne$1}=xt,[br,Ar]=React.useState([]),Pr=React.useMemo(()=>Array.from(new Set([At].concat(br.filter(Er=>Er.position).map(Er=>Er.position)))),[br,At]),[kr,Ur]=React.useState([]),[Hr,Lr]=React.useState(!1),[Sr,_r]=React.useState(!1),[gr,wr]=React.useState(er!=="system"?er:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Dr=React.useRef(null),xr=kt.join("+").replace(/Key/g,"").replace(/Digit/g,""),Ir=React.useRef(null),$r=React.useRef(!1),vr=React.useCallback(Er=>{var Tr;(Tr=br.find(Rr=>Rr.id===Er.id))!=null&&Tr.delete||v$1.dismiss(Er.id),Ar(Rr=>Rr.filter(({id:Mr})=>Mr!==Er.id))},[br]);return React.useEffect(()=>v$1.subscribe(Er=>{if(Er.dismiss){Ar(Tr=>Tr.map(Rr=>Rr.id===Er.id?{...Rr,delete:!0}:Rr));return}setTimeout(()=>{ReactDOM.flushSync(()=>{Ar(Tr=>{let Rr=Tr.findIndex(Mr=>Mr.id===Er.id);return Rr!==-1?[...Tr.slice(0,Rr),{...Tr[Rr],...Er},...Tr.slice(Rr+1)]:[Er,...Tr]})})})}),[]),React.useEffect(()=>{if(er!=="system"){wr(er);return}er==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?wr("dark"):wr("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:Er})=>{wr(Er?"dark":"light")})},[er]),React.useEffect(()=>{br.length<=1&&Lr(!1)},[br]),React.useEffect(()=>{let Er=Tr=>{var Rr,Mr;kt.every(Gr=>Tr[Gr]||Tr.code===Gr)&&(Lr(!0),(Rr=Dr.current)==null||Rr.focus()),Tr.code==="Escape"&&(document.activeElement===Dr.current||(Mr=Dr.current)!=null&&Mr.contains(document.activeElement))&&Lr(!1)};return document.addEventListener("keydown",Er),()=>document.removeEventListener("keydown",Er)},[kt]),React.useEffect(()=>{if(Dr.current)return()=>{Ir.current&&(Ir.current.focus({preventScroll:!0}),Ir.current=null,$r.current=!1)}},[Dr.current]),br.length?React.createElement("section",{"aria-label":`${pr} ${xr}`,tabIndex:-1},Pr.map((Er,Tr)=>{var Rr;let[Mr,Gr]=Er.split("-");return React.createElement("ol",{key:Er,dir:ar==="auto"?Ht():ar,tabIndex:-1,ref:Dr,className:jt,"data-sonner-toaster":!0,"data-theme":gr,"data-y-position":Mr,"data-x-position":Gr,style:{"--front-toast-height":`${((Rr=kr[0])==null?void 0:Rr.height)||0}px`,"--offset":typeof Lt=="number"?`${Lt}px`:Lt||Qt,"--width":`${te$1}px`,"--gap":`${dr}px`,...rr},onBlur:Br=>{$r.current&&!Br.currentTarget.contains(Br.relatedTarget)&&($r.current=!1,Ir.current&&(Ir.current.focus({preventScroll:!0}),Ir.current=null))},onFocus:Br=>{Br.target instanceof HTMLElement&&Br.target.dataset.dismissible==="false"||$r.current||($r.current=!0,Ir.current=Br.relatedTarget)},onMouseEnter:()=>Lr(!0),onMouseMove:()=>Lr(!0),onMouseLeave:()=>{Sr||Lr(!1)},onPointerDown:Br=>{Br.target instanceof HTMLElement&&Br.target.dataset.dismissible==="false"||_r(!0)},onPointerUp:()=>_r(!1)},br.filter(Br=>!Br.position&&Tr===0||Br.position===Er).map((Br,Cr)=>{var jr,Yr;return React.createElement(se$1,{key:Br.id,icons:fr,index:Cr,toast:Br,defaultRichColors:tr,duration:(jr=ir==null?void 0:ir.duration)!=null?jr:zt,className:ir==null?void 0:ir.className,descriptionClassName:ir==null?void 0:ir.descriptionClassName,invert:e,visibleToasts:nr,closeButton:(Yr=ir==null?void 0:ir.closeButton)!=null?Yr:Nt,interacting:Sr,position:Er,style:ir==null?void 0:ir.style,unstyled:ir==null?void 0:ir.unstyled,classNames:ir==null?void 0:ir.classNames,cancelButtonStyle:ir==null?void 0:ir.cancelButtonStyle,actionButtonStyle:ir==null?void 0:ir.actionButtonStyle,removeToast:vr,toasts:br.filter(Qr=>Qr.position==Br.position),heights:kr.filter(Qr=>Qr.position==Br.position),setHeights:Ur,expandByDefault:Bt,gap:dr,loadingIcon:ur,expanded:Hr,pauseWhenPageIsHidden:lr,cn:yr})}))})):null};function cn(...xt){return twMerge(clsx(xt))}function toastSuccess(xt,e){Jt.success(xt,{description:e})}function toastError(xt,e){console.error("Toast Error >>>",{message:xt,error:e});const At=e?(e==null?void 0:e.message)||"Unknown error":void 0;Jt.error(xt,{description:At})}const buttonVariants=cva("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Button=reactExports.forwardRef(({className:xt,variant:e,size:At,asChild:kt=!1,...Bt},Nt)=>{const jt=kt?Slot:"button";return jsxRuntimeExports.jsx(jt,{className:cn(buttonVariants({variant:e,size:At,className:xt})),ref:Nt,...Bt})});Button.displayName="Button";function PWABadge(){const{offlineReady:[e,At],needRefresh:[kt,Bt],updateServiceWorker:Nt}=useRegisterSW({onRegisteredSW(Lt,er){var tr;((tr=er==null?void 0:er.active)==null?void 0:tr.state)==="activated"?registerPeriodicSync(36e5,Lt,er):er!=null&&er.installing&&er.installing.addEventListener("statechange",zt=>{zt.target.state==="activated"&&registerPeriodicSync(36e5,Lt,er)})}});function jt(){console.info({offlineReady:e}),At(!1),Bt(!1)}return jsxRuntimeExports.jsx("div",{className:"PWABadge",role:"alert","aria-labelledby":"toast-message",children:kt&&jsxRuntimeExports.jsxs("div",{className:"fixed right-0 bottom-0 m-4 p-3 border-solid border-2 rounded-lg bg-background z-50 shadow-md",children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("span",{children:"New content available, click on reload button to update."})}),jsxRuntimeExports.jsxs("div",{className:"mt-4 space-x-2 text-right",children:[kt&&jsxRuntimeExports.jsx(Button,{onClick:()=>Nt(!0),size:"sm",children:"Reload"}),jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:()=>jt(),size:"sm",children:"Close"})]})]})})}function registerPeriodicSync(xt,e,At){setInterval(async()=>{if("onLine"in navigator&&!navigator.onLine)return;const kt=await fetch(e,{cache:"no-store",headers:{cache:"no-store","cache-control":"no-cache"}});(kt==null?void 0:kt.status)===200&&await At.update()},xt)}/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=xt=>xt.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mergeClasses=(...xt)=>xt.filter((e,At,kt)=>!!e&&kt.indexOf(e)===At).join(" ");/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Icon=reactExports.forwardRef(({color:xt="currentColor",size:e=24,strokeWidth:At=2,absoluteStrokeWidth:kt,className:Bt="",children:Nt,iconNode:jt,...Lt},er)=>reactExports.createElement("svg",{ref:er,...defaultAttributes,width:e,height:e,stroke:xt,strokeWidth:kt?Number(At)*24/Number(e):At,className:mergeClasses("lucide",Bt),...Lt},[...jt.map(([tr,zt])=>reactExports.createElement(tr,zt)),...Array.isArray(Nt)?Nt:[Nt]]));/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const createLucideIcon=(xt,e)=>{const At=reactExports.forwardRef(({className:kt,...Bt},Nt)=>reactExports.createElement(Icon,{ref:Nt,iconNode:e,className:mergeClasses(`lucide-${toKebabCase(xt)}`,kt),...Bt}));return At.displayName=`${xt}`,At};/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ban=createLucideIcon("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Check=createLucideIcon("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronRight=createLucideIcon("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Circle=createLucideIcon("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Delete=createLucideIcon("Delete",[["path",{d:"M20 5H9l-7 7 7 7h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Z",key:"1oy587"}],["line",{x1:"18",x2:"12",y1:"9",y2:"15",key:"1olkx5"}],["line",{x1:"12",x2:"18",y1:"9",y2:"15",key:"1n50pc"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const House=createLucideIcon("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LifeBuoy=createLucideIcon("LifeBuoy",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.93 4.93 4.24 4.24",key:"1ymg45"}],["path",{d:"m14.83 9.17 4.24-4.24",key:"1cb5xl"}],["path",{d:"m14.83 14.83 4.24 4.24",key:"q42g0n"}],["path",{d:"m9.17 14.83-4.24 4.24",key:"bqpfvv"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LoaderCircle=createLucideIcon("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LogIn=createLucideIcon("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Menu$1=createLucideIcon("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Moon=createLucideIcon("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pencil=createLucideIcon("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Settings=createLucideIcon("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sun=createLucideIcon("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Trash2=createLucideIcon("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Trash=createLucideIcon("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UserRound=createLucideIcon("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const User=createLucideIcon("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WalletMinimal=createLucideIcon("WalletMinimal",[["path",{d:"M17 14h.01",key:"7oqj8z"}],["path",{d:"M7 7h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14",key:"u1rqew"}]]);/**
 * @license lucide-react v0.407.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X$1=createLucideIcon("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var freeGlobal$1=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root$1=freeGlobal||freeSelf||Function("return this")(),_root=root$1,root=_root,Symbol$a=root.Symbol,_Symbol=Symbol$a,Symbol$9=_Symbol,objectProto$2=Object.prototype,hasOwnProperty$3=objectProto$2.hasOwnProperty,nativeObjectToString$1=objectProto$2.toString,symToStringTag$1=Symbol$9?Symbol$9.toStringTag:void 0;function getRawTag$1(xt){var e=hasOwnProperty$3.call(xt,symToStringTag$1),At=xt[symToStringTag$1];try{xt[symToStringTag$1]=void 0;var kt=!0}catch{}var Bt=nativeObjectToString$1.call(xt);return kt&&(e?xt[symToStringTag$1]=At:delete xt[symToStringTag$1]),Bt}var _getRawTag=getRawTag$1,objectProto$1=Object.prototype,nativeObjectToString=objectProto$1.toString;function objectToString$3(xt){return nativeObjectToString.call(xt)}var _objectToString=objectToString$3,Symbol$8=_Symbol,getRawTag=_getRawTag,objectToString$2=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$8?Symbol$8.toStringTag:void 0;function baseGetTag$1(xt){return xt==null?xt===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(xt)?getRawTag(xt):objectToString$2(xt)}var _baseGetTag=baseGetTag$1;function overArg$1(xt,e){return function(At){return xt(e(At))}}var _overArg=overArg$1,overArg=_overArg,getPrototype$1=overArg(Object.getPrototypeOf,Object),_getPrototype=getPrototype$1;function isObjectLike$1(xt){return xt!=null&&typeof xt=="object"}var isObjectLike_1=isObjectLike$1,baseGetTag=_baseGetTag,getPrototype=_getPrototype,isObjectLike=isObjectLike_1,objectTag="[object Object]",funcProto=Function.prototype,objectProto=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$2=objectProto.hasOwnProperty,objectCtorString=funcToString.call(Object);function isPlainObject(xt){if(!isObjectLike(xt)||baseGetTag(xt)!=objectTag)return!1;var e=getPrototype(xt);if(e===null)return!0;var At=hasOwnProperty$2.call(e,"constructor")&&e.constructor;return typeof At=="function"&&At instanceof At&&funcToString.call(At)==objectCtorString}var isPlainObject_1=isPlainObject;const isPlainObject$1=getDefaultExportFromCjs(isPlainObject_1);function base$5(xt,e){if(xt.length>=255)throw new TypeError("Alphabet too long");for(var At=new Uint8Array(256),kt=0;kt<At.length;kt++)At[kt]=255;for(var Bt=0;Bt<xt.length;Bt++){var Nt=xt.charAt(Bt),jt=Nt.charCodeAt(0);if(At[jt]!==255)throw new TypeError(Nt+" is ambiguous");At[jt]=Bt}var Lt=xt.length,er=xt.charAt(0),tr=Math.log(Lt)/Math.log(256),zt=Math.log(256)/Math.log(Lt);function rr(ar){if(ar instanceof Uint8Array||(ArrayBuffer.isView(ar)?ar=new Uint8Array(ar.buffer,ar.byteOffset,ar.byteLength):Array.isArray(ar)&&(ar=Uint8Array.from(ar))),!(ar instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(ar.length===0)return"";for(var dr=0,ur=0,fr=0,pr=ar.length;fr!==pr&&ar[fr]===0;)fr++,dr++;for(var lr=(pr-fr)*zt+1>>>0,yr=new Uint8Array(lr);fr!==pr;){for(var br=ar[fr],Ar=0,Pr=lr-1;(br!==0||Ar<ur)&&Pr!==-1;Pr--,Ar++)br+=256*yr[Pr]>>>0,yr[Pr]=br%Lt>>>0,br=br/Lt>>>0;if(br!==0)throw new Error("Non-zero carry");ur=Ar,fr++}for(var kr=lr-ur;kr!==lr&&yr[kr]===0;)kr++;for(var Ur=er.repeat(dr);kr<lr;++kr)Ur+=xt.charAt(yr[kr]);return Ur}function nr(ar){if(typeof ar!="string")throw new TypeError("Expected String");if(ar.length===0)return new Uint8Array;var dr=0;if(ar[dr]!==" "){for(var ur=0,fr=0;ar[dr]===er;)ur++,dr++;for(var pr=(ar.length-dr)*tr+1>>>0,lr=new Uint8Array(pr);ar[dr];){var yr=At[ar.charCodeAt(dr)];if(yr===255)return;for(var br=0,Ar=pr-1;(yr!==0||br<fr)&&Ar!==-1;Ar--,br++)yr+=Lt*lr[Ar]>>>0,lr[Ar]=yr%256>>>0,yr=yr/256>>>0;if(yr!==0)throw new Error("Non-zero carry");fr=br,dr++}if(ar[dr]!==" "){for(var Pr=pr-fr;Pr!==pr&&lr[Pr]===0;)Pr++;for(var kr=new Uint8Array(ur+(pr-Pr)),Ur=ur;Pr!==pr;)kr[Ur++]=lr[Pr++];return kr}}}function ir(ar){var dr=nr(ar);if(dr)return dr;throw new Error(`Non-${e} character`)}return{encode:rr,decodeUnsafe:nr,decode:ir}}var src$3=base$5,_brrp__multiformats_scope_baseX$3=src$3;const equals$6=(xt,e)=>{if(xt===e)return!0;if(xt.byteLength!==e.byteLength)return!1;for(let At=0;At<xt.byteLength;At++)if(xt[At]!==e[At])return!1;return!0},coerce$3=xt=>{if(xt instanceof Uint8Array&&xt.constructor.name==="Uint8Array")return xt;if(xt instanceof ArrayBuffer)return new Uint8Array(xt);if(ArrayBuffer.isView(xt))return new Uint8Array(xt.buffer,xt.byteOffset,xt.byteLength);throw new Error("Unknown type, must be binary type")};let Encoder$5=class{constructor(e,At,kt){this.name=e,this.prefix=At,this.baseEncode=kt}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$3=class{constructor(e,At,kt){if(this.name=e,this.prefix=At,At.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=At.codePointAt(0),this.baseDecode=kt}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$3(this,e)}},ComposedDecoder$3=class{constructor(e){this.decoders=e}or(e){return or$3(this,e)}decode(e){const At=e[0],kt=this.decoders[At];if(kt)return kt.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$3=(xt,e)=>new ComposedDecoder$3({...xt.decoders||{[xt.prefix]:xt},...e.decoders||{[e.prefix]:e}});let Codec$3=class{constructor(e,At,kt,Bt){this.name=e,this.prefix=At,this.baseEncode=kt,this.baseDecode=Bt,this.encoder=new Encoder$5(e,At,kt),this.decoder=new Decoder$3(e,At,Bt)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$a=({name:xt,prefix:e,encode:At,decode:kt})=>new Codec$3(xt,e,At,kt),baseX$3=({prefix:xt,name:e,alphabet:At})=>{const{encode:kt,decode:Bt}=_brrp__multiformats_scope_baseX$3(At,e);return from$a({prefix:xt,name:e,encode:kt,decode:Nt=>coerce$3(Bt(Nt))})},decode$p=(xt,e,At,kt)=>{const Bt={};for(let zt=0;zt<e.length;++zt)Bt[e[zt]]=zt;let Nt=xt.length;for(;xt[Nt-1]==="=";)--Nt;const jt=new Uint8Array(Nt*At/8|0);let Lt=0,er=0,tr=0;for(let zt=0;zt<Nt;++zt){const rr=Bt[xt[zt]];if(rr===void 0)throw new SyntaxError(`Non-${kt} character`);er=er<<At|rr,Lt+=At,Lt>=8&&(Lt-=8,jt[tr++]=255&er>>Lt)}if(Lt>=At||255&er<<8-Lt)throw new SyntaxError("Unexpected end of data");return jt},encode$j=(xt,e,At)=>{const kt=e[e.length-1]==="=",Bt=(1<<At)-1;let Nt="",jt=0,Lt=0;for(let er=0;er<xt.length;++er)for(Lt=Lt<<8|xt[er],jt+=8;jt>At;)jt-=At,Nt+=e[Bt&Lt>>jt];if(jt&&(Nt+=e[Bt&Lt<<At-jt]),kt)for(;Nt.length*At&7;)Nt+="=";return Nt},rfc4648$3=({name:xt,prefix:e,bitsPerChar:At,alphabet:kt})=>from$a({prefix:e,name:xt,encode(Bt){return encode$j(Bt,kt,At)},decode(Bt){return decode$p(Bt,kt,At,xt)}});rfc4648$3({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});rfc4648$3({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const base64url$3=rfc4648$3({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});rfc4648$3({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});const textEncoder$8=new TextEncoder,textDecoder$6=new TextDecoder;let Encoder$4=class Vs{static base64UrlToBytes(e){return base64url$3.baseDecode(e)}static base64UrlToObject(e){const At=base64url$3.baseDecode(e);return Vs.bytesToObject(At)}static bytesToBase64Url(e){return base64url$3.baseEncode(e)}static bytesToString(e){return textDecoder$6.decode(e)}static bytesToObject(e){const At=Vs.bytesToString(e);return JSON.parse(At)}static objectToBytes(e){const At=JSON.stringify(e);return textEncoder$8.encode(At)}static stringToBase64Url(e){const At=textEncoder$8.encode(e);return base64url$3.baseEncode(At)}static stringToBytes(e){return textEncoder$8.encode(e)}};/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const P$3=2n**255n-19n,N$2=2n**252n+27742317777372353535851937790883648493n,Gx$1=0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51an,Gy$1=0x6666666666666666666666666666666666666666666666666666666666666658n,CURVE$1={a:-1n,d:37095705934669439343138083508754565189542113879843219016388785533085940283555n,p:P$3,n:N$2,h:8,Gx:Gx$1,Gy:Gy$1},err$1=(xt="")=>{throw new Error(xt)},str$1=xt=>typeof xt=="string",au8$1=(xt,e)=>!(xt instanceof Uint8Array)||typeof e=="number"&&e>0&&xt.length!==e?err$1("Uint8Array expected"):xt,u8n$4=xt=>new Uint8Array(xt),toU8$1=(xt,e)=>au8$1(str$1(xt)?h2b$3(xt):u8n$4(xt),e),mod$4=(xt,e=P$3)=>{let At=xt%e;return At>=0n?At:e+At},isPoint$1=xt=>xt instanceof Point$4?xt:err$1("Point expected");let Gpows$1,Point$4=class vs{constructor(e,At,kt,Bt){this.ex=e,this.ey=At,this.ez=kt,this.et=Bt}static fromAffine(e){return new vs(e.x,e.y,1n,mod$4(e.x*e.y))}static fromHex(e,At=!0){const{d:kt}=CURVE$1;e=toU8$1(e,32);const Bt=e.slice();Bt[31]=e[31]&-129;const Nt=b2n_LE(Bt);Nt===0n||(At&&!(0n<Nt&&Nt<P$3)&&err$1("bad y coord 1"),!At&&!(0n<Nt&&Nt<2n**256n)&&err$1("bad y coord 2"));const jt=mod$4(Nt*Nt),Lt=mod$4(jt-1n),er=mod$4(kt*jt+1n);let{isValid:tr,value:zt}=uvRatio$1(Lt,er);tr||err$1("bad y coordinate 3");const rr=(zt&1n)===1n;return(e[31]&128)!==0!==rr&&(zt=mod$4(-zt)),new vs(zt,Nt,1n,mod$4(zt*Nt))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}equals(e){const{ex:At,ey:kt,ez:Bt}=this,{ex:Nt,ey:jt,ez:Lt}=isPoint$1(e),er=mod$4(At*Lt),tr=mod$4(Nt*Bt),zt=mod$4(kt*Lt),rr=mod$4(jt*Bt);return er===tr&&zt===rr}is0(){return this.equals(I$2)}negate(){return new vs(mod$4(-this.ex),this.ey,this.ez,mod$4(-this.et))}double(){const{ex:e,ey:At,ez:kt}=this,{a:Bt}=CURVE$1,Nt=mod$4(e*e),jt=mod$4(At*At),Lt=mod$4(2n*mod$4(kt*kt)),er=mod$4(Bt*Nt),tr=e+At,zt=mod$4(mod$4(tr*tr)-Nt-jt),rr=er+jt,nr=rr-Lt,ir=er-jt,ar=mod$4(zt*nr),dr=mod$4(rr*ir),ur=mod$4(zt*ir),fr=mod$4(nr*rr);return new vs(ar,dr,fr,ur)}add(e){const{ex:At,ey:kt,ez:Bt,et:Nt}=this,{ex:jt,ey:Lt,ez:er,et:tr}=isPoint$1(e),{a:zt,d:rr}=CURVE$1,nr=mod$4(At*jt),ir=mod$4(kt*Lt),ar=mod$4(Nt*rr*tr),dr=mod$4(Bt*er),ur=mod$4((At+kt)*(jt+Lt)-nr-ir),fr=mod$4(dr-ar),pr=mod$4(dr+ar),lr=mod$4(ir-zt*nr),yr=mod$4(ur*fr),br=mod$4(pr*lr),Ar=mod$4(ur*lr),Pr=mod$4(fr*pr);return new vs(yr,br,Pr,Ar)}mul(e,At=!0){if(e===0n)return At===!0?err$1("cannot multiply by 0"):I$2;if(typeof e=="bigint"&&0n<e&&e<N$2||err$1("invalid scalar, must be < L"),!At&&this.is0()||e===1n)return this;if(this.equals(G$3))return wNAF$4(e).p;let kt=I$2,Bt=G$3;for(let Nt=this;e>0n;Nt=Nt.double(),e>>=1n)e&1n?kt=kt.add(Nt):At&&(Bt=Bt.add(Nt));return kt}multiply(e){return this.mul(e)}clearCofactor(){return this.mul(BigInt(CURVE$1.h),!1)}isSmallOrder(){return this.clearCofactor().is0()}isTorsionFree(){let e=this.mul(N$2/2n,!1).double();return N$2%2n&&(e=e.add(this)),e.is0()}toAffine(){const{ex:e,ey:At,ez:kt}=this;if(this.is0())return{x:0n,y:0n};const Bt=invert$3(kt);return mod$4(kt*Bt)!==1n&&err$1("invalid inverse"),{x:mod$4(e*Bt),y:mod$4(At*Bt)}}toRawBytes(){const{x:e,y:At}=this.toAffine(),kt=n2b_32LE(At);return kt[31]|=e&1n?128:0,kt}toHex(){return b2h$1(this.toRawBytes())}};Point$4.BASE=new Point$4(Gx$1,Gy$1,1n,mod$4(Gx$1*Gy$1));Point$4.ZERO=new Point$4(0n,1n,1n,0n);const{BASE:G$3,ZERO:I$2}=Point$4,padh$1=(xt,e)=>xt.toString(16).padStart(e,"0"),b2h$1=xt=>Array.from(xt).map(e=>padh$1(e,2)).join(""),h2b$3=xt=>{const e=xt.length;(!str$1(xt)||e%2)&&err$1("hex invalid 1");const At=u8n$4(e/2);for(let kt=0;kt<At.length;kt++){const Bt=kt*2,Nt=xt.slice(Bt,Bt+2),jt=Number.parseInt(Nt,16);(Number.isNaN(jt)||jt<0)&&err$1("hex invalid 2"),At[kt]=jt}return At},n2b_32LE=xt=>h2b$3(padh$1(xt,32*2)).reverse(),b2n_LE=xt=>BigInt("0x"+b2h$1(u8n$4(au8$1(xt)).reverse())),concatB$1=(...xt)=>{const e=u8n$4(xt.reduce((kt,Bt)=>kt+au8$1(Bt).length,0));let At=0;return xt.forEach(kt=>{e.set(kt,At),At+=kt.length}),e},invert$3=(xt,e=P$3)=>{(xt===0n||e<=0n)&&err$1("no inverse n="+xt+" mod="+e);let At=mod$4(xt,e),kt=e,Bt=0n,Nt=1n;for(;At!==0n;){const jt=kt/At,Lt=kt%At,er=Bt-Nt*jt;kt=At,At=Lt,Bt=Nt,Nt=er}return kt===1n?mod$4(Bt,e):err$1("no inverse")},pow2$2=(xt,e)=>{let At=xt;for(;e-- >0n;)At*=At,At%=P$3;return At},pow_2_252_3=xt=>{const At=xt*xt%P$3*xt%P$3,kt=pow2$2(At,2n)*At%P$3,Bt=pow2$2(kt,1n)*xt%P$3,Nt=pow2$2(Bt,5n)*Bt%P$3,jt=pow2$2(Nt,10n)*Nt%P$3,Lt=pow2$2(jt,20n)*jt%P$3,er=pow2$2(Lt,40n)*Lt%P$3,tr=pow2$2(er,80n)*er%P$3,zt=pow2$2(tr,80n)*er%P$3,rr=pow2$2(zt,10n)*Nt%P$3;return{pow_p_5_8:pow2$2(rr,2n)*xt%P$3,b2:At}},RM1=19681161376707505956807079304988542015446066515923890162744021073123829784752n,uvRatio$1=(xt,e)=>{const At=mod$4(e*e*e),kt=mod$4(At*At*e),Bt=pow_2_252_3(xt*kt).pow_p_5_8;let Nt=mod$4(xt*At*Bt);const jt=mod$4(e*Nt*Nt),Lt=Nt,er=mod$4(Nt*RM1),tr=jt===xt,zt=jt===mod$4(-xt),rr=jt===mod$4(-xt*RM1);return tr&&(Nt=Lt),(zt||rr)&&(Nt=er),(mod$4(Nt)&1n)===1n&&(Nt=mod$4(-Nt)),{isValid:tr||zt,value:Nt}},modL_LE=xt=>mod$4(b2n_LE(xt),N$2);let _shaS;const sha512a=(...xt)=>etc$1.sha512Async(...xt),sha512s=(...xt)=>typeof _shaS=="function"?_shaS(...xt):err$1("etc.sha512Sync not set"),hash2extK=xt=>{const e=xt.slice(0,32);e[0]&=248,e[31]&=127,e[31]|=64;const At=xt.slice(32,64),kt=modL_LE(e),Bt=G$3.mul(kt),Nt=Bt.toRawBytes();return{head:e,prefix:At,scalar:kt,point:Bt,pointBytes:Nt}},getExtendedPublicKeyAsync=xt=>sha512a(toU8$1(xt,32)).then(hash2extK),getExtendedPublicKey=xt=>hash2extK(sha512s(toU8$1(xt,32))),getPublicKeyAsync=xt=>getExtendedPublicKeyAsync(xt).then(e=>e.pointBytes);function hashFinish(xt,e){return sha512a(e.hashable).then(e.finish)}const _sign=(xt,e,At)=>{const{pointBytes:kt,scalar:Bt}=xt,Nt=modL_LE(e),jt=G$3.mul(Nt).toRawBytes();return{hashable:concatB$1(jt,kt,At),finish:tr=>{const zt=mod$4(Nt+modL_LE(tr)*Bt,N$2);return au8$1(concatB$1(jt,n2b_32LE(zt)),64)}}},signAsync$1=async(xt,e)=>{const At=toU8$1(xt),kt=await getExtendedPublicKeyAsync(e),Bt=await sha512a(kt.prefix,At);return hashFinish(!0,_sign(kt,Bt,At))},_verify=(xt,e,At)=>{e=toU8$1(e),xt=toU8$1(xt,64);const kt=Point$4.fromHex(At,!1),Bt=Point$4.fromHex(xt.slice(0,32),!1),Nt=b2n_LE(xt.slice(32,64)),jt=G$3.mul(Nt,!1);return{hashable:concatB$1(Bt.toRawBytes(),kt.toRawBytes(),e),finish:tr=>{const zt=modL_LE(tr);return Bt.add(kt.mul(zt,!1)).add(jt.negate()).clearCofactor().is0()}}},verifyAsync=async(xt,e,At)=>hashFinish(!0,_verify(xt,e,At)),cr$2=()=>typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0,etc$1={bytesToHex:b2h$1,hexToBytes:h2b$3,concatBytes:concatB$1,mod:mod$4,invert:invert$3,randomBytes:xt=>{const e=cr$2();return e||err$1("crypto.getRandomValues must be defined"),e.getRandomValues(u8n$4(xt))},sha512Async:async(...xt)=>{const e=cr$2();e||err$1("crypto.subtle or etc.sha512Async must be defined");const At=concatB$1(...xt);return u8n$4(await e.subtle.digest("SHA-512",At.buffer))},sha512Sync:void 0};Object.defineProperties(etc$1,{sha512Sync:{configurable:!1,get(){return _shaS},set(xt){_shaS||(_shaS=xt)}}});const utils$y={getExtendedPublicKeyAsync,getExtendedPublicKey,randomPrivateKey:()=>etc$1.randomBytes(32),precompute(xt=8,e=G$3){return e.multiply(3n),e}},W$8=8,precompute$1=()=>{const xt=[],e=256/W$8+1;let At=G$3,kt=At;for(let Bt=0;Bt<e;Bt++){kt=At,xt.push(kt);for(let Nt=1;Nt<2**(W$8-1);Nt++)kt=kt.add(At),xt.push(kt);At=kt.double()}return xt},wNAF$4=xt=>{const e=Gpows$1||(Gpows$1=precompute$1()),At=(zt,rr)=>{let nr=rr.negate();return zt?nr:rr};let kt=I$2,Bt=G$3;const Nt=1+256/W$8,jt=2**(W$8-1),Lt=BigInt(2**W$8-1),er=2**W$8,tr=BigInt(W$8);for(let zt=0;zt<Nt;zt++){const rr=zt*jt;let nr=Number(xt&Lt);xt>>=tr,nr>jt&&(nr-=er,xt+=1n);const ir=rr,ar=rr+Math.abs(nr)-1,dr=zt%2!==0,ur=nr<0;nr===0?Bt=Bt.add(At(dr,e[ir])):kt=kt.add(At(ur,e[ar]))}return{p:kt,f:Bt}};class DwnError extends Error{constructor(e,At){super(`${e}: ${At}`),this.code=e,this.name="DwnError"}}var DwnErrorCode;(function(xt){xt.AuthenticateJwsMissing="AuthenticateJwsMissing",xt.AuthenticateDescriptorCidMismatch="AuthenticateDescriptorCidMismatch",xt.AuthenticationMoreThanOneSignatureNotSupported="AuthenticationMoreThanOneSignatureNotSupported",xt.AuthorizationNotGrantedToAuthor="AuthorizationNotGrantedToAuthor",xt.ComputeCidCodecNotSupported="ComputeCidCodecNotSupported",xt.ComputeCidMultihashNotSupported="ComputeCidMultihashNotSupported",xt.Ed25519InvalidJwk="Ed25519InvalidJwk",xt.EventEmitterStreamNotOpenError="EventEmitterStreamNotOpenError",xt.MessagesGrantAuthorizationMismatchedProtocol="EventsGrantAuthorizationMismatchedProtocol",xt.MessagesSubscribeAuthorizationFailed="MessagesSubscribeAuthorizationFailed",xt.MessagesSubscribeEventStreamUnimplemented="MessagesSubscribeEventStreamUnimplemented",xt.GeneralJwsVerifierGetPublicKeyNotFound="GeneralJwsVerifierGetPublicKeyNotFound",xt.GeneralJwsVerifierInvalidSignature="GeneralJwsVerifierInvalidSignature",xt.GrantAuthorizationGrantExpired="GrantAuthorizationGrantExpired",xt.GrantAuthorizationGrantMissing="GrantAuthorizationGrantMissing",xt.GrantAuthorizationGrantRevoked="GrantAuthorizationGrantRevoked",xt.GrantAuthorizationInterfaceMismatch="GrantAuthorizationInterfaceMismatch",xt.GrantAuthorizationMethodMismatch="GrantAuthorizationMethodMismatch",xt.GrantAuthorizationNotGrantedForTenant="GrantAuthorizationNotGrantedForTenant",xt.GrantAuthorizationNotGrantedToAuthor="GrantAuthorizationNotGrantedToAuthor",xt.GrantAuthorizationGrantNotYetActive="GrantAuthorizationGrantNotYetActive",xt.HdKeyDerivationPathInvalid="HdKeyDerivationPathInvalid",xt.JwsVerifySignatureUnsupportedCrv="JwsVerifySignatureUnsupportedCrv",xt.IndexInvalidCursorValueType="IndexInvalidCursorValueType",xt.IndexInvalidCursorSortProperty="IndexInvalidCursorSortProperty",xt.IndexInvalidSortPropertyInMemory="IndexInvalidSortPropertyInMemory",xt.IndexMissingIndexableProperty="IndexMissingIndexableProperty",xt.JwsDecodePlainObjectPayloadInvalid="JwsDecodePlainObjectPayloadInvalid",xt.MessagesReadInvalidCid="MessagesReadInvalidCid",xt.MessagesReadAuthorizationFailed="MessagesReadAuthorizationFailed",xt.MessageGetInvalidCid="MessageGetInvalidCid",xt.MessagesQueryAuthorizationFailed="MessagesQueryAuthorizationFailed",xt.MessagesReadVerifyScopeFailed="MessagesReadVerifyScopeFailed",xt.ParseCidCodecNotSupported="ParseCidCodecNotSupported",xt.ParseCidMultihashNotSupported="ParseCidMultihashNotSupported",xt.PermissionsProtocolCreateGrantRecordsScopeMissingProtocol="PermissionsProtocolCreateGrantRecordsScopeMissingProtocol",xt.PermissionsProtocolCreateRequestRecordsScopeMissingProtocol="PermissionsProtocolCreateRequestRecordsScopeMissingProtocol",xt.PermissionsProtocolGetScopeInvalidProtocol="PermissionsProtocolGetScopeInvalidProtocol",xt.PermissionsProtocolValidateSchemaUnexpectedRecord="PermissionsProtocolValidateSchemaUnexpectedRecord",xt.PermissionsProtocolValidateScopeContextIdProhibitedProperties="PermissionsProtocolValidateScopeContextIdProhibitedProperties",xt.PermissionsProtocolValidateScopeProtocolMismatch="PermissionsProtocolValidateScopeProtocolMismatch",xt.PermissionsProtocolValidateScopeMissingProtocolTag="PermissionsProtocolValidateScopeMissingProtocolTag",xt.PermissionsProtocolValidateRevocationProtocolTagMismatch="PermissionsProtocolValidateRevocationProtocolTagMismatch",xt.PrivateKeySignerUnableToDeduceAlgorithm="PrivateKeySignerUnableToDeduceAlgorithm",xt.PrivateKeySignerUnableToDeduceKeyId="PrivateKeySignerUnableToDeduceKeyId",xt.PrivateKeySignerUnsupportedCurve="PrivateKeySignerUnsupportedCurve",xt.ProtocolAuthorizationActionNotAllowed="ProtocolAuthorizationActionNotAllowed",xt.ProtocolAuthorizationActionRulesNotFound="ProtocolAuthorizationActionRulesNotFound",xt.ProtocolAuthorizationIncorrectDataFormat="ProtocolAuthorizationIncorrectDataFormat",xt.ProtocolAuthorizationIncorrectContextId="ProtocolAuthorizationIncorrectContextId",xt.ProtocolAuthorizationIncorrectProtocolPath="ProtocolAuthorizationIncorrectProtocolPath",xt.ProtocolAuthorizationDuplicateRoleRecipient="ProtocolAuthorizationDuplicateRoleRecipient",xt.ProtocolAuthorizationInvalidSchema="ProtocolAuthorizationInvalidSchema",xt.ProtocolAuthorizationInvalidType="ProtocolAuthorizationInvalidType",xt.ProtocolAuthorizationMatchingRoleRecordNotFound="ProtocolAuthorizationMatchingRoleRecordNotFound",xt.ProtocolAuthorizationMaxSizeInvalid="ProtocolAuthorizationMaxSizeInvalid",xt.ProtocolAuthorizationMinSizeInvalid="ProtocolAuthorizationMinSizeInvalid",xt.ProtocolAuthorizationMissingContextId="ProtocolAuthorizationMissingContextId",xt.ProtocolAuthorizationMissingRuleSet="ProtocolAuthorizationMissingRuleSet",xt.ProtocolAuthorizationParentlessIncorrectProtocolPath="ProtocolAuthorizationParentlessIncorrectProtocolPath",xt.ProtocolAuthorizationNotARole="ProtocolAuthorizationNotARole",xt.ProtocolAuthorizationParentNotFoundConstructingRecordChain="ProtocolAuthorizationParentNotFoundConstructingRecordChain",xt.ProtocolAuthorizationProtocolNotFound="ProtocolAuthorizationProtocolNotFound",xt.ProtocolAuthorizationRoleMissingRecipient="ProtocolAuthorizationRoleMissingRecipient",xt.ProtocolAuthorizationTagsInvalidSchema="ProtocolAuthorizationTagsInvalidSchema",xt.ProtocolsConfigureAuthorizationFailed="ProtocolsConfigureAuthorizationFailed",xt.ProtocolsConfigureDuplicateActorInRuleSet="ProtocolsConfigureDuplicateActorInRuleSet",xt.ProtocolsConfigureDuplicateRoleInRuleSet="ProtocolsConfigureDuplicateRoleInRuleSet",xt.ProtocolsConfigureInvalidSize="ProtocolsConfigureInvalidSize",xt.ProtocolsConfigureInvalidActionMissingOf="ProtocolsConfigureInvalidActionMissingOf",xt.ProtocolsConfigureInvalidActionOfNotAllowed="ProtocolsConfigureInvalidActionOfNotAllowed",xt.ProtocolsConfigureInvalidActionDeleteWithoutCreate="ProtocolsConfigureInvalidActionDeleteWithoutCreate",xt.ProtocolsConfigureInvalidActionUpdateWithoutCreate="ProtocolsConfigureInvalidActionUpdateWithoutCreate",xt.ProtocolsConfigureInvalidRecipientOfAction="ProtocolsConfigureInvalidRecipientOfAction",xt.ProtocolsConfigureInvalidRuleSetRecordType="ProtocolsConfigureInvalidRuleSetRecordType",xt.ProtocolsConfigureInvalidTagSchema="ProtocolsConfigureInvalidTagSchema",xt.ProtocolsConfigureRecordNestingDepthExceeded="ProtocolsConfigureRecordNestingDepthExceeded",xt.ProtocolsConfigureRoleDoesNotExistAtGivenPath="ProtocolsConfigureRoleDoesNotExistAtGivenPath",xt.ProtocolsGrantAuthorizationQueryProtocolScopeMismatch="ProtocolsGrantAuthorizationQueryProtocolScopeMismatch",xt.ProtocolsGrantAuthorizationScopeProtocolMismatch="ProtocolsGrantAuthorizationScopeProtocolMismatch",xt.ProtocolsQueryUnauthorized="ProtocolsQueryUnauthorized",xt.RecordsAuthorDelegatedGrantAndIdExistenceMismatch="RecordsAuthorDelegatedGrantAndIdExistenceMismatch",xt.RecordsAuthorDelegatedGrantCidMismatch="RecordsAuthorDelegatedGrantCidMismatch",xt.RecordsAuthorDelegatedGrantGrantedToAndOwnerSignatureMismatch="RecordsAuthorDelegatedGrantGrantedToAndOwnerSignatureMismatch",xt.RecordsAuthorDelegatedGrantNotADelegatedGrant="RecordsAuthorDelegatedGrantNotADelegatedGrant",xt.RecordsDecryptNoMatchingKeyEncryptedFound="RecordsDecryptNoMatchingKeyEncryptedFound",xt.RecordsDeleteAuthorizationFailed="RecordsDeleteAuthorizationFailed",xt.RecordsQueryCreateFilterPublishedSortInvalid="RecordsQueryCreateFilterPublishedSortInvalid",xt.RecordsQueryParseFilterPublishedSortInvalid="RecordsQueryParseFilterPublishedSortInvalid",xt.RecordsGrantAuthorizationConditionPublicationProhibited="RecordsGrantAuthorizationConditionPublicationProhibited",xt.RecordsGrantAuthorizationConditionPublicationRequired="RecordsGrantAuthorizationConditionPublicationRequired",xt.RecordsGrantAuthorizationDeleteProtocolScopeMismatch="RecordsGrantAuthorizationDeleteProtocolScopeMismatch",xt.RecordsGrantAuthorizationQueryOrSubscribeProtocolScopeMismatch="RecordsGrantAuthorizationQueryOrSubscribeProtocolScopeMismatch",xt.RecordsGrantAuthorizationScopeContextIdMismatch="RecordsGrantAuthorizationScopeContextIdMismatch",xt.RecordsGrantAuthorizationScopeProtocolMismatch="RecordsGrantAuthorizationScopeProtocolMismatch",xt.RecordsGrantAuthorizationScopeProtocolPathMismatch="RecordsGrantAuthorizationScopeProtocolPathMismatch",xt.RecordsDerivePrivateKeyUnSupportedCurve="RecordsDerivePrivateKeyUnSupportedCurve",xt.RecordsInvalidAncestorKeyDerivationSegment="RecordsInvalidAncestorKeyDerivationSegment",xt.RecordsOwnerDelegatedGrantAndIdExistenceMismatch="RecordsOwnerDelegatedGrantAndIdExistenceMismatch",xt.RecordsOwnerDelegatedGrantCidMismatch="RecordsOwnerDelegatedGrantCidMismatch",xt.RecordsOwnerDelegatedGrantGrantedToAndOwnerSignatureMismatch="RecordsOwnerDelegatedGrantGrantedToAndOwnerSignatureMismatch",xt.RecordsOwnerDelegatedGrantNotADelegatedGrant="RecordsOwnerDelegatedGrantNotADelegatedGrant",xt.RecordsProtocolContextDerivationSchemeMissingContextId="RecordsProtocolContextDerivationSchemeMissingContextId",xt.RecordsProtocolPathDerivationSchemeMissingProtocol="RecordsProtocolPathDerivationSchemeMissingProtocol",xt.RecordsQueryFilterMissingRequiredProperties="RecordsQueryFilterMissingRequiredProperties",xt.RecordsReadReturnedMultiple="RecordsReadReturnedMultiple",xt.RecordsReadAuthorizationFailed="RecordsReadAuthorizationFailed",xt.RecordsSubscribeEventStreamUnimplemented="RecordsSubscribeEventStreamUnimplemented",xt.RecordsSubscribeFilterMissingRequiredProperties="RecordsSubscribeFilterMissingRequiredProperties",xt.RecordsSchemasDerivationSchemeMissingSchema="RecordsSchemasDerivationSchemeMissingSchema",xt.RecordsWriteAttestationIntegrityMoreThanOneSignature="RecordsWriteAttestationIntegrityMoreThanOneSignature",xt.RecordsWriteAttestationIntegrityDescriptorCidMismatch="RecordsWriteAttestationIntegrityDescriptorCidMismatch",xt.RecordsWriteAttestationIntegrityInvalidPayloadProperty="RecordsWriteAttestationIntegrityInvalidPayloadProperty",xt.RecordsWriteAuthorizationFailed="RecordsWriteAuthorizationFailed",xt.RecordsWriteCreateMissingSigner="RecordsWriteCreateMissingSigner",xt.RecordsWriteCreateDataAndDataCidMutuallyExclusive="RecordsWriteCreateDataAndDataCidMutuallyExclusive",xt.RecordsWriteCreateDataCidAndDataSizeMutuallyInclusive="RecordsWriteCreateDataCidAndDataSizeMutuallyInclusive",xt.RecordsWriteCreateProtocolAndProtocolPathMutuallyInclusive="RecordsWriteCreateProtocolAndProtocolPathMutuallyInclusive",xt.RecordsWriteDataCidMismatch="RecordsWriteDataCidMismatch",xt.RecordsWriteDataSizeMismatch="RecordsWriteDataSizeMismatch",xt.RecordsWriteGetEntryIdUndefinedAuthor="RecordsWriteGetEntryIdUndefinedAuthor",xt.RecordsWriteGetNewestWriteRecordNotFound="RecordsWriteGetNewestWriteRecordNotFound",xt.RecordsWriteGetInitialWriteNotFound="RecordsWriteGetInitialWriteNotFound",xt.RecordsWriteImmutablePropertyChanged="RecordsWriteImmutablePropertyChanged",xt.RecordsWriteMissingSigner="RecordsWriteMissingSigner",xt.RecordsWriteMissingDataInPrevious="RecordsWriteMissingDataInPrevious",xt.RecordsWriteMissingEncodedDataInPrevious="RecordsWriteMissingEncodedDataInPrevious",xt.RecordsWriteMissingProtocol="RecordsWriteMissingProtocol",xt.RecordsWriteMissingSchema="RecordsWriteMissingSchema",xt.RecordsWriteNotAllowedAfterDelete="RecordsWriteNotAllowedAfterDelete",xt.RecordsWriteOwnerAndTenantMismatch="RecordsWriteOwnerAndTenantMismatch",xt.RecordsWriteSignAsOwnerDelegateUnknownAuthor="RecordsWriteSignAsOwnerDelegateUnknownAuthor",xt.RecordsWriteSignAsOwnerUnknownAuthor="RecordsWriteSignAsOwnerUnknownAuthor",xt.RecordsWriteValidateIntegrityAttestationMismatch="RecordsWriteValidateIntegrityAttestationMismatch",xt.RecordsWriteValidateIntegrityContextIdMismatch="RecordsWriteValidateIntegrityContextIdMismatch",xt.RecordsWriteValidateIntegrityContextIdNotInSignerSignaturePayload="RecordsWriteValidateIntegrityContextIdNotInSignerSignaturePayload",xt.RecordsWriteValidateIntegrityDateCreatedMismatch="RecordsWriteValidateIntegrityDateCreatedMismatch",xt.RecordsWriteValidateIntegrityEncryptionCidMismatch="RecordsWriteValidateIntegrityEncryptionCidMismatch",xt.RecordsWriteValidateIntegrityRecordIdUnauthorized="RecordsWriteValidateIntegrityRecordIdUnauthorized",xt.SchemaValidatorAdditionalPropertyNotAllowed="SchemaValidatorAdditionalPropertyNotAllowed",xt.SchemaValidatorFailure="SchemaValidatorFailure",xt.SchemaValidatorSchemaNotFound="SchemaValidatorSchemaNotFound",xt.SchemaValidatorUnevaluatedPropertyNotAllowed="SchemaValidatorUnevaluatedPropertyNotAllowed",xt.Secp256k1KeyNotValid="Secp256k1KeyNotValid",xt.Secp256r1KeyNotValid="Secp256r1KeyNotValid",xt.TimestampInvalid="TimestampInvalid",xt.UrlProtocolNotNormalized="UrlProtocolNotNormalized",xt.UrlProtocolNotNormalizable="UrlProtocolNotNormalizable",xt.UrlSchemaNotNormalized="UrlSchemaNotNormalized"})(DwnErrorCode||(DwnErrorCode={}));var __awaiter$3l=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function validateKey(xt){if(xt.kty!=="OKP"||xt.crv!=="Ed25519")throw new DwnError(DwnErrorCode.Ed25519InvalidJwk,"invalid jwk. kty MUST be OKP. crv MUST be Ed25519")}function publicKeyToJwk(xt){return{alg:"EdDSA",kty:"OKP",crv:"Ed25519",x:Encoder$4.bytesToBase64Url(xt)}}const ed25519$2={sign:(xt,e)=>__awaiter$3l(void 0,void 0,void 0,function*(){validateKey(e);const At=Encoder$4.base64UrlToBytes(e.d);return signAsync$1(xt,At)}),verify:(xt,e,At)=>__awaiter$3l(void 0,void 0,void 0,function*(){validateKey(At);const kt=Encoder$4.base64UrlToBytes(At.x);return verifyAsync(e,xt,kt)}),generateKeyPair:()=>__awaiter$3l(void 0,void 0,void 0,function*(){const xt=utils$y.randomPrivateKey(),e=yield getPublicKeyAsync(xt),At=Encoder$4.bytesToBase64Url(xt),kt=publicKeyToJwk(e),Bt=Object.assign(Object.assign({},kt),{d:At});return{publicJwk:kt,privateJwk:Bt}}),publicKeyToJwk:xt=>__awaiter$3l(void 0,void 0,void 0,function*(){return publicKeyToJwk(xt)})};/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */const B256=2n**256n,P$2=B256-0x1000003d1n,N$1=B256-0x14551231950b75fc4402da1732fc9bebfn,Gx=0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798n,Gy=0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8n,CURVE={p:P$2,n:N$1,a:0n,b:7n,Gx,Gy},fLen=32,crv=xt=>mod$3(mod$3(xt*xt)*xt+CURVE.b),err=(xt="")=>{throw new Error(xt)},big=xt=>typeof xt=="bigint",str=xt=>typeof xt=="string",fe$1=xt=>big(xt)&&0n<xt&&xt<P$2,ge$1=xt=>big(xt)&&0n<xt&&xt<N$1,au8=(xt,e)=>!(xt instanceof Uint8Array)||typeof e=="number"&&e>0&&xt.length!==e?err("Uint8Array expected"):xt,u8n$3=xt=>new Uint8Array(xt),toU8=(xt,e)=>au8(str(xt)?h2b$2(xt):u8n$3(xt),e),mod$3=(xt,e=P$2)=>{let At=xt%e;return At>=0n?At:e+At},isPoint=xt=>xt instanceof Point$3?xt:err("Point expected");let Gpows,Point$3=class bs{constructor(e,At,kt){this.px=e,this.py=At,this.pz=kt}static fromAffine(e){return new bs(e.x,e.y,1n)}static fromHex(e){e=toU8(e);let At;const kt=e[0],Bt=e.subarray(1),Nt=slcNum(Bt,0,fLen),jt=e.length;if(jt===33&&[2,3].includes(kt)){fe$1(Nt)||err("Point hex invalid: x not FE");let Lt=sqrt(crv(Nt));const er=(Lt&1n)===1n;(kt&1)===1!==er&&(Lt=mod$3(-Lt)),At=new bs(Nt,Lt,1n)}return jt===65&&kt===4&&(At=new bs(Nt,slcNum(Bt,fLen,2*fLen),1n)),At?At.ok():err("Point is not on curve")}static fromPrivateKey(e){return G$2.mul(toPriv(e))}get x(){return this.aff().x}get y(){return this.aff().y}equals(e){const{px:At,py:kt,pz:Bt}=this,{px:Nt,py:jt,pz:Lt}=isPoint(e),er=mod$3(At*Lt),tr=mod$3(Nt*Bt),zt=mod$3(kt*Lt),rr=mod$3(jt*Bt);return er===tr&&zt===rr}negate(){return new bs(this.px,mod$3(-this.py),this.pz)}double(){return this.add(this)}add(e){const{px:At,py:kt,pz:Bt}=this,{px:Nt,py:jt,pz:Lt}=isPoint(e),{a:er,b:tr}=CURVE;let zt=0n,rr=0n,nr=0n;const ir=mod$3(tr*3n);let ar=mod$3(At*Nt),dr=mod$3(kt*jt),ur=mod$3(Bt*Lt),fr=mod$3(At+kt),pr=mod$3(Nt+jt);fr=mod$3(fr*pr),pr=mod$3(ar+dr),fr=mod$3(fr-pr),pr=mod$3(At+Bt);let lr=mod$3(Nt+Lt);return pr=mod$3(pr*lr),lr=mod$3(ar+ur),pr=mod$3(pr-lr),lr=mod$3(kt+Bt),zt=mod$3(jt+Lt),lr=mod$3(lr*zt),zt=mod$3(dr+ur),lr=mod$3(lr-zt),nr=mod$3(er*pr),zt=mod$3(ir*ur),nr=mod$3(zt+nr),zt=mod$3(dr-nr),nr=mod$3(dr+nr),rr=mod$3(zt*nr),dr=mod$3(ar+ar),dr=mod$3(dr+ar),ur=mod$3(er*ur),pr=mod$3(ir*pr),dr=mod$3(dr+ur),ur=mod$3(ar-ur),ur=mod$3(er*ur),pr=mod$3(pr+ur),ar=mod$3(dr*pr),rr=mod$3(rr+ar),ar=mod$3(lr*pr),zt=mod$3(fr*zt),zt=mod$3(zt-ar),ar=mod$3(fr*dr),nr=mod$3(lr*nr),nr=mod$3(nr+ar),new bs(zt,rr,nr)}mul(e,At=!0){if(!At&&e===0n)return I$1;if(ge$1(e)||err("invalid scalar"),this.equals(G$2))return wNAF$3(e).p;let kt=I$1,Bt=G$2;for(let Nt=this;e>0n;Nt=Nt.double(),e>>=1n)e&1n?kt=kt.add(Nt):At&&(Bt=Bt.add(Nt));return kt}mulAddQUns(e,At,kt){return this.mul(At,!1).add(e.mul(kt,!1)).ok()}toAffine(){const{px:e,py:At,pz:kt}=this;if(this.equals(I$1))return{x:0n,y:0n};if(kt===1n)return{x:e,y:At};const Bt=inv(kt);return mod$3(kt*Bt)!==1n&&err("invalid inverse"),{x:mod$3(e*Bt),y:mod$3(At*Bt)}}assertValidity(){const{x:e,y:At}=this.aff();return(!fe$1(e)||!fe$1(At))&&err("Point invalid: x or y"),mod$3(At*At)===crv(e)?this:err("Point invalid: not on curve")}multiply(e){return this.mul(e)}aff(){return this.toAffine()}ok(){return this.assertValidity()}toHex(e=!0){const{x:At,y:kt}=this.aff();return(e?(kt&1n)===0n?"02":"03":"04")+n2h(At)+(e?"":n2h(kt))}toRawBytes(e=!0){return h2b$2(this.toHex(e))}};Point$3.BASE=new Point$3(Gx,Gy,1n);Point$3.ZERO=new Point$3(0n,1n,0n);const{BASE:G$2,ZERO:I$1}=Point$3,padh=(xt,e)=>xt.toString(16).padStart(e,"0"),b2h=xt=>Array.from(xt).map(e=>padh(e,2)).join(""),h2b$2=xt=>{const e=xt.length;(!str(xt)||e%2)&&err("hex invalid 1");const At=u8n$3(e/2);for(let kt=0;kt<At.length;kt++){const Bt=kt*2,Nt=xt.slice(Bt,Bt+2),jt=Number.parseInt(Nt,16);(Number.isNaN(jt)||jt<0)&&err("hex invalid 2"),At[kt]=jt}return At},b2n$2=xt=>BigInt("0x"+(b2h(xt)||"0")),slcNum=(xt,e,At)=>b2n$2(xt.slice(e,At)),n2b=xt=>big(xt)&&xt>=0n&&xt<B256?h2b$2(padh(xt,2*fLen)):err("bigint expected"),n2h=xt=>b2h(n2b(xt)),concatB=(...xt)=>{const e=u8n$3(xt.reduce((kt,Bt)=>kt+au8(Bt).length,0));let At=0;return xt.forEach(kt=>{e.set(kt,At),At+=kt.length}),e},inv=(xt,e=P$2)=>{(xt===0n||e<=0n)&&err("no inverse n="+xt+" mod="+e);let At=mod$3(xt,e),kt=e,Bt=0n,Nt=1n;for(;At!==0n;){const jt=kt/At,Lt=kt%At,er=Bt-Nt*jt;kt=At,At=Lt,Bt=Nt,Nt=er}return kt===1n?mod$3(Bt,e):err("no inverse")},sqrt=xt=>{let e=1n;for(let At=xt,kt=(P$2+1n)/4n;kt>0n;kt>>=1n)kt&1n&&(e=e*At%P$2),At=At*At%P$2;return mod$3(e*e)===xt?e:err("sqrt invalid")},toPriv=xt=>(big(xt)||(xt=b2n$2(toU8(xt,fLen))),ge$1(xt)?xt:err("private key out of range")),moreThanHalfN=xt=>xt>N$1>>1n;function getPublicKey$1(xt,e=!0){return Point$3.fromPrivateKey(xt).toRawBytes(e)}let Signature$3=class Js{constructor(e,At,kt){this.r=e,this.s=At,this.recovery=kt,this.assertValidity()}static fromCompact(e){return e=toU8(e,64),new Js(slcNum(e,0,fLen),slcNum(e,fLen,2*fLen))}assertValidity(){return ge$1(this.r)&&ge$1(this.s)?this:err()}addRecoveryBit(e){return new Js(this.r,this.s,e)}hasHighS(){return moreThanHalfN(this.s)}recoverPublicKey(e){const{r:At,s:kt,recovery:Bt}=this;[0,1,2,3].includes(Bt)||err("recovery id invalid");const Nt=bits2int_modN(toU8(e,32)),jt=Bt===2||Bt===3?At+N$1:At;jt>=P$2&&err("q.x invalid");const Lt=Bt&1?"03":"02",er=Point$3.fromHex(Lt+n2h(jt)),tr=inv(jt,N$1),zt=mod$3(-Nt*tr,N$1),rr=mod$3(kt*tr,N$1);return G$2.mulAddQUns(er,zt,rr)}toCompactRawBytes(){return h2b$2(this.toCompactHex())}toCompactHex(){return n2h(this.r)+n2h(this.s)}};const bits2int=xt=>{const e=xt.length*8-256,At=b2n$2(xt);return e>0?At>>BigInt(e):At},bits2int_modN=xt=>mod$3(bits2int(xt),N$1),i2o=xt=>n2b(xt),cr$1=()=>typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;let _hmacSync;const optS={lowS:!0},optV={lowS:!0};function prepSig(xt,e,At=optS){["der","recovered","canonical"].some(rr=>rr in At)&&err("sign() legacy options not supported");let{lowS:kt}=At;kt==null&&(kt=!0);const Bt=bits2int_modN(toU8(xt)),Nt=i2o(Bt),jt=toPriv(e),Lt=[i2o(jt),Nt];let er=At.extraEntropy;if(er){er===!0&&(er=etc.randomBytes(fLen));const rr=toU8(er);rr.length!==fLen&&err(),Lt.push(rr)}const tr=Bt,zt=rr=>{const nr=bits2int(rr);if(!ge$1(nr))return;const ir=inv(nr,N$1),ar=G$2.mul(nr).aff(),dr=mod$3(ar.x,N$1);if(dr===0n)return;const ur=mod$3(ir*mod$3(tr+mod$3(jt*dr,N$1),N$1),N$1);if(ur===0n)return;let fr=ur,pr=(ar.x===dr?0:2)|Number(ar.y&1n);return kt&&moreThanHalfN(ur)&&(fr=mod$3(-ur,N$1),pr^=1),new Signature$3(dr,fr,pr)};return{seed:concatB(...Lt),k2sig:zt}}function hmacDrbg$1(xt){let e=u8n$3(fLen),At=u8n$3(fLen),kt=0;const Bt=()=>{e.fill(1),At.fill(0),kt=0},Nt="drbg: tried 1000 values";{const jt=(...tr)=>etc.hmacSha256Async(At,e,...tr),Lt=async(tr=u8n$3())=>{At=await jt(u8n$3([0]),tr),e=await jt(),tr.length!==0&&(At=await jt(u8n$3([1]),tr),e=await jt())},er=async()=>(kt++>=1e3&&err(Nt),e=await jt(),e);return async(tr,zt)=>{Bt(),await Lt(tr);let rr;for(;!(rr=zt(await er()));)await Lt();return Bt(),rr}}}async function signAsync(xt,e,At=optS){const{seed:kt,k2sig:Bt}=prepSig(xt,e,At);return hmacDrbg$1()(kt,Bt)}function verify(xt,e,At,kt=optV){let{lowS:Bt}=kt;Bt==null&&(Bt=!0),"strict"in kt&&err("verify() legacy options not supported");let Nt,jt,Lt;const er=xt&&typeof xt=="object"&&"r"in xt;!er&&toU8(xt).length!==2*fLen&&err("signature must be 64 bytes");try{Nt=er?new Signature$3(xt.r,xt.s).assertValidity():Signature$3.fromCompact(xt),jt=bits2int_modN(toU8(e,fLen)),Lt=At instanceof Point$3?At.ok():Point$3.fromHex(At)}catch{return!1}if(!Nt)return!1;const{r:tr,s:zt}=Nt;if(Bt&&moreThanHalfN(zt))return!1;let rr;try{const ir=inv(zt,N$1),ar=mod$3(jt*ir,N$1),dr=mod$3(tr*ir,N$1);rr=G$2.mulAddQUns(Lt,ar,dr).aff()}catch{return!1}return rr?mod$3(rr.x,N$1)===tr:!1}function hashToPrivateKey(xt){xt=toU8(xt);const e=fLen+8;(xt.length<e||xt.length>1024)&&err("expected proper params");const At=mod$3(b2n$2(xt),N$1-1n)+1n;return n2b(At)}const etc={hexToBytes:h2b$2,bytesToHex:b2h,concatBytes:concatB,bytesToNumberBE:b2n$2,numberToBytesBE:n2b,mod:mod$3,invert:inv,hmacSha256Async:async(xt,...e)=>{const At=cr$1();if(!At)return err("etc.hmacSha256Async not set");const kt=At.subtle,Bt=await kt.importKey("raw",xt,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return u8n$3(await kt.sign("HMAC",Bt,concatB(...e)))},hmacSha256Sync:_hmacSync,hashToPrivateKey,randomBytes:xt=>{const e=cr$1();return e||err("crypto.getRandomValues must be defined"),e.getRandomValues(u8n$3(xt))}},utils$x={normPrivateKeyToScalar:toPriv,isValidPrivateKey:xt=>{try{return!!toPriv(xt)}catch{return!1}},randomPrivateKey:()=>hashToPrivateKey(etc.randomBytes(fLen+8)),precompute(xt=8,e=G$2){return e.multiply(3n),e}};Object.defineProperties(etc,{hmacSha256Sync:{configurable:!1,get(){return _hmacSync},set(xt){_hmacSync||(_hmacSync=xt)}}});const W$7=8,precompute=()=>{const xt=[],e=256/W$7+1;let At=G$2,kt=At;for(let Bt=0;Bt<e;Bt++){kt=At,xt.push(kt);for(let Nt=1;Nt<2**(W$7-1);Nt++)kt=kt.add(At),xt.push(kt);At=kt.double()}return xt},wNAF$3=xt=>{const e=Gpows||(Gpows=precompute()),At=(zt,rr)=>{let nr=rr.negate();return zt?nr:rr};let kt=I$1,Bt=G$2;const Nt=1+256/W$7,jt=2**(W$7-1),Lt=BigInt(2**W$7-1),er=2**W$7,tr=BigInt(W$7);for(let zt=0;zt<Nt;zt++){const rr=zt*jt;let nr=Number(xt&Lt);xt>>=tr,nr>jt&&(nr-=er,xt+=1n);const ir=rr,ar=rr+Math.abs(nr)-1,dr=zt%2!==0,ur=nr<0;nr===0?Bt=Bt.add(At(dr,e[ir])):kt=kt.add(At(ur,e[ar]))}return{p:kt,f:Bt}};var encode_1$3=encode$i,MSB$5=128,REST$5=127,MSBALL$3=~REST$5,INT$3=Math.pow(2,31);function encode$i(xt,e,At){e=e||[],At=At||0;for(var kt=At;xt>=INT$3;)e[At++]=xt&255|MSB$5,xt/=128;for(;xt&MSBALL$3;)e[At++]=xt&255|MSB$5,xt>>>=7;return e[At]=xt|0,encode$i.bytes=At-kt+1,e}var decode$o=read$4,MSB$1$3=128,REST$1$3=127;function read$4(xt,kt){var At=0,kt=kt||0,Bt=0,Nt=kt,jt,Lt=xt.length;do{if(Nt>=Lt)throw read$4.bytes=0,new RangeError("Could not decode varint");jt=xt[Nt++],At+=Bt<28?(jt&REST$1$3)<<Bt:(jt&REST$1$3)*Math.pow(2,Bt),Bt+=7}while(jt>=MSB$1$3);return read$4.bytes=Nt-kt,At}var N1$4=Math.pow(2,7),N2$4=Math.pow(2,14),N3$4=Math.pow(2,21),N4$4=Math.pow(2,28),N5$4=Math.pow(2,35),N6$4=Math.pow(2,42),N7$4=Math.pow(2,49),N8$3=Math.pow(2,56),N9$3=Math.pow(2,63),length$4=function(xt){return xt<N1$4?1:xt<N2$4?2:xt<N3$4?3:xt<N4$4?4:xt<N5$4?5:xt<N6$4?6:xt<N7$4?7:xt<N8$3?8:xt<N9$3?9:10},varint$3={encode:encode_1$3,decode:decode$o,encodingLength:length$4},_brrp_varint$3=varint$3;const decode$n=(xt,e=0)=>[_brrp_varint$3.decode(xt,e),_brrp_varint$3.decode.bytes],encodeTo$3=(xt,e,At=0)=>(_brrp_varint$3.encode(xt,e,At),e),encodingLength$8=xt=>_brrp_varint$3.encodingLength(xt),create$2=(xt,e)=>{const At=e.byteLength,kt=encodingLength$8(xt),Bt=kt+encodingLength$8(At),Nt=new Uint8Array(Bt+At);return encodeTo$3(xt,Nt,0),encodeTo$3(At,Nt,kt),Nt.set(e,Bt),new Digest$2(xt,At,e,Nt)},decode$m=xt=>{const e=coerce$3(xt),[At,kt]=decode$n(e),[Bt,Nt]=decode$n(e.subarray(kt)),jt=e.subarray(kt+Nt);if(jt.byteLength!==Bt)throw new Error("Incorrect length");return new Digest$2(At,Bt,jt,e)},equals$5=(xt,e)=>{if(xt===e)return!0;{const At=e;return xt.code===At.code&&xt.size===At.size&&At.bytes instanceof Uint8Array&&equals$6(xt.bytes,At.bytes)}};let Digest$2=class{constructor(e,At,kt,Bt){this.code=e,this.size=At,this.digest=kt,this.bytes=Bt}};const from$9=({name:xt,code:e,encode:At})=>new Hasher$2(xt,e,At);let Hasher$2=class{constructor(e,At,kt){this.name=e,this.code=At,this.encode=kt}digest(e){if(e instanceof Uint8Array){const At=this.encode(e);return At instanceof Uint8Array?create$2(this.code,At):At.then(kt=>create$2(this.code,kt))}else throw Error("Unknown type, must be binary type")}};const sha$6=xt=>async e=>new Uint8Array(await crypto.subtle.digest(xt,e)),sha256$7=from$9({name:"sha2-256",code:18,encode:sha$6("SHA-256")});var __awaiter$3k=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$J=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let Secp256k1$3=class Qo{static validateKey(e){if(e.kty!=="EC"||e.crv!=="secp256k1")throw new DwnError(DwnErrorCode.Secp256k1KeyNotValid,"Invalid SECP256K1 JWK: `kty` MUST be `EC`. `crv` MUST be `secp256k1`")}static publicKeyToJwk(e){return __awaiter$3k(this,void 0,void 0,function*(){let At;e.byteLength===33?At=Point$3.fromHex(e).toRawBytes(!1):At=e;const kt=Encoder$4.bytesToBase64Url(At.subarray(1,33)),Bt=Encoder$4.bytesToBase64Url(At.subarray(33,65));return{alg:"ES256K",kty:"EC",crv:"secp256k1",x:kt,y:Bt}})}static privateKeyToJwk(e){return __awaiter$3k(this,void 0,void 0,function*(){const At=yield Qo.getPublicKey(e),kt=yield Qo.publicKeyToJwk(At);return kt.d=Encoder$4.bytesToBase64Url(e),kt})}static publicJwkToBytes(e){const At=Encoder$4.base64UrlToBytes(e.x),kt=Encoder$4.base64UrlToBytes(e.y);return Point$3.fromAffine({x:etc.bytesToNumberBE(At),y:etc.bytesToNumberBE(kt)}).toRawBytes(!0)}static privateJwkToBytes(e){return Encoder$4.base64UrlToBytes(e.d)}static sign(e,At){return __awaiter$3k(this,void 0,void 0,function*(){Qo.validateKey(At);const kt=yield sha256$7.encode(e),Bt=Qo.privateJwkToBytes(At);return(yield signAsync(kt,Bt)).toCompactRawBytes()})}static verify(e,At,kt){return __awaiter$3k(this,void 0,void 0,function*(){Qo.validateKey(kt);const Bt=Qo.publicJwkToBytes(kt),Nt=yield sha256$7.encode(e);return verify(At,Nt,Bt)})}static generateKeyPair(){return __awaiter$3k(this,void 0,void 0,function*(){const e=utils$x.randomPrivateKey(),At=getPublicKey$1(e,!1),kt=Encoder$4.bytesToBase64Url(e),Bt=yield Qo.publicKeyToJwk(At),Nt=Object.assign(Object.assign({},Bt),{d:kt});return{publicJwk:Bt,privateJwk:Nt}})}static generateKeyPairRaw(){return __awaiter$3k(this,void 0,void 0,function*(){const e=utils$x.randomPrivateKey();return{publicKey:getPublicKey$1(e,!0),privateKey:e}})}static getPublicKey(e){return __awaiter$3k(this,void 0,void 0,function*(){return getPublicKey$1(e,!0)})}static getPublicJwk(e){return __awaiter$3k(this,void 0,void 0,function*(){return __rest$J(e,["d"])})}};function number$4(xt){if(!Number.isSafeInteger(xt)||xt<0)throw new Error(`positive integer expected, not ${xt}`)}function isBytes$b(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}function bytes$5(xt,...e){if(!isBytes$b(xt))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(xt.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${xt.length}`)}function hash$7(xt){if(typeof xt!="function"||typeof xt.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$4(xt.outputLen),number$4(xt.blockLen)}function exists$6(xt,e=!0){if(xt.destroyed)throw new Error("Hash instance has been destroyed");if(e&&xt.finished)throw new Error("Hash#digest() has already been called")}function output$5(xt,e){bytes$5(xt);const At=e.outputLen;if(xt.length<At)throw new Error(`digestInto() expects output buffer of length at least ${At}`)}const crypto$7=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$a(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}const u8=xt=>new Uint8Array(xt.buffer,xt.byteOffset,xt.byteLength),u32$2=xt=>new Uint32Array(xt.buffer,xt.byteOffset,Math.floor(xt.byteLength/4)),createView$2=xt=>new DataView(xt.buffer,xt.byteOffset,xt.byteLength),rotr$1=(xt,e)=>xt<<32-e|xt>>>e,rotl$4=(xt,e)=>xt<<e|xt>>>32-e>>>0,isLE$3=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,byteSwap=xt=>xt<<24&4278190080|xt<<8&16711680|xt>>>8&65280|xt>>>24&255,byteSwapIfBE=isLE$3?xt=>xt:xt=>byteSwap(xt);function byteSwap32(xt){for(let e=0;e<xt.length;e++)xt[e]=byteSwap(xt[e])}const hexes$4=Array.from({length:256},(xt,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$4(xt){bytes$5(xt);let e="";for(let At=0;At<xt.length;At++)e+=hexes$4[xt[At]];return e}const asciis$4={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16$4(xt){if(xt>=asciis$4._0&&xt<=asciis$4._9)return xt-asciis$4._0;if(xt>=asciis$4._A&&xt<=asciis$4._F)return xt-(asciis$4._A-10);if(xt>=asciis$4._a&&xt<=asciis$4._f)return xt-(asciis$4._a-10)}function hexToBytes$4(xt){if(typeof xt!="string")throw new Error("hex string expected, got "+typeof xt);const e=xt.length,At=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const kt=new Uint8Array(At);for(let Bt=0,Nt=0;Bt<At;Bt++,Nt+=2){const jt=asciiToBase16$4(xt.charCodeAt(Nt)),Lt=asciiToBase16$4(xt.charCodeAt(Nt+1));if(jt===void 0||Lt===void 0){const er=xt[Nt]+xt[Nt+1];throw new Error('hex string expected, got non-hex character "'+er+'" at index '+Nt)}kt[Bt]=jt*16+Lt}return kt}const nextTick$4=async()=>{};async function asyncLoop$1(xt,e,At){let kt=Date.now();for(let Bt=0;Bt<xt;Bt++){At(Bt);const Nt=Date.now()-kt;Nt>=0&&Nt<e||(await nextTick$4(),kt+=Nt)}}function utf8ToBytes$7(xt){if(typeof xt!="string")throw new Error(`utf8ToBytes expected string, got ${typeof xt}`);return new Uint8Array(new TextEncoder().encode(xt))}function toBytes$3(xt){return typeof xt=="string"&&(xt=utf8ToBytes$7(xt)),bytes$5(xt),xt}function concatBytes$4(...xt){let e=0;for(let kt=0;kt<xt.length;kt++){const Bt=xt[kt];bytes$5(Bt),e+=Bt.length}const At=new Uint8Array(e);for(let kt=0,Bt=0;kt<xt.length;kt++){const Nt=xt[kt];At.set(Nt,Bt),Bt+=Nt.length}return At}let Hash$9=class{clone(){return this._cloneInto()}};const toStr$5={}.toString;function checkOpts$2(xt,e){if(e!==void 0&&toStr$5.call(e)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(xt,e)}function wrapConstructor$1(xt){const e=kt=>xt().update(toBytes$3(kt)).digest(),At=xt();return e.outputLen=At.outputLen,e.blockLen=At.blockLen,e.create=()=>xt(),e}function wrapConstructorWithOpts(xt){const e=(kt,Bt)=>xt(Bt).update(toBytes$3(kt)).digest(),At=xt({});return e.outputLen=At.outputLen,e.blockLen=At.blockLen,e.create=kt=>xt(kt),e}function wrapXOFConstructorWithOpts(xt){const e=(kt,Bt)=>xt(Bt).update(toBytes$3(kt)).digest(),At=xt({});return e.outputLen=At.outputLen,e.blockLen=At.blockLen,e.create=kt=>xt(kt),e}function randomBytes$7(xt=32){if(crypto$7&&typeof crypto$7.getRandomValues=="function")return crypto$7.getRandomValues(new Uint8Array(xt));throw new Error("crypto.getRandomValues must be defined")}const utils$w=Object.freeze(Object.defineProperty({__proto__:null,Hash:Hash$9,asyncLoop:asyncLoop$1,byteSwap,byteSwap32,byteSwapIfBE,bytesToHex:bytesToHex$4,checkOpts:checkOpts$2,concatBytes:concatBytes$4,createView:createView$2,hexToBytes:hexToBytes$4,isBytes:isBytes$a,isLE:isLE$3,nextTick:nextTick$4,randomBytes:randomBytes$7,rotl:rotl$4,rotr:rotr$1,toBytes:toBytes$3,u32:u32$2,u8,utf8ToBytes:utf8ToBytes$7,wrapConstructor:wrapConstructor$1,wrapConstructorWithOpts,wrapXOFConstructorWithOpts},Symbol.toStringTag,{value:"Module"}));function setBigUint64$3(xt,e,At,kt){if(typeof xt.setBigUint64=="function")return xt.setBigUint64(e,At,kt);const Bt=BigInt(32),Nt=BigInt(4294967295),jt=Number(At>>Bt&Nt),Lt=Number(At&Nt),er=kt?4:0,tr=kt?0:4;xt.setUint32(e+er,jt,kt),xt.setUint32(e+tr,Lt,kt)}const Chi$2=(xt,e,At)=>xt&e^~xt&At,Maj$2=(xt,e,At)=>xt&e^xt&At^e&At;let HashMD$1=class extends Hash$9{constructor(e,At,kt,Bt){super(),this.blockLen=e,this.outputLen=At,this.padOffset=kt,this.isLE=Bt,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$2(this.buffer)}update(e){exists$6(this);const{view:At,buffer:kt,blockLen:Bt}=this;e=toBytes$3(e);const Nt=e.length;for(let jt=0;jt<Nt;){const Lt=Math.min(Bt-this.pos,Nt-jt);if(Lt===Bt){const er=createView$2(e);for(;Bt<=Nt-jt;jt+=Bt)this.process(er,jt);continue}kt.set(e.subarray(jt,jt+Lt),this.pos),this.pos+=Lt,jt+=Lt,this.pos===Bt&&(this.process(At,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists$6(this),output$5(e,this),this.finished=!0;const{buffer:At,view:kt,blockLen:Bt,isLE:Nt}=this;let{pos:jt}=this;At[jt++]=128,this.buffer.subarray(jt).fill(0),this.padOffset>Bt-jt&&(this.process(kt,0),jt=0);for(let rr=jt;rr<Bt;rr++)At[rr]=0;setBigUint64$3(kt,Bt-8,BigInt(this.length*8),Nt),this.process(kt,0);const Lt=createView$2(e),er=this.outputLen;if(er%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const tr=er/4,zt=this.get();if(tr>zt.length)throw new Error("_sha2: outputLen bigger than state");for(let rr=0;rr<tr;rr++)Lt.setUint32(4*rr,zt[rr],Nt)}digest(){const{buffer:e,outputLen:At}=this;this.digestInto(e);const kt=e.slice(0,At);return this.destroy(),kt}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:At,buffer:kt,length:Bt,finished:Nt,destroyed:jt,pos:Lt}=this;return e.length=Bt,e.pos=Lt,e.finished=Nt,e.destroyed=jt,Bt%At&&e.buffer.set(kt),e}};const SHA256_K$2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$2=new Uint32Array(64);let SHA256$4=class extends HashMD$1{constructor(){super(64,32,8,!1),this.A=SHA256_IV$1[0]|0,this.B=SHA256_IV$1[1]|0,this.C=SHA256_IV$1[2]|0,this.D=SHA256_IV$1[3]|0,this.E=SHA256_IV$1[4]|0,this.F=SHA256_IV$1[5]|0,this.G=SHA256_IV$1[6]|0,this.H=SHA256_IV$1[7]|0}get(){const{A:e,B:At,C:kt,D:Bt,E:Nt,F:jt,G:Lt,H:er}=this;return[e,At,kt,Bt,Nt,jt,Lt,er]}set(e,At,kt,Bt,Nt,jt,Lt,er){this.A=e|0,this.B=At|0,this.C=kt|0,this.D=Bt|0,this.E=Nt|0,this.F=jt|0,this.G=Lt|0,this.H=er|0}process(e,At){for(let rr=0;rr<16;rr++,At+=4)SHA256_W$2[rr]=e.getUint32(At,!1);for(let rr=16;rr<64;rr++){const nr=SHA256_W$2[rr-15],ir=SHA256_W$2[rr-2],ar=rotr$1(nr,7)^rotr$1(nr,18)^nr>>>3,dr=rotr$1(ir,17)^rotr$1(ir,19)^ir>>>10;SHA256_W$2[rr]=dr+SHA256_W$2[rr-7]+ar+SHA256_W$2[rr-16]|0}let{A:kt,B:Bt,C:Nt,D:jt,E:Lt,F:er,G:tr,H:zt}=this;for(let rr=0;rr<64;rr++){const nr=rotr$1(Lt,6)^rotr$1(Lt,11)^rotr$1(Lt,25),ir=zt+nr+Chi$2(Lt,er,tr)+SHA256_K$2[rr]+SHA256_W$2[rr]|0,dr=(rotr$1(kt,2)^rotr$1(kt,13)^rotr$1(kt,22))+Maj$2(kt,Bt,Nt)|0;zt=tr,tr=er,er=Lt,Lt=jt+ir|0,jt=Nt,Nt=Bt,Bt=kt,kt=ir+dr|0}kt=kt+this.A|0,Bt=Bt+this.B|0,Nt=Nt+this.C|0,jt=jt+this.D|0,Lt=Lt+this.E|0,er=er+this.F|0,tr=tr+this.G|0,zt=zt+this.H|0,this.set(kt,Bt,Nt,jt,Lt,er,tr,zt)}roundClean(){SHA256_W$2.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},SHA224$2=class extends SHA256$4{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};const sha256$5=wrapConstructor$1(()=>new SHA256$4),sha224$2=wrapConstructor$1(()=>new SHA224$2),sha256$6=Object.freeze(Object.defineProperty({__proto__:null,sha224:sha224$2,sha256:sha256$5},Symbol.toStringTag,{value:"Module"}));let HMAC$1=class extends Hash$9{constructor(e,At){super(),this.finished=!1,this.destroyed=!1,hash$7(e);const kt=toBytes$3(At);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const Bt=this.blockLen,Nt=new Uint8Array(Bt);Nt.set(kt.length>Bt?e.create().update(kt).digest():kt);for(let jt=0;jt<Nt.length;jt++)Nt[jt]^=54;this.iHash.update(Nt),this.oHash=e.create();for(let jt=0;jt<Nt.length;jt++)Nt[jt]^=106;this.oHash.update(Nt),Nt.fill(0)}update(e){return exists$6(this),this.iHash.update(e),this}digestInto(e){exists$6(this),bytes$5(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:At,iHash:kt,finished:Bt,destroyed:Nt,blockLen:jt,outputLen:Lt}=this;return e=e,e.finished=Bt,e.destroyed=Nt,e.blockLen=jt,e.outputLen=Lt,e.oHash=At._cloneInto(e.oHash),e.iHash=kt._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$3=(xt,e,At)=>new HMAC$1(xt,e).update(At).digest();hmac$3.create=(xt,e)=>new HMAC$1(xt,e);const hmac$4=Object.freeze(Object.defineProperty({__proto__:null,HMAC:HMAC$1,hmac:hmac$3},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$e=BigInt(0),_1n$g=BigInt(1),_2n$9=BigInt(2);function isBytes$9(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}function abytes$1(xt){if(!isBytes$9(xt))throw new Error("Uint8Array expected")}const hexes$3=Array.from({length:256},(xt,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$3(xt){abytes$1(xt);let e="";for(let At=0;At<xt.length;At++)e+=hexes$3[xt[At]];return e}function numberToHexUnpadded$2(xt){const e=xt.toString(16);return e.length&1?`0${e}`:e}function hexToNumber$2(xt){if(typeof xt!="string")throw new Error("hex string expected, got "+typeof xt);return BigInt(xt===""?"0":`0x${xt}`)}const asciis$3={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16$3(xt){if(xt>=asciis$3._0&&xt<=asciis$3._9)return xt-asciis$3._0;if(xt>=asciis$3._A&&xt<=asciis$3._F)return xt-(asciis$3._A-10);if(xt>=asciis$3._a&&xt<=asciis$3._f)return xt-(asciis$3._a-10)}function hexToBytes$3(xt){if(typeof xt!="string")throw new Error("hex string expected, got "+typeof xt);const e=xt.length,At=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const kt=new Uint8Array(At);for(let Bt=0,Nt=0;Bt<At;Bt++,Nt+=2){const jt=asciiToBase16$3(xt.charCodeAt(Nt)),Lt=asciiToBase16$3(xt.charCodeAt(Nt+1));if(jt===void 0||Lt===void 0){const er=xt[Nt]+xt[Nt+1];throw new Error('hex string expected, got non-hex character "'+er+'" at index '+Nt)}kt[Bt]=jt*16+Lt}return kt}function bytesToNumberBE$2(xt){return hexToNumber$2(bytesToHex$3(xt))}function bytesToNumberLE$2(xt){return abytes$1(xt),hexToNumber$2(bytesToHex$3(Uint8Array.from(xt).reverse()))}function numberToBytesBE$2(xt,e){return hexToBytes$3(xt.toString(16).padStart(e*2,"0"))}function numberToBytesLE$2(xt,e){return numberToBytesBE$2(xt,e).reverse()}function numberToVarBytesBE$2(xt){return hexToBytes$3(numberToHexUnpadded$2(xt))}function ensureBytes$4(xt,e,At){let kt;if(typeof e=="string")try{kt=hexToBytes$3(e)}catch(Nt){throw new Error(`${xt} must be valid hex string, got "${e}". Cause: ${Nt}`)}else if(isBytes$9(e))kt=Uint8Array.from(e);else throw new Error(`${xt} must be hex string or Uint8Array`);const Bt=kt.length;if(typeof At=="number"&&Bt!==At)throw new Error(`${xt} expected ${At} bytes, got ${Bt}`);return kt}function concatBytes$3(...xt){let e=0;for(let kt=0;kt<xt.length;kt++){const Bt=xt[kt];abytes$1(Bt),e+=Bt.length}const At=new Uint8Array(e);for(let kt=0,Bt=0;kt<xt.length;kt++){const Nt=xt[kt];At.set(Nt,Bt),Bt+=Nt.length}return At}function equalBytes$3(xt,e){if(xt.length!==e.length)return!1;let At=0;for(let kt=0;kt<xt.length;kt++)At|=xt[kt]^e[kt];return At===0}function utf8ToBytes$6(xt){if(typeof xt!="string")throw new Error(`utf8ToBytes expected string, got ${typeof xt}`);return new Uint8Array(new TextEncoder().encode(xt))}function bitLen$2(xt){let e;for(e=0;xt>_0n$e;xt>>=_1n$g,e+=1);return e}function bitGet$2(xt,e){return xt>>BigInt(e)&_1n$g}function bitSet$2(xt,e,At){return xt|(At?_1n$g:_0n$e)<<BigInt(e)}const bitMask$2=xt=>(_2n$9<<BigInt(xt-1))-_1n$g,u8n$2=xt=>new Uint8Array(xt),u8fr$2=xt=>Uint8Array.from(xt);function createHmacDrbg$2(xt,e,At){if(typeof xt!="number"||xt<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof At!="function")throw new Error("hmacFn must be a function");let kt=u8n$2(xt),Bt=u8n$2(xt),Nt=0;const jt=()=>{kt.fill(1),Bt.fill(0),Nt=0},Lt=(...rr)=>At(Bt,kt,...rr),er=(rr=u8n$2())=>{Bt=Lt(u8fr$2([0]),rr),kt=Lt(),rr.length!==0&&(Bt=Lt(u8fr$2([1]),rr),kt=Lt())},tr=()=>{if(Nt++>=1e3)throw new Error("drbg: tried 1000 values");let rr=0;const nr=[];for(;rr<e;){kt=Lt();const ir=kt.slice();nr.push(ir),rr+=kt.length}return concatBytes$3(...nr)};return(rr,nr)=>{jt(),er(rr);let ir;for(;!(ir=nr(tr()));)er();return jt(),ir}}const validatorFns$2={bigint:xt=>typeof xt=="bigint",function:xt=>typeof xt=="function",boolean:xt=>typeof xt=="boolean",string:xt=>typeof xt=="string",stringOrUint8Array:xt=>typeof xt=="string"||isBytes$9(xt),isSafeInteger:xt=>Number.isSafeInteger(xt),array:xt=>Array.isArray(xt),field:(xt,e)=>e.Fp.isValid(xt),hash:xt=>typeof xt=="function"&&Number.isSafeInteger(xt.outputLen)};function validateObject$8(xt,e,At={}){const kt=(Bt,Nt,jt)=>{const Lt=validatorFns$2[Nt];if(typeof Lt!="function")throw new Error(`Invalid validator "${Nt}", expected function`);const er=xt[Bt];if(!(jt&&er===void 0)&&!Lt(er,xt))throw new Error(`Invalid param ${String(Bt)}=${er} (${typeof er}), expected ${Nt}`)};for(const[Bt,Nt]of Object.entries(e))kt(Bt,Nt,!1);for(const[Bt,Nt]of Object.entries(At))kt(Bt,Nt,!0);return xt}const ut$2=Object.freeze(Object.defineProperty({__proto__:null,abytes:abytes$1,bitGet:bitGet$2,bitLen:bitLen$2,bitMask:bitMask$2,bitSet:bitSet$2,bytesToHex:bytesToHex$3,bytesToNumberBE:bytesToNumberBE$2,bytesToNumberLE:bytesToNumberLE$2,concatBytes:concatBytes$3,createHmacDrbg:createHmacDrbg$2,ensureBytes:ensureBytes$4,equalBytes:equalBytes$3,hexToBytes:hexToBytes$3,hexToNumber:hexToNumber$2,isBytes:isBytes$9,numberToBytesBE:numberToBytesBE$2,numberToBytesLE:numberToBytesLE$2,numberToHexUnpadded:numberToHexUnpadded$2,numberToVarBytesBE:numberToVarBytesBE$2,utf8ToBytes:utf8ToBytes$6,validateObject:validateObject$8},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$d=BigInt(0),_1n$f=BigInt(1),_2n$8=BigInt(2),_3n$4=BigInt(3),_4n$2=BigInt(4),_5n$3=BigInt(5),_8n$4=BigInt(8);BigInt(9);BigInt(16);function mod$2(xt,e){const At=xt%e;return At>=_0n$d?At:e+At}function pow$2(xt,e,At){if(At<=_0n$d||e<_0n$d)throw new Error("Expected power/modulo > 0");if(At===_1n$f)return _0n$d;let kt=_1n$f;for(;e>_0n$d;)e&_1n$f&&(kt=kt*xt%At),xt=xt*xt%At,e>>=_1n$f;return kt}function invert$2(xt,e){if(xt===_0n$d||e<=_0n$d)throw new Error(`invert: expected positive integers, got n=${xt} mod=${e}`);let At=mod$2(xt,e),kt=e,Bt=_0n$d,Nt=_1n$f;for(;At!==_0n$d;){const Lt=kt/At,er=kt%At,tr=Bt-Nt*Lt;kt=At,At=er,Bt=Nt,Nt=tr}if(kt!==_1n$f)throw new Error("invert: does not exist");return mod$2(Bt,e)}function tonelliShanks$2(xt){const e=(xt-_1n$f)/_2n$8;let At,kt,Bt;for(At=xt-_1n$f,kt=0;At%_2n$8===_0n$d;At/=_2n$8,kt++);for(Bt=_2n$8;Bt<xt&&pow$2(Bt,e,xt)!==xt-_1n$f;Bt++);if(kt===1){const jt=(xt+_1n$f)/_4n$2;return function(er,tr){const zt=er.pow(tr,jt);if(!er.eql(er.sqr(zt),tr))throw new Error("Cannot find square root");return zt}}const Nt=(At+_1n$f)/_2n$8;return function(Lt,er){if(Lt.pow(er,e)===Lt.neg(Lt.ONE))throw new Error("Cannot find square root");let tr=kt,zt=Lt.pow(Lt.mul(Lt.ONE,Bt),At),rr=Lt.pow(er,Nt),nr=Lt.pow(er,At);for(;!Lt.eql(nr,Lt.ONE);){if(Lt.eql(nr,Lt.ZERO))return Lt.ZERO;let ir=1;for(let dr=Lt.sqr(nr);ir<tr&&!Lt.eql(dr,Lt.ONE);ir++)dr=Lt.sqr(dr);const ar=Lt.pow(zt,_1n$f<<BigInt(tr-ir-1));zt=Lt.sqr(ar),rr=Lt.mul(rr,ar),nr=Lt.mul(nr,zt),tr=ir}return rr}}function FpSqrt$2(xt){if(xt%_4n$2===_3n$4){const e=(xt+_1n$f)/_4n$2;return function(kt,Bt){const Nt=kt.pow(Bt,e);if(!kt.eql(kt.sqr(Nt),Bt))throw new Error("Cannot find square root");return Nt}}if(xt%_8n$4===_5n$3){const e=(xt-_5n$3)/_8n$4;return function(kt,Bt){const Nt=kt.mul(Bt,_2n$8),jt=kt.pow(Nt,e),Lt=kt.mul(Bt,jt),er=kt.mul(kt.mul(Lt,_2n$8),jt),tr=kt.mul(Lt,kt.sub(er,kt.ONE));if(!kt.eql(kt.sqr(tr),Bt))throw new Error("Cannot find square root");return tr}}return tonelliShanks$2(xt)}const FIELD_FIELDS$2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$2(xt){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},At=FIELD_FIELDS$2.reduce((kt,Bt)=>(kt[Bt]="function",kt),e);return validateObject$8(xt,At)}function FpPow$2(xt,e,At){if(At<_0n$d)throw new Error("Expected power > 0");if(At===_0n$d)return xt.ONE;if(At===_1n$f)return e;let kt=xt.ONE,Bt=e;for(;At>_0n$d;)At&_1n$f&&(kt=xt.mul(kt,Bt)),Bt=xt.sqr(Bt),At>>=_1n$f;return kt}function FpInvertBatch$2(xt,e){const At=new Array(e.length),kt=e.reduce((Nt,jt,Lt)=>xt.is0(jt)?Nt:(At[Lt]=Nt,xt.mul(Nt,jt)),xt.ONE),Bt=xt.inv(kt);return e.reduceRight((Nt,jt,Lt)=>xt.is0(jt)?Nt:(At[Lt]=xt.mul(Nt,At[Lt]),xt.mul(Nt,jt)),Bt),At}function nLength$2(xt,e){const At=e!==void 0?e:xt.toString(2).length,kt=Math.ceil(At/8);return{nBitLength:At,nByteLength:kt}}function Field$2(xt,e,At=!1,kt={}){if(xt<=_0n$d)throw new Error(`Expected Field ORDER > 0, got ${xt}`);const{nBitLength:Bt,nByteLength:Nt}=nLength$2(xt,e);if(Nt>2048)throw new Error("Field lengths over 2048 bytes are not supported");const jt=FpSqrt$2(xt),Lt=Object.freeze({ORDER:xt,BITS:Bt,BYTES:Nt,MASK:bitMask$2(Bt),ZERO:_0n$d,ONE:_1n$f,create:er=>mod$2(er,xt),isValid:er=>{if(typeof er!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof er}`);return _0n$d<=er&&er<xt},is0:er=>er===_0n$d,isOdd:er=>(er&_1n$f)===_1n$f,neg:er=>mod$2(-er,xt),eql:(er,tr)=>er===tr,sqr:er=>mod$2(er*er,xt),add:(er,tr)=>mod$2(er+tr,xt),sub:(er,tr)=>mod$2(er-tr,xt),mul:(er,tr)=>mod$2(er*tr,xt),pow:(er,tr)=>FpPow$2(Lt,er,tr),div:(er,tr)=>mod$2(er*invert$2(tr,xt),xt),sqrN:er=>er*er,addN:(er,tr)=>er+tr,subN:(er,tr)=>er-tr,mulN:(er,tr)=>er*tr,inv:er=>invert$2(er,xt),sqrt:kt.sqrt||(er=>jt(Lt,er)),invertBatch:er=>FpInvertBatch$2(Lt,er),cmov:(er,tr,zt)=>zt?tr:er,toBytes:er=>At?numberToBytesLE$2(er,Nt):numberToBytesBE$2(er,Nt),fromBytes:er=>{if(er.length!==Nt)throw new Error(`Fp.fromBytes: expected ${Nt}, got ${er.length}`);return At?bytesToNumberLE$2(er):bytesToNumberBE$2(er)}});return Object.freeze(Lt)}function getFieldBytesLength$2(xt){if(typeof xt!="bigint")throw new Error("field order must be bigint");const e=xt.toString(2).length;return Math.ceil(e/8)}function getMinHashLength$2(xt){const e=getFieldBytesLength$2(xt);return e+Math.ceil(e/2)}function mapHashToField$2(xt,e,At=!1){const kt=xt.length,Bt=getFieldBytesLength$2(e),Nt=getMinHashLength$2(e);if(kt<16||kt<Nt||kt>1024)throw new Error(`expected ${Nt}-1024 bytes of input, got ${kt}`);const jt=At?bytesToNumberBE$2(xt):bytesToNumberLE$2(xt),Lt=mod$2(jt,e-_1n$f)+_1n$f;return At?numberToBytesLE$2(Lt,Bt):numberToBytesBE$2(Lt,Bt)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$c=BigInt(0),_1n$e=BigInt(1);function wNAF$2(xt,e){const At=(Bt,Nt)=>{const jt=Nt.negate();return Bt?jt:Nt},kt=Bt=>{const Nt=Math.ceil(e/Bt)+1,jt=2**(Bt-1);return{windows:Nt,windowSize:jt}};return{constTimeNegate:At,unsafeLadder(Bt,Nt){let jt=xt.ZERO,Lt=Bt;for(;Nt>_0n$c;)Nt&_1n$e&&(jt=jt.add(Lt)),Lt=Lt.double(),Nt>>=_1n$e;return jt},precomputeWindow(Bt,Nt){const{windows:jt,windowSize:Lt}=kt(Nt),er=[];let tr=Bt,zt=tr;for(let rr=0;rr<jt;rr++){zt=tr,er.push(zt);for(let nr=1;nr<Lt;nr++)zt=zt.add(tr),er.push(zt);tr=zt.double()}return er},wNAF(Bt,Nt,jt){const{windows:Lt,windowSize:er}=kt(Bt);let tr=xt.ZERO,zt=xt.BASE;const rr=BigInt(2**Bt-1),nr=2**Bt,ir=BigInt(Bt);for(let ar=0;ar<Lt;ar++){const dr=ar*er;let ur=Number(jt&rr);jt>>=ir,ur>er&&(ur-=nr,jt+=_1n$e);const fr=dr,pr=dr+Math.abs(ur)-1,lr=ar%2!==0,yr=ur<0;ur===0?zt=zt.add(At(lr,Nt[fr])):tr=tr.add(At(yr,Nt[pr]))}return{p:tr,f:zt}},wNAFCached(Bt,Nt,jt,Lt){const er=Bt._WINDOW_SIZE||1;let tr=Nt.get(Bt);return tr||(tr=this.precomputeWindow(Bt,er),er!==1&&Nt.set(Bt,Lt(tr))),this.wNAF(er,tr,jt)}}}function validateBasic$2(xt){return validateField$2(xt.Fp),validateObject$8(xt,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$2(xt.n,xt.nBitLength),...xt,p:xt.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts$1(xt){const e=validateBasic$2(xt);validateObject$8(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:At,Fp:kt,a:Bt}=e;if(At){if(!kt.eql(Bt,kt.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof At!="object"||typeof At.beta!="bigint"||typeof At.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n$1,hexToBytes:h2b$1}=ut$2,DER$1={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(xt){const{Err:e}=DER$1;if(xt.length<2||xt[0]!==2)throw new e("Invalid signature integer tag");const At=xt[1],kt=xt.subarray(2,At+2);if(!At||kt.length!==At)throw new e("Invalid signature integer: wrong length");if(kt[0]&128)throw new e("Invalid signature integer: negative");if(kt[0]===0&&!(kt[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:b2n$1(kt),l:xt.subarray(At+2)}},toSig(xt){const{Err:e}=DER$1,At=typeof xt=="string"?h2b$1(xt):xt;abytes$1(At);let kt=At.length;if(kt<2||At[0]!=48)throw new e("Invalid signature tag");if(At[1]!==kt-2)throw new e("Invalid signature: incorrect length");const{d:Bt,l:Nt}=DER$1._parseInt(At.subarray(2)),{d:jt,l:Lt}=DER$1._parseInt(Nt);if(Lt.length)throw new e("Invalid signature: left bytes after parsing");return{r:Bt,s:jt}},hexFromSig(xt){const e=tr=>Number.parseInt(tr[0],16)&8?"00"+tr:tr,At=tr=>{const zt=tr.toString(16);return zt.length&1?`0${zt}`:zt},kt=e(At(xt.s)),Bt=e(At(xt.r)),Nt=kt.length/2,jt=Bt.length/2,Lt=At(Nt),er=At(jt);return`30${At(jt+Nt+4)}02${er}${Bt}02${Lt}${kt}`}},_0n$b=BigInt(0),_1n$d=BigInt(1);BigInt(2);const _3n$3=BigInt(3);BigInt(4);function weierstrassPoints$1(xt){const e=validatePointOpts$1(xt),{Fp:At}=e,kt=e.toBytes||((ar,dr,ur)=>{const fr=dr.toAffine();return concatBytes$3(Uint8Array.from([4]),At.toBytes(fr.x),At.toBytes(fr.y))}),Bt=e.fromBytes||(ar=>{const dr=ar.subarray(1),ur=At.fromBytes(dr.subarray(0,At.BYTES)),fr=At.fromBytes(dr.subarray(At.BYTES,2*At.BYTES));return{x:ur,y:fr}});function Nt(ar){const{a:dr,b:ur}=e,fr=At.sqr(ar),pr=At.mul(fr,ar);return At.add(At.add(pr,At.mul(ar,dr)),ur)}if(!At.eql(At.sqr(e.Gy),Nt(e.Gx)))throw new Error("bad generator point: equation left != right");function jt(ar){return typeof ar=="bigint"&&_0n$b<ar&&ar<e.n}function Lt(ar){if(!jt(ar))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function er(ar){const{allowedPrivateKeyLengths:dr,nByteLength:ur,wrapPrivateKey:fr,n:pr}=e;if(dr&&typeof ar!="bigint"){if(isBytes$9(ar)&&(ar=bytesToHex$3(ar)),typeof ar!="string"||!dr.includes(ar.length))throw new Error("Invalid key");ar=ar.padStart(ur*2,"0")}let lr;try{lr=typeof ar=="bigint"?ar:bytesToNumberBE$2(ensureBytes$4("private key",ar,ur))}catch{throw new Error(`private key must be ${ur} bytes, hex or bigint, not ${typeof ar}`)}return fr&&(lr=mod$2(lr,pr)),Lt(lr),lr}const tr=new Map;function zt(ar){if(!(ar instanceof rr))throw new Error("ProjectivePoint expected")}class rr{constructor(dr,ur,fr){if(this.px=dr,this.py=ur,this.pz=fr,dr==null||!At.isValid(dr))throw new Error("x required");if(ur==null||!At.isValid(ur))throw new Error("y required");if(fr==null||!At.isValid(fr))throw new Error("z required")}static fromAffine(dr){const{x:ur,y:fr}=dr||{};if(!dr||!At.isValid(ur)||!At.isValid(fr))throw new Error("invalid affine point");if(dr instanceof rr)throw new Error("projective point not allowed");const pr=lr=>At.eql(lr,At.ZERO);return pr(ur)&&pr(fr)?rr.ZERO:new rr(ur,fr,At.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(dr){const ur=At.invertBatch(dr.map(fr=>fr.pz));return dr.map((fr,pr)=>fr.toAffine(ur[pr])).map(rr.fromAffine)}static fromHex(dr){const ur=rr.fromAffine(Bt(ensureBytes$4("pointHex",dr)));return ur.assertValidity(),ur}static fromPrivateKey(dr){return rr.BASE.multiply(er(dr))}_setWindowSize(dr){this._WINDOW_SIZE=dr,tr.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!At.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:dr,y:ur}=this.toAffine();if(!At.isValid(dr)||!At.isValid(ur))throw new Error("bad point: x or y not FE");const fr=At.sqr(ur),pr=Nt(dr);if(!At.eql(fr,pr))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:dr}=this.toAffine();if(At.isOdd)return!At.isOdd(dr);throw new Error("Field doesn't support isOdd")}equals(dr){zt(dr);const{px:ur,py:fr,pz:pr}=this,{px:lr,py:yr,pz:br}=dr,Ar=At.eql(At.mul(ur,br),At.mul(lr,pr)),Pr=At.eql(At.mul(fr,br),At.mul(yr,pr));return Ar&&Pr}negate(){return new rr(this.px,At.neg(this.py),this.pz)}double(){const{a:dr,b:ur}=e,fr=At.mul(ur,_3n$3),{px:pr,py:lr,pz:yr}=this;let br=At.ZERO,Ar=At.ZERO,Pr=At.ZERO,kr=At.mul(pr,pr),Ur=At.mul(lr,lr),Hr=At.mul(yr,yr),Lr=At.mul(pr,lr);return Lr=At.add(Lr,Lr),Pr=At.mul(pr,yr),Pr=At.add(Pr,Pr),br=At.mul(dr,Pr),Ar=At.mul(fr,Hr),Ar=At.add(br,Ar),br=At.sub(Ur,Ar),Ar=At.add(Ur,Ar),Ar=At.mul(br,Ar),br=At.mul(Lr,br),Pr=At.mul(fr,Pr),Hr=At.mul(dr,Hr),Lr=At.sub(kr,Hr),Lr=At.mul(dr,Lr),Lr=At.add(Lr,Pr),Pr=At.add(kr,kr),kr=At.add(Pr,kr),kr=At.add(kr,Hr),kr=At.mul(kr,Lr),Ar=At.add(Ar,kr),Hr=At.mul(lr,yr),Hr=At.add(Hr,Hr),kr=At.mul(Hr,Lr),br=At.sub(br,kr),Pr=At.mul(Hr,Ur),Pr=At.add(Pr,Pr),Pr=At.add(Pr,Pr),new rr(br,Ar,Pr)}add(dr){zt(dr);const{px:ur,py:fr,pz:pr}=this,{px:lr,py:yr,pz:br}=dr;let Ar=At.ZERO,Pr=At.ZERO,kr=At.ZERO;const Ur=e.a,Hr=At.mul(e.b,_3n$3);let Lr=At.mul(ur,lr),Sr=At.mul(fr,yr),_r=At.mul(pr,br),gr=At.add(ur,fr),wr=At.add(lr,yr);gr=At.mul(gr,wr),wr=At.add(Lr,Sr),gr=At.sub(gr,wr),wr=At.add(ur,pr);let Dr=At.add(lr,br);return wr=At.mul(wr,Dr),Dr=At.add(Lr,_r),wr=At.sub(wr,Dr),Dr=At.add(fr,pr),Ar=At.add(yr,br),Dr=At.mul(Dr,Ar),Ar=At.add(Sr,_r),Dr=At.sub(Dr,Ar),kr=At.mul(Ur,wr),Ar=At.mul(Hr,_r),kr=At.add(Ar,kr),Ar=At.sub(Sr,kr),kr=At.add(Sr,kr),Pr=At.mul(Ar,kr),Sr=At.add(Lr,Lr),Sr=At.add(Sr,Lr),_r=At.mul(Ur,_r),wr=At.mul(Hr,wr),Sr=At.add(Sr,_r),_r=At.sub(Lr,_r),_r=At.mul(Ur,_r),wr=At.add(wr,_r),Lr=At.mul(Sr,wr),Pr=At.add(Pr,Lr),Lr=At.mul(Dr,wr),Ar=At.mul(gr,Ar),Ar=At.sub(Ar,Lr),Lr=At.mul(gr,Sr),kr=At.mul(Dr,kr),kr=At.add(kr,Lr),new rr(Ar,Pr,kr)}subtract(dr){return this.add(dr.negate())}is0(){return this.equals(rr.ZERO)}wNAF(dr){return ir.wNAFCached(this,tr,dr,ur=>{const fr=At.invertBatch(ur.map(pr=>pr.pz));return ur.map((pr,lr)=>pr.toAffine(fr[lr])).map(rr.fromAffine)})}multiplyUnsafe(dr){const ur=rr.ZERO;if(dr===_0n$b)return ur;if(Lt(dr),dr===_1n$d)return this;const{endo:fr}=e;if(!fr)return ir.unsafeLadder(this,dr);let{k1neg:pr,k1:lr,k2neg:yr,k2:br}=fr.splitScalar(dr),Ar=ur,Pr=ur,kr=this;for(;lr>_0n$b||br>_0n$b;)lr&_1n$d&&(Ar=Ar.add(kr)),br&_1n$d&&(Pr=Pr.add(kr)),kr=kr.double(),lr>>=_1n$d,br>>=_1n$d;return pr&&(Ar=Ar.negate()),yr&&(Pr=Pr.negate()),Pr=new rr(At.mul(Pr.px,fr.beta),Pr.py,Pr.pz),Ar.add(Pr)}multiply(dr){Lt(dr);let ur=dr,fr,pr;const{endo:lr}=e;if(lr){const{k1neg:yr,k1:br,k2neg:Ar,k2:Pr}=lr.splitScalar(ur);let{p:kr,f:Ur}=this.wNAF(br),{p:Hr,f:Lr}=this.wNAF(Pr);kr=ir.constTimeNegate(yr,kr),Hr=ir.constTimeNegate(Ar,Hr),Hr=new rr(At.mul(Hr.px,lr.beta),Hr.py,Hr.pz),fr=kr.add(Hr),pr=Ur.add(Lr)}else{const{p:yr,f:br}=this.wNAF(ur);fr=yr,pr=br}return rr.normalizeZ([fr,pr])[0]}multiplyAndAddUnsafe(dr,ur,fr){const pr=rr.BASE,lr=(br,Ar)=>Ar===_0n$b||Ar===_1n$d||!br.equals(pr)?br.multiplyUnsafe(Ar):br.multiply(Ar),yr=lr(this,ur).add(lr(dr,fr));return yr.is0()?void 0:yr}toAffine(dr){const{px:ur,py:fr,pz:pr}=this,lr=this.is0();dr==null&&(dr=lr?At.ONE:At.inv(pr));const yr=At.mul(ur,dr),br=At.mul(fr,dr),Ar=At.mul(pr,dr);if(lr)return{x:At.ZERO,y:At.ZERO};if(!At.eql(Ar,At.ONE))throw new Error("invZ was invalid");return{x:yr,y:br}}isTorsionFree(){const{h:dr,isTorsionFree:ur}=e;if(dr===_1n$d)return!0;if(ur)return ur(rr,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:dr,clearCofactor:ur}=e;return dr===_1n$d?this:ur?ur(rr,this):this.multiplyUnsafe(e.h)}toRawBytes(dr=!0){return this.assertValidity(),kt(rr,this,dr)}toHex(dr=!0){return bytesToHex$3(this.toRawBytes(dr))}}rr.BASE=new rr(e.Gx,e.Gy,At.ONE),rr.ZERO=new rr(At.ZERO,At.ONE,At.ZERO);const nr=e.nBitLength,ir=wNAF$2(rr,e.endo?Math.ceil(nr/2):nr);return{CURVE:e,ProjectivePoint:rr,normPrivateKeyToScalar:er,weierstrassEquation:Nt,isWithinCurveOrder:jt}}function validateOpts$5(xt){const e=validateBasic$2(xt);return validateObject$8(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass$2(xt){const e=validateOpts$5(xt),{Fp:At,n:kt}=e,Bt=At.BYTES+1,Nt=2*At.BYTES+1;function jt(wr){return _0n$b<wr&&wr<At.ORDER}function Lt(wr){return mod$2(wr,kt)}function er(wr){return invert$2(wr,kt)}const{ProjectivePoint:tr,normPrivateKeyToScalar:zt,weierstrassEquation:rr,isWithinCurveOrder:nr}=weierstrassPoints$1({...e,toBytes(wr,Dr,xr){const Ir=Dr.toAffine(),$r=At.toBytes(Ir.x),vr=concatBytes$3;return xr?vr(Uint8Array.from([Dr.hasEvenY()?2:3]),$r):vr(Uint8Array.from([4]),$r,At.toBytes(Ir.y))},fromBytes(wr){const Dr=wr.length,xr=wr[0],Ir=wr.subarray(1);if(Dr===Bt&&(xr===2||xr===3)){const $r=bytesToNumberBE$2(Ir);if(!jt($r))throw new Error("Point is not on curve");const vr=rr($r);let Er;try{Er=At.sqrt(vr)}catch(Mr){const Gr=Mr instanceof Error?": "+Mr.message:"";throw new Error("Point is not on curve"+Gr)}const Tr=(Er&_1n$d)===_1n$d;return(xr&1)===1!==Tr&&(Er=At.neg(Er)),{x:$r,y:Er}}else if(Dr===Nt&&xr===4){const $r=At.fromBytes(Ir.subarray(0,At.BYTES)),vr=At.fromBytes(Ir.subarray(At.BYTES,2*At.BYTES));return{x:$r,y:vr}}else throw new Error(`Point of length ${Dr} was invalid. Expected ${Bt} compressed bytes or ${Nt} uncompressed bytes`)}}),ir=wr=>bytesToHex$3(numberToBytesBE$2(wr,e.nByteLength));function ar(wr){const Dr=kt>>_1n$d;return wr>Dr}function dr(wr){return ar(wr)?Lt(-wr):wr}const ur=(wr,Dr,xr)=>bytesToNumberBE$2(wr.slice(Dr,xr));class fr{constructor(Dr,xr,Ir){this.r=Dr,this.s=xr,this.recovery=Ir,this.assertValidity()}static fromCompact(Dr){const xr=e.nByteLength;return Dr=ensureBytes$4("compactSignature",Dr,xr*2),new fr(ur(Dr,0,xr),ur(Dr,xr,2*xr))}static fromDER(Dr){const{r:xr,s:Ir}=DER$1.toSig(ensureBytes$4("DER",Dr));return new fr(xr,Ir)}assertValidity(){if(!nr(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!nr(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Dr){return new fr(this.r,this.s,Dr)}recoverPublicKey(Dr){const{r:xr,s:Ir,recovery:$r}=this,vr=Pr(ensureBytes$4("msgHash",Dr));if($r==null||![0,1,2,3].includes($r))throw new Error("recovery id invalid");const Er=$r===2||$r===3?xr+e.n:xr;if(Er>=At.ORDER)throw new Error("recovery id 2 or 3 invalid");const Tr=$r&1?"03":"02",Rr=tr.fromHex(Tr+ir(Er)),Mr=er(Er),Gr=Lt(-vr*Mr),Br=Lt(Ir*Mr),Cr=tr.BASE.multiplyAndAddUnsafe(Rr,Gr,Br);if(!Cr)throw new Error("point at infinify");return Cr.assertValidity(),Cr}hasHighS(){return ar(this.s)}normalizeS(){return this.hasHighS()?new fr(this.r,Lt(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$3(this.toDERHex())}toDERHex(){return DER$1.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$3(this.toCompactHex())}toCompactHex(){return ir(this.r)+ir(this.s)}}const pr={isValidPrivateKey(wr){try{return zt(wr),!0}catch{return!1}},normPrivateKeyToScalar:zt,randomPrivateKey:()=>{const wr=getMinHashLength$2(e.n);return mapHashToField$2(e.randomBytes(wr),e.n)},precompute(wr=8,Dr=tr.BASE){return Dr._setWindowSize(wr),Dr.multiply(BigInt(3)),Dr}};function lr(wr,Dr=!0){return tr.fromPrivateKey(wr).toRawBytes(Dr)}function yr(wr){const Dr=isBytes$9(wr),xr=typeof wr=="string",Ir=(Dr||xr)&&wr.length;return Dr?Ir===Bt||Ir===Nt:xr?Ir===2*Bt||Ir===2*Nt:wr instanceof tr}function br(wr,Dr,xr=!0){if(yr(wr))throw new Error("first arg must be private key");if(!yr(Dr))throw new Error("second arg must be public key");return tr.fromHex(Dr).multiply(zt(wr)).toRawBytes(xr)}const Ar=e.bits2int||function(wr){const Dr=bytesToNumberBE$2(wr),xr=wr.length*8-e.nBitLength;return xr>0?Dr>>BigInt(xr):Dr},Pr=e.bits2int_modN||function(wr){return Lt(Ar(wr))},kr=bitMask$2(e.nBitLength);function Ur(wr){if(typeof wr!="bigint")throw new Error("bigint expected");if(!(_0n$b<=wr&&wr<kr))throw new Error(`bigint expected < 2^${e.nBitLength}`);return numberToBytesBE$2(wr,e.nByteLength)}function Hr(wr,Dr,xr=Lr){if(["recovered","canonical"].some(Yr=>Yr in xr))throw new Error("sign() legacy options not supported");const{hash:Ir,randomBytes:$r}=e;let{lowS:vr,prehash:Er,extraEntropy:Tr}=xr;vr==null&&(vr=!0),wr=ensureBytes$4("msgHash",wr),Er&&(wr=ensureBytes$4("prehashed msgHash",Ir(wr)));const Rr=Pr(wr),Mr=zt(Dr),Gr=[Ur(Mr),Ur(Rr)];if(Tr!=null&&Tr!==!1){const Yr=Tr===!0?$r(At.BYTES):Tr;Gr.push(ensureBytes$4("extraEntropy",Yr))}const Br=concatBytes$3(...Gr),Cr=Rr;function jr(Yr){const Qr=Ar(Yr);if(!nr(Qr))return;const Jr=er(Qr),Wr=tr.BASE.multiply(Qr).toAffine(),Nr=Lt(Wr.x);if(Nr===_0n$b)return;const Vr=Lt(Jr*Lt(Cr+Nr*Mr));if(Vr===_0n$b)return;let Xr=(Wr.x===Nr?0:2)|Number(Wr.y&_1n$d),qr=Vr;return vr&&ar(Vr)&&(qr=dr(Vr),Xr^=1),new fr(Nr,qr,Xr)}return{seed:Br,k2sig:jr}}const Lr={lowS:e.lowS,prehash:!1},Sr={lowS:e.lowS,prehash:!1};function _r(wr,Dr,xr=Lr){const{seed:Ir,k2sig:$r}=Hr(wr,Dr,xr),vr=e;return createHmacDrbg$2(vr.hash.outputLen,vr.nByteLength,vr.hmac)(Ir,$r)}tr.BASE._setWindowSize(8);function gr(wr,Dr,xr,Ir=Sr){var Wr;const $r=wr;if(Dr=ensureBytes$4("msgHash",Dr),xr=ensureBytes$4("publicKey",xr),"strict"in Ir)throw new Error("options.strict was renamed to lowS");const{lowS:vr,prehash:Er}=Ir;let Tr,Rr;try{if(typeof $r=="string"||isBytes$9($r))try{Tr=fr.fromDER($r)}catch(Nr){if(!(Nr instanceof DER$1.Err))throw Nr;Tr=fr.fromCompact($r)}else if(typeof $r=="object"&&typeof $r.r=="bigint"&&typeof $r.s=="bigint"){const{r:Nr,s:Vr}=$r;Tr=new fr(Nr,Vr)}else throw new Error("PARSE");Rr=tr.fromHex(xr)}catch(Nr){if(Nr.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(vr&&Tr.hasHighS())return!1;Er&&(Dr=e.hash(Dr));const{r:Mr,s:Gr}=Tr,Br=Pr(Dr),Cr=er(Gr),jr=Lt(Br*Cr),Yr=Lt(Mr*Cr),Qr=(Wr=tr.BASE.multiplyAndAddUnsafe(Rr,jr,Yr))==null?void 0:Wr.toAffine();return Qr?Lt(Qr.x)===Mr:!1}return{CURVE:e,getPublicKey:lr,getSharedSecret:br,sign:_r,verify:gr,ProjectivePoint:tr,Signature:fr,utils:pr}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash$2(xt){return{hash:xt,hmac:(e,...At)=>hmac$3(xt,e,concatBytes$4(...At)),randomBytes:randomBytes$7}}function createCurve$2(xt,e){const At=kt=>weierstrass$2({...xt,...getHash$2(kt)});return Object.freeze({...At(e),create:At})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fp$3=Field$2(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),CURVE_A$1=Fp$3.create(BigInt("-3")),CURVE_B$1=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),p256$1=createCurve$2({a:CURVE_A$1,b:CURVE_B$1,Fp:Fp$3,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},sha256$5),secp256r1$1=p256$1;function equals$4(xt,e){if(xt===e)return!0;if(xt.byteLength!==e.byteLength)return!1;for(let At=0;At<xt.byteLength;At++)if(xt[At]!==e[At])return!1;return!0}function alloc$3(xt=0){return new Uint8Array(xt)}function allocUnsafe$1(xt=0){return new Uint8Array(xt)}function asUint8Array$1(xt){return xt}function concat$2(xt,e){e==null&&(e=xt.reduce((Bt,Nt)=>Bt+Nt.length,0));const At=allocUnsafe$1(e);let kt=0;for(const Bt of xt)At.set(Bt,kt),kt+=Bt.length;return At}const empty=new Uint8Array(0);function fromHex(xt){const e=xt.match(/../g);return e!=null?new Uint8Array(e.map(At=>parseInt(At,16))):empty}function equals$3(xt,e){if(xt===e)return!0;if(xt.byteLength!==e.byteLength)return!1;for(let At=0;At<xt.byteLength;At++)if(xt[At]!==e[At])return!1;return!0}function coerce$2(xt){if(xt instanceof Uint8Array&&xt.constructor.name==="Uint8Array")return xt;if(xt instanceof ArrayBuffer)return new Uint8Array(xt);if(ArrayBuffer.isView(xt))return new Uint8Array(xt.buffer,xt.byteOffset,xt.byteLength);throw new Error("Unknown type, must be binary type")}function fromString$4(xt){return new TextEncoder().encode(xt)}function toString$9(xt){return new TextDecoder().decode(xt)}function base$4(xt,e){if(xt.length>=255)throw new TypeError("Alphabet too long");for(var At=new Uint8Array(256),kt=0;kt<At.length;kt++)At[kt]=255;for(var Bt=0;Bt<xt.length;Bt++){var Nt=xt.charAt(Bt),jt=Nt.charCodeAt(0);if(At[jt]!==255)throw new TypeError(Nt+" is ambiguous");At[jt]=Bt}var Lt=xt.length,er=xt.charAt(0),tr=Math.log(Lt)/Math.log(256),zt=Math.log(256)/Math.log(Lt);function rr(ar){if(ar instanceof Uint8Array||(ArrayBuffer.isView(ar)?ar=new Uint8Array(ar.buffer,ar.byteOffset,ar.byteLength):Array.isArray(ar)&&(ar=Uint8Array.from(ar))),!(ar instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(ar.length===0)return"";for(var dr=0,ur=0,fr=0,pr=ar.length;fr!==pr&&ar[fr]===0;)fr++,dr++;for(var lr=(pr-fr)*zt+1>>>0,yr=new Uint8Array(lr);fr!==pr;){for(var br=ar[fr],Ar=0,Pr=lr-1;(br!==0||Ar<ur)&&Pr!==-1;Pr--,Ar++)br+=256*yr[Pr]>>>0,yr[Pr]=br%Lt>>>0,br=br/Lt>>>0;if(br!==0)throw new Error("Non-zero carry");ur=Ar,fr++}for(var kr=lr-ur;kr!==lr&&yr[kr]===0;)kr++;for(var Ur=er.repeat(dr);kr<lr;++kr)Ur+=xt.charAt(yr[kr]);return Ur}function nr(ar){if(typeof ar!="string")throw new TypeError("Expected String");if(ar.length===0)return new Uint8Array;var dr=0;if(ar[dr]!==" "){for(var ur=0,fr=0;ar[dr]===er;)ur++,dr++;for(var pr=(ar.length-dr)*tr+1>>>0,lr=new Uint8Array(pr);ar[dr];){var yr=At[ar.charCodeAt(dr)];if(yr===255)return;for(var br=0,Ar=pr-1;(yr!==0||br<fr)&&Ar!==-1;Ar--,br++)yr+=Lt*lr[Ar]>>>0,lr[Ar]=yr%256>>>0,yr=yr/256>>>0;if(yr!==0)throw new Error("Non-zero carry");fr=br,dr++}if(ar[dr]!==" "){for(var Pr=pr-fr;Pr!==pr&&lr[Pr]===0;)Pr++;for(var kr=new Uint8Array(ur+(pr-Pr)),Ur=ur;Pr!==pr;)kr[Ur++]=lr[Pr++];return kr}}}function ir(ar){var dr=nr(ar);if(dr)return dr;throw new Error(`Non-${e} character`)}return{encode:rr,decodeUnsafe:nr,decode:ir}}var src$2=base$4,_brrp__multiformats_scope_baseX$2=src$2;let Encoder$3=class{constructor(e,At,kt){wn(this,"name");wn(this,"prefix");wn(this,"baseEncode");this.name=e,this.prefix=At,this.baseEncode=kt}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$2=class{constructor(e,At,kt){wn(this,"name");wn(this,"prefix");wn(this,"baseDecode");wn(this,"prefixCodePoint");if(this.name=e,this.prefix=At,At.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=At.codePointAt(0),this.baseDecode=kt}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$2(this,e)}},ComposedDecoder$2=class{constructor(e){wn(this,"decoders");this.decoders=e}or(e){return or$2(this,e)}decode(e){const At=e[0],kt=this.decoders[At];if(kt!=null)return kt.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function or$2(xt,e){return new ComposedDecoder$2({...xt.decoders??{[xt.prefix]:xt},...e.decoders??{[e.prefix]:e}})}let Codec$2=class{constructor(e,At,kt,Bt){wn(this,"name");wn(this,"prefix");wn(this,"baseEncode");wn(this,"baseDecode");wn(this,"encoder");wn(this,"decoder");this.name=e,this.prefix=At,this.baseEncode=kt,this.baseDecode=Bt,this.encoder=new Encoder$3(e,At,kt),this.decoder=new Decoder$2(e,At,Bt)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};function from$8({name:xt,prefix:e,encode:At,decode:kt}){return new Codec$2(xt,e,At,kt)}function baseX$2({name:xt,prefix:e,alphabet:At}){const{encode:kt,decode:Bt}=_brrp__multiformats_scope_baseX$2(At,xt);return from$8({prefix:e,name:xt,encode:kt,decode:Nt=>coerce$2(Bt(Nt))})}function decode$l(xt,e,At,kt){const Bt={};for(let zt=0;zt<e.length;++zt)Bt[e[zt]]=zt;let Nt=xt.length;for(;xt[Nt-1]==="=";)--Nt;const jt=new Uint8Array(Nt*At/8|0);let Lt=0,er=0,tr=0;for(let zt=0;zt<Nt;++zt){const rr=Bt[xt[zt]];if(rr===void 0)throw new SyntaxError(`Non-${kt} character`);er=er<<At|rr,Lt+=At,Lt>=8&&(Lt-=8,jt[tr++]=255&er>>Lt)}if(Lt>=At||255&er<<8-Lt)throw new SyntaxError("Unexpected end of data");return jt}function encode$h(xt,e,At){const kt=e[e.length-1]==="=",Bt=(1<<At)-1;let Nt="",jt=0,Lt=0;for(let er=0;er<xt.length;++er)for(Lt=Lt<<8|xt[er],jt+=8;jt>At;)jt-=At,Nt+=e[Bt&Lt>>jt];if(jt!==0&&(Nt+=e[Bt&Lt<<At-jt]),kt)for(;Nt.length*At&7;)Nt+="=";return Nt}function rfc4648$2({name:xt,prefix:e,bitsPerChar:At,alphabet:kt}){return from$8({prefix:e,name:xt,encode(Bt){return encode$h(Bt,kt,At)},decode(Bt){return decode$l(Bt,kt,At,xt)}})}const base10$2=baseX$2({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$3=Object.freeze(Object.defineProperty({__proto__:null,base10:base10$2},Symbol.toStringTag,{value:"Module"})),base16$2=rfc4648$2({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper$1=rfc4648$2({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$3=Object.freeze(Object.defineProperty({__proto__:null,base16:base16$2,base16upper:base16upper$1},Symbol.toStringTag,{value:"Module"})),base2$2=rfc4648$2({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$3=Object.freeze(Object.defineProperty({__proto__:null,base2:base2$2},Symbol.toStringTag,{value:"Module"})),alphabet$3=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars$1=alphabet$3.reduce((xt,e,At)=>(xt[At]=e,xt),[]),alphabetCharsToBytes$1=alphabet$3.reduce((xt,e,At)=>(xt[e.codePointAt(0)]=At,xt),[]);function encode$g(xt){return xt.reduce((e,At)=>(e+=alphabetBytesToChars$1[At],e),"")}function decode$k(xt){const e=[];for(const At of xt){const kt=alphabetCharsToBytes$1[At.codePointAt(0)];if(kt===void 0)throw new Error(`Non-base256emoji character: ${At}`);e.push(kt)}return new Uint8Array(e)}const base256emoji$2=from$8({prefix:"🚀",name:"base256emoji",encode:encode$g,decode:decode$k}),base256emoji$3=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:base256emoji$2},Symbol.toStringTag,{value:"Module"})),base32$3=rfc4648$2({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper$1=rfc4648$2({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad$1=rfc4648$2({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper$1=rfc4648$2({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex$1=rfc4648$2({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper$1=rfc4648$2({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad$1=rfc4648$2({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper$1=rfc4648$2({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$3=rfc4648$2({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$4=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$3,base32hex:base32hex$1,base32hexpad:base32hexpad$1,base32hexpadupper:base32hexpadupper$1,base32hexupper:base32hexupper$1,base32pad:base32pad$1,base32padupper:base32padupper$1,base32upper:base32upper$1,base32z:base32z$3},Symbol.toStringTag,{value:"Module"})),base36$2=baseX$2({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper$1=baseX$2({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$3=Object.freeze(Object.defineProperty({__proto__:null,base36:base36$2,base36upper:base36upper$1},Symbol.toStringTag,{value:"Module"})),base58btc$3=baseX$2({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr$1=baseX$2({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58$1=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$3,base58flickr:base58flickr$1},Symbol.toStringTag,{value:"Module"})),base64$2=rfc4648$2({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad$1=rfc4648$2({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$2=rfc4648$2({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad$1=rfc4648$2({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$3=Object.freeze(Object.defineProperty({__proto__:null,base64:base64$2,base64pad:base64pad$1,base64url:base64url$2,base64urlpad:base64urlpad$1},Symbol.toStringTag,{value:"Module"})),base8$2=rfc4648$2({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$3=Object.freeze(Object.defineProperty({__proto__:null,base8:base8$2},Symbol.toStringTag,{value:"Module"})),identity$3=from$8({prefix:"\0",name:"identity",encode:xt=>toString$9(xt),decode:xt=>fromString$4(xt)}),identityBase$1=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$3},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;var encode_1$2=encode$f,MSB$4=128,REST$4=127,MSBALL$2=~REST$4,INT$2=Math.pow(2,31);function encode$f(xt,e,At){e=e||[],At=At||0;for(var kt=At;xt>=INT$2;)e[At++]=xt&255|MSB$4,xt/=128;for(;xt&MSBALL$2;)e[At++]=xt&255|MSB$4,xt>>>=7;return e[At]=xt|0,encode$f.bytes=At-kt+1,e}var decode$j=read$3,MSB$1$2=128,REST$1$2=127;function read$3(xt,kt){var At=0,kt=kt||0,Bt=0,Nt=kt,jt,Lt=xt.length;do{if(Nt>=Lt)throw read$3.bytes=0,new RangeError("Could not decode varint");jt=xt[Nt++],At+=Bt<28?(jt&REST$1$2)<<Bt:(jt&REST$1$2)*Math.pow(2,Bt),Bt+=7}while(jt>=MSB$1$2);return read$3.bytes=Nt-kt,At}var N1$3=Math.pow(2,7),N2$3=Math.pow(2,14),N3$3=Math.pow(2,21),N4$3=Math.pow(2,28),N5$3=Math.pow(2,35),N6$3=Math.pow(2,42),N7$3=Math.pow(2,49),N8$2=Math.pow(2,56),N9$2=Math.pow(2,63),length$3=function(xt){return xt<N1$3?1:xt<N2$3?2:xt<N3$3?3:xt<N4$3?4:xt<N5$3?5:xt<N6$3?6:xt<N7$3?7:xt<N8$2?8:xt<N9$2?9:10},varint$2={encode:encode_1$2,decode:decode$j,encodingLength:length$3},_brrp_varint$2=varint$2;function decode$i(xt,e=0){return[_brrp_varint$2.decode(xt,e),_brrp_varint$2.decode.bytes]}function encodeTo$2(xt,e,At=0){return _brrp_varint$2.encode(xt,e,At),e}function encodingLength$7(xt){return _brrp_varint$2.encodingLength(xt)}function create$1(xt,e){const At=e.byteLength,kt=encodingLength$7(xt),Bt=kt+encodingLength$7(At),Nt=new Uint8Array(Bt+At);return encodeTo$2(xt,Nt,0),encodeTo$2(At,Nt,kt),Nt.set(e,Bt),new Digest$1(xt,At,e,Nt)}function decode$h(xt){const e=coerce$2(xt),[At,kt]=decode$i(e),[Bt,Nt]=decode$i(e.subarray(kt)),jt=e.subarray(kt+Nt);if(jt.byteLength!==Bt)throw new Error("Incorrect length");return new Digest$1(At,Bt,jt,e)}function equals$2(xt,e){if(xt===e)return!0;{const At=e;return xt.code===At.code&&xt.size===At.size&&At.bytes instanceof Uint8Array&&equals$3(xt.bytes,At.bytes)}}let Digest$1=class{constructor(e,At,kt,Bt){wn(this,"code");wn(this,"size");wn(this,"digest");wn(this,"bytes");this.code=e,this.size=At,this.digest=kt,this.bytes=Bt}};function from$7({name:xt,code:e,encode:At}){return new Hasher$1(xt,e,At)}let Hasher$1=class{constructor(e,At,kt){wn(this,"name");wn(this,"code");wn(this,"encode");this.name=e,this.code=At,this.encode=kt}digest(e){if(e instanceof Uint8Array){const At=this.encode(e);return At instanceof Uint8Array?create$1(this.code,At):At.then(kt=>create$1(this.code,kt))}else throw Error("Unknown type, must be binary type")}};function format$8(xt,e){const{bytes:At,version:kt}=xt;switch(kt){case 0:return toStringV0$2(At,baseCache$2(xt),e??base58btc$3.encoder);default:return toStringV1$2(At,baseCache$2(xt),e??base32$3.encoder)}}const cache$3=new WeakMap;function baseCache$2(xt){const e=cache$3.get(xt);if(e==null){const At=new Map;return cache$3.set(xt,At),At}return e}var xa;let CID$2=class $o{constructor(e,At,kt,Bt){wn(this,"code");wn(this,"version");wn(this,"multihash");wn(this,"bytes");wn(this,"/");wn(this,xa,"CID");this.code=At,this.version=e,this.multihash=kt,this.bytes=Bt,this["/"]=Bt}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:At}=this;if(e!==DAG_PB_CODE$2)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(At.code!==SHA_256_CODE$2)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return $o.createV0(At)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:At}=this.multihash,kt=create$1(e,At);return $o.createV1(this.code,kt)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return $o.equals(this,e)}static equals(e,At){const kt=At;return kt!=null&&e.code===kt.code&&e.version===kt.version&&equals$2(e.multihash,kt.multihash)}toString(e){return format$8(this,e)}toJSON(){return{"/":format$8(this)}}link(){return this}[(xa=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const At=e;if(At instanceof $o)return At;if(At["/"]!=null&&At["/"]===At.bytes||At.asCID===At){const{version:kt,code:Bt,multihash:Nt,bytes:jt}=At;return new $o(kt,Bt,Nt,jt??encodeCID$2(kt,Bt,Nt.bytes))}else if(At[cidSymbol$2]===!0){const{version:kt,multihash:Bt,code:Nt}=At,jt=decode$h(Bt);return $o.create(kt,Nt,jt)}else return null}static create(e,At,kt){if(typeof At!="number")throw new Error("String codecs are no longer supported");if(!(kt.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(At!==DAG_PB_CODE$2)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE$2}) block encoding`);return new $o(e,At,kt,kt.bytes)}case 1:{const Bt=encodeCID$2(e,At,kt.bytes);return new $o(e,At,kt,Bt)}default:throw new Error("Invalid version")}}static createV0(e){return $o.create(0,DAG_PB_CODE$2,e)}static createV1(e,At){return $o.create(1,e,At)}static decode(e){const[At,kt]=$o.decodeFirst(e);if(kt.length!==0)throw new Error("Incorrect length");return At}static decodeFirst(e){const At=$o.inspectBytes(e),kt=At.size-At.multihashSize,Bt=coerce$2(e.subarray(kt,kt+At.multihashSize));if(Bt.byteLength!==At.multihashSize)throw new Error("Incorrect length");const Nt=Bt.subarray(At.multihashSize-At.digestSize),jt=new Digest$1(At.multihashCode,At.digestSize,Nt,Bt);return[At.version===0?$o.createV0(jt):$o.createV1(At.codec,jt),e.subarray(At.size)]}static inspectBytes(e){let At=0;const kt=()=>{const[rr,nr]=decode$i(e.subarray(At));return At+=nr,rr};let Bt=kt(),Nt=DAG_PB_CODE$2;if(Bt===18?(Bt=0,At=0):Nt=kt(),Bt!==0&&Bt!==1)throw new RangeError(`Invalid CID version ${Bt}`);const jt=At,Lt=kt(),er=kt(),tr=At+er,zt=tr-jt;return{version:Bt,codec:Nt,multihashCode:Lt,digestSize:er,multihashSize:zt,size:tr}}static parse(e,At){const[kt,Bt]=parseCIDtoBytes$2(e,At),Nt=$o.decode(Bt);if(Nt.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache$2(Nt).set(kt,e),Nt}};function parseCIDtoBytes$2(xt,e){switch(xt[0]){case"Q":{const At=e??base58btc$3;return[base58btc$3.prefix,At.decode(`${base58btc$3.prefix}${xt}`)]}case base58btc$3.prefix:{const At=e??base58btc$3;return[base58btc$3.prefix,At.decode(xt)]}case base32$3.prefix:{const At=e??base32$3;return[base32$3.prefix,At.decode(xt)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[xt[0],e.decode(xt)]}}}function toStringV0$2(xt,e,At){const{prefix:kt}=At;if(kt!==base58btc$3.prefix)throw Error(`Cannot string encode V0 in ${At.name} encoding`);const Bt=e.get(kt);if(Bt==null){const Nt=At.encode(xt).slice(1);return e.set(kt,Nt),Nt}else return Bt}function toStringV1$2(xt,e,At){const{prefix:kt}=At,Bt=e.get(kt);if(Bt==null){const Nt=At.encode(xt);return e.set(kt,Nt),Nt}else return Bt}const DAG_PB_CODE$2=112,SHA_256_CODE$2=18;function encodeCID$2(xt,e,At){const kt=encodingLength$7(xt),Bt=kt+encodingLength$7(e),Nt=new Uint8Array(Bt+At.byteLength);return encodeTo$2(xt,Nt,0),encodeTo$2(e,Nt,kt),Nt.set(At,Bt),Nt}const cidSymbol$2=Symbol.for("@ipld/js-cid/CID"),bases$1={...identityBase$1,...base2$3,...base8$3,...base10$3,...base16$3,...base32$4,...base36$3,...base58$1,...base64$3,...base256emoji$3};function createCodec$2(xt,e,At,kt){return{name:xt,prefix:e,encoder:{name:xt,prefix:e,encode:At},decoder:{decode:kt}}}const string$2=createCodec$2("utf8","u",xt=>"u"+new TextDecoder("utf8").decode(xt),xt=>new TextEncoder().encode(xt.substring(1))),ascii$1=createCodec$2("ascii","a",xt=>{let e="a";for(let At=0;At<xt.length;At++)e+=String.fromCharCode(xt[At]);return e},xt=>{xt=xt.substring(1);const e=allocUnsafe$1(xt.length);for(let At=0;At<xt.length;At++)e[At]=xt.charCodeAt(At);return e}),BASES$1={utf8:string$2,"utf-8":string$2,hex:bases$1.base16,latin1:ascii$1,ascii:ascii$1,binary:ascii$1,...bases$1};function fromString$3(xt,e="utf8"){const At=BASES$1[e];if(At==null)throw new Error(`Unsupported encoding "${e}"`);return At.decoder.decode(`${At.prefix}${xt}`)}function toString$8(xt,e="utf8"){const At=BASES$1[e];if(At==null)throw new Error(`Unsupported encoding "${e}"`);return At.encoder.encode(xt).substring(1)}var __awaiter$3j=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const u8a={toString:toString$8,fromString:fromString$3};let Secp256r1$3=class as{static validateKey(e){if(e.kty!=="EC"||e.crv!=="P-256")throw new DwnError(DwnErrorCode.Secp256r1KeyNotValid,"Invalid SECP256R1 JWK: `kty` MUST be `EC`. `crv` MUST be `P-256`")}static publicKeyToJwk(e){return __awaiter$3j(this,void 0,void 0,function*(){let At;e.byteLength===33?At=p256$1.ProjectivePoint.fromHex(e).toRawBytes(!1):At=e;const kt=Encoder$4.bytesToBase64Url(At.subarray(1,33)),Bt=Encoder$4.bytesToBase64Url(At.subarray(33,65));return{alg:"ES256",kty:"EC",crv:"P-256",x:kt,y:Bt}})}static privateJwkToBytes(e){return Encoder$4.base64UrlToBytes(e.d)}static sign(e,At){return __awaiter$3j(this,void 0,void 0,function*(){as.validateKey(At);const kt=yield sha256$7.encode(e),Bt=as.privateJwkToBytes(At);return Promise.resolve(p256$1.sign(kt,Bt).toCompactRawBytes())})}static verify(e,At,kt){return __awaiter$3j(this,void 0,void 0,function*(){as.validateKey(kt);let Bt;At.length===64?Bt=p256$1.Signature.fromCompact(At):Bt=p256$1.Signature.fromDER(At);const Nt=yield sha256$7.encode(e),jt=p256$1.ProjectivePoint.fromAffine({x:as.bytesToBigInt(Encoder$4.base64UrlToBytes(kt.x)),y:as.bytesToBigInt(Encoder$4.base64UrlToBytes(kt.y))}).toRawBytes(!1);return p256$1.verify(Bt,Nt,jt)})}static generateKeyPair(){return __awaiter$3j(this,void 0,void 0,function*(){const e=p256$1.utils.randomPrivateKey(),At=secp256r1$1.getPublicKey(e,!1),kt=Encoder$4.bytesToBase64Url(e),Bt=yield as.publicKeyToJwk(At),Nt=Object.assign(Object.assign({},Bt),{d:kt});return{publicJwk:Bt,privateJwk:Nt}})}static bytesToBigInt(e){return BigInt("0x"+u8a.toString(e,"base16"))}};const signatureAlgorithms={Ed25519:ed25519$2,secp256k1:{sign:Secp256k1$3.sign,verify:Secp256k1$3.verify,generateKeyPair:Secp256k1$3.generateKeyPair,publicKeyToJwk:Secp256k1$3.publicKeyToJwk},"P-256":{sign:Secp256r1$3.sign,verify:Secp256r1$3.verify,generateKeyPair:Secp256r1$3.generateKeyPair,publicKeyToJwk:Secp256r1$3.publicKeyToJwk}};var __awaiter$3i=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class PrivateKeySigner{constructor(e){var At,kt;if(e.keyId===void 0&&e.privateJwk.kid===void 0)throw new DwnError(DwnErrorCode.PrivateKeySignerUnableToDeduceKeyId,"Unable to deduce the key ID");if(e.algorithm===void 0&&e.privateJwk.alg===void 0)throw new DwnError(DwnErrorCode.PrivateKeySignerUnableToDeduceAlgorithm,"Unable to deduce the signature algorithm");if(this.keyId=(At=e.keyId)!==null&&At!==void 0?At:e.privateJwk.kid,this.algorithm=(kt=e.algorithm)!==null&&kt!==void 0?kt:e.privateJwk.alg,this.privateJwk=e.privateJwk,this.signatureAlgorithm=signatureAlgorithms[e.privateJwk.crv],!this.signatureAlgorithm)throw new DwnError(DwnErrorCode.PrivateKeySignerUnsupportedCurve,`Unsupported crv ${e.privateJwk.crv}, crv must be one of ${Object.keys(signatureAlgorithms)}`)}sign(e){return __awaiter$3i(this,void 0,void 0,function*(){return yield this.signatureAlgorithm.sign(e,this.privateJwk)})}}var __awaiter$3h=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Jws{static getKid(e){const{kid:At}=Encoder$4.base64UrlToObject(e.protected);return At}static getSignerDid(e){const At=Jws.getKid(e);return Jws.extractDid(At)}static verifySignature(e,At,kt){return __awaiter$3h(this,void 0,void 0,function*(){const Bt=signatureAlgorithms[kt.crv];if(!Bt)throw new DwnError(DwnErrorCode.JwsVerifySignatureUnsupportedCrv,`unsupported crv. crv must be one of ${Object.keys(signatureAlgorithms)}`);const Nt=Encoder$4.stringToBytes(`${At.protected}.${e}`),jt=Encoder$4.base64UrlToBytes(At.signature);return yield Bt.verify(Nt,jt,kt)})}static decodePlainObjectPayload(e){let At;try{At=Encoder$4.base64UrlToObject(e.payload)}catch{throw new DwnError(DwnErrorCode.JwsDecodePlainObjectPayloadInvalid,"payload is not a JSON object")}if(!isPlainObject$1(At))throw new DwnError(DwnErrorCode.JwsDecodePlainObjectPayloadInvalid,"signed payload must be a plain object");return At}static extractDid(e){const[At]=e.split("#");return At}static createSigners(e){return e.map(kt=>Jws.createSigner(kt))}static createSigner(e){const At=e.keyPair.privateJwk,kt=e.keyId;return new PrivateKeySigner({privateJwk:At,keyId:kt})}}var buffer$2={},base64Js={};base64Js.byteLength=byteLength;base64Js.toByteArray=toByteArray;base64Js.fromByteArray=fromByteArray;var lookup$2=[],revLookup=[],Arr=typeof Uint8Array<"u"?Uint8Array:Array,code$6="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i$2=0,len=code$6.length;i$2<len;++i$2)lookup$2[i$2]=code$6[i$2],revLookup[code$6.charCodeAt(i$2)]=i$2;revLookup[45]=62;revLookup[95]=63;function getLens(xt){var e=xt.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var At=xt.indexOf("=");At===-1&&(At=e);var kt=At===e?0:4-At%4;return[At,kt]}function byteLength(xt){var e=getLens(xt),At=e[0],kt=e[1];return(At+kt)*3/4-kt}function _byteLength(xt,e,At){return(e+At)*3/4-At}function toByteArray(xt){var e,At=getLens(xt),kt=At[0],Bt=At[1],Nt=new Arr(_byteLength(xt,kt,Bt)),jt=0,Lt=Bt>0?kt-4:kt,er;for(er=0;er<Lt;er+=4)e=revLookup[xt.charCodeAt(er)]<<18|revLookup[xt.charCodeAt(er+1)]<<12|revLookup[xt.charCodeAt(er+2)]<<6|revLookup[xt.charCodeAt(er+3)],Nt[jt++]=e>>16&255,Nt[jt++]=e>>8&255,Nt[jt++]=e&255;return Bt===2&&(e=revLookup[xt.charCodeAt(er)]<<2|revLookup[xt.charCodeAt(er+1)]>>4,Nt[jt++]=e&255),Bt===1&&(e=revLookup[xt.charCodeAt(er)]<<10|revLookup[xt.charCodeAt(er+1)]<<4|revLookup[xt.charCodeAt(er+2)]>>2,Nt[jt++]=e>>8&255,Nt[jt++]=e&255),Nt}function tripletToBase64(xt){return lookup$2[xt>>18&63]+lookup$2[xt>>12&63]+lookup$2[xt>>6&63]+lookup$2[xt&63]}function encodeChunk(xt,e,At){for(var kt,Bt=[],Nt=e;Nt<At;Nt+=3)kt=(xt[Nt]<<16&16711680)+(xt[Nt+1]<<8&65280)+(xt[Nt+2]&255),Bt.push(tripletToBase64(kt));return Bt.join("")}function fromByteArray(xt){for(var e,At=xt.length,kt=At%3,Bt=[],Nt=16383,jt=0,Lt=At-kt;jt<Lt;jt+=Nt)Bt.push(encodeChunk(xt,jt,jt+Nt>Lt?Lt:jt+Nt));return kt===1?(e=xt[At-1],Bt.push(lookup$2[e>>2]+lookup$2[e<<4&63]+"==")):kt===2&&(e=(xt[At-2]<<8)+xt[At-1],Bt.push(lookup$2[e>>10]+lookup$2[e>>4&63]+lookup$2[e<<2&63]+"=")),Bt.join("")}var ieee754={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ieee754.read=function(xt,e,At,kt,Bt){var Nt,jt,Lt=Bt*8-kt-1,er=(1<<Lt)-1,tr=er>>1,zt=-7,rr=At?Bt-1:0,nr=At?-1:1,ir=xt[e+rr];for(rr+=nr,Nt=ir&(1<<-zt)-1,ir>>=-zt,zt+=Lt;zt>0;Nt=Nt*256+xt[e+rr],rr+=nr,zt-=8);for(jt=Nt&(1<<-zt)-1,Nt>>=-zt,zt+=kt;zt>0;jt=jt*256+xt[e+rr],rr+=nr,zt-=8);if(Nt===0)Nt=1-tr;else{if(Nt===er)return jt?NaN:(ir?-1:1)*(1/0);jt=jt+Math.pow(2,kt),Nt=Nt-tr}return(ir?-1:1)*jt*Math.pow(2,Nt-kt)};ieee754.write=function(xt,e,At,kt,Bt,Nt){var jt,Lt,er,tr=Nt*8-Bt-1,zt=(1<<tr)-1,rr=zt>>1,nr=Bt===23?Math.pow(2,-24)-Math.pow(2,-77):0,ir=kt?0:Nt-1,ar=kt?1:-1,dr=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(Lt=isNaN(e)?1:0,jt=zt):(jt=Math.floor(Math.log(e)/Math.LN2),e*(er=Math.pow(2,-jt))<1&&(jt--,er*=2),jt+rr>=1?e+=nr/er:e+=nr*Math.pow(2,1-rr),e*er>=2&&(jt++,er/=2),jt+rr>=zt?(Lt=0,jt=zt):jt+rr>=1?(Lt=(e*er-1)*Math.pow(2,Bt),jt=jt+rr):(Lt=e*Math.pow(2,rr-1)*Math.pow(2,Bt),jt=0));Bt>=8;xt[At+ir]=Lt&255,ir+=ar,Lt/=256,Bt-=8);for(jt=jt<<Bt|Lt,tr+=Bt;tr>0;xt[At+ir]=jt&255,ir+=ar,jt/=256,tr-=8);xt[At+ir-ar]|=dr*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(xt){var e=base64Js,At=ieee754,kt=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;xt.Buffer=Lt,xt.SlowBuffer=pr,xt.INSPECT_MAX_BYTES=50;var Bt=2147483647;xt.kMaxLength=Bt,Lt.TYPED_ARRAY_SUPPORT=Nt(),!Lt.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function Nt(){try{var qr=new Uint8Array(1),Or={foo:function(){return 42}};return Object.setPrototypeOf(Or,Uint8Array.prototype),Object.setPrototypeOf(qr,Or),qr.foo()===42}catch{return!1}}Object.defineProperty(Lt.prototype,"parent",{enumerable:!0,get:function(){if(Lt.isBuffer(this))return this.buffer}}),Object.defineProperty(Lt.prototype,"offset",{enumerable:!0,get:function(){if(Lt.isBuffer(this))return this.byteOffset}});function jt(qr){if(qr>Bt)throw new RangeError('The value "'+qr+'" is invalid for option "size"');var Or=new Uint8Array(qr);return Object.setPrototypeOf(Or,Lt.prototype),Or}function Lt(qr,Or,Fr){if(typeof qr=="number"){if(typeof Or=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return rr(qr)}return er(qr,Or,Fr)}Lt.poolSize=8192;function er(qr,Or,Fr){if(typeof qr=="string")return nr(qr,Or);if(ArrayBuffer.isView(qr))return ar(qr);if(qr==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof qr);if(Nr(qr,ArrayBuffer)||qr&&Nr(qr.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Nr(qr,SharedArrayBuffer)||qr&&Nr(qr.buffer,SharedArrayBuffer)))return dr(qr,Or,Fr);if(typeof qr=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var Zr=qr.valueOf&&qr.valueOf();if(Zr!=null&&Zr!==qr)return Lt.from(Zr,Or,Fr);var rn=ur(qr);if(rn)return rn;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof qr[Symbol.toPrimitive]=="function")return Lt.from(qr[Symbol.toPrimitive]("string"),Or,Fr);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof qr)}Lt.from=function(qr,Or,Fr){return er(qr,Or,Fr)},Object.setPrototypeOf(Lt.prototype,Uint8Array.prototype),Object.setPrototypeOf(Lt,Uint8Array);function tr(qr){if(typeof qr!="number")throw new TypeError('"size" argument must be of type number');if(qr<0)throw new RangeError('The value "'+qr+'" is invalid for option "size"')}function zt(qr,Or,Fr){return tr(qr),qr<=0?jt(qr):Or!==void 0?typeof Fr=="string"?jt(qr).fill(Or,Fr):jt(qr).fill(Or):jt(qr)}Lt.alloc=function(qr,Or,Fr){return zt(qr,Or,Fr)};function rr(qr){return tr(qr),jt(qr<0?0:fr(qr)|0)}Lt.allocUnsafe=function(qr){return rr(qr)},Lt.allocUnsafeSlow=function(qr){return rr(qr)};function nr(qr,Or){if((typeof Or!="string"||Or==="")&&(Or="utf8"),!Lt.isEncoding(Or))throw new TypeError("Unknown encoding: "+Or);var Fr=lr(qr,Or)|0,Zr=jt(Fr),rn=Zr.write(qr,Or);return rn!==Fr&&(Zr=Zr.slice(0,rn)),Zr}function ir(qr){for(var Or=qr.length<0?0:fr(qr.length)|0,Fr=jt(Or),Zr=0;Zr<Or;Zr+=1)Fr[Zr]=qr[Zr]&255;return Fr}function ar(qr){if(Nr(qr,Uint8Array)){var Or=new Uint8Array(qr);return dr(Or.buffer,Or.byteOffset,Or.byteLength)}return ir(qr)}function dr(qr,Or,Fr){if(Or<0||qr.byteLength<Or)throw new RangeError('"offset" is outside of buffer bounds');if(qr.byteLength<Or+(Fr||0))throw new RangeError('"length" is outside of buffer bounds');var Zr;return Or===void 0&&Fr===void 0?Zr=new Uint8Array(qr):Fr===void 0?Zr=new Uint8Array(qr,Or):Zr=new Uint8Array(qr,Or,Fr),Object.setPrototypeOf(Zr,Lt.prototype),Zr}function ur(qr){if(Lt.isBuffer(qr)){var Or=fr(qr.length)|0,Fr=jt(Or);return Fr.length===0||qr.copy(Fr,0,0,Or),Fr}if(qr.length!==void 0)return typeof qr.length!="number"||Vr(qr.length)?jt(0):ir(qr);if(qr.type==="Buffer"&&Array.isArray(qr.data))return ir(qr.data)}function fr(qr){if(qr>=Bt)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Bt.toString(16)+" bytes");return qr|0}function pr(qr){return+qr!=qr&&(qr=0),Lt.alloc(+qr)}Lt.isBuffer=function(Or){return Or!=null&&Or._isBuffer===!0&&Or!==Lt.prototype},Lt.compare=function(Or,Fr){if(Nr(Or,Uint8Array)&&(Or=Lt.from(Or,Or.offset,Or.byteLength)),Nr(Fr,Uint8Array)&&(Fr=Lt.from(Fr,Fr.offset,Fr.byteLength)),!Lt.isBuffer(Or)||!Lt.isBuffer(Fr))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(Or===Fr)return 0;for(var Zr=Or.length,rn=Fr.length,un=0,dn=Math.min(Zr,rn);un<dn;++un)if(Or[un]!==Fr[un]){Zr=Or[un],rn=Fr[un];break}return Zr<rn?-1:rn<Zr?1:0},Lt.isEncoding=function(Or){switch(String(Or).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Lt.concat=function(Or,Fr){if(!Array.isArray(Or))throw new TypeError('"list" argument must be an Array of Buffers');if(Or.length===0)return Lt.alloc(0);var Zr;if(Fr===void 0)for(Fr=0,Zr=0;Zr<Or.length;++Zr)Fr+=Or[Zr].length;var rn=Lt.allocUnsafe(Fr),un=0;for(Zr=0;Zr<Or.length;++Zr){var dn=Or[Zr];if(Nr(dn,Uint8Array))un+dn.length>rn.length?Lt.from(dn).copy(rn,un):Uint8Array.prototype.set.call(rn,dn,un);else if(Lt.isBuffer(dn))dn.copy(rn,un);else throw new TypeError('"list" argument must be an Array of Buffers');un+=dn.length}return rn};function lr(qr,Or){if(Lt.isBuffer(qr))return qr.length;if(ArrayBuffer.isView(qr)||Nr(qr,ArrayBuffer))return qr.byteLength;if(typeof qr!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof qr);var Fr=qr.length,Zr=arguments.length>2&&arguments[2]===!0;if(!Zr&&Fr===0)return 0;for(var rn=!1;;)switch(Or){case"ascii":case"latin1":case"binary":return Fr;case"utf8":case"utf-8":return jr(qr).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Fr*2;case"hex":return Fr>>>1;case"base64":return Jr(qr).length;default:if(rn)return Zr?-1:jr(qr).length;Or=(""+Or).toLowerCase(),rn=!0}}Lt.byteLength=lr;function yr(qr,Or,Fr){var Zr=!1;if((Or===void 0||Or<0)&&(Or=0),Or>this.length||((Fr===void 0||Fr>this.length)&&(Fr=this.length),Fr<=0)||(Fr>>>=0,Or>>>=0,Fr<=Or))return"";for(qr||(qr="utf8");;)switch(qr){case"hex":return $r(this,Or,Fr);case"utf8":case"utf-8":return gr(this,Or,Fr);case"ascii":return xr(this,Or,Fr);case"latin1":case"binary":return Ir(this,Or,Fr);case"base64":return _r(this,Or,Fr);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return vr(this,Or,Fr);default:if(Zr)throw new TypeError("Unknown encoding: "+qr);qr=(qr+"").toLowerCase(),Zr=!0}}Lt.prototype._isBuffer=!0;function br(qr,Or,Fr){var Zr=qr[Or];qr[Or]=qr[Fr],qr[Fr]=Zr}Lt.prototype.swap16=function(){var Or=this.length;if(Or%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var Fr=0;Fr<Or;Fr+=2)br(this,Fr,Fr+1);return this},Lt.prototype.swap32=function(){var Or=this.length;if(Or%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var Fr=0;Fr<Or;Fr+=4)br(this,Fr,Fr+3),br(this,Fr+1,Fr+2);return this},Lt.prototype.swap64=function(){var Or=this.length;if(Or%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var Fr=0;Fr<Or;Fr+=8)br(this,Fr,Fr+7),br(this,Fr+1,Fr+6),br(this,Fr+2,Fr+5),br(this,Fr+3,Fr+4);return this},Lt.prototype.toString=function(){var Or=this.length;return Or===0?"":arguments.length===0?gr(this,0,Or):yr.apply(this,arguments)},Lt.prototype.toLocaleString=Lt.prototype.toString,Lt.prototype.equals=function(Or){if(!Lt.isBuffer(Or))throw new TypeError("Argument must be a Buffer");return this===Or?!0:Lt.compare(this,Or)===0},Lt.prototype.inspect=function(){var Or="",Fr=xt.INSPECT_MAX_BYTES;return Or=this.toString("hex",0,Fr).replace(/(.{2})/g,"$1 ").trim(),this.length>Fr&&(Or+=" ... "),"<Buffer "+Or+">"},kt&&(Lt.prototype[kt]=Lt.prototype.inspect),Lt.prototype.compare=function(Or,Fr,Zr,rn,un){if(Nr(Or,Uint8Array)&&(Or=Lt.from(Or,Or.offset,Or.byteLength)),!Lt.isBuffer(Or))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof Or);if(Fr===void 0&&(Fr=0),Zr===void 0&&(Zr=Or?Or.length:0),rn===void 0&&(rn=0),un===void 0&&(un=this.length),Fr<0||Zr>Or.length||rn<0||un>this.length)throw new RangeError("out of range index");if(rn>=un&&Fr>=Zr)return 0;if(rn>=un)return-1;if(Fr>=Zr)return 1;if(Fr>>>=0,Zr>>>=0,rn>>>=0,un>>>=0,this===Or)return 0;for(var dn=un-rn,vn=Zr-Fr,$n=Math.min(dn,vn),en=this.slice(rn,un),tn=Or.slice(Fr,Zr),hn=0;hn<$n;++hn)if(en[hn]!==tn[hn]){dn=en[hn],vn=tn[hn];break}return dn<vn?-1:vn<dn?1:0};function Ar(qr,Or,Fr,Zr,rn){if(qr.length===0)return-1;if(typeof Fr=="string"?(Zr=Fr,Fr=0):Fr>2147483647?Fr=2147483647:Fr<-2147483648&&(Fr=-2147483648),Fr=+Fr,Vr(Fr)&&(Fr=rn?0:qr.length-1),Fr<0&&(Fr=qr.length+Fr),Fr>=qr.length){if(rn)return-1;Fr=qr.length-1}else if(Fr<0)if(rn)Fr=0;else return-1;if(typeof Or=="string"&&(Or=Lt.from(Or,Zr)),Lt.isBuffer(Or))return Or.length===0?-1:Pr(qr,Or,Fr,Zr,rn);if(typeof Or=="number")return Or=Or&255,typeof Uint8Array.prototype.indexOf=="function"?rn?Uint8Array.prototype.indexOf.call(qr,Or,Fr):Uint8Array.prototype.lastIndexOf.call(qr,Or,Fr):Pr(qr,[Or],Fr,Zr,rn);throw new TypeError("val must be string, number or Buffer")}function Pr(qr,Or,Fr,Zr,rn){var un=1,dn=qr.length,vn=Or.length;if(Zr!==void 0&&(Zr=String(Zr).toLowerCase(),Zr==="ucs2"||Zr==="ucs-2"||Zr==="utf16le"||Zr==="utf-16le")){if(qr.length<2||Or.length<2)return-1;un=2,dn/=2,vn/=2,Fr/=2}function $n(yn,xn){return un===1?yn[xn]:yn.readUInt16BE(xn*un)}var en;if(rn){var tn=-1;for(en=Fr;en<dn;en++)if($n(qr,en)===$n(Or,tn===-1?0:en-tn)){if(tn===-1&&(tn=en),en-tn+1===vn)return tn*un}else tn!==-1&&(en-=en-tn),tn=-1}else for(Fr+vn>dn&&(Fr=dn-vn),en=Fr;en>=0;en--){for(var hn=!0,mn=0;mn<vn;mn++)if($n(qr,en+mn)!==$n(Or,mn)){hn=!1;break}if(hn)return en}return-1}Lt.prototype.includes=function(Or,Fr,Zr){return this.indexOf(Or,Fr,Zr)!==-1},Lt.prototype.indexOf=function(Or,Fr,Zr){return Ar(this,Or,Fr,Zr,!0)},Lt.prototype.lastIndexOf=function(Or,Fr,Zr){return Ar(this,Or,Fr,Zr,!1)};function kr(qr,Or,Fr,Zr){Fr=Number(Fr)||0;var rn=qr.length-Fr;Zr?(Zr=Number(Zr),Zr>rn&&(Zr=rn)):Zr=rn;var un=Or.length;Zr>un/2&&(Zr=un/2);for(var dn=0;dn<Zr;++dn){var vn=parseInt(Or.substr(dn*2,2),16);if(Vr(vn))return dn;qr[Fr+dn]=vn}return dn}function Ur(qr,Or,Fr,Zr){return Wr(jr(Or,qr.length-Fr),qr,Fr,Zr)}function Hr(qr,Or,Fr,Zr){return Wr(Yr(Or),qr,Fr,Zr)}function Lr(qr,Or,Fr,Zr){return Wr(Jr(Or),qr,Fr,Zr)}function Sr(qr,Or,Fr,Zr){return Wr(Qr(Or,qr.length-Fr),qr,Fr,Zr)}Lt.prototype.write=function(Or,Fr,Zr,rn){if(Fr===void 0)rn="utf8",Zr=this.length,Fr=0;else if(Zr===void 0&&typeof Fr=="string")rn=Fr,Zr=this.length,Fr=0;else if(isFinite(Fr))Fr=Fr>>>0,isFinite(Zr)?(Zr=Zr>>>0,rn===void 0&&(rn="utf8")):(rn=Zr,Zr=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var un=this.length-Fr;if((Zr===void 0||Zr>un)&&(Zr=un),Or.length>0&&(Zr<0||Fr<0)||Fr>this.length)throw new RangeError("Attempt to write outside buffer bounds");rn||(rn="utf8");for(var dn=!1;;)switch(rn){case"hex":return kr(this,Or,Fr,Zr);case"utf8":case"utf-8":return Ur(this,Or,Fr,Zr);case"ascii":case"latin1":case"binary":return Hr(this,Or,Fr,Zr);case"base64":return Lr(this,Or,Fr,Zr);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Sr(this,Or,Fr,Zr);default:if(dn)throw new TypeError("Unknown encoding: "+rn);rn=(""+rn).toLowerCase(),dn=!0}},Lt.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function _r(qr,Or,Fr){return Or===0&&Fr===qr.length?e.fromByteArray(qr):e.fromByteArray(qr.slice(Or,Fr))}function gr(qr,Or,Fr){Fr=Math.min(qr.length,Fr);for(var Zr=[],rn=Or;rn<Fr;){var un=qr[rn],dn=null,vn=un>239?4:un>223?3:un>191?2:1;if(rn+vn<=Fr){var $n,en,tn,hn;switch(vn){case 1:un<128&&(dn=un);break;case 2:$n=qr[rn+1],($n&192)===128&&(hn=(un&31)<<6|$n&63,hn>127&&(dn=hn));break;case 3:$n=qr[rn+1],en=qr[rn+2],($n&192)===128&&(en&192)===128&&(hn=(un&15)<<12|($n&63)<<6|en&63,hn>2047&&(hn<55296||hn>57343)&&(dn=hn));break;case 4:$n=qr[rn+1],en=qr[rn+2],tn=qr[rn+3],($n&192)===128&&(en&192)===128&&(tn&192)===128&&(hn=(un&15)<<18|($n&63)<<12|(en&63)<<6|tn&63,hn>65535&&hn<1114112&&(dn=hn))}}dn===null?(dn=65533,vn=1):dn>65535&&(dn-=65536,Zr.push(dn>>>10&1023|55296),dn=56320|dn&1023),Zr.push(dn),rn+=vn}return Dr(Zr)}var wr=4096;function Dr(qr){var Or=qr.length;if(Or<=wr)return String.fromCharCode.apply(String,qr);for(var Fr="",Zr=0;Zr<Or;)Fr+=String.fromCharCode.apply(String,qr.slice(Zr,Zr+=wr));return Fr}function xr(qr,Or,Fr){var Zr="";Fr=Math.min(qr.length,Fr);for(var rn=Or;rn<Fr;++rn)Zr+=String.fromCharCode(qr[rn]&127);return Zr}function Ir(qr,Or,Fr){var Zr="";Fr=Math.min(qr.length,Fr);for(var rn=Or;rn<Fr;++rn)Zr+=String.fromCharCode(qr[rn]);return Zr}function $r(qr,Or,Fr){var Zr=qr.length;(!Or||Or<0)&&(Or=0),(!Fr||Fr<0||Fr>Zr)&&(Fr=Zr);for(var rn="",un=Or;un<Fr;++un)rn+=Xr[qr[un]];return rn}function vr(qr,Or,Fr){for(var Zr=qr.slice(Or,Fr),rn="",un=0;un<Zr.length-1;un+=2)rn+=String.fromCharCode(Zr[un]+Zr[un+1]*256);return rn}Lt.prototype.slice=function(Or,Fr){var Zr=this.length;Or=~~Or,Fr=Fr===void 0?Zr:~~Fr,Or<0?(Or+=Zr,Or<0&&(Or=0)):Or>Zr&&(Or=Zr),Fr<0?(Fr+=Zr,Fr<0&&(Fr=0)):Fr>Zr&&(Fr=Zr),Fr<Or&&(Fr=Or);var rn=this.subarray(Or,Fr);return Object.setPrototypeOf(rn,Lt.prototype),rn};function Er(qr,Or,Fr){if(qr%1!==0||qr<0)throw new RangeError("offset is not uint");if(qr+Or>Fr)throw new RangeError("Trying to access beyond buffer length")}Lt.prototype.readUintLE=Lt.prototype.readUIntLE=function(Or,Fr,Zr){Or=Or>>>0,Fr=Fr>>>0,Zr||Er(Or,Fr,this.length);for(var rn=this[Or],un=1,dn=0;++dn<Fr&&(un*=256);)rn+=this[Or+dn]*un;return rn},Lt.prototype.readUintBE=Lt.prototype.readUIntBE=function(Or,Fr,Zr){Or=Or>>>0,Fr=Fr>>>0,Zr||Er(Or,Fr,this.length);for(var rn=this[Or+--Fr],un=1;Fr>0&&(un*=256);)rn+=this[Or+--Fr]*un;return rn},Lt.prototype.readUint8=Lt.prototype.readUInt8=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,1,this.length),this[Or]},Lt.prototype.readUint16LE=Lt.prototype.readUInt16LE=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,2,this.length),this[Or]|this[Or+1]<<8},Lt.prototype.readUint16BE=Lt.prototype.readUInt16BE=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,2,this.length),this[Or]<<8|this[Or+1]},Lt.prototype.readUint32LE=Lt.prototype.readUInt32LE=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,4,this.length),(this[Or]|this[Or+1]<<8|this[Or+2]<<16)+this[Or+3]*16777216},Lt.prototype.readUint32BE=Lt.prototype.readUInt32BE=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,4,this.length),this[Or]*16777216+(this[Or+1]<<16|this[Or+2]<<8|this[Or+3])},Lt.prototype.readIntLE=function(Or,Fr,Zr){Or=Or>>>0,Fr=Fr>>>0,Zr||Er(Or,Fr,this.length);for(var rn=this[Or],un=1,dn=0;++dn<Fr&&(un*=256);)rn+=this[Or+dn]*un;return un*=128,rn>=un&&(rn-=Math.pow(2,8*Fr)),rn},Lt.prototype.readIntBE=function(Or,Fr,Zr){Or=Or>>>0,Fr=Fr>>>0,Zr||Er(Or,Fr,this.length);for(var rn=Fr,un=1,dn=this[Or+--rn];rn>0&&(un*=256);)dn+=this[Or+--rn]*un;return un*=128,dn>=un&&(dn-=Math.pow(2,8*Fr)),dn},Lt.prototype.readInt8=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,1,this.length),this[Or]&128?(255-this[Or]+1)*-1:this[Or]},Lt.prototype.readInt16LE=function(Or,Fr){Or=Or>>>0,Fr||Er(Or,2,this.length);var Zr=this[Or]|this[Or+1]<<8;return Zr&32768?Zr|4294901760:Zr},Lt.prototype.readInt16BE=function(Or,Fr){Or=Or>>>0,Fr||Er(Or,2,this.length);var Zr=this[Or+1]|this[Or]<<8;return Zr&32768?Zr|4294901760:Zr},Lt.prototype.readInt32LE=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,4,this.length),this[Or]|this[Or+1]<<8|this[Or+2]<<16|this[Or+3]<<24},Lt.prototype.readInt32BE=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,4,this.length),this[Or]<<24|this[Or+1]<<16|this[Or+2]<<8|this[Or+3]},Lt.prototype.readFloatLE=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,4,this.length),At.read(this,Or,!0,23,4)},Lt.prototype.readFloatBE=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,4,this.length),At.read(this,Or,!1,23,4)},Lt.prototype.readDoubleLE=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,8,this.length),At.read(this,Or,!0,52,8)},Lt.prototype.readDoubleBE=function(Or,Fr){return Or=Or>>>0,Fr||Er(Or,8,this.length),At.read(this,Or,!1,52,8)};function Tr(qr,Or,Fr,Zr,rn,un){if(!Lt.isBuffer(qr))throw new TypeError('"buffer" argument must be a Buffer instance');if(Or>rn||Or<un)throw new RangeError('"value" argument is out of bounds');if(Fr+Zr>qr.length)throw new RangeError("Index out of range")}Lt.prototype.writeUintLE=Lt.prototype.writeUIntLE=function(Or,Fr,Zr,rn){if(Or=+Or,Fr=Fr>>>0,Zr=Zr>>>0,!rn){var un=Math.pow(2,8*Zr)-1;Tr(this,Or,Fr,Zr,un,0)}var dn=1,vn=0;for(this[Fr]=Or&255;++vn<Zr&&(dn*=256);)this[Fr+vn]=Or/dn&255;return Fr+Zr},Lt.prototype.writeUintBE=Lt.prototype.writeUIntBE=function(Or,Fr,Zr,rn){if(Or=+Or,Fr=Fr>>>0,Zr=Zr>>>0,!rn){var un=Math.pow(2,8*Zr)-1;Tr(this,Or,Fr,Zr,un,0)}var dn=Zr-1,vn=1;for(this[Fr+dn]=Or&255;--dn>=0&&(vn*=256);)this[Fr+dn]=Or/vn&255;return Fr+Zr},Lt.prototype.writeUint8=Lt.prototype.writeUInt8=function(Or,Fr,Zr){return Or=+Or,Fr=Fr>>>0,Zr||Tr(this,Or,Fr,1,255,0),this[Fr]=Or&255,Fr+1},Lt.prototype.writeUint16LE=Lt.prototype.writeUInt16LE=function(Or,Fr,Zr){return Or=+Or,Fr=Fr>>>0,Zr||Tr(this,Or,Fr,2,65535,0),this[Fr]=Or&255,this[Fr+1]=Or>>>8,Fr+2},Lt.prototype.writeUint16BE=Lt.prototype.writeUInt16BE=function(Or,Fr,Zr){return Or=+Or,Fr=Fr>>>0,Zr||Tr(this,Or,Fr,2,65535,0),this[Fr]=Or>>>8,this[Fr+1]=Or&255,Fr+2},Lt.prototype.writeUint32LE=Lt.prototype.writeUInt32LE=function(Or,Fr,Zr){return Or=+Or,Fr=Fr>>>0,Zr||Tr(this,Or,Fr,4,4294967295,0),this[Fr+3]=Or>>>24,this[Fr+2]=Or>>>16,this[Fr+1]=Or>>>8,this[Fr]=Or&255,Fr+4},Lt.prototype.writeUint32BE=Lt.prototype.writeUInt32BE=function(Or,Fr,Zr){return Or=+Or,Fr=Fr>>>0,Zr||Tr(this,Or,Fr,4,4294967295,0),this[Fr]=Or>>>24,this[Fr+1]=Or>>>16,this[Fr+2]=Or>>>8,this[Fr+3]=Or&255,Fr+4},Lt.prototype.writeIntLE=function(Or,Fr,Zr,rn){if(Or=+Or,Fr=Fr>>>0,!rn){var un=Math.pow(2,8*Zr-1);Tr(this,Or,Fr,Zr,un-1,-un)}var dn=0,vn=1,$n=0;for(this[Fr]=Or&255;++dn<Zr&&(vn*=256);)Or<0&&$n===0&&this[Fr+dn-1]!==0&&($n=1),this[Fr+dn]=(Or/vn>>0)-$n&255;return Fr+Zr},Lt.prototype.writeIntBE=function(Or,Fr,Zr,rn){if(Or=+Or,Fr=Fr>>>0,!rn){var un=Math.pow(2,8*Zr-1);Tr(this,Or,Fr,Zr,un-1,-un)}var dn=Zr-1,vn=1,$n=0;for(this[Fr+dn]=Or&255;--dn>=0&&(vn*=256);)Or<0&&$n===0&&this[Fr+dn+1]!==0&&($n=1),this[Fr+dn]=(Or/vn>>0)-$n&255;return Fr+Zr},Lt.prototype.writeInt8=function(Or,Fr,Zr){return Or=+Or,Fr=Fr>>>0,Zr||Tr(this,Or,Fr,1,127,-128),Or<0&&(Or=255+Or+1),this[Fr]=Or&255,Fr+1},Lt.prototype.writeInt16LE=function(Or,Fr,Zr){return Or=+Or,Fr=Fr>>>0,Zr||Tr(this,Or,Fr,2,32767,-32768),this[Fr]=Or&255,this[Fr+1]=Or>>>8,Fr+2},Lt.prototype.writeInt16BE=function(Or,Fr,Zr){return Or=+Or,Fr=Fr>>>0,Zr||Tr(this,Or,Fr,2,32767,-32768),this[Fr]=Or>>>8,this[Fr+1]=Or&255,Fr+2},Lt.prototype.writeInt32LE=function(Or,Fr,Zr){return Or=+Or,Fr=Fr>>>0,Zr||Tr(this,Or,Fr,4,2147483647,-2147483648),this[Fr]=Or&255,this[Fr+1]=Or>>>8,this[Fr+2]=Or>>>16,this[Fr+3]=Or>>>24,Fr+4},Lt.prototype.writeInt32BE=function(Or,Fr,Zr){return Or=+Or,Fr=Fr>>>0,Zr||Tr(this,Or,Fr,4,2147483647,-2147483648),Or<0&&(Or=4294967295+Or+1),this[Fr]=Or>>>24,this[Fr+1]=Or>>>16,this[Fr+2]=Or>>>8,this[Fr+3]=Or&255,Fr+4};function Rr(qr,Or,Fr,Zr,rn,un){if(Fr+Zr>qr.length)throw new RangeError("Index out of range");if(Fr<0)throw new RangeError("Index out of range")}function Mr(qr,Or,Fr,Zr,rn){return Or=+Or,Fr=Fr>>>0,rn||Rr(qr,Or,Fr,4),At.write(qr,Or,Fr,Zr,23,4),Fr+4}Lt.prototype.writeFloatLE=function(Or,Fr,Zr){return Mr(this,Or,Fr,!0,Zr)},Lt.prototype.writeFloatBE=function(Or,Fr,Zr){return Mr(this,Or,Fr,!1,Zr)};function Gr(qr,Or,Fr,Zr,rn){return Or=+Or,Fr=Fr>>>0,rn||Rr(qr,Or,Fr,8),At.write(qr,Or,Fr,Zr,52,8),Fr+8}Lt.prototype.writeDoubleLE=function(Or,Fr,Zr){return Gr(this,Or,Fr,!0,Zr)},Lt.prototype.writeDoubleBE=function(Or,Fr,Zr){return Gr(this,Or,Fr,!1,Zr)},Lt.prototype.copy=function(Or,Fr,Zr,rn){if(!Lt.isBuffer(Or))throw new TypeError("argument should be a Buffer");if(Zr||(Zr=0),!rn&&rn!==0&&(rn=this.length),Fr>=Or.length&&(Fr=Or.length),Fr||(Fr=0),rn>0&&rn<Zr&&(rn=Zr),rn===Zr||Or.length===0||this.length===0)return 0;if(Fr<0)throw new RangeError("targetStart out of bounds");if(Zr<0||Zr>=this.length)throw new RangeError("Index out of range");if(rn<0)throw new RangeError("sourceEnd out of bounds");rn>this.length&&(rn=this.length),Or.length-Fr<rn-Zr&&(rn=Or.length-Fr+Zr);var un=rn-Zr;return this===Or&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(Fr,Zr,rn):Uint8Array.prototype.set.call(Or,this.subarray(Zr,rn),Fr),un},Lt.prototype.fill=function(Or,Fr,Zr,rn){if(typeof Or=="string"){if(typeof Fr=="string"?(rn=Fr,Fr=0,Zr=this.length):typeof Zr=="string"&&(rn=Zr,Zr=this.length),rn!==void 0&&typeof rn!="string")throw new TypeError("encoding must be a string");if(typeof rn=="string"&&!Lt.isEncoding(rn))throw new TypeError("Unknown encoding: "+rn);if(Or.length===1){var un=Or.charCodeAt(0);(rn==="utf8"&&un<128||rn==="latin1")&&(Or=un)}}else typeof Or=="number"?Or=Or&255:typeof Or=="boolean"&&(Or=Number(Or));if(Fr<0||this.length<Fr||this.length<Zr)throw new RangeError("Out of range index");if(Zr<=Fr)return this;Fr=Fr>>>0,Zr=Zr===void 0?this.length:Zr>>>0,Or||(Or=0);var dn;if(typeof Or=="number")for(dn=Fr;dn<Zr;++dn)this[dn]=Or;else{var vn=Lt.isBuffer(Or)?Or:Lt.from(Or,rn),$n=vn.length;if($n===0)throw new TypeError('The value "'+Or+'" is invalid for argument "value"');for(dn=0;dn<Zr-Fr;++dn)this[dn+Fr]=vn[dn%$n]}return this};var Br=/[^+/0-9A-Za-z-_]/g;function Cr(qr){if(qr=qr.split("=")[0],qr=qr.trim().replace(Br,""),qr.length<2)return"";for(;qr.length%4!==0;)qr=qr+"=";return qr}function jr(qr,Or){Or=Or||1/0;for(var Fr,Zr=qr.length,rn=null,un=[],dn=0;dn<Zr;++dn){if(Fr=qr.charCodeAt(dn),Fr>55295&&Fr<57344){if(!rn){if(Fr>56319){(Or-=3)>-1&&un.push(239,191,189);continue}else if(dn+1===Zr){(Or-=3)>-1&&un.push(239,191,189);continue}rn=Fr;continue}if(Fr<56320){(Or-=3)>-1&&un.push(239,191,189),rn=Fr;continue}Fr=(rn-55296<<10|Fr-56320)+65536}else rn&&(Or-=3)>-1&&un.push(239,191,189);if(rn=null,Fr<128){if((Or-=1)<0)break;un.push(Fr)}else if(Fr<2048){if((Or-=2)<0)break;un.push(Fr>>6|192,Fr&63|128)}else if(Fr<65536){if((Or-=3)<0)break;un.push(Fr>>12|224,Fr>>6&63|128,Fr&63|128)}else if(Fr<1114112){if((Or-=4)<0)break;un.push(Fr>>18|240,Fr>>12&63|128,Fr>>6&63|128,Fr&63|128)}else throw new Error("Invalid code point")}return un}function Yr(qr){for(var Or=[],Fr=0;Fr<qr.length;++Fr)Or.push(qr.charCodeAt(Fr)&255);return Or}function Qr(qr,Or){for(var Fr,Zr,rn,un=[],dn=0;dn<qr.length&&!((Or-=2)<0);++dn)Fr=qr.charCodeAt(dn),Zr=Fr>>8,rn=Fr%256,un.push(rn),un.push(Zr);return un}function Jr(qr){return e.toByteArray(Cr(qr))}function Wr(qr,Or,Fr,Zr){for(var rn=0;rn<Zr&&!(rn+Fr>=Or.length||rn>=qr.length);++rn)Or[rn+Fr]=qr[rn];return rn}function Nr(qr,Or){return qr instanceof Or||qr!=null&&qr.constructor!=null&&qr.constructor.name!=null&&qr.constructor.name===Or.name}function Vr(qr){return qr!==qr}var Xr=function(){for(var qr="0123456789abcdef",Or=new Array(256),Fr=0;Fr<16;++Fr)for(var Zr=Fr*16,rn=0;rn<16;++rn)Or[Zr+rn]=qr[Fr]+qr[rn];return Or}()})(buffer$2);var browser$f={exports:{}},process$8=browser$f.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?cachedSetTimeout=setTimeout:cachedSetTimeout=defaultSetTimout}catch{cachedSetTimeout=defaultSetTimout}try{typeof clearTimeout=="function"?cachedClearTimeout=clearTimeout:cachedClearTimeout=defaultClearTimeout}catch{cachedClearTimeout=defaultClearTimeout}})();function runTimeout(xt){if(cachedSetTimeout===setTimeout)return setTimeout(xt,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(xt,0);try{return cachedSetTimeout(xt,0)}catch{try{return cachedSetTimeout.call(null,xt,0)}catch{return cachedSetTimeout.call(this,xt,0)}}}function runClearTimeout(xt){if(cachedClearTimeout===clearTimeout)return clearTimeout(xt);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(xt);try{return cachedClearTimeout(xt)}catch{try{return cachedClearTimeout.call(null,xt)}catch{return cachedClearTimeout.call(this,xt)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){!draining||!currentQueue||(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var xt=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(xt)}}process$8.nextTick=function(xt){var e=new Array(arguments.length-1);if(arguments.length>1)for(var At=1;At<arguments.length;At++)e[At-1]=arguments[At];queue.push(new Item$1(xt,e)),queue.length===1&&!draining&&runTimeout(drainQueue)};function Item$1(xt,e){this.fun=xt,this.array=e}Item$1.prototype.run=function(){this.fun.apply(null,this.array)};process$8.title="browser";process$8.browser=!0;process$8.env={};process$8.argv=[];process$8.version="";process$8.versions={};function noop$5(){}process$8.on=noop$5;process$8.addListener=noop$5;process$8.once=noop$5;process$8.off=noop$5;process$8.removeListener=noop$5;process$8.removeAllListeners=noop$5;process$8.emit=noop$5;process$8.prependListener=noop$5;process$8.prependOnceListener=noop$5;process$8.listeners=function(xt){return[]};process$8.binding=function(xt){throw new Error("process.binding is not supported")};process$8.cwd=function(){return"/"};process$8.chdir=function(xt){throw new Error("process.chdir is not supported")};process$8.umask=function(){return 0};var browserExports$3=browser$f.exports;const process$9=getDefaultExportFromCjs(browserExports$3);(function(xt){function e(){var kt=this||self;return delete xt.prototype.__magic__,kt}if(typeof globalThis=="object")return globalThis;if(this)return e();xt.defineProperty(xt.prototype,"__magic__",{configurable:!0,get:e});var At=__magic__;return At})(Object);const perf$1=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,warned=new Set,PROCESS=typeof process$9=="object"&&process$9?process$9:{},emitWarning=(xt,e,At,kt)=>{typeof PROCESS.emitWarning=="function"?PROCESS.emitWarning(xt,e,At,kt):console.error(`[${At}] ${e}: ${xt}`)};let AC=globalThis.AbortController,AS=globalThis.AbortSignal;var _c;if(typeof AC>"u"){AS=class{constructor(){wn(this,"onabort");wn(this,"_onabort",[]);wn(this,"reason");wn(this,"aborted",!1)}addEventListener(kt,Bt){this._onabort.push(Bt)}},AC=class{constructor(){wn(this,"signal",new AS);e()}abort(kt){var Bt,Nt;if(!this.signal.aborted){this.signal.reason=kt,this.signal.aborted=!0;for(const jt of this.signal._onabort)jt(kt);(Nt=(Bt=this.signal).onabort)==null||Nt.call(Bt,kt)}}};let xt=((_c=PROCESS.env)==null?void 0:_c.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const e=()=>{xt&&(xt=!1,emitWarning("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const shouldWarn=xt=>!warned.has(xt),isPosInt$1=xt=>xt&&xt===Math.floor(xt)&&xt>0&&isFinite(xt),getUintArray=xt=>isPosInt$1(xt)?xt<=Math.pow(2,8)?Uint8Array:xt<=Math.pow(2,16)?Uint16Array:xt<=Math.pow(2,32)?Uint32Array:xt<=Number.MAX_SAFE_INTEGER?ZeroArray:null:null;class ZeroArray extends Array{constructor(e){super(e),this.fill(0)}}var Ts;const fs=class fs{constructor(e,At){wn(this,"heap");wn(this,"length");if(!ln(fs,Ts))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new At(e),this.length=0}static create(e){const At=getUintArray(e);if(!At)return[];Gn(fs,Ts,!0);const kt=new fs(e,At);return Gn(fs,Ts,!1),kt}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};Ts=new WeakMap,no(fs,Ts,!1);let Stack=fs;var Mo,ko,qo,Bo,xs,fo,No,ho,ao,Jn,xo,Co,Eo,go,jo,wo,Jo,Yo,Uo,Ho,ss,Po,Cn,Ys,hs,Zo,Ns,Oo,yl,ps,Is,js,Xo,es,Zs,Gs,zs,co,Qs,Ds;const ga=class ga{constructor(e){no(this,Cn);no(this,Mo);no(this,ko);no(this,qo);no(this,Bo);no(this,xs);wn(this,"ttl");wn(this,"ttlResolution");wn(this,"ttlAutopurge");wn(this,"updateAgeOnGet");wn(this,"updateAgeOnHas");wn(this,"allowStale");wn(this,"noDisposeOnSet");wn(this,"noUpdateTTL");wn(this,"maxEntrySize");wn(this,"sizeCalculation");wn(this,"noDeleteOnFetchRejection");wn(this,"noDeleteOnStaleGet");wn(this,"allowStaleOnFetchAbort");wn(this,"allowStaleOnFetchRejection");wn(this,"ignoreFetchAbort");no(this,fo);no(this,No);no(this,ho);no(this,ao);no(this,Jn);no(this,xo);no(this,Co);no(this,Eo);no(this,go);no(this,jo);no(this,wo);no(this,Jo);no(this,Yo);no(this,Uo);no(this,Ho);no(this,ss);no(this,Po);no(this,hs,()=>{});no(this,Zo,()=>{});no(this,Ns,()=>{});no(this,Oo,()=>!1);no(this,ps,e=>{});no(this,Is,(e,At,kt)=>{});no(this,js,(e,At,kt,Bt)=>{if(kt||Bt)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});const{max:At=0,ttl:kt,ttlResolution:Bt=1,ttlAutopurge:Nt,updateAgeOnGet:jt,updateAgeOnHas:Lt,allowStale:er,dispose:tr,disposeAfter:zt,noDisposeOnSet:rr,noUpdateTTL:nr,maxSize:ir=0,maxEntrySize:ar=0,sizeCalculation:dr,fetchMethod:ur,noDeleteOnFetchRejection:fr,noDeleteOnStaleGet:pr,allowStaleOnFetchRejection:lr,allowStaleOnFetchAbort:yr,ignoreFetchAbort:br}=e;if(At!==0&&!isPosInt$1(At))throw new TypeError("max option must be a nonnegative integer");const Ar=At?getUintArray(At):Array;if(!Ar)throw new Error("invalid max value: "+At);if(Gn(this,Mo,At),Gn(this,ko,ir),this.maxEntrySize=ar||ln(this,ko),this.sizeCalculation=dr,this.sizeCalculation){if(!ln(this,ko)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(ur!==void 0&&typeof ur!="function")throw new TypeError("fetchMethod must be a function if specified");if(Gn(this,xs,ur),Gn(this,ss,!!ur),Gn(this,ho,new Map),Gn(this,ao,new Array(At).fill(void 0)),Gn(this,Jn,new Array(At).fill(void 0)),Gn(this,xo,new Ar(At)),Gn(this,Co,new Ar(At)),Gn(this,Eo,0),Gn(this,go,0),Gn(this,jo,Stack.create(At)),Gn(this,fo,0),Gn(this,No,0),typeof tr=="function"&&Gn(this,qo,tr),typeof zt=="function"?(Gn(this,Bo,zt),Gn(this,wo,[])):(Gn(this,Bo,void 0),Gn(this,wo,void 0)),Gn(this,Ho,!!ln(this,qo)),Gn(this,Po,!!ln(this,Bo)),this.noDisposeOnSet=!!rr,this.noUpdateTTL=!!nr,this.noDeleteOnFetchRejection=!!fr,this.allowStaleOnFetchRejection=!!lr,this.allowStaleOnFetchAbort=!!yr,this.ignoreFetchAbort=!!br,this.maxEntrySize!==0){if(ln(this,ko)!==0&&!isPosInt$1(ln(this,ko)))throw new TypeError("maxSize must be a positive integer if specified");if(!isPosInt$1(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");jn(this,Cn,yl).call(this)}if(this.allowStale=!!er,this.noDeleteOnStaleGet=!!pr,this.updateAgeOnGet=!!jt,this.updateAgeOnHas=!!Lt,this.ttlResolution=isPosInt$1(Bt)||Bt===0?Bt:1,this.ttlAutopurge=!!Nt,this.ttl=kt||0,this.ttl){if(!isPosInt$1(this.ttl))throw new TypeError("ttl must be a positive integer if specified");jn(this,Cn,Ys).call(this)}if(ln(this,Mo)===0&&this.ttl===0&&ln(this,ko)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!ln(this,Mo)&&!ln(this,ko)){const Pr="LRU_CACHE_UNBOUNDED";shouldWarn(Pr)&&(warned.add(Pr),emitWarning("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",Pr,ga))}}static unsafeExposeInternals(e){return{starts:ln(e,Yo),ttls:ln(e,Uo),sizes:ln(e,Jo),keyMap:ln(e,ho),keyList:ln(e,ao),valList:ln(e,Jn),next:ln(e,xo),prev:ln(e,Co),get head(){return ln(e,Eo)},get tail(){return ln(e,go)},free:ln(e,jo),isBackgroundFetch:At=>{var kt;return jn(kt=e,Cn,co).call(kt,At)},backgroundFetch:(At,kt,Bt,Nt)=>{var jt;return jn(jt=e,Cn,zs).call(jt,At,kt,Bt,Nt)},moveToTail:At=>{var kt;return jn(kt=e,Cn,Ds).call(kt,At)},indexes:At=>{var kt;return jn(kt=e,Cn,Xo).call(kt,At)},rindexes:At=>{var kt;return jn(kt=e,Cn,es).call(kt,At)},isStale:At=>{var kt;return ln(kt=e,Oo).call(kt,At)}}}get max(){return ln(this,Mo)}get maxSize(){return ln(this,ko)}get calculatedSize(){return ln(this,No)}get size(){return ln(this,fo)}get fetchMethod(){return ln(this,xs)}get dispose(){return ln(this,qo)}get disposeAfter(){return ln(this,Bo)}getRemainingTTL(e){return ln(this,ho).has(e)?1/0:0}*entries(){for(const e of jn(this,Cn,Xo).call(this))ln(this,Jn)[e]!==void 0&&ln(this,ao)[e]!==void 0&&!jn(this,Cn,co).call(this,ln(this,Jn)[e])&&(yield[ln(this,ao)[e],ln(this,Jn)[e]])}*rentries(){for(const e of jn(this,Cn,es).call(this))ln(this,Jn)[e]!==void 0&&ln(this,ao)[e]!==void 0&&!jn(this,Cn,co).call(this,ln(this,Jn)[e])&&(yield[ln(this,ao)[e],ln(this,Jn)[e]])}*keys(){for(const e of jn(this,Cn,Xo).call(this)){const At=ln(this,ao)[e];At!==void 0&&!jn(this,Cn,co).call(this,ln(this,Jn)[e])&&(yield At)}}*rkeys(){for(const e of jn(this,Cn,es).call(this)){const At=ln(this,ao)[e];At!==void 0&&!jn(this,Cn,co).call(this,ln(this,Jn)[e])&&(yield At)}}*values(){for(const e of jn(this,Cn,Xo).call(this))ln(this,Jn)[e]!==void 0&&!jn(this,Cn,co).call(this,ln(this,Jn)[e])&&(yield ln(this,Jn)[e])}*rvalues(){for(const e of jn(this,Cn,es).call(this))ln(this,Jn)[e]!==void 0&&!jn(this,Cn,co).call(this,ln(this,Jn)[e])&&(yield ln(this,Jn)[e])}[Symbol.iterator](){return this.entries()}find(e,At={}){for(const kt of jn(this,Cn,Xo).call(this)){const Bt=ln(this,Jn)[kt],Nt=jn(this,Cn,co).call(this,Bt)?Bt.__staleWhileFetching:Bt;if(Nt!==void 0&&e(Nt,ln(this,ao)[kt],this))return this.get(ln(this,ao)[kt],At)}}forEach(e,At=this){for(const kt of jn(this,Cn,Xo).call(this)){const Bt=ln(this,Jn)[kt],Nt=jn(this,Cn,co).call(this,Bt)?Bt.__staleWhileFetching:Bt;Nt!==void 0&&e.call(At,Nt,ln(this,ao)[kt],this)}}rforEach(e,At=this){for(const kt of jn(this,Cn,es).call(this)){const Bt=ln(this,Jn)[kt],Nt=jn(this,Cn,co).call(this,Bt)?Bt.__staleWhileFetching:Bt;Nt!==void 0&&e.call(At,Nt,ln(this,ao)[kt],this)}}purgeStale(){let e=!1;for(const At of jn(this,Cn,es).call(this,{allowStale:!0}))ln(this,Oo).call(this,At)&&(this.delete(ln(this,ao)[At]),e=!0);return e}dump(){const e=[];for(const At of jn(this,Cn,Xo).call(this,{allowStale:!0})){const kt=ln(this,ao)[At],Bt=ln(this,Jn)[At],Nt=jn(this,Cn,co).call(this,Bt)?Bt.__staleWhileFetching:Bt;if(Nt===void 0||kt===void 0)continue;const jt={value:Nt};if(ln(this,Uo)&&ln(this,Yo)){jt.ttl=ln(this,Uo)[At];const Lt=perf$1.now()-ln(this,Yo)[At];jt.start=Math.floor(Date.now()-Lt)}ln(this,Jo)&&(jt.size=ln(this,Jo)[At]),e.unshift([kt,jt])}return e}load(e){this.clear();for(const[At,kt]of e){if(kt.start){const Bt=Date.now()-kt.start;kt.start=perf$1.now()-Bt}this.set(At,kt.value,kt)}}set(e,At,kt={}){var nr,ir,ar;if(At===void 0)return this.delete(e),this;const{ttl:Bt=this.ttl,start:Nt,noDisposeOnSet:jt=this.noDisposeOnSet,sizeCalculation:Lt=this.sizeCalculation,status:er}=kt;let{noUpdateTTL:tr=this.noUpdateTTL}=kt;const zt=ln(this,js).call(this,e,At,kt.size||0,Lt);if(this.maxEntrySize&&zt>this.maxEntrySize)return er&&(er.set="miss",er.maxEntrySizeExceeded=!0),this.delete(e),this;let rr=ln(this,fo)===0?void 0:ln(this,ho).get(e);if(rr===void 0)rr=ln(this,fo)===0?ln(this,go):ln(this,jo).length!==0?ln(this,jo).pop():ln(this,fo)===ln(this,Mo)?jn(this,Cn,Gs).call(this,!1):ln(this,fo),ln(this,ao)[rr]=e,ln(this,Jn)[rr]=At,ln(this,ho).set(e,rr),ln(this,xo)[ln(this,go)]=rr,ln(this,Co)[rr]=ln(this,go),Gn(this,go,rr),Fs(this,fo)._++,ln(this,Is).call(this,rr,zt,er),er&&(er.set="add"),tr=!1;else{jn(this,Cn,Ds).call(this,rr);const dr=ln(this,Jn)[rr];if(At!==dr){if(ln(this,ss)&&jn(this,Cn,co).call(this,dr)?dr.__abortController.abort(new Error("replaced")):jt||(ln(this,Ho)&&((nr=ln(this,qo))==null||nr.call(this,dr,e,"set")),ln(this,Po)&&((ir=ln(this,wo))==null||ir.push([dr,e,"set"]))),ln(this,ps).call(this,rr),ln(this,Is).call(this,rr,zt,er),ln(this,Jn)[rr]=At,er){er.set="replace";const ur=dr&&jn(this,Cn,co).call(this,dr)?dr.__staleWhileFetching:dr;ur!==void 0&&(er.oldValue=ur)}}else er&&(er.set="update")}if(Bt!==0&&!ln(this,Uo)&&jn(this,Cn,Ys).call(this),ln(this,Uo)&&(tr||ln(this,Ns).call(this,rr,Bt,Nt),er&&ln(this,Zo).call(this,er,rr)),!jt&&ln(this,Po)&&ln(this,wo)){const dr=ln(this,wo);let ur;for(;ur=dr==null?void 0:dr.shift();)(ar=ln(this,Bo))==null||ar.call(this,...ur)}return this}pop(){var e;try{for(;ln(this,fo);){const At=ln(this,Jn)[ln(this,Eo)];if(jn(this,Cn,Gs).call(this,!0),jn(this,Cn,co).call(this,At)){if(At.__staleWhileFetching)return At.__staleWhileFetching}else if(At!==void 0)return At}}finally{if(ln(this,Po)&&ln(this,wo)){const At=ln(this,wo);let kt;for(;kt=At==null?void 0:At.shift();)(e=ln(this,Bo))==null||e.call(this,...kt)}}}has(e,At={}){const{updateAgeOnHas:kt=this.updateAgeOnHas,status:Bt}=At,Nt=ln(this,ho).get(e);if(Nt!==void 0){const jt=ln(this,Jn)[Nt];if(jn(this,Cn,co).call(this,jt)&&jt.__staleWhileFetching===void 0)return!1;if(ln(this,Oo).call(this,Nt))Bt&&(Bt.has="stale",ln(this,Zo).call(this,Bt,Nt));else return kt&&ln(this,hs).call(this,Nt),Bt&&(Bt.has="hit",ln(this,Zo).call(this,Bt,Nt)),!0}else Bt&&(Bt.has="miss");return!1}peek(e,At={}){const{allowStale:kt=this.allowStale}=At,Bt=ln(this,ho).get(e);if(Bt!==void 0&&(kt||!ln(this,Oo).call(this,Bt))){const Nt=ln(this,Jn)[Bt];return jn(this,Cn,co).call(this,Nt)?Nt.__staleWhileFetching:Nt}}async fetch(e,At={}){const{allowStale:kt=this.allowStale,updateAgeOnGet:Bt=this.updateAgeOnGet,noDeleteOnStaleGet:Nt=this.noDeleteOnStaleGet,ttl:jt=this.ttl,noDisposeOnSet:Lt=this.noDisposeOnSet,size:er=0,sizeCalculation:tr=this.sizeCalculation,noUpdateTTL:zt=this.noUpdateTTL,noDeleteOnFetchRejection:rr=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:nr=this.allowStaleOnFetchRejection,ignoreFetchAbort:ir=this.ignoreFetchAbort,allowStaleOnFetchAbort:ar=this.allowStaleOnFetchAbort,context:dr,forceRefresh:ur=!1,status:fr,signal:pr}=At;if(!ln(this,ss))return fr&&(fr.fetch="get"),this.get(e,{allowStale:kt,updateAgeOnGet:Bt,noDeleteOnStaleGet:Nt,status:fr});const lr={allowStale:kt,updateAgeOnGet:Bt,noDeleteOnStaleGet:Nt,ttl:jt,noDisposeOnSet:Lt,size:er,sizeCalculation:tr,noUpdateTTL:zt,noDeleteOnFetchRejection:rr,allowStaleOnFetchRejection:nr,allowStaleOnFetchAbort:ar,ignoreFetchAbort:ir,status:fr,signal:pr};let yr=ln(this,ho).get(e);if(yr===void 0){fr&&(fr.fetch="miss");const br=jn(this,Cn,zs).call(this,e,yr,lr,dr);return br.__returned=br}else{const br=ln(this,Jn)[yr];if(jn(this,Cn,co).call(this,br)){const Hr=kt&&br.__staleWhileFetching!==void 0;return fr&&(fr.fetch="inflight",Hr&&(fr.returnedStale=!0)),Hr?br.__staleWhileFetching:br.__returned=br}const Ar=ln(this,Oo).call(this,yr);if(!ur&&!Ar)return fr&&(fr.fetch="hit"),jn(this,Cn,Ds).call(this,yr),Bt&&ln(this,hs).call(this,yr),fr&&ln(this,Zo).call(this,fr,yr),br;const Pr=jn(this,Cn,zs).call(this,e,yr,lr,dr),Ur=Pr.__staleWhileFetching!==void 0&&kt;return fr&&(fr.fetch=Ar?"stale":"refresh",Ur&&Ar&&(fr.returnedStale=!0)),Ur?Pr.__staleWhileFetching:Pr.__returned=Pr}}get(e,At={}){const{allowStale:kt=this.allowStale,updateAgeOnGet:Bt=this.updateAgeOnGet,noDeleteOnStaleGet:Nt=this.noDeleteOnStaleGet,status:jt}=At,Lt=ln(this,ho).get(e);if(Lt!==void 0){const er=ln(this,Jn)[Lt],tr=jn(this,Cn,co).call(this,er);return jt&&ln(this,Zo).call(this,jt,Lt),ln(this,Oo).call(this,Lt)?(jt&&(jt.get="stale"),tr?(jt&&kt&&er.__staleWhileFetching!==void 0&&(jt.returnedStale=!0),kt?er.__staleWhileFetching:void 0):(Nt||this.delete(e),jt&&kt&&(jt.returnedStale=!0),kt?er:void 0)):(jt&&(jt.get="hit"),tr?er.__staleWhileFetching:(jn(this,Cn,Ds).call(this,Lt),Bt&&ln(this,hs).call(this,Lt),er))}else jt&&(jt.get="miss")}delete(e){var kt,Bt,Nt,jt;let At=!1;if(ln(this,fo)!==0){const Lt=ln(this,ho).get(e);if(Lt!==void 0)if(At=!0,ln(this,fo)===1)this.clear();else{ln(this,ps).call(this,Lt);const er=ln(this,Jn)[Lt];jn(this,Cn,co).call(this,er)?er.__abortController.abort(new Error("deleted")):(ln(this,Ho)||ln(this,Po))&&(ln(this,Ho)&&((kt=ln(this,qo))==null||kt.call(this,er,e,"delete")),ln(this,Po)&&((Bt=ln(this,wo))==null||Bt.push([er,e,"delete"]))),ln(this,ho).delete(e),ln(this,ao)[Lt]=void 0,ln(this,Jn)[Lt]=void 0,Lt===ln(this,go)?Gn(this,go,ln(this,Co)[Lt]):Lt===ln(this,Eo)?Gn(this,Eo,ln(this,xo)[Lt]):(ln(this,xo)[ln(this,Co)[Lt]]=ln(this,xo)[Lt],ln(this,Co)[ln(this,xo)[Lt]]=ln(this,Co)[Lt]),Fs(this,fo)._--,ln(this,jo).push(Lt)}}if(ln(this,Po)&&((Nt=ln(this,wo))!=null&&Nt.length)){const Lt=ln(this,wo);let er;for(;er=Lt==null?void 0:Lt.shift();)(jt=ln(this,Bo))==null||jt.call(this,...er)}return At}clear(){var e,At,kt;for(const Bt of jn(this,Cn,es).call(this,{allowStale:!0})){const Nt=ln(this,Jn)[Bt];if(jn(this,Cn,co).call(this,Nt))Nt.__abortController.abort(new Error("deleted"));else{const jt=ln(this,ao)[Bt];ln(this,Ho)&&((e=ln(this,qo))==null||e.call(this,Nt,jt,"delete")),ln(this,Po)&&((At=ln(this,wo))==null||At.push([Nt,jt,"delete"]))}}if(ln(this,ho).clear(),ln(this,Jn).fill(void 0),ln(this,ao).fill(void 0),ln(this,Uo)&&ln(this,Yo)&&(ln(this,Uo).fill(0),ln(this,Yo).fill(0)),ln(this,Jo)&&ln(this,Jo).fill(0),Gn(this,Eo,0),Gn(this,go,0),ln(this,jo).length=0,Gn(this,No,0),Gn(this,fo,0),ln(this,Po)&&ln(this,wo)){const Bt=ln(this,wo);let Nt;for(;Nt=Bt==null?void 0:Bt.shift();)(kt=ln(this,Bo))==null||kt.call(this,...Nt)}}};Mo=new WeakMap,ko=new WeakMap,qo=new WeakMap,Bo=new WeakMap,xs=new WeakMap,fo=new WeakMap,No=new WeakMap,ho=new WeakMap,ao=new WeakMap,Jn=new WeakMap,xo=new WeakMap,Co=new WeakMap,Eo=new WeakMap,go=new WeakMap,jo=new WeakMap,wo=new WeakMap,Jo=new WeakMap,Yo=new WeakMap,Uo=new WeakMap,Ho=new WeakMap,ss=new WeakMap,Po=new WeakMap,Cn=new WeakSet,Ys=function(){const e=new ZeroArray(ln(this,Mo)),At=new ZeroArray(ln(this,Mo));Gn(this,Uo,e),Gn(this,Yo,At),Gn(this,Ns,(Nt,jt,Lt=perf$1.now())=>{if(At[Nt]=jt!==0?Lt:0,e[Nt]=jt,jt!==0&&this.ttlAutopurge){const er=setTimeout(()=>{ln(this,Oo).call(this,Nt)&&this.delete(ln(this,ao)[Nt])},jt+1);er.unref&&er.unref()}}),Gn(this,hs,Nt=>{At[Nt]=e[Nt]!==0?perf$1.now():0}),Gn(this,Zo,(Nt,jt)=>{if(e[jt]){const Lt=e[jt],er=At[jt];Nt.ttl=Lt,Nt.start=er,Nt.now=kt||Bt();const tr=Nt.now-er;Nt.remainingTTL=Lt-tr}});let kt=0;const Bt=()=>{const Nt=perf$1.now();if(this.ttlResolution>0){kt=Nt;const jt=setTimeout(()=>kt=0,this.ttlResolution);jt.unref&&jt.unref()}return Nt};this.getRemainingTTL=Nt=>{const jt=ln(this,ho).get(Nt);if(jt===void 0)return 0;const Lt=e[jt],er=At[jt];if(Lt===0||er===0)return 1/0;const tr=(kt||Bt())-er;return Lt-tr},Gn(this,Oo,Nt=>e[Nt]!==0&&At[Nt]!==0&&(kt||Bt())-At[Nt]>e[Nt])},hs=new WeakMap,Zo=new WeakMap,Ns=new WeakMap,Oo=new WeakMap,yl=function(){const e=new ZeroArray(ln(this,Mo));Gn(this,No,0),Gn(this,Jo,e),Gn(this,ps,At=>{Gn(this,No,ln(this,No)-e[At]),e[At]=0}),Gn(this,js,(At,kt,Bt,Nt)=>{if(jn(this,Cn,co).call(this,kt))return 0;if(!isPosInt$1(Bt))if(Nt){if(typeof Nt!="function")throw new TypeError("sizeCalculation must be a function");if(Bt=Nt(kt,At),!isPosInt$1(Bt))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return Bt}),Gn(this,Is,(At,kt,Bt)=>{if(e[At]=kt,ln(this,ko)){const Nt=ln(this,ko)-e[At];for(;ln(this,No)>Nt;)jn(this,Cn,Gs).call(this,!0)}Gn(this,No,ln(this,No)+e[At]),Bt&&(Bt.entrySize=kt,Bt.totalCalculatedSize=ln(this,No))})},ps=new WeakMap,Is=new WeakMap,js=new WeakMap,Xo=function*({allowStale:e=this.allowStale}={}){if(ln(this,fo))for(let At=ln(this,go);!(!jn(this,Cn,Zs).call(this,At)||((e||!ln(this,Oo).call(this,At))&&(yield At),At===ln(this,Eo)));)At=ln(this,Co)[At]},es=function*({allowStale:e=this.allowStale}={}){if(ln(this,fo))for(let At=ln(this,Eo);!(!jn(this,Cn,Zs).call(this,At)||((e||!ln(this,Oo).call(this,At))&&(yield At),At===ln(this,go)));)At=ln(this,xo)[At]},Zs=function(e){return e!==void 0&&ln(this,ho).get(ln(this,ao)[e])===e},Gs=function(e){var Nt,jt;const At=ln(this,Eo),kt=ln(this,ao)[At],Bt=ln(this,Jn)[At];return ln(this,ss)&&jn(this,Cn,co).call(this,Bt)?Bt.__abortController.abort(new Error("evicted")):(ln(this,Ho)||ln(this,Po))&&(ln(this,Ho)&&((Nt=ln(this,qo))==null||Nt.call(this,Bt,kt,"evict")),ln(this,Po)&&((jt=ln(this,wo))==null||jt.push([Bt,kt,"evict"]))),ln(this,ps).call(this,At),e&&(ln(this,ao)[At]=void 0,ln(this,Jn)[At]=void 0,ln(this,jo).push(At)),ln(this,fo)===1?(Gn(this,Eo,Gn(this,go,0)),ln(this,jo).length=0):Gn(this,Eo,ln(this,xo)[At]),ln(this,ho).delete(kt),Fs(this,fo)._--,At},zs=function(e,At,kt,Bt){const Nt=At===void 0?void 0:ln(this,Jn)[At];if(jn(this,Cn,co).call(this,Nt))return Nt;const jt=new AC,{signal:Lt}=kt;Lt==null||Lt.addEventListener("abort",()=>jt.abort(Lt.reason),{signal:jt.signal});const er={signal:jt.signal,options:kt,context:Bt},tr=(dr,ur=!1)=>{const{aborted:fr}=jt.signal,pr=kt.ignoreFetchAbort&&dr!==void 0;if(kt.status&&(fr&&!ur?(kt.status.fetchAborted=!0,kt.status.fetchError=jt.signal.reason,pr&&(kt.status.fetchAbortIgnored=!0)):kt.status.fetchResolved=!0),fr&&!pr&&!ur)return rr(jt.signal.reason);const lr=ir;return ln(this,Jn)[At]===ir&&(dr===void 0?lr.__staleWhileFetching?ln(this,Jn)[At]=lr.__staleWhileFetching:this.delete(e):(kt.status&&(kt.status.fetchUpdated=!0),this.set(e,dr,er.options))),dr},zt=dr=>(kt.status&&(kt.status.fetchRejected=!0,kt.status.fetchError=dr),rr(dr)),rr=dr=>{const{aborted:ur}=jt.signal,fr=ur&&kt.allowStaleOnFetchAbort,pr=fr||kt.allowStaleOnFetchRejection,lr=pr||kt.noDeleteOnFetchRejection,yr=ir;if(ln(this,Jn)[At]===ir&&(!lr||yr.__staleWhileFetching===void 0?this.delete(e):fr||(ln(this,Jn)[At]=yr.__staleWhileFetching)),pr)return kt.status&&yr.__staleWhileFetching!==void 0&&(kt.status.returnedStale=!0),yr.__staleWhileFetching;if(yr.__returned===yr)throw dr},nr=(dr,ur)=>{var pr;const fr=(pr=ln(this,xs))==null?void 0:pr.call(this,e,Nt,er);fr&&fr instanceof Promise&&fr.then(lr=>dr(lr),ur),jt.signal.addEventListener("abort",()=>{(!kt.ignoreFetchAbort||kt.allowStaleOnFetchAbort)&&(dr(),kt.allowStaleOnFetchAbort&&(dr=lr=>tr(lr,!0)))})};kt.status&&(kt.status.fetchDispatched=!0);const ir=new Promise(nr).then(tr,zt),ar=Object.assign(ir,{__abortController:jt,__staleWhileFetching:Nt,__returned:void 0});return At===void 0?(this.set(e,ar,{...er.options,status:void 0}),At=ln(this,ho).get(e)):ln(this,Jn)[At]=ar,ar},co=function(e){if(!ln(this,ss))return!1;const At=e;return!!At&&At instanceof Promise&&At.hasOwnProperty("__staleWhileFetching")&&At.__abortController instanceof AC},Qs=function(e,At){ln(this,Co)[At]=e,ln(this,xo)[e]=At},Ds=function(e){e!==ln(this,go)&&(e===ln(this,Eo)?Gn(this,Eo,ln(this,xo)[e]):jn(this,Cn,Qs).call(this,ln(this,Co)[e],ln(this,xo)[e]),jn(this,Cn,Qs).call(this,ln(this,go),e),Gn(this,go,e))};let LRUCache=ga;var __awaiter$3g=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class MemoryCache{constructor(e){this.timeToLiveInSeconds=e,this.cache=new LRUCache({max:1e5,ttl:e*1e3})}set(e,At){return __awaiter$3g(this,void 0,void 0,function*(){try{this.cache.set(e,At)}catch{}})}get(e){return __awaiter$3g(this,void 0,void 0,function*(){return this.cache.get(e)})}}const Authorization=validate20,pattern4=new RegExp("^[A-Za-z0-9_-]+$","u");function validate21(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate21.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),xt&&typeof xt=="object"&&!Array.isArray(xt)){for(const nr in xt)if(!(nr==="payload"||nr==="signatures"))return validate21.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:nr},message:"must NOT have additional properties"}],!1;{if(xt.payload!==void 0){let nr=xt.payload;const ir=Lt;if(typeof nr=="string"){if(!pattern4.test(nr))return validate21.errors=[{instancePath:e+"/payload",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate21.errors=[{instancePath:e+"/payload",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=ir===Lt}else var tr=!0;if(tr)if(xt.signatures!==void 0){let nr=xt.signatures;const ir=Lt;if(Array.isArray(nr)){if(nr.length<1)return validate21.errors=[{instancePath:e+"/signatures",schemaPath:"#/properties/signatures/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var zt=!0;const dr=nr.length;for(let ur=0;ur<dr;ur++){let fr=nr[ur];const pr=Lt;if(fr&&typeof fr=="object"&&!Array.isArray(fr)){if(fr.protected!==void 0){let yr=fr.protected;const br=Lt;if(typeof yr=="string"){if(!pattern4.test(yr))return validate21.errors=[{instancePath:e+"/signatures/"+ur+"/protected",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate21.errors=[{instancePath:e+"/signatures/"+ur+"/protected",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var rr=br===Lt}else var rr=!0;if(rr)if(fr.signature!==void 0){let yr=fr.signature;const br=Lt;if(typeof yr=="string"){if(!pattern4.test(yr))return validate21.errors=[{instancePath:e+"/signatures/"+ur+"/signature",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate21.errors=[{instancePath:e+"/signatures/"+ur+"/signature",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var rr=br===Lt}else var rr=!0}else return validate21.errors=[{instancePath:e+"/signatures/"+ur,schemaPath:"#/properties/signatures/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=pr===Lt;if(!zt)break}}}else return validate21.errors=[{instancePath:e+"/signatures",schemaPath:"#/properties/signatures/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var tr=ir===Lt}else var tr=!0}}else return validate21.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate21.errors=jt,Lt===0}validate21.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function validate20(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate20.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){const tr=Lt;for(const zt in xt)if(zt!=="signature")return validate20.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:zt},message:"must NOT have additional properties"}],!1;tr===Lt&&xt.signature!==void 0&&(validate21(xt.signature,{instancePath:e+"/signature",parentData:xt,parentDataProperty:"signature",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate21.errors:jt.concat(validate21.errors),Lt=jt.length))}else return validate20.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate20.errors=jt,Lt===0}validate20.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const AuthorizationDelegatedGrant=validate24,schema39={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-write-unidentified.json",type:"object",required:["descriptor"],properties:{recordId:{type:"string"},contextId:{type:"string",pattern:"^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$"},attestation:{$ref:"https://identity.foundation/dwn/json-schemas/general-jws.json"},authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-owner.json"},encryption:{type:"object",properties:{algorithm:{type:"string",enum:["A256CTR"]},initializationVector:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"},keyEncryption:{type:"array",minItems:1,items:{type:"object",properties:{rootKeyId:{type:"string"},derivationScheme:{type:"string",enum:["dataFormats","protocolContext","protocolPath","schemas"]},derivedPublicKey:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"},algorithm:{type:"string",enum:["ECIES-ES256K"]},encryptedKey:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"},initializationVector:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"},ephemeralPublicKey:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"},messageAuthenticationCode:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url"}},additionalProperties:!1,required:["rootKeyId","derivationScheme","algorithm","encryptedKey","initializationVector","ephemeralPublicKey","messageAuthenticationCode"]}}},additionalProperties:!1,required:["algorithm","initializationVector","keyEncryption"]},descriptor:{type:"object",properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Write"],type:"string"},recipient:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},protocol:{type:"string"},protocolPath:{type:"string",pattern:"^[a-zA-Z]+(/[a-zA-Z]+)*$"},schema:{type:"string"},tags:{type:"object",minProperties:1,maxProperties:10,additionalProperties:{oneOf:[{type:"string"},{type:"number"},{type:"boolean"},{type:"array",minItems:1,maxItems:10,items:{type:"string"}},{type:"array",minItems:1,maxItems:10,items:{type:"number"}}]}},parentId:{type:"string"},dataCid:{type:"string"},dataSize:{type:"number"},dateCreated:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},published:{type:"boolean"},datePublished:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},dataFormat:{type:"string"}},additionalProperties:!1,required:["interface","method","dataCid","dataSize","dateCreated","messageTimestamp","dataFormat"],dependencies:{parentId:["protocol"]},allOf:[{$comment:"rule defining `published` and `datePublished` relationship",anyOf:[{properties:{published:{type:"boolean",enum:[!0]}},required:["published","datePublished"]},{properties:{published:{type:"boolean",enum:[!1]}},not:{required:["datePublished"]}},{allOf:[{not:{required:["published"]}},{not:{required:["datePublished"]}}]}]}]}},$comment:"rule defining `protocol` and `contextId` relationship",anyOf:[{properties:{descriptor:{type:"object",required:["protocol","protocolPath"]}},required:["contextId"]},{allOf:[{not:{required:["contextId"]}},{properties:{descriptor:{type:"object",not:{required:["protocol"]}}}},{properties:{descriptor:{type:"object",not:{required:["protocolPath"]}}}}]}]},pattern7=new RegExp("^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$","u"),pattern12=new RegExp("^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$","u"),pattern13=new RegExp("^[a-zA-Z]+(/[a-zA-Z]+)*$","u"),pattern14=new RegExp("^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$","u"),wrapper0={validate:validate26};function validate29(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate29.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){const zt=Lt;for(const rr in xt)if(!(rr==="signature"||rr==="authorDelegatedGrant"||rr==="ownerSignature"||rr==="ownerDelegatedGrant"))return validate29.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:rr},message:"must NOT have additional properties"}],!1;if(zt===Lt){let rr;if(xt.ownerSignature!==void 0&&xt.signature===void 0&&(rr="signature"))return validate29.errors=[{instancePath:e,schemaPath:"#/dependencies",keyword:"dependencies",params:{property:"ownerSignature",missingProperty:rr,depsCount:1,deps:"signature"},message:"must have property signature when property ownerSignature is present"}],!1;if(xt.signature!==void 0){const nr=Lt;validate21(xt.signature,{instancePath:e+"/signature",parentData:xt,parentDataProperty:"signature",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate21.errors:jt.concat(validate21.errors),Lt=jt.length);var tr=nr===Lt}else var tr=!0;if(tr){if(xt.authorDelegatedGrant!==void 0){const nr=Lt;wrapper0.validate(xt.authorDelegatedGrant,{instancePath:e+"/authorDelegatedGrant",parentData:xt,parentDataProperty:"authorDelegatedGrant",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?wrapper0.validate.errors:jt.concat(wrapper0.validate.errors),Lt=jt.length);var tr=nr===Lt}else var tr=!0;if(tr){if(xt.ownerSignature!==void 0){const nr=Lt;validate21(xt.ownerSignature,{instancePath:e+"/ownerSignature",parentData:xt,parentDataProperty:"ownerSignature",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate21.errors:jt.concat(validate21.errors),Lt=jt.length);var tr=nr===Lt}else var tr=!0;if(tr)if(xt.ownerDelegatedGrant!==void 0){const nr=Lt;wrapper0.validate(xt.ownerDelegatedGrant,{instancePath:e+"/ownerDelegatedGrant",parentData:xt,parentDataProperty:"ownerDelegatedGrant",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?wrapper0.validate.errors:jt.concat(wrapper0.validate.errors),Lt=jt.length);var tr=nr===Lt}else var tr=!0}}}}else return validate29.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate29.errors=jt,Lt===0}validate29.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const schema43={$id:"https://identity.foundation/dwn/json-schemas/general-jwk.json",$schema:"https://json-schema.org/draft/2020-12/schema",type:"object",required:["kty"],properties:{alg:{type:"string"},kid:{type:"string"},kty:{enum:["EC","RSA","oct","OKP"]},crv:{type:"string"},use:{type:"string"},key_ops:{type:"string"},x5u:{type:"string"},x5c:{type:"string"},x5t:{type:"string"},"x5t#S256":{type:"string"}},oneOf:[{properties:{kty:{const:"EC"},crv:{type:"string"},x:{type:"string"},y:{type:"string"},d:{type:"string"}},required:["crv","x"]},{properties:{kty:{const:"OKP"},crv:{type:"string"},x:{type:"string"},d:{type:"string"}},required:["crv","x"]},{properties:{kty:{const:"RSA"},n:{type:"string"},e:{type:"string"},d:{type:"string"},p:{type:"string"},q:{type:"string"},dp:{type:"string"},dq:{type:"string"},qi:{type:"string"},oth:{type:"object"}},required:["n","e"]},{properties:{kty:{const:"oct"},k:{type:"string"}},required:["k"]}]};function validate33(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate33.evaluated;er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0);const tr=Lt,zt=Lt;let rr=!1,nr=null;const ir=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let gr;if(xt.crv===void 0&&(gr="crv")||xt.x===void 0&&(gr="x")){const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/required",keyword:"required",params:{missingProperty:gr},message:"must have required property '"+gr+"'"};jt===null?jt=[wr]:jt.push(wr),Lt++}else{if(xt.kty!==void 0){const wr=Lt;if(xt.kty!=="EC"){const Dr={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/kty/const",keyword:"const",params:{allowedValue:"EC"},message:"must be equal to constant"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}var ar=wr===Lt}else var ar=!0;if(ar){if(xt.crv!==void 0){const wr=Lt;if(typeof xt.crv!="string"){const xr={instancePath:e+"/crv",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[xr]:jt.push(xr),Lt++}var ar=wr===Lt}else var ar=!0;if(ar){if(xt.x!==void 0){const wr=Lt;if(typeof xt.x!="string"){const xr={instancePath:e+"/x",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[xr]:jt.push(xr),Lt++}var ar=wr===Lt}else var ar=!0;if(ar){if(xt.y!==void 0){const wr=Lt;if(typeof xt.y!="string"){const xr={instancePath:e+"/y",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/y/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[xr]:jt.push(xr),Lt++}var ar=wr===Lt}else var ar=!0;if(ar)if(xt.d!==void 0){const wr=Lt;if(typeof xt.d!="string"){const xr={instancePath:e+"/d",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/0/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[xr]:jt.push(xr),Lt++}var ar=wr===Lt}else var ar=!0}}}}}var pr=ir===Lt;if(pr){rr=!0,nr=0;var dr={};dr.kty=!0,dr.crv=!0,dr.x=!0,dr.y=!0,dr.d=!0}const ur=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let gr;if(xt.crv===void 0&&(gr="crv")||xt.x===void 0&&(gr="x")){const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/required",keyword:"required",params:{missingProperty:gr},message:"must have required property '"+gr+"'"};jt===null?jt=[wr]:jt.push(wr),Lt++}else{if(xt.kty!==void 0){const wr=Lt;if(xt.kty!=="OKP"){const Dr={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/kty/const",keyword:"const",params:{allowedValue:"OKP"},message:"must be equal to constant"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}var fr=wr===Lt}else var fr=!0;if(fr){if(xt.crv!==void 0){const wr=Lt;if(typeof xt.crv!="string"){const xr={instancePath:e+"/crv",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[xr]:jt.push(xr),Lt++}var fr=wr===Lt}else var fr=!0;if(fr){if(xt.x!==void 0){const wr=Lt;if(typeof xt.x!="string"){const xr={instancePath:e+"/x",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[xr]:jt.push(xr),Lt++}var fr=wr===Lt}else var fr=!0;if(fr)if(xt.d!==void 0){const wr=Lt;if(typeof xt.d!="string"){const xr={instancePath:e+"/d",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/1/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[xr]:jt.push(xr),Lt++}var fr=wr===Lt}else var fr=!0}}}}var pr=ur===Lt;if(pr&&rr)rr=!1,nr=[nr,1];else{pr&&(rr=!0,nr=1,dr!==!0&&(dr=dr||{},dr.kty=!0,dr.crv=!0,dr.x=!0,dr.d=!0));const gr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Dr;if(xt.n===void 0&&(Dr="n")||xt.e===void 0&&(Dr="e")){const xr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/required",keyword:"required",params:{missingProperty:Dr},message:"must have required property '"+Dr+"'"};jt===null?jt=[xr]:jt.push(xr),Lt++}else{if(xt.kty!==void 0){const xr=Lt;if(xt.kty!=="RSA"){const Ir={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/kty/const",keyword:"const",params:{allowedValue:"RSA"},message:"must be equal to constant"};jt===null?jt=[Ir]:jt.push(Ir),Lt++}var lr=xr===Lt}else var lr=!0;if(lr){if(xt.n!==void 0){const xr=Lt;if(typeof xt.n!="string"){const $r={instancePath:e+"/n",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/n/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[$r]:jt.push($r),Lt++}var lr=xr===Lt}else var lr=!0;if(lr){if(xt.e!==void 0){const xr=Lt;if(typeof xt.e!="string"){const $r={instancePath:e+"/e",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/e/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[$r]:jt.push($r),Lt++}var lr=xr===Lt}else var lr=!0;if(lr){if(xt.d!==void 0){const xr=Lt;if(typeof xt.d!="string"){const $r={instancePath:e+"/d",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[$r]:jt.push($r),Lt++}var lr=xr===Lt}else var lr=!0;if(lr){if(xt.p!==void 0){const xr=Lt;if(typeof xt.p!="string"){const $r={instancePath:e+"/p",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/p/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[$r]:jt.push($r),Lt++}var lr=xr===Lt}else var lr=!0;if(lr){if(xt.q!==void 0){const xr=Lt;if(typeof xt.q!="string"){const $r={instancePath:e+"/q",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/q/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[$r]:jt.push($r),Lt++}var lr=xr===Lt}else var lr=!0;if(lr){if(xt.dp!==void 0){const xr=Lt;if(typeof xt.dp!="string"){const $r={instancePath:e+"/dp",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/dp/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[$r]:jt.push($r),Lt++}var lr=xr===Lt}else var lr=!0;if(lr){if(xt.dq!==void 0){const xr=Lt;if(typeof xt.dq!="string"){const $r={instancePath:e+"/dq",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/dq/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[$r]:jt.push($r),Lt++}var lr=xr===Lt}else var lr=!0;if(lr){if(xt.qi!==void 0){const xr=Lt;if(typeof xt.qi!="string"){const $r={instancePath:e+"/qi",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/qi/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[$r]:jt.push($r),Lt++}var lr=xr===Lt}else var lr=!0;if(lr)if(xt.oth!==void 0){let xr=xt.oth;const Ir=Lt;if(!(xr&&typeof xr=="object"&&!Array.isArray(xr))){const vr={instancePath:e+"/oth",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/2/properties/oth/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[vr]:jt.push(vr),Lt++}var lr=Ir===Lt}else var lr=!0}}}}}}}}}}var pr=gr===Lt;if(pr&&rr)rr=!1,nr=[nr,2];else{pr&&(rr=!0,nr=2,dr!==!0&&(dr=dr||{},dr.kty=!0,dr.n=!0,dr.e=!0,dr.d=!0,dr.p=!0,dr.q=!0,dr.dp=!0,dr.dq=!0,dr.qi=!0,dr.oth=!0));const Dr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Ir;if(xt.k===void 0&&(Ir="k")){const $r={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/3/required",keyword:"required",params:{missingProperty:Ir},message:"must have required property '"+Ir+"'"};jt===null?jt=[$r]:jt.push($r),Lt++}else{if(xt.kty!==void 0){const $r=Lt;if(xt.kty!=="oct"){const vr={instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/3/properties/kty/const",keyword:"const",params:{allowedValue:"oct"},message:"must be equal to constant"};jt===null?jt=[vr]:jt.push(vr),Lt++}var yr=$r===Lt}else var yr=!0;if(yr)if(xt.k!==void 0){const $r=Lt;if(typeof xt.k!="string"){const Er={instancePath:e+"/k",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf/3/properties/k/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Er]:jt.push(Er),Lt++}var yr=$r===Lt}else var yr=!0}}var pr=Dr===Lt;pr&&rr?(rr=!1,nr=[nr,3]):pr&&(rr=!0,nr=3,dr!==!0&&(dr=dr||{},dr.kty=!0,dr.k=!0))}}if(rr)Lt=zt,jt!==null&&(zt?jt.length=zt:jt=null);else{const gr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/oneOf",keyword:"oneOf",params:{passingSchemas:nr},message:"must match exactly one schema in oneOf"};return jt===null?jt=[gr]:jt.push(gr),Lt++,validate33.errors=jt,!1}if(Lt===tr)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let gr;if(xt.kty===void 0&&(gr="kty"))return validate33.errors=[{instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/required",keyword:"required",params:{missingProperty:gr},message:"must have required property '"+gr+"'"}],!1;if(dr!==!0&&(dr=dr||{},dr.alg=!0,dr.kid=!0,dr.kty=!0,dr.crv=!0,dr.use=!0,dr.key_ops=!0,dr.x5u=!0,dr.x5c=!0,dr.x5t=!0,dr["x5t#S256"]=!0),xt.alg!==void 0){const wr=Lt;if(typeof xt.alg!="string")return validate33.errors=[{instancePath:e+"/alg",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/alg/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=wr===Lt}else var br=!0;if(br){if(xt.kid!==void 0){const wr=Lt;if(typeof xt.kid!="string")return validate33.errors=[{instancePath:e+"/kid",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/kid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=wr===Lt}else var br=!0;if(br){if(xt.kty!==void 0){let wr=xt.kty;const Dr=Lt;if(!(wr==="EC"||wr==="RSA"||wr==="oct"||wr==="OKP"))return validate33.errors=[{instancePath:e+"/kty",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/kty/enum",keyword:"enum",params:{allowedValues:schema43.properties.kty.enum},message:"must be equal to one of the allowed values"}],!1;var br=Dr===Lt}else var br=!0;if(br){if(xt.crv!==void 0){const wr=Lt;if(typeof xt.crv!="string")return validate33.errors=[{instancePath:e+"/crv",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=wr===Lt}else var br=!0;if(br){if(xt.use!==void 0){const wr=Lt;if(typeof xt.use!="string")return validate33.errors=[{instancePath:e+"/use",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/use/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=wr===Lt}else var br=!0;if(br){if(xt.key_ops!==void 0){const wr=Lt;if(typeof xt.key_ops!="string")return validate33.errors=[{instancePath:e+"/key_ops",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/key_ops/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=wr===Lt}else var br=!0;if(br){if(xt.x5u!==void 0){const wr=Lt;if(typeof xt.x5u!="string")return validate33.errors=[{instancePath:e+"/x5u",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5u/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=wr===Lt}else var br=!0;if(br){if(xt.x5c!==void 0){const wr=Lt;if(typeof xt.x5c!="string")return validate33.errors=[{instancePath:e+"/x5c",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5c/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=wr===Lt}else var br=!0;if(br){if(xt.x5t!==void 0){const wr=Lt;if(typeof xt.x5t!="string")return validate33.errors=[{instancePath:e+"/x5t",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5t/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=wr===Lt}else var br=!0;if(br)if(xt["x5t#S256"]!==void 0){const wr=Lt;if(typeof xt["x5t#S256"]!="string")return validate33.errors=[{instancePath:e+"/x5t#S256",schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/properties/x5t%23S256/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var br=wr===Lt}else var br=!0}}}}}}}}}else return validate33.errors=[{instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/general-jwk.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Ar=tr===Lt;if(Ar){const gr=Lt,wr=Lt,Dr=Lt;let xr=!1;const Ir=Lt,$r=Lt;let vr=!1;const Er=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.d===void 0){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Pr=Er===Lt;if(vr=vr||Pr,vr)Lt=$r,jt!==null&&($r?jt.length=$r:jt=null);else{const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}if(Lt===Ir)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){if(xt.kty!==void 0&&xt.kty!=="EC"){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}}else{const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Sr=Ir===Lt;if(xr=xr||Sr,Sr){var kr={};kr.kty=!0}const Tr=Lt,Rr=Lt;let Mr=!1;const Gr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.d===void 0){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Ur=Gr===Lt;if(Mr=Mr||Ur,Mr)Lt=Rr,jt!==null&&(Rr?jt.length=Rr:jt=null);else{const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}if(Lt===Tr)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){if(xt.kty!==void 0&&xt.kty!=="OKP"){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}}else{const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Sr=Tr===Lt;xr=xr||Sr,Sr&&kr!==!0&&(kr=kr||{},kr.kty=!0);const Br=Lt,Cr=Lt;let jr=!1;const Yr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.d===void 0){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Hr=Yr===Lt;jr=jr||Hr;const Qr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.p===void 0){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Hr=Qr===Lt;jr=jr||Hr;const Jr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.q===void 0){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Hr=Jr===Lt;jr=jr||Hr;const Wr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.dp===void 0){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Hr=Wr===Lt;jr=jr||Hr;const Nr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.dq===void 0){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Hr=Nr===Lt;jr=jr||Hr;const Vr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.qi===void 0){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Hr=Vr===Lt;jr=jr||Hr;const Xr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.oth===void 0){const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Hr=Xr===Lt;if(jr=jr||Hr,jr)Lt=Cr,jt!==null&&(Cr?jt.length=Cr:jt=null);else{const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}if(Lt===Br)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){if(xt.kty!==void 0){const qr=Lt;if(xt.kty!=="RSA"){const Or={};jt===null?jt=[Or]:jt.push(Or),Lt++}var Lr=qr===Lt}else var Lr=!0;if(Lr)if(xt.oth!==void 0){let qr=xt.oth;const Or=Lt;if(!(qr&&typeof qr=="object"&&!Array.isArray(qr))){const Zr={};jt===null?jt=[Zr]:jt.push(Zr),Lt++}var Lr=Or===Lt}else var Lr=!0}else{const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var Sr=Br===Lt;if(xr=xr||Sr,Sr&&kr!==!0&&(kr=kr||{},kr.kty=!0,kr.d=!0,kr.p=!0,kr.q=!0,kr.dp=!0,kr.dq=!0,kr.qi=!0,kr.oth=!0),xr)Lt=Dr,jt!==null&&(Dr?jt.length=Dr:jt=null);else{const qr={};jt===null?jt=[qr]:jt.push(qr),Lt++}var _r=wr===Lt;if(_r)return validate33.errors=[{instancePath:e,schemaPath:"#/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=gr,jt!==null&&(gr?jt.length=gr:jt=null)}return validate33.errors=jt,er.props=dr,Lt===0}validate33.evaluated={dynamicProps:!0,dynamicItems:!1};const func1=Object.prototype.hasOwnProperty;function validate27(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate27.evaluated;er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0);const tr=Lt;let zt=!1;const rr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Er;if(xt.contextId===void 0&&(Er="contextId")){const Tr={instancePath:e,schemaPath:"#/anyOf/0/required",keyword:"required",params:{missingProperty:Er},message:"must have required property '"+Er+"'"};jt===null?jt=[Tr]:jt.push(Tr),Lt++}else if(xt.descriptor!==void 0){let Tr=xt.descriptor;if(Lt===Lt)if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)){let Mr;if(Tr.protocol===void 0&&(Mr="protocol")||Tr.protocolPath===void 0&&(Mr="protocolPath")){const Gr={instancePath:e+"/descriptor",schemaPath:"#/anyOf/0/properties/descriptor/required",keyword:"required",params:{missingProperty:Mr},message:"must have required property '"+Mr+"'"};jt===null?jt=[Gr]:jt.push(Gr),Lt++}}else{const Mr={instancePath:e+"/descriptor",schemaPath:"#/anyOf/0/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Mr]:jt.push(Mr),Lt++}}}var br=rr===Lt;if(zt=zt||br,br){var nr={};nr.descriptor=!0}const ir=Lt,ar=Lt,dr=Lt,ur=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.contextId===void 0){const Er={};jt===null?jt=[Er]:jt.push(Er),Lt++}var fr=ur===Lt;if(fr){const Er={instancePath:e,schemaPath:"#/anyOf/1/allOf/0/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[Er]:jt.push(Er),Lt++}else Lt=dr,jt!==null&&(dr?jt.length=dr:jt=null);var pr=ar===Lt;if(pr){const Er=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.descriptor!==void 0){let Rr=xt.descriptor;if(!(Rr&&typeof Rr=="object"&&!Array.isArray(Rr))){const Br={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/1/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Br]:jt.push(Br),Lt++}const Mr=Lt,Gr=Lt;if(Rr&&typeof Rr=="object"&&!Array.isArray(Rr)&&Rr.protocol===void 0){const Br={};jt===null?jt=[Br]:jt.push(Br),Lt++}var lr=Gr===Lt;if(lr){const Br={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/1/properties/descriptor/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[Br]:jt.push(Br),Lt++}else Lt=Mr,jt!==null&&(Mr?jt.length=Mr:jt=null)}var pr=Er===Lt;if(pr){const Rr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.descriptor!==void 0){let Gr=xt.descriptor;if(!(Gr&&typeof Gr=="object"&&!Array.isArray(Gr))){const jr={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/2/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[jr]:jt.push(jr),Lt++}const Br=Lt,Cr=Lt;if(Gr&&typeof Gr=="object"&&!Array.isArray(Gr)&&Gr.protocolPath===void 0){const jr={};jt===null?jt=[jr]:jt.push(jr),Lt++}var yr=Cr===Lt;if(yr){const jr={instancePath:e+"/descriptor",schemaPath:"#/anyOf/1/allOf/2/properties/descriptor/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[jr]:jt.push(jr),Lt++}else Lt=Br,jt!==null&&(Br?jt.length=Br:jt=null)}var pr=Rr===Lt}}var br=ir===Lt;if(zt=zt||br,br&&nr!==!0&&(nr=nr||{},nr.descriptor=!0),zt)Lt=tr,jt!==null&&(tr?jt.length=tr:jt=null);else{const Er={instancePath:e,schemaPath:"#/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return jt===null?jt=[Er]:jt.push(Er),Lt++,validate27.errors=jt,!1}if(Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Er;if(xt.descriptor===void 0&&(Er="descriptor"))return validate27.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:Er},message:"must have required property '"+Er+"'"}],!1;if(nr!==!0&&(nr=nr||{},nr.recordId=!0,nr.contextId=!0,nr.attestation=!0,nr.authorization=!0,nr.encryption=!0,nr.descriptor=!0),xt.recordId!==void 0){const Tr=Lt;if(typeof xt.recordId!="string")return validate27.errors=[{instancePath:e+"/recordId",schemaPath:"#/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Ar=Tr===Lt}else var Ar=!0;if(Ar){if(xt.contextId!==void 0){let Tr=xt.contextId;const Rr=Lt;if(Lt===Rr)if(typeof Tr=="string"){if(!pattern7.test(Tr))return validate27.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/pattern",keyword:"pattern",params:{pattern:"^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$"},message:'must match pattern "^[a-zA-Z0-9]+(/[a-zA-Z0-9]+)*$"'}],!1}else return validate27.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Ar=Rr===Lt}else var Ar=!0;if(Ar){if(xt.attestation!==void 0){const Tr=Lt;validate21(xt.attestation,{instancePath:e+"/attestation",parentData:xt,parentDataProperty:"attestation",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate21.errors:jt.concat(validate21.errors),Lt=jt.length);var Ar=Tr===Lt}else var Ar=!0;if(Ar){if(xt.authorization!==void 0){const Tr=Lt;validate29(xt.authorization,{instancePath:e+"/authorization",parentData:xt,parentDataProperty:"authorization",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate29.errors:jt.concat(validate29.errors),Lt=jt.length);var Ar=Tr===Lt}else var Ar=!0;if(Ar){if(xt.encryption!==void 0){let Tr=xt.encryption;const Rr=Lt;if(Lt===Rr)if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)){let Gr;if(Tr.algorithm===void 0&&(Gr="algorithm")||Tr.initializationVector===void 0&&(Gr="initializationVector")||Tr.keyEncryption===void 0&&(Gr="keyEncryption"))return validate27.errors=[{instancePath:e+"/encryption",schemaPath:"#/properties/encryption/required",keyword:"required",params:{missingProperty:Gr},message:"must have required property '"+Gr+"'"}],!1;{const Br=Lt;for(const Cr in Tr)if(!(Cr==="algorithm"||Cr==="initializationVector"||Cr==="keyEncryption"))return validate27.errors=[{instancePath:e+"/encryption",schemaPath:"#/properties/encryption/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Cr},message:"must NOT have additional properties"}],!1;if(Br===Lt){if(Tr.algorithm!==void 0){let Cr=Tr.algorithm;const jr=Lt;if(typeof Cr!="string")return validate27.errors=[{instancePath:e+"/encryption/algorithm",schemaPath:"#/properties/encryption/properties/algorithm/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Cr!=="A256CTR")return validate27.errors=[{instancePath:e+"/encryption/algorithm",schemaPath:"#/properties/encryption/properties/algorithm/enum",keyword:"enum",params:{allowedValues:schema39.properties.encryption.properties.algorithm.enum},message:"must be equal to one of the allowed values"}],!1;var Pr=jr===Lt}else var Pr=!0;if(Pr){if(Tr.initializationVector!==void 0){let Cr=Tr.initializationVector;const jr=Lt;if(Lt===Lt)if(typeof Cr=="string"){if(!pattern4.test(Cr))return validate27.errors=[{instancePath:e+"/encryption/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate27.errors=[{instancePath:e+"/encryption/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Pr=jr===Lt}else var Pr=!0;if(Pr)if(Tr.keyEncryption!==void 0){let Cr=Tr.keyEncryption;const jr=Lt;if(Lt===jr)if(Array.isArray(Cr)){if(Cr.length<1)return validate27.errors=[{instancePath:e+"/encryption/keyEncryption",schemaPath:"#/properties/encryption/properties/keyEncryption/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var kr=!0;const Qr=Cr.length;for(let Jr=0;Jr<Qr;Jr++){let Wr=Cr[Jr];const Nr=Lt;if(Lt===Nr)if(Wr&&typeof Wr=="object"&&!Array.isArray(Wr)){let Xr;if(Wr.rootKeyId===void 0&&(Xr="rootKeyId")||Wr.derivationScheme===void 0&&(Xr="derivationScheme")||Wr.algorithm===void 0&&(Xr="algorithm")||Wr.encryptedKey===void 0&&(Xr="encryptedKey")||Wr.initializationVector===void 0&&(Xr="initializationVector")||Wr.ephemeralPublicKey===void 0&&(Xr="ephemeralPublicKey")||Wr.messageAuthenticationCode===void 0&&(Xr="messageAuthenticationCode"))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr,schemaPath:"#/properties/encryption/properties/keyEncryption/items/required",keyword:"required",params:{missingProperty:Xr},message:"must have required property '"+Xr+"'"}],!1;{const qr=Lt;for(const Or in Wr)if(!(Or==="rootKeyId"||Or==="derivationScheme"||Or==="derivedPublicKey"||Or==="algorithm"||Or==="encryptedKey"||Or==="initializationVector"||Or==="ephemeralPublicKey"||Or==="messageAuthenticationCode"))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr,schemaPath:"#/properties/encryption/properties/keyEncryption/items/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Or},message:"must NOT have additional properties"}],!1;if(qr===Lt){if(Wr.rootKeyId!==void 0){const Or=Lt;if(typeof Wr.rootKeyId!="string")return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/rootKeyId",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/rootKeyId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Ur=Or===Lt}else var Ur=!0;if(Ur){if(Wr.derivationScheme!==void 0){let Or=Wr.derivationScheme;const Fr=Lt;if(typeof Or!="string")return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/derivationScheme",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/derivationScheme/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(Or==="dataFormats"||Or==="protocolContext"||Or==="protocolPath"||Or==="schemas"))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/derivationScheme",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/derivationScheme/enum",keyword:"enum",params:{allowedValues:schema39.properties.encryption.properties.keyEncryption.items.properties.derivationScheme.enum},message:"must be equal to one of the allowed values"}],!1;var Ur=Fr===Lt}else var Ur=!0;if(Ur){if(Wr.derivedPublicKey!==void 0){const Or=Lt;validate33(Wr.derivedPublicKey,{instancePath:e+"/encryption/keyEncryption/"+Jr+"/derivedPublicKey",parentData:Wr,parentDataProperty:"derivedPublicKey",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate33.errors:jt.concat(validate33.errors),Lt=jt.length);var Ur=Or===Lt}else var Ur=!0;if(Ur){if(Wr.algorithm!==void 0){let Or=Wr.algorithm;const Fr=Lt;if(typeof Or!="string")return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/algorithm",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/algorithm/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Or!=="ECIES-ES256K")return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/algorithm",schemaPath:"#/properties/encryption/properties/keyEncryption/items/properties/algorithm/enum",keyword:"enum",params:{allowedValues:schema39.properties.encryption.properties.keyEncryption.items.properties.algorithm.enum},message:"must be equal to one of the allowed values"}],!1;var Ur=Fr===Lt}else var Ur=!0;if(Ur){if(Wr.encryptedKey!==void 0){let Or=Wr.encryptedKey;const Fr=Lt;if(Lt===Lt)if(typeof Or=="string"){if(!pattern4.test(Or))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/encryptedKey",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/encryptedKey",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Ur=Fr===Lt}else var Ur=!0;if(Ur){if(Wr.initializationVector!==void 0){let Or=Wr.initializationVector;const Fr=Lt;if(Lt===Lt)if(typeof Or=="string"){if(!pattern4.test(Or))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/initializationVector",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Ur=Fr===Lt}else var Ur=!0;if(Ur){if(Wr.ephemeralPublicKey!==void 0){const Or=Lt;validate33(Wr.ephemeralPublicKey,{instancePath:e+"/encryption/keyEncryption/"+Jr+"/ephemeralPublicKey",parentData:Wr,parentDataProperty:"ephemeralPublicKey",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate33.errors:jt.concat(validate33.errors),Lt=jt.length);var Ur=Or===Lt}else var Ur=!0;if(Ur)if(Wr.messageAuthenticationCode!==void 0){let Or=Wr.messageAuthenticationCode;const Fr=Lt;if(Lt===Lt)if(typeof Or=="string"){if(!pattern4.test(Or))return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/messageAuthenticationCode",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/pattern",keyword:"pattern",params:{pattern:"^[A-Za-z0-9_-]+$"},message:'must match pattern "^[A-Za-z0-9_-]+$"'}],!1}else return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr+"/messageAuthenticationCode",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/base64url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Ur=Fr===Lt}else var Ur=!0}}}}}}}}}else return validate27.errors=[{instancePath:e+"/encryption/keyEncryption/"+Jr,schemaPath:"#/properties/encryption/properties/keyEncryption/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var kr=Nr===Lt;if(!kr)break}}}else return validate27.errors=[{instancePath:e+"/encryption/keyEncryption",schemaPath:"#/properties/encryption/properties/keyEncryption/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var Pr=jr===Lt}else var Pr=!0}}}}else return validate27.errors=[{instancePath:e+"/encryption",schemaPath:"#/properties/encryption/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Ar=Rr===Lt}else var Ar=!0;if(Ar)if(xt.descriptor!==void 0){let Tr=xt.descriptor;const Rr=Lt,Mr=Lt;let Gr=!1;const Br=Lt;if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)){let Xr;if(Tr.published===void 0&&(Xr="published")||Tr.datePublished===void 0&&(Xr="datePublished")){const qr={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/0/required",keyword:"required",params:{missingProperty:Xr},message:"must have required property '"+Xr+"'"};jt===null?jt=[qr]:jt.push(qr),Lt++}else if(Tr.published!==void 0){let qr=Tr.published;if(typeof qr!="boolean"){const Or={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/0/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};jt===null?jt=[Or]:jt.push(Or),Lt++}if(qr!==!0){const Or={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/0/properties/published/enum",keyword:"enum",params:{allowedValues:schema39.properties.descriptor.allOf[0].anyOf[0].properties.published.enum},message:"must be equal to one of the allowed values"};jt===null?jt=[Or]:jt.push(Or),Lt++}}}var wr=Br===Lt;if(Gr=Gr||wr,wr){var Hr={};Hr.published=!0}const Cr=Lt,jr=Lt,Yr=Lt;if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)&&Tr.datePublished===void 0){const Xr={};jt===null?jt=[Xr]:jt.push(Xr),Lt++}var Lr=Yr===Lt;if(Lr){const Xr={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/1/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[Xr]:jt.push(Xr),Lt++}else Lt=jr,jt!==null&&(jr?jt.length=jr:jt=null);if(Lt===Cr&&Tr&&typeof Tr=="object"&&!Array.isArray(Tr)&&Tr.published!==void 0){let Xr=Tr.published;if(typeof Xr!="boolean"){const qr={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/1/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};jt===null?jt=[qr]:jt.push(qr),Lt++}if(Xr!==!1){const qr={instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/allOf/0/anyOf/1/properties/published/enum",keyword:"enum",params:{allowedValues:schema39.properties.descriptor.allOf[0].anyOf[1].properties.published.enum},message:"must be equal to one of the allowed values"};jt===null?jt=[qr]:jt.push(qr),Lt++}}var wr=Cr===Lt;Gr=Gr||wr,wr&&Hr!==!0&&(Hr=Hr||{},Hr.published=!0);const Qr=Lt,Jr=Lt,Wr=Lt,Nr=Lt;if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)&&Tr.published===void 0){const Xr={};jt===null?jt=[Xr]:jt.push(Xr),Lt++}var Sr=Nr===Lt;if(Sr){const Xr={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/2/allOf/0/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[Xr]:jt.push(Xr),Lt++}else Lt=Wr,jt!==null&&(Wr?jt.length=Wr:jt=null);var _r=Jr===Lt;if(_r){const Xr=Lt,qr=Lt,Or=Lt;if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)&&Tr.datePublished===void 0){const Zr={};jt===null?jt=[Zr]:jt.push(Zr),Lt++}var gr=Or===Lt;if(gr){const Zr={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf/2/allOf/1/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[Zr]:jt.push(Zr),Lt++}else Lt=qr,jt!==null&&(qr?jt.length=qr:jt=null);var _r=Xr===Lt}var wr=Qr===Lt;if(Gr=Gr||wr,Gr)Lt=Mr,jt!==null&&(Mr?jt.length=Mr:jt=null);else{const Xr={instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/allOf/0/anyOf",keyword:"anyOf",params:{},message:"must match a schema in anyOf"};return jt===null?jt=[Xr]:jt.push(Xr),Lt++,validate27.errors=jt,!1}if(Lt===Rr)if(Tr&&typeof Tr=="object"&&!Array.isArray(Tr)){let Xr;if(Tr.interface===void 0&&(Xr="interface")||Tr.method===void 0&&(Xr="method")||Tr.dataCid===void 0&&(Xr="dataCid")||Tr.dataSize===void 0&&(Xr="dataSize")||Tr.dateCreated===void 0&&(Xr="dateCreated")||Tr.messageTimestamp===void 0&&(Xr="messageTimestamp")||Tr.dataFormat===void 0&&(Xr="dataFormat"))return validate27.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:Xr},message:"must have required property '"+Xr+"'"}],!1;{const qr=Lt;for(const Or in Tr)if(!func1.call(schema39.properties.descriptor.properties,Or))return validate27.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Or},message:"must NOT have additional properties"}],!1;if(qr===Lt){let Or;if(Tr.parentId!==void 0&&Tr.protocol===void 0&&(Or="protocol"))return validate27.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/dependencies",keyword:"dependencies",params:{property:"parentId",missingProperty:Or,depsCount:1,deps:"protocol"},message:"must have property protocol when property parentId is present"}],!1;if(Tr.interface!==void 0){let Fr=Tr.interface;const Zr=Lt;if(typeof Fr!="string")return validate27.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Fr!=="Records")return validate27.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema39.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var Dr=Zr===Lt}else var Dr=!0;if(Dr){if(Tr.method!==void 0){let Fr=Tr.method;const Zr=Lt;if(typeof Fr!="string")return validate27.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(Fr!=="Write")return validate27.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema39.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var Dr=Zr===Lt}else var Dr=!0;if(Dr){if(Tr.recipient!==void 0){let Fr=Tr.recipient;const Zr=Lt;if(Lt===Lt)if(typeof Fr=="string"){if(!pattern12.test(Fr))return validate27.errors=[{instancePath:e+"/descriptor/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return validate27.errors=[{instancePath:e+"/descriptor/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Dr=Zr===Lt}else var Dr=!0;if(Dr){if(Tr.protocol!==void 0){const Fr=Lt;if(typeof Tr.protocol!="string")return validate27.errors=[{instancePath:e+"/descriptor/protocol",schemaPath:"#/properties/descriptor/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Dr=Fr===Lt}else var Dr=!0;if(Dr){if(Tr.protocolPath!==void 0){let Fr=Tr.protocolPath;const Zr=Lt;if(Lt===Zr)if(typeof Fr=="string"){if(!pattern13.test(Fr))return validate27.errors=[{instancePath:e+"/descriptor/protocolPath",schemaPath:"#/properties/descriptor/properties/protocolPath/pattern",keyword:"pattern",params:{pattern:"^[a-zA-Z]+(/[a-zA-Z]+)*$"},message:'must match pattern "^[a-zA-Z]+(/[a-zA-Z]+)*$"'}],!1}else return validate27.errors=[{instancePath:e+"/descriptor/protocolPath",schemaPath:"#/properties/descriptor/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Dr=Zr===Lt}else var Dr=!0;if(Dr){if(Tr.schema!==void 0){const Fr=Lt;if(typeof Tr.schema!="string")return validate27.errors=[{instancePath:e+"/descriptor/schema",schemaPath:"#/properties/descriptor/properties/schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Dr=Fr===Lt}else var Dr=!0;if(Dr){if(Tr.tags!==void 0){let Fr=Tr.tags;const Zr=Lt;if(Lt===Zr)if(Fr&&typeof Fr=="object"&&!Array.isArray(Fr)){if(Object.keys(Fr).length>10)return validate27.errors=[{instancePath:e+"/descriptor/tags",schemaPath:"#/properties/descriptor/properties/tags/maxProperties",keyword:"maxProperties",params:{limit:10},message:"must NOT have more than 10 properties"}],!1;if(Object.keys(Fr).length<1)return validate27.errors=[{instancePath:e+"/descriptor/tags",schemaPath:"#/properties/descriptor/properties/tags/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const un in Fr){let dn=Fr[un];const vn=Lt,$n=Lt;let en=!1,tn=null;const hn=Lt;if(typeof dn!="string"){const yn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/0/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[yn]:jt.push(yn),Lt++}var xr=hn===Lt;xr&&(en=!0,tn=0);const mn=Lt;if(!(typeof dn=="number"&&isFinite(dn))){const yn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/1/type",keyword:"type",params:{type:"number"},message:"must be number"};jt===null?jt=[yn]:jt.push(yn),Lt++}var xr=mn===Lt;if(xr&&en)en=!1,tn=[tn,1];else{xr&&(en=!0,tn=1);const yn=Lt;if(typeof dn!="boolean"){const In={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/2/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};jt===null?jt=[In]:jt.push(In),Lt++}var xr=yn===Lt;if(xr&&en)en=!1,tn=[tn,2];else{xr&&(en=!0,tn=2);const In=Lt;if(Lt===In)if(Array.isArray(dn))if(dn.length>10){const Dn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/maxItems",keyword:"maxItems",params:{limit:10},message:"must NOT have more than 10 items"};jt===null?jt=[Dn]:jt.push(Dn),Lt++}else if(dn.length<1){const Dn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};jt===null?jt=[Dn]:jt.push(Dn),Lt++}else{var Ir=!0;const Dn=dn.length;for(let Yn=0;Yn<Dn;Yn++){const Hn=Lt;if(typeof dn[Yn]!="string"){const zn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+Yn,schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/items/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[zn]:jt.push(zn),Lt++}var Ir=Hn===Lt;if(!Ir)break}}else{const Dn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/3/type",keyword:"type",params:{type:"array"},message:"must be array"};jt===null?jt=[Dn]:jt.push(Dn),Lt++}var xr=In===Lt;if(xr&&en)en=!1,tn=[tn,3];else{xr&&(en=!0,tn=3);const Dn=Lt;if(Lt===Dn)if(Array.isArray(dn))if(dn.length>10){const Hn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/maxItems",keyword:"maxItems",params:{limit:10},message:"must NOT have more than 10 items"};jt===null?jt=[Hn]:jt.push(Hn),Lt++}else if(dn.length<1){const Hn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};jt===null?jt=[Hn]:jt.push(Hn),Lt++}else{var $r=!0;const Hn=dn.length;for(let Mn=0;Mn<Hn;Mn++){let zn=dn[Mn];const Pn=Lt;if(!(typeof zn=="number"&&isFinite(zn))){const Nn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+Mn,schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/items/type",keyword:"type",params:{type:"number"},message:"must be number"};jt===null?jt=[Nn]:jt.push(Nn),Lt++}var $r=Pn===Lt;if(!$r)break}}else{const Hn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf/4/type",keyword:"type",params:{type:"array"},message:"must be array"};jt===null?jt=[Hn]:jt.push(Hn),Lt++}var xr=Dn===Lt;xr&&en?(en=!1,tn=[tn,4]):xr&&(en=!0,tn=4)}}}if(en)Lt=$n,jt!==null&&($n?jt.length=$n:jt=null);else{const yn={instancePath:e+"/descriptor/tags/"+un.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/descriptor/properties/tags/additionalProperties/oneOf",keyword:"oneOf",params:{passingSchemas:tn},message:"must match exactly one schema in oneOf"};return jt===null?jt=[yn]:jt.push(yn),Lt++,validate27.errors=jt,!1}var vr=vn===Lt;if(!vr)break}}else return validate27.errors=[{instancePath:e+"/descriptor/tags",schemaPath:"#/properties/descriptor/properties/tags/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Dr=Zr===Lt}else var Dr=!0;if(Dr){if(Tr.parentId!==void 0){const Fr=Lt;if(typeof Tr.parentId!="string")return validate27.errors=[{instancePath:e+"/descriptor/parentId",schemaPath:"#/properties/descriptor/properties/parentId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Dr=Fr===Lt}else var Dr=!0;if(Dr){if(Tr.dataCid!==void 0){const Fr=Lt;if(typeof Tr.dataCid!="string")return validate27.errors=[{instancePath:e+"/descriptor/dataCid",schemaPath:"#/properties/descriptor/properties/dataCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Dr=Fr===Lt}else var Dr=!0;if(Dr){if(Tr.dataSize!==void 0){let Fr=Tr.dataSize;const Zr=Lt;if(!(typeof Fr=="number"&&isFinite(Fr)))return validate27.errors=[{instancePath:e+"/descriptor/dataSize",schemaPath:"#/properties/descriptor/properties/dataSize/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Dr=Zr===Lt}else var Dr=!0;if(Dr){if(Tr.dateCreated!==void 0){let Fr=Tr.dateCreated;const Zr=Lt;if(Lt===Lt)if(typeof Fr=="string"){if(!pattern14.test(Fr))return validate27.errors=[{instancePath:e+"/descriptor/dateCreated",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate27.errors=[{instancePath:e+"/descriptor/dateCreated",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Dr=Zr===Lt}else var Dr=!0;if(Dr){if(Tr.messageTimestamp!==void 0){let Fr=Tr.messageTimestamp;const Zr=Lt;if(Lt===Lt)if(typeof Fr=="string"){if(!pattern14.test(Fr))return validate27.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate27.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Dr=Zr===Lt}else var Dr=!0;if(Dr){if(Tr.published!==void 0){const Fr=Lt;if(typeof Tr.published!="boolean")return validate27.errors=[{instancePath:e+"/descriptor/published",schemaPath:"#/properties/descriptor/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var Dr=Fr===Lt}else var Dr=!0;if(Dr){if(Tr.datePublished!==void 0){let Fr=Tr.datePublished;const Zr=Lt;if(Lt===Lt)if(typeof Fr=="string"){if(!pattern14.test(Fr))return validate27.errors=[{instancePath:e+"/descriptor/datePublished",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate27.errors=[{instancePath:e+"/descriptor/datePublished",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Dr=Zr===Lt}else var Dr=!0;if(Dr)if(Tr.dataFormat!==void 0){const Fr=Lt;if(typeof Tr.dataFormat!="string")return validate27.errors=[{instancePath:e+"/descriptor/dataFormat",schemaPath:"#/properties/descriptor/properties/dataFormat/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Dr=Fr===Lt}else var Dr=!0}}}}}}}}}}}}}}}}else return validate27.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Ar=Rr===Lt}else var Ar=!0}}}}}else return validate27.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate27.errors=jt,er.props=nr,Lt===0}validate27.evaluated={dynamicProps:!0,dynamicItems:!1};function validate26(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate26.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),!validate27(xt,{instancePath:e,parentData:At,parentDataProperty:kt,rootData:Bt,dynamicAnchors:Nt}))jt=jt===null?validate27.errors:jt.concat(validate27.errors),Lt=jt.length;else var tr=validate27.evaluated.props;if(Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let rr;if(xt.recordId===void 0&&(rr="recordId")||xt.authorization===void 0&&(rr="authorization")||xt.encodedData===void 0&&(rr="encodedData"))return validate26.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:rr},message:"must have required property '"+rr+"'"}],!1;if(tr!==!0&&(tr=tr||{},tr.encodedData=!0),xt.encodedData!==void 0){const nr=Lt;if(typeof xt.encodedData!="string")return validate26.errors=[{instancePath:e+"/encodedData",schemaPath:"#/properties/encodedData/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=nr===Lt}else var zt=!0;if(zt&&tr!==!0){for(const nr in xt)if(!tr||!tr[nr])return validate26.errors=[{instancePath:e,schemaPath:"#/unevaluatedProperties",keyword:"unevaluatedProperties",params:{unevaluatedProperty:nr},message:"must NOT have unevaluated properties"}],!1}}else return validate26.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate26.errors=jt,Lt===0}validate26.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function validate24(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate24.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){const zt=Lt;for(const rr in xt)if(!(rr==="signature"||rr==="authorDelegatedGrant"))return validate24.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:rr},message:"must NOT have additional properties"}],!1;if(zt===Lt){if(xt.signature!==void 0){const rr=Lt;validate21(xt.signature,{instancePath:e+"/signature",parentData:xt,parentDataProperty:"signature",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate21.errors:jt.concat(validate21.errors),Lt=jt.length);var tr=rr===Lt}else var tr=!0;if(tr)if(xt.authorDelegatedGrant!==void 0){const rr=Lt;validate26(xt.authorDelegatedGrant,{instancePath:e+"/authorDelegatedGrant",parentData:xt,parentDataProperty:"authorDelegatedGrant",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate26.errors:jt.concat(validate26.errors),Lt=jt.length);var tr=rr===Lt}else var tr=!0}}else return validate24.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate24.errors=jt,Lt===0}validate24.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const AuthorizationOwner=validate29,RecordsDelete$1=validate38,schema51={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-delete.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","recordId","prune"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Delete"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},recordId:{type:"string"},prune:{type:"boolean"}}}}};function validate38(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate38.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let rr;if(xt.authorization===void 0&&(rr="authorization")||xt.descriptor===void 0&&(rr="descriptor"))return validate38.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:rr},message:"must have required property '"+rr+"'"}],!1;{const nr=Lt;for(const ir in xt)if(!(ir==="authorization"||ir==="descriptor"))return validate38.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ir},message:"must NOT have additional properties"}],!1;if(nr===Lt){if(xt.authorization!==void 0){const ir=Lt;validate24(xt.authorization,{instancePath:e+"/authorization",parentData:xt,parentDataProperty:"authorization",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate24.errors:jt.concat(validate24.errors),Lt=jt.length);var tr=ir===Lt}else var tr=!0;if(tr)if(xt.descriptor!==void 0){let ir=xt.descriptor;const ar=Lt;if(Lt===ar)if(ir&&typeof ir=="object"&&!Array.isArray(ir)){let ur;if(ir.interface===void 0&&(ur="interface")||ir.method===void 0&&(ur="method")||ir.messageTimestamp===void 0&&(ur="messageTimestamp")||ir.recordId===void 0&&(ur="recordId")||ir.prune===void 0&&(ur="prune"))return validate38.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:ur},message:"must have required property '"+ur+"'"}],!1;{const fr=Lt;for(const pr in ir)if(!(pr==="interface"||pr==="method"||pr==="messageTimestamp"||pr==="recordId"||pr==="prune"))return validate38.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:pr},message:"must NOT have additional properties"}],!1;if(fr===Lt){if(ir.interface!==void 0){let pr=ir.interface;const lr=Lt;if(typeof pr!="string")return validate38.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(pr!=="Records")return validate38.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema51.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.method!==void 0){let pr=ir.method;const lr=Lt;if(typeof pr!="string")return validate38.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(pr!=="Delete")return validate38.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema51.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.messageTimestamp!==void 0){let pr=ir.messageTimestamp;const lr=Lt;if(Lt===Lt)if(typeof pr=="string"){if(!pattern14.test(pr))return validate38.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate38.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.recordId!==void 0){const pr=Lt;if(typeof ir.recordId!="string")return validate38.errors=[{instancePath:e+"/descriptor/recordId",schemaPath:"#/properties/descriptor/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=pr===Lt}else var zt=!0;if(zt)if(ir.prune!==void 0){const pr=Lt;if(typeof ir.prune!="boolean")return validate38.errors=[{instancePath:e+"/descriptor/prune",schemaPath:"#/properties/descriptor/properties/prune/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var zt=pr===Lt}else var zt=!0}}}}}}else return validate38.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=ar===Lt}else var tr=!0}}}else return validate38.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate38.errors=jt,Lt===0}validate38.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsQuery$1=validate40,schema53={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-query.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filter"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Query"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{$ref:"https://identity.foundation/dwn/json-schemas/records-filter.json"},pagination:{type:"object",additionalProperties:!1,properties:{limit:{type:"number",minimum:1},cursor:{$ref:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json"}}},dateSort:{enum:["createdAscending","createdDescending","publishedAscending","publishedDescending"],type:"string"}}}}},schema70={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json",type:"object",minProperties:1,additionalProperties:!1,required:["messageCid","value"],properties:{messageCid:{type:"string"},value:{type:["string","number"]}}},schema55={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-filter.json",type:"object",minProperties:1,additionalProperties:!1,properties:{protocol:{type:"string"},protocolPath:{type:"string"},author:{oneOf:[{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"}}]},attester:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},recipient:{oneOf:[{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"}}]},contextId:{type:"string"},schema:{type:"string"},tags:{type:"object",minProperties:1,additionalProperties:{oneOf:[{type:"string"},{type:"number"},{type:"boolean"},{type:"object",minProperties:1,additionalProperties:!1,properties:{startsWith:{type:"string"}}},{$ref:"https://identity.foundation/dwn/json-schemas/string-range-filter.json"},{$ref:"https://identity.foundation/dwn/json-schemas/number-range-filter.json"}]}},recordId:{type:"string"},parentId:{type:"string"},published:{type:"boolean"},dataFormat:{type:"string"},dataSize:{$ref:"https://identity.foundation/dwn/json-schemas/number-range-filter.json"},dataCid:{type:"string"},dateCreated:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}},datePublished:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}},dateUpdated:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}}},dependencies:{datePublished:{oneOf:[{properties:{published:{enum:[!0]}},required:["published"]},{not:{required:["published"]}}]}}};function validate42(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate42.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){if(Object.keys(xt).length<1)return validate42.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Gr=Lt;for(const Br in xt)if(!func1.call(schema55.properties,Br))return validate42.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Br},message:"must NOT have additional properties"}],!1;if(Gr===Lt){if(xt.datePublished!==void 0){const Br=Lt,Cr=Lt;let jr=!1,Yr=null;const Qr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Vr;if(xt.published===void 0&&(Vr="published")){const Xr={instancePath:e,schemaPath:"#/dependencies/datePublished/oneOf/0/required",keyword:"required",params:{missingProperty:Vr},message:"must have required property '"+Vr+"'"};jt===null?jt=[Xr]:jt.push(Xr),Lt++}else if(xt.published!==void 0&&xt.published!==!0){const Xr={instancePath:e+"/published",schemaPath:"#/dependencies/datePublished/oneOf/0/properties/published/enum",keyword:"enum",params:{allowedValues:schema55.dependencies.datePublished.oneOf[0].properties.published.enum},message:"must be equal to one of the allowed values"};jt===null?jt=[Xr]:jt.push(Xr),Lt++}}var rr=Qr===Lt;if(rr){jr=!0,Yr=0;var tr={};tr.published=!0}const Jr=Lt,Wr=Lt,Nr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.published===void 0){const Vr={};jt===null?jt=[Vr]:jt.push(Vr),Lt++}var zt=Nr===Lt;if(zt){const Vr={instancePath:e,schemaPath:"#/dependencies/datePublished/oneOf/1/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}else Lt=Wr,jt!==null&&(Wr?jt.length=Wr:jt=null);var rr=Jr===Lt;if(rr&&jr?(jr=!1,Yr=[Yr,1]):rr&&(jr=!0,Yr=1),jr)Lt=Cr,jt!==null&&(Cr?jt.length=Cr:jt=null);else{const Vr={instancePath:e,schemaPath:"#/dependencies/datePublished/oneOf",keyword:"oneOf",params:{passingSchemas:Yr},message:"must match exactly one schema in oneOf"};return jt===null?jt=[Vr]:jt.push(Vr),Lt++,validate42.errors=jt,!1}var nr=Br===Lt}else var nr=!0;if(nr){if(xt.protocol!==void 0){const Br=Lt;if(typeof xt.protocol!="string")return validate42.errors=[{instancePath:e+"/protocol",schemaPath:"#/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ir=Br===Lt}else var ir=!0;if(ir){if(xt.protocolPath!==void 0){const Br=Lt;if(typeof xt.protocolPath!="string")return validate42.errors=[{instancePath:e+"/protocolPath",schemaPath:"#/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ir=Br===Lt}else var ir=!0;if(ir){if(xt.author!==void 0){let Br=xt.author;const Cr=Lt,jr=Lt;let Yr=!1,Qr=null;const Jr=Lt;if(Lt===Lt)if(typeof Br=="string"){if(!pattern12.test(Br)){const Xr={instancePath:e+"/author",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};jt===null?jt=[Xr]:jt.push(Xr),Lt++}}else{const Xr={instancePath:e+"/author",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Xr]:jt.push(Xr),Lt++}var dr=Jr===Lt;dr&&(Yr=!0,Qr=0);const Nr=Lt;if(Lt===Nr)if(Array.isArray(Br)){var ar=!0;const Xr=Br.length;for(let qr=0;qr<Xr;qr++){let Or=Br[qr];const Fr=Lt;if(Lt===Lt)if(typeof Or=="string"){if(!pattern12.test(Or)){const un={instancePath:e+"/author/"+qr,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};jt===null?jt=[un]:jt.push(un),Lt++}}else{const un={instancePath:e+"/author/"+qr,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[un]:jt.push(un),Lt++}var ar=Fr===Lt;if(!ar)break}}else{const Xr={instancePath:e+"/author",schemaPath:"#/properties/author/oneOf/1/type",keyword:"type",params:{type:"array"},message:"must be array"};jt===null?jt=[Xr]:jt.push(Xr),Lt++}var dr=Nr===Lt;if(dr&&Yr?(Yr=!1,Qr=[Qr,1]):dr&&(Yr=!0,Qr=1),Yr)Lt=jr,jt!==null&&(jr?jt.length=jr:jt=null);else{const Xr={instancePath:e+"/author",schemaPath:"#/properties/author/oneOf",keyword:"oneOf",params:{passingSchemas:Qr},message:"must match exactly one schema in oneOf"};return jt===null?jt=[Xr]:jt.push(Xr),Lt++,validate42.errors=jt,!1}var ir=Cr===Lt}else var ir=!0;if(ir){if(xt.attester!==void 0){let Br=xt.attester;const Cr=Lt;if(Lt===Lt)if(typeof Br=="string"){if(!pattern12.test(Br))return validate42.errors=[{instancePath:e+"/attester",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return validate42.errors=[{instancePath:e+"/attester",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ir=Cr===Lt}else var ir=!0;if(ir){if(xt.recipient!==void 0){let Br=xt.recipient;const Cr=Lt,jr=Lt;let Yr=!1,Qr=null;const Jr=Lt;if(Lt===Lt)if(typeof Br=="string"){if(!pattern12.test(Br)){const Xr={instancePath:e+"/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};jt===null?jt=[Xr]:jt.push(Xr),Lt++}}else{const Xr={instancePath:e+"/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Xr]:jt.push(Xr),Lt++}var fr=Jr===Lt;fr&&(Yr=!0,Qr=0);const Nr=Lt;if(Lt===Nr)if(Array.isArray(Br)){var ur=!0;const Xr=Br.length;for(let qr=0;qr<Xr;qr++){let Or=Br[qr];const Fr=Lt;if(Lt===Lt)if(typeof Or=="string"){if(!pattern12.test(Or)){const un={instancePath:e+"/recipient/"+qr,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'};jt===null?jt=[un]:jt.push(un),Lt++}}else{const un={instancePath:e+"/recipient/"+qr,schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[un]:jt.push(un),Lt++}var ur=Fr===Lt;if(!ur)break}}else{const Xr={instancePath:e+"/recipient",schemaPath:"#/properties/recipient/oneOf/1/type",keyword:"type",params:{type:"array"},message:"must be array"};jt===null?jt=[Xr]:jt.push(Xr),Lt++}var fr=Nr===Lt;if(fr&&Yr?(Yr=!1,Qr=[Qr,1]):fr&&(Yr=!0,Qr=1),Yr)Lt=jr,jt!==null&&(jr?jt.length=jr:jt=null);else{const Xr={instancePath:e+"/recipient",schemaPath:"#/properties/recipient/oneOf",keyword:"oneOf",params:{passingSchemas:Qr},message:"must match exactly one schema in oneOf"};return jt===null?jt=[Xr]:jt.push(Xr),Lt++,validate42.errors=jt,!1}var ir=Cr===Lt}else var ir=!0;if(ir){if(xt.contextId!==void 0){const Br=Lt;if(typeof xt.contextId!="string")return validate42.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ir=Br===Lt}else var ir=!0;if(ir){if(xt.schema!==void 0){const Br=Lt;if(typeof xt.schema!="string")return validate42.errors=[{instancePath:e+"/schema",schemaPath:"#/properties/schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ir=Br===Lt}else var ir=!0;if(ir){if(xt.tags!==void 0){let Br=xt.tags;const Cr=Lt;if(Lt===Cr)if(Br&&typeof Br=="object"&&!Array.isArray(Br)){if(Object.keys(Br).length<1)return validate42.errors=[{instancePath:e+"/tags",schemaPath:"#/properties/tags/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const Yr in Br){let Qr=Br[Yr];const Jr=Lt,Wr=Lt;let Nr=!1,Vr=null;const Xr=Lt;if(typeof Qr!="string"){const Or={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/0/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Or]:jt.push(Or),Lt++}var pr=Xr===Lt;pr&&(Nr=!0,Vr=0);const qr=Lt;if(!(typeof Qr=="number"&&isFinite(Qr))){const Or={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/1/type",keyword:"type",params:{type:"number"},message:"must be number"};jt===null?jt=[Or]:jt.push(Or),Lt++}var pr=qr===Lt;if(pr&&Nr)Nr=!1,Vr=[Vr,1];else{pr&&(Nr=!0,Vr=1);const Or=Lt;if(typeof Qr!="boolean"){const Zr={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/2/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"};jt===null?jt=[Zr]:jt.push(Zr),Lt++}var pr=Or===Lt;if(pr&&Nr)Nr=!1,Vr=[Vr,2];else{pr&&(Nr=!0,Vr=2);const Zr=Lt;if(Lt===Zr)if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr))if(Object.keys(Qr).length<1){const un={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/3/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"};jt===null?jt=[un]:jt.push(un),Lt++}else{const un=Lt;for(const dn in Qr)if(dn!=="startsWith"){const vn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/3/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:dn},message:"must NOT have additional properties"};jt===null?jt=[vn]:jt.push(vn),Lt++;break}if(un===Lt&&Qr.startsWith!==void 0&&typeof Qr.startsWith!="string"){const dn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/startsWith",schemaPath:"#/properties/tags/additionalProperties/oneOf/3/properties/startsWith/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[dn]:jt.push(dn),Lt++}}else{const un={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf/3/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[un]:jt.push(un),Lt++}var pr=Zr===Lt;if(pr&&Nr)Nr=!1,Vr=[Vr,3];else{pr&&(Nr=!0,Vr=3);const un=Lt;if(Lt===Lt)if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr))if(Object.keys(Qr).length<1){const $n={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"};jt===null?jt=[$n]:jt.push($n),Lt++}else{const $n=Lt;for(const en in Qr)if(!(en==="gt"||en==="gte"||en==="lt"||en==="lte")){const tn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:en},message:"must NOT have additional properties"};jt===null?jt=[tn]:jt.push(tn),Lt++;break}if($n===Lt){if(Qr.gt!==void 0){const en=Lt,tn=Lt,hn=Lt;if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr)&&Qr.gte===void 0){const mn={};jt===null?jt=[mn]:jt.push(mn),Lt++}var lr=hn===Lt;if(lr){const mn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[mn]:jt.push(mn),Lt++}else Lt=tn,jt!==null&&(tn?jt.length=tn:jt=null);var yr=en===Lt}else var yr=!0;if(yr){if(Qr.gte!==void 0){const en=Lt,tn=Lt,hn=Lt;if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr)&&Qr.gt===void 0){const yn={};jt===null?jt=[yn]:jt.push(yn),Lt++}var br=hn===Lt;if(br){const yn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[yn]:jt.push(yn),Lt++}else Lt=tn,jt!==null&&(tn?jt.length=tn:jt=null);var yr=en===Lt}else var yr=!0;if(yr){if(Qr.lt!==void 0){const en=Lt,tn=Lt,hn=Lt;if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr)&&Qr.lte===void 0){const yn={};jt===null?jt=[yn]:jt.push(yn),Lt++}var Ar=hn===Lt;if(Ar){const yn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[yn]:jt.push(yn),Lt++}else Lt=tn,jt!==null&&(tn?jt.length=tn:jt=null);var yr=en===Lt}else var yr=!0;if(yr){if(Qr.lte!==void 0){const en=Lt,tn=Lt,hn=Lt;if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr)&&Qr.lt===void 0){const yn={};jt===null?jt=[yn]:jt.push(yn),Lt++}var Pr=hn===Lt;if(Pr){const yn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[yn]:jt.push(yn),Lt++}else Lt=tn,jt!==null&&(tn?jt.length=tn:jt=null);var yr=en===Lt}else var yr=!0;if(yr){if(Qr.gt!==void 0){const en=Lt;if(typeof Qr.gt!="string"){const tn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/gt",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/gt/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[tn]:jt.push(tn),Lt++}var kr=en===Lt}else var kr=!0;if(kr){if(Qr.gte!==void 0){const en=Lt;if(typeof Qr.gte!="string"){const hn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/gte",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/gte/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[hn]:jt.push(hn),Lt++}var kr=en===Lt}else var kr=!0;if(kr){if(Qr.lt!==void 0){const en=Lt;if(typeof Qr.lt!="string"){const hn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/lt",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/lt/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[hn]:jt.push(hn),Lt++}var kr=en===Lt}else var kr=!0;if(kr)if(Qr.lte!==void 0){const en=Lt;if(typeof Qr.lte!="string"){const hn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/lte",schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/properties/lte/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[hn]:jt.push(hn),Lt++}var kr=en===Lt}else var kr=!0}}}}}}}}else{const $n={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/string-range-filter.json/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[$n]:jt.push($n),Lt++}var pr=un===Lt;if(pr&&Nr)Nr=!1,Vr=[Vr,4];else{pr&&(Nr=!0,Vr=4);const $n=Lt;if(Lt===Lt)if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr))if(Object.keys(Qr).length<1){const hn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"};jt===null?jt=[hn]:jt.push(hn),Lt++}else{const hn=Lt;for(const mn in Qr)if(!(mn==="gt"||mn==="gte"||mn==="lt"||mn==="lte")){const yn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:mn},message:"must NOT have additional properties"};jt===null?jt=[yn]:jt.push(yn),Lt++;break}if(hn===Lt){if(Qr.gt!==void 0){const mn=Lt,yn=Lt,xn=Lt;if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr)&&Qr.gte===void 0){const In={};jt===null?jt=[In]:jt.push(In),Lt++}var Ur=xn===Lt;if(Ur){const In={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[In]:jt.push(In),Lt++}else Lt=yn,jt!==null&&(yn?jt.length=yn:jt=null);var Hr=mn===Lt}else var Hr=!0;if(Hr){if(Qr.gte!==void 0){const mn=Lt,yn=Lt,xn=Lt;if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr)&&Qr.gt===void 0){const On={};jt===null?jt=[On]:jt.push(On),Lt++}var Lr=xn===Lt;if(Lr){const On={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[On]:jt.push(On),Lt++}else Lt=yn,jt!==null&&(yn?jt.length=yn:jt=null);var Hr=mn===Lt}else var Hr=!0;if(Hr){if(Qr.lt!==void 0){const mn=Lt,yn=Lt,xn=Lt;if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr)&&Qr.lte===void 0){const On={};jt===null?jt=[On]:jt.push(On),Lt++}var Sr=xn===Lt;if(Sr){const On={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[On]:jt.push(On),Lt++}else Lt=yn,jt!==null&&(yn?jt.length=yn:jt=null);var Hr=mn===Lt}else var Hr=!0;if(Hr){if(Qr.lte!==void 0){const mn=Lt,yn=Lt,xn=Lt;if(Qr&&typeof Qr=="object"&&!Array.isArray(Qr)&&Qr.lt===void 0){const On={};jt===null?jt=[On]:jt.push(On),Lt++}var _r=xn===Lt;if(_r){const On={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"};jt===null?jt=[On]:jt.push(On),Lt++}else Lt=yn,jt!==null&&(yn?jt.length=yn:jt=null);var Hr=mn===Lt}else var Hr=!0;if(Hr){if(Qr.gt!==void 0){let mn=Qr.gt;const yn=Lt;if(!(typeof mn=="number"&&isFinite(mn))){const xn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/gt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gt/type",keyword:"type",params:{type:"number"},message:"must be number"};jt===null?jt=[xn]:jt.push(xn),Lt++}var gr=yn===Lt}else var gr=!0;if(gr){if(Qr.gte!==void 0){let mn=Qr.gte;const yn=Lt;if(!(typeof mn=="number"&&isFinite(mn))){const In={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/gte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gte/type",keyword:"type",params:{type:"number"},message:"must be number"};jt===null?jt=[In]:jt.push(In),Lt++}var gr=yn===Lt}else var gr=!0;if(gr){if(Qr.lt!==void 0){let mn=Qr.lt;const yn=Lt;if(!(typeof mn=="number"&&isFinite(mn))){const In={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/lt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lt/type",keyword:"type",params:{type:"number"},message:"must be number"};jt===null?jt=[In]:jt.push(In),Lt++}var gr=yn===Lt}else var gr=!0;if(gr)if(Qr.lte!==void 0){let mn=Qr.lte;const yn=Lt;if(!(typeof mn=="number"&&isFinite(mn))){const In={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1")+"/lte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lte/type",keyword:"type",params:{type:"number"},message:"must be number"};jt===null?jt=[In]:jt.push(In),Lt++}var gr=yn===Lt}else var gr=!0}}}}}}}}else{const hn={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[hn]:jt.push(hn),Lt++}var pr=$n===Lt;pr&&Nr?(Nr=!1,Vr=[Vr,5]):pr&&(Nr=!0,Vr=5)}}}}if(Nr)Lt=Wr,jt!==null&&(Wr?jt.length=Wr:jt=null);else{const Or={instancePath:e+"/tags/"+Yr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/tags/additionalProperties/oneOf",keyword:"oneOf",params:{passingSchemas:Vr},message:"must match exactly one schema in oneOf"};return jt===null?jt=[Or]:jt.push(Or),Lt++,validate42.errors=jt,!1}var wr=Jr===Lt;if(!wr)break}}else return validate42.errors=[{instancePath:e+"/tags",schemaPath:"#/properties/tags/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var ir=Cr===Lt}else var ir=!0;if(ir){if(xt.recordId!==void 0){const Br=Lt;if(typeof xt.recordId!="string")return validate42.errors=[{instancePath:e+"/recordId",schemaPath:"#/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ir=Br===Lt}else var ir=!0;if(ir){if(xt.parentId!==void 0){const Br=Lt;if(typeof xt.parentId!="string")return validate42.errors=[{instancePath:e+"/parentId",schemaPath:"#/properties/parentId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ir=Br===Lt}else var ir=!0;if(ir){if(xt.published!==void 0){const Br=Lt;if(typeof xt.published!="boolean")return validate42.errors=[{instancePath:e+"/published",schemaPath:"#/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var ir=Br===Lt}else var ir=!0;if(ir){if(xt.dataFormat!==void 0){const Br=Lt;if(typeof xt.dataFormat!="string")return validate42.errors=[{instancePath:e+"/dataFormat",schemaPath:"#/properties/dataFormat/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ir=Br===Lt}else var ir=!0;if(ir){if(xt.dataSize!==void 0){let Br=xt.dataSize;const Cr=Lt;if(Lt===Lt)if(Br&&typeof Br=="object"&&!Array.isArray(Br)){if(Object.keys(Br).length<1)return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Qr=Lt;for(const Jr in Br)if(!(Jr==="gt"||Jr==="gte"||Jr==="lt"||Jr==="lte"))return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Jr},message:"must NOT have additional properties"}],!1;if(Qr===Lt){if(Br.gt!==void 0){const Jr=Lt,Wr=Lt,Nr=Lt;if(Br&&typeof Br=="object"&&!Array.isArray(Br)&&Br.gte===void 0){const Vr={};jt===null?jt=[Vr]:jt.push(Vr),Lt++}var Dr=Nr===Lt;if(Dr)return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=Wr,jt!==null&&(Wr?jt.length=Wr:jt=null);var xr=Jr===Lt}else var xr=!0;if(xr){if(Br.gte!==void 0){const Jr=Lt,Wr=Lt,Nr=Lt;if(Br&&typeof Br=="object"&&!Array.isArray(Br)&&Br.gt===void 0){const Xr={};jt===null?jt=[Xr]:jt.push(Xr),Lt++}var Ir=Nr===Lt;if(Ir)return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=Wr,jt!==null&&(Wr?jt.length=Wr:jt=null);var xr=Jr===Lt}else var xr=!0;if(xr){if(Br.lt!==void 0){const Jr=Lt,Wr=Lt,Nr=Lt;if(Br&&typeof Br=="object"&&!Array.isArray(Br)&&Br.lte===void 0){const Xr={};jt===null?jt=[Xr]:jt.push(Xr),Lt++}var $r=Nr===Lt;if($r)return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=Wr,jt!==null&&(Wr?jt.length=Wr:jt=null);var xr=Jr===Lt}else var xr=!0;if(xr){if(Br.lte!==void 0){const Jr=Lt,Wr=Lt,Nr=Lt;if(Br&&typeof Br=="object"&&!Array.isArray(Br)&&Br.lt===void 0){const Xr={};jt===null?jt=[Xr]:jt.push(Xr),Lt++}var vr=Nr===Lt;if(vr)return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=Wr,jt!==null&&(Wr?jt.length=Wr:jt=null);var xr=Jr===Lt}else var xr=!0;if(xr){if(Br.gt!==void 0){let Jr=Br.gt;const Wr=Lt;if(!(typeof Jr=="number"&&isFinite(Jr)))return validate42.errors=[{instancePath:e+"/dataSize/gt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Er=Wr===Lt}else var Er=!0;if(Er){if(Br.gte!==void 0){let Jr=Br.gte;const Wr=Lt;if(!(typeof Jr=="number"&&isFinite(Jr)))return validate42.errors=[{instancePath:e+"/dataSize/gte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/gte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Er=Wr===Lt}else var Er=!0;if(Er){if(Br.lt!==void 0){let Jr=Br.lt;const Wr=Lt;if(!(typeof Jr=="number"&&isFinite(Jr)))return validate42.errors=[{instancePath:e+"/dataSize/lt",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Er=Wr===Lt}else var Er=!0;if(Er)if(Br.lte!==void 0){let Jr=Br.lte;const Wr=Lt;if(!(typeof Jr=="number"&&isFinite(Jr)))return validate42.errors=[{instancePath:e+"/dataSize/lte",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/properties/lte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var Er=Wr===Lt}else var Er=!0}}}}}}}}}else return validate42.errors=[{instancePath:e+"/dataSize",schemaPath:"https://identity.foundation/dwn/json-schemas/number-range-filter.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var ir=Cr===Lt}else var ir=!0;if(ir){if(xt.dataCid!==void 0){const Br=Lt;if(typeof xt.dataCid!="string")return validate42.errors=[{instancePath:e+"/dataCid",schemaPath:"#/properties/dataCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ir=Br===Lt}else var ir=!0;if(ir){if(xt.dateCreated!==void 0){let Br=xt.dateCreated;const Cr=Lt;if(Lt===Cr)if(Br&&typeof Br=="object"&&!Array.isArray(Br)){if(Object.keys(Br).length<1)return validate42.errors=[{instancePath:e+"/dateCreated",schemaPath:"#/properties/dateCreated/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Yr=Lt;for(const Qr in Br)if(!(Qr==="from"||Qr==="to"))return validate42.errors=[{instancePath:e+"/dateCreated",schemaPath:"#/properties/dateCreated/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Qr},message:"must NOT have additional properties"}],!1;if(Yr===Lt){if(Br.from!==void 0){let Qr=Br.from;const Jr=Lt;if(Lt===Lt)if(typeof Qr=="string"){if(!pattern14.test(Qr))return validate42.errors=[{instancePath:e+"/dateCreated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/dateCreated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Tr=Jr===Lt}else var Tr=!0;if(Tr)if(Br.to!==void 0){let Qr=Br.to;const Jr=Lt;if(Lt===Lt)if(typeof Qr=="string"){if(!pattern14.test(Qr))return validate42.errors=[{instancePath:e+"/dateCreated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/dateCreated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Tr=Jr===Lt}else var Tr=!0}}}else return validate42.errors=[{instancePath:e+"/dateCreated",schemaPath:"#/properties/dateCreated/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var ir=Cr===Lt}else var ir=!0;if(ir){if(xt.datePublished!==void 0){let Br=xt.datePublished;const Cr=Lt;if(Lt===Cr)if(Br&&typeof Br=="object"&&!Array.isArray(Br)){if(Object.keys(Br).length<1)return validate42.errors=[{instancePath:e+"/datePublished",schemaPath:"#/properties/datePublished/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Yr=Lt;for(const Qr in Br)if(!(Qr==="from"||Qr==="to"))return validate42.errors=[{instancePath:e+"/datePublished",schemaPath:"#/properties/datePublished/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Qr},message:"must NOT have additional properties"}],!1;if(Yr===Lt){if(Br.from!==void 0){let Qr=Br.from;const Jr=Lt;if(Lt===Lt)if(typeof Qr=="string"){if(!pattern14.test(Qr))return validate42.errors=[{instancePath:e+"/datePublished/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/datePublished/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Rr=Jr===Lt}else var Rr=!0;if(Rr)if(Br.to!==void 0){let Qr=Br.to;const Jr=Lt;if(Lt===Lt)if(typeof Qr=="string"){if(!pattern14.test(Qr))return validate42.errors=[{instancePath:e+"/datePublished/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/datePublished/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Rr=Jr===Lt}else var Rr=!0}}}else return validate42.errors=[{instancePath:e+"/datePublished",schemaPath:"#/properties/datePublished/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var ir=Cr===Lt}else var ir=!0;if(ir)if(xt.dateUpdated!==void 0){let Br=xt.dateUpdated;const Cr=Lt;if(Lt===Cr)if(Br&&typeof Br=="object"&&!Array.isArray(Br)){if(Object.keys(Br).length<1)return validate42.errors=[{instancePath:e+"/dateUpdated",schemaPath:"#/properties/dateUpdated/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Yr=Lt;for(const Qr in Br)if(!(Qr==="from"||Qr==="to"))return validate42.errors=[{instancePath:e+"/dateUpdated",schemaPath:"#/properties/dateUpdated/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Qr},message:"must NOT have additional properties"}],!1;if(Yr===Lt){if(Br.from!==void 0){let Qr=Br.from;const Jr=Lt;if(Lt===Lt)if(typeof Qr=="string"){if(!pattern14.test(Qr))return validate42.errors=[{instancePath:e+"/dateUpdated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/dateUpdated/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Mr=Jr===Lt}else var Mr=!0;if(Mr)if(Br.to!==void 0){let Qr=Br.to;const Jr=Lt;if(Lt===Lt)if(typeof Qr=="string"){if(!pattern14.test(Qr))return validate42.errors=[{instancePath:e+"/dateUpdated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate42.errors=[{instancePath:e+"/dateUpdated/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var Mr=Jr===Lt}else var Mr=!0}}}else return validate42.errors=[{instancePath:e+"/dateUpdated",schemaPath:"#/properties/dateUpdated/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var ir=Cr===Lt}else var ir=!0}}}}}}}}}}}}}}}}}}}else return validate42.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate42.errors=jt,Lt===0}validate42.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function validate40(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate40.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let ir;if(xt.descriptor===void 0&&(ir="descriptor"))return validate40.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:ir},message:"must have required property '"+ir+"'"}],!1;{const ar=Lt;for(const dr in xt)if(!(dr==="authorization"||dr==="descriptor"))return validate40.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:dr},message:"must NOT have additional properties"}],!1;if(ar===Lt){if(xt.authorization!==void 0){const dr=Lt;validate24(xt.authorization,{instancePath:e+"/authorization",parentData:xt,parentDataProperty:"authorization",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate24.errors:jt.concat(validate24.errors),Lt=jt.length);var tr=dr===Lt}else var tr=!0;if(tr)if(xt.descriptor!==void 0){let dr=xt.descriptor;const ur=Lt;if(Lt===ur)if(dr&&typeof dr=="object"&&!Array.isArray(dr)){let pr;if(dr.interface===void 0&&(pr="interface")||dr.method===void 0&&(pr="method")||dr.messageTimestamp===void 0&&(pr="messageTimestamp")||dr.filter===void 0&&(pr="filter"))return validate40.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:pr},message:"must have required property '"+pr+"'"}],!1;{const lr=Lt;for(const yr in dr)if(!(yr==="interface"||yr==="method"||yr==="messageTimestamp"||yr==="filter"||yr==="pagination"||yr==="dateSort"))return validate40.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:yr},message:"must NOT have additional properties"}],!1;if(lr===Lt){if(dr.interface!==void 0){let yr=dr.interface;const br=Lt;if(typeof yr!="string")return validate40.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(yr!=="Records")return validate40.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema53.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var zt=br===Lt}else var zt=!0;if(zt){if(dr.method!==void 0){let yr=dr.method;const br=Lt;if(typeof yr!="string")return validate40.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(yr!=="Query")return validate40.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema53.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var zt=br===Lt}else var zt=!0;if(zt){if(dr.messageTimestamp!==void 0){let yr=dr.messageTimestamp;const br=Lt;if(Lt===Lt)if(typeof yr=="string"){if(!pattern14.test(yr))return validate40.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate40.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=br===Lt}else var zt=!0;if(zt){if(dr.filter!==void 0){const yr=Lt;validate42(dr.filter,{instancePath:e+"/descriptor/filter",parentData:dr,parentDataProperty:"filter",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate42.errors:jt.concat(validate42.errors),Lt=jt.length);var zt=yr===Lt}else var zt=!0;if(zt){if(dr.pagination!==void 0){let yr=dr.pagination;const br=Lt;if(Lt===br)if(yr&&typeof yr=="object"&&!Array.isArray(yr)){const Pr=Lt;for(const kr in yr)if(!(kr==="limit"||kr==="cursor"))return validate40.errors=[{instancePath:e+"/descriptor/pagination",schemaPath:"#/properties/descriptor/properties/pagination/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:kr},message:"must NOT have additional properties"}],!1;if(Pr===Lt){if(yr.limit!==void 0){let kr=yr.limit;const Ur=Lt;if(Lt===Ur)if(typeof kr=="number"&&isFinite(kr)){if(kr<1||isNaN(kr))return validate40.errors=[{instancePath:e+"/descriptor/pagination/limit",schemaPath:"#/properties/descriptor/properties/pagination/properties/limit/minimum",keyword:"minimum",params:{comparison:">=",limit:1},message:"must be >= 1"}],!1}else return validate40.errors=[{instancePath:e+"/descriptor/pagination/limit",schemaPath:"#/properties/descriptor/properties/pagination/properties/limit/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var rr=Ur===Lt}else var rr=!0;if(rr)if(yr.cursor!==void 0){let kr=yr.cursor;const Ur=Lt;if(Lt===Lt)if(kr&&typeof kr=="object"&&!Array.isArray(kr)){if(Object.keys(kr).length<1)return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{let Sr;if(kr.messageCid===void 0&&(Sr="messageCid")||kr.value===void 0&&(Sr="value"))return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/required",keyword:"required",params:{missingProperty:Sr},message:"must have required property '"+Sr+"'"}],!1;{const _r=Lt;for(const gr in kr)if(!(gr==="messageCid"||gr==="value"))return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:gr},message:"must NOT have additional properties"}],!1;if(_r===Lt){if(kr.messageCid!==void 0){const gr=Lt;if(typeof kr.messageCid!="string")return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor/messageCid",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var nr=gr===Lt}else var nr=!0;if(nr)if(kr.value!==void 0){let gr=kr.value;const wr=Lt;if(typeof gr!="string"&&!(typeof gr=="number"&&isFinite(gr)))return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor/value",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/value/type",keyword:"type",params:{type:schema70.properties.value.type},message:"must be string,number"}],!1;var nr=wr===Lt}else var nr=!0}}}}else return validate40.errors=[{instancePath:e+"/descriptor/pagination/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var rr=Ur===Lt}else var rr=!0}}else return validate40.errors=[{instancePath:e+"/descriptor/pagination",schemaPath:"#/properties/descriptor/properties/pagination/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=br===Lt}else var zt=!0;if(zt)if(dr.dateSort!==void 0){let yr=dr.dateSort;const br=Lt;if(typeof yr!="string")return validate40.errors=[{instancePath:e+"/descriptor/dateSort",schemaPath:"#/properties/descriptor/properties/dateSort/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(yr==="createdAscending"||yr==="createdDescending"||yr==="publishedAscending"||yr==="publishedDescending"))return validate40.errors=[{instancePath:e+"/descriptor/dateSort",schemaPath:"#/properties/descriptor/properties/dateSort/enum",keyword:"enum",params:{allowedValues:schema53.properties.descriptor.properties.dateSort.enum},message:"must be equal to one of the allowed values"}],!1;var zt=br===Lt}else var zt=!0}}}}}}}else return validate40.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=ur===Lt}else var tr=!0}}}else return validate40.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate40.errors=jt,Lt===0}validate40.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsSubscribe$1=validate44,schema71={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-subscribe.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filter"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Subscribe"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{$ref:"https://identity.foundation/dwn/json-schemas/records-filter.json"}}}}};function validate44(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate44.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let rr;if(xt.descriptor===void 0&&(rr="descriptor"))return validate44.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:rr},message:"must have required property '"+rr+"'"}],!1;{const nr=Lt;for(const ir in xt)if(!(ir==="authorization"||ir==="descriptor"))return validate44.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ir},message:"must NOT have additional properties"}],!1;if(nr===Lt){if(xt.authorization!==void 0){const ir=Lt;validate24(xt.authorization,{instancePath:e+"/authorization",parentData:xt,parentDataProperty:"authorization",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate24.errors:jt.concat(validate24.errors),Lt=jt.length);var tr=ir===Lt}else var tr=!0;if(tr)if(xt.descriptor!==void 0){let ir=xt.descriptor;const ar=Lt;if(Lt===ar)if(ir&&typeof ir=="object"&&!Array.isArray(ir)){let ur;if(ir.interface===void 0&&(ur="interface")||ir.method===void 0&&(ur="method")||ir.messageTimestamp===void 0&&(ur="messageTimestamp")||ir.filter===void 0&&(ur="filter"))return validate44.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:ur},message:"must have required property '"+ur+"'"}],!1;{const fr=Lt;for(const pr in ir)if(!(pr==="interface"||pr==="method"||pr==="messageTimestamp"||pr==="filter"))return validate44.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:pr},message:"must NOT have additional properties"}],!1;if(fr===Lt){if(ir.interface!==void 0){let pr=ir.interface;const lr=Lt;if(typeof pr!="string")return validate44.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(pr!=="Records")return validate44.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema71.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.method!==void 0){let pr=ir.method;const lr=Lt;if(typeof pr!="string")return validate44.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(pr!=="Subscribe")return validate44.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema71.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.messageTimestamp!==void 0){let pr=ir.messageTimestamp;const lr=Lt;if(Lt===Lt)if(typeof pr=="string"){if(!pattern14.test(pr))return validate44.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate44.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=lr===Lt}else var zt=!0;if(zt)if(ir.filter!==void 0){const pr=Lt;validate42(ir.filter,{instancePath:e+"/descriptor/filter",parentData:ir,parentDataProperty:"filter",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate42.errors:jt.concat(validate42.errors),Lt=jt.length);var zt=pr===Lt}else var zt=!0}}}}}else return validate44.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=ar===Lt}else var tr=!0}}}else return validate44.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate44.errors=jt,Lt===0}validate44.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsWrite$1=validate47;function validate47(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate47.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),!validate27(xt,{instancePath:e,parentData:At,parentDataProperty:kt,rootData:Bt,dynamicAnchors:Nt}))jt=jt===null?validate27.errors:jt.concat(validate27.errors),Lt=jt.length;else var tr=validate27.evaluated.props;if(Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let zt;if(xt.recordId===void 0&&(zt="recordId")||xt.authorization===void 0&&(zt="authorization"))return validate47.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:zt},message:"must have required property '"+zt+"'"}],!1;if(tr!==!0){for(const rr in xt)if(!tr||!tr[rr])return validate47.errors=[{instancePath:e,schemaPath:"#/unevaluatedProperties",keyword:"unevaluatedProperties",params:{unevaluatedProperty:rr},message:"must NOT have unevaluated properties"}],!1}}else return validate47.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate47.errors=jt,Lt===0}validate47.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsWriteDataEncoded=validate26,RecordsWriteUnidentified=validate27,Definitions=validate22;function validate22(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate22.evaluated;return er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),xt&&typeof xt=="object"&&!Array.isArray(xt)?(validate22.errors=jt,Lt===0):(validate22.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1)}validate22.evaluated={dynamicProps:!1,dynamicItems:!1};const GeneralJwk=validate49;function validate49(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate49.evaluated;er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0);const tr=Lt;let zt=!1,rr=null;const nr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let br;if(xt.crv===void 0&&(br="crv")||xt.x===void 0&&(br="x")){const Ar={instancePath:e,schemaPath:"#/oneOf/0/required",keyword:"required",params:{missingProperty:br},message:"must have required property '"+br+"'"};jt===null?jt=[Ar]:jt.push(Ar),Lt++}else{if(xt.kty!==void 0){const Ar=Lt;if(xt.kty!=="EC"){const Pr={instancePath:e+"/kty",schemaPath:"#/oneOf/0/properties/kty/const",keyword:"const",params:{allowedValue:"EC"},message:"must be equal to constant"};jt===null?jt=[Pr]:jt.push(Pr),Lt++}var ir=Ar===Lt}else var ir=!0;if(ir){if(xt.crv!==void 0){const Ar=Lt;if(typeof xt.crv!="string"){const kr={instancePath:e+"/crv",schemaPath:"#/oneOf/0/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[kr]:jt.push(kr),Lt++}var ir=Ar===Lt}else var ir=!0;if(ir){if(xt.x!==void 0){const Ar=Lt;if(typeof xt.x!="string"){const kr={instancePath:e+"/x",schemaPath:"#/oneOf/0/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[kr]:jt.push(kr),Lt++}var ir=Ar===Lt}else var ir=!0;if(ir){if(xt.y!==void 0){const Ar=Lt;if(typeof xt.y!="string"){const kr={instancePath:e+"/y",schemaPath:"#/oneOf/0/properties/y/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[kr]:jt.push(kr),Lt++}var ir=Ar===Lt}else var ir=!0;if(ir)if(xt.d!==void 0){const Ar=Lt;if(typeof xt.d!="string"){const kr={instancePath:e+"/d",schemaPath:"#/oneOf/0/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[kr]:jt.push(kr),Lt++}var ir=Ar===Lt}else var ir=!0}}}}}var fr=nr===Lt;if(fr){zt=!0,rr=0;var ar={};ar.kty=!0,ar.crv=!0,ar.x=!0,ar.y=!0,ar.d=!0}const dr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let br;if(xt.crv===void 0&&(br="crv")||xt.x===void 0&&(br="x")){const Ar={instancePath:e,schemaPath:"#/oneOf/1/required",keyword:"required",params:{missingProperty:br},message:"must have required property '"+br+"'"};jt===null?jt=[Ar]:jt.push(Ar),Lt++}else{if(xt.kty!==void 0){const Ar=Lt;if(xt.kty!=="OKP"){const Pr={instancePath:e+"/kty",schemaPath:"#/oneOf/1/properties/kty/const",keyword:"const",params:{allowedValue:"OKP"},message:"must be equal to constant"};jt===null?jt=[Pr]:jt.push(Pr),Lt++}var ur=Ar===Lt}else var ur=!0;if(ur){if(xt.crv!==void 0){const Ar=Lt;if(typeof xt.crv!="string"){const kr={instancePath:e+"/crv",schemaPath:"#/oneOf/1/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[kr]:jt.push(kr),Lt++}var ur=Ar===Lt}else var ur=!0;if(ur){if(xt.x!==void 0){const Ar=Lt;if(typeof xt.x!="string"){const kr={instancePath:e+"/x",schemaPath:"#/oneOf/1/properties/x/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[kr]:jt.push(kr),Lt++}var ur=Ar===Lt}else var ur=!0;if(ur)if(xt.d!==void 0){const Ar=Lt;if(typeof xt.d!="string"){const kr={instancePath:e+"/d",schemaPath:"#/oneOf/1/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[kr]:jt.push(kr),Lt++}var ur=Ar===Lt}else var ur=!0}}}}var fr=dr===Lt;if(fr&&zt)zt=!1,rr=[rr,1];else{fr&&(zt=!0,rr=1,ar!==!0&&(ar=ar||{},ar.kty=!0,ar.crv=!0,ar.x=!0,ar.d=!0));const br=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Pr;if(xt.n===void 0&&(Pr="n")||xt.e===void 0&&(Pr="e")){const kr={instancePath:e,schemaPath:"#/oneOf/2/required",keyword:"required",params:{missingProperty:Pr},message:"must have required property '"+Pr+"'"};jt===null?jt=[kr]:jt.push(kr),Lt++}else{if(xt.kty!==void 0){const kr=Lt;if(xt.kty!=="RSA"){const Ur={instancePath:e+"/kty",schemaPath:"#/oneOf/2/properties/kty/const",keyword:"const",params:{allowedValue:"RSA"},message:"must be equal to constant"};jt===null?jt=[Ur]:jt.push(Ur),Lt++}var pr=kr===Lt}else var pr=!0;if(pr){if(xt.n!==void 0){const kr=Lt;if(typeof xt.n!="string"){const Hr={instancePath:e+"/n",schemaPath:"#/oneOf/2/properties/n/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Hr]:jt.push(Hr),Lt++}var pr=kr===Lt}else var pr=!0;if(pr){if(xt.e!==void 0){const kr=Lt;if(typeof xt.e!="string"){const Hr={instancePath:e+"/e",schemaPath:"#/oneOf/2/properties/e/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Hr]:jt.push(Hr),Lt++}var pr=kr===Lt}else var pr=!0;if(pr){if(xt.d!==void 0){const kr=Lt;if(typeof xt.d!="string"){const Hr={instancePath:e+"/d",schemaPath:"#/oneOf/2/properties/d/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Hr]:jt.push(Hr),Lt++}var pr=kr===Lt}else var pr=!0;if(pr){if(xt.p!==void 0){const kr=Lt;if(typeof xt.p!="string"){const Hr={instancePath:e+"/p",schemaPath:"#/oneOf/2/properties/p/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Hr]:jt.push(Hr),Lt++}var pr=kr===Lt}else var pr=!0;if(pr){if(xt.q!==void 0){const kr=Lt;if(typeof xt.q!="string"){const Hr={instancePath:e+"/q",schemaPath:"#/oneOf/2/properties/q/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Hr]:jt.push(Hr),Lt++}var pr=kr===Lt}else var pr=!0;if(pr){if(xt.dp!==void 0){const kr=Lt;if(typeof xt.dp!="string"){const Hr={instancePath:e+"/dp",schemaPath:"#/oneOf/2/properties/dp/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Hr]:jt.push(Hr),Lt++}var pr=kr===Lt}else var pr=!0;if(pr){if(xt.dq!==void 0){const kr=Lt;if(typeof xt.dq!="string"){const Hr={instancePath:e+"/dq",schemaPath:"#/oneOf/2/properties/dq/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Hr]:jt.push(Hr),Lt++}var pr=kr===Lt}else var pr=!0;if(pr){if(xt.qi!==void 0){const kr=Lt;if(typeof xt.qi!="string"){const Hr={instancePath:e+"/qi",schemaPath:"#/oneOf/2/properties/qi/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Hr]:jt.push(Hr),Lt++}var pr=kr===Lt}else var pr=!0;if(pr)if(xt.oth!==void 0){let kr=xt.oth;const Ur=Lt;if(!(kr&&typeof kr=="object"&&!Array.isArray(kr))){const Lr={instancePath:e+"/oth",schemaPath:"#/oneOf/2/properties/oth/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Lr]:jt.push(Lr),Lt++}var pr=Ur===Lt}else var pr=!0}}}}}}}}}}var fr=br===Lt;if(fr&&zt)zt=!1,rr=[rr,2];else{fr&&(zt=!0,rr=2,ar!==!0&&(ar=ar||{},ar.kty=!0,ar.n=!0,ar.e=!0,ar.d=!0,ar.p=!0,ar.q=!0,ar.dp=!0,ar.dq=!0,ar.qi=!0,ar.oth=!0));const Pr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Ur;if(xt.k===void 0&&(Ur="k")){const Hr={instancePath:e,schemaPath:"#/oneOf/3/required",keyword:"required",params:{missingProperty:Ur},message:"must have required property '"+Ur+"'"};jt===null?jt=[Hr]:jt.push(Hr),Lt++}else{if(xt.kty!==void 0){const Hr=Lt;if(xt.kty!=="oct"){const Lr={instancePath:e+"/kty",schemaPath:"#/oneOf/3/properties/kty/const",keyword:"const",params:{allowedValue:"oct"},message:"must be equal to constant"};jt===null?jt=[Lr]:jt.push(Lr),Lt++}var lr=Hr===Lt}else var lr=!0;if(lr)if(xt.k!==void 0){const Hr=Lt;if(typeof xt.k!="string"){const Sr={instancePath:e+"/k",schemaPath:"#/oneOf/3/properties/k/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Sr]:jt.push(Sr),Lt++}var lr=Hr===Lt}else var lr=!0}}var fr=Pr===Lt;fr&&zt?(zt=!1,rr=[rr,3]):fr&&(zt=!0,rr=3,ar!==!0&&(ar=ar||{},ar.kty=!0,ar.k=!0))}}if(zt)Lt=tr,jt!==null&&(tr?jt.length=tr:jt=null);else{const br={instancePath:e,schemaPath:"#/oneOf",keyword:"oneOf",params:{passingSchemas:rr},message:"must match exactly one schema in oneOf"};return jt===null?jt=[br]:jt.push(br),Lt++,validate49.errors=jt,!1}if(Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let br;if(xt.kty===void 0&&(br="kty"))return validate49.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:br},message:"must have required property '"+br+"'"}],!1;if(ar!==!0&&(ar=ar||{},ar.alg=!0,ar.kid=!0,ar.kty=!0,ar.crv=!0,ar.use=!0,ar.key_ops=!0,ar.x5u=!0,ar.x5c=!0,ar.x5t=!0,ar["x5t#S256"]=!0),xt.alg!==void 0){const Ar=Lt;if(typeof xt.alg!="string")return validate49.errors=[{instancePath:e+"/alg",schemaPath:"#/properties/alg/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Ar===Lt}else var yr=!0;if(yr){if(xt.kid!==void 0){const Ar=Lt;if(typeof xt.kid!="string")return validate49.errors=[{instancePath:e+"/kid",schemaPath:"#/properties/kid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Ar===Lt}else var yr=!0;if(yr){if(xt.kty!==void 0){let Ar=xt.kty;const Pr=Lt;if(!(Ar==="EC"||Ar==="RSA"||Ar==="oct"||Ar==="OKP"))return validate49.errors=[{instancePath:e+"/kty",schemaPath:"#/properties/kty/enum",keyword:"enum",params:{allowedValues:schema43.properties.kty.enum},message:"must be equal to one of the allowed values"}],!1;var yr=Pr===Lt}else var yr=!0;if(yr){if(xt.crv!==void 0){const Ar=Lt;if(typeof xt.crv!="string")return validate49.errors=[{instancePath:e+"/crv",schemaPath:"#/properties/crv/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Ar===Lt}else var yr=!0;if(yr){if(xt.use!==void 0){const Ar=Lt;if(typeof xt.use!="string")return validate49.errors=[{instancePath:e+"/use",schemaPath:"#/properties/use/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Ar===Lt}else var yr=!0;if(yr){if(xt.key_ops!==void 0){const Ar=Lt;if(typeof xt.key_ops!="string")return validate49.errors=[{instancePath:e+"/key_ops",schemaPath:"#/properties/key_ops/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Ar===Lt}else var yr=!0;if(yr){if(xt.x5u!==void 0){const Ar=Lt;if(typeof xt.x5u!="string")return validate49.errors=[{instancePath:e+"/x5u",schemaPath:"#/properties/x5u/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Ar===Lt}else var yr=!0;if(yr){if(xt.x5c!==void 0){const Ar=Lt;if(typeof xt.x5c!="string")return validate49.errors=[{instancePath:e+"/x5c",schemaPath:"#/properties/x5c/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Ar===Lt}else var yr=!0;if(yr){if(xt.x5t!==void 0){const Ar=Lt;if(typeof xt.x5t!="string")return validate49.errors=[{instancePath:e+"/x5t",schemaPath:"#/properties/x5t/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Ar===Lt}else var yr=!0;if(yr)if(xt["x5t#S256"]!==void 0){const Ar=Lt;if(typeof xt["x5t#S256"]!="string")return validate49.errors=[{instancePath:e+"/x5t#S256",schemaPath:"#/properties/x5t%23S256/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var yr=Ar===Lt}else var yr=!0}}}}}}}}}else return validate49.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate49.errors=jt,er.props=ar,Lt===0}validate49.evaluated={dynamicProps:!0,dynamicItems:!1};const GeneralJws=validate21,JwkVerificationMethod=validate50,schema75={$id:"https://identity.foundation/dwn/json-schemas/jwk-verification-method.json",$schema:"https://json-schema.org/draft/2020-12/schema",type:"object",additionalProperties:!1,required:["id","type","controller","publicKeyJwk"],properties:{id:{type:"string"},type:{enum:["JsonWebKey","JsonWebKey2020"]},controller:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"},publicKeyJwk:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"}}};function validate50(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate50.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let zt;if(xt.id===void 0&&(zt="id")||xt.type===void 0&&(zt="type")||xt.controller===void 0&&(zt="controller")||xt.publicKeyJwk===void 0&&(zt="publicKeyJwk"))return validate50.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:zt},message:"must have required property '"+zt+"'"}],!1;{const rr=Lt;for(const nr in xt)if(!(nr==="id"||nr==="type"||nr==="controller"||nr==="publicKeyJwk"))return validate50.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:nr},message:"must NOT have additional properties"}],!1;if(rr===Lt){if(xt.id!==void 0){const nr=Lt;if(typeof xt.id!="string")return validate50.errors=[{instancePath:e+"/id",schemaPath:"#/properties/id/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=nr===Lt}else var tr=!0;if(tr){if(xt.type!==void 0){let nr=xt.type;const ir=Lt;if(!(nr==="JsonWebKey"||nr==="JsonWebKey2020"))return validate50.errors=[{instancePath:e+"/type",schemaPath:"#/properties/type/enum",keyword:"enum",params:{allowedValues:schema75.properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var tr=ir===Lt}else var tr=!0;if(tr){if(xt.controller!==void 0){let nr=xt.controller;const ir=Lt;if(Lt===Lt)if(typeof nr=="string"){if(!pattern12.test(nr))return validate50.errors=[{instancePath:e+"/controller",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return validate50.errors=[{instancePath:e+"/controller",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=ir===Lt}else var tr=!0;if(tr)if(xt.publicKeyJwk!==void 0){const nr=Lt;validate33(xt.publicKeyJwk,{instancePath:e+"/publicKeyJwk",parentData:xt,parentDataProperty:"publicKeyJwk",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate33.errors:jt.concat(validate33.errors),Lt=jt.length);var tr=nr===Lt}else var tr=!0}}}}}else return validate50.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate50.errors=jt,Lt===0}validate50.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const MessagesFilter=validate52,schema77={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-filter.json",type:"object",additionalProperties:!1,minProperties:1,properties:{interface:{enum:["Protocols","Records"],type:"string"},method:{enum:["Configure","Delete","Write"],type:"string"},protocol:{type:"string"},messageTimestamp:{type:"object",minProperties:1,additionalProperties:!1,properties:{from:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},to:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"}}}}};function validate52(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate52.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),xt&&typeof xt=="object"&&!Array.isArray(xt)){if(Object.keys(xt).length<1)return validate52.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const rr in xt)if(!(rr==="interface"||rr==="method"||rr==="protocol"||rr==="messageTimestamp"))return validate52.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:rr},message:"must NOT have additional properties"}],!1;{if(xt.interface!==void 0){let rr=xt.interface;const nr=Lt;if(typeof rr!="string")return validate52.errors=[{instancePath:e+"/interface",schemaPath:"#/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(rr==="Protocols"||rr==="Records"))return validate52.errors=[{instancePath:e+"/interface",schemaPath:"#/properties/interface/enum",keyword:"enum",params:{allowedValues:schema77.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var tr=nr===Lt}else var tr=!0;if(tr){if(xt.method!==void 0){let rr=xt.method;const nr=Lt;if(typeof rr!="string")return validate52.errors=[{instancePath:e+"/method",schemaPath:"#/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(rr==="Configure"||rr==="Delete"||rr==="Write"))return validate52.errors=[{instancePath:e+"/method",schemaPath:"#/properties/method/enum",keyword:"enum",params:{allowedValues:schema77.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var tr=nr===Lt}else var tr=!0;if(tr){if(xt.protocol!==void 0){const rr=Lt;if(typeof xt.protocol!="string")return validate52.errors=[{instancePath:e+"/protocol",schemaPath:"#/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr)if(xt.messageTimestamp!==void 0){let rr=xt.messageTimestamp;const nr=Lt;if(rr&&typeof rr=="object"&&!Array.isArray(rr)){if(Object.keys(rr).length<1)return validate52.errors=[{instancePath:e+"/messageTimestamp",schemaPath:"#/properties/messageTimestamp/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;for(const ar in rr)if(!(ar==="from"||ar==="to"))return validate52.errors=[{instancePath:e+"/messageTimestamp",schemaPath:"#/properties/messageTimestamp/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ar},message:"must NOT have additional properties"}],!1;{if(rr.from!==void 0){let ar=rr.from;const dr=Lt;if(typeof ar=="string"){if(!pattern14.test(ar))return validate52.errors=[{instancePath:e+"/messageTimestamp/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate52.errors=[{instancePath:e+"/messageTimestamp/from",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=dr===Lt}else var zt=!0;if(zt)if(rr.to!==void 0){let ar=rr.to;const dr=Lt;if(typeof ar=="string"){if(!pattern14.test(ar))return validate52.errors=[{instancePath:e+"/messageTimestamp/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate52.errors=[{instancePath:e+"/messageTimestamp/to",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=dr===Lt}else var zt=!0}}else return validate52.errors=[{instancePath:e+"/messageTimestamp",schemaPath:"#/properties/messageTimestamp/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=nr===Lt}else var tr=!0}}}}else return validate52.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate52.errors=jt,Lt===0}validate52.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const MessagesQuery$1=validate53,schema80={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-query.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filters"],properties:{interface:{enum:["Messages"],type:"string"},method:{enum:["Query"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filters:{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/messages-filter.json"}},cursor:{$ref:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json"}}}}};function validate53(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate53.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let ir;if(xt.authorization===void 0&&(ir="authorization")||xt.descriptor===void 0&&(ir="descriptor"))return validate53.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:ir},message:"must have required property '"+ir+"'"}],!1;{const ar=Lt;for(const dr in xt)if(!(dr==="authorization"||dr==="descriptor"))return validate53.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:dr},message:"must NOT have additional properties"}],!1;if(ar===Lt){if(xt.authorization!==void 0){const dr=Lt;validate20(xt.authorization,{instancePath:e+"/authorization",parentData:xt,parentDataProperty:"authorization",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate20.errors:jt.concat(validate20.errors),Lt=jt.length);var tr=dr===Lt}else var tr=!0;if(tr)if(xt.descriptor!==void 0){let dr=xt.descriptor;const ur=Lt;if(Lt===ur)if(dr&&typeof dr=="object"&&!Array.isArray(dr)){let pr;if(dr.interface===void 0&&(pr="interface")||dr.method===void 0&&(pr="method")||dr.messageTimestamp===void 0&&(pr="messageTimestamp")||dr.filters===void 0&&(pr="filters"))return validate53.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:pr},message:"must have required property '"+pr+"'"}],!1;{const lr=Lt;for(const yr in dr)if(!(yr==="interface"||yr==="method"||yr==="messageTimestamp"||yr==="filters"||yr==="cursor"))return validate53.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:yr},message:"must NOT have additional properties"}],!1;if(lr===Lt){if(dr.interface!==void 0){let yr=dr.interface;const br=Lt;if(typeof yr!="string")return validate53.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(yr!=="Messages")return validate53.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema80.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var zt=br===Lt}else var zt=!0;if(zt){if(dr.method!==void 0){let yr=dr.method;const br=Lt;if(typeof yr!="string")return validate53.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(yr!=="Query")return validate53.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema80.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var zt=br===Lt}else var zt=!0;if(zt){if(dr.messageTimestamp!==void 0){let yr=dr.messageTimestamp;const br=Lt;if(Lt===Lt)if(typeof yr=="string"){if(!pattern14.test(yr))return validate53.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate53.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=br===Lt}else var zt=!0;if(zt){if(dr.filters!==void 0){let yr=dr.filters;const br=Lt;if(Lt===br)if(Array.isArray(yr)){var rr=!0;const Pr=yr.length;for(let kr=0;kr<Pr;kr++){const Ur=Lt;validate52(yr[kr],{instancePath:e+"/descriptor/filters/"+kr,parentData:yr,parentDataProperty:kr,rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate52.errors:jt.concat(validate52.errors),Lt=jt.length);var rr=Ur===Lt;if(!rr)break}}else return validate53.errors=[{instancePath:e+"/descriptor/filters",schemaPath:"#/properties/descriptor/properties/filters/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var zt=br===Lt}else var zt=!0;if(zt)if(dr.cursor!==void 0){let yr=dr.cursor;const br=Lt;if(Lt===Lt)if(yr&&typeof yr=="object"&&!Array.isArray(yr)){if(Object.keys(yr).length<1)return validate53.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{let kr;if(yr.messageCid===void 0&&(kr="messageCid")||yr.value===void 0&&(kr="value"))return validate53.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/required",keyword:"required",params:{missingProperty:kr},message:"must have required property '"+kr+"'"}],!1;{const Ur=Lt;for(const Hr in yr)if(!(Hr==="messageCid"||Hr==="value"))return validate53.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Hr},message:"must NOT have additional properties"}],!1;if(Ur===Lt){if(yr.messageCid!==void 0){const Hr=Lt;if(typeof yr.messageCid!="string")return validate53.errors=[{instancePath:e+"/descriptor/cursor/messageCid",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var nr=Hr===Lt}else var nr=!0;if(nr)if(yr.value!==void 0){let Hr=yr.value;const Lr=Lt;if(typeof Hr!="string"&&!(typeof Hr=="number"&&isFinite(Hr)))return validate53.errors=[{instancePath:e+"/descriptor/cursor/value",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/properties/value/type",keyword:"type",params:{type:schema70.properties.value.type},message:"must be string,number"}],!1;var nr=Lr===Lt}else var nr=!0}}}}else return validate53.errors=[{instancePath:e+"/descriptor/cursor",schemaPath:"https://identity.foundation/dwn/json-schemas/pagination-cursor.json/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=br===Lt}else var zt=!0}}}}}}else return validate53.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=ur===Lt}else var tr=!0}}}else return validate53.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate53.errors=jt,Lt===0}validate53.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const MessagesRead$1=validate56,schema83={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-read.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp"],properties:{interface:{enum:["Messages"],type:"string"},method:{enum:["Read"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},messageCid:{type:"string"}}}}};function validate56(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate56.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let rr;if(xt.authorization===void 0&&(rr="authorization")||xt.descriptor===void 0&&(rr="descriptor"))return validate56.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:rr},message:"must have required property '"+rr+"'"}],!1;{const nr=Lt;for(const ir in xt)if(!(ir==="authorization"||ir==="descriptor"))return validate56.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ir},message:"must NOT have additional properties"}],!1;if(nr===Lt){if(xt.authorization!==void 0){const ir=Lt;validate20(xt.authorization,{instancePath:e+"/authorization",parentData:xt,parentDataProperty:"authorization",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate20.errors:jt.concat(validate20.errors),Lt=jt.length);var tr=ir===Lt}else var tr=!0;if(tr)if(xt.descriptor!==void 0){let ir=xt.descriptor;const ar=Lt;if(Lt===ar)if(ir&&typeof ir=="object"&&!Array.isArray(ir)){let ur;if(ir.interface===void 0&&(ur="interface")||ir.method===void 0&&(ur="method")||ir.messageTimestamp===void 0&&(ur="messageTimestamp"))return validate56.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:ur},message:"must have required property '"+ur+"'"}],!1;{const fr=Lt;for(const pr in ir)if(!(pr==="interface"||pr==="method"||pr==="messageTimestamp"||pr==="messageCid"))return validate56.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:pr},message:"must NOT have additional properties"}],!1;if(fr===Lt){if(ir.interface!==void 0){let pr=ir.interface;const lr=Lt;if(typeof pr!="string")return validate56.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(pr!=="Messages")return validate56.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema83.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.method!==void 0){let pr=ir.method;const lr=Lt;if(typeof pr!="string")return validate56.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(pr!=="Read")return validate56.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema83.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.messageTimestamp!==void 0){let pr=ir.messageTimestamp;const lr=Lt;if(Lt===Lt)if(typeof pr=="string"){if(!pattern14.test(pr))return validate56.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate56.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=lr===Lt}else var zt=!0;if(zt)if(ir.messageCid!==void 0){const pr=Lt;if(typeof ir.messageCid!="string")return validate56.errors=[{instancePath:e+"/descriptor/messageCid",schemaPath:"#/properties/descriptor/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=pr===Lt}else var zt=!0}}}}}else return validate56.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=ar===Lt}else var tr=!0}}}else return validate56.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate56.errors=jt,Lt===0}validate56.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const MessagesSubscribe$1=validate58,schema85={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/messages-subscribe.json",type:"object",additionalProperties:!1,required:["descriptor","authorization"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filters"],properties:{interface:{enum:["Messages"],type:"string"},method:{enum:["Subscribe"],type:"string"},messageTimestamp:{type:"string"},filters:{type:"array",items:{$ref:"https://identity.foundation/dwn/json-schemas/messages-filter.json"}}}}}};function validate58(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate58.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let nr;if(xt.descriptor===void 0&&(nr="descriptor")||xt.authorization===void 0&&(nr="authorization"))return validate58.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:nr},message:"must have required property '"+nr+"'"}],!1;{const ir=Lt;for(const ar in xt)if(!(ar==="authorization"||ar==="descriptor"))return validate58.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ar},message:"must NOT have additional properties"}],!1;if(ir===Lt){if(xt.authorization!==void 0){const ar=Lt;validate20(xt.authorization,{instancePath:e+"/authorization",parentData:xt,parentDataProperty:"authorization",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate20.errors:jt.concat(validate20.errors),Lt=jt.length);var tr=ar===Lt}else var tr=!0;if(tr)if(xt.descriptor!==void 0){let ar=xt.descriptor;const dr=Lt;if(Lt===dr)if(ar&&typeof ar=="object"&&!Array.isArray(ar)){let fr;if(ar.interface===void 0&&(fr="interface")||ar.method===void 0&&(fr="method")||ar.messageTimestamp===void 0&&(fr="messageTimestamp")||ar.filters===void 0&&(fr="filters"))return validate58.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:fr},message:"must have required property '"+fr+"'"}],!1;{const pr=Lt;for(const lr in ar)if(!(lr==="interface"||lr==="method"||lr==="messageTimestamp"||lr==="filters"))return validate58.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:lr},message:"must NOT have additional properties"}],!1;if(pr===Lt){if(ar.interface!==void 0){let lr=ar.interface;const yr=Lt;if(typeof lr!="string")return validate58.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(lr!=="Messages")return validate58.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema85.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var zt=yr===Lt}else var zt=!0;if(zt){if(ar.method!==void 0){let lr=ar.method;const yr=Lt;if(typeof lr!="string")return validate58.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(lr!=="Subscribe")return validate58.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema85.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var zt=yr===Lt}else var zt=!0;if(zt){if(ar.messageTimestamp!==void 0){const lr=Lt;if(typeof ar.messageTimestamp!="string")return validate58.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"#/properties/descriptor/properties/messageTimestamp/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=lr===Lt}else var zt=!0;if(zt)if(ar.filters!==void 0){let lr=ar.filters;const yr=Lt;if(Lt===yr)if(Array.isArray(lr)){var rr=!0;const Ar=lr.length;for(let Pr=0;Pr<Ar;Pr++){const kr=Lt;validate52(lr[Pr],{instancePath:e+"/descriptor/filters/"+Pr,parentData:lr,parentDataProperty:Pr,rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate52.errors:jt.concat(validate52.errors),Lt=jt.length);var rr=kr===Lt;if(!rr)break}}else return validate58.errors=[{instancePath:e+"/descriptor/filters",schemaPath:"#/properties/descriptor/properties/filters/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var zt=yr===Lt}else var zt=!0}}}}}else return validate58.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=dr===Lt}else var tr=!0}}}else return validate58.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate58.errors=jt,Lt===0}validate58.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const NumberRangeFilter=validate61;function validate61(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate61.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){if(Object.keys(xt).length<1)return validate61.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const dr=Lt;for(const ur in xt)if(!(ur==="gt"||ur==="gte"||ur==="lt"||ur==="lte"))return validate61.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ur},message:"must NOT have additional properties"}],!1;if(dr===Lt){if(xt.gt!==void 0){const ur=Lt,fr=Lt,pr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.gte===void 0){const lr={};jt===null?jt=[lr]:jt.push(lr),Lt++}var tr=pr===Lt;if(tr)return validate61.errors=[{instancePath:e,schemaPath:"#/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=fr,jt!==null&&(fr?jt.length=fr:jt=null);var zt=ur===Lt}else var zt=!0;if(zt){if(xt.gte!==void 0){const ur=Lt,fr=Lt,pr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.gt===void 0){const yr={};jt===null?jt=[yr]:jt.push(yr),Lt++}var rr=pr===Lt;if(rr)return validate61.errors=[{instancePath:e,schemaPath:"#/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=fr,jt!==null&&(fr?jt.length=fr:jt=null);var zt=ur===Lt}else var zt=!0;if(zt){if(xt.lt!==void 0){const ur=Lt,fr=Lt,pr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.lte===void 0){const yr={};jt===null?jt=[yr]:jt.push(yr),Lt++}var nr=pr===Lt;if(nr)return validate61.errors=[{instancePath:e,schemaPath:"#/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=fr,jt!==null&&(fr?jt.length=fr:jt=null);var zt=ur===Lt}else var zt=!0;if(zt){if(xt.lte!==void 0){const ur=Lt,fr=Lt,pr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.lt===void 0){const yr={};jt===null?jt=[yr]:jt.push(yr),Lt++}var ir=pr===Lt;if(ir)return validate61.errors=[{instancePath:e,schemaPath:"#/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=fr,jt!==null&&(fr?jt.length=fr:jt=null);var zt=ur===Lt}else var zt=!0;if(zt){if(xt.gt!==void 0){let ur=xt.gt;const fr=Lt;if(!(typeof ur=="number"&&isFinite(ur)))return validate61.errors=[{instancePath:e+"/gt",schemaPath:"#/properties/gt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var ar=fr===Lt}else var ar=!0;if(ar){if(xt.gte!==void 0){let ur=xt.gte;const fr=Lt;if(!(typeof ur=="number"&&isFinite(ur)))return validate61.errors=[{instancePath:e+"/gte",schemaPath:"#/properties/gte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var ar=fr===Lt}else var ar=!0;if(ar){if(xt.lt!==void 0){let ur=xt.lt;const fr=Lt;if(!(typeof ur=="number"&&isFinite(ur)))return validate61.errors=[{instancePath:e+"/lt",schemaPath:"#/properties/lt/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var ar=fr===Lt}else var ar=!0;if(ar)if(xt.lte!==void 0){let ur=xt.lte;const fr=Lt;if(!(typeof ur=="number"&&isFinite(ur)))return validate61.errors=[{instancePath:e+"/lte",schemaPath:"#/properties/lte/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var ar=fr===Lt}else var ar=!0}}}}}}}}}else return validate61.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate61.errors=jt,Lt===0}validate61.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const PaginationCursor=validate62;function validate62(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate62.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),xt&&typeof xt=="object"&&!Array.isArray(xt)){if(Object.keys(xt).length<1)return validate62.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{let zt;if(xt.messageCid===void 0&&(zt="messageCid")||xt.value===void 0&&(zt="value"))return validate62.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:zt},message:"must have required property '"+zt+"'"}],!1;for(const rr in xt)if(!(rr==="messageCid"||rr==="value"))return validate62.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:rr},message:"must NOT have additional properties"}],!1;{if(xt.messageCid!==void 0){const rr=Lt;if(typeof xt.messageCid!="string")return validate62.errors=[{instancePath:e+"/messageCid",schemaPath:"#/properties/messageCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr)if(xt.value!==void 0){let rr=xt.value;const nr=Lt;if(typeof rr!="string"&&!(typeof rr=="number"&&isFinite(rr)))return validate62.errors=[{instancePath:e+"/value",schemaPath:"#/properties/value/type",keyword:"type",params:{type:schema70.properties.value.type},message:"must be string,number"}],!1;var tr=nr===Lt}else var tr=!0}}}else return validate62.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate62.errors=jt,Lt===0}validate62.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const PermissionGrantData=validate63,schema103={type:"object",additionalProperties:!1,properties:{publication:{enum:["Required","Prohibited"],type:"string"}}};function validate65(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate65.evaluated;er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0);const tr=Lt;let zt=!1,rr=null;const nr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Sr;if(xt.interface===void 0&&(Sr="interface")||xt.method===void 0&&(Sr="method")){const _r={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/required",keyword:"required",params:{missingProperty:Sr},message:"must have required property '"+Sr+"'"};jt===null?jt=[_r]:jt.push(_r),Lt++}else{const _r=Lt;for(const gr in xt)if(!(gr==="interface"||gr==="method"||gr==="protocol")){const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:gr},message:"must NOT have additional properties"};jt===null?jt=[wr]:jt.push(wr),Lt++;break}if(_r===Lt){if(xt.interface!==void 0){const gr=Lt;if(xt.interface!=="Messages"){const wr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};jt===null?jt=[wr]:jt.push(wr),Lt++}var ar=gr===Lt}else var ar=!0;if(ar){if(xt.method!==void 0){const gr=Lt;if(xt.method!=="Query"){const Dr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}var ar=gr===Lt}else var ar=!0;if(ar)if(xt.protocol!==void 0){const gr=Lt;if(typeof xt.protocol!="string"){const Dr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}var ar=gr===Lt}else var ar=!0}}}}else{const Sr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Sr]:jt.push(Sr),Lt++}var lr=nr===Lt;if(lr){zt=!0,rr=0;var dr=!0}const ur=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Sr;if(xt.interface===void 0&&(Sr="interface")||xt.method===void 0&&(Sr="method")){const _r={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/required",keyword:"required",params:{missingProperty:Sr},message:"must have required property '"+Sr+"'"};jt===null?jt=[_r]:jt.push(_r),Lt++}else{const _r=Lt;for(const gr in xt)if(!(gr==="interface"||gr==="method"||gr==="protocol")){const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:gr},message:"must NOT have additional properties"};jt===null?jt=[wr]:jt.push(wr),Lt++;break}if(_r===Lt){if(xt.interface!==void 0){const gr=Lt;if(xt.interface!=="Messages"){const wr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};jt===null?jt=[wr]:jt.push(wr),Lt++}var pr=gr===Lt}else var pr=!0;if(pr){if(xt.method!==void 0){const gr=Lt;if(xt.method!=="Read"){const Dr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}var pr=gr===Lt}else var pr=!0;if(pr)if(xt.protocol!==void 0){const gr=Lt;if(typeof xt.protocol!="string"){const Dr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}var pr=gr===Lt}else var pr=!0}}}}else{const Sr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Sr]:jt.push(Sr),Lt++}var lr=ur===Lt;if(lr&&zt)zt=!1,rr=[rr,1];else{lr&&(zt=!0,rr=1,dr!==!0&&(dr=!0));const Sr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let wr;if(xt.interface===void 0&&(wr="interface")||xt.method===void 0&&(wr="method")){const Dr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/required",keyword:"required",params:{missingProperty:wr},message:"must have required property '"+wr+"'"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}else{const Dr=Lt;for(const xr in xt)if(!(xr==="interface"||xr==="method"||xr==="protocol")){const Ir={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:xr},message:"must NOT have additional properties"};jt===null?jt=[Ir]:jt.push(Ir),Lt++;break}if(Dr===Lt){if(xt.interface!==void 0){const xr=Lt;if(xt.interface!=="Messages"){const Ir={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};jt===null?jt=[Ir]:jt.push(Ir),Lt++}var yr=xr===Lt}else var yr=!0;if(yr){if(xt.method!==void 0){const xr=Lt;if(xt.method!=="Subscribe"){const $r={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};jt===null?jt=[$r]:jt.push($r),Lt++}var yr=xr===Lt}else var yr=!0;if(yr)if(xt.protocol!==void 0){const xr=Lt;if(typeof xt.protocol!="string"){const $r={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[$r]:jt.push($r),Lt++}var yr=xr===Lt}else var yr=!0}}}}else{const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[wr]:jt.push(wr),Lt++}var lr=Sr===Lt;if(lr&&zt)zt=!1,rr=[rr,2];else{lr&&(zt=!0,rr=2,dr!==!0&&(dr=!0));const wr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Ir;if(xt.interface===void 0&&(Ir="interface")||xt.method===void 0&&(Ir="method")){const $r={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/required",keyword:"required",params:{missingProperty:Ir},message:"must have required property '"+Ir+"'"};jt===null?jt=[$r]:jt.push($r),Lt++}else{const $r=Lt;for(const vr in xt)if(!(vr==="interface"||vr==="method"||vr==="protocol")){const Er={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:vr},message:"must NOT have additional properties"};jt===null?jt=[Er]:jt.push(Er),Lt++;break}if($r===Lt){if(xt.interface!==void 0){const vr=Lt;if(xt.interface!=="Protocols"){const Er={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};jt===null?jt=[Er]:jt.push(Er),Lt++}var br=vr===Lt}else var br=!0;if(br){if(xt.method!==void 0){const vr=Lt;if(xt.method!=="Configure"){const Tr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/method/const",keyword:"const",params:{allowedValue:"Configure"},message:"must be equal to constant"};jt===null?jt=[Tr]:jt.push(Tr),Lt++}var br=vr===Lt}else var br=!0;if(br)if(xt.protocol!==void 0){const vr=Lt;if(typeof xt.protocol!="string"){const Tr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Tr]:jt.push(Tr),Lt++}var br=vr===Lt}else var br=!0}}}}else{const Ir={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Ir]:jt.push(Ir),Lt++}var lr=wr===Lt;if(lr&&zt)zt=!1,rr=[rr,3];else{lr&&(zt=!0,rr=3,dr!==!0&&(dr=!0));const Ir=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Er;if(xt.interface===void 0&&(Er="interface")||xt.method===void 0&&(Er="method")){const Tr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/required",keyword:"required",params:{missingProperty:Er},message:"must have required property '"+Er+"'"};jt===null?jt=[Tr]:jt.push(Tr),Lt++}else{const Tr=Lt;for(const Rr in xt)if(!(Rr==="interface"||Rr==="method"||Rr==="protocol")){const Mr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Rr},message:"must NOT have additional properties"};jt===null?jt=[Mr]:jt.push(Mr),Lt++;break}if(Tr===Lt){if(xt.interface!==void 0){const Rr=Lt;if(xt.interface!=="Protocols"){const Mr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};jt===null?jt=[Mr]:jt.push(Mr),Lt++}var Ar=Rr===Lt}else var Ar=!0;if(Ar){if(xt.method!==void 0){const Rr=Lt;if(xt.method!=="Query"){const Gr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};jt===null?jt=[Gr]:jt.push(Gr),Lt++}var Ar=Rr===Lt}else var Ar=!0;if(Ar)if(xt.protocol!==void 0){const Rr=Lt;if(typeof xt.protocol!="string"){const Gr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Gr]:jt.push(Gr),Lt++}var Ar=Rr===Lt}else var Ar=!0}}}}else{const Er={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Er]:jt.push(Er),Lt++}var lr=Ir===Lt;if(lr&&zt)zt=!1,rr=[rr,4];else{lr&&(zt=!0,rr=4,dr!==!0&&(dr=!0));const Er=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Mr;if(xt.interface===void 0&&(Mr="interface")||xt.method===void 0&&(Mr="method")){const Gr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/required",keyword:"required",params:{missingProperty:Mr},message:"must have required property '"+Mr+"'"};jt===null?jt=[Gr]:jt.push(Gr),Lt++}else{const Gr=Lt;for(const Br in xt)if(!(Br==="interface"||Br==="method"||Br==="protocol"||Br==="contextId"||Br==="protocolPath")){const Cr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Br},message:"must NOT have additional properties"};jt===null?jt=[Cr]:jt.push(Cr),Lt++;break}if(Gr===Lt){if(xt.interface!==void 0){const Br=Lt;if(xt.interface!=="Records"){const Cr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};jt===null?jt=[Cr]:jt.push(Cr),Lt++}var Pr=Br===Lt}else var Pr=!0;if(Pr){if(xt.method!==void 0){const Br=Lt;if(xt.method!=="Read"){const jr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};jt===null?jt=[jr]:jt.push(jr),Lt++}var Pr=Br===Lt}else var Pr=!0;if(Pr){if(xt.protocol!==void 0){const Br=Lt;if(typeof xt.protocol!="string"){const jr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[jr]:jt.push(jr),Lt++}var Pr=Br===Lt}else var Pr=!0;if(Pr){if(xt.contextId!==void 0){const Br=Lt;if(typeof xt.contextId!="string"){const jr={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[jr]:jt.push(jr),Lt++}var Pr=Br===Lt}else var Pr=!0;if(Pr)if(xt.protocolPath!==void 0){const Br=Lt;if(typeof xt.protocolPath!="string"){const jr={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[jr]:jt.push(jr),Lt++}var Pr=Br===Lt}else var Pr=!0}}}}}}else{const Mr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Mr]:jt.push(Mr),Lt++}var lr=Er===Lt;if(lr&&zt)zt=!1,rr=[rr,5];else{lr&&(zt=!0,rr=5,dr!==!0&&(dr=!0));const Mr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Cr;if(xt.interface===void 0&&(Cr="interface")||xt.method===void 0&&(Cr="method")){const jr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/required",keyword:"required",params:{missingProperty:Cr},message:"must have required property '"+Cr+"'"};jt===null?jt=[jr]:jt.push(jr),Lt++}else{const jr=Lt;for(const Yr in xt)if(!(Yr==="interface"||Yr==="method"||Yr==="protocol"||Yr==="contextId"||Yr==="protocolPath")){const Qr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Yr},message:"must NOT have additional properties"};jt===null?jt=[Qr]:jt.push(Qr),Lt++;break}if(jr===Lt){if(xt.interface!==void 0){const Yr=Lt;if(xt.interface!=="Records"){const Qr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};jt===null?jt=[Qr]:jt.push(Qr),Lt++}var kr=Yr===Lt}else var kr=!0;if(kr){if(xt.method!==void 0){const Yr=Lt;if(xt.method!=="Delete"){const Jr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/method/const",keyword:"const",params:{allowedValue:"Delete"},message:"must be equal to constant"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}var kr=Yr===Lt}else var kr=!0;if(kr){if(xt.protocol!==void 0){const Yr=Lt;if(typeof xt.protocol!="string"){const Jr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}var kr=Yr===Lt}else var kr=!0;if(kr){if(xt.contextId!==void 0){const Yr=Lt;if(typeof xt.contextId!="string"){const Jr={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}var kr=Yr===Lt}else var kr=!0;if(kr)if(xt.protocolPath!==void 0){const Yr=Lt;if(typeof xt.protocolPath!="string"){const Jr={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}var kr=Yr===Lt}else var kr=!0}}}}}}else{const Cr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Cr]:jt.push(Cr),Lt++}var lr=Mr===Lt;if(lr&&zt)zt=!1,rr=[rr,6];else{lr&&(zt=!0,rr=6,dr!==!0&&(dr=!0));const Cr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Qr;if(xt.interface===void 0&&(Qr="interface")||xt.method===void 0&&(Qr="method")){const Jr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/required",keyword:"required",params:{missingProperty:Qr},message:"must have required property '"+Qr+"'"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}else{const Jr=Lt;for(const Wr in xt)if(!(Wr==="interface"||Wr==="method"||Wr==="protocol"||Wr==="contextId"||Wr==="protocolPath")){const Nr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Wr},message:"must NOT have additional properties"};jt===null?jt=[Nr]:jt.push(Nr),Lt++;break}if(Jr===Lt){if(xt.interface!==void 0){const Wr=Lt;if(xt.interface!=="Records"){const Nr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};jt===null?jt=[Nr]:jt.push(Nr),Lt++}var Ur=Wr===Lt}else var Ur=!0;if(Ur){if(xt.method!==void 0){const Wr=Lt;if(xt.method!=="Write"){const Vr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/method/const",keyword:"const",params:{allowedValue:"Write"},message:"must be equal to constant"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}var Ur=Wr===Lt}else var Ur=!0;if(Ur){if(xt.protocol!==void 0){const Wr=Lt;if(typeof xt.protocol!="string"){const Vr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}var Ur=Wr===Lt}else var Ur=!0;if(Ur){if(xt.contextId!==void 0){const Wr=Lt;if(typeof xt.contextId!="string"){const Vr={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}var Ur=Wr===Lt}else var Ur=!0;if(Ur)if(xt.protocolPath!==void 0){const Wr=Lt;if(typeof xt.protocolPath!="string"){const Vr={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}var Ur=Wr===Lt}else var Ur=!0}}}}}}else{const Qr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Qr]:jt.push(Qr),Lt++}var lr=Cr===Lt;if(lr&&zt)zt=!1,rr=[rr,7];else{lr&&(zt=!0,rr=7,dr!==!0&&(dr=!0));const Qr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Nr;if(xt.interface===void 0&&(Nr="interface")||xt.method===void 0&&(Nr="method")){const Vr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/required",keyword:"required",params:{missingProperty:Nr},message:"must have required property '"+Nr+"'"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}else{const Vr=Lt;for(const Xr in xt)if(!(Xr==="interface"||Xr==="method"||Xr==="protocol"||Xr==="contextId"||Xr==="protocolPath")){const qr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Xr},message:"must NOT have additional properties"};jt===null?jt=[qr]:jt.push(qr),Lt++;break}if(Vr===Lt){if(xt.interface!==void 0){const Xr=Lt;if(xt.interface!=="Records"){const qr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};jt===null?jt=[qr]:jt.push(qr),Lt++}var Hr=Xr===Lt}else var Hr=!0;if(Hr){if(xt.method!==void 0){const Xr=Lt;if(xt.method!=="Query"){const Or={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};jt===null?jt=[Or]:jt.push(Or),Lt++}var Hr=Xr===Lt}else var Hr=!0;if(Hr){if(xt.protocol!==void 0){const Xr=Lt;if(typeof xt.protocol!="string"){const Or={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Or]:jt.push(Or),Lt++}var Hr=Xr===Lt}else var Hr=!0;if(Hr){if(xt.contextId!==void 0){const Xr=Lt;if(typeof xt.contextId!="string"){const Or={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Or]:jt.push(Or),Lt++}var Hr=Xr===Lt}else var Hr=!0;if(Hr)if(xt.protocolPath!==void 0){const Xr=Lt;if(typeof xt.protocolPath!="string"){const Or={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Or]:jt.push(Or),Lt++}var Hr=Xr===Lt}else var Hr=!0}}}}}}else{const Nr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Nr]:jt.push(Nr),Lt++}var lr=Qr===Lt;if(lr&&zt)zt=!1,rr=[rr,8];else{lr&&(zt=!0,rr=8,dr!==!0&&(dr=!0));const Nr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let qr;if(xt.interface===void 0&&(qr="interface")||xt.method===void 0&&(qr="method")){const Or={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/required",keyword:"required",params:{missingProperty:qr},message:"must have required property '"+qr+"'"};jt===null?jt=[Or]:jt.push(Or),Lt++}else{const Or=Lt;for(const Fr in xt)if(!(Fr==="interface"||Fr==="method"||Fr==="protocol"||Fr==="contextId"||Fr==="protocolPath")){const Zr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Fr},message:"must NOT have additional properties"};jt===null?jt=[Zr]:jt.push(Zr),Lt++;break}if(Or===Lt){if(xt.interface!==void 0){const Fr=Lt;if(xt.interface!=="Records"){const Zr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};jt===null?jt=[Zr]:jt.push(Zr),Lt++}var Lr=Fr===Lt}else var Lr=!0;if(Lr){if(xt.method!==void 0){const Fr=Lt;if(xt.method!=="Subscribe"){const rn={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};jt===null?jt=[rn]:jt.push(rn),Lt++}var Lr=Fr===Lt}else var Lr=!0;if(Lr){if(xt.protocol!==void 0){const Fr=Lt;if(typeof xt.protocol!="string"){const rn={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[rn]:jt.push(rn),Lt++}var Lr=Fr===Lt}else var Lr=!0;if(Lr){if(xt.contextId!==void 0){const Fr=Lt;if(typeof xt.contextId!="string"){const rn={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[rn]:jt.push(rn),Lt++}var Lr=Fr===Lt}else var Lr=!0;if(Lr)if(xt.protocolPath!==void 0){const Fr=Lt;if(typeof xt.protocolPath!="string"){const rn={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[rn]:jt.push(rn),Lt++}var Lr=Fr===Lt}else var Lr=!0}}}}}}else{const qr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[qr]:jt.push(qr),Lt++}var lr=Nr===Lt;lr&&zt?(zt=!1,rr=[rr,9]):lr&&(zt=!0,rr=9,dr!==!0&&(dr=!0))}}}}}}}}if(zt)Lt=tr,jt!==null&&(tr?jt.length=tr:jt=null);else{const Sr={instancePath:e,schemaPath:"#/oneOf",keyword:"oneOf",params:{passingSchemas:rr},message:"must match exactly one schema in oneOf"};return jt===null?jt=[Sr]:jt.push(Sr),Lt++,validate65.errors=jt,!1}return validate65.errors=jt,er.props=dr,Lt===0}validate65.evaluated={dynamicProps:!0,dynamicItems:!1};function validate63(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate63.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let zt;if(xt.dateExpires===void 0&&(zt="dateExpires")||xt.scope===void 0&&(zt="scope"))return validate63.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:zt},message:"must have required property '"+zt+"'"}],!1;{const rr=Lt;for(const nr in xt)if(!(nr==="description"||nr==="dateExpires"||nr==="requestId"||nr==="delegated"||nr==="scope"||nr==="conditions"))return validate63.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:nr},message:"must NOT have additional properties"}],!1;if(rr===Lt){if(xt.description!==void 0){const nr=Lt;if(typeof xt.description!="string")return validate63.errors=[{instancePath:e+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=nr===Lt}else var tr=!0;if(tr){if(xt.dateExpires!==void 0){let nr=xt.dateExpires;const ir=Lt;if(Lt===Lt)if(typeof nr=="string"){if(!pattern14.test(nr))return validate63.errors=[{instancePath:e+"/dateExpires",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate63.errors=[{instancePath:e+"/dateExpires",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=ir===Lt}else var tr=!0;if(tr){if(xt.requestId!==void 0){const nr=Lt;if(typeof xt.requestId!="string")return validate63.errors=[{instancePath:e+"/requestId",schemaPath:"#/properties/requestId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=nr===Lt}else var tr=!0;if(tr){if(xt.delegated!==void 0){const nr=Lt;if(typeof xt.delegated!="boolean")return validate63.errors=[{instancePath:e+"/delegated",schemaPath:"#/properties/delegated/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var tr=nr===Lt}else var tr=!0;if(tr){if(xt.scope!==void 0){const nr=Lt;validate65(xt.scope,{instancePath:e+"/scope",parentData:xt,parentDataProperty:"scope",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate65.errors:jt.concat(validate65.errors),Lt=jt.length);var tr=nr===Lt}else var tr=!0;if(tr)if(xt.conditions!==void 0){let nr=xt.conditions;const ir=Lt;if(Lt===Lt)if(nr&&typeof nr=="object"&&!Array.isArray(nr)){const ur=Lt;for(const fr in nr)if(fr!=="publication")return validate63.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:fr},message:"must NOT have additional properties"}],!1;if(ur===Lt&&nr.publication!==void 0){let fr=nr.publication;if(typeof fr!="string")return validate63.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(fr==="Required"||fr==="Prohibited"))return validate63.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/enum",keyword:"enum",params:{allowedValues:schema103.properties.publication.enum},message:"must be equal to one of the allowed values"}],!1}}else return validate63.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=ir===Lt}else var tr=!0}}}}}}}else return validate63.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate63.errors=jt,Lt===0}validate63.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const PermissionRequestData=validate68;function validate69(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate69.evaluated;er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0);const tr=Lt;let zt=!1,rr=null;const nr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Sr;if(xt.interface===void 0&&(Sr="interface")||xt.method===void 0&&(Sr="method")){const _r={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/required",keyword:"required",params:{missingProperty:Sr},message:"must have required property '"+Sr+"'"};jt===null?jt=[_r]:jt.push(_r),Lt++}else{const _r=Lt;for(const gr in xt)if(!(gr==="interface"||gr==="method"||gr==="protocol")){const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:gr},message:"must NOT have additional properties"};jt===null?jt=[wr]:jt.push(wr),Lt++;break}if(_r===Lt){if(xt.interface!==void 0){const gr=Lt;if(xt.interface!=="Messages"){const wr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};jt===null?jt=[wr]:jt.push(wr),Lt++}var ar=gr===Lt}else var ar=!0;if(ar){if(xt.method!==void 0){const gr=Lt;if(xt.method!=="Query"){const Dr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}var ar=gr===Lt}else var ar=!0;if(ar)if(xt.protocol!==void 0){const gr=Lt;if(typeof xt.protocol!="string"){const Dr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}var ar=gr===Lt}else var ar=!0}}}}else{const Sr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Sr]:jt.push(Sr),Lt++}var lr=nr===Lt;if(lr){zt=!0,rr=0;var dr=!0}const ur=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Sr;if(xt.interface===void 0&&(Sr="interface")||xt.method===void 0&&(Sr="method")){const _r={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/required",keyword:"required",params:{missingProperty:Sr},message:"must have required property '"+Sr+"'"};jt===null?jt=[_r]:jt.push(_r),Lt++}else{const _r=Lt;for(const gr in xt)if(!(gr==="interface"||gr==="method"||gr==="protocol")){const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:gr},message:"must NOT have additional properties"};jt===null?jt=[wr]:jt.push(wr),Lt++;break}if(_r===Lt){if(xt.interface!==void 0){const gr=Lt;if(xt.interface!=="Messages"){const wr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};jt===null?jt=[wr]:jt.push(wr),Lt++}var pr=gr===Lt}else var pr=!0;if(pr){if(xt.method!==void 0){const gr=Lt;if(xt.method!=="Read"){const Dr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}var pr=gr===Lt}else var pr=!0;if(pr)if(xt.protocol!==void 0){const gr=Lt;if(typeof xt.protocol!="string"){const Dr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}var pr=gr===Lt}else var pr=!0}}}}else{const Sr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Sr]:jt.push(Sr),Lt++}var lr=ur===Lt;if(lr&&zt)zt=!1,rr=[rr,1];else{lr&&(zt=!0,rr=1,dr!==!0&&(dr=!0));const Sr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let wr;if(xt.interface===void 0&&(wr="interface")||xt.method===void 0&&(wr="method")){const Dr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/required",keyword:"required",params:{missingProperty:wr},message:"must have required property '"+wr+"'"};jt===null?jt=[Dr]:jt.push(Dr),Lt++}else{const Dr=Lt;for(const xr in xt)if(!(xr==="interface"||xr==="method"||xr==="protocol")){const Ir={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:xr},message:"must NOT have additional properties"};jt===null?jt=[Ir]:jt.push(Ir),Lt++;break}if(Dr===Lt){if(xt.interface!==void 0){const xr=Lt;if(xt.interface!=="Messages"){const Ir={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Messages"},message:"must be equal to constant"};jt===null?jt=[Ir]:jt.push(Ir),Lt++}var yr=xr===Lt}else var yr=!0;if(yr){if(xt.method!==void 0){const xr=Lt;if(xt.method!=="Subscribe"){const $r={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};jt===null?jt=[$r]:jt.push($r),Lt++}var yr=xr===Lt}else var yr=!0;if(yr)if(xt.protocol!==void 0){const xr=Lt;if(typeof xt.protocol!="string"){const $r={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[$r]:jt.push($r),Lt++}var yr=xr===Lt}else var yr=!0}}}}else{const wr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/messages-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[wr]:jt.push(wr),Lt++}var lr=Sr===Lt;if(lr&&zt)zt=!1,rr=[rr,2];else{lr&&(zt=!0,rr=2,dr!==!0&&(dr=!0));const wr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Ir;if(xt.interface===void 0&&(Ir="interface")||xt.method===void 0&&(Ir="method")){const $r={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/required",keyword:"required",params:{missingProperty:Ir},message:"must have required property '"+Ir+"'"};jt===null?jt=[$r]:jt.push($r),Lt++}else{const $r=Lt;for(const vr in xt)if(!(vr==="interface"||vr==="method"||vr==="protocol")){const Er={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:vr},message:"must NOT have additional properties"};jt===null?jt=[Er]:jt.push(Er),Lt++;break}if($r===Lt){if(xt.interface!==void 0){const vr=Lt;if(xt.interface!=="Protocols"){const Er={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};jt===null?jt=[Er]:jt.push(Er),Lt++}var br=vr===Lt}else var br=!0;if(br){if(xt.method!==void 0){const vr=Lt;if(xt.method!=="Configure"){const Tr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/method/const",keyword:"const",params:{allowedValue:"Configure"},message:"must be equal to constant"};jt===null?jt=[Tr]:jt.push(Tr),Lt++}var br=vr===Lt}else var br=!0;if(br)if(xt.protocol!==void 0){const vr=Lt;if(typeof xt.protocol!="string"){const Tr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Tr]:jt.push(Tr),Lt++}var br=vr===Lt}else var br=!0}}}}else{const Ir={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-configure-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Ir]:jt.push(Ir),Lt++}var lr=wr===Lt;if(lr&&zt)zt=!1,rr=[rr,3];else{lr&&(zt=!0,rr=3,dr!==!0&&(dr=!0));const Ir=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Er;if(xt.interface===void 0&&(Er="interface")||xt.method===void 0&&(Er="method")){const Tr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/required",keyword:"required",params:{missingProperty:Er},message:"must have required property '"+Er+"'"};jt===null?jt=[Tr]:jt.push(Tr),Lt++}else{const Tr=Lt;for(const Rr in xt)if(!(Rr==="interface"||Rr==="method"||Rr==="protocol")){const Mr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Rr},message:"must NOT have additional properties"};jt===null?jt=[Mr]:jt.push(Mr),Lt++;break}if(Tr===Lt){if(xt.interface!==void 0){const Rr=Lt;if(xt.interface!=="Protocols"){const Mr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Protocols"},message:"must be equal to constant"};jt===null?jt=[Mr]:jt.push(Mr),Lt++}var Ar=Rr===Lt}else var Ar=!0;if(Ar){if(xt.method!==void 0){const Rr=Lt;if(xt.method!=="Query"){const Gr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};jt===null?jt=[Gr]:jt.push(Gr),Lt++}var Ar=Rr===Lt}else var Ar=!0;if(Ar)if(xt.protocol!==void 0){const Rr=Lt;if(typeof xt.protocol!="string"){const Gr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Gr]:jt.push(Gr),Lt++}var Ar=Rr===Lt}else var Ar=!0}}}}else{const Er={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/protocols-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Er]:jt.push(Er),Lt++}var lr=Ir===Lt;if(lr&&zt)zt=!1,rr=[rr,4];else{lr&&(zt=!0,rr=4,dr!==!0&&(dr=!0));const Er=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Mr;if(xt.interface===void 0&&(Mr="interface")||xt.method===void 0&&(Mr="method")){const Gr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/required",keyword:"required",params:{missingProperty:Mr},message:"must have required property '"+Mr+"'"};jt===null?jt=[Gr]:jt.push(Gr),Lt++}else{const Gr=Lt;for(const Br in xt)if(!(Br==="interface"||Br==="method"||Br==="protocol"||Br==="contextId"||Br==="protocolPath")){const Cr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Br},message:"must NOT have additional properties"};jt===null?jt=[Cr]:jt.push(Cr),Lt++;break}if(Gr===Lt){if(xt.interface!==void 0){const Br=Lt;if(xt.interface!=="Records"){const Cr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};jt===null?jt=[Cr]:jt.push(Cr),Lt++}var Pr=Br===Lt}else var Pr=!0;if(Pr){if(xt.method!==void 0){const Br=Lt;if(xt.method!=="Read"){const jr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/method/const",keyword:"const",params:{allowedValue:"Read"},message:"must be equal to constant"};jt===null?jt=[jr]:jt.push(jr),Lt++}var Pr=Br===Lt}else var Pr=!0;if(Pr){if(xt.protocol!==void 0){const Br=Lt;if(typeof xt.protocol!="string"){const jr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[jr]:jt.push(jr),Lt++}var Pr=Br===Lt}else var Pr=!0;if(Pr){if(xt.contextId!==void 0){const Br=Lt;if(typeof xt.contextId!="string"){const jr={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[jr]:jt.push(jr),Lt++}var Pr=Br===Lt}else var Pr=!0;if(Pr)if(xt.protocolPath!==void 0){const Br=Lt;if(typeof xt.protocolPath!="string"){const jr={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[jr]:jt.push(jr),Lt++}var Pr=Br===Lt}else var Pr=!0}}}}}}else{const Mr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-read-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Mr]:jt.push(Mr),Lt++}var lr=Er===Lt;if(lr&&zt)zt=!1,rr=[rr,5];else{lr&&(zt=!0,rr=5,dr!==!0&&(dr=!0));const Mr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Cr;if(xt.interface===void 0&&(Cr="interface")||xt.method===void 0&&(Cr="method")){const jr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/required",keyword:"required",params:{missingProperty:Cr},message:"must have required property '"+Cr+"'"};jt===null?jt=[jr]:jt.push(jr),Lt++}else{const jr=Lt;for(const Yr in xt)if(!(Yr==="interface"||Yr==="method"||Yr==="protocol"||Yr==="contextId"||Yr==="protocolPath")){const Qr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Yr},message:"must NOT have additional properties"};jt===null?jt=[Qr]:jt.push(Qr),Lt++;break}if(jr===Lt){if(xt.interface!==void 0){const Yr=Lt;if(xt.interface!=="Records"){const Qr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};jt===null?jt=[Qr]:jt.push(Qr),Lt++}var kr=Yr===Lt}else var kr=!0;if(kr){if(xt.method!==void 0){const Yr=Lt;if(xt.method!=="Delete"){const Jr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/method/const",keyword:"const",params:{allowedValue:"Delete"},message:"must be equal to constant"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}var kr=Yr===Lt}else var kr=!0;if(kr){if(xt.protocol!==void 0){const Yr=Lt;if(typeof xt.protocol!="string"){const Jr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}var kr=Yr===Lt}else var kr=!0;if(kr){if(xt.contextId!==void 0){const Yr=Lt;if(typeof xt.contextId!="string"){const Jr={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}var kr=Yr===Lt}else var kr=!0;if(kr)if(xt.protocolPath!==void 0){const Yr=Lt;if(typeof xt.protocolPath!="string"){const Jr={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}var kr=Yr===Lt}else var kr=!0}}}}}}else{const Cr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-delete-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Cr]:jt.push(Cr),Lt++}var lr=Mr===Lt;if(lr&&zt)zt=!1,rr=[rr,6];else{lr&&(zt=!0,rr=6,dr!==!0&&(dr=!0));const Cr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Qr;if(xt.interface===void 0&&(Qr="interface")||xt.method===void 0&&(Qr="method")){const Jr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/required",keyword:"required",params:{missingProperty:Qr},message:"must have required property '"+Qr+"'"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}else{const Jr=Lt;for(const Wr in xt)if(!(Wr==="interface"||Wr==="method"||Wr==="protocol"||Wr==="contextId"||Wr==="protocolPath")){const Nr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Wr},message:"must NOT have additional properties"};jt===null?jt=[Nr]:jt.push(Nr),Lt++;break}if(Jr===Lt){if(xt.interface!==void 0){const Wr=Lt;if(xt.interface!=="Records"){const Nr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};jt===null?jt=[Nr]:jt.push(Nr),Lt++}var Ur=Wr===Lt}else var Ur=!0;if(Ur){if(xt.method!==void 0){const Wr=Lt;if(xt.method!=="Write"){const Vr={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/method/const",keyword:"const",params:{allowedValue:"Write"},message:"must be equal to constant"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}var Ur=Wr===Lt}else var Ur=!0;if(Ur){if(xt.protocol!==void 0){const Wr=Lt;if(typeof xt.protocol!="string"){const Vr={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}var Ur=Wr===Lt}else var Ur=!0;if(Ur){if(xt.contextId!==void 0){const Wr=Lt;if(typeof xt.contextId!="string"){const Vr={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}var Ur=Wr===Lt}else var Ur=!0;if(Ur)if(xt.protocolPath!==void 0){const Wr=Lt;if(typeof xt.protocolPath!="string"){const Vr={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}var Ur=Wr===Lt}else var Ur=!0}}}}}}else{const Qr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-write-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Qr]:jt.push(Qr),Lt++}var lr=Cr===Lt;if(lr&&zt)zt=!1,rr=[rr,7];else{lr&&(zt=!0,rr=7,dr!==!0&&(dr=!0));const Qr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let Nr;if(xt.interface===void 0&&(Nr="interface")||xt.method===void 0&&(Nr="method")){const Vr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/required",keyword:"required",params:{missingProperty:Nr},message:"must have required property '"+Nr+"'"};jt===null?jt=[Vr]:jt.push(Vr),Lt++}else{const Vr=Lt;for(const Xr in xt)if(!(Xr==="interface"||Xr==="method"||Xr==="protocol"||Xr==="contextId"||Xr==="protocolPath")){const qr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Xr},message:"must NOT have additional properties"};jt===null?jt=[qr]:jt.push(qr),Lt++;break}if(Vr===Lt){if(xt.interface!==void 0){const Xr=Lt;if(xt.interface!=="Records"){const qr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};jt===null?jt=[qr]:jt.push(qr),Lt++}var Hr=Xr===Lt}else var Hr=!0;if(Hr){if(xt.method!==void 0){const Xr=Lt;if(xt.method!=="Query"){const Or={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/method/const",keyword:"const",params:{allowedValue:"Query"},message:"must be equal to constant"};jt===null?jt=[Or]:jt.push(Or),Lt++}var Hr=Xr===Lt}else var Hr=!0;if(Hr){if(xt.protocol!==void 0){const Xr=Lt;if(typeof xt.protocol!="string"){const Or={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Or]:jt.push(Or),Lt++}var Hr=Xr===Lt}else var Hr=!0;if(Hr){if(xt.contextId!==void 0){const Xr=Lt;if(typeof xt.contextId!="string"){const Or={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Or]:jt.push(Or),Lt++}var Hr=Xr===Lt}else var Hr=!0;if(Hr)if(xt.protocolPath!==void 0){const Xr=Lt;if(typeof xt.protocolPath!="string"){const Or={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Or]:jt.push(Or),Lt++}var Hr=Xr===Lt}else var Hr=!0}}}}}}else{const Nr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-query-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[Nr]:jt.push(Nr),Lt++}var lr=Qr===Lt;if(lr&&zt)zt=!1,rr=[rr,8];else{lr&&(zt=!0,rr=8,dr!==!0&&(dr=!0));const Nr=Lt;if(Lt===Lt)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let qr;if(xt.interface===void 0&&(qr="interface")||xt.method===void 0&&(qr="method")){const Or={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/required",keyword:"required",params:{missingProperty:qr},message:"must have required property '"+qr+"'"};jt===null?jt=[Or]:jt.push(Or),Lt++}else{const Or=Lt;for(const Fr in xt)if(!(Fr==="interface"||Fr==="method"||Fr==="protocol"||Fr==="contextId"||Fr==="protocolPath")){const Zr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Fr},message:"must NOT have additional properties"};jt===null?jt=[Zr]:jt.push(Zr),Lt++;break}if(Or===Lt){if(xt.interface!==void 0){const Fr=Lt;if(xt.interface!=="Records"){const Zr={instancePath:e+"/interface",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/interface/const",keyword:"const",params:{allowedValue:"Records"},message:"must be equal to constant"};jt===null?jt=[Zr]:jt.push(Zr),Lt++}var Lr=Fr===Lt}else var Lr=!0;if(Lr){if(xt.method!==void 0){const Fr=Lt;if(xt.method!=="Subscribe"){const rn={instancePath:e+"/method",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/method/const",keyword:"const",params:{allowedValue:"Subscribe"},message:"must be equal to constant"};jt===null?jt=[rn]:jt.push(rn),Lt++}var Lr=Fr===Lt}else var Lr=!0;if(Lr){if(xt.protocol!==void 0){const Fr=Lt;if(typeof xt.protocol!="string"){const rn={instancePath:e+"/protocol",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[rn]:jt.push(rn),Lt++}var Lr=Fr===Lt}else var Lr=!0;if(Lr){if(xt.contextId!==void 0){const Fr=Lt;if(typeof xt.contextId!="string"){const rn={instancePath:e+"/contextId",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[rn]:jt.push(rn),Lt++}var Lr=Fr===Lt}else var Lr=!0;if(Lr)if(xt.protocolPath!==void 0){const Fr=Lt;if(typeof xt.protocolPath!="string"){const rn={instancePath:e+"/protocolPath",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/properties/protocolPath/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[rn]:jt.push(rn),Lt++}var Lr=Fr===Lt}else var Lr=!0}}}}}}else{const qr={instancePath:e,schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/scopes.json#/$defs/records-subscribe-scope/type",keyword:"type",params:{type:"object"},message:"must be object"};jt===null?jt=[qr]:jt.push(qr),Lt++}var lr=Nr===Lt;lr&&zt?(zt=!1,rr=[rr,9]):lr&&(zt=!0,rr=9,dr!==!0&&(dr=!0))}}}}}}}}if(zt)Lt=tr,jt!==null&&(tr?jt.length=tr:jt=null);else{const Sr={instancePath:e,schemaPath:"#/oneOf",keyword:"oneOf",params:{passingSchemas:rr},message:"must match exactly one schema in oneOf"};return jt===null?jt=[Sr]:jt.push(Sr),Lt++,validate69.errors=jt,!1}return validate69.errors=jt,er.props=dr,Lt===0}validate69.evaluated={dynamicProps:!0,dynamicItems:!1};function validate68(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate68.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let zt;if(xt.delegated===void 0&&(zt="delegated")||xt.scope===void 0&&(zt="scope"))return validate68.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:zt},message:"must have required property '"+zt+"'"}],!1;{const rr=Lt;for(const nr in xt)if(!(nr==="description"||nr==="delegated"||nr==="scope"||nr==="conditions"))return validate68.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:nr},message:"must NOT have additional properties"}],!1;if(rr===Lt){if(xt.description!==void 0){const nr=Lt;if(typeof xt.description!="string")return validate68.errors=[{instancePath:e+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=nr===Lt}else var tr=!0;if(tr){if(xt.delegated!==void 0){const nr=Lt;if(typeof xt.delegated!="boolean")return validate68.errors=[{instancePath:e+"/delegated",schemaPath:"#/properties/delegated/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var tr=nr===Lt}else var tr=!0;if(tr){if(xt.scope!==void 0){const nr=Lt;validate69(xt.scope,{instancePath:e+"/scope",parentData:xt,parentDataProperty:"scope",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate69.errors:jt.concat(validate69.errors),Lt=jt.length);var tr=nr===Lt}else var tr=!0;if(tr)if(xt.conditions!==void 0){let nr=xt.conditions;const ir=Lt;if(Lt===Lt)if(nr&&typeof nr=="object"&&!Array.isArray(nr)){const ur=Lt;for(const fr in nr)if(fr!=="publication")return validate68.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:fr},message:"must NOT have additional properties"}],!1;if(ur===Lt&&nr.publication!==void 0){let fr=nr.publication;if(typeof fr!="string")return validate68.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(fr==="Required"||fr==="Prohibited"))return validate68.errors=[{instancePath:e+"/conditions/publication",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/properties/publication/enum",keyword:"enum",params:{allowedValues:schema103.properties.publication.enum},message:"must be equal to one of the allowed values"}],!1}}else return validate68.errors=[{instancePath:e+"/conditions",schemaPath:"https://identity.foundation/dwn/json-schemas/permissions/defs.json#/$defs/conditions/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=ir===Lt}else var tr=!0}}}}}else return validate68.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate68.errors=jt,Lt===0}validate68.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const PermissionRevocationData=validate71;function validate71(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate71.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),xt&&typeof xt=="object"&&!Array.isArray(xt)){for(const tr in xt)if(tr!=="description")return validate71.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:tr},message:"must NOT have additional properties"}],!1;if(xt.description!==void 0&&typeof xt.description!="string")return validate71.errors=[{instancePath:e+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1}else return validate71.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate71.errors=jt,Lt===0}validate71.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const PermissionsDefinitions=validate64;function validate64(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate64.evaluated;return er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),xt&&typeof xt=="object"&&!Array.isArray(xt)?(validate64.errors=jt,Lt===0):(validate64.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1)}validate64.evaluated={dynamicProps:!1,dynamicItems:!1};const PermissionsScopes=validate66;function validate66(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate66.evaluated;return er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),xt&&typeof xt=="object"&&!Array.isArray(xt)?(validate66.errors=jt,Lt===0):(validate66.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1)}validate66.evaluated={dynamicProps:!1,dynamicItems:!1};const ProtocolDefinition=validate72,pattern37=new RegExp(".*","u"),schema119={$id:"https://identity.foundation/dwn/json-schemas/protocol-rule-set.json",$schema:"https://json-schema.org/draft/2020-12/schema",type:"object",additionalProperties:!1,properties:{$encryption:{type:"object",additionalProperties:!1,properties:{rootKeyId:{type:"string"},publicKeyJwk:{$ref:"https://identity.foundation/dwn/json-schemas/public-jwk.json"}},required:["rootKeyId","publicKeyJwk"]},$actions:{type:"array",minItems:1,items:{type:"object",oneOf:[{required:["who","can"],additionalProperties:!1,properties:{who:{type:"string",enum:["anyone","author","recipient"]},of:{type:"string"},can:{type:"array",minItems:1,items:{type:"string",enum:["co-delete","co-prune","co-update","create","delete","prune","read","update"]}}}},{required:["role","can"],properties:{role:{$comment:"Must be the protocol path of a role record type",type:"string"},can:{type:"array",minItems:1,items:{type:"string",enum:["co-delete","co-update","create","delete","query","subscribe","read","update"]}}}}]}},$role:{$comment:"When `true`, this turns a record into `role` that may be used within a context/sub-context",type:"boolean"},$size:{type:"object",additionalProperties:!1,properties:{min:{type:"number",minimum:0},max:{type:"number",minimum:0}}},$tags:{type:"object",minProperties:1,properties:{$requiredTags:{type:"array",items:{type:"string"}},$allowUndefinedTags:{type:"boolean"}},patternProperties:{"^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$":{type:"object",additionalProperties:!1,properties:{type:{enum:["string","number","integer","boolean","array"]},items:{type:"object",properties:{type:{enum:["string","number","integer"]}},patternProperties:{"^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength)$":{}}},contains:{type:"object",properties:{type:{enum:["string","number","integer"]}},patternProperties:{"^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength)$":{}}}},patternProperties:{"^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength|minItems|maxItems|uniqueItems|minContains|maxContains)$":{}}}}}},patternProperties:{"^[^$].*$":{$ref:"https://identity.foundation/dwn/json-schemas/protocol-rule-set.json"}}},pattern39=new RegExp("^[^$].*$","u"),pattern40=new RegExp("^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$","u"),pattern41=new RegExp("^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength|minItems|maxItems|uniqueItems|minContains|maxContains)$","u"),pattern42=new RegExp("^(enum|minimum|maximum|exclusiveMinimum|exclusiveMaximum|minLength|maxLength)$","u"),wrapper2={validate:validate73};function validate73(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate73.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){const Sr=Lt;for(const _r in xt)if(!(_r==="$encryption"||_r==="$actions"||_r==="$role"||_r==="$size"||_r==="$tags"||pattern39.test(_r)))return validate73.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:_r},message:"must NOT have additional properties"}],!1;if(Sr===Lt){if(xt.$encryption!==void 0){let _r=xt.$encryption;const gr=Lt;if(Lt===gr)if(_r&&typeof _r=="object"&&!Array.isArray(_r)){let wr;if(_r.rootKeyId===void 0&&(wr="rootKeyId")||_r.publicKeyJwk===void 0&&(wr="publicKeyJwk"))return validate73.errors=[{instancePath:e+"/$encryption",schemaPath:"#/properties/%24encryption/required",keyword:"required",params:{missingProperty:wr},message:"must have required property '"+wr+"'"}],!1;{const Dr=Lt;for(const xr in _r)if(!(xr==="rootKeyId"||xr==="publicKeyJwk"))return validate73.errors=[{instancePath:e+"/$encryption",schemaPath:"#/properties/%24encryption/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:xr},message:"must NOT have additional properties"}],!1;if(Dr===Lt){if(_r.rootKeyId!==void 0){const xr=Lt;if(typeof _r.rootKeyId!="string")return validate73.errors=[{instancePath:e+"/$encryption/rootKeyId",schemaPath:"#/properties/%24encryption/properties/rootKeyId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=xr===Lt}else var tr=!0;if(tr)if(_r.publicKeyJwk!==void 0){const xr=Lt;validate33(_r.publicKeyJwk,{instancePath:e+"/$encryption/publicKeyJwk",parentData:_r,parentDataProperty:"publicKeyJwk",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate33.errors:jt.concat(validate33.errors),Lt=jt.length);var tr=xr===Lt}else var tr=!0}}}else return validate73.errors=[{instancePath:e+"/$encryption",schemaPath:"#/properties/%24encryption/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=gr===Lt}else var zt=!0;if(zt){if(xt.$actions!==void 0){let _r=xt.$actions;const gr=Lt;if(Lt===gr)if(Array.isArray(_r)){if(_r.length<1)return validate73.errors=[{instancePath:e+"/$actions",schemaPath:"#/properties/%24actions/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var rr=!0;const Dr=_r.length;for(let xr=0;xr<Dr;xr++){let Ir=_r[xr];const $r=Lt;if(!(Ir&&typeof Ir=="object"&&!Array.isArray(Ir)))return validate73.errors=[{instancePath:e+"/$actions/"+xr,schemaPath:"#/properties/%24actions/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;const vr=Lt;let Er=!1,Tr=null;const Rr=Lt;if(Ir&&typeof Ir=="object"&&!Array.isArray(Ir)){let Br;if(Ir.who===void 0&&(Br="who")||Ir.can===void 0&&(Br="can")){const Cr={instancePath:e+"/$actions/"+xr,schemaPath:"#/properties/%24actions/items/oneOf/0/required",keyword:"required",params:{missingProperty:Br},message:"must have required property '"+Br+"'"};jt===null?jt=[Cr]:jt.push(Cr),Lt++}else{const Cr=Lt;for(const jr in Ir)if(!(jr==="who"||jr==="of"||jr==="can")){const Yr={instancePath:e+"/$actions/"+xr,schemaPath:"#/properties/%24actions/items/oneOf/0/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:jr},message:"must NOT have additional properties"};jt===null?jt=[Yr]:jt.push(Yr),Lt++;break}if(Cr===Lt){if(Ir.who!==void 0){let jr=Ir.who;const Yr=Lt;if(typeof jr!="string"){const Qr={instancePath:e+"/$actions/"+xr+"/who",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/who/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Qr]:jt.push(Qr),Lt++}if(!(jr==="anyone"||jr==="author"||jr==="recipient")){const Qr={instancePath:e+"/$actions/"+xr+"/who",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/who/enum",keyword:"enum",params:{allowedValues:schema119.properties.$actions.items.oneOf[0].properties.who.enum},message:"must be equal to one of the allowed values"};jt===null?jt=[Qr]:jt.push(Qr),Lt++}var nr=Yr===Lt}else var nr=!0;if(nr){if(Ir.of!==void 0){const jr=Lt;if(typeof Ir.of!="string"){const Qr={instancePath:e+"/$actions/"+xr+"/of",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/of/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Qr]:jt.push(Qr),Lt++}var nr=jr===Lt}else var nr=!0;if(nr)if(Ir.can!==void 0){let jr=Ir.can;const Yr=Lt;if(Lt===Yr)if(Array.isArray(jr))if(jr.length<1){const Jr={instancePath:e+"/$actions/"+xr+"/can",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}else{var ir=!0;const Jr=jr.length;for(let Wr=0;Wr<Jr;Wr++){let Nr=jr[Wr];const Vr=Lt;if(typeof Nr!="string"){const qr={instancePath:e+"/$actions/"+xr+"/can/"+Wr,schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/items/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[qr]:jt.push(qr),Lt++}if(!(Nr==="co-delete"||Nr==="co-prune"||Nr==="co-update"||Nr==="create"||Nr==="delete"||Nr==="prune"||Nr==="read"||Nr==="update")){const qr={instancePath:e+"/$actions/"+xr+"/can/"+Wr,schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/items/enum",keyword:"enum",params:{allowedValues:schema119.properties.$actions.items.oneOf[0].properties.can.items.enum},message:"must be equal to one of the allowed values"};jt===null?jt=[qr]:jt.push(qr),Lt++}var ir=Vr===Lt;if(!ir)break}}else{const Jr={instancePath:e+"/$actions/"+xr+"/can",schemaPath:"#/properties/%24actions/items/oneOf/0/properties/can/type",keyword:"type",params:{type:"array"},message:"must be array"};jt===null?jt=[Jr]:jt.push(Jr),Lt++}var nr=Yr===Lt}else var nr=!0}}}}var fr=Rr===Lt;if(fr){Er=!0,Tr=0;var ar=!0}const Mr=Lt;if(Ir&&typeof Ir=="object"&&!Array.isArray(Ir)){let Br;if(Ir.role===void 0&&(Br="role")||Ir.can===void 0&&(Br="can")){const Cr={instancePath:e+"/$actions/"+xr,schemaPath:"#/properties/%24actions/items/oneOf/1/required",keyword:"required",params:{missingProperty:Br},message:"must have required property '"+Br+"'"};jt===null?jt=[Cr]:jt.push(Cr),Lt++}else{if(Ir.role!==void 0){const Cr=Lt;if(typeof Ir.role!="string"){const jr={instancePath:e+"/$actions/"+xr+"/role",schemaPath:"#/properties/%24actions/items/oneOf/1/properties/role/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[jr]:jt.push(jr),Lt++}var dr=Cr===Lt}else var dr=!0;if(dr)if(Ir.can!==void 0){let Cr=Ir.can;const jr=Lt;if(Lt===jr)if(Array.isArray(Cr))if(Cr.length<1){const Qr={instancePath:e+"/$actions/"+xr+"/can",schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"};jt===null?jt=[Qr]:jt.push(Qr),Lt++}else{var ur=!0;const Qr=Cr.length;for(let Jr=0;Jr<Qr;Jr++){let Wr=Cr[Jr];const Nr=Lt;if(typeof Wr!="string"){const Xr={instancePath:e+"/$actions/"+xr+"/can/"+Jr,schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/items/type",keyword:"type",params:{type:"string"},message:"must be string"};jt===null?jt=[Xr]:jt.push(Xr),Lt++}if(!(Wr==="co-delete"||Wr==="co-update"||Wr==="create"||Wr==="delete"||Wr==="query"||Wr==="subscribe"||Wr==="read"||Wr==="update")){const Xr={instancePath:e+"/$actions/"+xr+"/can/"+Jr,schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/items/enum",keyword:"enum",params:{allowedValues:schema119.properties.$actions.items.oneOf[1].properties.can.items.enum},message:"must be equal to one of the allowed values"};jt===null?jt=[Xr]:jt.push(Xr),Lt++}var ur=Nr===Lt;if(!ur)break}}else{const Qr={instancePath:e+"/$actions/"+xr+"/can",schemaPath:"#/properties/%24actions/items/oneOf/1/properties/can/type",keyword:"type",params:{type:"array"},message:"must be array"};jt===null?jt=[Qr]:jt.push(Qr),Lt++}var dr=jr===Lt}else var dr=!0}}var fr=Mr===Lt;if(fr&&Er?(Er=!1,Tr=[Tr,1]):fr&&(Er=!0,Tr=1,ar!==!0&&(ar=ar||{},ar.role=!0,ar.can=!0)),Er)Lt=vr,jt!==null&&(vr?jt.length=vr:jt=null);else{const Br={instancePath:e+"/$actions/"+xr,schemaPath:"#/properties/%24actions/items/oneOf",keyword:"oneOf",params:{passingSchemas:Tr},message:"must match exactly one schema in oneOf"};return jt===null?jt=[Br]:jt.push(Br),Lt++,validate73.errors=jt,!1}var rr=$r===Lt;if(!rr)break}}}else return validate73.errors=[{instancePath:e+"/$actions",schemaPath:"#/properties/%24actions/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var zt=gr===Lt}else var zt=!0;if(zt){if(xt.$role!==void 0){const _r=Lt;if(typeof xt.$role!="boolean")return validate73.errors=[{instancePath:e+"/$role",schemaPath:"#/properties/%24role/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var zt=_r===Lt}else var zt=!0;if(zt){if(xt.$size!==void 0){let _r=xt.$size;const gr=Lt;if(Lt===gr)if(_r&&typeof _r=="object"&&!Array.isArray(_r)){const Dr=Lt;for(const xr in _r)if(!(xr==="min"||xr==="max"))return validate73.errors=[{instancePath:e+"/$size",schemaPath:"#/properties/%24size/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:xr},message:"must NOT have additional properties"}],!1;if(Dr===Lt){if(_r.min!==void 0){let xr=_r.min;const Ir=Lt;if(Lt===Ir)if(typeof xr=="number"&&isFinite(xr)){if(xr<0||isNaN(xr))return validate73.errors=[{instancePath:e+"/$size/min",schemaPath:"#/properties/%24size/properties/min/minimum",keyword:"minimum",params:{comparison:">=",limit:0},message:"must be >= 0"}],!1}else return validate73.errors=[{instancePath:e+"/$size/min",schemaPath:"#/properties/%24size/properties/min/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var pr=Ir===Lt}else var pr=!0;if(pr)if(_r.max!==void 0){let xr=_r.max;const Ir=Lt;if(Lt===Ir)if(typeof xr=="number"&&isFinite(xr)){if(xr<0||isNaN(xr))return validate73.errors=[{instancePath:e+"/$size/max",schemaPath:"#/properties/%24size/properties/max/minimum",keyword:"minimum",params:{comparison:">=",limit:0},message:"must be >= 0"}],!1}else return validate73.errors=[{instancePath:e+"/$size/max",schemaPath:"#/properties/%24size/properties/max/type",keyword:"type",params:{type:"number"},message:"must be number"}],!1;var pr=Ir===Lt}else var pr=!0}}else return validate73.errors=[{instancePath:e+"/$size",schemaPath:"#/properties/%24size/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=gr===Lt}else var zt=!0;if(zt){if(xt.$tags!==void 0){let _r=xt.$tags;const gr=Lt;if(Lt===gr)if(_r&&typeof _r=="object"&&!Array.isArray(_r)){if(Object.keys(_r).length<1)return validate73.errors=[{instancePath:e+"/$tags",schemaPath:"#/properties/%24tags/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;if(_r.$requiredTags!==void 0){let Dr=_r.$requiredTags;const xr=Lt;if(Lt===xr)if(Array.isArray(Dr)){var lr=!0;const Ir=Dr.length;for(let $r=0;$r<Ir;$r++){const vr=Lt;if(typeof Dr[$r]!="string")return validate73.errors=[{instancePath:e+"/$tags/$requiredTags/"+$r,schemaPath:"#/properties/%24tags/properties/%24requiredTags/items/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var lr=vr===Lt;if(!lr)break}}else return validate73.errors=[{instancePath:e+"/$tags/$requiredTags",schemaPath:"#/properties/%24tags/properties/%24requiredTags/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var yr=xr===Lt}else var yr=!0;if(yr){if(_r.$allowUndefinedTags!==void 0){const Dr=Lt;if(typeof _r.$allowUndefinedTags!="boolean")return validate73.errors=[{instancePath:e+"/$tags/$allowUndefinedTags",schemaPath:"#/properties/%24tags/properties/%24allowUndefinedTags/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var yr=Dr===Lt}else var yr=!0;if(yr){var br={};br.$requiredTags=!0,br.$allowUndefinedTags=!0;for(const Dr in _r)if(pattern40.test(Dr)){let xr=_r[Dr];if(Lt===Lt)if(xr&&typeof xr=="object"&&!Array.isArray(xr)){const $r=Lt;for(const vr in xr)if(!(vr==="type"||vr==="items"||vr==="contains"||pattern41.test(vr)))return validate73.errors=[{instancePath:e+"/$tags/"+Dr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:vr},message:"must NOT have additional properties"}],!1;if($r===Lt){if(xr.type!==void 0){let vr=xr.type;const Er=Lt;if(!(vr==="string"||vr==="number"||vr==="integer"||vr==="boolean"||vr==="array"))return validate73.errors=[{instancePath:e+"/$tags/"+Dr.replace(/~/g,"~0").replace(/\//g,"~1")+"/type",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/type/enum",keyword:"enum",params:{allowedValues:schema119.properties.$tags.patternProperties["^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$"].properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var Ar=Er===Lt}else var Ar=!0;if(Ar){if(xr.items!==void 0){let vr=xr.items;const Er=Lt;if(Lt===Er)if(vr&&typeof vr=="object"&&!Array.isArray(vr)){if(vr.type!==void 0){let Rr=vr.type;const Mr=Lt;if(!(Rr==="string"||Rr==="number"||Rr==="integer"))return validate73.errors=[{instancePath:e+"/$tags/"+Dr.replace(/~/g,"~0").replace(/\//g,"~1")+"/items/type",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/items/properties/type/enum",keyword:"enum",params:{allowedValues:schema119.properties.$tags.patternProperties["^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$"].properties.items.properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var Pr=Mr===Lt}else var Pr=!0;if(Pr){var kr={};kr.type=!0;for(const Rr in vr)pattern42.test(Rr)&&(kr[Rr]=!0)}}else return validate73.errors=[{instancePath:e+"/$tags/"+Dr.replace(/~/g,"~0").replace(/\//g,"~1")+"/items",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Ar=Er===Lt}else var Ar=!0;if(Ar)if(xr.contains!==void 0){let vr=xr.contains;const Er=Lt;if(Lt===Er)if(vr&&typeof vr=="object"&&!Array.isArray(vr)){if(vr.type!==void 0){let Rr=vr.type;const Mr=Lt;if(!(Rr==="string"||Rr==="number"||Rr==="integer"))return validate73.errors=[{instancePath:e+"/$tags/"+Dr.replace(/~/g,"~0").replace(/\//g,"~1")+"/contains/type",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/contains/properties/type/enum",keyword:"enum",params:{allowedValues:schema119.properties.$tags.patternProperties["^(?!\\$requiredTags$|\\$allowUndefinedTags$).*$"].properties.contains.properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var Ur=Mr===Lt}else var Ur=!0;if(Ur){var Hr={};Hr.type=!0;for(const Rr in vr)pattern42.test(Rr)&&(Hr[Rr]=!0)}}else return validate73.errors=[{instancePath:e+"/$tags/"+Dr.replace(/~/g,"~0").replace(/\//g,"~1")+"/contains",schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/properties/contains/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var Ar=Er===Lt}else var Ar=!0}}}else return validate73.errors=[{instancePath:e+"/$tags/"+Dr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/%24tags/patternProperties/%5E(%3F!%5C%24requiredTags%24%7C%5C%24allowUndefinedTags%24).*%24/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;br[Dr]=!0}}}}else return validate73.errors=[{instancePath:e+"/$tags",schemaPath:"#/properties/%24tags/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=gr===Lt}else var zt=!0;if(zt){var Lr=!0;for(const _r in xt)if(pattern39.test(_r)){const gr=Lt;wrapper2.validate(xt[_r],{instancePath:e+"/"+_r.replace(/~/g,"~0").replace(/\//g,"~1"),parentData:xt,parentDataProperty:_r,rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?wrapper2.validate.errors:jt.concat(wrapper2.validate.errors),Lt=jt.length);var Lr=gr===Lt;if(!Lr)break}}}}}}}}else return validate73.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate73.errors=jt,Lt===0}validate73.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};function validate72(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate72.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let ar;if(xt.protocol===void 0&&(ar="protocol")||xt.published===void 0&&(ar="published")||xt.types===void 0&&(ar="types")||xt.structure===void 0&&(ar="structure"))return validate72.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:ar},message:"must have required property '"+ar+"'"}],!1;{const dr=Lt;for(const ur in xt)if(!(ur==="protocol"||ur==="published"||ur==="types"||ur==="structure"))return validate72.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ur},message:"must NOT have additional properties"}],!1;if(dr===Lt){if(xt.protocol!==void 0){const ur=Lt;if(typeof xt.protocol!="string")return validate72.errors=[{instancePath:e+"/protocol",schemaPath:"#/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=ur===Lt}else var tr=!0;if(tr){if(xt.published!==void 0){const ur=Lt;if(typeof xt.published!="boolean")return validate72.errors=[{instancePath:e+"/published",schemaPath:"#/properties/published/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var tr=ur===Lt}else var tr=!0;if(tr){if(xt.types!==void 0){let ur=xt.types;const fr=Lt;if(Lt===fr)if(ur&&typeof ur=="object"&&!Array.isArray(ur)){var zt={};for(const lr in ur)if(pattern37.test(lr)){let yr=ur[lr];if(Lt===Lt)if(yr&&typeof yr=="object"&&!Array.isArray(yr)){const Ar=Lt;for(const Pr in yr)if(!(Pr==="schema"||Pr==="dataFormats"))return validate72.errors=[{instancePath:e+"/types/"+lr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/types/patternProperties/.*/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Pr},message:"must NOT have additional properties"}],!1;if(Ar===Lt){if(yr.schema!==void 0){const Pr=Lt;if(typeof yr.schema!="string")return validate72.errors=[{instancePath:e+"/types/"+lr.replace(/~/g,"~0").replace(/\//g,"~1")+"/schema",schemaPath:"#/properties/types/patternProperties/.*/properties/schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var rr=Pr===Lt}else var rr=!0;if(rr)if(yr.dataFormats!==void 0){let Pr=yr.dataFormats;const kr=Lt;if(Lt===kr)if(Array.isArray(Pr)){if(Pr.length<1)return validate72.errors=[{instancePath:e+"/types/"+lr.replace(/~/g,"~0").replace(/\//g,"~1")+"/dataFormats",schemaPath:"#/properties/types/patternProperties/.*/properties/dataFormats/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var nr=!0;const Hr=Pr.length;for(let Lr=0;Lr<Hr;Lr++){const Sr=Lt;if(typeof Pr[Lr]!="string")return validate72.errors=[{instancePath:e+"/types/"+lr.replace(/~/g,"~0").replace(/\//g,"~1")+"/dataFormats/"+Lr,schemaPath:"#/properties/types/patternProperties/.*/properties/dataFormats/items/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var nr=Sr===Lt;if(!nr)break}}}else return validate72.errors=[{instancePath:e+"/types/"+lr.replace(/~/g,"~0").replace(/\//g,"~1")+"/dataFormats",schemaPath:"#/properties/types/patternProperties/.*/properties/dataFormats/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;var rr=kr===Lt}else var rr=!0}}else return validate72.errors=[{instancePath:e+"/types/"+lr.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/types/patternProperties/.*/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;zt[lr]=!0}}else return validate72.errors=[{instancePath:e+"/types",schemaPath:"#/properties/types/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=fr===Lt}else var tr=!0;if(tr)if(xt.structure!==void 0){let ur=xt.structure;const fr=Lt;if(Lt===fr)if(ur&&typeof ur=="object"&&!Array.isArray(ur)){var ir={};for(const lr in ur)pattern37.test(lr)&&(validate73(ur[lr],{instancePath:e+"/structure/"+lr.replace(/~/g,"~0").replace(/\//g,"~1"),parentData:ur,parentDataProperty:lr,rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate73.errors:jt.concat(validate73.errors),Lt=jt.length),ir[lr]=!0)}else return validate72.errors=[{instancePath:e+"/structure",schemaPath:"#/properties/structure/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=fr===Lt}else var tr=!0}}}}}else return validate72.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate72.errors=jt,Lt===0}validate72.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const ProtocolRuleSet=validate73,ProtocolsConfigure$1=validate76,schema120={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/protocols-configure.json",type:"object",additionalProperties:!1,required:["authorization","descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","definition"],properties:{interface:{enum:["Protocols"],type:"string"},method:{enum:["Configure"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},definition:{$ref:"https://identity.foundation/dwn/json-schemas/protocol-definition.json"}}}}};function validate76(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate76.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let rr;if(xt.authorization===void 0&&(rr="authorization")||xt.descriptor===void 0&&(rr="descriptor"))return validate76.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:rr},message:"must have required property '"+rr+"'"}],!1;{const nr=Lt;for(const ir in xt)if(!(ir==="authorization"||ir==="descriptor"))return validate76.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ir},message:"must NOT have additional properties"}],!1;if(nr===Lt){if(xt.authorization!==void 0){const ir=Lt;validate24(xt.authorization,{instancePath:e+"/authorization",parentData:xt,parentDataProperty:"authorization",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate24.errors:jt.concat(validate24.errors),Lt=jt.length);var tr=ir===Lt}else var tr=!0;if(tr)if(xt.descriptor!==void 0){let ir=xt.descriptor;const ar=Lt;if(Lt===ar)if(ir&&typeof ir=="object"&&!Array.isArray(ir)){let ur;if(ir.interface===void 0&&(ur="interface")||ir.method===void 0&&(ur="method")||ir.messageTimestamp===void 0&&(ur="messageTimestamp")||ir.definition===void 0&&(ur="definition"))return validate76.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:ur},message:"must have required property '"+ur+"'"}],!1;{const fr=Lt;for(const pr in ir)if(!(pr==="interface"||pr==="method"||pr==="messageTimestamp"||pr==="definition"))return validate76.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:pr},message:"must NOT have additional properties"}],!1;if(fr===Lt){if(ir.interface!==void 0){let pr=ir.interface;const lr=Lt;if(typeof pr!="string")return validate76.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(pr!=="Protocols")return validate76.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema120.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.method!==void 0){let pr=ir.method;const lr=Lt;if(typeof pr!="string")return validate76.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(pr!=="Configure")return validate76.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema120.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.messageTimestamp!==void 0){let pr=ir.messageTimestamp;const lr=Lt;if(Lt===Lt)if(typeof pr=="string"){if(!pattern14.test(pr))return validate76.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate76.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=lr===Lt}else var zt=!0;if(zt)if(ir.definition!==void 0){const pr=Lt;validate72(ir.definition,{instancePath:e+"/descriptor/definition",parentData:ir,parentDataProperty:"definition",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate72.errors:jt.concat(validate72.errors),Lt=jt.length);var zt=pr===Lt}else var zt=!0}}}}}else return validate76.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=ar===Lt}else var tr=!0}}}else return validate76.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate76.errors=jt,Lt===0}validate76.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const ProtocolsQuery$1=validate79,schema122={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/protocols-query.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp"],properties:{interface:{enum:["Protocols"],type:"string"},method:{enum:["Query"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{type:"object",minProperties:1,additionalProperties:!1,properties:{protocol:{type:"string"},recipient:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did"}}}}}}};function validate79(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate79.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let nr;if(xt.descriptor===void 0&&(nr="descriptor"))return validate79.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:nr},message:"must have required property '"+nr+"'"}],!1;{const ir=Lt;for(const ar in xt)if(!(ar==="authorization"||ar==="descriptor"))return validate79.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ar},message:"must NOT have additional properties"}],!1;if(ir===Lt){if(xt.authorization!==void 0){const ar=Lt;validate20(xt.authorization,{instancePath:e+"/authorization",parentData:xt,parentDataProperty:"authorization",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate20.errors:jt.concat(validate20.errors),Lt=jt.length);var tr=ar===Lt}else var tr=!0;if(tr)if(xt.descriptor!==void 0){let ar=xt.descriptor;const dr=Lt;if(Lt===dr)if(ar&&typeof ar=="object"&&!Array.isArray(ar)){let fr;if(ar.interface===void 0&&(fr="interface")||ar.method===void 0&&(fr="method")||ar.messageTimestamp===void 0&&(fr="messageTimestamp"))return validate79.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:fr},message:"must have required property '"+fr+"'"}],!1;{const pr=Lt;for(const lr in ar)if(!(lr==="interface"||lr==="method"||lr==="messageTimestamp"||lr==="filter"))return validate79.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:lr},message:"must NOT have additional properties"}],!1;if(pr===Lt){if(ar.interface!==void 0){let lr=ar.interface;const yr=Lt;if(typeof lr!="string")return validate79.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(lr!=="Protocols")return validate79.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema122.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var zt=yr===Lt}else var zt=!0;if(zt){if(ar.method!==void 0){let lr=ar.method;const yr=Lt;if(typeof lr!="string")return validate79.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(lr!=="Query")return validate79.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema122.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var zt=yr===Lt}else var zt=!0;if(zt){if(ar.messageTimestamp!==void 0){let lr=ar.messageTimestamp;const yr=Lt;if(Lt===Lt)if(typeof lr=="string"){if(!pattern14.test(lr))return validate79.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate79.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=yr===Lt}else var zt=!0;if(zt)if(ar.filter!==void 0){let lr=ar.filter;const yr=Lt;if(Lt===yr)if(lr&&typeof lr=="object"&&!Array.isArray(lr)){if(Object.keys(lr).length<1)return validate79.errors=[{instancePath:e+"/descriptor/filter",schemaPath:"#/properties/descriptor/properties/filter/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const Ar=Lt;for(const Pr in lr)if(!(Pr==="protocol"||Pr==="recipient"))return validate79.errors=[{instancePath:e+"/descriptor/filter",schemaPath:"#/properties/descriptor/properties/filter/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:Pr},message:"must NOT have additional properties"}],!1;if(Ar===Lt){if(lr.protocol!==void 0){const Pr=Lt;if(typeof lr.protocol!="string")return validate79.errors=[{instancePath:e+"/descriptor/filter/protocol",schemaPath:"#/properties/descriptor/properties/filter/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var rr=Pr===Lt}else var rr=!0;if(rr)if(lr.recipient!==void 0){let Pr=lr.recipient;const kr=Lt;if(Lt===Lt)if(typeof Pr=="string"){if(!pattern12.test(Pr))return validate79.errors=[{instancePath:e+"/descriptor/filter/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/pattern",keyword:"pattern",params:{pattern:"^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"},message:'must match pattern "^did:([a-z0-9]+):((?:(?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))*:)*((?:[a-zA-Z0-9._-]|(?:%[0-9a-fA-F]{2}))+))((;[a-zA-Z0-9_.:%-]+=[a-zA-Z0-9_.:%-]*)*)(/[^#?]*)?([?][^#]*)?(#.*)?$"'}],!1}else return validate79.errors=[{instancePath:e+"/descriptor/filter/recipient",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/did/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var rr=kr===Lt}else var rr=!0}}}else return validate79.errors=[{instancePath:e+"/descriptor/filter",schemaPath:"#/properties/descriptor/properties/filter/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var zt=yr===Lt}else var zt=!0}}}}}else return validate79.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=dr===Lt}else var tr=!0}}}else return validate79.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate79.errors=jt,Lt===0}validate79.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsRead$1=validate81,schema125={$schema:"https://json-schema.org/draft/2020-12/schema",$id:"https://identity.foundation/dwn/json-schemas/records-read.json",type:"object",additionalProperties:!1,required:["descriptor"],properties:{authorization:{$ref:"https://identity.foundation/dwn/json-schemas/authorization-delegated-grant.json"},descriptor:{type:"object",additionalProperties:!1,required:["interface","method","messageTimestamp","filter"],properties:{interface:{enum:["Records"],type:"string"},method:{enum:["Read"],type:"string"},messageTimestamp:{$ref:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time"},filter:{$ref:"https://identity.foundation/dwn/json-schemas/records-filter.json"}}}}};function validate81(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate81.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){let rr;if(xt.descriptor===void 0&&(rr="descriptor"))return validate81.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:rr},message:"must have required property '"+rr+"'"}],!1;{const nr=Lt;for(const ir in xt)if(!(ir==="authorization"||ir==="descriptor"))return validate81.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ir},message:"must NOT have additional properties"}],!1;if(nr===Lt){if(xt.authorization!==void 0){const ir=Lt;validate24(xt.authorization,{instancePath:e+"/authorization",parentData:xt,parentDataProperty:"authorization",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate24.errors:jt.concat(validate24.errors),Lt=jt.length);var tr=ir===Lt}else var tr=!0;if(tr)if(xt.descriptor!==void 0){let ir=xt.descriptor;const ar=Lt;if(Lt===ar)if(ir&&typeof ir=="object"&&!Array.isArray(ir)){let ur;if(ir.interface===void 0&&(ur="interface")||ir.method===void 0&&(ur="method")||ir.messageTimestamp===void 0&&(ur="messageTimestamp")||ir.filter===void 0&&(ur="filter"))return validate81.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/required",keyword:"required",params:{missingProperty:ur},message:"must have required property '"+ur+"'"}],!1;{const fr=Lt;for(const pr in ir)if(!(pr==="interface"||pr==="method"||pr==="messageTimestamp"||pr==="filter"))return validate81.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:pr},message:"must NOT have additional properties"}],!1;if(fr===Lt){if(ir.interface!==void 0){let pr=ir.interface;const lr=Lt;if(typeof pr!="string")return validate81.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(pr!=="Records")return validate81.errors=[{instancePath:e+"/descriptor/interface",schemaPath:"#/properties/descriptor/properties/interface/enum",keyword:"enum",params:{allowedValues:schema125.properties.descriptor.properties.interface.enum},message:"must be equal to one of the allowed values"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.method!==void 0){let pr=ir.method;const lr=Lt;if(typeof pr!="string")return validate81.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(pr!=="Read")return validate81.errors=[{instancePath:e+"/descriptor/method",schemaPath:"#/properties/descriptor/properties/method/enum",keyword:"enum",params:{allowedValues:schema125.properties.descriptor.properties.method.enum},message:"must be equal to one of the allowed values"}],!1;var zt=lr===Lt}else var zt=!0;if(zt){if(ir.messageTimestamp!==void 0){let pr=ir.messageTimestamp;const lr=Lt;if(Lt===Lt)if(typeof pr=="string"){if(!pattern14.test(pr))return validate81.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/pattern",keyword:"pattern",params:{pattern:"^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"},message:'must match pattern "^\\d{4}-[0-1]\\d-[0-3]\\dT(?:[0-2]\\d:[0-5]\\d:[0-5]\\d|23:59:60)\\.\\d{6}Z$"'}],!1}else return validate81.errors=[{instancePath:e+"/descriptor/messageTimestamp",schemaPath:"https://identity.foundation/dwn/json-schemas/defs.json#/$defs/date-time/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var zt=lr===Lt}else var zt=!0;if(zt)if(ir.filter!==void 0){const pr=Lt;validate42(ir.filter,{instancePath:e+"/descriptor/filter",parentData:ir,parentDataProperty:"filter",rootData:Bt,dynamicAnchors:Nt})||(jt=jt===null?validate42.errors:jt.concat(validate42.errors),Lt=jt.length);var zt=pr===Lt}else var zt=!0}}}}}else return validate81.errors=[{instancePath:e+"/descriptor",schemaPath:"#/properties/descriptor/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;var tr=ar===Lt}else var tr=!0}}}else return validate81.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate81.errors=jt,Lt===0}validate81.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsFilter=validate42,PublicJwk=validate33,GenericSignaturePayload=validate84;function validate84(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate84.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),xt&&typeof xt=="object"&&!Array.isArray(xt)){let zt;if(xt.descriptorCid===void 0&&(zt="descriptorCid"))return validate84.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:zt},message:"must have required property '"+zt+"'"}],!1;for(const rr in xt)if(!(rr==="descriptorCid"||rr==="delegatedGrantId"||rr==="permissionGrantId"||rr==="protocolRole"))return validate84.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:rr},message:"must NOT have additional properties"}],!1;{if(xt.descriptorCid!==void 0){const rr=Lt;if(typeof xt.descriptorCid!="string")return validate84.errors=[{instancePath:e+"/descriptorCid",schemaPath:"#/properties/descriptorCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr){if(xt.delegatedGrantId!==void 0){const rr=Lt;if(typeof xt.delegatedGrantId!="string")return validate84.errors=[{instancePath:e+"/delegatedGrantId",schemaPath:"#/properties/delegatedGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr){if(xt.permissionGrantId!==void 0){const rr=Lt;if(typeof xt.permissionGrantId!="string")return validate84.errors=[{instancePath:e+"/permissionGrantId",schemaPath:"#/properties/permissionGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr)if(xt.protocolRole!==void 0){const rr=Lt;if(typeof xt.protocolRole!="string")return validate84.errors=[{instancePath:e+"/protocolRole",schemaPath:"#/properties/protocolRole/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0}}}}else return validate84.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate84.errors=jt,Lt===0}validate84.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const RecordsWriteSignaturePayload=validate85;function validate85(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate85.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),xt&&typeof xt=="object"&&!Array.isArray(xt)){let zt;if(xt.descriptorCid===void 0&&(zt="descriptorCid")||xt.recordId===void 0&&(zt="recordId"))return validate85.errors=[{instancePath:e,schemaPath:"#/required",keyword:"required",params:{missingProperty:zt},message:"must have required property '"+zt+"'"}],!1;for(const rr in xt)if(!(rr==="descriptorCid"||rr==="recordId"||rr==="contextId"||rr==="attestationCid"||rr==="encryptionCid"||rr==="delegatedGrantId"||rr==="permissionGrantId"||rr==="protocolRole"))return validate85.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:rr},message:"must NOT have additional properties"}],!1;{if(xt.descriptorCid!==void 0){const rr=Lt;if(typeof xt.descriptorCid!="string")return validate85.errors=[{instancePath:e+"/descriptorCid",schemaPath:"#/properties/descriptorCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr){if(xt.recordId!==void 0){const rr=Lt;if(typeof xt.recordId!="string")return validate85.errors=[{instancePath:e+"/recordId",schemaPath:"#/properties/recordId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr){if(xt.contextId!==void 0){const rr=Lt;if(typeof xt.contextId!="string")return validate85.errors=[{instancePath:e+"/contextId",schemaPath:"#/properties/contextId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr){if(xt.attestationCid!==void 0){const rr=Lt;if(typeof xt.attestationCid!="string")return validate85.errors=[{instancePath:e+"/attestationCid",schemaPath:"#/properties/attestationCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr){if(xt.encryptionCid!==void 0){const rr=Lt;if(typeof xt.encryptionCid!="string")return validate85.errors=[{instancePath:e+"/encryptionCid",schemaPath:"#/properties/encryptionCid/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr){if(xt.delegatedGrantId!==void 0){const rr=Lt;if(typeof xt.delegatedGrantId!="string")return validate85.errors=[{instancePath:e+"/delegatedGrantId",schemaPath:"#/properties/delegatedGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr){if(xt.permissionGrantId!==void 0){const rr=Lt;if(typeof xt.permissionGrantId!="string")return validate85.errors=[{instancePath:e+"/permissionGrantId",schemaPath:"#/properties/permissionGrantId/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0;if(tr)if(xt.protocolRole!==void 0){const rr=Lt;if(typeof xt.protocolRole!="string")return validate85.errors=[{instancePath:e+"/protocolRole",schemaPath:"#/properties/protocolRole/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var tr=rr===Lt}else var tr=!0}}}}}}}}else return validate85.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate85.errors=jt,Lt===0}validate85.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const StringRangeFilter=validate86;function validate86(xt,{instancePath:e="",parentData:At,parentDataProperty:kt,rootData:Bt=xt,dynamicAnchors:Nt={}}={}){let jt=null,Lt=0;const er=validate86.evaluated;if(er.dynamicProps&&(er.props=void 0),er.dynamicItems&&(er.items=void 0),Lt===0)if(xt&&typeof xt=="object"&&!Array.isArray(xt)){if(Object.keys(xt).length<1)return validate86.errors=[{instancePath:e,schemaPath:"#/minProperties",keyword:"minProperties",params:{limit:1},message:"must NOT have fewer than 1 properties"}],!1;{const dr=Lt;for(const ur in xt)if(!(ur==="gt"||ur==="gte"||ur==="lt"||ur==="lte"))return validate86.errors=[{instancePath:e,schemaPath:"#/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:ur},message:"must NOT have additional properties"}],!1;if(dr===Lt){if(xt.gt!==void 0){const ur=Lt,fr=Lt,pr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.gte===void 0){const lr={};jt===null?jt=[lr]:jt.push(lr),Lt++}var tr=pr===Lt;if(tr)return validate86.errors=[{instancePath:e,schemaPath:"#/dependencies/gt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=fr,jt!==null&&(fr?jt.length=fr:jt=null);var zt=ur===Lt}else var zt=!0;if(zt){if(xt.gte!==void 0){const ur=Lt,fr=Lt,pr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.gt===void 0){const yr={};jt===null?jt=[yr]:jt.push(yr),Lt++}var rr=pr===Lt;if(rr)return validate86.errors=[{instancePath:e,schemaPath:"#/dependencies/gte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=fr,jt!==null&&(fr?jt.length=fr:jt=null);var zt=ur===Lt}else var zt=!0;if(zt){if(xt.lt!==void 0){const ur=Lt,fr=Lt,pr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.lte===void 0){const yr={};jt===null?jt=[yr]:jt.push(yr),Lt++}var nr=pr===Lt;if(nr)return validate86.errors=[{instancePath:e,schemaPath:"#/dependencies/lt/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=fr,jt!==null&&(fr?jt.length=fr:jt=null);var zt=ur===Lt}else var zt=!0;if(zt){if(xt.lte!==void 0){const ur=Lt,fr=Lt,pr=Lt;if(xt&&typeof xt=="object"&&!Array.isArray(xt)&&xt.lt===void 0){const yr={};jt===null?jt=[yr]:jt.push(yr),Lt++}var ir=pr===Lt;if(ir)return validate86.errors=[{instancePath:e,schemaPath:"#/dependencies/lte/not",keyword:"not",params:{},message:"must NOT be valid"}],!1;Lt=fr,jt!==null&&(fr?jt.length=fr:jt=null);var zt=ur===Lt}else var zt=!0;if(zt){if(xt.gt!==void 0){const ur=Lt;if(typeof xt.gt!="string")return validate86.errors=[{instancePath:e+"/gt",schemaPath:"#/properties/gt/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ar=ur===Lt}else var ar=!0;if(ar){if(xt.gte!==void 0){const ur=Lt;if(typeof xt.gte!="string")return validate86.errors=[{instancePath:e+"/gte",schemaPath:"#/properties/gte/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ar=ur===Lt}else var ar=!0;if(ar){if(xt.lt!==void 0){const ur=Lt;if(typeof xt.lt!="string")return validate86.errors=[{instancePath:e+"/lt",schemaPath:"#/properties/lt/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ar=ur===Lt}else var ar=!0;if(ar)if(xt.lte!==void 0){const ur=Lt;if(typeof xt.lte!="string")return validate86.errors=[{instancePath:e+"/lte",schemaPath:"#/properties/lte/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var ar=ur===Lt}else var ar=!0}}}}}}}}}else return validate86.errors=[{instancePath:e,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;return validate86.errors=jt,Lt===0}validate86.evaluated={props:!0,dynamicProps:!1,dynamicItems:!1};const precompiledValidators=Object.freeze(Object.defineProperty({__proto__:null,Authorization,AuthorizationDelegatedGrant,AuthorizationOwner,Definitions,GeneralJwk,GeneralJws,GenericSignaturePayload,JwkVerificationMethod,MessagesFilter,MessagesQuery:MessagesQuery$1,MessagesRead:MessagesRead$1,MessagesSubscribe:MessagesSubscribe$1,NumberRangeFilter,PaginationCursor,PermissionGrantData,PermissionRequestData,PermissionRevocationData,PermissionsDefinitions,PermissionsScopes,ProtocolDefinition,ProtocolRuleSet,ProtocolsConfigure:ProtocolsConfigure$1,ProtocolsQuery:ProtocolsQuery$1,PublicJwk,RecordsDelete:RecordsDelete$1,RecordsFilter,RecordsQuery:RecordsQuery$1,RecordsRead:RecordsRead$1,RecordsSubscribe:RecordsSubscribe$1,RecordsWrite:RecordsWrite$1,RecordsWriteDataEncoded,RecordsWriteSignaturePayload,RecordsWriteUnidentified,StringRangeFilter},Symbol.toStringTag,{value:"Module"}));function validateJsonSchema(xt,e){const At=precompiledValidators[xt];if(!At)throw new DwnError(DwnErrorCode.SchemaValidatorSchemaNotFound,`schema for ${xt} not found.`);if(At(e),!At.errors)return;const[kt]=At.errors;let{instancePath:Bt,message:Nt,keyword:jt}=kt;if(Bt||(Bt=xt),jt==="additionalProperties"){const Lt=kt.params.additionalProperty;throw new DwnError(DwnErrorCode.SchemaValidatorAdditionalPropertyNotAllowed,`${Nt}: ${Bt}: ${Lt}`)}if(jt==="unevaluatedProperties"){const Lt=kt.params.unevaluatedProperty;throw new DwnError(DwnErrorCode.SchemaValidatorUnevaluatedPropertyNotAllowed,`${Nt}: ${Bt}: ${Lt}`)}throw new DwnError(DwnErrorCode.SchemaValidatorFailure,`${Bt}: ${Nt}`)}var __awaiter$3f=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class GeneralJwsVerifier{constructor(e){this.cache=e||new MemoryCache(600)}static get singleton(){return GeneralJwsVerifier._singleton===void 0&&(GeneralJwsVerifier._singleton=new GeneralJwsVerifier),GeneralJwsVerifier._singleton}static verifySignatures(e,At){return __awaiter$3f(this,void 0,void 0,function*(){return yield GeneralJwsVerifier.singleton.verifySignatures(e,At)})}verifySignatures(e,At){return __awaiter$3f(this,void 0,void 0,function*(){const kt=[];for(const Bt of e.signatures){let Nt;const jt=Jws.getKid(Bt),Lt=`${Bt.protected}.${e.payload}.${Bt.signature}`,er=yield this.cache.get(Lt);if(er===void 0){const zt=yield GeneralJwsVerifier.getPublicKey(jt,At);Nt=yield Jws.verifySignature(e.payload,Bt,zt),yield this.cache.set(Lt,Nt)}else Nt=er;const tr=Jws.extractDid(jt);if(Nt)kt.push(tr);else throw new DwnError(DwnErrorCode.GeneralJwsVerifierInvalidSignature,`Signature verification failed for ${tr}`)}return{signers:kt}})}static getPublicKey(e,At){return __awaiter$3f(this,void 0,void 0,function*(){const kt=Jws.extractDid(e),{didDocument:Bt}=yield At.resolve(kt),{verificationMethod:Nt=[]}=Bt||{};let jt;for(const er of Nt)if(e.endsWith(er.id)){jt=er;break}if(!jt)throw new DwnError(DwnErrorCode.GeneralJwsVerifierGetPublicKeyNotFound,"public key needed to verify signature not found in DID Document");validateJsonSchema("JwkVerificationMethod",jt);const{publicKeyJwk:Lt}=jt;return Lt})}}const typeofs=["string","number","bigint","symbol"],objectTypeNames=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function is(xt){if(xt===null)return"null";if(xt===void 0)return"undefined";if(xt===!0||xt===!1)return"boolean";const e=typeof xt;if(typeofs.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(xt))return"Array";if(isBuffer$1(xt))return"Buffer";const At=getObjectType(xt);return At||"Object"}function isBuffer$1(xt){return xt&&xt.constructor&&xt.constructor.isBuffer&&xt.constructor.isBuffer.call(null,xt)}function getObjectType(xt){const e=Object.prototype.toString.call(xt).slice(8,-1);if(objectTypeNames.includes(e))return e}class Type{constructor(e,At,kt){this.major=e,this.majorEncoded=e<<5,this.name=At,this.terminal=kt}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}Type.uint=new Type(0,"uint",!0);Type.negint=new Type(1,"negint",!0);Type.bytes=new Type(2,"bytes",!0);Type.string=new Type(3,"string",!0);Type.array=new Type(4,"array",!1);Type.map=new Type(5,"map",!1);Type.tag=new Type(6,"tag",!1);Type.float=new Type(7,"float",!0);Type.false=new Type(7,"false",!0);Type.true=new Type(7,"true",!0);Type.null=new Type(7,"null",!0);Type.undefined=new Type(7,"undefined",!0);Type.break=new Type(7,"break",!0);class Token{constructor(e,At,kt){this.type=e,this.value=At,this.encodedLength=kt,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const useBuffer=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",textDecoder$5=new TextDecoder,textEncoder$7=new TextEncoder;function isBuffer(xt){return useBuffer&&globalThis.Buffer.isBuffer(xt)}function asU8A(xt){return xt instanceof Uint8Array?isBuffer(xt)?new Uint8Array(xt.buffer,xt.byteOffset,xt.byteLength):xt:Uint8Array.from(xt)}const toString$7=useBuffer?(xt,e,At)=>At-e>64?globalThis.Buffer.from(xt.subarray(e,At)).toString("utf8"):utf8Slice(xt,e,At):(xt,e,At)=>At-e>64?textDecoder$5.decode(xt.subarray(e,At)):utf8Slice(xt,e,At),fromString$2=useBuffer?xt=>xt.length>64?globalThis.Buffer.from(xt):utf8ToBytes$5(xt):xt=>xt.length>64?textEncoder$7.encode(xt):utf8ToBytes$5(xt),fromArray$1=xt=>Uint8Array.from(xt),slice=useBuffer?(xt,e,At)=>isBuffer(xt)?new Uint8Array(xt.subarray(e,At)):xt.slice(e,At):(xt,e,At)=>xt.slice(e,At),concat$1=useBuffer?(xt,e)=>(xt=xt.map(At=>At instanceof Uint8Array?At:globalThis.Buffer.from(At)),asU8A(globalThis.Buffer.concat(xt,e))):(xt,e)=>{const At=new Uint8Array(e);let kt=0;for(let Bt of xt)kt+Bt.length>At.length&&(Bt=Bt.subarray(0,At.length-kt)),At.set(Bt,kt),kt+=Bt.length;return At},alloc$2=useBuffer?xt=>globalThis.Buffer.allocUnsafe(xt):xt=>new Uint8Array(xt);function compare$1(xt,e){if(isBuffer(xt)&&isBuffer(e))return xt.compare(e);for(let At=0;At<xt.length;At++)if(xt[At]!==e[At])return xt[At]<e[At]?-1:1;return 0}function utf8ToBytes$5(xt,e=1/0){let At;const kt=xt.length;let Bt=null;const Nt=[];for(let jt=0;jt<kt;++jt){if(At=xt.charCodeAt(jt),At>55295&&At<57344){if(!Bt){if(At>56319){(e-=3)>-1&&Nt.push(239,191,189);continue}else if(jt+1===kt){(e-=3)>-1&&Nt.push(239,191,189);continue}Bt=At;continue}if(At<56320){(e-=3)>-1&&Nt.push(239,191,189),Bt=At;continue}At=(Bt-55296<<10|At-56320)+65536}else Bt&&(e-=3)>-1&&Nt.push(239,191,189);if(Bt=null,At<128){if((e-=1)<0)break;Nt.push(At)}else if(At<2048){if((e-=2)<0)break;Nt.push(At>>6|192,At&63|128)}else if(At<65536){if((e-=3)<0)break;Nt.push(At>>12|224,At>>6&63|128,At&63|128)}else if(At<1114112){if((e-=4)<0)break;Nt.push(At>>18|240,At>>12&63|128,At>>6&63|128,At&63|128)}else throw new Error("Invalid code point")}return Nt}function utf8Slice(xt,e,At){const kt=[];for(;e<At;){const Bt=xt[e];let Nt=null,jt=Bt>239?4:Bt>223?3:Bt>191?2:1;if(e+jt<=At){let Lt,er,tr,zt;switch(jt){case 1:Bt<128&&(Nt=Bt);break;case 2:Lt=xt[e+1],(Lt&192)===128&&(zt=(Bt&31)<<6|Lt&63,zt>127&&(Nt=zt));break;case 3:Lt=xt[e+1],er=xt[e+2],(Lt&192)===128&&(er&192)===128&&(zt=(Bt&15)<<12|(Lt&63)<<6|er&63,zt>2047&&(zt<55296||zt>57343)&&(Nt=zt));break;case 4:Lt=xt[e+1],er=xt[e+2],tr=xt[e+3],(Lt&192)===128&&(er&192)===128&&(tr&192)===128&&(zt=(Bt&15)<<18|(Lt&63)<<12|(er&63)<<6|tr&63,zt>65535&&zt<1114112&&(Nt=zt))}}Nt===null?(Nt=65533,jt=1):Nt>65535&&(Nt-=65536,kt.push(Nt>>>10&1023|55296),Nt=56320|Nt&1023),kt.push(Nt),e+=jt}return decodeCodePointsArray(kt)}const MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(xt){const e=xt.length;if(e<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,xt);let At="",kt=0;for(;kt<e;)At+=String.fromCharCode.apply(String,xt.slice(kt,kt+=MAX_ARGUMENTS_LENGTH));return At}const defaultChunkSize=256;class Bl{constructor(e=defaultChunkSize){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let At=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const Bt=At.length-(this.maxCursor-this.cursor)-1;At.set(e,Bt)}else{if(At){const Bt=At.length-(this.maxCursor-this.cursor)-1;Bt<At.length&&(this.chunks[this.chunks.length-1]=At.subarray(0,Bt),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(At=alloc$2(this.chunkSize),this.chunks.push(At),this.maxCursor+=At.length,this._initReuseChunk===null&&(this._initReuseChunk=At),At.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let At;if(this.chunks.length===1){const kt=this.chunks[0];e&&this.cursor>kt.length/2?(At=this.cursor===kt.length?kt:kt.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):At=slice(kt,0,this.cursor)}else At=concat$1(this.chunks,this.cursor);return e&&this.reset(),At}}const decodeErrPrefix="CBOR decode error:",encodeErrPrefix="CBOR encode error:";function assertEnoughData(xt,e,At){if(xt.length-e<At)throw new Error(`${decodeErrPrefix} not enough data for type`)}const uintBoundaries=[24,256,65536,4294967296,BigInt("18446744073709551616")];function readUint8(xt,e,At){assertEnoughData(xt,e,1);const kt=xt[e];if(At.strict===!0&&kt<uintBoundaries[0])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return kt}function readUint16(xt,e,At){assertEnoughData(xt,e,2);const kt=xt[e]<<8|xt[e+1];if(At.strict===!0&&kt<uintBoundaries[1])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return kt}function readUint32(xt,e,At){assertEnoughData(xt,e,4);const kt=xt[e]*16777216+(xt[e+1]<<16)+(xt[e+2]<<8)+xt[e+3];if(At.strict===!0&&kt<uintBoundaries[2])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);return kt}function readUint64(xt,e,At){assertEnoughData(xt,e,8);const kt=xt[e]*16777216+(xt[e+1]<<16)+(xt[e+2]<<8)+xt[e+3],Bt=xt[e+4]*16777216+(xt[e+5]<<16)+(xt[e+6]<<8)+xt[e+7],Nt=(BigInt(kt)<<BigInt(32))+BigInt(Bt);if(At.strict===!0&&Nt<uintBoundaries[3])throw new Error(`${decodeErrPrefix} integer encoded in more bytes than necessary (strict decode)`);if(Nt<=Number.MAX_SAFE_INTEGER)return Number(Nt);if(At.allowBigInt===!0)return Nt;throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`)}function decodeUint8(xt,e,At,kt){return new Token(Type.uint,readUint8(xt,e+1,kt),2)}function decodeUint16(xt,e,At,kt){return new Token(Type.uint,readUint16(xt,e+1,kt),3)}function decodeUint32(xt,e,At,kt){return new Token(Type.uint,readUint32(xt,e+1,kt),5)}function decodeUint64(xt,e,At,kt){return new Token(Type.uint,readUint64(xt,e+1,kt),9)}function encodeUint(xt,e){return encodeUintValue(xt,0,e.value)}function encodeUintValue(xt,e,At){if(At<uintBoundaries[0]){const kt=Number(At);xt.push([e|kt])}else if(At<uintBoundaries[1]){const kt=Number(At);xt.push([e|24,kt])}else if(At<uintBoundaries[2]){const kt=Number(At);xt.push([e|25,kt>>>8,kt&255])}else if(At<uintBoundaries[3]){const kt=Number(At);xt.push([e|26,kt>>>24&255,kt>>>16&255,kt>>>8&255,kt&255])}else{const kt=BigInt(At);if(kt<uintBoundaries[4]){const Bt=[e|27,0,0,0,0,0,0,0];let Nt=Number(kt&BigInt(4294967295)),jt=Number(kt>>BigInt(32)&BigInt(4294967295));Bt[8]=Nt&255,Nt=Nt>>8,Bt[7]=Nt&255,Nt=Nt>>8,Bt[6]=Nt&255,Nt=Nt>>8,Bt[5]=Nt&255,Bt[4]=jt&255,jt=jt>>8,Bt[3]=jt&255,jt=jt>>8,Bt[2]=jt&255,jt=jt>>8,Bt[1]=jt&255,xt.push(Bt)}else throw new Error(`${decodeErrPrefix} encountered BigInt larger than allowable range`)}}encodeUint.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};encodeUintValue.encodedSize=function(e){return e<uintBoundaries[0]?1:e<uintBoundaries[1]?2:e<uintBoundaries[2]?3:e<uintBoundaries[3]?5:9};encodeUint.compareTokens=function(e,At){return e.value<At.value?-1:e.value>At.value?1:0};function decodeNegint8(xt,e,At,kt){return new Token(Type.negint,-1-readUint8(xt,e+1,kt),2)}function decodeNegint16(xt,e,At,kt){return new Token(Type.negint,-1-readUint16(xt,e+1,kt),3)}function decodeNegint32(xt,e,At,kt){return new Token(Type.negint,-1-readUint32(xt,e+1,kt),5)}const neg1b=BigInt(-1),pos1b=BigInt(1);function decodeNegint64(xt,e,At,kt){const Bt=readUint64(xt,e+1,kt);if(typeof Bt!="bigint"){const Nt=-1-Bt;if(Nt>=Number.MIN_SAFE_INTEGER)return new Token(Type.negint,Nt,9)}if(kt.allowBigInt!==!0)throw new Error(`${decodeErrPrefix} integers outside of the safe integer range are not supported`);return new Token(Type.negint,neg1b-BigInt(Bt),9)}function encodeNegint(xt,e){const At=e.value,kt=typeof At=="bigint"?At*neg1b-pos1b:At*-1-1;encodeUintValue(xt,e.type.majorEncoded,kt)}encodeNegint.encodedSize=function(e){const At=e.value,kt=typeof At=="bigint"?At*neg1b-pos1b:At*-1-1;return kt<uintBoundaries[0]?1:kt<uintBoundaries[1]?2:kt<uintBoundaries[2]?3:kt<uintBoundaries[3]?5:9};encodeNegint.compareTokens=function(e,At){return e.value<At.value?1:e.value>At.value?-1:0};function toToken$3(xt,e,At,kt){assertEnoughData(xt,e,At+kt);const Bt=slice(xt,e+At,e+At+kt);return new Token(Type.bytes,Bt,At+kt)}function decodeBytesCompact(xt,e,At,kt){return toToken$3(xt,e,1,At)}function decodeBytes8(xt,e,At,kt){return toToken$3(xt,e,2,readUint8(xt,e+1,kt))}function decodeBytes16(xt,e,At,kt){return toToken$3(xt,e,3,readUint16(xt,e+1,kt))}function decodeBytes32(xt,e,At,kt){return toToken$3(xt,e,5,readUint32(xt,e+1,kt))}function decodeBytes64(xt,e,At,kt){const Bt=readUint64(xt,e+1,kt);if(typeof Bt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer bytes lengths not supported`);return toToken$3(xt,e,9,Bt)}function tokenBytes(xt){return xt.encodedBytes===void 0&&(xt.encodedBytes=xt.type===Type.string?fromString$2(xt.value):xt.value),xt.encodedBytes}function encodeBytes(xt,e){const At=tokenBytes(e);encodeUintValue(xt,e.type.majorEncoded,At.length),xt.push(At)}encodeBytes.encodedSize=function(e){const At=tokenBytes(e);return encodeUintValue.encodedSize(At.length)+At.length};encodeBytes.compareTokens=function(e,At){return compareBytes(tokenBytes(e),tokenBytes(At))};function compareBytes(xt,e){return xt.length<e.length?-1:xt.length>e.length?1:compare$1(xt,e)}function toToken$2(xt,e,At,kt,Bt){const Nt=At+kt;assertEnoughData(xt,e,Nt);const jt=new Token(Type.string,toString$7(xt,e+At,e+Nt),Nt);return Bt.retainStringBytes===!0&&(jt.byteValue=slice(xt,e+At,e+Nt)),jt}function decodeStringCompact(xt,e,At,kt){return toToken$2(xt,e,1,At,kt)}function decodeString8(xt,e,At,kt){return toToken$2(xt,e,2,readUint8(xt,e+1,kt),kt)}function decodeString16(xt,e,At,kt){return toToken$2(xt,e,3,readUint16(xt,e+1,kt),kt)}function decodeString32(xt,e,At,kt){return toToken$2(xt,e,5,readUint32(xt,e+1,kt),kt)}function decodeString64(xt,e,At,kt){const Bt=readUint64(xt,e+1,kt);if(typeof Bt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer string lengths not supported`);return toToken$2(xt,e,9,Bt,kt)}const encodeString=encodeBytes;function toToken$1(xt,e,At,kt){return new Token(Type.array,kt,At)}function decodeArrayCompact(xt,e,At,kt){return toToken$1(xt,e,1,At)}function decodeArray8(xt,e,At,kt){return toToken$1(xt,e,2,readUint8(xt,e+1,kt))}function decodeArray16(xt,e,At,kt){return toToken$1(xt,e,3,readUint16(xt,e+1,kt))}function decodeArray32(xt,e,At,kt){return toToken$1(xt,e,5,readUint32(xt,e+1,kt))}function decodeArray64(xt,e,At,kt){const Bt=readUint64(xt,e+1,kt);if(typeof Bt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer array lengths not supported`);return toToken$1(xt,e,9,Bt)}function decodeArrayIndefinite(xt,e,At,kt){if(kt.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken$1(xt,e,1,1/0)}function encodeArray(xt,e){encodeUintValue(xt,Type.array.majorEncoded,e.value)}encodeArray.compareTokens=encodeUint.compareTokens;encodeArray.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};function toToken(xt,e,At,kt){return new Token(Type.map,kt,At)}function decodeMapCompact(xt,e,At,kt){return toToken(xt,e,1,At)}function decodeMap8(xt,e,At,kt){return toToken(xt,e,2,readUint8(xt,e+1,kt))}function decodeMap16(xt,e,At,kt){return toToken(xt,e,3,readUint16(xt,e+1,kt))}function decodeMap32(xt,e,At,kt){return toToken(xt,e,5,readUint32(xt,e+1,kt))}function decodeMap64(xt,e,At,kt){const Bt=readUint64(xt,e+1,kt);if(typeof Bt=="bigint")throw new Error(`${decodeErrPrefix} 64-bit integer map lengths not supported`);return toToken(xt,e,9,Bt)}function decodeMapIndefinite(xt,e,At,kt){if(kt.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return toToken(xt,e,1,1/0)}function encodeMap(xt,e){encodeUintValue(xt,Type.map.majorEncoded,e.value)}encodeMap.compareTokens=encodeUint.compareTokens;encodeMap.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};function decodeTagCompact(xt,e,At,kt){return new Token(Type.tag,At,1)}function decodeTag8(xt,e,At,kt){return new Token(Type.tag,readUint8(xt,e+1,kt),2)}function decodeTag16(xt,e,At,kt){return new Token(Type.tag,readUint16(xt,e+1,kt),3)}function decodeTag32(xt,e,At,kt){return new Token(Type.tag,readUint32(xt,e+1,kt),5)}function decodeTag64(xt,e,At,kt){return new Token(Type.tag,readUint64(xt,e+1,kt),9)}function encodeTag(xt,e){encodeUintValue(xt,Type.tag.majorEncoded,e.value)}encodeTag.compareTokens=encodeUint.compareTokens;encodeTag.encodedSize=function(e){return encodeUintValue.encodedSize(e.value)};const MINOR_FALSE=20,MINOR_TRUE=21,MINOR_NULL=22,MINOR_UNDEFINED=23;function decodeUndefined(xt,e,At,kt){if(kt.allowUndefined===!1)throw new Error(`${decodeErrPrefix} undefined values are not supported`);return kt.coerceUndefinedToNull===!0?new Token(Type.null,null,1):new Token(Type.undefined,void 0,1)}function decodeBreak(xt,e,At,kt){if(kt.allowIndefinite===!1)throw new Error(`${decodeErrPrefix} indefinite length items not allowed`);return new Token(Type.break,void 0,1)}function createToken(xt,e,At){if(At){if(At.allowNaN===!1&&Number.isNaN(xt))throw new Error(`${decodeErrPrefix} NaN values are not supported`);if(At.allowInfinity===!1&&(xt===1/0||xt===-1/0))throw new Error(`${decodeErrPrefix} Infinity values are not supported`)}return new Token(Type.float,xt,e)}function decodeFloat16(xt,e,At,kt){return createToken(readFloat16(xt,e+1),3,kt)}function decodeFloat32(xt,e,At,kt){return createToken(readFloat32(xt,e+1),5,kt)}function decodeFloat64(xt,e,At,kt){return createToken(readFloat64(xt,e+1),9,kt)}function encodeFloat(xt,e,At){const kt=e.value;if(kt===!1)xt.push([Type.float.majorEncoded|MINOR_FALSE]);else if(kt===!0)xt.push([Type.float.majorEncoded|MINOR_TRUE]);else if(kt===null)xt.push([Type.float.majorEncoded|MINOR_NULL]);else if(kt===void 0)xt.push([Type.float.majorEncoded|MINOR_UNDEFINED]);else{let Bt,Nt=!1;(!At||At.float64!==!0)&&(encodeFloat16(kt),Bt=readFloat16(ui8a,1),kt===Bt||Number.isNaN(kt)?(ui8a[0]=249,xt.push(ui8a.slice(0,3)),Nt=!0):(encodeFloat32(kt),Bt=readFloat32(ui8a,1),kt===Bt&&(ui8a[0]=250,xt.push(ui8a.slice(0,5)),Nt=!0))),Nt||(encodeFloat64(kt),Bt=readFloat64(ui8a,1),ui8a[0]=251,xt.push(ui8a.slice(0,9)))}}encodeFloat.encodedSize=function(e,At){const kt=e.value;if(kt===!1||kt===!0||kt===null||kt===void 0)return 1;if(!At||At.float64!==!0){encodeFloat16(kt);let Bt=readFloat16(ui8a,1);if(kt===Bt||Number.isNaN(kt))return 3;if(encodeFloat32(kt),Bt=readFloat32(ui8a,1),kt===Bt)return 5}return 9};const buffer$1=new ArrayBuffer(9),dataView=new DataView(buffer$1,1),ui8a=new Uint8Array(buffer$1,0);function encodeFloat16(xt){if(xt===1/0)dataView.setUint16(0,31744,!1);else if(xt===-1/0)dataView.setUint16(0,64512,!1);else if(Number.isNaN(xt))dataView.setUint16(0,32256,!1);else{dataView.setFloat32(0,xt);const e=dataView.getUint32(0),At=(e&2139095040)>>23,kt=e&8388607;if(At===255)dataView.setUint16(0,31744,!1);else if(At===0)dataView.setUint16(0,(xt&2147483648)>>16|kt>>13,!1);else{const Bt=At-127;Bt<-24?dataView.setUint16(0,0):Bt<-14?dataView.setUint16(0,(e&2147483648)>>16|1<<24+Bt,!1):dataView.setUint16(0,(e&2147483648)>>16|Bt+15<<10|kt>>13,!1)}}}function readFloat16(xt,e){if(xt.length-e<2)throw new Error(`${decodeErrPrefix} not enough data for float16`);const At=(xt[e]<<8)+xt[e+1];if(At===31744)return 1/0;if(At===64512)return-1/0;if(At===32256)return NaN;const kt=At>>10&31,Bt=At&1023;let Nt;return kt===0?Nt=Bt*2**-24:kt!==31?Nt=(Bt+1024)*2**(kt-25):Nt=Bt===0?1/0:NaN,At&32768?-Nt:Nt}function encodeFloat32(xt){dataView.setFloat32(0,xt,!1)}function readFloat32(xt,e){if(xt.length-e<4)throw new Error(`${decodeErrPrefix} not enough data for float32`);const At=(xt.byteOffset||0)+e;return new DataView(xt.buffer,At,4).getFloat32(0,!1)}function encodeFloat64(xt){dataView.setFloat64(0,xt,!1)}function readFloat64(xt,e){if(xt.length-e<8)throw new Error(`${decodeErrPrefix} not enough data for float64`);const At=(xt.byteOffset||0)+e;return new DataView(xt.buffer,At,8).getFloat64(0,!1)}encodeFloat.compareTokens=encodeUint.compareTokens;function invalidMinor(xt,e,At){throw new Error(`${decodeErrPrefix} encountered invalid minor (${At}) for major ${xt[e]>>>5}`)}function errorer(xt){return()=>{throw new Error(`${decodeErrPrefix} ${xt}`)}}const jump=[];for(let xt=0;xt<=23;xt++)jump[xt]=invalidMinor;jump[24]=decodeUint8;jump[25]=decodeUint16;jump[26]=decodeUint32;jump[27]=decodeUint64;jump[28]=invalidMinor;jump[29]=invalidMinor;jump[30]=invalidMinor;jump[31]=invalidMinor;for(let xt=32;xt<=55;xt++)jump[xt]=invalidMinor;jump[56]=decodeNegint8;jump[57]=decodeNegint16;jump[58]=decodeNegint32;jump[59]=decodeNegint64;jump[60]=invalidMinor;jump[61]=invalidMinor;jump[62]=invalidMinor;jump[63]=invalidMinor;for(let xt=64;xt<=87;xt++)jump[xt]=decodeBytesCompact;jump[88]=decodeBytes8;jump[89]=decodeBytes16;jump[90]=decodeBytes32;jump[91]=decodeBytes64;jump[92]=invalidMinor;jump[93]=invalidMinor;jump[94]=invalidMinor;jump[95]=errorer("indefinite length bytes/strings are not supported");for(let xt=96;xt<=119;xt++)jump[xt]=decodeStringCompact;jump[120]=decodeString8;jump[121]=decodeString16;jump[122]=decodeString32;jump[123]=decodeString64;jump[124]=invalidMinor;jump[125]=invalidMinor;jump[126]=invalidMinor;jump[127]=errorer("indefinite length bytes/strings are not supported");for(let xt=128;xt<=151;xt++)jump[xt]=decodeArrayCompact;jump[152]=decodeArray8;jump[153]=decodeArray16;jump[154]=decodeArray32;jump[155]=decodeArray64;jump[156]=invalidMinor;jump[157]=invalidMinor;jump[158]=invalidMinor;jump[159]=decodeArrayIndefinite;for(let xt=160;xt<=183;xt++)jump[xt]=decodeMapCompact;jump[184]=decodeMap8;jump[185]=decodeMap16;jump[186]=decodeMap32;jump[187]=decodeMap64;jump[188]=invalidMinor;jump[189]=invalidMinor;jump[190]=invalidMinor;jump[191]=decodeMapIndefinite;for(let xt=192;xt<=215;xt++)jump[xt]=decodeTagCompact;jump[216]=decodeTag8;jump[217]=decodeTag16;jump[218]=decodeTag32;jump[219]=decodeTag64;jump[220]=invalidMinor;jump[221]=invalidMinor;jump[222]=invalidMinor;jump[223]=invalidMinor;for(let xt=224;xt<=243;xt++)jump[xt]=errorer("simple values are not supported");jump[244]=invalidMinor;jump[245]=invalidMinor;jump[246]=invalidMinor;jump[247]=decodeUndefined;jump[248]=errorer("simple values are not supported");jump[249]=decodeFloat16;jump[250]=decodeFloat32;jump[251]=decodeFloat64;jump[252]=invalidMinor;jump[253]=invalidMinor;jump[254]=invalidMinor;jump[255]=decodeBreak;const quick=[];for(let xt=0;xt<24;xt++)quick[xt]=new Token(Type.uint,xt,1);for(let xt=-1;xt>=-24;xt--)quick[31-xt]=new Token(Type.negint,xt,1);quick[64]=new Token(Type.bytes,new Uint8Array(0),1);quick[96]=new Token(Type.string,"",1);quick[128]=new Token(Type.array,0,1);quick[160]=new Token(Type.map,0,1);quick[244]=new Token(Type.false,!1,1);quick[245]=new Token(Type.true,!0,1);quick[246]=new Token(Type.null,null,1);function quickEncodeToken(xt){switch(xt.type){case Type.false:return fromArray$1([244]);case Type.true:return fromArray$1([245]);case Type.null:return fromArray$1([246]);case Type.bytes:return xt.value.length?void 0:fromArray$1([64]);case Type.string:return xt.value===""?fromArray$1([96]):void 0;case Type.array:return xt.value===0?fromArray$1([128]):void 0;case Type.map:return xt.value===0?fromArray$1([160]):void 0;case Type.uint:return xt.value<24?fromArray$1([Number(xt.value)]):void 0;case Type.negint:if(xt.value>=-24)return fromArray$1([31-Number(xt.value)])}}const defaultEncodeOptions={float64:!1,mapSorter,quickEncodeToken};function makeCborEncoders(){const xt=[];return xt[Type.uint.major]=encodeUint,xt[Type.negint.major]=encodeNegint,xt[Type.bytes.major]=encodeBytes,xt[Type.string.major]=encodeString,xt[Type.array.major]=encodeArray,xt[Type.map.major]=encodeMap,xt[Type.tag.major]=encodeTag,xt[Type.float.major]=encodeFloat,xt}const cborEncoders=makeCborEncoders(),buf=new Bl;class Ref{constructor(e,At){this.obj=e,this.parent=At}includes(e){let At=this;do if(At.obj===e)return!0;while(At=At.parent);return!1}static createCheck(e,At){if(e&&e.includes(At))throw new Error(`${encodeErrPrefix} object contains circular references`);return new Ref(At,e)}}const simpleTokens={null:new Token(Type.null,null),undefined:new Token(Type.undefined,void 0),true:new Token(Type.true,!0),false:new Token(Type.false,!1),emptyArray:new Token(Type.array,0),emptyMap:new Token(Type.map,0)},typeEncoders={number(xt,e,At,kt){return!Number.isInteger(xt)||!Number.isSafeInteger(xt)?new Token(Type.float,xt):xt>=0?new Token(Type.uint,xt):new Token(Type.negint,xt)},bigint(xt,e,At,kt){return xt>=BigInt(0)?new Token(Type.uint,xt):new Token(Type.negint,xt)},Uint8Array(xt,e,At,kt){return new Token(Type.bytes,xt)},string(xt,e,At,kt){return new Token(Type.string,xt)},boolean(xt,e,At,kt){return xt?simpleTokens.true:simpleTokens.false},null(xt,e,At,kt){return simpleTokens.null},undefined(xt,e,At,kt){return simpleTokens.undefined},ArrayBuffer(xt,e,At,kt){return new Token(Type.bytes,new Uint8Array(xt))},DataView(xt,e,At,kt){return new Token(Type.bytes,new Uint8Array(xt.buffer,xt.byteOffset,xt.byteLength))},Array(xt,e,At,kt){if(!xt.length)return At.addBreakTokens===!0?[simpleTokens.emptyArray,new Token(Type.break)]:simpleTokens.emptyArray;kt=Ref.createCheck(kt,xt);const Bt=[];let Nt=0;for(const jt of xt)Bt[Nt++]=objectToTokens(jt,At,kt);return At.addBreakTokens?[new Token(Type.array,xt.length),Bt,new Token(Type.break)]:[new Token(Type.array,xt.length),Bt]},Object(xt,e,At,kt){const Bt=e!=="Object",Nt=Bt?xt.keys():Object.keys(xt),jt=Bt?xt.size:Nt.length;if(!jt)return At.addBreakTokens===!0?[simpleTokens.emptyMap,new Token(Type.break)]:simpleTokens.emptyMap;kt=Ref.createCheck(kt,xt);const Lt=[];let er=0;for(const tr of Nt)Lt[er++]=[objectToTokens(tr,At,kt),objectToTokens(Bt?xt.get(tr):xt[tr],At,kt)];return sortMapEntries(Lt,At),At.addBreakTokens?[new Token(Type.map,jt),Lt,new Token(Type.break)]:[new Token(Type.map,jt),Lt]}};typeEncoders.Map=typeEncoders.Object;typeEncoders.Buffer=typeEncoders.Uint8Array;for(const xt of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))typeEncoders[`${xt}Array`]=typeEncoders.DataView;function objectToTokens(xt,e={},At){const kt=is(xt),Bt=e&&e.typeEncoders&&e.typeEncoders[kt]||typeEncoders[kt];if(typeof Bt=="function"){const jt=Bt(xt,kt,e,At);if(jt!=null)return jt}const Nt=typeEncoders[kt];if(!Nt)throw new Error(`${encodeErrPrefix} unsupported type: ${kt}`);return Nt(xt,kt,e,At)}function sortMapEntries(xt,e){e.mapSorter&&xt.sort(e.mapSorter)}function mapSorter(xt,e){const At=Array.isArray(xt[0])?xt[0][0]:xt[0],kt=Array.isArray(e[0])?e[0][0]:e[0];if(At.type!==kt.type)return At.type.compare(kt.type);const Bt=At.type.major,Nt=cborEncoders[Bt].compareTokens(At,kt);return Nt===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),Nt}function tokensToEncoded(xt,e,At,kt){if(Array.isArray(e))for(const Bt of e)tokensToEncoded(xt,Bt,At,kt);else At[e.type.major](xt,e,kt)}function encodeCustom(xt,e,At){const kt=objectToTokens(xt,At);if(!Array.isArray(kt)&&At.quickEncodeToken){const Bt=At.quickEncodeToken(kt);if(Bt)return Bt;const Nt=e[kt.type.major];if(Nt.encodedSize){const jt=Nt.encodedSize(kt,At),Lt=new Bl(jt);if(Nt(Lt,kt,At),Lt.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${kt} was wrong`);return asU8A(Lt.chunks[0])}}return buf.reset(),tokensToEncoded(buf,kt,e,At),buf.toBytes(!0)}function encode$e(xt,e){return e=Object.assign({},defaultEncodeOptions,e),encodeCustom(xt,cborEncoders,e)}const defaultDecodeOptions={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Tokeniser{constructor(e,At={}){this.pos=0,this.data=e,this.options=At}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let At=quick[e];if(At===void 0){const kt=jump[e];if(!kt)throw new Error(`${decodeErrPrefix} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const Bt=e&31;At=kt(this.data,this.pos,Bt,this.options)}return this.pos+=At.encodedLength,At}}const DONE=Symbol.for("DONE"),BREAK=Symbol.for("BREAK");function tokenToArray(xt,e,At){const kt=[];for(let Bt=0;Bt<xt.value;Bt++){const Nt=tokensToObject(e,At);if(Nt===BREAK){if(xt.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed array`)}if(Nt===DONE)throw new Error(`${decodeErrPrefix} found array but not enough entries (got ${Bt}, expected ${xt.value})`);kt[Bt]=Nt}return kt}function tokenToMap(xt,e,At){const kt=At.useMaps===!0,Bt=kt?void 0:{},Nt=kt?new Map:void 0;for(let jt=0;jt<xt.value;jt++){const Lt=tokensToObject(e,At);if(Lt===BREAK){if(xt.value===1/0)break;throw new Error(`${decodeErrPrefix} got unexpected break to lengthed map`)}if(Lt===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${jt} [no key], expected ${xt.value})`);if(kt!==!0&&typeof Lt!="string")throw new Error(`${decodeErrPrefix} non-string keys not supported (got ${typeof Lt})`);if(At.rejectDuplicateMapKeys===!0&&(kt&&Nt.has(Lt)||!kt&&Lt in Bt))throw new Error(`${decodeErrPrefix} found repeat map key "${Lt}"`);const er=tokensToObject(e,At);if(er===DONE)throw new Error(`${decodeErrPrefix} found map but not enough entries (got ${jt} [no value], expected ${xt.value})`);kt?Nt.set(Lt,er):Bt[Lt]=er}return kt?Nt:Bt}function tokensToObject(xt,e){if(xt.done())return DONE;const At=xt.next();if(At.type===Type.break)return BREAK;if(At.type.terminal)return At.value;if(At.type===Type.array)return tokenToArray(At,xt,e);if(At.type===Type.map)return tokenToMap(At,xt,e);if(At.type===Type.tag){if(e.tags&&typeof e.tags[At.value]=="function"){const kt=tokensToObject(xt,e);return e.tags[At.value](kt)}throw new Error(`${decodeErrPrefix} tag not supported (${At.value})`)}throw new Error("unsupported")}function decode$g(xt,e){if(!(xt instanceof Uint8Array))throw new Error(`${decodeErrPrefix} data to decode must be a Uint8Array`);e=Object.assign({},defaultDecodeOptions,e);const At=e.tokenizer||new Tokeniser(xt,e),kt=tokensToObject(At,e);if(kt===DONE)throw new Error(`${decodeErrPrefix} did not find any content to decode`);if(kt===BREAK)throw new Error(`${decodeErrPrefix} got unexpected break`);if(!At.done())throw new Error(`${decodeErrPrefix} too many terminals, data makes no sense`);return kt}function base$3(xt,e){if(xt.length>=255)throw new TypeError("Alphabet too long");for(var At=new Uint8Array(256),kt=0;kt<At.length;kt++)At[kt]=255;for(var Bt=0;Bt<xt.length;Bt++){var Nt=xt.charAt(Bt),jt=Nt.charCodeAt(0);if(At[jt]!==255)throw new TypeError(Nt+" is ambiguous");At[jt]=Bt}var Lt=xt.length,er=xt.charAt(0),tr=Math.log(Lt)/Math.log(256),zt=Math.log(256)/Math.log(Lt);function rr(ar){if(ar instanceof Uint8Array||(ArrayBuffer.isView(ar)?ar=new Uint8Array(ar.buffer,ar.byteOffset,ar.byteLength):Array.isArray(ar)&&(ar=Uint8Array.from(ar))),!(ar instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(ar.length===0)return"";for(var dr=0,ur=0,fr=0,pr=ar.length;fr!==pr&&ar[fr]===0;)fr++,dr++;for(var lr=(pr-fr)*zt+1>>>0,yr=new Uint8Array(lr);fr!==pr;){for(var br=ar[fr],Ar=0,Pr=lr-1;(br!==0||Ar<ur)&&Pr!==-1;Pr--,Ar++)br+=256*yr[Pr]>>>0,yr[Pr]=br%Lt>>>0,br=br/Lt>>>0;if(br!==0)throw new Error("Non-zero carry");ur=Ar,fr++}for(var kr=lr-ur;kr!==lr&&yr[kr]===0;)kr++;for(var Ur=er.repeat(dr);kr<lr;++kr)Ur+=xt.charAt(yr[kr]);return Ur}function nr(ar){if(typeof ar!="string")throw new TypeError("Expected String");if(ar.length===0)return new Uint8Array;var dr=0;if(ar[dr]!==" "){for(var ur=0,fr=0;ar[dr]===er;)ur++,dr++;for(var pr=(ar.length-dr)*tr+1>>>0,lr=new Uint8Array(pr);ar[dr];){var yr=At[ar.charCodeAt(dr)];if(yr===255)return;for(var br=0,Ar=pr-1;(yr!==0||br<fr)&&Ar!==-1;Ar--,br++)yr+=Lt*lr[Ar]>>>0,lr[Ar]=yr%256>>>0,yr=yr/256>>>0;if(yr!==0)throw new Error("Non-zero carry");fr=br,dr++}if(ar[dr]!==" "){for(var Pr=pr-fr;Pr!==pr&&lr[Pr]===0;)Pr++;for(var kr=new Uint8Array(ur+(pr-Pr)),Ur=ur;Pr!==pr;)kr[Ur++]=lr[Pr++];return kr}}}function ir(ar){var dr=nr(ar);if(dr)return dr;throw new Error(`Non-${e} character`)}return{encode:rr,decodeUnsafe:nr,decode:ir}}var src$1=base$3,_brrp__multiformats_scope_baseX$1=src$1;const equals$1=(xt,e)=>{if(xt===e)return!0;if(xt.byteLength!==e.byteLength)return!1;for(let At=0;At<xt.byteLength;At++)if(xt[At]!==e[At])return!1;return!0},coerce$1=xt=>{if(xt instanceof Uint8Array&&xt.constructor.name==="Uint8Array")return xt;if(xt instanceof ArrayBuffer)return new Uint8Array(xt);if(ArrayBuffer.isView(xt))return new Uint8Array(xt.buffer,xt.byteOffset,xt.byteLength);throw new Error("Unknown type, must be binary type")},fromString$1=xt=>new TextEncoder().encode(xt),toString$6=xt=>new TextDecoder().decode(xt);let Encoder$2=class{constructor(e,At,kt){this.name=e,this.prefix=At,this.baseEncode=kt}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Decoder$1=class{constructor(e,At,kt){if(this.name=e,this.prefix=At,At.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=At.codePointAt(0),this.baseDecode=kt}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or$1(this,e)}},ComposedDecoder$1=class{constructor(e){this.decoders=e}or(e){return or$1(this,e)}decode(e){const At=e[0],kt=this.decoders[At];if(kt)return kt.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const or$1=(xt,e)=>new ComposedDecoder$1({...xt.decoders||{[xt.prefix]:xt},...e.decoders||{[e.prefix]:e}});let Codec$1=class{constructor(e,At,kt,Bt){this.name=e,this.prefix=At,this.baseEncode=kt,this.baseDecode=Bt,this.encoder=new Encoder$2(e,At,kt),this.decoder=new Decoder$1(e,At,Bt)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const from$6=({name:xt,prefix:e,encode:At,decode:kt})=>new Codec$1(xt,e,At,kt),baseX$1=({prefix:xt,name:e,alphabet:At})=>{const{encode:kt,decode:Bt}=_brrp__multiformats_scope_baseX$1(At,e);return from$6({prefix:xt,name:e,encode:kt,decode:Nt=>coerce$1(Bt(Nt))})},decode$f=(xt,e,At,kt)=>{const Bt={};for(let zt=0;zt<e.length;++zt)Bt[e[zt]]=zt;let Nt=xt.length;for(;xt[Nt-1]==="=";)--Nt;const jt=new Uint8Array(Nt*At/8|0);let Lt=0,er=0,tr=0;for(let zt=0;zt<Nt;++zt){const rr=Bt[xt[zt]];if(rr===void 0)throw new SyntaxError(`Non-${kt} character`);er=er<<At|rr,Lt+=At,Lt>=8&&(Lt-=8,jt[tr++]=255&er>>Lt)}if(Lt>=At||255&er<<8-Lt)throw new SyntaxError("Unexpected end of data");return jt},encode$d=(xt,e,At)=>{const kt=e[e.length-1]==="=",Bt=(1<<At)-1;let Nt="",jt=0,Lt=0;for(let er=0;er<xt.length;++er)for(Lt=Lt<<8|xt[er],jt+=8;jt>At;)jt-=At,Nt+=e[Bt&Lt>>jt];if(jt&&(Nt+=e[Bt&Lt<<At-jt]),kt)for(;Nt.length*At&7;)Nt+="=";return Nt},rfc4648$1=({name:xt,prefix:e,bitsPerChar:At,alphabet:kt})=>from$6({prefix:e,name:xt,encode(Bt){return encode$d(Bt,kt,At)},decode(Bt){return decode$f(Bt,kt,At,xt)}}),base32$1=rfc4648$1({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper=rfc4648$1({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad=rfc4648$1({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper=rfc4648$1({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex=rfc4648$1({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper=rfc4648$1({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad=rfc4648$1({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper=rfc4648$1({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z$2=rfc4648$1({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base32$2=Object.freeze(Object.defineProperty({__proto__:null,base32:base32$1,base32hex,base32hexpad,base32hexpadupper,base32hexupper,base32pad,base32padupper,base32upper,base32z:base32z$2},Symbol.toStringTag,{value:"Module"})),base58btc$2=baseX$1({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr=baseX$1({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),base58=Object.freeze(Object.defineProperty({__proto__:null,base58btc:base58btc$2,base58flickr},Symbol.toStringTag,{value:"Module"}));var encode_1$1=encode$c,MSB$3=128,REST$3=127,MSBALL$1=~REST$3,INT$1=Math.pow(2,31);function encode$c(xt,e,At){e=e||[],At=At||0;for(var kt=At;xt>=INT$1;)e[At++]=xt&255|MSB$3,xt/=128;for(;xt&MSBALL$1;)e[At++]=xt&255|MSB$3,xt>>>=7;return e[At]=xt|0,encode$c.bytes=At-kt+1,e}var decode$e=read$2,MSB$1$1=128,REST$1$1=127;function read$2(xt,kt){var At=0,kt=kt||0,Bt=0,Nt=kt,jt,Lt=xt.length;do{if(Nt>=Lt)throw read$2.bytes=0,new RangeError("Could not decode varint");jt=xt[Nt++],At+=Bt<28?(jt&REST$1$1)<<Bt:(jt&REST$1$1)*Math.pow(2,Bt),Bt+=7}while(jt>=MSB$1$1);return read$2.bytes=Nt-kt,At}var N1$2=Math.pow(2,7),N2$2=Math.pow(2,14),N3$2=Math.pow(2,21),N4$2=Math.pow(2,28),N5$2=Math.pow(2,35),N6$2=Math.pow(2,42),N7$2=Math.pow(2,49),N8$1=Math.pow(2,56),N9$1=Math.pow(2,63),length$2=function(xt){return xt<N1$2?1:xt<N2$2?2:xt<N3$2?3:xt<N4$2?4:xt<N5$2?5:xt<N6$2?6:xt<N7$2?7:xt<N8$1?8:xt<N9$1?9:10},varint$1={encode:encode_1$1,decode:decode$e,encodingLength:length$2},_brrp_varint$1=varint$1;const decode$d=(xt,e=0)=>[_brrp_varint$1.decode(xt,e),_brrp_varint$1.decode.bytes],encodeTo$1=(xt,e,At=0)=>(_brrp_varint$1.encode(xt,e,At),e),encodingLength$6=xt=>_brrp_varint$1.encodingLength(xt),create=(xt,e)=>{const At=e.byteLength,kt=encodingLength$6(xt),Bt=kt+encodingLength$6(At),Nt=new Uint8Array(Bt+At);return encodeTo$1(xt,Nt,0),encodeTo$1(At,Nt,kt),Nt.set(e,Bt),new Digest(xt,At,e,Nt)},decode$c=xt=>{const e=coerce$1(xt),[At,kt]=decode$d(e),[Bt,Nt]=decode$d(e.subarray(kt)),jt=e.subarray(kt+Nt);if(jt.byteLength!==Bt)throw new Error("Incorrect length");return new Digest(At,Bt,jt,e)},equals=(xt,e)=>{if(xt===e)return!0;{const At=e;return xt.code===At.code&&xt.size===At.size&&At.bytes instanceof Uint8Array&&equals$1(xt.bytes,At.bytes)}};class Digest{constructor(e,At,kt,Bt){this.code=e,this.size=At,this.digest=kt,this.bytes=Bt}}const format$7=(xt,e)=>{const{bytes:At,version:kt}=xt;switch(kt){case 0:return toStringV0$1(At,baseCache$1(xt),e||base58btc$2.encoder);default:return toStringV1$1(At,baseCache$1(xt),e||base32$1.encoder)}},cache$2=new WeakMap,baseCache$1=xt=>{const e=cache$2.get(xt);if(e==null){const At=new Map;return cache$2.set(xt,At),At}return e};let CID$1=class _o{constructor(e,At,kt,Bt){this.code=At,this.version=e,this.multihash=kt,this.bytes=Bt,this["/"]=Bt}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:At}=this;if(e!==DAG_PB_CODE$1)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(At.code!==SHA_256_CODE$1)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return _o.createV0(At)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:At}=this.multihash,kt=create(e,At);return _o.createV1(this.code,kt)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return _o.equals(this,e)}static equals(e,At){const kt=At;return kt&&e.code===kt.code&&e.version===kt.version&&equals(e.multihash,kt.multihash)}toString(e){return format$7(this,e)}toJSON(){return{"/":format$7(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const At=e;if(At instanceof _o)return At;if(At["/"]!=null&&At["/"]===At.bytes||At.asCID===At){const{version:kt,code:Bt,multihash:Nt,bytes:jt}=At;return new _o(kt,Bt,Nt,jt||encodeCID$1(kt,Bt,Nt.bytes))}else if(At[cidSymbol$1]===!0){const{version:kt,multihash:Bt,code:Nt}=At,jt=decode$c(Bt);return _o.create(kt,Nt,jt)}else return null}static create(e,At,kt){if(typeof At!="number")throw new Error("String codecs are no longer supported");if(!(kt.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(At!==DAG_PB_CODE$1)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE$1}) block encoding`);return new _o(e,At,kt,kt.bytes)}case 1:{const Bt=encodeCID$1(e,At,kt.bytes);return new _o(e,At,kt,Bt)}default:throw new Error("Invalid version")}}static createV0(e){return _o.create(0,DAG_PB_CODE$1,e)}static createV1(e,At){return _o.create(1,e,At)}static decode(e){const[At,kt]=_o.decodeFirst(e);if(kt.length)throw new Error("Incorrect length");return At}static decodeFirst(e){const At=_o.inspectBytes(e),kt=At.size-At.multihashSize,Bt=coerce$1(e.subarray(kt,kt+At.multihashSize));if(Bt.byteLength!==At.multihashSize)throw new Error("Incorrect length");const Nt=Bt.subarray(At.multihashSize-At.digestSize),jt=new Digest(At.multihashCode,At.digestSize,Nt,Bt);return[At.version===0?_o.createV0(jt):_o.createV1(At.codec,jt),e.subarray(At.size)]}static inspectBytes(e){let At=0;const kt=()=>{const[rr,nr]=decode$d(e.subarray(At));return At+=nr,rr};let Bt=kt(),Nt=DAG_PB_CODE$1;if(Bt===18?(Bt=0,At=0):Nt=kt(),Bt!==0&&Bt!==1)throw new RangeError(`Invalid CID version ${Bt}`);const jt=At,Lt=kt(),er=kt(),tr=At+er,zt=tr-jt;return{version:Bt,codec:Nt,multihashCode:Lt,digestSize:er,multihashSize:zt,size:tr}}static parse(e,At){const[kt,Bt]=parseCIDtoBytes$1(e,At),Nt=_o.decode(Bt);if(Nt.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache$1(Nt).set(kt,e),Nt}};const parseCIDtoBytes$1=(xt,e)=>{switch(xt[0]){case"Q":{const At=e||base58btc$2;return[base58btc$2.prefix,At.decode(`${base58btc$2.prefix}${xt}`)]}case base58btc$2.prefix:{const At=e||base58btc$2;return[base58btc$2.prefix,At.decode(xt)]}case base32$1.prefix:{const At=e||base32$1;return[base32$1.prefix,At.decode(xt)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[xt[0],e.decode(xt)]}}},toStringV0$1=(xt,e,At)=>{const{prefix:kt}=At;if(kt!==base58btc$2.prefix)throw Error(`Cannot string encode V0 in ${At.name} encoding`);const Bt=e.get(kt);if(Bt==null){const Nt=At.encode(xt).slice(1);return e.set(kt,Nt),Nt}else return Bt},toStringV1$1=(xt,e,At)=>{const{prefix:kt}=At,Bt=e.get(kt);if(Bt==null){const Nt=At.encode(xt);return e.set(kt,Nt),Nt}else return Bt},DAG_PB_CODE$1=112,SHA_256_CODE$1=18,encodeCID$1=(xt,e,At)=>{const kt=encodingLength$6(xt),Bt=kt+encodingLength$6(e),Nt=new Uint8Array(Bt+At.byteLength);return encodeTo$1(xt,Nt,0),encodeTo$1(e,Nt,kt),Nt.set(At,Bt),Nt},cidSymbol$1=Symbol.for("@ipld/js-cid/CID"),CID_CBOR_TAG=42;function cidEncoder(xt){if(xt.asCID!==xt&&xt["/"]!==xt.bytes)return null;const e=CID$1.asCID(xt);if(!e)return null;const At=new Uint8Array(e.bytes.byteLength+1);return At.set(e.bytes,1),[new Token(Type.tag,CID_CBOR_TAG),new Token(Type.bytes,At)]}function undefinedEncoder(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function numberEncoder(xt){if(Number.isNaN(xt))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(xt===1/0||xt===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const encodeOptions={float64:!0,typeEncoders:{Object:cidEncoder,undefined:undefinedEncoder,number:numberEncoder}};function cidDecoder(xt){if(xt[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return CID$1.decode(xt.subarray(1))}const decodeOptions={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};decodeOptions.tags[CID_CBOR_TAG]=cidDecoder;const name$5="dag-cbor",code$5=113,encode$b=xt=>encode$e(xt,encodeOptions),decode$b=xt=>decode$g(xt,decodeOptions),cbor=Object.freeze(Object.defineProperty({__proto__:null,code:code$5,decode:decode$b,encode:encode$b,name:name$5},Symbol.toStringTag,{value:"Module"})),base58btc$1=baseX$3({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});baseX$3({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const base32=rfc4648$3({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});rfc4648$3({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});rfc4648$3({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});rfc4648$3({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});rfc4648$3({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});rfc4648$3({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});rfc4648$3({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});rfc4648$3({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});const base32z$1=rfc4648$3({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),format$6=(xt,e)=>{const{bytes:At,version:kt}=xt;switch(kt){case 0:return toStringV0(At,baseCache(xt),e||base58btc$1.encoder);default:return toStringV1(At,baseCache(xt),e||base32.encoder)}},cache$1=new WeakMap,baseCache=xt=>{const e=cache$1.get(xt);if(e==null){const At=new Map;return cache$1.set(xt,At),At}return e};class CID{constructor(e,At,kt,Bt){this.code=At,this.version=e,this.multihash=kt,this.bytes=Bt,this["/"]=Bt}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:At}=this;if(e!==DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(At.code!==SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return CID.createV0(At)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:At}=this.multihash,kt=create$2(e,At);return CID.createV1(this.code,kt)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return CID.equals(this,e)}static equals(e,At){const kt=At;return kt&&e.code===kt.code&&e.version===kt.version&&equals$5(e.multihash,kt.multihash)}toString(e){return format$6(this,e)}toJSON(){return{"/":format$6(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const At=e;if(At instanceof CID)return At;if(At["/"]!=null&&At["/"]===At.bytes||At.asCID===At){const{version:kt,code:Bt,multihash:Nt,bytes:jt}=At;return new CID(kt,Bt,Nt,jt||encodeCID(kt,Bt,Nt.bytes))}else if(At[cidSymbol]===!0){const{version:kt,multihash:Bt,code:Nt}=At,jt=decode$m(Bt);return CID.create(kt,Nt,jt)}else return null}static create(e,At,kt){if(typeof At!="number")throw new Error("String codecs are no longer supported");if(!(kt.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(At!==DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${DAG_PB_CODE}) block encoding`);return new CID(e,At,kt,kt.bytes)}case 1:{const Bt=encodeCID(e,At,kt.bytes);return new CID(e,At,kt,Bt)}default:throw new Error("Invalid version")}}static createV0(e){return CID.create(0,DAG_PB_CODE,e)}static createV1(e,At){return CID.create(1,e,At)}static decode(e){const[At,kt]=CID.decodeFirst(e);if(kt.length)throw new Error("Incorrect length");return At}static decodeFirst(e){const At=CID.inspectBytes(e),kt=At.size-At.multihashSize,Bt=coerce$3(e.subarray(kt,kt+At.multihashSize));if(Bt.byteLength!==At.multihashSize)throw new Error("Incorrect length");const Nt=Bt.subarray(At.multihashSize-At.digestSize),jt=new Digest$2(At.multihashCode,At.digestSize,Nt,Bt);return[At.version===0?CID.createV0(jt):CID.createV1(At.codec,jt),e.subarray(At.size)]}static inspectBytes(e){let At=0;const kt=()=>{const[rr,nr]=decode$n(e.subarray(At));return At+=nr,rr};let Bt=kt(),Nt=DAG_PB_CODE;if(Bt===18?(Bt=0,At=0):Nt=kt(),Bt!==0&&Bt!==1)throw new RangeError(`Invalid CID version ${Bt}`);const jt=At,Lt=kt(),er=kt(),tr=At+er,zt=tr-jt;return{version:Bt,codec:Nt,multihashCode:Lt,digestSize:er,multihashSize:zt,size:tr}}static parse(e,At){const[kt,Bt]=parseCIDtoBytes(e,At),Nt=CID.decode(Bt);if(Nt.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return baseCache(Nt).set(kt,e),Nt}}const parseCIDtoBytes=(xt,e)=>{switch(xt[0]){case"Q":{const At=e||base58btc$1;return[base58btc$1.prefix,At.decode(`${base58btc$1.prefix}${xt}`)]}case base58btc$1.prefix:{const At=e||base58btc$1;return[base58btc$1.prefix,At.decode(xt)]}case base32.prefix:{const At=e||base32;return[base32.prefix,At.decode(xt)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[xt[0],e.decode(xt)]}}},toStringV0=(xt,e,At)=>{const{prefix:kt}=At;if(kt!==base58btc$1.prefix)throw Error(`Cannot string encode V0 in ${At.name} encoding`);const Bt=e.get(kt);if(Bt==null){const Nt=At.encode(xt).slice(1);return e.set(kt,Nt),Nt}else return Bt},toStringV1=(xt,e,At)=>{const{prefix:kt}=At,Bt=e.get(kt);if(Bt==null){const Nt=At.encode(xt);return e.set(kt,Nt),Nt}else return Bt},DAG_PB_CODE=112,SHA_256_CODE=18,encodeCID=(xt,e,At)=>{const kt=encodingLength$8(xt),Bt=kt+encodingLength$8(e),Nt=new Uint8Array(Bt+At.byteLength);return encodeTo$3(xt,Nt,0),encodeTo$3(e,Nt,kt),Nt.set(At,Bt),Nt},cidSymbol=Symbol.for("@ipld/js-cid/CID");var __awaiter$3e=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues$b=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}},__await$6=function(xt){return this instanceof __await$6?(this.v=xt,this):new __await$6(xt)},__asyncGenerator$5=function(xt,e,At){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var kt=At.apply(xt,e||[]),Bt,Nt=[];return Bt={},jt("next"),jt("throw"),jt("return"),Bt[Symbol.asyncIterator]=function(){return this},Bt;function jt(nr){kt[nr]&&(Bt[nr]=function(ir){return new Promise(function(ar,dr){Nt.push([nr,ir,ar,dr])>1||Lt(nr,ir)})})}function Lt(nr,ir){try{er(kt[nr](ir))}catch(ar){rr(Nt[0][3],ar)}}function er(nr){nr.value instanceof __await$6?Promise.resolve(nr.value.v).then(tr,zt):rr(Nt[0][2],nr)}function tr(nr){Lt("next",nr)}function zt(nr){Lt("throw",nr)}function rr(nr,ir){nr(ir),Nt.shift(),Nt.length&&Lt(Nt[0][0],Nt[0][1])}};class BlockstoreMock{open(){return __awaiter$3e(this,void 0,void 0,function*(){})}close(){return __awaiter$3e(this,void 0,void 0,function*(){})}put(e,At,kt){return __awaiter$3e(this,void 0,void 0,function*(){return e})}get(e,At){return __awaiter$3e(this,void 0,void 0,function*(){return new Uint8Array})}has(e,At){return __awaiter$3e(this,void 0,void 0,function*(){return!1})}delete(e,At){return __awaiter$3e(this,void 0,void 0,function*(){})}isEmpty(e){return __awaiter$3e(this,void 0,void 0,function*(){return!0})}putMany(e,At){return __asyncGenerator$5(this,arguments,function*(){var Bt,Nt,jt,Lt;try{for(var er=!0,tr=__asyncValues$b(e),zt;zt=yield __await$6(tr.next()),Bt=zt.done,!Bt;er=!0){Lt=zt.value,er=!1;const rr=Lt;yield __await$6(this.put(rr.cid,rr.block,At)),yield yield __await$6(rr.cid)}}catch(rr){Nt={error:rr}}finally{try{!er&&!Bt&&(jt=tr.return)&&(yield __await$6(jt.call(tr)))}finally{if(Nt)throw Nt.error}}})}getMany(e,At){return __asyncGenerator$5(this,arguments,function*(){var Bt,Nt,jt,Lt;try{for(var er=!0,tr=__asyncValues$b(e),zt;zt=yield __await$6(tr.next()),Bt=zt.done,!Bt;er=!0){Lt=zt.value,er=!1;const rr=Lt;yield yield __await$6({cid:rr,block:yield __await$6(this.get(rr,At))})}}catch(rr){Nt={error:rr}}finally{try{!er&&!Bt&&(jt=tr.return)&&(yield __await$6(jt.call(tr)))}finally{if(Nt)throw Nt.error}}})}getAll(e){return __asyncGenerator$5(this,arguments,function*(){var kt,Bt,Nt,jt;const Lt=this.db.iterator({keys:!0,keyEncoding:"buffer"},e);try{for(var er=!0,tr=__asyncValues$b(Lt),zt;zt=yield __await$6(tr.next()),kt=zt.done,!kt;er=!0){jt=zt.value,er=!1;const[rr,nr]=jt;yield yield __await$6({cid:CID.decode(rr),block:nr})}}catch(rr){Bt={error:rr}}finally{try{!er&&!kt&&(Nt=tr.return)&&(yield __await$6(Nt.call(tr)))}finally{if(Bt)throw Bt.error}}})}deleteMany(e,At){return __asyncGenerator$5(this,arguments,function*(){var Bt,Nt,jt,Lt;try{for(var er=!0,tr=__asyncValues$b(e),zt;zt=yield __await$6(tr.next()),Bt=zt.done,!Bt;er=!0){Lt=zt.value,er=!1;const rr=Lt;yield __await$6(this.delete(rr,At)),yield yield __await$6(rr)}}catch(rr){Nt={error:rr}}finally{try{!er&&!Bt&&(jt=tr.return)&&(yield __await$6(jt.call(tr)))}finally{if(Nt)throw Nt.error}}})}clear(){return __awaiter$3e(this,void 0,void 0,function*(){})}}function assign(xt,e){for(const At in e)Object.defineProperty(xt,At,{value:e[At],enumerable:!0,configurable:!0});return xt}function createError(xt,e,At){if(!xt||typeof xt=="string")throw new TypeError("Please pass an Error to err-code");At||(At={}),typeof e=="object"&&(At=e,e=""),e&&(At.code=e);try{return assign(xt,At)}catch{At.message=xt.message,At.stack=xt.stack;const Bt=function(){};return Bt.prototype=Object.create(Object.getPrototypeOf(xt)),assign(new Bt,At)}}var errCode=createError;const errCode$1=getDefaultExportFromCjs(errCode);function isAsyncIterable$9(xt){return xt[Symbol.asyncIterator]!=null}function batch(xt,e=1){return e=Number(e),isAsyncIterable$9(xt)?async function*(){let At=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");for await(const kt of xt)for(At.push(kt);At.length>=e;)yield At.slice(0,e),At=At.slice(e);for(;At.length>0;)yield At.slice(0,e),At=At.slice(e)}():function*(){let At=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");for(const kt of xt)for(At.push(kt);At.length>=e;)yield At.slice(0,e),At=At.slice(e);for(;At.length>0;)yield At.slice(0,e),At=At.slice(e)}()}async function*parallelBatch(xt,e=1){for await(const At of batch(xt,e)){const kt=At.map(async Bt=>Bt().then(Nt=>({ok:!0,value:Nt}),Nt=>({ok:!1,err:Nt})));for(let Bt=0;Bt<kt.length;Bt++){const Nt=await kt[Bt];if(Nt.ok)yield Nt.value;else throw Nt.err}}}const symbol=Symbol.for("@achingbrain/uint8arraylist");function findBufAndOffset(xt,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let At=0;for(const kt of xt){const Bt=At+kt.byteLength;if(e<Bt)return{buf:kt,index:e-At};At=Bt}throw new RangeError("index is out of bounds")}function isUint8ArrayList(xt){return!!(xt!=null&&xt[symbol])}var _d;class Uint8ArrayList{constructor(...e){wn(this,"bufs");wn(this,"length");wn(this,_d,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(_d=symbol,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let At=0;for(const kt of e)if(kt instanceof Uint8Array)At+=kt.byteLength,this.bufs.push(kt);else if(isUint8ArrayList(kt))At+=kt.byteLength,this.bufs.push(...kt.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=At}prepend(...e){this.prependAll(e)}prependAll(e){let At=0;for(const kt of e.reverse())if(kt instanceof Uint8Array)At+=kt.byteLength,this.bufs.unshift(kt);else if(isUint8ArrayList(kt))At+=kt.byteLength,this.bufs.unshift(...kt.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=At}get(e){const At=findBufAndOffset(this.bufs,e);return At.buf[At.index]}set(e,At){const kt=findBufAndOffset(this.bufs,e);kt.buf[kt.index]=At}write(e,At=0){if(e instanceof Uint8Array)for(let kt=0;kt<e.length;kt++)this.set(At+kt,e[kt]);else if(isUint8ArrayList(e))for(let kt=0;kt<e.length;kt++)this.set(At+kt,e.get(kt));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,At){const{bufs:kt,length:Bt}=this._subList(e,At);return concat$2(kt,Bt)}subarray(e,At){const{bufs:kt,length:Bt}=this._subList(e,At);return kt.length===1?kt[0]:concat$2(kt,Bt)}sublist(e,At){const{bufs:kt,length:Bt}=this._subList(e,At),Nt=new Uint8ArrayList;return Nt.length=Bt,Nt.bufs=[...kt],Nt}_subList(e,At){if(e=e??0,At=At??this.length,e<0&&(e=this.length+e),At<0&&(At=this.length+At),e<0||At>this.length)throw new RangeError("index is out of bounds");if(e===At)return{bufs:[],length:0};if(e===0&&At===this.length)return{bufs:this.bufs,length:this.length};const kt=[];let Bt=0;for(let Nt=0;Nt<this.bufs.length;Nt++){const jt=this.bufs[Nt],Lt=Bt,er=Lt+jt.byteLength;if(Bt=er,e>=er)continue;const tr=e>=Lt&&e<er,zt=At>Lt&&At<=er;if(tr&&zt){if(e===Lt&&At===er){kt.push(jt);break}const rr=e-Lt;kt.push(jt.subarray(rr,rr+(At-e)));break}if(tr){if(e===0){kt.push(jt);continue}kt.push(jt.subarray(e-Lt));continue}if(zt){if(At===er){kt.push(jt);break}kt.push(jt.subarray(0,At-Lt));break}kt.push(jt)}return{bufs:kt,length:At-e}}indexOf(e,At=0){if(!isUint8ArrayList(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const kt=e instanceof Uint8Array?e:e.subarray();if(At=Number(At??0),isNaN(At)&&(At=0),At<0&&(At=this.length+At),At<0&&(At=0),e.length===0)return At>this.length?this.length:At;const Bt=kt.byteLength;if(Bt===0)throw new TypeError("search must be at least 1 byte long");const Nt=256,jt=new Int32Array(Nt);for(let rr=0;rr<Nt;rr++)jt[rr]=-1;for(let rr=0;rr<Bt;rr++)jt[kt[rr]]=rr;const Lt=jt,er=this.byteLength-kt.byteLength,tr=kt.byteLength-1;let zt;for(let rr=At;rr<=er;rr+=zt){zt=0;for(let nr=tr;nr>=0;nr--){const ir=this.get(rr+nr);if(kt[nr]!==ir){zt=Math.max(1,nr-Lt[ir]);break}}if(zt===0)return rr}return-1}getInt8(e){const At=this.subarray(e,e+1);return new DataView(At.buffer,At.byteOffset,At.byteLength).getInt8(0)}setInt8(e,At){const kt=allocUnsafe$1(1);new DataView(kt.buffer,kt.byteOffset,kt.byteLength).setInt8(0,At),this.write(kt,e)}getInt16(e,At){const kt=this.subarray(e,e+2);return new DataView(kt.buffer,kt.byteOffset,kt.byteLength).getInt16(0,At)}setInt16(e,At,kt){const Bt=alloc$3(2);new DataView(Bt.buffer,Bt.byteOffset,Bt.byteLength).setInt16(0,At,kt),this.write(Bt,e)}getInt32(e,At){const kt=this.subarray(e,e+4);return new DataView(kt.buffer,kt.byteOffset,kt.byteLength).getInt32(0,At)}setInt32(e,At,kt){const Bt=alloc$3(4);new DataView(Bt.buffer,Bt.byteOffset,Bt.byteLength).setInt32(0,At,kt),this.write(Bt,e)}getBigInt64(e,At){const kt=this.subarray(e,e+8);return new DataView(kt.buffer,kt.byteOffset,kt.byteLength).getBigInt64(0,At)}setBigInt64(e,At,kt){const Bt=alloc$3(8);new DataView(Bt.buffer,Bt.byteOffset,Bt.byteLength).setBigInt64(0,At,kt),this.write(Bt,e)}getUint8(e){const At=this.subarray(e,e+1);return new DataView(At.buffer,At.byteOffset,At.byteLength).getUint8(0)}setUint8(e,At){const kt=allocUnsafe$1(1);new DataView(kt.buffer,kt.byteOffset,kt.byteLength).setUint8(0,At),this.write(kt,e)}getUint16(e,At){const kt=this.subarray(e,e+2);return new DataView(kt.buffer,kt.byteOffset,kt.byteLength).getUint16(0,At)}setUint16(e,At,kt){const Bt=alloc$3(2);new DataView(Bt.buffer,Bt.byteOffset,Bt.byteLength).setUint16(0,At,kt),this.write(Bt,e)}getUint32(e,At){const kt=this.subarray(e,e+4);return new DataView(kt.buffer,kt.byteOffset,kt.byteLength).getUint32(0,At)}setUint32(e,At,kt){const Bt=alloc$3(4);new DataView(Bt.buffer,Bt.byteOffset,Bt.byteLength).setUint32(0,At,kt),this.write(Bt,e)}getBigUint64(e,At){const kt=this.subarray(e,e+8);return new DataView(kt.buffer,kt.byteOffset,kt.byteLength).getBigUint64(0,At)}setBigUint64(e,At,kt){const Bt=alloc$3(8);new DataView(Bt.buffer,Bt.byteOffset,Bt.byteLength).setBigUint64(0,At,kt),this.write(Bt,e)}getFloat32(e,At){const kt=this.subarray(e,e+4);return new DataView(kt.buffer,kt.byteOffset,kt.byteLength).getFloat32(0,At)}setFloat32(e,At,kt){const Bt=alloc$3(4);new DataView(Bt.buffer,Bt.byteOffset,Bt.byteLength).setFloat32(0,At,kt),this.write(Bt,e)}getFloat64(e,At){const kt=this.subarray(e,e+8);return new DataView(kt.buffer,kt.byteOffset,kt.byteLength).getFloat64(0,At)}setFloat64(e,At,kt){const Bt=alloc$3(8);new DataView(Bt.buffer,Bt.byteOffset,Bt.byteLength).setFloat64(0,At,kt),this.write(Bt,e)}equals(e){if(e==null||!(e instanceof Uint8ArrayList)||e.bufs.length!==this.bufs.length)return!1;for(let At=0;At<this.bufs.length;At++)if(!equals$4(this.bufs[At],e.bufs[At]))return!1;return!0}static fromUint8Arrays(e,At){const kt=new Uint8ArrayList;return kt.bufs=e,At==null&&(At=e.reduce((Bt,Nt)=>Bt+Nt.byteLength,0)),kt.length=At,kt}}const DEFAULT_CHUNK_SIZE=262144,fixedSize=(xt={})=>{const e=xt.chunkSize??DEFAULT_CHUNK_SIZE;return async function*(kt){let Bt=new Uint8ArrayList,Nt=0,jt=!1;for await(const Lt of kt)for(Bt.append(Lt),Nt+=Lt.length;Nt>=e;)if(yield Bt.slice(0,e),jt=!0,e===Bt.length)Bt=new Uint8ArrayList,Nt=0;else{const er=new Uint8ArrayList;er.append(Bt.sublist(e)),Bt=er,Nt-=e}(!jt||Nt>0)&&(yield Bt.subarray(0,Nt))}},textDecoder$4=new TextDecoder;function decodeVarint(xt,e){let At=0;for(let kt=0;;kt+=7){if(kt>=64)throw new Error("protobuf: varint overflow");if(e>=xt.length)throw new Error("protobuf: unexpected end of data");const Bt=xt[e++];if(At+=kt<28?(Bt&127)<<kt:(Bt&127)*2**kt,Bt<128)break}return[At,e]}function decodeBytes(xt,e){let At;[At,e]=decodeVarint(xt,e);const kt=e+At;if(At<0||kt<0)throw new Error("protobuf: invalid length");if(kt>xt.length)throw new Error("protobuf: unexpected end of data");return[xt.subarray(e,kt),kt]}function decodeKey(xt,e){let At;return[At,e]=decodeVarint(xt,e),[At&7,At>>3,e]}function decodeLink(xt){const e={},At=xt.length;let kt=0;for(;kt<At;){let Bt,Nt;if([Bt,Nt,kt]=decodeKey(xt,kt),Nt===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(Bt!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${Bt}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,kt]=decodeBytes(xt,kt)}else if(Nt===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(Bt!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${Bt}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let jt;[jt,kt]=decodeBytes(xt,kt),e.Name=textDecoder$4.decode(jt)}else if(Nt===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(Bt!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${Bt}) for Tsize`);[e.Tsize,kt]=decodeVarint(xt,kt)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${Nt}`)}if(kt>At)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function decodeNode(xt){const e=xt.length;let At=0,kt,Bt=!1,Nt;for(;At<e;){let Lt,er;if([Lt,er,At]=decodeKey(xt,At),Lt!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${Lt}`);if(er===1){if(Nt)throw new Error("protobuf: (PBNode) duplicate Data section");[Nt,At]=decodeBytes(xt,At),kt&&(Bt=!0)}else if(er===2){if(Bt)throw new Error("protobuf: (PBNode) duplicate Links section");kt||(kt=[]);let tr;[tr,At]=decodeBytes(xt,At),kt.push(decodeLink(tr))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${er}`)}if(At>e)throw new Error("protobuf: (PBNode) unexpected end of data");const jt={};return Nt&&(jt.Data=Nt),jt.Links=kt||[],jt}const textEncoder$6=new TextEncoder,maxInt32=2**32,maxUInt32=2**31;function encodeLink(xt,e){let At=e.length;if(typeof xt.Tsize=="number"){if(xt.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(xt.Tsize))throw new Error("Tsize too large for encoding");At=encodeVarint(e,At,xt.Tsize)-1,e[At]=24}if(typeof xt.Name=="string"){const kt=textEncoder$6.encode(xt.Name);At-=kt.length,e.set(kt,At),At=encodeVarint(e,At,kt.length)-1,e[At]=18}return xt.Hash&&(At-=xt.Hash.length,e.set(xt.Hash,At),At=encodeVarint(e,At,xt.Hash.length)-1,e[At]=10),e.length-At}function encodeNode(xt){const e=sizeNode(xt),At=new Uint8Array(e);let kt=e;if(xt.Data&&(kt-=xt.Data.length,At.set(xt.Data,kt),kt=encodeVarint(At,kt,xt.Data.length)-1,At[kt]=10),xt.Links)for(let Bt=xt.Links.length-1;Bt>=0;Bt--){const Nt=encodeLink(xt.Links[Bt],At.subarray(0,kt));kt-=Nt,kt=encodeVarint(At,kt,Nt)-1,At[kt]=18}return At}function sizeLink(xt){let e=0;if(xt.Hash){const At=xt.Hash.length;e+=1+At+sov(At)}if(typeof xt.Name=="string"){const At=textEncoder$6.encode(xt.Name).length;e+=1+At+sov(At)}return typeof xt.Tsize=="number"&&(e+=1+sov(xt.Tsize)),e}function sizeNode(xt){let e=0;if(xt.Data){const At=xt.Data.length;e+=1+At+sov(At)}if(xt.Links)for(const At of xt.Links){const kt=sizeLink(At);e+=1+kt+sov(kt)}return e}function encodeVarint(xt,e,At){e-=sov(At);const kt=e;for(;At>=maxUInt32;)xt[e++]=At&127|128,At/=128;for(;At>=128;)xt[e++]=At&127|128,At>>>=7;return xt[e]=At,kt}function sov(xt){return xt%2===0&&xt++,Math.floor((len64(xt)+6)/7)}function len64(xt){let e=0;return xt>=maxInt32&&(xt=Math.floor(xt/maxInt32),e=32),xt>=65536&&(xt>>>=16,e+=16),xt>=256&&(xt>>>=8,e+=8),e+len8tab[xt]}const len8tab=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],pbNodeProperties=["Data","Links"],pbLinkProperties=["Hash","Name","Tsize"],textEncoder$5=new TextEncoder;function linkComparator(xt,e){if(xt===e)return 0;const At=xt.Name?textEncoder$5.encode(xt.Name):[],kt=e.Name?textEncoder$5.encode(e.Name):[];let Bt=At.length,Nt=kt.length;for(let jt=0,Lt=Math.min(Bt,Nt);jt<Lt;++jt)if(At[jt]!==kt[jt]){Bt=At[jt],Nt=kt[jt];break}return Bt<Nt?-1:Nt<Bt?1:0}function hasOnlyProperties(xt,e){return!Object.keys(xt).some(At=>!e.includes(At))}function asLink(xt){if(typeof xt.asCID=="object"){const At=CID$2.asCID(xt);if(!At)throw new TypeError("Invalid DAG-PB form");return{Hash:At}}if(typeof xt!="object"||Array.isArray(xt))throw new TypeError("Invalid DAG-PB form");const e={};if(xt.Hash){let At=CID$2.asCID(xt.Hash);try{At||(typeof xt.Hash=="string"?At=CID$2.parse(xt.Hash):xt.Hash instanceof Uint8Array&&(At=CID$2.decode(xt.Hash)))}catch(kt){throw new TypeError(`Invalid DAG-PB form: ${kt.message}`)}At&&(e.Hash=At)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof xt.Name=="string"&&(e.Name=xt.Name),typeof xt.Tsize=="number"&&(e.Tsize=xt.Tsize),e}function prepare(xt){if((xt instanceof Uint8Array||typeof xt=="string")&&(xt={Data:xt}),typeof xt!="object"||Array.isArray(xt))throw new TypeError("Invalid DAG-PB form");const e={};if(xt.Data!==void 0)if(typeof xt.Data=="string")e.Data=textEncoder$5.encode(xt.Data);else if(xt.Data instanceof Uint8Array)e.Data=xt.Data;else throw new TypeError("Invalid DAG-PB form");if(xt.Links!==void 0)if(Array.isArray(xt.Links))e.Links=xt.Links.map(asLink),e.Links.sort(linkComparator);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function validate$1(xt){if(!xt||typeof xt!="object"||Array.isArray(xt)||xt instanceof Uint8Array||xt["/"]&&xt["/"]===xt.bytes)throw new TypeError("Invalid DAG-PB form");if(!hasOnlyProperties(xt,pbNodeProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(xt.Data!==void 0&&!(xt.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(xt.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<xt.Links.length;e++){const At=xt.Links[e];if(!At||typeof At!="object"||Array.isArray(At)||At instanceof Uint8Array||At["/"]&&At["/"]===At.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!hasOnlyProperties(At,pbLinkProperties))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(At.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(At.Hash==null||!At.Hash["/"]||At.Hash["/"]!==At.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(At.Name!==void 0&&typeof At.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(At.Tsize!==void 0){if(typeof At.Tsize!="number"||At.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(At.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&linkComparator(At,xt.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function createNode(xt,e=[]){return prepare({Data:xt,Links:e})}function createLink(xt,e,At){return asLink({Hash:At,Name:xt,Tsize:e})}function toByteView(xt){return xt instanceof ArrayBuffer?new Uint8Array(xt,0,xt.byteLength):xt}const name$4="dag-pb",code$4=112;function encode$a(xt){validate$1(xt);const e={};return xt.Links&&(e.Links=xt.Links.map(At=>{const kt={};return At.Hash&&(kt.Hash=At.Hash.bytes),At.Name!==void 0&&(kt.Name=At.Name),At.Tsize!==void 0&&(kt.Tsize=At.Tsize),kt})),xt.Data&&(e.Data=xt.Data),encodeNode(e)}function decode$a(xt){const e=toByteView(xt),At=decodeNode(e),kt={};return At.Data&&(kt.Data=At.Data),At.Links&&(kt.Links=At.Links.map(Bt=>{const Nt={};try{Nt.Hash=CID$2.decode(Bt.Hash)}catch{}if(!Nt.Hash)throw new Error("Invalid Hash field found in link, expected CID");return Bt.Name!==void 0&&(Nt.Name=Bt.Name),Bt.Tsize!==void 0&&(Nt.Tsize=Bt.Tsize),Nt})),kt}const dagPb=Object.freeze(Object.defineProperty({__proto__:null,code:code$4,createLink,createNode,decode:decode$a,encode:encode$a,name:name$4,prepare,validate:validate$1},Symbol.toStringTag,{value:"Module"})),N1$1=Math.pow(2,7),N2$1=Math.pow(2,14),N3$1=Math.pow(2,21),N4$1=Math.pow(2,28),N5$1=Math.pow(2,35),N6$1=Math.pow(2,42),N7$1=Math.pow(2,49),MSB$2=128,REST$2=127;function encodingLength$5(xt){if(xt<N1$1)return 1;if(xt<N2$1)return 2;if(xt<N3$1)return 3;if(xt<N4$1)return 4;if(xt<N5$1)return 5;if(xt<N6$1)return 6;if(xt<N7$1)return 7;if(Number.MAX_SAFE_INTEGER!=null&&xt>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function encodeUint8Array(xt,e,At=0){switch(encodingLength$5(xt)){case 8:e[At++]=xt&255|MSB$2,xt/=128;case 7:e[At++]=xt&255|MSB$2,xt/=128;case 6:e[At++]=xt&255|MSB$2,xt/=128;case 5:e[At++]=xt&255|MSB$2,xt/=128;case 4:e[At++]=xt&255|MSB$2,xt>>>=7;case 3:e[At++]=xt&255|MSB$2,xt>>>=7;case 2:e[At++]=xt&255|MSB$2,xt>>>=7;case 1:{e[At++]=xt&255,xt>>>=7;break}default:throw new Error("unreachable")}return e}function decodeUint8Array(xt,e){let At=xt[e],kt=0;if(kt+=At&REST$2,At<MSB$2||(At=xt[e+1],kt+=(At&REST$2)<<7,At<MSB$2)||(At=xt[e+2],kt+=(At&REST$2)<<14,At<MSB$2)||(At=xt[e+3],kt+=(At&REST$2)<<21,At<MSB$2)||(At=xt[e+4],kt+=(At&REST$2)*N4$1,At<MSB$2)||(At=xt[e+5],kt+=(At&REST$2)*N5$1,At<MSB$2)||(At=xt[e+6],kt+=(At&REST$2)*N6$1,At<MSB$2)||(At=xt[e+7],kt+=(At&REST$2)*N7$1,At<MSB$2))return kt;throw new RangeError("Could not decode varint")}const f32=new Float32Array([-0]),f8b=new Uint8Array(f32.buffer);function writeFloatLE(xt,e,At){f32[0]=xt,e[At]=f8b[0],e[At+1]=f8b[1],e[At+2]=f8b[2],e[At+3]=f8b[3]}function readFloatLE(xt,e){return f8b[0]=xt[e],f8b[1]=xt[e+1],f8b[2]=xt[e+2],f8b[3]=xt[e+3],f32[0]}const f64=new Float64Array([-0]),d8b=new Uint8Array(f64.buffer);function writeDoubleLE(xt,e,At){f64[0]=xt,e[At]=d8b[0],e[At+1]=d8b[1],e[At+2]=d8b[2],e[At+3]=d8b[3],e[At+4]=d8b[4],e[At+5]=d8b[5],e[At+6]=d8b[6],e[At+7]=d8b[7]}function readDoubleLE(xt,e){return d8b[0]=xt[e],d8b[1]=xt[e+1],d8b[2]=xt[e+2],d8b[3]=xt[e+3],d8b[4]=xt[e+4],d8b[5]=xt[e+5],d8b[6]=xt[e+6],d8b[7]=xt[e+7],f64[0]}const MAX_SAFE_NUMBER_INTEGER=BigInt(Number.MAX_SAFE_INTEGER),MIN_SAFE_NUMBER_INTEGER=BigInt(Number.MIN_SAFE_INTEGER);class LongBits{constructor(e,At){wn(this,"lo");wn(this,"hi");this.lo=e|0,this.hi=At|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const At=~this.lo+1>>>0;let kt=~this.hi>>>0;return At===0&&(kt=kt+1>>>0),-(At+kt*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const At=~this.lo+1>>>0;let kt=~this.hi>>>0;return At===0&&(kt=kt+1>>>0),-(BigInt(At)+(BigInt(kt)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,At=(this.lo>>>28|this.hi<<4)>>>0,kt=this.hi>>>24;return kt===0?At===0?e<16384?e<128?1:2:e<2097152?3:4:At<16384?At<128?5:6:At<2097152?7:8:kt<128?9:10}static fromBigInt(e){if(e===0n)return zero;if(e<MAX_SAFE_NUMBER_INTEGER&&e>MIN_SAFE_NUMBER_INTEGER)return this.fromNumber(Number(e));const At=e<0n;At&&(e=-e);let kt=e>>32n,Bt=e-(kt<<32n);return At&&(kt=~kt|0n,Bt=~Bt|0n,++Bt>TWO_32&&(Bt=0n,++kt>TWO_32&&(kt=0n))),new LongBits(Number(Bt),Number(kt))}static fromNumber(e){if(e===0)return zero;const At=e<0;At&&(e=-e);let kt=e>>>0,Bt=(e-kt)/4294967296>>>0;return At&&(Bt=~Bt>>>0,kt=~kt>>>0,++kt>4294967295&&(kt=0,++Bt>4294967295&&(Bt=0))),new LongBits(kt,Bt)}static from(e){return typeof e=="number"?LongBits.fromNumber(e):typeof e=="bigint"?LongBits.fromBigInt(e):typeof e=="string"?LongBits.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new LongBits(e.low>>>0,e.high>>>0):zero}}const zero=new LongBits(0,0);zero.toBigInt=function(){return 0n};zero.zzEncode=zero.zzDecode=function(){return this};zero.length=function(){return 1};const TWO_32=4294967296n;function length$1(xt){let e=0,At=0;for(let kt=0;kt<xt.length;++kt)At=xt.charCodeAt(kt),At<128?e+=1:At<2048?e+=2:(At&64512)===55296&&(xt.charCodeAt(kt+1)&64512)===56320?(++kt,e+=4):e+=3;return e}function read$1(xt,e,At){if(At-e<1)return"";let Bt;const Nt=[];let jt=0,Lt;for(;e<At;)Lt=xt[e++],Lt<128?Nt[jt++]=Lt:Lt>191&&Lt<224?Nt[jt++]=(Lt&31)<<6|xt[e++]&63:Lt>239&&Lt<365?(Lt=((Lt&7)<<18|(xt[e++]&63)<<12|(xt[e++]&63)<<6|xt[e++]&63)-65536,Nt[jt++]=55296+(Lt>>10),Nt[jt++]=56320+(Lt&1023)):Nt[jt++]=(Lt&15)<<12|(xt[e++]&63)<<6|xt[e++]&63,jt>8191&&((Bt??(Bt=[])).push(String.fromCharCode.apply(String,Nt)),jt=0);return Bt!=null?(jt>0&&Bt.push(String.fromCharCode.apply(String,Nt.slice(0,jt))),Bt.join("")):String.fromCharCode.apply(String,Nt.slice(0,jt))}function write$1(xt,e,At){const kt=At;let Bt,Nt;for(let jt=0;jt<xt.length;++jt)Bt=xt.charCodeAt(jt),Bt<128?e[At++]=Bt:Bt<2048?(e[At++]=Bt>>6|192,e[At++]=Bt&63|128):(Bt&64512)===55296&&((Nt=xt.charCodeAt(jt+1))&64512)===56320?(Bt=65536+((Bt&1023)<<10)+(Nt&1023),++jt,e[At++]=Bt>>18|240,e[At++]=Bt>>12&63|128,e[At++]=Bt>>6&63|128,e[At++]=Bt&63|128):(e[At++]=Bt>>12|224,e[At++]=Bt>>6&63|128,e[At++]=Bt&63|128);return At-kt}function indexOutOfRange(xt,e){return RangeError(`index out of range: ${xt.pos} + ${e??1} > ${xt.len}`)}function readFixed32End(xt,e){return(xt[e-4]|xt[e-3]<<8|xt[e-2]<<16|xt[e-1]<<24)>>>0}class Uint8ArrayReader{constructor(e){wn(this,"buf");wn(this,"pos");wn(this,"len");wn(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32End(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);const e=readFloatLE(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);const e=readDoubleLE(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),At=this.pos,kt=this.pos+e;if(kt>this.len)throw indexOutOfRange(this,e);return this.pos+=e,At===kt?new Uint8Array(0):this.buf.subarray(At,kt)}string(){const e=this.bytes();return read$1(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new LongBits(0,0);let At=0;if(this.len-this.pos>4){for(;At<4;++At)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<At*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;At=0}else{for(;At<3;++At){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<At*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<At*7)>>>0,e}if(this.len-this.pos>4){for(;At<5;++At)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<At*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;At<5;++At){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<At*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);const e=readFixed32End(this.buf,this.pos+=4),At=readFixed32End(this.buf,this.pos+=4);return new LongBits(e,At)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=decodeUint8Array(this.buf,this.pos);return this.pos+=encodingLength$5(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function createReader(xt){return new Uint8ArrayReader(xt instanceof Uint8Array?xt:xt.subarray())}function decodeMessage(xt,e,At){const kt=createReader(xt);return e.decode(kt,void 0,At)}function pool(xt){let kt,Bt=8192;return function(jt){if(jt<1||jt>4096)return allocUnsafe$1(jt);Bt+jt>8192&&(kt=allocUnsafe$1(8192),Bt=0);const Lt=kt.subarray(Bt,Bt+=jt);return Bt&7&&(Bt=(Bt|7)+1),Lt}}class Op{constructor(e,At,kt){wn(this,"fn");wn(this,"len");wn(this,"next");wn(this,"val");this.fn=e,this.len=At,this.next=void 0,this.val=kt}}function noop$4(){}class State{constructor(e){wn(this,"head");wn(this,"tail");wn(this,"len");wn(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const bufferPool=pool();function alloc$1(xt){return globalThis.Buffer!=null?allocUnsafe$1(xt):bufferPool(xt)}class Uint8ArrayWriter{constructor(){wn(this,"len");wn(this,"head");wn(this,"tail");wn(this,"states");this.len=0,this.head=new Op(noop$4,0,0),this.tail=this.head,this.states=null}_push(e,At,kt){return this.tail=this.tail.next=new Op(e,At,kt),this.len+=At,this}uint32(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(writeVarint64,10,LongBits.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const At=LongBits.fromBigInt(e);return this._push(writeVarint64,At.length(),At)}uint64Number(e){return this._push(encodeUint8Array,encodingLength$5(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const At=LongBits.fromBigInt(e).zzEncode();return this._push(writeVarint64,At.length(),At)}sint64Number(e){const At=LongBits.fromNumber(e).zzEncode();return this._push(writeVarint64,At.length(),At)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(writeByte,1,e?1:0)}fixed32(e){return this._push(writeFixed32,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const At=LongBits.fromBigInt(e);return this._push(writeFixed32,4,At.lo)._push(writeFixed32,4,At.hi)}fixed64Number(e){const At=LongBits.fromNumber(e);return this._push(writeFixed32,4,At.lo)._push(writeFixed32,4,At.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(writeFloatLE,4,e)}double(e){return this._push(writeDoubleLE,8,e)}bytes(e){const At=e.length>>>0;return At===0?this._push(writeByte,1,0):this.uint32(At)._push(writeBytes,At,e)}string(e){const At=length$1(e);return At!==0?this.uint32(At)._push(write$1,At,e):this._push(writeByte,1,0)}fork(){return this.states=new State(this),this.head=this.tail=new Op(noop$4,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop$4,0,0),this.len=0),this}ldelim(){const e=this.head,At=this.tail,kt=this.len;return this.reset().uint32(kt),kt!==0&&(this.tail.next=e.next,this.tail=At,this.len+=kt),this}finish(){let e=this.head.next;const At=alloc$1(this.len);let kt=0;for(;e!=null;)e.fn(e.val,At,kt),kt+=e.len,e=e.next;return At}}function writeByte(xt,e,At){e[At]=xt&255}function writeVarint32(xt,e,At){for(;xt>127;)e[At++]=xt&127|128,xt>>>=7;e[At]=xt}class VarintOp extends Op{constructor(At,kt){super(writeVarint32,At,kt);wn(this,"next");this.next=void 0}}function writeVarint64(xt,e,At){for(;xt.hi!==0;)e[At++]=xt.lo&127|128,xt.lo=(xt.lo>>>7|xt.hi<<25)>>>0,xt.hi>>>=7;for(;xt.lo>127;)e[At++]=xt.lo&127|128,xt.lo=xt.lo>>>7;e[At++]=xt.lo}function writeFixed32(xt,e,At){e[At]=xt&255,e[At+1]=xt>>>8&255,e[At+2]=xt>>>16&255,e[At+3]=xt>>>24}function writeBytes(xt,e,At){e.set(xt,At)}globalThis.Buffer!=null&&(Uint8ArrayWriter.prototype.bytes=function(xt){const e=xt.length>>>0;return this.uint32(e),e>0&&this._push(writeBytesBuffer,e,xt),this},Uint8ArrayWriter.prototype.string=function(xt){const e=globalThis.Buffer.byteLength(xt);return this.uint32(e),e>0&&this._push(writeStringBuffer,e,xt),this});function writeBytesBuffer(xt,e,At){e.set(xt,At)}function writeStringBuffer(xt,e,At){xt.length<40?write$1(xt,e,At):e.utf8Write!=null?e.utf8Write(xt,At):e.set(fromString$3(xt),At)}function createWriter(){return new Uint8ArrayWriter}function encodeMessage(xt,e){const At=createWriter();return e.encode(xt,At,{lengthDelimited:!1}),At.finish()}var CODEC_TYPES;(function(xt){xt[xt.VARINT=0]="VARINT",xt[xt.BIT64=1]="BIT64",xt[xt.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",xt[xt.START_GROUP=3]="START_GROUP",xt[xt.END_GROUP=4]="END_GROUP",xt[xt.BIT32=5]="BIT32"})(CODEC_TYPES||(CODEC_TYPES={}));function createCodec$1(xt,e,At,kt){return{name:xt,type:e,encode:At,decode:kt}}function enumeration(xt){function e(Bt){if(xt[Bt.toString()]==null)throw new Error("Invalid enum value");return xt[Bt]}const At=function(Nt,jt){const Lt=e(Nt);jt.int32(Lt)},kt=function(Nt){const jt=Nt.int32();return e(jt)};return createCodec$1("enum",CODEC_TYPES.VARINT,At,kt)}function message(xt,e){return createCodec$1("message",CODEC_TYPES.LENGTH_DELIMITED,xt,e)}var Data;(function(xt){(function(kt){kt.Raw="Raw",kt.Directory="Directory",kt.File="File",kt.Metadata="Metadata",kt.Symlink="Symlink",kt.HAMTShard="HAMTShard"})(xt.DataType||(xt.DataType={}));let e;(function(kt){kt[kt.Raw=0]="Raw",kt[kt.Directory=1]="Directory",kt[kt.File=2]="File",kt[kt.Metadata=3]="Metadata",kt[kt.Symlink=4]="Symlink",kt[kt.HAMTShard=5]="HAMTShard"})(e||(e={})),function(kt){kt.codec=()=>enumeration(e)}(xt.DataType||(xt.DataType={}));let At;xt.codec=()=>(At==null&&(At=message((kt,Bt,Nt={})=>{if(Nt.lengthDelimited!==!1&&Bt.fork(),kt.Type!=null&&(Bt.uint32(8),xt.DataType.codec().encode(kt.Type,Bt)),kt.Data!=null&&(Bt.uint32(18),Bt.bytes(kt.Data)),kt.filesize!=null&&(Bt.uint32(24),Bt.uint64(kt.filesize)),kt.blocksizes!=null)for(const jt of kt.blocksizes)Bt.uint32(32),Bt.uint64(jt);kt.hashType!=null&&(Bt.uint32(40),Bt.uint64(kt.hashType)),kt.fanout!=null&&(Bt.uint32(48),Bt.uint64(kt.fanout)),kt.mode!=null&&(Bt.uint32(56),Bt.uint32(kt.mode)),kt.mtime!=null&&(Bt.uint32(66),UnixTime.codec().encode(kt.mtime,Bt)),Nt.lengthDelimited!==!1&&Bt.ldelim()},(kt,Bt)=>{const Nt={blocksizes:[]},jt=Bt==null?kt.len:kt.pos+Bt;for(;kt.pos<jt;){const Lt=kt.uint32();switch(Lt>>>3){case 1:Nt.Type=xt.DataType.codec().decode(kt);break;case 2:Nt.Data=kt.bytes();break;case 3:Nt.filesize=kt.uint64();break;case 4:Nt.blocksizes.push(kt.uint64());break;case 5:Nt.hashType=kt.uint64();break;case 6:Nt.fanout=kt.uint64();break;case 7:Nt.mode=kt.uint32();break;case 8:Nt.mtime=UnixTime.codec().decode(kt,kt.uint32());break;default:kt.skipType(Lt&7);break}}return Nt})),At),xt.encode=kt=>encodeMessage(kt,xt.codec()),xt.decode=kt=>decodeMessage(kt,xt.codec())})(Data||(Data={}));var UnixTime;(function(xt){let e;xt.codec=()=>(e==null&&(e=message((At,kt,Bt={})=>{Bt.lengthDelimited!==!1&&kt.fork(),At.Seconds!=null&&(kt.uint32(8),kt.int64(At.Seconds)),At.FractionalNanoseconds!=null&&(kt.uint32(21),kt.fixed32(At.FractionalNanoseconds)),Bt.lengthDelimited!==!1&&kt.ldelim()},(At,kt)=>{const Bt={},Nt=kt==null?At.len:At.pos+kt;for(;At.pos<Nt;){const jt=At.uint32();switch(jt>>>3){case 1:Bt.Seconds=At.int64();break;case 2:Bt.FractionalNanoseconds=At.fixed32();break;default:At.skipType(jt&7);break}}return Bt})),e),xt.encode=At=>encodeMessage(At,xt.codec()),xt.decode=At=>decodeMessage(At,xt.codec())})(UnixTime||(UnixTime={}));var Metadata;(function(xt){let e;xt.codec=()=>(e==null&&(e=message((At,kt,Bt={})=>{Bt.lengthDelimited!==!1&&kt.fork(),At.MimeType!=null&&(kt.uint32(10),kt.string(At.MimeType)),Bt.lengthDelimited!==!1&&kt.ldelim()},(At,kt)=>{const Bt={},Nt=kt==null?At.len:At.pos+kt;for(;At.pos<Nt;){const jt=At.uint32();switch(jt>>>3){case 1:Bt.MimeType=At.string();break;default:At.skipType(jt&7);break}}return Bt})),e),xt.encode=At=>encodeMessage(At,xt.codec()),xt.decode=At=>decodeMessage(At,xt.codec())})(Metadata||(Metadata={}));const types$2={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},dirTypes=["directory","hamt-sharded-directory"],DEFAULT_FILE_MODE=parseInt("0644",8),DEFAULT_DIRECTORY_MODE=parseInt("0755",8);class UnixFS{constructor(e={type:"file"}){wn(this,"type");wn(this,"data");wn(this,"blockSizes");wn(this,"hashType");wn(this,"fanout");wn(this,"mtime");wn(this,"_mode");wn(this,"_originalMode");const{type:At,data:kt,blockSizes:Bt,hashType:Nt,fanout:jt,mtime:Lt,mode:er}=e;if(At!=null&&!Object.values(types$2).includes(At))throw errCode$1(new Error("Type: "+At+" is not valid"),"ERR_INVALID_TYPE");this.type=At??"file",this.data=kt,this.hashType=Nt,this.fanout=jt,this.blockSizes=Bt??[],this._originalMode=0,this.mode=er,this.mtime=Lt}static unmarshal(e){const At=Data.decode(e),kt=new UnixFS({type:types$2[At.Type!=null?At.Type.toString():"File"],data:At.Data,blockSizes:At.blocksizes,mode:At.mode,mtime:At.mtime!=null?{secs:At.mtime.Seconds??0n,nsecs:At.mtime.FractionalNanoseconds}:void 0,fanout:At.fanout});return kt._originalMode=At.mode??0,kt}set mode(e){e==null?this._mode=this.isDirectory()?DEFAULT_DIRECTORY_MODE:DEFAULT_FILE_MODE:this._mode=e&4095}get mode(){return this._mode}isDirectory(){return dirTypes.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach(At=>{e+=At}),this.data!=null&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=Data.DataType.Raw;break;case"directory":e=Data.DataType.Directory;break;case"file":e=Data.DataType.File;break;case"metadata":e=Data.DataType.Metadata;break;case"symlink":e=Data.DataType.Symlink;break;case"hamt-sharded-directory":e=Data.DataType.HAMTShard;break;default:throw errCode$1(new Error(`Type: ${e} is not valid`),"ERR_INVALID_TYPE")}let At=this.data;(this.data==null||this.data.length===0)&&(At=void 0);let kt;this.mode!=null&&(kt=this._originalMode&4294963200|(this.mode??0),kt===DEFAULT_FILE_MODE&&!this.isDirectory()&&(kt=void 0),kt===DEFAULT_DIRECTORY_MODE&&this.isDirectory()&&(kt=void 0));let Bt;return this.mtime!=null&&(Bt={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),Data.encode({Type:e,Data:At,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:kt,mtime:Bt})}}const name$3="raw",code$3=85,encode$9=xt=>coerce$3(xt),decode$9=xt=>coerce$3(xt),raw=Object.freeze(Object.defineProperty({__proto__:null,code:code$3,decode:decode$9,encode:encode$9,name:name$3},Symbol.toStringTag,{value:"Module"}));class CustomProgressEvent extends Event{constructor(At,kt){super(At);wn(this,"type");wn(this,"detail");this.type=At,this.detail=kt}}const persist=async(xt,e,At)=>{At.codec==null&&(At.codec=dagPb);const kt=await sha256$7.digest(xt),Bt=CID.create(At.cidVersion,At.codec.code,kt);return await e.put(Bt,xt,At),Bt};function defaultBufferImporter(xt){return async function*(At,kt){let Bt=0n;for await(let Nt of At.content)yield async()=>{var tr;let jt;const Lt={codec:dagPb,cidVersion:xt.cidVersion,onProgress:xt.onProgress};xt.rawLeaves?(Lt.codec=raw,Lt.cidVersion=1):(jt=new UnixFS({type:xt.leafType,data:Nt}),Nt=encode$a({Data:jt.marshal(),Links:[]}));const er=await persist(Nt,kt,Lt);return Bt+=BigInt(Nt.byteLength),(tr=xt.onProgress)==null||tr.call(xt,new CustomProgressEvent("unixfs:importer:progress:file:write",{bytesWritten:Bt,cid:er,path:At.path})),{cid:er,unixfs:jt,size:BigInt(Nt.length),block:Nt}}}}const dirBuilder=async(xt,e,At)=>{const kt=new UnixFS({type:"directory",mtime:xt.mtime,mode:xt.mode}),Bt=encode$a(prepare({Data:kt.marshal()})),Nt=await persist(Bt,e,At),jt=xt.path;return{cid:Nt,path:jt,unixfs:kt,size:BigInt(Bt.length),originalPath:xt.originalPath,block:Bt}};async function*buildFileBatch(xt,e,At){let kt=-1,Bt;for await(const Nt of parallelBatch(At.bufferImporter(xt,e),At.blockWriteConcurrency)){if(kt++,kt===0){Bt={...Nt,single:!0};continue}else kt===1&&Bt!=null&&(yield{...Bt,block:void 0,single:void 0},Bt=void 0);yield{...Nt,block:void 0}}Bt!=null&&(yield Bt)}function isSingleBlockImport(xt){return xt.single===!0}const reduce$2=(xt,e,At)=>async function(Bt){var zt,rr;if(Bt.length===1&&isSingleBlockImport(Bt[0])&&At.reduceSingleLeafToSelf){const nr=Bt[0];let ir=nr.block;return isSingleBlockImport(nr)&&(xt.mtime!==void 0||xt.mode!==void 0)&&(nr.unixfs=new UnixFS({type:"file",mtime:xt.mtime,mode:xt.mode,data:nr.block}),ir={Data:nr.unixfs.marshal(),Links:[]},nr.block=encode$a(prepare(ir)),nr.cid=await persist(nr.block,e,{...At,cidVersion:At.cidVersion}),nr.size=BigInt(nr.block.length)),(zt=At.onProgress)==null||zt.call(At,new CustomProgressEvent("unixfs:importer:progress:file:layout",{cid:nr.cid,path:nr.originalPath})),{cid:nr.cid,path:xt.path,unixfs:nr.unixfs,size:nr.size,originalPath:nr.originalPath}}const Nt=new UnixFS({type:"file",mtime:xt.mtime,mode:xt.mode}),jt=Bt.filter(nr=>{var ir,ar;return nr.cid.code===code$3&&nr.size>0||nr.unixfs!=null&&nr.unixfs.data==null&&nr.unixfs.fileSize()>0n?!0:!!((ar=(ir=nr.unixfs)==null?void 0:ir.data)!=null&&ar.length)}).map(nr=>{var ir;return nr.cid.code===code$3?(Nt.addBlockSize(nr.size),{Name:"",Tsize:Number(nr.size),Hash:nr.cid}):(nr.unixfs==null||nr.unixfs.data==null?Nt.addBlockSize(((ir=nr.unixfs)==null?void 0:ir.fileSize())??0n):Nt.addBlockSize(BigInt(nr.unixfs.data.length)),{Name:"",Tsize:Number(nr.size),Hash:nr.cid})}),Lt={Data:Nt.marshal(),Links:jt},er=encode$a(prepare(Lt)),tr=await persist(er,e,At);return(rr=At.onProgress)==null||rr.call(At,new CustomProgressEvent("unixfs:importer:progress:file:layout",{cid:tr,path:xt.originalPath})),{cid:tr,path:xt.path,unixfs:Nt,size:BigInt(er.length+Lt.Links.reduce((nr,ir)=>nr+(ir.Tsize??0),0)),originalPath:xt.originalPath,block:er}},fileBuilder=async(xt,e,At)=>At.layout(buildFileBatch(xt,e,At),reduce$2(xt,e,At));function isIterable$5(xt){return Symbol.iterator in xt}function isAsyncIterable$8(xt){return Symbol.asyncIterator in xt}function contentAsAsyncIterable(xt){try{if(xt instanceof Uint8Array)return async function*(){yield xt}();if(isIterable$5(xt))return async function*(){yield*xt}();if(isAsyncIterable$8(xt))return xt}catch{throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}function defaultDagBuilder(xt){return async function*(At,kt){for await(const Bt of At){let Nt;if(Bt.path!=null&&(Nt=Bt.path,Bt.path=Bt.path.split("/").filter(jt=>jt!=null&&jt!==".").join("/")),isFileCandidate(Bt)){const jt={path:Bt.path,mtime:Bt.mtime,mode:Bt.mode,content:async function*(){var er;let Lt=0n;for await(const tr of xt.chunker(xt.chunkValidator(contentAsAsyncIterable(Bt.content)))){const zt=BigInt(tr.byteLength);Lt+=zt,(er=xt.onProgress)==null||er.call(xt,new CustomProgressEvent("unixfs:importer:progress:file:read",{bytesRead:Lt,chunkSize:zt,path:Bt.path})),yield tr}}(),originalPath:Nt};yield async()=>fileBuilder(jt,kt,xt)}else if(Bt.path!=null){const jt={path:Bt.path,mtime:Bt.mtime,mode:Bt.mode,originalPath:Nt};yield async()=>dirBuilder(jt,kt,xt)}else throw new Error("Import candidate must have content or path or both")}}}function isFileCandidate(xt){return xt.content!=null}function asUint8Array(xt){return globalThis.Buffer!=null?new Uint8Array(xt.buffer,xt.byteOffset,xt.byteLength):xt}const base10=baseX$1({prefix:"9",name:"base10",alphabet:"0123456789"}),base10$1=Object.freeze(Object.defineProperty({__proto__:null,base10},Symbol.toStringTag,{value:"Module"})),base16=rfc4648$1({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper=rfc4648$1({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),base16$1=Object.freeze(Object.defineProperty({__proto__:null,base16,base16upper},Symbol.toStringTag,{value:"Module"})),base2=rfc4648$1({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),base2$1=Object.freeze(Object.defineProperty({__proto__:null,base2},Symbol.toStringTag,{value:"Module"})),alphabet$2=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),alphabetBytesToChars=alphabet$2.reduce((xt,e,At)=>(xt[At]=e,xt),[]),alphabetCharsToBytes=alphabet$2.reduce((xt,e,At)=>(xt[e.codePointAt(0)]=At,xt),[]);function encode$8(xt){return xt.reduce((e,At)=>(e+=alphabetBytesToChars[At],e),"")}function decode$8(xt){const e=[];for(const At of xt){const kt=alphabetCharsToBytes[At.codePointAt(0)];if(kt===void 0)throw new Error(`Non-base256emoji character: ${At}`);e.push(kt)}return new Uint8Array(e)}const base256emoji=from$6({prefix:"🚀",name:"base256emoji",encode:encode$8,decode:decode$8}),base256emoji$1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji},Symbol.toStringTag,{value:"Module"})),base36=baseX$1({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper=baseX$1({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),base36$1=Object.freeze(Object.defineProperty({__proto__:null,base36,base36upper},Symbol.toStringTag,{value:"Module"})),base64=rfc4648$1({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad=rfc4648$1({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url$1=rfc4648$1({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad=rfc4648$1({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),base64$1=Object.freeze(Object.defineProperty({__proto__:null,base64,base64pad,base64url:base64url$1,base64urlpad},Symbol.toStringTag,{value:"Module"})),base8=rfc4648$1({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),base8$1=Object.freeze(Object.defineProperty({__proto__:null,base8},Symbol.toStringTag,{value:"Module"})),identity$2=from$6({prefix:"\0",name:"identity",encode:xt=>toString$6(xt),decode:xt=>fromString$1(xt)}),identityBase=Object.freeze(Object.defineProperty({__proto__:null,identity:identity$2},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const from$5=({name:xt,code:e,encode:At})=>new Hasher(xt,e,At);class Hasher{constructor(e,At,kt){this.name=e,this.code=At,this.encode=kt}digest(e){if(e instanceof Uint8Array){const At=this.encode(e);return At instanceof Uint8Array?create(this.code,At):At.then(kt=>create(this.code,kt))}else throw Error("Unknown type, must be binary type")}}const sha$5=xt=>async e=>new Uint8Array(await crypto.subtle.digest(xt,e)),sha256$4=from$5({name:"sha2-256",code:18,encode:sha$5("SHA-256")}),bases={...identityBase,...base2$1,...base8$1,...base10$1,...base16$1,...base32$2,...base36$1,...base58,...base64$1,...base256emoji$1};function allocUnsafe(xt=0){var e;return((e=globalThis.Buffer)==null?void 0:e.allocUnsafe)!=null?asUint8Array(globalThis.Buffer.allocUnsafe(xt)):new Uint8Array(xt)}function createCodec(xt,e,At,kt){return{name:xt,prefix:e,encoder:{name:xt,prefix:e,encode:At},decoder:{decode:kt}}}const string$1=createCodec("utf8","u",xt=>"u"+new TextDecoder("utf8").decode(xt),xt=>new TextEncoder().encode(xt.substring(1))),ascii=createCodec("ascii","a",xt=>{let e="a";for(let At=0;At<xt.length;At++)e+=String.fromCharCode(xt[At]);return e},xt=>{xt=xt.substring(1);const e=allocUnsafe(xt.length);for(let At=0;At<xt.length;At++)e[At]=xt.charCodeAt(At);return e}),BASES={utf8:string$1,"utf-8":string$1,hex:bases.base16,latin1:ascii,ascii,binary:ascii,...bases};function fromString(xt,e="utf8"){const At=BASES[e];if(At==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?asUint8Array(globalThis.Buffer.from(xt,"utf-8")):At.decoder.decode(`${At.prefix}${xt}`)}const defaultChunkValidator=()=>async function*(e){for await(const At of e){if(At.length===void 0)throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if(typeof At=="string"||At instanceof String)yield fromString(At.toString());else if(Array.isArray(At))yield Uint8Array.from(At);else if(At instanceof Uint8Array)yield At;else throw errCode$1(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}},DEFAULT_MAX_CHILDREN_PER_NODE=174;function balanced(xt){const e=DEFAULT_MAX_CHILDREN_PER_NODE;return async function At(kt,Bt){const Nt=[];for await(const jt of batch(kt,e))Nt.push(await Bt(jt));return Nt.length>1?At(Nt,Bt):Nt[0]}}class Dir{constructor(e,At){wn(this,"options");wn(this,"root");wn(this,"dir");wn(this,"path");wn(this,"dirty");wn(this,"flat");wn(this,"parent");wn(this,"parentKey");wn(this,"unixfs");wn(this,"mode");wn(this,"mtime");wn(this,"cid");wn(this,"size");wn(this,"nodeSize");this.options=At??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}const CID_V0=CID.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),CID_V1=CID.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class DirFlat extends Dir{constructor(At,kt){super(At,kt);wn(this,"_children");this._children=new Map}async put(At,kt){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(At,kt)}async get(At){return Promise.resolve(this._children.get(At))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async*eachChildSeries(){for(const[At,kt]of this._children.entries())yield{key:At,child:kt}}estimateNodeSize(){if(this.nodeSize!==void 0)return this.nodeSize;this.nodeSize=0;for(const[At,kt]of this._children.entries())kt.size!=null&&kt.cid!=null&&(this.nodeSize+=At.length+(this.options.cidVersion===1?CID_V1.bytes.byteLength:CID_V0.bytes.byteLength));return this.nodeSize}async*flush(At){const kt=[];for(const[tr,zt]of this._children.entries()){let rr=zt;if(zt instanceof Dir)for await(const nr of zt.flush(At))rr=nr,yield nr;rr.size!=null&&rr.cid!=null&&kt.push({Name:tr,Tsize:Number(rr.size),Hash:rr.cid})}const Bt=new UnixFS({type:"directory",mtime:this.mtime,mode:this.mode}),Nt={Data:Bt.marshal(),Links:kt},jt=encode$a(prepare(Nt)),Lt=await persist(jt,At,this.options),er=jt.length+Nt.Links.reduce((tr,zt)=>tr+(zt.Tsize==null?0:zt.Tsize),0);this.cid=Lt,this.size=er,yield{cid:Lt,unixfs:Bt,path:this.path,size:BigInt(er)}}}var murmurHash3js={exports:{}};(function(xt,e){(function(At,kt){var Bt={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function Nt(dr){if(!Array.isArray(dr)&&!ArrayBuffer.isView(dr))return!1;for(var ur=0;ur<dr.length;ur++)if(!Number.isInteger(dr[ur])||dr[ur]<0||dr[ur]>255)return!1;return!0}function jt(dr,ur){return(dr&65535)*ur+(((dr>>>16)*ur&65535)<<16)}function Lt(dr,ur){return dr<<ur|dr>>>32-ur}function er(dr){return dr^=dr>>>16,dr=jt(dr,2246822507),dr^=dr>>>13,dr=jt(dr,3266489909),dr^=dr>>>16,dr}function tr(dr,ur){dr=[dr[0]>>>16,dr[0]&65535,dr[1]>>>16,dr[1]&65535],ur=[ur[0]>>>16,ur[0]&65535,ur[1]>>>16,ur[1]&65535];var fr=[0,0,0,0];return fr[3]+=dr[3]+ur[3],fr[2]+=fr[3]>>>16,fr[3]&=65535,fr[2]+=dr[2]+ur[2],fr[1]+=fr[2]>>>16,fr[2]&=65535,fr[1]+=dr[1]+ur[1],fr[0]+=fr[1]>>>16,fr[1]&=65535,fr[0]+=dr[0]+ur[0],fr[0]&=65535,[fr[0]<<16|fr[1],fr[2]<<16|fr[3]]}function zt(dr,ur){dr=[dr[0]>>>16,dr[0]&65535,dr[1]>>>16,dr[1]&65535],ur=[ur[0]>>>16,ur[0]&65535,ur[1]>>>16,ur[1]&65535];var fr=[0,0,0,0];return fr[3]+=dr[3]*ur[3],fr[2]+=fr[3]>>>16,fr[3]&=65535,fr[2]+=dr[2]*ur[3],fr[1]+=fr[2]>>>16,fr[2]&=65535,fr[2]+=dr[3]*ur[2],fr[1]+=fr[2]>>>16,fr[2]&=65535,fr[1]+=dr[1]*ur[3],fr[0]+=fr[1]>>>16,fr[1]&=65535,fr[1]+=dr[2]*ur[2],fr[0]+=fr[1]>>>16,fr[1]&=65535,fr[1]+=dr[3]*ur[1],fr[0]+=fr[1]>>>16,fr[1]&=65535,fr[0]+=dr[0]*ur[3]+dr[1]*ur[2]+dr[2]*ur[1]+dr[3]*ur[0],fr[0]&=65535,[fr[0]<<16|fr[1],fr[2]<<16|fr[3]]}function rr(dr,ur){return ur%=64,ur===32?[dr[1],dr[0]]:ur<32?[dr[0]<<ur|dr[1]>>>32-ur,dr[1]<<ur|dr[0]>>>32-ur]:(ur-=32,[dr[1]<<ur|dr[0]>>>32-ur,dr[0]<<ur|dr[1]>>>32-ur])}function nr(dr,ur){return ur%=64,ur===0?dr:ur<32?[dr[0]<<ur|dr[1]>>>32-ur,dr[1]<<ur]:[dr[1]<<ur-32,0]}function ir(dr,ur){return[dr[0]^ur[0],dr[1]^ur[1]]}function ar(dr){return dr=ir(dr,[0,dr[0]>>>1]),dr=zt(dr,[4283543511,3981806797]),dr=ir(dr,[0,dr[0]>>>1]),dr=zt(dr,[3301882366,444984403]),dr=ir(dr,[0,dr[0]>>>1]),dr}Bt.x86.hash32=function(dr,ur){if(Bt.inputValidation&&!Nt(dr))return kt;ur=ur||0;for(var fr=dr.length%4,pr=dr.length-fr,lr=ur,yr=0,br=3432918353,Ar=461845907,Pr=0;Pr<pr;Pr=Pr+4)yr=dr[Pr]|dr[Pr+1]<<8|dr[Pr+2]<<16|dr[Pr+3]<<24,yr=jt(yr,br),yr=Lt(yr,15),yr=jt(yr,Ar),lr^=yr,lr=Lt(lr,13),lr=jt(lr,5)+3864292196;switch(yr=0,fr){case 3:yr^=dr[Pr+2]<<16;case 2:yr^=dr[Pr+1]<<8;case 1:yr^=dr[Pr],yr=jt(yr,br),yr=Lt(yr,15),yr=jt(yr,Ar),lr^=yr}return lr^=dr.length,lr=er(lr),lr>>>0},Bt.x86.hash128=function(dr,ur){if(Bt.inputValidation&&!Nt(dr))return kt;ur=ur||0;for(var fr=dr.length%16,pr=dr.length-fr,lr=ur,yr=ur,br=ur,Ar=ur,Pr=0,kr=0,Ur=0,Hr=0,Lr=597399067,Sr=2869860233,_r=951274213,gr=2716044179,wr=0;wr<pr;wr=wr+16)Pr=dr[wr]|dr[wr+1]<<8|dr[wr+2]<<16|dr[wr+3]<<24,kr=dr[wr+4]|dr[wr+5]<<8|dr[wr+6]<<16|dr[wr+7]<<24,Ur=dr[wr+8]|dr[wr+9]<<8|dr[wr+10]<<16|dr[wr+11]<<24,Hr=dr[wr+12]|dr[wr+13]<<8|dr[wr+14]<<16|dr[wr+15]<<24,Pr=jt(Pr,Lr),Pr=Lt(Pr,15),Pr=jt(Pr,Sr),lr^=Pr,lr=Lt(lr,19),lr+=yr,lr=jt(lr,5)+1444728091,kr=jt(kr,Sr),kr=Lt(kr,16),kr=jt(kr,_r),yr^=kr,yr=Lt(yr,17),yr+=br,yr=jt(yr,5)+197830471,Ur=jt(Ur,_r),Ur=Lt(Ur,17),Ur=jt(Ur,gr),br^=Ur,br=Lt(br,15),br+=Ar,br=jt(br,5)+2530024501,Hr=jt(Hr,gr),Hr=Lt(Hr,18),Hr=jt(Hr,Lr),Ar^=Hr,Ar=Lt(Ar,13),Ar+=lr,Ar=jt(Ar,5)+850148119;switch(Pr=0,kr=0,Ur=0,Hr=0,fr){case 15:Hr^=dr[wr+14]<<16;case 14:Hr^=dr[wr+13]<<8;case 13:Hr^=dr[wr+12],Hr=jt(Hr,gr),Hr=Lt(Hr,18),Hr=jt(Hr,Lr),Ar^=Hr;case 12:Ur^=dr[wr+11]<<24;case 11:Ur^=dr[wr+10]<<16;case 10:Ur^=dr[wr+9]<<8;case 9:Ur^=dr[wr+8],Ur=jt(Ur,_r),Ur=Lt(Ur,17),Ur=jt(Ur,gr),br^=Ur;case 8:kr^=dr[wr+7]<<24;case 7:kr^=dr[wr+6]<<16;case 6:kr^=dr[wr+5]<<8;case 5:kr^=dr[wr+4],kr=jt(kr,Sr),kr=Lt(kr,16),kr=jt(kr,_r),yr^=kr;case 4:Pr^=dr[wr+3]<<24;case 3:Pr^=dr[wr+2]<<16;case 2:Pr^=dr[wr+1]<<8;case 1:Pr^=dr[wr],Pr=jt(Pr,Lr),Pr=Lt(Pr,15),Pr=jt(Pr,Sr),lr^=Pr}return lr^=dr.length,yr^=dr.length,br^=dr.length,Ar^=dr.length,lr+=yr,lr+=br,lr+=Ar,yr+=lr,br+=lr,Ar+=lr,lr=er(lr),yr=er(yr),br=er(br),Ar=er(Ar),lr+=yr,lr+=br,lr+=Ar,yr+=lr,br+=lr,Ar+=lr,("00000000"+(lr>>>0).toString(16)).slice(-8)+("00000000"+(yr>>>0).toString(16)).slice(-8)+("00000000"+(br>>>0).toString(16)).slice(-8)+("00000000"+(Ar>>>0).toString(16)).slice(-8)},Bt.x64.hash128=function(dr,ur){if(Bt.inputValidation&&!Nt(dr))return kt;ur=ur||0;for(var fr=dr.length%16,pr=dr.length-fr,lr=[0,ur],yr=[0,ur],br=[0,0],Ar=[0,0],Pr=[2277735313,289559509],kr=[1291169091,658871167],Ur=0;Ur<pr;Ur=Ur+16)br=[dr[Ur+4]|dr[Ur+5]<<8|dr[Ur+6]<<16|dr[Ur+7]<<24,dr[Ur]|dr[Ur+1]<<8|dr[Ur+2]<<16|dr[Ur+3]<<24],Ar=[dr[Ur+12]|dr[Ur+13]<<8|dr[Ur+14]<<16|dr[Ur+15]<<24,dr[Ur+8]|dr[Ur+9]<<8|dr[Ur+10]<<16|dr[Ur+11]<<24],br=zt(br,Pr),br=rr(br,31),br=zt(br,kr),lr=ir(lr,br),lr=rr(lr,27),lr=tr(lr,yr),lr=tr(zt(lr,[0,5]),[0,1390208809]),Ar=zt(Ar,kr),Ar=rr(Ar,33),Ar=zt(Ar,Pr),yr=ir(yr,Ar),yr=rr(yr,31),yr=tr(yr,lr),yr=tr(zt(yr,[0,5]),[0,944331445]);switch(br=[0,0],Ar=[0,0],fr){case 15:Ar=ir(Ar,nr([0,dr[Ur+14]],48));case 14:Ar=ir(Ar,nr([0,dr[Ur+13]],40));case 13:Ar=ir(Ar,nr([0,dr[Ur+12]],32));case 12:Ar=ir(Ar,nr([0,dr[Ur+11]],24));case 11:Ar=ir(Ar,nr([0,dr[Ur+10]],16));case 10:Ar=ir(Ar,nr([0,dr[Ur+9]],8));case 9:Ar=ir(Ar,[0,dr[Ur+8]]),Ar=zt(Ar,kr),Ar=rr(Ar,33),Ar=zt(Ar,Pr),yr=ir(yr,Ar);case 8:br=ir(br,nr([0,dr[Ur+7]],56));case 7:br=ir(br,nr([0,dr[Ur+6]],48));case 6:br=ir(br,nr([0,dr[Ur+5]],40));case 5:br=ir(br,nr([0,dr[Ur+4]],32));case 4:br=ir(br,nr([0,dr[Ur+3]],24));case 3:br=ir(br,nr([0,dr[Ur+2]],16));case 2:br=ir(br,nr([0,dr[Ur+1]],8));case 1:br=ir(br,[0,dr[Ur]]),br=zt(br,Pr),br=rr(br,31),br=zt(br,kr),lr=ir(lr,br)}return lr=ir(lr,[0,dr.length]),yr=ir(yr,[0,dr.length]),lr=tr(lr,yr),yr=tr(yr,lr),lr=ar(lr),yr=ar(yr),lr=tr(lr,yr),yr=tr(yr,lr),("00000000"+(lr[0]>>>0).toString(16)).slice(-8)+("00000000"+(lr[1]>>>0).toString(16)).slice(-8)+("00000000"+(yr[0]>>>0).toString(16)).slice(-8)+("00000000"+(yr[1]>>>0).toString(16)).slice(-8)},xt.exports&&(e=xt.exports=Bt),e.murmurHash3=Bt})()})(murmurHash3js,murmurHash3js.exports);var murmurHash3jsExports=murmurHash3js.exports,murmurhash3jsRevisited=murmurHash3jsExports;const mur=getDefaultExportFromCjs(murmurhash3jsRevisited),murmur3128=from$7({name:"murmur3-128",code:34,encode:xt=>fromHex(mur.x64.hash128(xt))}),BITS_PER_BYTE=7;var sparseArray=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,At){let kt=this._internalPositionFor(e,!1);if(At===void 0)kt!==-1&&(this._unsetInternalPos(kt),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let Bt=!1;kt===-1?(kt=this._data.length,this._setBit(e),this._changedData=!0):Bt=!0,this._setInternalPos(kt,e,At,Bt),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();const At=this._internalPositionFor(e,!0);if(At!==-1)return this._data[At][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){const e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let At=0;for(;At<this.length;)e(this.get(At),At,this),At++}map(e){let At=0,kt=new Array(this.length);for(;At<this.length;)kt[At]=e(this.get(At),At,this),At++;return kt}reduce(e,At){let kt=0,Bt=At;for(;kt<this.length;){const Nt=this.get(kt);Bt=e(Bt,Nt,kt),kt++}return Bt}find(e){let At=0,kt,Bt;for(;At<this.length&&!kt;)Bt=this.get(At),kt=e(Bt),At++;return kt?Bt:void 0}_internalPositionFor(e,At){const kt=this._bytePosFor(e,At);if(kt>=this._bitArrays.length)return-1;const Bt=this._bitArrays[kt],Nt=e-kt*BITS_PER_BYTE;if(!((Bt&1<<Nt)>0))return-1;const Lt=this._bitArrays.slice(0,kt).reduce(popCountReduce,0),er=~(4294967295<<Nt+1),tr=popCount(Bt&er);return Lt+tr-1}_bytePosFor(e,At){const kt=Math.floor(e/BITS_PER_BYTE),Bt=kt+1;for(;!At&&this._bitArrays.length<Bt;)this._bitArrays.push(0);return kt}_setBit(e){const At=this._bytePosFor(e,!1);this._bitArrays[At]|=1<<e-At*BITS_PER_BYTE}_unsetBit(e){const At=this._bytePosFor(e,!1);this._bitArrays[At]&=~(1<<e-At*BITS_PER_BYTE)}_setInternalPos(e,At,kt,Bt){const Nt=this._data,jt=[At,kt];if(Bt)this._sortData(),Nt[e]=jt;else{if(Nt.length)if(Nt[Nt.length-1][0]>=At)Nt.push(jt);else if(Nt[0][0]<=At)Nt.unshift(jt);else{const Lt=Math.round(Nt.length/2);this._data=Nt.slice(0,Lt).concat(jt).concat(Nt.slice(Lt))}else this._data.push(jt);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(sortInternal),this._changedData=!1}bitField(){const e=[];let At=8,kt=0,Bt=0,Nt;const jt=this._bitArrays.slice();for(;jt.length||kt;){kt===0&&(Nt=jt.shift(),kt=7);const er=Math.min(kt,At),tr=~(255<<er),zt=Nt&tr;Bt|=zt<<8-At,Nt=Nt>>>er,kt-=er,At-=er,(!At||!kt&&!jt.length)&&(e.push(Bt),Bt=0,At=8)}for(var Lt=e.length-1;Lt>0&&e[Lt]===0;Lt--)e.pop();return e}compactArray(){return this._sortData(),this._data.map(valueOnly)}};function popCountReduce(xt,e){return xt+popCount(e)}function popCount(xt){let e=xt;return e=e-(e>>1&1431655765),e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>24}function sortInternal(xt,e){return xt[0]-e[0]}function valueOnly(xt){return xt[1]}const SparseArray=getDefaultExportFromCjs(sparseArray);class Bucket{constructor(e,At,kt=0){wn(this,"_options");wn(this,"_popCount");wn(this,"_parent");wn(this,"_posAtParent");wn(this,"_children");wn(this,"key");this._options=e,this._popCount=0,this._parent=At,this._posAtParent=kt,this._children=new SparseArray,this.key=null}async put(e,At){const kt=await this._findNewBucketAndPos(e);kt.bucket._putAt(kt,e,At)}async get(e){const At=await this._findChild(e);if(At!=null)return At.value}async del(e){const At=await this._findPlace(e),kt=At.bucket._at(At.pos);kt!=null&&kt.key===e&&At.bucket._delAt(At.pos)}leafCount(){return this._children.compactArray().reduce((At,kt)=>kt instanceof Bucket?At+kt.leafCount():At+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const At of e)At instanceof Bucket?yield*At.eachLeafSeries():yield At}serialize(e,At){const kt=[];return At(this._children.reduce((Bt,Nt,jt)=>(Nt!=null&&(Nt instanceof Bucket?Bt.push(Nt.serialize(e,At)):Bt.push(e(Nt,jt))),Bt),kt))}async asyncTransform(e,At){return asyncTransformBucket(this,e,At)}toJSON(){return this.serialize(mapNode,reduceNodes)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const At=await this._findPlace(e),kt=At.bucket._at(At.pos);if(!(kt instanceof Bucket)&&kt!=null&&kt.key===e)return kt}async _findPlace(e){const At=this._options.hash(typeof e=="string"?fromString$3(e):e),kt=await At.take(this._options.bits),Bt=this._children.get(kt);return Bt instanceof Bucket?Bt._findPlace(At):{bucket:this,pos:kt,hash:At,existingChild:Bt}}async _findNewBucketAndPos(e){const At=await this._findPlace(e);if(At.existingChild!=null&&At.existingChild.key!==e){const kt=new Bucket(this._options,At.bucket,At.pos);At.bucket._putObjectAt(At.pos,kt);const Bt=await kt._findPlace(At.existingChild.hash);return Bt.bucket._putAt(Bt,At.existingChild.key,At.existingChild.value),kt._findNewBucketAndPos(At.hash)}return At}_putAt(e,At,kt){this._putObjectAt(e.pos,{key:At,value:kt,hash:e.hash})}_putObjectAt(e,At){this._children.get(e)==null&&this._popCount++,this._children.set(e,At)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){const e=this._children.find(exists$5);if(e!=null&&!(e instanceof Bucket)){const At=e.hash;At.untake(this._options.bits);const kt={pos:this._posAtParent,hash:At,bucket:this._parent};this._parent._putAt(kt,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function exists$5(xt){return!!xt}function mapNode(xt,e){return xt.key}function reduceNodes(xt){return xt}async function asyncTransformBucket(xt,e,At){const kt=[];for(const Bt of xt._children.compactArray())if(Bt instanceof Bucket)await asyncTransformBucket(Bt,e,At);else{const Nt=await e(Bt);kt.push({bitField:xt._children.bitField(),children:Nt})}return At(kt)}const START_MASKS=[255,254,252,248,240,224,192,128],STOP_MASKS=[1,3,7,15,31,63,127,255];class ConsumableBuffer{constructor(e){wn(this,"_value");wn(this,"_currentBytePos");wn(this,"_currentBitPos");this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let At=e,kt=0;for(;At>0&&this._haveBits();){const Bt=this._value[this._currentBytePos],Nt=this._currentBitPos+1,jt=Math.min(Nt,At),Lt=byteBitsToInt(Bt,Nt-jt,jt);kt=(kt<<jt)+Lt,At-=jt,this._currentBitPos-=jt,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return kt}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function byteBitsToInt(xt,e,At){const kt=maskFor(e,At);return(xt&kt)>>>e}function maskFor(xt,e){return START_MASKS[xt]&STOP_MASKS[Math.min(e+xt-1,7)]}function wrapHash(xt){function e(At){return At instanceof InfiniteHash?At:new InfiniteHash(At,xt)}return e}class InfiniteHash{constructor(e,At){wn(this,"_value");wn(this,"_hashFn");wn(this,"_depth");wn(this,"_availableBits");wn(this,"_currentBufferIndex");wn(this,"_buffers");if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=At,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let At=e;for(;this._availableBits<At;)await this._produceMoreBits();let kt=0;for(;At>0;){const Bt=this._buffers[this._currentBufferIndex],Nt=Math.min(Bt.availableBits(),At),jt=Bt.take(Nt);kt=(kt<<Nt)+jt,At-=Nt,this._availableBits-=Nt,Bt.availableBits()===0&&this._currentBufferIndex++}return kt}untake(e){let At=e;for(;At>0;){const kt=this._buffers[this._currentBufferIndex],Bt=Math.min(kt.totalBits()-kt.availableBits(),At);kt.untake(Bt),At-=Bt,this._availableBits+=Bt,this._currentBufferIndex>0&&kt.totalBits()===kt.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?concat$2([this._value,Uint8Array.from([this._depth])]):this._value,At=await this._hashFn(e),kt=new ConsumableBuffer(At);this._buffers.push(kt),this._availableBits+=kt.availableBits()}}function createHAMT(xt){if(xt==null||xt.hashFn==null)throw new Error("please define an options.hashFn");const e={bits:xt.bits??8,hash:wrapHash(xt.hashFn)};return new Bucket(e)}async function hamtHashFn(xt){return(await murmur3128.encode(xt)).slice(0,8).reverse()}const HAMT_HASH_CODE=BigInt(34);class DirSharded extends Dir{constructor(At,kt){super(At,kt);wn(this,"_bucket");this._bucket=createHAMT({hashFn:hamtHashFn,bits:8})}async put(At,kt){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(At,kt)}async get(At){return this._bucket.get(At)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:At,value:kt}of this._bucket.eachLeafSeries())yield{key:At,child:kt}}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=calculateSize(this._bucket,this,this.options),this.nodeSize)}async*flush(At){for await(const kt of flush(this._bucket,At,this,this.options))yield{...kt,path:this.path}}}async function*flush(xt,e,At,kt){const Bt=xt._children,Nt=[];let jt=0n;for(let ir=0;ir<Bt.length;ir++){const ar=Bt.get(ir);if(ar==null)continue;const dr=ir.toString(16).toUpperCase().padStart(2,"0");if(ar instanceof Bucket){let ur;for await(const fr of flush(ar,e,null,kt))ur=fr;if(ur==null)throw new Error("Could not flush sharded directory, no subshard found");Nt.push({Name:dr,Tsize:Number(ur.size),Hash:ur.cid}),jt+=ur.size}else if(isDir(ar.value)){const ur=ar.value;let fr;for await(const lr of ur.flush(e))fr=lr,yield fr;if(fr==null)throw new Error("Did not flush dir");const pr=dr+ar.key;Nt.push({Name:pr,Tsize:Number(fr.size),Hash:fr.cid}),jt+=fr.size}else{const ur=ar.value;if(ur.cid==null)continue;const fr=dr+ar.key,pr=ur.size;Nt.push({Name:fr,Tsize:Number(pr),Hash:ur.cid}),jt+=BigInt(pr??0)}}const Lt=Uint8Array.from(Bt.bitField().reverse()),er=new UnixFS({type:"hamt-sharded-directory",data:Lt,fanout:BigInt(xt.tableSize()),hashType:HAMT_HASH_CODE,mtime:At==null?void 0:At.mtime,mode:At==null?void 0:At.mode}),tr={Data:er.marshal(),Links:Nt},zt=encode$a(prepare(tr)),rr=await persist(zt,e,kt),nr=BigInt(zt.byteLength)+jt;yield{cid:rr,unixfs:er,size:nr}}function isDir(xt){return typeof xt.flush=="function"}function calculateSize(xt,e,At){const kt=xt._children,Bt=[];for(let er=0;er<kt.length;er++){const tr=kt.get(er);if(tr==null)continue;const zt=er.toString(16).toUpperCase().padStart(2,"0");if(tr instanceof Bucket){const rr=calculateSize(tr,null,At);Bt.push({Name:zt,Tsize:Number(rr),Hash:At.cidVersion===0?CID_V0:CID_V1})}else if(typeof tr.value.flush=="function"){const nr=tr.value.nodeSize();Bt.push({Name:zt+tr.key,Tsize:Number(nr),Hash:At.cidVersion===0?CID_V0:CID_V1})}else{const rr=tr.value;if(rr.cid==null)continue;const nr=zt+tr.key,ir=rr.size;Bt.push({Name:nr,Tsize:Number(ir),Hash:rr.cid})}}const Nt=Uint8Array.from(kt.bitField().reverse()),jt=new UnixFS({type:"hamt-sharded-directory",data:Nt,fanout:BigInt(xt.tableSize()),hashType:HAMT_HASH_CODE,mtime:e==null?void 0:e.mtime,mode:e==null?void 0:e.mode});return encode$a(prepare({Data:jt.marshal(),Links:Bt})).length}async function flatToShard(xt,e,At,kt){let Bt=e;e instanceof DirFlat&&e.estimateNodeSize()>At&&(Bt=await convertToShard(e,kt));const Nt=Bt.parent;if(Nt!=null){if(Bt!==e){if(xt!=null&&(xt.parent=Bt),Bt.parentKey==null)throw new Error("No parent key found");await Nt.put(Bt.parentKey,Bt)}return flatToShard(Bt,Nt,At,kt)}return Bt}async function convertToShard(xt,e){const At=new DirSharded({root:xt.root,dir:!0,parent:xt.parent,parentKey:xt.parentKey,path:xt.path,dirty:xt.dirty,flat:!1,mtime:xt.mtime,mode:xt.mode},e);for await(const{key:kt,child:Bt}of xt.eachChildSeries())await At.put(kt,Bt);return At}const toPathComponents$1=(xt="")=>(xt.trim().match(/([^\\/]|\\\/)+/g)??[]).filter(Boolean);async function addToTree(xt,e,At){var Lt,er;const kt=toPathComponents$1(xt.path??""),Bt=kt.length-1;let Nt=e,jt="";for(let tr=0;tr<kt.length;tr++){const zt=kt[tr];jt+=`${jt!==""?"/":""}${zt}`;const rr=tr===Bt;if(Nt.dirty=!0,Nt.cid=void 0,Nt.size=void 0,rr)await Nt.put(zt,xt),e=await flatToShard(null,Nt,At.shardSplitThresholdBytes,At);else{let nr=await Nt.get(zt);(nr==null||!(nr instanceof Dir))&&(nr=new DirFlat({root:!1,dir:!0,parent:Nt,parentKey:zt,path:jt,dirty:!0,flat:!0,mtime:(Lt=nr==null?void 0:nr.unixfs)==null?void 0:Lt.mtime,mode:(er=nr==null?void 0:nr.unixfs)==null?void 0:er.mode},At)),await Nt.put(zt,nr),Nt=nr}}return e}async function*flushAndYield(xt,e){var At;if(!(xt instanceof Dir)){((At=xt.unixfs)==null?void 0:At.isDirectory())===!0&&(yield xt);return}yield*xt.flush(e)}function defaultTreeBuilder(xt){return async function*(At,kt){let Bt=new DirFlat({root:!0,dir:!0,path:"",dirty:!0,flat:!0},xt),Nt,jt=!1;for await(const Lt of At){if(Lt==null)continue;const er=`${Lt.originalPath??""}`.split("/")[0];er!=null&&er!==""&&(Nt==null?(Nt=er,jt=!0):Nt!==er&&(jt=!1)),Bt=await addToTree(Lt,Bt,xt),(Lt.unixfs==null||!Lt.unixfs.isDirectory())&&(yield Lt)}if(xt.wrapWithDirectory||jt&&Bt.childCount()>1)yield*flushAndYield(Bt,kt);else for await(const Lt of Bt.eachChildSeries())Lt!=null&&(yield*flushAndYield(Lt.child,kt))}}async function*importer(xt,e,At={}){let kt;Symbol.asyncIterator in xt||Symbol.iterator in xt?kt=xt:kt=[xt];const Bt=At.wrapWithDirectory??!1,Nt=At.shardSplitThresholdBytes??262144,jt=At.cidVersion??1,Lt=At.rawLeaves??!0,er=At.leafType??"file",tr=At.fileImportConcurrency??50,zt=At.blockWriteConcurrency??10,rr=At.reduceSingleLeafToSelf??!0,nr=At.chunker??fixedSize(),ir=At.chunkValidator??defaultChunkValidator(),ar=At.dagBuilder??defaultDagBuilder({chunker:nr,chunkValidator:ir,wrapWithDirectory:Bt,layout:At.layout??balanced(),bufferImporter:At.bufferImporter??defaultBufferImporter({cidVersion:jt,rawLeaves:Lt,leafType:er,onProgress:At.onProgress}),blockWriteConcurrency:zt,reduceSingleLeafToSelf:rr,cidVersion:jt,onProgress:At.onProgress}),dr=At.treeBuilder??defaultTreeBuilder({wrapWithDirectory:Bt,shardSplitThresholdBytes:Nt,cidVersion:jt,onProgress:At.onProgress});for await(const ur of dr(parallelBatch(ar(kt,e),tr),e))yield{cid:ur.cid,path:ur.path,unixfs:ur.unixfs,size:ur.size}}var __awaiter$3d=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues$a=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}};const hashers={[sha256$7.code]:sha256$7},codecs={[code$5]:cbor};class Cid{static computeCid(e,At=code$5,kt=sha256$7.code){return __awaiter$3d(this,void 0,void 0,function*(){const Bt=codecs[At];if(!Bt)throw new DwnError(DwnErrorCode.ComputeCidCodecNotSupported,`codec [${At}] not supported`);const Nt=hashers[kt];if(!Nt)throw new DwnError(DwnErrorCode.ComputeCidMultihashNotSupported,`multihash code [${kt}] not supported`);const jt=Bt.encode(e),Lt=yield Nt.digest(jt);return(yield CID.createV1(Bt.code,Lt)).toString()})}static parseCid(e){const At=CID.parse(e).toV1();if(!codecs[At.code])throw new DwnError(DwnErrorCode.ParseCidCodecNotSupported,`codec [${At.code}] not supported`);if(!hashers[At.multihash.code])throw new DwnError(DwnErrorCode.ParseCidMultihashNotSupported,`multihash code [${At.multihash.code}] not supported`);return At}static computeDagPbCidFromBytes(e){var At,kt,Bt,Nt;return __awaiter$3d(this,void 0,void 0,function*(){const jt=importer([{content:e}],new BlockstoreMock,{cidVersion:1});let Lt;try{for(var er=!0,tr=__asyncValues$a(jt),zt;zt=yield tr.next(),At=zt.done,!At;er=!0)Nt=zt.value,er=!1,Lt=Nt}catch(rr){kt={error:rr}}finally{try{!er&&!At&&(Bt=tr.return)&&(yield Bt.call(tr))}finally{if(kt)throw kt.error}}return Lt?Lt.cid.toString():""})}static computeDagPbCidFromStream(e){var At,kt,Bt,Nt;return __awaiter$3d(this,void 0,void 0,function*(){const jt=importer([{content:e}],new BlockstoreMock,{cidVersion:1});let Lt;try{for(var er=!0,tr=__asyncValues$a(jt),zt;zt=yield tr.next(),At=zt.done,!At;er=!0)Nt=zt.value,er=!1,Lt=Nt}catch(rr){kt={error:rr}}finally{try{!er&&!At&&(Bt=tr.return)&&(yield Bt.call(tr))}finally{if(kt)throw kt.error}}return Lt?Lt.cid.toString():""})}}var cryptoBrowserify={},browser$e={exports:{}},safeBuffer$2={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */(function(xt,e){var At=buffer$2,kt=At.Buffer;function Bt(jt,Lt){for(var er in jt)Lt[er]=jt[er]}kt.from&&kt.alloc&&kt.allocUnsafe&&kt.allocUnsafeSlow?xt.exports=At:(Bt(At,e),e.Buffer=Nt);function Nt(jt,Lt,er){return kt(jt,Lt,er)}Nt.prototype=Object.create(kt.prototype),Bt(kt,Nt),Nt.from=function(jt,Lt,er){if(typeof jt=="number")throw new TypeError("Argument must not be a number");return kt(jt,Lt,er)},Nt.alloc=function(jt,Lt,er){if(typeof jt!="number")throw new TypeError("Argument must be a number");var tr=kt(jt);return Lt!==void 0?typeof er=="string"?tr.fill(Lt,er):tr.fill(Lt):tr.fill(0),tr},Nt.allocUnsafe=function(jt){if(typeof jt!="number")throw new TypeError("Argument must be a number");return kt(jt)},Nt.allocUnsafeSlow=function(jt){if(typeof jt!="number")throw new TypeError("Argument must be a number");return At.SlowBuffer(jt)}})(safeBuffer$2,safeBuffer$2.exports);var safeBufferExports$1=safeBuffer$2.exports,MAX_BYTES=65536,MAX_UINT32=4294967295;function oldBrowser$1(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}var Buffer$G=safeBufferExports$1.Buffer,crypto$6=globalThis.crypto||globalThis.msCrypto;crypto$6&&crypto$6.getRandomValues?browser$e.exports=randomBytes$6:browser$e.exports=oldBrowser$1;function randomBytes$6(xt,e){if(xt>MAX_UINT32)throw new RangeError("requested too many random bytes");var At=Buffer$G.allocUnsafe(xt);if(xt>0)if(xt>MAX_BYTES)for(var kt=0;kt<xt;kt+=MAX_BYTES)crypto$6.getRandomValues(At.slice(kt,kt+MAX_BYTES));else crypto$6.getRandomValues(At);return typeof e=="function"?process$9.nextTick(function(){e(null,At)}):At}var browserExports$2=browser$e.exports,inherits_browser={exports:{}};typeof Object.create=="function"?inherits_browser.exports=function(e,At){At&&(e.super_=At,e.prototype=Object.create(At.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(e,At){if(At){e.super_=At;var kt=function(){};kt.prototype=At.prototype,e.prototype=new kt,e.prototype.constructor=e}};var inherits_browserExports=inherits_browser.exports,readableBrowser$1={exports:{}},events={exports:{}},R$1=typeof Reflect=="object"?Reflect:null,ReflectApply=R$1&&typeof R$1.apply=="function"?R$1.apply:function(e,At,kt){return Function.prototype.apply.call(e,At,kt)},ReflectOwnKeys;R$1&&typeof R$1.ownKeys=="function"?ReflectOwnKeys=R$1.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e)};function ProcessEmitWarning(xt){console&&console.warn&&console.warn(xt)}var NumberIsNaN$4=Number.isNaN||function(e){return e!==e};function EventEmitter$2(){EventEmitter$2.init.call(this)}events.exports=EventEmitter$2;events.exports.once=once$6;EventEmitter$2.EventEmitter=EventEmitter$2;EventEmitter$2.prototype._events=void 0;EventEmitter$2.prototype._eventsCount=0;EventEmitter$2.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(xt){if(typeof xt!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof xt)}Object.defineProperty(EventEmitter$2,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(xt){if(typeof xt!="number"||xt<0||NumberIsNaN$4(xt))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+xt+".");defaultMaxListeners=xt}});EventEmitter$2.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter$2.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||NumberIsNaN$4(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _getMaxListeners(xt){return xt._maxListeners===void 0?EventEmitter$2.defaultMaxListeners:xt._maxListeners}EventEmitter$2.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter$2.prototype.emit=function(e){for(var At=[],kt=1;kt<arguments.length;kt++)At.push(arguments[kt]);var Bt=e==="error",Nt=this._events;if(Nt!==void 0)Bt=Bt&&Nt.error===void 0;else if(!Bt)return!1;if(Bt){var jt;if(At.length>0&&(jt=At[0]),jt instanceof Error)throw jt;var Lt=new Error("Unhandled error."+(jt?" ("+jt.message+")":""));throw Lt.context=jt,Lt}var er=Nt[e];if(er===void 0)return!1;if(typeof er=="function")ReflectApply(er,this,At);else for(var tr=er.length,zt=arrayClone(er,tr),kt=0;kt<tr;++kt)ReflectApply(zt[kt],this,At);return!0};function _addListener(xt,e,At,kt){var Bt,Nt,jt;if(checkListener(At),Nt=xt._events,Nt===void 0?(Nt=xt._events=Object.create(null),xt._eventsCount=0):(Nt.newListener!==void 0&&(xt.emit("newListener",e,At.listener?At.listener:At),Nt=xt._events),jt=Nt[e]),jt===void 0)jt=Nt[e]=At,++xt._eventsCount;else if(typeof jt=="function"?jt=Nt[e]=kt?[At,jt]:[jt,At]:kt?jt.unshift(At):jt.push(At),Bt=_getMaxListeners(xt),Bt>0&&jt.length>Bt&&!jt.warned){jt.warned=!0;var Lt=new Error("Possible EventEmitter memory leak detected. "+jt.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");Lt.name="MaxListenersExceededWarning",Lt.emitter=xt,Lt.type=e,Lt.count=jt.length,ProcessEmitWarning(Lt)}return xt}EventEmitter$2.prototype.addListener=function(e,At){return _addListener(this,e,At,!1)};EventEmitter$2.prototype.on=EventEmitter$2.prototype.addListener;EventEmitter$2.prototype.prependListener=function(e,At){return _addListener(this,e,At,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(xt,e,At){var kt={fired:!1,wrapFn:void 0,target:xt,type:e,listener:At},Bt=onceWrapper.bind(kt);return Bt.listener=At,kt.wrapFn=Bt,Bt}EventEmitter$2.prototype.once=function(e,At){return checkListener(At),this.on(e,_onceWrap(this,e,At)),this};EventEmitter$2.prototype.prependOnceListener=function(e,At){return checkListener(At),this.prependListener(e,_onceWrap(this,e,At)),this};EventEmitter$2.prototype.removeListener=function(e,At){var kt,Bt,Nt,jt,Lt;if(checkListener(At),Bt=this._events,Bt===void 0)return this;if(kt=Bt[e],kt===void 0)return this;if(kt===At||kt.listener===At)--this._eventsCount===0?this._events=Object.create(null):(delete Bt[e],Bt.removeListener&&this.emit("removeListener",e,kt.listener||At));else if(typeof kt!="function"){for(Nt=-1,jt=kt.length-1;jt>=0;jt--)if(kt[jt]===At||kt[jt].listener===At){Lt=kt[jt].listener,Nt=jt;break}if(Nt<0)return this;Nt===0?kt.shift():spliceOne(kt,Nt),kt.length===1&&(Bt[e]=kt[0]),Bt.removeListener!==void 0&&this.emit("removeListener",e,Lt||At)}return this};EventEmitter$2.prototype.off=EventEmitter$2.prototype.removeListener;EventEmitter$2.prototype.removeAllListeners=function(e){var At,kt,Bt;if(kt=this._events,kt===void 0)return this;if(kt.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):kt[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete kt[e]),this;if(arguments.length===0){var Nt=Object.keys(kt),jt;for(Bt=0;Bt<Nt.length;++Bt)jt=Nt[Bt],jt!=="removeListener"&&this.removeAllListeners(jt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(At=kt[e],typeof At=="function")this.removeListener(e,At);else if(At!==void 0)for(Bt=At.length-1;Bt>=0;Bt--)this.removeListener(e,At[Bt]);return this};function _listeners(xt,e,At){var kt=xt._events;if(kt===void 0)return[];var Bt=kt[e];return Bt===void 0?[]:typeof Bt=="function"?At?[Bt.listener||Bt]:[Bt]:At?unwrapListeners(Bt):arrayClone(Bt,Bt.length)}EventEmitter$2.prototype.listeners=function(e){return _listeners(this,e,!0)};EventEmitter$2.prototype.rawListeners=function(e){return _listeners(this,e,!1)};EventEmitter$2.listenerCount=function(xt,e){return typeof xt.listenerCount=="function"?xt.listenerCount(e):listenerCount.call(xt,e)};EventEmitter$2.prototype.listenerCount=listenerCount;function listenerCount(xt){var e=this._events;if(e!==void 0){var At=e[xt];if(typeof At=="function")return 1;if(At!==void 0)return At.length}return 0}EventEmitter$2.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(xt,e){for(var At=new Array(e),kt=0;kt<e;++kt)At[kt]=xt[kt];return At}function spliceOne(xt,e){for(;e+1<xt.length;e++)xt[e]=xt[e+1];xt.pop()}function unwrapListeners(xt){for(var e=new Array(xt.length),At=0;At<e.length;++At)e[At]=xt[At].listener||xt[At];return e}function once$6(xt,e){return new Promise(function(At,kt){function Bt(jt){xt.removeListener(e,Nt),kt(jt)}function Nt(){typeof xt.removeListener=="function"&&xt.removeListener("error",Bt),At([].slice.call(arguments))}eventTargetAgnosticAddListener(xt,e,Nt,{once:!0}),e!=="error"&&addErrorHandlerIfEventEmitter(xt,Bt,{once:!0})})}function addErrorHandlerIfEventEmitter(xt,e,At){typeof xt.on=="function"&&eventTargetAgnosticAddListener(xt,"error",e,At)}function eventTargetAgnosticAddListener(xt,e,At,kt){if(typeof xt.on=="function")kt.once?xt.once(e,At):xt.on(e,At);else if(typeof xt.addEventListener=="function")xt.addEventListener(e,function Bt(Nt){kt.once&&xt.removeEventListener(e,Bt),At(Nt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof xt)}var eventsExports=events.exports,streamBrowser$1=eventsExports.EventEmitter,util$6={},types$1={},shams$1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},At=Symbol("test"),kt=Object(At);if(typeof At=="string"||Object.prototype.toString.call(At)!=="[object Symbol]"||Object.prototype.toString.call(kt)!=="[object Symbol]")return!1;var Bt=42;e[At]=Bt;for(At in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var Nt=Object.getOwnPropertySymbols(e);if(Nt.length!==1||Nt[0]!==At||!Object.prototype.propertyIsEnumerable.call(e,At))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var jt=Object.getOwnPropertyDescriptor(e,At);if(jt.value!==Bt||jt.enumerable!==!0)return!1}return!0},hasSymbols$2=shams$1,shams=function(){return hasSymbols$2()&&!!Symbol.toStringTag},esErrors=Error,_eval=EvalError,range=RangeError,ref$1=ReferenceError,syntax=SyntaxError,type$9=TypeError,uri$2=URIError,origSymbol=typeof Symbol<"u"&&Symbol,hasSymbolSham=shams$1,hasSymbols$1=function(){return typeof origSymbol!="function"||typeof Symbol!="function"||typeof origSymbol("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:hasSymbolSham()},test={__proto__:null,foo:{}},$Object=Object,hasProto$1=function(){return{__proto__:test}.foo===test.foo&&!(test instanceof $Object)},ERROR_MESSAGE="Function.prototype.bind called on incompatible ",toStr$4=Object.prototype.toString,max$1=Math.max,funcType="[object Function]",concatty=function(e,At){for(var kt=[],Bt=0;Bt<e.length;Bt+=1)kt[Bt]=e[Bt];for(var Nt=0;Nt<At.length;Nt+=1)kt[Nt+e.length]=At[Nt];return kt},slicy=function(e,At){for(var kt=[],Bt=At,Nt=0;Bt<e.length;Bt+=1,Nt+=1)kt[Nt]=e[Bt];return kt},joiny=function(xt,e){for(var At="",kt=0;kt<xt.length;kt+=1)At+=xt[kt],kt+1<xt.length&&(At+=e);return At},implementation$1=function(e){var At=this;if(typeof At!="function"||toStr$4.apply(At)!==funcType)throw new TypeError(ERROR_MESSAGE+At);for(var kt=slicy(arguments,1),Bt,Nt=function(){if(this instanceof Bt){var zt=At.apply(this,concatty(kt,arguments));return Object(zt)===zt?zt:this}return At.apply(e,concatty(kt,arguments))},jt=max$1(0,At.length-kt.length),Lt=[],er=0;er<jt;er++)Lt[er]="$"+er;if(Bt=Function("binder","return function ("+joiny(Lt,",")+"){ return binder.apply(this,arguments); }")(Nt),At.prototype){var tr=function(){};tr.prototype=At.prototype,Bt.prototype=new tr,tr.prototype=null}return Bt},implementation=implementation$1,functionBind=Function.prototype.bind||implementation,call$1=Function.prototype.call,$hasOwn=Object.prototype.hasOwnProperty,bind$1=functionBind,hasown=bind$1.call(call$1,$hasOwn),undefined$1,$Error=esErrors,$EvalError=_eval,$RangeError=range,$ReferenceError=ref$1,$SyntaxError$1=syntax,$TypeError$2=type$9,$URIError=uri$2,$Function=Function,getEvalledConstructor=function(xt){try{return $Function('"use strict"; return ('+xt+").constructor;")()}catch{}},$gOPD$1=Object.getOwnPropertyDescriptor;if($gOPD$1)try{$gOPD$1({},"")}catch{$gOPD$1=null}var throwTypeError=function(){throw new $TypeError$2},ThrowTypeError=$gOPD$1?function(){try{return arguments.callee,throwTypeError}catch{try{return $gOPD$1(arguments,"callee").get}catch{return throwTypeError}}}():throwTypeError,hasSymbols=hasSymbols$1(),hasProto=hasProto$1(),getProto$1=Object.getPrototypeOf||(hasProto?function(xt){return xt.__proto__}:null),needsEval={},TypedArray=typeof Uint8Array>"u"||!getProto$1?undefined$1:getProto$1(Uint8Array),INTRINSICS={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?undefined$1:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?undefined$1:ArrayBuffer,"%ArrayIteratorPrototype%":hasSymbols&&getProto$1?getProto$1([][Symbol.iterator]()):undefined$1,"%AsyncFromSyncIteratorPrototype%":undefined$1,"%AsyncFunction%":needsEval,"%AsyncGenerator%":needsEval,"%AsyncGeneratorFunction%":needsEval,"%AsyncIteratorPrototype%":needsEval,"%Atomics%":typeof Atomics>"u"?undefined$1:Atomics,"%BigInt%":typeof BigInt>"u"?undefined$1:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?undefined$1:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?undefined$1:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?undefined$1:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":$Error,"%eval%":eval,"%EvalError%":$EvalError,"%Float32Array%":typeof Float32Array>"u"?undefined$1:Float32Array,"%Float64Array%":typeof Float64Array>"u"?undefined$1:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?undefined$1:FinalizationRegistry,"%Function%":$Function,"%GeneratorFunction%":needsEval,"%Int8Array%":typeof Int8Array>"u"?undefined$1:Int8Array,"%Int16Array%":typeof Int16Array>"u"?undefined$1:Int16Array,"%Int32Array%":typeof Int32Array>"u"?undefined$1:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hasSymbols&&getProto$1?getProto$1(getProto$1([][Symbol.iterator]())):undefined$1,"%JSON%":typeof JSON=="object"?JSON:undefined$1,"%Map%":typeof Map>"u"?undefined$1:Map,"%MapIteratorPrototype%":typeof Map>"u"||!hasSymbols||!getProto$1?undefined$1:getProto$1(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?undefined$1:Promise,"%Proxy%":typeof Proxy>"u"?undefined$1:Proxy,"%RangeError%":$RangeError,"%ReferenceError%":$ReferenceError,"%Reflect%":typeof Reflect>"u"?undefined$1:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?undefined$1:Set,"%SetIteratorPrototype%":typeof Set>"u"||!hasSymbols||!getProto$1?undefined$1:getProto$1(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?undefined$1:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hasSymbols&&getProto$1?getProto$1(""[Symbol.iterator]()):undefined$1,"%Symbol%":hasSymbols?Symbol:undefined$1,"%SyntaxError%":$SyntaxError$1,"%ThrowTypeError%":ThrowTypeError,"%TypedArray%":TypedArray,"%TypeError%":$TypeError$2,"%Uint8Array%":typeof Uint8Array>"u"?undefined$1:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?undefined$1:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?undefined$1:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?undefined$1:Uint32Array,"%URIError%":$URIError,"%WeakMap%":typeof WeakMap>"u"?undefined$1:WeakMap,"%WeakRef%":typeof WeakRef>"u"?undefined$1:WeakRef,"%WeakSet%":typeof WeakSet>"u"?undefined$1:WeakSet};if(getProto$1)try{null.error}catch(xt){var errorProto=getProto$1(getProto$1(xt));INTRINSICS["%Error.prototype%"]=errorProto}var doEval=function xt(e){var At;if(e==="%AsyncFunction%")At=getEvalledConstructor("async function () {}");else if(e==="%GeneratorFunction%")At=getEvalledConstructor("function* () {}");else if(e==="%AsyncGeneratorFunction%")At=getEvalledConstructor("async function* () {}");else if(e==="%AsyncGenerator%"){var kt=xt("%AsyncGeneratorFunction%");kt&&(At=kt.prototype)}else if(e==="%AsyncIteratorPrototype%"){var Bt=xt("%AsyncGenerator%");Bt&&getProto$1&&(At=getProto$1(Bt.prototype))}return INTRINSICS[e]=At,At},LEGACY_ALIASES={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},bind=functionBind,hasOwn=hasown,$concat=bind.call(Function.call,Array.prototype.concat),$spliceApply=bind.call(Function.apply,Array.prototype.splice),$replace=bind.call(Function.call,String.prototype.replace),$strSlice=bind.call(Function.call,String.prototype.slice),$exec=bind.call(Function.call,RegExp.prototype.exec),rePropName=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,reEscapeChar=/\\(\\)?/g,stringToPath=function(e){var At=$strSlice(e,0,1),kt=$strSlice(e,-1);if(At==="%"&&kt!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected closing `%`");if(kt==="%"&&At!=="%")throw new $SyntaxError$1("invalid intrinsic syntax, expected opening `%`");var Bt=[];return $replace(e,rePropName,function(Nt,jt,Lt,er){Bt[Bt.length]=Lt?$replace(er,reEscapeChar,"$1"):jt||Nt}),Bt},getBaseIntrinsic=function(e,At){var kt=e,Bt;if(hasOwn(LEGACY_ALIASES,kt)&&(Bt=LEGACY_ALIASES[kt],kt="%"+Bt[0]+"%"),hasOwn(INTRINSICS,kt)){var Nt=INTRINSICS[kt];if(Nt===needsEval&&(Nt=doEval(kt)),typeof Nt>"u"&&!At)throw new $TypeError$2("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:Bt,name:kt,value:Nt}}throw new $SyntaxError$1("intrinsic "+e+" does not exist!")},getIntrinsic=function(e,At){if(typeof e!="string"||e.length===0)throw new $TypeError$2("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof At!="boolean")throw new $TypeError$2('"allowMissing" argument must be a boolean');if($exec(/^%?[^%]*%?$/,e)===null)throw new $SyntaxError$1("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var kt=stringToPath(e),Bt=kt.length>0?kt[0]:"",Nt=getBaseIntrinsic("%"+Bt+"%",At),jt=Nt.name,Lt=Nt.value,er=!1,tr=Nt.alias;tr&&(Bt=tr[0],$spliceApply(kt,$concat([0,1],tr)));for(var zt=1,rr=!0;zt<kt.length;zt+=1){var nr=kt[zt],ir=$strSlice(nr,0,1),ar=$strSlice(nr,-1);if((ir==='"'||ir==="'"||ir==="`"||ar==='"'||ar==="'"||ar==="`")&&ir!==ar)throw new $SyntaxError$1("property names with quotes must have matching quotes");if((nr==="constructor"||!rr)&&(er=!0),Bt+="."+nr,jt="%"+Bt+"%",hasOwn(INTRINSICS,jt))Lt=INTRINSICS[jt];else if(Lt!=null){if(!(nr in Lt)){if(!At)throw new $TypeError$2("base intrinsic for "+e+" exists, but the property is not available.");return}if($gOPD$1&&zt+1>=kt.length){var dr=$gOPD$1(Lt,nr);rr=!!dr,rr&&"get"in dr&&!("originalValue"in dr.get)?Lt=dr.get:Lt=Lt[nr]}else rr=hasOwn(Lt,nr),Lt=Lt[nr];rr&&!er&&(INTRINSICS[jt]=Lt)}}return Lt},callBind$2={exports:{}},esDefineProperty,hasRequiredEsDefineProperty;function requireEsDefineProperty(){if(hasRequiredEsDefineProperty)return esDefineProperty;hasRequiredEsDefineProperty=1;var xt=getIntrinsic,e=xt("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return esDefineProperty=e,esDefineProperty}var GetIntrinsic$3=getIntrinsic,$gOPD=GetIntrinsic$3("%Object.getOwnPropertyDescriptor%",!0);if($gOPD)try{$gOPD([],"length")}catch{$gOPD=null}var gopd$1=$gOPD,$defineProperty$1=requireEsDefineProperty(),$SyntaxError=syntax,$TypeError$1=type$9,gopd=gopd$1,defineDataProperty=function(e,At,kt){if(!e||typeof e!="object"&&typeof e!="function")throw new $TypeError$1("`obj` must be an object or a function`");if(typeof At!="string"&&typeof At!="symbol")throw new $TypeError$1("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new $TypeError$1("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new $TypeError$1("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new $TypeError$1("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new $TypeError$1("`loose`, if provided, must be a boolean");var Bt=arguments.length>3?arguments[3]:null,Nt=arguments.length>4?arguments[4]:null,jt=arguments.length>5?arguments[5]:null,Lt=arguments.length>6?arguments[6]:!1,er=!!gopd&&gopd(e,At);if($defineProperty$1)$defineProperty$1(e,At,{configurable:jt===null&&er?er.configurable:!jt,enumerable:Bt===null&&er?er.enumerable:!Bt,value:kt,writable:Nt===null&&er?er.writable:!Nt});else if(Lt||!Bt&&!Nt&&!jt)e[At]=kt;else throw new $SyntaxError("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},$defineProperty=requireEsDefineProperty(),hasPropertyDescriptors=function(){return!!$defineProperty};hasPropertyDescriptors.hasArrayLengthDefineBug=function(){if(!$defineProperty)return null;try{return $defineProperty([],"length",{value:1}).length!==1}catch{return!0}};var hasPropertyDescriptors_1=hasPropertyDescriptors,GetIntrinsic$2=getIntrinsic,define=defineDataProperty,hasDescriptors=hasPropertyDescriptors_1(),gOPD$1=gopd$1,$TypeError=type$9,$floor=GetIntrinsic$2("%Math.floor%"),setFunctionLength=function(e,At){if(typeof e!="function")throw new $TypeError("`fn` is not a function");if(typeof At!="number"||At<0||At>4294967295||$floor(At)!==At)throw new $TypeError("`length` must be a positive 32-bit integer");var kt=arguments.length>2&&!!arguments[2],Bt=!0,Nt=!0;if("length"in e&&gOPD$1){var jt=gOPD$1(e,"length");jt&&!jt.configurable&&(Bt=!1),jt&&!jt.writable&&(Nt=!1)}return(Bt||Nt||!kt)&&(hasDescriptors?define(e,"length",At,!0,!0):define(e,"length",At)),e};(function(xt){var e=functionBind,At=getIntrinsic,kt=setFunctionLength,Bt=type$9,Nt=At("%Function.prototype.apply%"),jt=At("%Function.prototype.call%"),Lt=At("%Reflect.apply%",!0)||e.call(jt,Nt),er=requireEsDefineProperty(),tr=At("%Math.max%");xt.exports=function(nr){if(typeof nr!="function")throw new Bt("a function is required");var ir=Lt(e,jt,arguments);return kt(ir,1+tr(0,nr.length-(arguments.length-1)),!0)};var zt=function(){return Lt(e,Nt,arguments)};er?er(xt.exports,"apply",{value:zt}):xt.exports.apply=zt})(callBind$2);var callBindExports=callBind$2.exports,GetIntrinsic$1=getIntrinsic,callBind$1=callBindExports,$indexOf$1=callBind$1(GetIntrinsic$1("String.prototype.indexOf")),callBound$2=function(e,At){var kt=GetIntrinsic$1(e,!!At);return typeof kt=="function"&&$indexOf$1(e,".prototype.")>-1?callBind$1(kt):kt},hasToStringTag$3=shams(),callBound$1=callBound$2,$toString$1=callBound$1("Object.prototype.toString"),isStandardArguments=function(e){return hasToStringTag$3&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:$toString$1(e)==="[object Arguments]"},isLegacyArguments=function(e){return isStandardArguments(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&$toString$1(e)!=="[object Array]"&&$toString$1(e.callee)==="[object Function]"},supportsStandardArguments=function(){return isStandardArguments(arguments)}();isStandardArguments.isLegacyArguments=isLegacyArguments;var isArguments=supportsStandardArguments?isStandardArguments:isLegacyArguments,toStr$3=Object.prototype.toString,fnToStr$1=Function.prototype.toString,isFnRegex=/^\s*(?:function)?\*/,hasToStringTag$2=shams(),getProto=Object.getPrototypeOf,getGeneratorFunc=function(){if(!hasToStringTag$2)return!1;try{return Function("return function*() {}")()}catch{}},GeneratorFunction,isGeneratorFunction=function(e){if(typeof e!="function")return!1;if(isFnRegex.test(fnToStr$1.call(e)))return!0;if(!hasToStringTag$2){var At=toStr$3.call(e);return At==="[object GeneratorFunction]"}if(!getProto)return!1;if(typeof GeneratorFunction>"u"){var kt=getGeneratorFunc();GeneratorFunction=kt?getProto(kt):!1}return getProto(e)===GeneratorFunction},fnToStr=Function.prototype.toString,reflectApply=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,badArrayLike,isCallableMarker;if(typeof reflectApply=="function"&&typeof Object.defineProperty=="function")try{badArrayLike=Object.defineProperty({},"length",{get:function(){throw isCallableMarker}}),isCallableMarker={},reflectApply(function(){throw 42},null,badArrayLike)}catch(xt){xt!==isCallableMarker&&(reflectApply=null)}else reflectApply=null;var constructorRegex=/^\s*class\b/,isES6ClassFn=function(e){try{var At=fnToStr.call(e);return constructorRegex.test(At)}catch{return!1}},tryFunctionObject=function(e){try{return isES6ClassFn(e)?!1:(fnToStr.call(e),!0)}catch{return!1}},toStr$2=Object.prototype.toString,objectClass="[object Object]",fnClass="[object Function]",genClass="[object GeneratorFunction]",ddaClass="[object HTMLAllCollection]",ddaClass2="[object HTML document.all class]",ddaClass3="[object HTMLCollection]",hasToStringTag$1=typeof Symbol=="function"&&!!Symbol.toStringTag,isIE68=!(0 in[,]),isDDA=function(){return!1};if(typeof document=="object"){var all=document.all;toStr$2.call(all)===toStr$2.call(document.all)&&(isDDA=function(e){if((isIE68||!e)&&(typeof e>"u"||typeof e=="object"))try{var At=toStr$2.call(e);return(At===ddaClass||At===ddaClass2||At===ddaClass3||At===objectClass)&&e("")==null}catch{}return!1})}var isCallable$1=reflectApply?function(e){if(isDDA(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{reflectApply(e,null,badArrayLike)}catch(At){if(At!==isCallableMarker)return!1}return!isES6ClassFn(e)&&tryFunctionObject(e)}:function(e){if(isDDA(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(hasToStringTag$1)return tryFunctionObject(e);if(isES6ClassFn(e))return!1;var At=toStr$2.call(e);return At!==fnClass&&At!==genClass&&!/^\[object HTML/.test(At)?!1:tryFunctionObject(e)},isCallable=isCallable$1,toStr$1=Object.prototype.toString,hasOwnProperty$1=Object.prototype.hasOwnProperty,forEachArray=function(e,At,kt){for(var Bt=0,Nt=e.length;Bt<Nt;Bt++)hasOwnProperty$1.call(e,Bt)&&(kt==null?At(e[Bt],Bt,e):At.call(kt,e[Bt],Bt,e))},forEachString=function(e,At,kt){for(var Bt=0,Nt=e.length;Bt<Nt;Bt++)kt==null?At(e.charAt(Bt),Bt,e):At.call(kt,e.charAt(Bt),Bt,e)},forEachObject=function(e,At,kt){for(var Bt in e)hasOwnProperty$1.call(e,Bt)&&(kt==null?At(e[Bt],Bt,e):At.call(kt,e[Bt],Bt,e))},forEach$3=function(e,At,kt){if(!isCallable(At))throw new TypeError("iterator must be a function");var Bt;arguments.length>=3&&(Bt=kt),toStr$1.call(e)==="[object Array]"?forEachArray(e,At,Bt):typeof e=="string"?forEachString(e,At,Bt):forEachObject(e,At,Bt)},forEach_1=forEach$3,possibleTypedArrayNames=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],possibleNames=possibleTypedArrayNames,g$2=globalThis,availableTypedArrays$1=function(){for(var e=[],At=0;At<possibleNames.length;At++)typeof g$2[possibleNames[At]]=="function"&&(e[e.length]=possibleNames[At]);return e},forEach$2=forEach_1,availableTypedArrays=availableTypedArrays$1,callBind=callBindExports,callBound=callBound$2,gOPD=gopd$1,$toString=callBound("Object.prototype.toString"),hasToStringTag=shams(),g$1=globalThis,typedArrays=availableTypedArrays(),$slice=callBound("String.prototype.slice"),getPrototypeOf=Object.getPrototypeOf,$indexOf=callBound("Array.prototype.indexOf",!0)||function(e,At){for(var kt=0;kt<e.length;kt+=1)if(e[kt]===At)return kt;return-1},cache={__proto__:null};hasToStringTag&&gOPD&&getPrototypeOf?forEach$2(typedArrays,function(xt){var e=new g$1[xt];if(Symbol.toStringTag in e){var At=getPrototypeOf(e),kt=gOPD(At,Symbol.toStringTag);if(!kt){var Bt=getPrototypeOf(At);kt=gOPD(Bt,Symbol.toStringTag)}cache["$"+xt]=callBind(kt.get)}}):forEach$2(typedArrays,function(xt){var e=new g$1[xt],At=e.slice||e.set;At&&(cache["$"+xt]=callBind(At))});var tryTypedArrays=function(e){var At=!1;return forEach$2(cache,function(kt,Bt){if(!At)try{"$"+kt(e)===Bt&&(At=$slice(Bt,1))}catch{}}),At},trySlices=function(e){var At=!1;return forEach$2(cache,function(kt,Bt){if(!At)try{kt(e),At=$slice(Bt,1)}catch{}}),At},whichTypedArray$1=function(e){if(!e||typeof e!="object")return!1;if(!hasToStringTag){var At=$slice($toString(e),8,-1);return $indexOf(typedArrays,At)>-1?At:At!=="Object"?!1:trySlices(e)}return gOPD?tryTypedArrays(e):null},whichTypedArray=whichTypedArray$1,isTypedArray=function(e){return!!whichTypedArray(e)};(function(xt){var e=isArguments,At=isGeneratorFunction,kt=whichTypedArray$1,Bt=isTypedArray;function Nt(Zr){return Zr.call.bind(Zr)}var jt=typeof BigInt<"u",Lt=typeof Symbol<"u",er=Nt(Object.prototype.toString),tr=Nt(Number.prototype.valueOf),zt=Nt(String.prototype.valueOf),rr=Nt(Boolean.prototype.valueOf);if(jt)var nr=Nt(BigInt.prototype.valueOf);if(Lt)var ir=Nt(Symbol.prototype.valueOf);function ar(Zr,rn){if(typeof Zr!="object")return!1;try{return rn(Zr),!0}catch{return!1}}xt.isArgumentsObject=e,xt.isGeneratorFunction=At,xt.isTypedArray=Bt;function dr(Zr){return typeof Promise<"u"&&Zr instanceof Promise||Zr!==null&&typeof Zr=="object"&&typeof Zr.then=="function"&&typeof Zr.catch=="function"}xt.isPromise=dr;function ur(Zr){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(Zr):Bt(Zr)||Rr(Zr)}xt.isArrayBufferView=ur;function fr(Zr){return kt(Zr)==="Uint8Array"}xt.isUint8Array=fr;function pr(Zr){return kt(Zr)==="Uint8ClampedArray"}xt.isUint8ClampedArray=pr;function lr(Zr){return kt(Zr)==="Uint16Array"}xt.isUint16Array=lr;function yr(Zr){return kt(Zr)==="Uint32Array"}xt.isUint32Array=yr;function br(Zr){return kt(Zr)==="Int8Array"}xt.isInt8Array=br;function Ar(Zr){return kt(Zr)==="Int16Array"}xt.isInt16Array=Ar;function Pr(Zr){return kt(Zr)==="Int32Array"}xt.isInt32Array=Pr;function kr(Zr){return kt(Zr)==="Float32Array"}xt.isFloat32Array=kr;function Ur(Zr){return kt(Zr)==="Float64Array"}xt.isFloat64Array=Ur;function Hr(Zr){return kt(Zr)==="BigInt64Array"}xt.isBigInt64Array=Hr;function Lr(Zr){return kt(Zr)==="BigUint64Array"}xt.isBigUint64Array=Lr;function Sr(Zr){return er(Zr)==="[object Map]"}Sr.working=typeof Map<"u"&&Sr(new Map);function _r(Zr){return typeof Map>"u"?!1:Sr.working?Sr(Zr):Zr instanceof Map}xt.isMap=_r;function gr(Zr){return er(Zr)==="[object Set]"}gr.working=typeof Set<"u"&&gr(new Set);function wr(Zr){return typeof Set>"u"?!1:gr.working?gr(Zr):Zr instanceof Set}xt.isSet=wr;function Dr(Zr){return er(Zr)==="[object WeakMap]"}Dr.working=typeof WeakMap<"u"&&Dr(new WeakMap);function xr(Zr){return typeof WeakMap>"u"?!1:Dr.working?Dr(Zr):Zr instanceof WeakMap}xt.isWeakMap=xr;function Ir(Zr){return er(Zr)==="[object WeakSet]"}Ir.working=typeof WeakSet<"u"&&Ir(new WeakSet);function $r(Zr){return Ir(Zr)}xt.isWeakSet=$r;function vr(Zr){return er(Zr)==="[object ArrayBuffer]"}vr.working=typeof ArrayBuffer<"u"&&vr(new ArrayBuffer);function Er(Zr){return typeof ArrayBuffer>"u"?!1:vr.working?vr(Zr):Zr instanceof ArrayBuffer}xt.isArrayBuffer=Er;function Tr(Zr){return er(Zr)==="[object DataView]"}Tr.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Tr(new DataView(new ArrayBuffer(1),0,1));function Rr(Zr){return typeof DataView>"u"?!1:Tr.working?Tr(Zr):Zr instanceof DataView}xt.isDataView=Rr;var Mr=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function Gr(Zr){return er(Zr)==="[object SharedArrayBuffer]"}function Br(Zr){return typeof Mr>"u"?!1:(typeof Gr.working>"u"&&(Gr.working=Gr(new Mr)),Gr.working?Gr(Zr):Zr instanceof Mr)}xt.isSharedArrayBuffer=Br;function Cr(Zr){return er(Zr)==="[object AsyncFunction]"}xt.isAsyncFunction=Cr;function jr(Zr){return er(Zr)==="[object Map Iterator]"}xt.isMapIterator=jr;function Yr(Zr){return er(Zr)==="[object Set Iterator]"}xt.isSetIterator=Yr;function Qr(Zr){return er(Zr)==="[object Generator]"}xt.isGeneratorObject=Qr;function Jr(Zr){return er(Zr)==="[object WebAssembly.Module]"}xt.isWebAssemblyCompiledModule=Jr;function Wr(Zr){return ar(Zr,tr)}xt.isNumberObject=Wr;function Nr(Zr){return ar(Zr,zt)}xt.isStringObject=Nr;function Vr(Zr){return ar(Zr,rr)}xt.isBooleanObject=Vr;function Xr(Zr){return jt&&ar(Zr,nr)}xt.isBigIntObject=Xr;function qr(Zr){return Lt&&ar(Zr,ir)}xt.isSymbolObject=qr;function Or(Zr){return Wr(Zr)||Nr(Zr)||Vr(Zr)||Xr(Zr)||qr(Zr)}xt.isBoxedPrimitive=Or;function Fr(Zr){return typeof Uint8Array<"u"&&(Er(Zr)||Br(Zr))}xt.isAnyArrayBuffer=Fr,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(Zr){Object.defineProperty(xt,Zr,{enumerable:!1,value:function(){throw new Error(Zr+" is not supported in userland")}})})})(types$1);var isBufferBrowser=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"};(function(xt){var e={},At=Object.getOwnPropertyDescriptors||function(Mr){for(var Gr=Object.keys(Mr),Br={},Cr=0;Cr<Gr.length;Cr++)Br[Gr[Cr]]=Object.getOwnPropertyDescriptor(Mr,Gr[Cr]);return Br},kt=/%[sdj%]/g;xt.format=function(Rr){if(!Ar(Rr)){for(var Mr=[],Gr=0;Gr<arguments.length;Gr++)Mr.push(Lt(arguments[Gr]));return Mr.join(" ")}for(var Gr=1,Br=arguments,Cr=Br.length,jr=String(Rr).replace(kt,function(Qr){if(Qr==="%%")return"%";if(Gr>=Cr)return Qr;switch(Qr){case"%s":return String(Br[Gr++]);case"%d":return Number(Br[Gr++]);case"%j":try{return JSON.stringify(Br[Gr++])}catch{return"[Circular]"}default:return Qr}}),Yr=Br[Gr];Gr<Cr;Yr=Br[++Gr])lr(Yr)||!Hr(Yr)?jr+=" "+Yr:jr+=" "+Lt(Yr);return jr},xt.deprecate=function(Rr,Mr){if(typeof process$9<"u"&&process$9.noDeprecation===!0)return Rr;if(typeof process$9>"u")return function(){return xt.deprecate(Rr,Mr).apply(this,arguments)};var Gr=!1;function Br(){if(!Gr){if(process$9.throwDeprecation)throw new Error(Mr);process$9.traceDeprecation?console.trace(Mr):console.error(Mr),Gr=!0}return Rr.apply(this,arguments)}return Br};var Bt={},Nt=/^$/;if(e.NODE_DEBUG){var jt=e.NODE_DEBUG;jt=jt.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),Nt=new RegExp("^"+jt+"$","i")}xt.debuglog=function(Rr){if(Rr=Rr.toUpperCase(),!Bt[Rr])if(Nt.test(Rr)){var Mr=process$9.pid;Bt[Rr]=function(){var Gr=xt.format.apply(xt,arguments);console.error("%s %d: %s",Rr,Mr,Gr)}}else Bt[Rr]=function(){};return Bt[Rr]};function Lt(Rr,Mr){var Gr={seen:[],stylize:tr};return arguments.length>=3&&(Gr.depth=arguments[2]),arguments.length>=4&&(Gr.colors=arguments[3]),pr(Mr)?Gr.showHidden=Mr:Mr&&xt._extend(Gr,Mr),kr(Gr.showHidden)&&(Gr.showHidden=!1),kr(Gr.depth)&&(Gr.depth=2),kr(Gr.colors)&&(Gr.colors=!1),kr(Gr.customInspect)&&(Gr.customInspect=!0),Gr.colors&&(Gr.stylize=er),rr(Gr,Rr,Gr.depth)}xt.inspect=Lt,Lt.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Lt.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function er(Rr,Mr){var Gr=Lt.styles[Mr];return Gr?"\x1B["+Lt.colors[Gr][0]+"m"+Rr+"\x1B["+Lt.colors[Gr][1]+"m":Rr}function tr(Rr,Mr){return Rr}function zt(Rr){var Mr={};return Rr.forEach(function(Gr,Br){Mr[Gr]=!0}),Mr}function rr(Rr,Mr,Gr){if(Rr.customInspect&&Mr&&_r(Mr.inspect)&&Mr.inspect!==xt.inspect&&!(Mr.constructor&&Mr.constructor.prototype===Mr)){var Br=Mr.inspect(Gr,Rr);return Ar(Br)||(Br=rr(Rr,Br,Gr)),Br}var Cr=nr(Rr,Mr);if(Cr)return Cr;var jr=Object.keys(Mr),Yr=zt(jr);if(Rr.showHidden&&(jr=Object.getOwnPropertyNames(Mr)),Sr(Mr)&&(jr.indexOf("message")>=0||jr.indexOf("description")>=0))return ir(Mr);if(jr.length===0){if(_r(Mr)){var Qr=Mr.name?": "+Mr.name:"";return Rr.stylize("[Function"+Qr+"]","special")}if(Ur(Mr))return Rr.stylize(RegExp.prototype.toString.call(Mr),"regexp");if(Lr(Mr))return Rr.stylize(Date.prototype.toString.call(Mr),"date");if(Sr(Mr))return ir(Mr)}var Jr="",Wr=!1,Nr=["{","}"];if(fr(Mr)&&(Wr=!0,Nr=["[","]"]),_r(Mr)){var Vr=Mr.name?": "+Mr.name:"";Jr=" [Function"+Vr+"]"}if(Ur(Mr)&&(Jr=" "+RegExp.prototype.toString.call(Mr)),Lr(Mr)&&(Jr=" "+Date.prototype.toUTCString.call(Mr)),Sr(Mr)&&(Jr=" "+ir(Mr)),jr.length===0&&(!Wr||Mr.length==0))return Nr[0]+Jr+Nr[1];if(Gr<0)return Ur(Mr)?Rr.stylize(RegExp.prototype.toString.call(Mr),"regexp"):Rr.stylize("[Object]","special");Rr.seen.push(Mr);var Xr;return Wr?Xr=ar(Rr,Mr,Gr,Yr,jr):Xr=jr.map(function(qr){return dr(Rr,Mr,Gr,Yr,qr,Wr)}),Rr.seen.pop(),ur(Xr,Jr,Nr)}function nr(Rr,Mr){if(kr(Mr))return Rr.stylize("undefined","undefined");if(Ar(Mr)){var Gr="'"+JSON.stringify(Mr).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Rr.stylize(Gr,"string")}if(br(Mr))return Rr.stylize(""+Mr,"number");if(pr(Mr))return Rr.stylize(""+Mr,"boolean");if(lr(Mr))return Rr.stylize("null","null")}function ir(Rr){return"["+Error.prototype.toString.call(Rr)+"]"}function ar(Rr,Mr,Gr,Br,Cr){for(var jr=[],Yr=0,Qr=Mr.length;Yr<Qr;++Yr)$r(Mr,String(Yr))?jr.push(dr(Rr,Mr,Gr,Br,String(Yr),!0)):jr.push("");return Cr.forEach(function(Jr){Jr.match(/^\d+$/)||jr.push(dr(Rr,Mr,Gr,Br,Jr,!0))}),jr}function dr(Rr,Mr,Gr,Br,Cr,jr){var Yr,Qr,Jr;if(Jr=Object.getOwnPropertyDescriptor(Mr,Cr)||{value:Mr[Cr]},Jr.get?Jr.set?Qr=Rr.stylize("[Getter/Setter]","special"):Qr=Rr.stylize("[Getter]","special"):Jr.set&&(Qr=Rr.stylize("[Setter]","special")),$r(Br,Cr)||(Yr="["+Cr+"]"),Qr||(Rr.seen.indexOf(Jr.value)<0?(lr(Gr)?Qr=rr(Rr,Jr.value,null):Qr=rr(Rr,Jr.value,Gr-1),Qr.indexOf(`
`)>-1&&(jr?Qr=Qr.split(`
`).map(function(Wr){return"  "+Wr}).join(`
`).slice(2):Qr=`
`+Qr.split(`
`).map(function(Wr){return"   "+Wr}).join(`
`))):Qr=Rr.stylize("[Circular]","special")),kr(Yr)){if(jr&&Cr.match(/^\d+$/))return Qr;Yr=JSON.stringify(""+Cr),Yr.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Yr=Yr.slice(1,-1),Yr=Rr.stylize(Yr,"name")):(Yr=Yr.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Yr=Rr.stylize(Yr,"string"))}return Yr+": "+Qr}function ur(Rr,Mr,Gr){var Br=Rr.reduce(function(Cr,jr){return jr.indexOf(`
`)>=0,Cr+jr.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Br>60?Gr[0]+(Mr===""?"":Mr+`
 `)+" "+Rr.join(`,
  `)+" "+Gr[1]:Gr[0]+Mr+" "+Rr.join(", ")+" "+Gr[1]}xt.types=types$1;function fr(Rr){return Array.isArray(Rr)}xt.isArray=fr;function pr(Rr){return typeof Rr=="boolean"}xt.isBoolean=pr;function lr(Rr){return Rr===null}xt.isNull=lr;function yr(Rr){return Rr==null}xt.isNullOrUndefined=yr;function br(Rr){return typeof Rr=="number"}xt.isNumber=br;function Ar(Rr){return typeof Rr=="string"}xt.isString=Ar;function Pr(Rr){return typeof Rr=="symbol"}xt.isSymbol=Pr;function kr(Rr){return Rr===void 0}xt.isUndefined=kr;function Ur(Rr){return Hr(Rr)&&wr(Rr)==="[object RegExp]"}xt.isRegExp=Ur,xt.types.isRegExp=Ur;function Hr(Rr){return typeof Rr=="object"&&Rr!==null}xt.isObject=Hr;function Lr(Rr){return Hr(Rr)&&wr(Rr)==="[object Date]"}xt.isDate=Lr,xt.types.isDate=Lr;function Sr(Rr){return Hr(Rr)&&(wr(Rr)==="[object Error]"||Rr instanceof Error)}xt.isError=Sr,xt.types.isNativeError=Sr;function _r(Rr){return typeof Rr=="function"}xt.isFunction=_r;function gr(Rr){return Rr===null||typeof Rr=="boolean"||typeof Rr=="number"||typeof Rr=="string"||typeof Rr=="symbol"||typeof Rr>"u"}xt.isPrimitive=gr,xt.isBuffer=isBufferBrowser;function wr(Rr){return Object.prototype.toString.call(Rr)}function Dr(Rr){return Rr<10?"0"+Rr.toString(10):Rr.toString(10)}var xr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Ir(){var Rr=new Date,Mr=[Dr(Rr.getHours()),Dr(Rr.getMinutes()),Dr(Rr.getSeconds())].join(":");return[Rr.getDate(),xr[Rr.getMonth()],Mr].join(" ")}xt.log=function(){console.log("%s - %s",Ir(),xt.format.apply(xt,arguments))},xt.inherits=inherits_browserExports,xt._extend=function(Rr,Mr){if(!Mr||!Hr(Mr))return Rr;for(var Gr=Object.keys(Mr),Br=Gr.length;Br--;)Rr[Gr[Br]]=Mr[Gr[Br]];return Rr};function $r(Rr,Mr){return Object.prototype.hasOwnProperty.call(Rr,Mr)}var vr=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;xt.promisify=function(Mr){if(typeof Mr!="function")throw new TypeError('The "original" argument must be of type Function');if(vr&&Mr[vr]){var Gr=Mr[vr];if(typeof Gr!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(Gr,vr,{value:Gr,enumerable:!1,writable:!1,configurable:!0}),Gr}function Gr(){for(var Br,Cr,jr=new Promise(function(Jr,Wr){Br=Jr,Cr=Wr}),Yr=[],Qr=0;Qr<arguments.length;Qr++)Yr.push(arguments[Qr]);Yr.push(function(Jr,Wr){Jr?Cr(Jr):Br(Wr)});try{Mr.apply(this,Yr)}catch(Jr){Cr(Jr)}return jr}return Object.setPrototypeOf(Gr,Object.getPrototypeOf(Mr)),vr&&Object.defineProperty(Gr,vr,{value:Gr,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(Gr,At(Mr))},xt.promisify.custom=vr;function Er(Rr,Mr){if(!Rr){var Gr=new Error("Promise was rejected with a falsy value");Gr.reason=Rr,Rr=Gr}return Mr(Rr)}function Tr(Rr){if(typeof Rr!="function")throw new TypeError('The "original" argument must be of type Function');function Mr(){for(var Gr=[],Br=0;Br<arguments.length;Br++)Gr.push(arguments[Br]);var Cr=Gr.pop();if(typeof Cr!="function")throw new TypeError("The last argument must be of type Function");var jr=this,Yr=function(){return Cr.apply(jr,arguments)};Rr.apply(this,Gr).then(function(Qr){process$9.nextTick(Yr.bind(null,null,Qr))},function(Qr){process$9.nextTick(Er.bind(null,Qr,Yr))})}return Object.setPrototypeOf(Mr,Object.getPrototypeOf(Rr)),Object.defineProperties(Mr,At(Rr)),Mr}xt.callbackify=Tr})(util$6);var buffer_list$2,hasRequiredBuffer_list;function requireBuffer_list(){if(hasRequiredBuffer_list)return buffer_list$2;hasRequiredBuffer_list=1;function xt(ar,dr){var ur=Object.keys(ar);if(Object.getOwnPropertySymbols){var fr=Object.getOwnPropertySymbols(ar);dr&&(fr=fr.filter(function(pr){return Object.getOwnPropertyDescriptor(ar,pr).enumerable})),ur.push.apply(ur,fr)}return ur}function e(ar){for(var dr=1;dr<arguments.length;dr++){var ur=arguments[dr]!=null?arguments[dr]:{};dr%2?xt(Object(ur),!0).forEach(function(fr){At(ar,fr,ur[fr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ar,Object.getOwnPropertyDescriptors(ur)):xt(Object(ur)).forEach(function(fr){Object.defineProperty(ar,fr,Object.getOwnPropertyDescriptor(ur,fr))})}return ar}function At(ar,dr,ur){return dr=jt(dr),dr in ar?Object.defineProperty(ar,dr,{value:ur,enumerable:!0,configurable:!0,writable:!0}):ar[dr]=ur,ar}function kt(ar,dr){if(!(ar instanceof dr))throw new TypeError("Cannot call a class as a function")}function Bt(ar,dr){for(var ur=0;ur<dr.length;ur++){var fr=dr[ur];fr.enumerable=fr.enumerable||!1,fr.configurable=!0,"value"in fr&&(fr.writable=!0),Object.defineProperty(ar,jt(fr.key),fr)}}function Nt(ar,dr,ur){return dr&&Bt(ar.prototype,dr),Object.defineProperty(ar,"prototype",{writable:!1}),ar}function jt(ar){var dr=Lt(ar,"string");return typeof dr=="symbol"?dr:String(dr)}function Lt(ar,dr){if(typeof ar!="object"||ar===null)return ar;var ur=ar[Symbol.toPrimitive];if(ur!==void 0){var fr=ur.call(ar,dr||"default");if(typeof fr!="object")return fr;throw new TypeError("@@toPrimitive must return a primitive value.")}return(dr==="string"?String:Number)(ar)}var er=buffer$2,tr=er.Buffer,zt=util$6,rr=zt.inspect,nr=rr&&rr.custom||"inspect";function ir(ar,dr,ur){tr.prototype.copy.call(ar,dr,ur)}return buffer_list$2=function(){function ar(){kt(this,ar),this.head=null,this.tail=null,this.length=0}return Nt(ar,[{key:"push",value:function(ur){var fr={data:ur,next:null};this.length>0?this.tail.next=fr:this.head=fr,this.tail=fr,++this.length}},{key:"unshift",value:function(ur){var fr={data:ur,next:this.head};this.length===0&&(this.tail=fr),this.head=fr,++this.length}},{key:"shift",value:function(){if(this.length!==0){var ur=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,ur}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(ur){if(this.length===0)return"";for(var fr=this.head,pr=""+fr.data;fr=fr.next;)pr+=ur+fr.data;return pr}},{key:"concat",value:function(ur){if(this.length===0)return tr.alloc(0);for(var fr=tr.allocUnsafe(ur>>>0),pr=this.head,lr=0;pr;)ir(pr.data,fr,lr),lr+=pr.data.length,pr=pr.next;return fr}},{key:"consume",value:function(ur,fr){var pr;return ur<this.head.data.length?(pr=this.head.data.slice(0,ur),this.head.data=this.head.data.slice(ur)):ur===this.head.data.length?pr=this.shift():pr=fr?this._getString(ur):this._getBuffer(ur),pr}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(ur){var fr=this.head,pr=1,lr=fr.data;for(ur-=lr.length;fr=fr.next;){var yr=fr.data,br=ur>yr.length?yr.length:ur;if(br===yr.length?lr+=yr:lr+=yr.slice(0,ur),ur-=br,ur===0){br===yr.length?(++pr,fr.next?this.head=fr.next:this.head=this.tail=null):(this.head=fr,fr.data=yr.slice(br));break}++pr}return this.length-=pr,lr}},{key:"_getBuffer",value:function(ur){var fr=tr.allocUnsafe(ur),pr=this.head,lr=1;for(pr.data.copy(fr),ur-=pr.data.length;pr=pr.next;){var yr=pr.data,br=ur>yr.length?yr.length:ur;if(yr.copy(fr,fr.length-ur,0,br),ur-=br,ur===0){br===yr.length?(++lr,pr.next?this.head=pr.next:this.head=this.tail=null):(this.head=pr,pr.data=yr.slice(br));break}++lr}return this.length-=lr,fr}},{key:nr,value:function(ur,fr){return rr(this,e(e({},fr),{},{depth:0,customInspect:!1}))}}]),ar}(),buffer_list$2}function destroy$3(xt,e){var At=this,kt=this._readableState&&this._readableState.destroyed,Bt=this._writableState&&this._writableState.destroyed;return kt||Bt?(e?e(xt):xt&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process$9.nextTick(emitErrorNT$3,this,xt)):process$9.nextTick(emitErrorNT$3,this,xt)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(xt||null,function(Nt){!e&&Nt?At._writableState?At._writableState.errorEmitted?process$9.nextTick(emitCloseNT$2,At):(At._writableState.errorEmitted=!0,process$9.nextTick(emitErrorAndCloseNT,At,Nt)):process$9.nextTick(emitErrorAndCloseNT,At,Nt):e?(process$9.nextTick(emitCloseNT$2,At),e(Nt)):process$9.nextTick(emitCloseNT$2,At)}),this)}function emitErrorAndCloseNT(xt,e){emitErrorNT$3(xt,e),emitCloseNT$2(xt)}function emitCloseNT$2(xt){xt._writableState&&!xt._writableState.emitClose||xt._readableState&&!xt._readableState.emitClose||xt.emit("close")}function undestroy$3(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function emitErrorNT$3(xt,e){xt.emit("error",e)}function errorOrDestroy$2(xt,e){var At=xt._readableState,kt=xt._writableState;At&&At.autoDestroy||kt&&kt.autoDestroy?xt.destroy(e):xt.emit("error",e)}var destroy_1$3={destroy:destroy$3,undestroy:undestroy$3,errorOrDestroy:errorOrDestroy$2},errorsBrowser={};function _inheritsLoose(xt,e){xt.prototype=Object.create(e.prototype),xt.prototype.constructor=xt,xt.__proto__=e}var codes$4={};function createErrorType(xt,e,At){At||(At=Error);function kt(Nt,jt,Lt){return typeof e=="string"?e:e(Nt,jt,Lt)}var Bt=function(Nt){_inheritsLoose(jt,Nt);function jt(Lt,er,tr){return Nt.call(this,kt(Lt,er,tr))||this}return jt}(At);Bt.prototype.name=At.name,Bt.prototype.code=xt,codes$4[xt]=Bt}function oneOf$1(xt,e){if(Array.isArray(xt)){var At=xt.length;return xt=xt.map(function(kt){return String(kt)}),At>2?"one of ".concat(e," ").concat(xt.slice(0,At-1).join(", "),", or ")+xt[At-1]:At===2?"one of ".concat(e," ").concat(xt[0]," or ").concat(xt[1]):"of ".concat(e," ").concat(xt[0])}else return"of ".concat(e," ").concat(String(xt))}function startsWith(xt,e,At){return xt.substr(0,e.length)===e}function endsWith(xt,e,At){return(At===void 0||At>xt.length)&&(At=xt.length),xt.substring(At-e.length,At)===e}function includes(xt,e,At){return typeof At!="number"&&(At=0),At+e.length>xt.length?!1:xt.indexOf(e,At)!==-1}createErrorType("ERR_INVALID_OPT_VALUE",function(xt,e){return'The value "'+e+'" is invalid for option "'+xt+'"'},TypeError);createErrorType("ERR_INVALID_ARG_TYPE",function(xt,e,At){var kt;typeof e=="string"&&startsWith(e,"not ")?(kt="must not be",e=e.replace(/^not /,"")):kt="must be";var Bt;if(endsWith(xt," argument"))Bt="The ".concat(xt," ").concat(kt," ").concat(oneOf$1(e,"type"));else{var Nt=includes(xt,".")?"property":"argument";Bt='The "'.concat(xt,'" ').concat(Nt," ").concat(kt," ").concat(oneOf$1(e,"type"))}return Bt+=". Received type ".concat(typeof At),Bt},TypeError);createErrorType("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");createErrorType("ERR_METHOD_NOT_IMPLEMENTED",function(xt){return"The "+xt+" method is not implemented"});createErrorType("ERR_STREAM_PREMATURE_CLOSE","Premature close");createErrorType("ERR_STREAM_DESTROYED",function(xt){return"Cannot call "+xt+" after a stream was destroyed"});createErrorType("ERR_MULTIPLE_CALLBACK","Callback called multiple times");createErrorType("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");createErrorType("ERR_STREAM_WRITE_AFTER_END","write after end");createErrorType("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);createErrorType("ERR_UNKNOWN_ENCODING",function(xt){return"Unknown encoding: "+xt},TypeError);createErrorType("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");errorsBrowser.codes=codes$4;var ERR_INVALID_OPT_VALUE=errorsBrowser.codes.ERR_INVALID_OPT_VALUE;function highWaterMarkFrom$2(xt,e,At){return xt.highWaterMark!=null?xt.highWaterMark:e?xt[At]:null}function getHighWaterMark$4(xt,e,At,kt){var Bt=highWaterMarkFrom$2(e,kt,At);if(Bt!=null){if(!(isFinite(Bt)&&Math.floor(Bt)===Bt)||Bt<0){var Nt=kt?At:"highWaterMark";throw new ERR_INVALID_OPT_VALUE(Nt,Bt)}return Math.floor(Bt)}return xt.objectMode?16:16*1024}var state$2={getHighWaterMark:getHighWaterMark$4},browser$d=deprecate$1;function deprecate$1(xt,e){if(config$1("noDeprecation"))return xt;var At=!1;function kt(){if(!At){if(config$1("throwDeprecation"))throw new Error(e);config$1("traceDeprecation")?console.trace(e):console.warn(e),At=!0}return xt.apply(this,arguments)}return kt}function config$1(xt){try{if(!globalThis.localStorage)return!1}catch{return!1}var e=globalThis.localStorage[xt];return e==null?!1:String(e).toLowerCase()==="true"}var _stream_writable$1,hasRequired_stream_writable$1;function require_stream_writable$1(){if(hasRequired_stream_writable$1)return _stream_writable$1;hasRequired_stream_writable$1=1,_stream_writable$1=kr;function xt(Br){var Cr=this;this.next=null,this.entry=null,this.finish=function(){Gr(Cr,Br)}}var e;kr.WritableState=Ar;var At={deprecate:browser$d},kt=streamBrowser$1,Bt=buffer$2.Buffer,Nt=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function jt(Br){return Bt.from(Br)}function Lt(Br){return Bt.isBuffer(Br)||Br instanceof Nt}var er=destroy_1$3,tr=state$2,zt=tr.getHighWaterMark,rr=errorsBrowser.codes,nr=rr.ERR_INVALID_ARG_TYPE,ir=rr.ERR_METHOD_NOT_IMPLEMENTED,ar=rr.ERR_MULTIPLE_CALLBACK,dr=rr.ERR_STREAM_CANNOT_PIPE,ur=rr.ERR_STREAM_DESTROYED,fr=rr.ERR_STREAM_NULL_VALUES,pr=rr.ERR_STREAM_WRITE_AFTER_END,lr=rr.ERR_UNKNOWN_ENCODING,yr=er.errorOrDestroy;inherits_browserExports(kr,kt);function br(){}function Ar(Br,Cr,jr){e=e||require_stream_duplex$1(),Br=Br||{},typeof jr!="boolean"&&(jr=Cr instanceof e),this.objectMode=!!Br.objectMode,jr&&(this.objectMode=this.objectMode||!!Br.writableObjectMode),this.highWaterMark=zt(this,Br,"writableHighWaterMark",jr),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Yr=Br.decodeStrings===!1;this.decodeStrings=!Yr,this.defaultEncoding=Br.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Qr){Dr(Cr,Qr)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=Br.emitClose!==!1,this.autoDestroy=!!Br.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new xt(this)}Ar.prototype.getBuffer=function(){for(var Cr=this.bufferedRequest,jr=[];Cr;)jr.push(Cr),Cr=Cr.next;return jr},function(){try{Object.defineProperty(Ar.prototype,"buffer",{get:At.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Pr;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Pr=Function.prototype[Symbol.hasInstance],Object.defineProperty(kr,Symbol.hasInstance,{value:function(Cr){return Pr.call(this,Cr)?!0:this!==kr?!1:Cr&&Cr._writableState instanceof Ar}})):Pr=function(Cr){return Cr instanceof this};function kr(Br){e=e||require_stream_duplex$1();var Cr=this instanceof e;if(!Cr&&!Pr.call(kr,this))return new kr(Br);this._writableState=new Ar(Br,this,Cr),this.writable=!0,Br&&(typeof Br.write=="function"&&(this._write=Br.write),typeof Br.writev=="function"&&(this._writev=Br.writev),typeof Br.destroy=="function"&&(this._destroy=Br.destroy),typeof Br.final=="function"&&(this._final=Br.final)),kt.call(this)}kr.prototype.pipe=function(){yr(this,new dr)};function Ur(Br,Cr){var jr=new pr;yr(Br,jr),process$9.nextTick(Cr,jr)}function Hr(Br,Cr,jr,Yr){var Qr;return jr===null?Qr=new fr:typeof jr!="string"&&!Cr.objectMode&&(Qr=new nr("chunk",["string","Buffer"],jr)),Qr?(yr(Br,Qr),process$9.nextTick(Yr,Qr),!1):!0}kr.prototype.write=function(Br,Cr,jr){var Yr=this._writableState,Qr=!1,Jr=!Yr.objectMode&&Lt(Br);return Jr&&!Bt.isBuffer(Br)&&(Br=jt(Br)),typeof Cr=="function"&&(jr=Cr,Cr=null),Jr?Cr="buffer":Cr||(Cr=Yr.defaultEncoding),typeof jr!="function"&&(jr=br),Yr.ending?Ur(this,jr):(Jr||Hr(this,Yr,Br,jr))&&(Yr.pendingcb++,Qr=Sr(this,Yr,Jr,Br,Cr,jr)),Qr},kr.prototype.cork=function(){this._writableState.corked++},kr.prototype.uncork=function(){var Br=this._writableState;Br.corked&&(Br.corked--,!Br.writing&&!Br.corked&&!Br.bufferProcessing&&Br.bufferedRequest&&$r(this,Br))},kr.prototype.setDefaultEncoding=function(Cr){if(typeof Cr=="string"&&(Cr=Cr.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Cr+"").toLowerCase())>-1))throw new lr(Cr);return this._writableState.defaultEncoding=Cr,this},Object.defineProperty(kr.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function Lr(Br,Cr,jr){return!Br.objectMode&&Br.decodeStrings!==!1&&typeof Cr=="string"&&(Cr=Bt.from(Cr,jr)),Cr}Object.defineProperty(kr.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function Sr(Br,Cr,jr,Yr,Qr,Jr){if(!jr){var Wr=Lr(Cr,Yr,Qr);Yr!==Wr&&(jr=!0,Qr="buffer",Yr=Wr)}var Nr=Cr.objectMode?1:Yr.length;Cr.length+=Nr;var Vr=Cr.length<Cr.highWaterMark;if(Vr||(Cr.needDrain=!0),Cr.writing||Cr.corked){var Xr=Cr.lastBufferedRequest;Cr.lastBufferedRequest={chunk:Yr,encoding:Qr,isBuf:jr,callback:Jr,next:null},Xr?Xr.next=Cr.lastBufferedRequest:Cr.bufferedRequest=Cr.lastBufferedRequest,Cr.bufferedRequestCount+=1}else _r(Br,Cr,!1,Nr,Yr,Qr,Jr);return Vr}function _r(Br,Cr,jr,Yr,Qr,Jr,Wr){Cr.writelen=Yr,Cr.writecb=Wr,Cr.writing=!0,Cr.sync=!0,Cr.destroyed?Cr.onwrite(new ur("write")):jr?Br._writev(Qr,Cr.onwrite):Br._write(Qr,Jr,Cr.onwrite),Cr.sync=!1}function gr(Br,Cr,jr,Yr,Qr){--Cr.pendingcb,jr?(process$9.nextTick(Qr,Yr),process$9.nextTick(Rr,Br,Cr),Br._writableState.errorEmitted=!0,yr(Br,Yr)):(Qr(Yr),Br._writableState.errorEmitted=!0,yr(Br,Yr),Rr(Br,Cr))}function wr(Br){Br.writing=!1,Br.writecb=null,Br.length-=Br.writelen,Br.writelen=0}function Dr(Br,Cr){var jr=Br._writableState,Yr=jr.sync,Qr=jr.writecb;if(typeof Qr!="function")throw new ar;if(wr(jr),Cr)gr(Br,jr,Yr,Cr,Qr);else{var Jr=vr(jr)||Br.destroyed;!Jr&&!jr.corked&&!jr.bufferProcessing&&jr.bufferedRequest&&$r(Br,jr),Yr?process$9.nextTick(xr,Br,jr,Jr,Qr):xr(Br,jr,Jr,Qr)}}function xr(Br,Cr,jr,Yr){jr||Ir(Br,Cr),Cr.pendingcb--,Yr(),Rr(Br,Cr)}function Ir(Br,Cr){Cr.length===0&&Cr.needDrain&&(Cr.needDrain=!1,Br.emit("drain"))}function $r(Br,Cr){Cr.bufferProcessing=!0;var jr=Cr.bufferedRequest;if(Br._writev&&jr&&jr.next){var Yr=Cr.bufferedRequestCount,Qr=new Array(Yr),Jr=Cr.corkedRequestsFree;Jr.entry=jr;for(var Wr=0,Nr=!0;jr;)Qr[Wr]=jr,jr.isBuf||(Nr=!1),jr=jr.next,Wr+=1;Qr.allBuffers=Nr,_r(Br,Cr,!0,Cr.length,Qr,"",Jr.finish),Cr.pendingcb++,Cr.lastBufferedRequest=null,Jr.next?(Cr.corkedRequestsFree=Jr.next,Jr.next=null):Cr.corkedRequestsFree=new xt(Cr),Cr.bufferedRequestCount=0}else{for(;jr;){var Vr=jr.chunk,Xr=jr.encoding,qr=jr.callback,Or=Cr.objectMode?1:Vr.length;if(_r(Br,Cr,!1,Or,Vr,Xr,qr),jr=jr.next,Cr.bufferedRequestCount--,Cr.writing)break}jr===null&&(Cr.lastBufferedRequest=null)}Cr.bufferedRequest=jr,Cr.bufferProcessing=!1}kr.prototype._write=function(Br,Cr,jr){jr(new ir("_write()"))},kr.prototype._writev=null,kr.prototype.end=function(Br,Cr,jr){var Yr=this._writableState;return typeof Br=="function"?(jr=Br,Br=null,Cr=null):typeof Cr=="function"&&(jr=Cr,Cr=null),Br!=null&&this.write(Br,Cr),Yr.corked&&(Yr.corked=1,this.uncork()),Yr.ending||Mr(this,Yr,jr),this},Object.defineProperty(kr.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function vr(Br){return Br.ending&&Br.length===0&&Br.bufferedRequest===null&&!Br.finished&&!Br.writing}function Er(Br,Cr){Br._final(function(jr){Cr.pendingcb--,jr&&yr(Br,jr),Cr.prefinished=!0,Br.emit("prefinish"),Rr(Br,Cr)})}function Tr(Br,Cr){!Cr.prefinished&&!Cr.finalCalled&&(typeof Br._final=="function"&&!Cr.destroyed?(Cr.pendingcb++,Cr.finalCalled=!0,process$9.nextTick(Er,Br,Cr)):(Cr.prefinished=!0,Br.emit("prefinish")))}function Rr(Br,Cr){var jr=vr(Cr);if(jr&&(Tr(Br,Cr),Cr.pendingcb===0&&(Cr.finished=!0,Br.emit("finish"),Cr.autoDestroy))){var Yr=Br._readableState;(!Yr||Yr.autoDestroy&&Yr.endEmitted)&&Br.destroy()}return jr}function Mr(Br,Cr,jr){Cr.ending=!0,Rr(Br,Cr),jr&&(Cr.finished?process$9.nextTick(jr):Br.once("finish",jr)),Cr.ended=!0,Br.writable=!1}function Gr(Br,Cr,jr){var Yr=Br.entry;for(Br.entry=null;Yr;){var Qr=Yr.callback;Cr.pendingcb--,Qr(jr),Yr=Yr.next}Cr.corkedRequestsFree.next=Br}return Object.defineProperty(kr.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(Cr){this._writableState&&(this._writableState.destroyed=Cr)}}),kr.prototype.destroy=er.destroy,kr.prototype._undestroy=er.undestroy,kr.prototype._destroy=function(Br,Cr){Cr(Br)},_stream_writable$1}var _stream_duplex$1,hasRequired_stream_duplex$1;function require_stream_duplex$1(){if(hasRequired_stream_duplex$1)return _stream_duplex$1;hasRequired_stream_duplex$1=1;var xt=Object.keys||function(tr){var zt=[];for(var rr in tr)zt.push(rr);return zt};_stream_duplex$1=jt;var e=require_stream_readable$1(),At=require_stream_writable$1();inherits_browserExports(jt,e);for(var kt=xt(At.prototype),Bt=0;Bt<kt.length;Bt++){var Nt=kt[Bt];jt.prototype[Nt]||(jt.prototype[Nt]=At.prototype[Nt])}function jt(tr){if(!(this instanceof jt))return new jt(tr);e.call(this,tr),At.call(this,tr),this.allowHalfOpen=!0,tr&&(tr.readable===!1&&(this.readable=!1),tr.writable===!1&&(this.writable=!1),tr.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",Lt)))}Object.defineProperty(jt.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(jt.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(jt.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Lt(){this._writableState.ended||process$9.nextTick(er,this)}function er(tr){tr.end()}return Object.defineProperty(jt.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(zt){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=zt,this._writableState.destroyed=zt)}}),_stream_duplex$1}var string_decoder={},Buffer$F=safeBufferExports$1.Buffer,isEncoding=Buffer$F.isEncoding||function(xt){switch(xt=""+xt,xt&&xt.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function _normalizeEncoding(xt){if(!xt)return"utf8";for(var e;;)switch(xt){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return xt;default:if(e)return;xt=(""+xt).toLowerCase(),e=!0}}function normalizeEncoding$2(xt){var e=_normalizeEncoding(xt);if(typeof e!="string"&&(Buffer$F.isEncoding===isEncoding||!isEncoding(xt)))throw new Error("Unknown encoding: "+xt);return e||xt}string_decoder.StringDecoder=StringDecoder$1;function StringDecoder$1(xt){this.encoding=normalizeEncoding$2(xt);var e;switch(this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,e=4;break;case"utf8":this.fillLast=utf8FillLast,e=4;break;case"base64":this.text=base64Text,this.end=base64End,e=3;break;default:this.write=simpleWrite,this.end=simpleEnd;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer$F.allocUnsafe(e)}StringDecoder$1.prototype.write=function(xt){if(xt.length===0)return"";var e,At;if(this.lastNeed){if(e=this.fillLast(xt),e===void 0)return"";At=this.lastNeed,this.lastNeed=0}else At=0;return At<xt.length?e?e+this.text(xt,At):this.text(xt,At):e||""};StringDecoder$1.prototype.end=utf8End;StringDecoder$1.prototype.text=utf8Text;StringDecoder$1.prototype.fillLast=function(xt){if(this.lastNeed<=xt.length)return xt.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);xt.copy(this.lastChar,this.lastTotal-this.lastNeed,0,xt.length),this.lastNeed-=xt.length};function utf8CheckByte(xt){return xt<=127?0:xt>>5===6?2:xt>>4===14?3:xt>>3===30?4:xt>>6===2?-1:-2}function utf8CheckIncomplete(xt,e,At){var kt=e.length-1;if(kt<At)return 0;var Bt=utf8CheckByte(e[kt]);return Bt>=0?(Bt>0&&(xt.lastNeed=Bt-1),Bt):--kt<At||Bt===-2?0:(Bt=utf8CheckByte(e[kt]),Bt>=0?(Bt>0&&(xt.lastNeed=Bt-2),Bt):--kt<At||Bt===-2?0:(Bt=utf8CheckByte(e[kt]),Bt>=0?(Bt>0&&(Bt===2?Bt=0:xt.lastNeed=Bt-3),Bt):0))}function utf8CheckExtraBytes(xt,e,At){if((e[0]&192)!==128)return xt.lastNeed=0,"�";if(xt.lastNeed>1&&e.length>1){if((e[1]&192)!==128)return xt.lastNeed=1,"�";if(xt.lastNeed>2&&e.length>2&&(e[2]&192)!==128)return xt.lastNeed=2,"�"}}function utf8FillLast(xt){var e=this.lastTotal-this.lastNeed,At=utf8CheckExtraBytes(this,xt);if(At!==void 0)return At;if(this.lastNeed<=xt.length)return xt.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);xt.copy(this.lastChar,e,0,xt.length),this.lastNeed-=xt.length}function utf8Text(xt,e){var At=utf8CheckIncomplete(this,xt,e);if(!this.lastNeed)return xt.toString("utf8",e);this.lastTotal=At;var kt=xt.length-(At-this.lastNeed);return xt.copy(this.lastChar,0,kt),xt.toString("utf8",e,kt)}function utf8End(xt){var e=xt&&xt.length?this.write(xt):"";return this.lastNeed?e+"�":e}function utf16Text(xt,e){if((xt.length-e)%2===0){var At=xt.toString("utf16le",e);if(At){var kt=At.charCodeAt(At.length-1);if(kt>=55296&&kt<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=xt[xt.length-2],this.lastChar[1]=xt[xt.length-1],At.slice(0,-1)}return At}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=xt[xt.length-1],xt.toString("utf16le",e,xt.length-1)}function utf16End(xt){var e=xt&&xt.length?this.write(xt):"";if(this.lastNeed){var At=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,At)}return e}function base64Text(xt,e){var At=(xt.length-e)%3;return At===0?xt.toString("base64",e):(this.lastNeed=3-At,this.lastTotal=3,At===1?this.lastChar[0]=xt[xt.length-1]:(this.lastChar[0]=xt[xt.length-2],this.lastChar[1]=xt[xt.length-1]),xt.toString("base64",e,xt.length-At))}function base64End(xt){var e=xt&&xt.length?this.write(xt):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function simpleWrite(xt){return xt.toString(this.encoding)}function simpleEnd(xt){return xt&&xt.length?this.write(xt):""}var ERR_STREAM_PREMATURE_CLOSE$4=errorsBrowser.codes.ERR_STREAM_PREMATURE_CLOSE;function once$5(xt){var e=!1;return function(){if(!e){e=!0;for(var At=arguments.length,kt=new Array(At),Bt=0;Bt<At;Bt++)kt[Bt]=arguments[Bt];xt.apply(this,kt)}}}function noop$3(){}function isRequest$5(xt){return xt.setHeader&&typeof xt.abort=="function"}function eos$7(xt,e,At){if(typeof e=="function")return eos$7(xt,null,e);e||(e={}),At=once$5(At||noop$3);var kt=e.readable||e.readable!==!1&&xt.readable,Bt=e.writable||e.writable!==!1&&xt.writable,Nt=function(){xt.writable||Lt()},jt=xt._writableState&&xt._writableState.finished,Lt=function(){Bt=!1,jt=!0,kt||At.call(xt)},er=xt._readableState&&xt._readableState.endEmitted,tr=function(){kt=!1,er=!0,Bt||At.call(xt)},zt=function(ar){At.call(xt,ar)},rr=function(){var ar;if(kt&&!er)return(!xt._readableState||!xt._readableState.ended)&&(ar=new ERR_STREAM_PREMATURE_CLOSE$4),At.call(xt,ar);if(Bt&&!jt)return(!xt._writableState||!xt._writableState.ended)&&(ar=new ERR_STREAM_PREMATURE_CLOSE$4),At.call(xt,ar)},nr=function(){xt.req.on("finish",Lt)};return isRequest$5(xt)?(xt.on("complete",Lt),xt.on("abort",rr),xt.req?nr():xt.on("request",nr)):Bt&&!xt._writableState&&(xt.on("end",Nt),xt.on("close",Nt)),xt.on("end",tr),xt.on("finish",Lt),e.error!==!1&&xt.on("error",zt),xt.on("close",rr),function(){xt.removeListener("complete",Lt),xt.removeListener("abort",rr),xt.removeListener("request",nr),xt.req&&xt.req.removeListener("finish",Lt),xt.removeListener("end",Nt),xt.removeListener("close",Nt),xt.removeListener("finish",Lt),xt.removeListener("end",tr),xt.removeListener("error",zt),xt.removeListener("close",rr)}}var endOfStream$2=eos$7,async_iterator,hasRequiredAsync_iterator;function requireAsync_iterator(){if(hasRequiredAsync_iterator)return async_iterator;hasRequiredAsync_iterator=1;var xt;function e(lr,yr,br){return yr=At(yr),yr in lr?Object.defineProperty(lr,yr,{value:br,enumerable:!0,configurable:!0,writable:!0}):lr[yr]=br,lr}function At(lr){var yr=kt(lr,"string");return typeof yr=="symbol"?yr:String(yr)}function kt(lr,yr){if(typeof lr!="object"||lr===null)return lr;var br=lr[Symbol.toPrimitive];if(br!==void 0){var Ar=br.call(lr,yr||"default");if(typeof Ar!="object")return Ar;throw new TypeError("@@toPrimitive must return a primitive value.")}return(yr==="string"?String:Number)(lr)}var Bt=endOfStream$2,Nt=Symbol("lastResolve"),jt=Symbol("lastReject"),Lt=Symbol("error"),er=Symbol("ended"),tr=Symbol("lastPromise"),zt=Symbol("handlePromise"),rr=Symbol("stream");function nr(lr,yr){return{value:lr,done:yr}}function ir(lr){var yr=lr[Nt];if(yr!==null){var br=lr[rr].read();br!==null&&(lr[tr]=null,lr[Nt]=null,lr[jt]=null,yr(nr(br,!1)))}}function ar(lr){process$9.nextTick(ir,lr)}function dr(lr,yr){return function(br,Ar){lr.then(function(){if(yr[er]){br(nr(void 0,!0));return}yr[zt](br,Ar)},Ar)}}var ur=Object.getPrototypeOf(function(){}),fr=Object.setPrototypeOf((xt={get stream(){return this[rr]},next:function(){var yr=this,br=this[Lt];if(br!==null)return Promise.reject(br);if(this[er])return Promise.resolve(nr(void 0,!0));if(this[rr].destroyed)return new Promise(function(Ur,Hr){process$9.nextTick(function(){yr[Lt]?Hr(yr[Lt]):Ur(nr(void 0,!0))})});var Ar=this[tr],Pr;if(Ar)Pr=new Promise(dr(Ar,this));else{var kr=this[rr].read();if(kr!==null)return Promise.resolve(nr(kr,!1));Pr=new Promise(this[zt])}return this[tr]=Pr,Pr}},e(xt,Symbol.asyncIterator,function(){return this}),e(xt,"return",function(){var yr=this;return new Promise(function(br,Ar){yr[rr].destroy(null,function(Pr){if(Pr){Ar(Pr);return}br(nr(void 0,!0))})})}),xt),ur),pr=function(yr){var br,Ar=Object.create(fr,(br={},e(br,rr,{value:yr,writable:!0}),e(br,Nt,{value:null,writable:!0}),e(br,jt,{value:null,writable:!0}),e(br,Lt,{value:null,writable:!0}),e(br,er,{value:yr._readableState.endEmitted,writable:!0}),e(br,zt,{value:function(kr,Ur){var Hr=Ar[rr].read();Hr?(Ar[tr]=null,Ar[Nt]=null,Ar[jt]=null,kr(nr(Hr,!1))):(Ar[Nt]=kr,Ar[jt]=Ur)},writable:!0}),br));return Ar[tr]=null,Bt(yr,function(Pr){if(Pr&&Pr.code!=="ERR_STREAM_PREMATURE_CLOSE"){var kr=Ar[jt];kr!==null&&(Ar[tr]=null,Ar[Nt]=null,Ar[jt]=null,kr(Pr)),Ar[Lt]=Pr;return}var Ur=Ar[Nt];Ur!==null&&(Ar[tr]=null,Ar[Nt]=null,Ar[jt]=null,Ur(nr(void 0,!0))),Ar[er]=!0}),yr.on("readable",ar.bind(null,Ar)),Ar};return async_iterator=pr,async_iterator}var fromBrowser,hasRequiredFromBrowser;function requireFromBrowser(){return hasRequiredFromBrowser||(hasRequiredFromBrowser=1,fromBrowser=function(){throw new Error("Readable.from is not available in the browser")}),fromBrowser}var _stream_readable$1,hasRequired_stream_readable$1;function require_stream_readable$1(){if(hasRequired_stream_readable$1)return _stream_readable$1;hasRequired_stream_readable$1=1,_stream_readable$1=Ur;var xt;Ur.ReadableState=kr,eventsExports.EventEmitter;var e=function(Wr,Nr){return Wr.listeners(Nr).length},At=streamBrowser$1,kt=buffer$2.Buffer,Bt=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function Nt(Jr){return kt.from(Jr)}function jt(Jr){return kt.isBuffer(Jr)||Jr instanceof Bt}var Lt=util$6,er;Lt&&Lt.debuglog?er=Lt.debuglog("stream"):er=function(){};var tr=requireBuffer_list(),zt=destroy_1$3,rr=state$2,nr=rr.getHighWaterMark,ir=errorsBrowser.codes,ar=ir.ERR_INVALID_ARG_TYPE,dr=ir.ERR_STREAM_PUSH_AFTER_EOF,ur=ir.ERR_METHOD_NOT_IMPLEMENTED,fr=ir.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,pr,lr,yr;inherits_browserExports(Ur,At);var br=zt.errorOrDestroy,Ar=["error","close","destroy","pause","resume"];function Pr(Jr,Wr,Nr){if(typeof Jr.prependListener=="function")return Jr.prependListener(Wr,Nr);!Jr._events||!Jr._events[Wr]?Jr.on(Wr,Nr):Array.isArray(Jr._events[Wr])?Jr._events[Wr].unshift(Nr):Jr._events[Wr]=[Nr,Jr._events[Wr]]}function kr(Jr,Wr,Nr){xt=xt||require_stream_duplex$1(),Jr=Jr||{},typeof Nr!="boolean"&&(Nr=Wr instanceof xt),this.objectMode=!!Jr.objectMode,Nr&&(this.objectMode=this.objectMode||!!Jr.readableObjectMode),this.highWaterMark=nr(this,Jr,"readableHighWaterMark",Nr),this.buffer=new tr,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=Jr.emitClose!==!1,this.autoDestroy=!!Jr.autoDestroy,this.destroyed=!1,this.defaultEncoding=Jr.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Jr.encoding&&(pr||(pr=string_decoder.StringDecoder),this.decoder=new pr(Jr.encoding),this.encoding=Jr.encoding)}function Ur(Jr){if(xt=xt||require_stream_duplex$1(),!(this instanceof Ur))return new Ur(Jr);var Wr=this instanceof xt;this._readableState=new kr(Jr,this,Wr),this.readable=!0,Jr&&(typeof Jr.read=="function"&&(this._read=Jr.read),typeof Jr.destroy=="function"&&(this._destroy=Jr.destroy)),At.call(this)}Object.defineProperty(Ur.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(Wr){this._readableState&&(this._readableState.destroyed=Wr)}}),Ur.prototype.destroy=zt.destroy,Ur.prototype._undestroy=zt.undestroy,Ur.prototype._destroy=function(Jr,Wr){Wr(Jr)},Ur.prototype.push=function(Jr,Wr){var Nr=this._readableState,Vr;return Nr.objectMode?Vr=!0:typeof Jr=="string"&&(Wr=Wr||Nr.defaultEncoding,Wr!==Nr.encoding&&(Jr=kt.from(Jr,Wr),Wr=""),Vr=!0),Hr(this,Jr,Wr,!1,Vr)},Ur.prototype.unshift=function(Jr){return Hr(this,Jr,null,!0,!1)};function Hr(Jr,Wr,Nr,Vr,Xr){er("readableAddChunk",Wr);var qr=Jr._readableState;if(Wr===null)qr.reading=!1,Dr(Jr,qr);else{var Or;if(Xr||(Or=Sr(qr,Wr)),Or)br(Jr,Or);else if(qr.objectMode||Wr&&Wr.length>0)if(typeof Wr!="string"&&!qr.objectMode&&Object.getPrototypeOf(Wr)!==kt.prototype&&(Wr=Nt(Wr)),Vr)qr.endEmitted?br(Jr,new fr):Lr(Jr,qr,Wr,!0);else if(qr.ended)br(Jr,new dr);else{if(qr.destroyed)return!1;qr.reading=!1,qr.decoder&&!Nr?(Wr=qr.decoder.write(Wr),qr.objectMode||Wr.length!==0?Lr(Jr,qr,Wr,!1):$r(Jr,qr)):Lr(Jr,qr,Wr,!1)}else Vr||(qr.reading=!1,$r(Jr,qr))}return!qr.ended&&(qr.length<qr.highWaterMark||qr.length===0)}function Lr(Jr,Wr,Nr,Vr){Wr.flowing&&Wr.length===0&&!Wr.sync?(Wr.awaitDrain=0,Jr.emit("data",Nr)):(Wr.length+=Wr.objectMode?1:Nr.length,Vr?Wr.buffer.unshift(Nr):Wr.buffer.push(Nr),Wr.needReadable&&xr(Jr)),$r(Jr,Wr)}function Sr(Jr,Wr){var Nr;return!jt(Wr)&&typeof Wr!="string"&&Wr!==void 0&&!Jr.objectMode&&(Nr=new ar("chunk",["string","Buffer","Uint8Array"],Wr)),Nr}Ur.prototype.isPaused=function(){return this._readableState.flowing===!1},Ur.prototype.setEncoding=function(Jr){pr||(pr=string_decoder.StringDecoder);var Wr=new pr(Jr);this._readableState.decoder=Wr,this._readableState.encoding=this._readableState.decoder.encoding;for(var Nr=this._readableState.buffer.head,Vr="";Nr!==null;)Vr+=Wr.write(Nr.data),Nr=Nr.next;return this._readableState.buffer.clear(),Vr!==""&&this._readableState.buffer.push(Vr),this._readableState.length=Vr.length,this};var _r=1073741824;function gr(Jr){return Jr>=_r?Jr=_r:(Jr--,Jr|=Jr>>>1,Jr|=Jr>>>2,Jr|=Jr>>>4,Jr|=Jr>>>8,Jr|=Jr>>>16,Jr++),Jr}function wr(Jr,Wr){return Jr<=0||Wr.length===0&&Wr.ended?0:Wr.objectMode?1:Jr!==Jr?Wr.flowing&&Wr.length?Wr.buffer.head.data.length:Wr.length:(Jr>Wr.highWaterMark&&(Wr.highWaterMark=gr(Jr)),Jr<=Wr.length?Jr:Wr.ended?Wr.length:(Wr.needReadable=!0,0))}Ur.prototype.read=function(Jr){er("read",Jr),Jr=parseInt(Jr,10);var Wr=this._readableState,Nr=Jr;if(Jr!==0&&(Wr.emittedReadable=!1),Jr===0&&Wr.needReadable&&((Wr.highWaterMark!==0?Wr.length>=Wr.highWaterMark:Wr.length>0)||Wr.ended))return er("read: emitReadable",Wr.length,Wr.ended),Wr.length===0&&Wr.ended?jr(this):xr(this),null;if(Jr=wr(Jr,Wr),Jr===0&&Wr.ended)return Wr.length===0&&jr(this),null;var Vr=Wr.needReadable;er("need readable",Vr),(Wr.length===0||Wr.length-Jr<Wr.highWaterMark)&&(Vr=!0,er("length less than watermark",Vr)),Wr.ended||Wr.reading?(Vr=!1,er("reading or ended",Vr)):Vr&&(er("do read"),Wr.reading=!0,Wr.sync=!0,Wr.length===0&&(Wr.needReadable=!0),this._read(Wr.highWaterMark),Wr.sync=!1,Wr.reading||(Jr=wr(Nr,Wr)));var Xr;return Jr>0?Xr=Cr(Jr,Wr):Xr=null,Xr===null?(Wr.needReadable=Wr.length<=Wr.highWaterMark,Jr=0):(Wr.length-=Jr,Wr.awaitDrain=0),Wr.length===0&&(Wr.ended||(Wr.needReadable=!0),Nr!==Jr&&Wr.ended&&jr(this)),Xr!==null&&this.emit("data",Xr),Xr};function Dr(Jr,Wr){if(er("onEofChunk"),!Wr.ended){if(Wr.decoder){var Nr=Wr.decoder.end();Nr&&Nr.length&&(Wr.buffer.push(Nr),Wr.length+=Wr.objectMode?1:Nr.length)}Wr.ended=!0,Wr.sync?xr(Jr):(Wr.needReadable=!1,Wr.emittedReadable||(Wr.emittedReadable=!0,Ir(Jr)))}}function xr(Jr){var Wr=Jr._readableState;er("emitReadable",Wr.needReadable,Wr.emittedReadable),Wr.needReadable=!1,Wr.emittedReadable||(er("emitReadable",Wr.flowing),Wr.emittedReadable=!0,process$9.nextTick(Ir,Jr))}function Ir(Jr){var Wr=Jr._readableState;er("emitReadable_",Wr.destroyed,Wr.length,Wr.ended),!Wr.destroyed&&(Wr.length||Wr.ended)&&(Jr.emit("readable"),Wr.emittedReadable=!1),Wr.needReadable=!Wr.flowing&&!Wr.ended&&Wr.length<=Wr.highWaterMark,Br(Jr)}function $r(Jr,Wr){Wr.readingMore||(Wr.readingMore=!0,process$9.nextTick(vr,Jr,Wr))}function vr(Jr,Wr){for(;!Wr.reading&&!Wr.ended&&(Wr.length<Wr.highWaterMark||Wr.flowing&&Wr.length===0);){var Nr=Wr.length;if(er("maybeReadMore read 0"),Jr.read(0),Nr===Wr.length)break}Wr.readingMore=!1}Ur.prototype._read=function(Jr){br(this,new ur("_read()"))},Ur.prototype.pipe=function(Jr,Wr){var Nr=this,Vr=this._readableState;switch(Vr.pipesCount){case 0:Vr.pipes=Jr;break;case 1:Vr.pipes=[Vr.pipes,Jr];break;default:Vr.pipes.push(Jr);break}Vr.pipesCount+=1,er("pipe count=%d opts=%j",Vr.pipesCount,Wr);var Xr=(!Wr||Wr.end!==!1)&&Jr!==process$9.stdout&&Jr!==process$9.stderr,qr=Xr?Fr:tn;Vr.endEmitted?process$9.nextTick(qr):Nr.once("end",qr),Jr.on("unpipe",Or);function Or(hn,mn){er("onunpipe"),hn===Nr&&mn&&mn.hasUnpiped===!1&&(mn.hasUnpiped=!0,un())}function Fr(){er("onend"),Jr.end()}var Zr=Er(Nr);Jr.on("drain",Zr);var rn=!1;function un(){er("cleanup"),Jr.removeListener("close",$n),Jr.removeListener("finish",en),Jr.removeListener("drain",Zr),Jr.removeListener("error",vn),Jr.removeListener("unpipe",Or),Nr.removeListener("end",Fr),Nr.removeListener("end",tn),Nr.removeListener("data",dn),rn=!0,Vr.awaitDrain&&(!Jr._writableState||Jr._writableState.needDrain)&&Zr()}Nr.on("data",dn);function dn(hn){er("ondata");var mn=Jr.write(hn);er("dest.write",mn),mn===!1&&((Vr.pipesCount===1&&Vr.pipes===Jr||Vr.pipesCount>1&&Qr(Vr.pipes,Jr)!==-1)&&!rn&&(er("false write response, pause",Vr.awaitDrain),Vr.awaitDrain++),Nr.pause())}function vn(hn){er("onerror",hn),tn(),Jr.removeListener("error",vn),e(Jr,"error")===0&&br(Jr,hn)}Pr(Jr,"error",vn);function $n(){Jr.removeListener("finish",en),tn()}Jr.once("close",$n);function en(){er("onfinish"),Jr.removeListener("close",$n),tn()}Jr.once("finish",en);function tn(){er("unpipe"),Nr.unpipe(Jr)}return Jr.emit("pipe",Nr),Vr.flowing||(er("pipe resume"),Nr.resume()),Jr};function Er(Jr){return function(){var Nr=Jr._readableState;er("pipeOnDrain",Nr.awaitDrain),Nr.awaitDrain&&Nr.awaitDrain--,Nr.awaitDrain===0&&e(Jr,"data")&&(Nr.flowing=!0,Br(Jr))}}Ur.prototype.unpipe=function(Jr){var Wr=this._readableState,Nr={hasUnpiped:!1};if(Wr.pipesCount===0)return this;if(Wr.pipesCount===1)return Jr&&Jr!==Wr.pipes?this:(Jr||(Jr=Wr.pipes),Wr.pipes=null,Wr.pipesCount=0,Wr.flowing=!1,Jr&&Jr.emit("unpipe",this,Nr),this);if(!Jr){var Vr=Wr.pipes,Xr=Wr.pipesCount;Wr.pipes=null,Wr.pipesCount=0,Wr.flowing=!1;for(var qr=0;qr<Xr;qr++)Vr[qr].emit("unpipe",this,{hasUnpiped:!1});return this}var Or=Qr(Wr.pipes,Jr);return Or===-1?this:(Wr.pipes.splice(Or,1),Wr.pipesCount-=1,Wr.pipesCount===1&&(Wr.pipes=Wr.pipes[0]),Jr.emit("unpipe",this,Nr),this)},Ur.prototype.on=function(Jr,Wr){var Nr=At.prototype.on.call(this,Jr,Wr),Vr=this._readableState;return Jr==="data"?(Vr.readableListening=this.listenerCount("readable")>0,Vr.flowing!==!1&&this.resume()):Jr==="readable"&&!Vr.endEmitted&&!Vr.readableListening&&(Vr.readableListening=Vr.needReadable=!0,Vr.flowing=!1,Vr.emittedReadable=!1,er("on readable",Vr.length,Vr.reading),Vr.length?xr(this):Vr.reading||process$9.nextTick(Rr,this)),Nr},Ur.prototype.addListener=Ur.prototype.on,Ur.prototype.removeListener=function(Jr,Wr){var Nr=At.prototype.removeListener.call(this,Jr,Wr);return Jr==="readable"&&process$9.nextTick(Tr,this),Nr},Ur.prototype.removeAllListeners=function(Jr){var Wr=At.prototype.removeAllListeners.apply(this,arguments);return(Jr==="readable"||Jr===void 0)&&process$9.nextTick(Tr,this),Wr};function Tr(Jr){var Wr=Jr._readableState;Wr.readableListening=Jr.listenerCount("readable")>0,Wr.resumeScheduled&&!Wr.paused?Wr.flowing=!0:Jr.listenerCount("data")>0&&Jr.resume()}function Rr(Jr){er("readable nexttick read 0"),Jr.read(0)}Ur.prototype.resume=function(){var Jr=this._readableState;return Jr.flowing||(er("resume"),Jr.flowing=!Jr.readableListening,Mr(this,Jr)),Jr.paused=!1,this};function Mr(Jr,Wr){Wr.resumeScheduled||(Wr.resumeScheduled=!0,process$9.nextTick(Gr,Jr,Wr))}function Gr(Jr,Wr){er("resume",Wr.reading),Wr.reading||Jr.read(0),Wr.resumeScheduled=!1,Jr.emit("resume"),Br(Jr),Wr.flowing&&!Wr.reading&&Jr.read(0)}Ur.prototype.pause=function(){return er("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(er("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function Br(Jr){var Wr=Jr._readableState;for(er("flow",Wr.flowing);Wr.flowing&&Jr.read()!==null;);}Ur.prototype.wrap=function(Jr){var Wr=this,Nr=this._readableState,Vr=!1;Jr.on("end",function(){if(er("wrapped end"),Nr.decoder&&!Nr.ended){var Or=Nr.decoder.end();Or&&Or.length&&Wr.push(Or)}Wr.push(null)}),Jr.on("data",function(Or){if(er("wrapped data"),Nr.decoder&&(Or=Nr.decoder.write(Or)),!(Nr.objectMode&&Or==null)&&!(!Nr.objectMode&&(!Or||!Or.length))){var Fr=Wr.push(Or);Fr||(Vr=!0,Jr.pause())}});for(var Xr in Jr)this[Xr]===void 0&&typeof Jr[Xr]=="function"&&(this[Xr]=function(Fr){return function(){return Jr[Fr].apply(Jr,arguments)}}(Xr));for(var qr=0;qr<Ar.length;qr++)Jr.on(Ar[qr],this.emit.bind(this,Ar[qr]));return this._read=function(Or){er("wrapped _read",Or),Vr&&(Vr=!1,Jr.resume())},this},typeof Symbol=="function"&&(Ur.prototype[Symbol.asyncIterator]=function(){return lr===void 0&&(lr=requireAsync_iterator()),lr(this)}),Object.defineProperty(Ur.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(Ur.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(Ur.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(Wr){this._readableState&&(this._readableState.flowing=Wr)}}),Ur._fromList=Cr,Object.defineProperty(Ur.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function Cr(Jr,Wr){if(Wr.length===0)return null;var Nr;return Wr.objectMode?Nr=Wr.buffer.shift():!Jr||Jr>=Wr.length?(Wr.decoder?Nr=Wr.buffer.join(""):Wr.buffer.length===1?Nr=Wr.buffer.first():Nr=Wr.buffer.concat(Wr.length),Wr.buffer.clear()):Nr=Wr.buffer.consume(Jr,Wr.decoder),Nr}function jr(Jr){var Wr=Jr._readableState;er("endReadable",Wr.endEmitted),Wr.endEmitted||(Wr.ended=!0,process$9.nextTick(Yr,Wr,Jr))}function Yr(Jr,Wr){if(er("endReadableNT",Jr.endEmitted,Jr.length),!Jr.endEmitted&&Jr.length===0&&(Jr.endEmitted=!0,Wr.readable=!1,Wr.emit("end"),Jr.autoDestroy)){var Nr=Wr._writableState;(!Nr||Nr.autoDestroy&&Nr.finished)&&Wr.destroy()}}typeof Symbol=="function"&&(Ur.from=function(Jr,Wr){return yr===void 0&&(yr=requireFromBrowser()),yr(Ur,Jr,Wr)});function Qr(Jr,Wr){for(var Nr=0,Vr=Jr.length;Nr<Vr;Nr++)if(Jr[Nr]===Wr)return Nr;return-1}return _stream_readable$1}var _stream_transform$1=Transform$d,_require$codes$1=errorsBrowser.codes,ERR_METHOD_NOT_IMPLEMENTED$2=_require$codes$1.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK$2=_require$codes$1.ERR_MULTIPLE_CALLBACK,ERR_TRANSFORM_ALREADY_TRANSFORMING=_require$codes$1.ERR_TRANSFORM_ALREADY_TRANSFORMING,ERR_TRANSFORM_WITH_LENGTH_0=_require$codes$1.ERR_TRANSFORM_WITH_LENGTH_0,Duplex$7=require_stream_duplex$1();inherits_browserExports(Transform$d,Duplex$7);function afterTransform$1(xt,e){var At=this._transformState;At.transforming=!1;var kt=At.writecb;if(kt===null)return this.emit("error",new ERR_MULTIPLE_CALLBACK$2);At.writechunk=null,At.writecb=null,e!=null&&this.push(e),kt(xt);var Bt=this._readableState;Bt.reading=!1,(Bt.needReadable||Bt.length<Bt.highWaterMark)&&this._read(Bt.highWaterMark)}function Transform$d(xt){if(!(this instanceof Transform$d))return new Transform$d(xt);Duplex$7.call(this,xt),this._transformState={afterTransform:afterTransform$1.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,xt&&(typeof xt.transform=="function"&&(this._transform=xt.transform),typeof xt.flush=="function"&&(this._flush=xt.flush)),this.on("prefinish",prefinish$3)}function prefinish$3(){var xt=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(e,At){done$1(xt,e,At)}):done$1(this,null,null)}Transform$d.prototype.push=function(xt,e){return this._transformState.needTransform=!1,Duplex$7.prototype.push.call(this,xt,e)};Transform$d.prototype._transform=function(xt,e,At){At(new ERR_METHOD_NOT_IMPLEMENTED$2("_transform()"))};Transform$d.prototype._write=function(xt,e,At){var kt=this._transformState;if(kt.writecb=At,kt.writechunk=xt,kt.writeencoding=e,!kt.transforming){var Bt=this._readableState;(kt.needTransform||Bt.needReadable||Bt.length<Bt.highWaterMark)&&this._read(Bt.highWaterMark)}};Transform$d.prototype._read=function(xt){var e=this._transformState;e.writechunk!==null&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Transform$d.prototype._destroy=function(xt,e){Duplex$7.prototype._destroy.call(this,xt,function(At){e(At)})};function done$1(xt,e,At){if(e)return xt.emit("error",e);if(At!=null&&xt.push(At),xt._writableState.length)throw new ERR_TRANSFORM_WITH_LENGTH_0;if(xt._transformState.transforming)throw new ERR_TRANSFORM_ALREADY_TRANSFORMING;return xt.push(null)}var _stream_passthrough$1=PassThrough$5,Transform$c=_stream_transform$1;inherits_browserExports(PassThrough$5,Transform$c);function PassThrough$5(xt){if(!(this instanceof PassThrough$5))return new PassThrough$5(xt);Transform$c.call(this,xt)}PassThrough$5.prototype._transform=function(xt,e,At){At(null,xt)};var eos$6;function once$4(xt){var e=!1;return function(){e||(e=!0,xt.apply(void 0,arguments))}}var _require$codes=errorsBrowser.codes,ERR_MISSING_ARGS$6=_require$codes.ERR_MISSING_ARGS,ERR_STREAM_DESTROYED$2=_require$codes.ERR_STREAM_DESTROYED;function noop$2(xt){if(xt)throw xt}function isRequest$4(xt){return xt.setHeader&&typeof xt.abort=="function"}function destroyer$6(xt,e,At,kt){kt=once$4(kt);var Bt=!1;xt.on("close",function(){Bt=!0}),eos$6===void 0&&(eos$6=endOfStream$2),eos$6(xt,{readable:e,writable:At},function(jt){if(jt)return kt(jt);Bt=!0,kt()});var Nt=!1;return function(jt){if(!Bt&&!Nt){if(Nt=!0,isRequest$4(xt))return xt.abort();if(typeof xt.destroy=="function")return xt.destroy();kt(jt||new ERR_STREAM_DESTROYED$2("pipe"))}}}function call(xt){xt()}function pipe$3(xt,e){return xt.pipe(e)}function popCallback$2(xt){return!xt.length||typeof xt[xt.length-1]!="function"?noop$2:xt.pop()}function pipeline$4(){for(var xt=arguments.length,e=new Array(xt),At=0;At<xt;At++)e[At]=arguments[At];var kt=popCallback$2(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new ERR_MISSING_ARGS$6("streams");var Bt,Nt=e.map(function(jt,Lt){var er=Lt<e.length-1,tr=Lt>0;return destroyer$6(jt,er,tr,function(zt){Bt||(Bt=zt),zt&&Nt.forEach(call),!er&&(Nt.forEach(call),kt(Bt))})});return e.reduce(pipe$3)}var pipeline_1$2=pipeline$4;(function(xt,e){e=xt.exports=require_stream_readable$1(),e.Stream=e,e.Readable=e,e.Writable=require_stream_writable$1(),e.Duplex=require_stream_duplex$1(),e.Transform=_stream_transform$1,e.PassThrough=_stream_passthrough$1,e.finished=endOfStream$2,e.pipeline=pipeline_1$2})(readableBrowser$1,readableBrowser$1.exports);var readableBrowserExports$1=readableBrowser$1.exports,Buffer$E=safeBufferExports$1.Buffer,Transform$b=readableBrowserExports$1.Transform,inherits$q=inherits_browserExports;function throwIfNotStringOrBuffer(xt,e){if(!Buffer$E.isBuffer(xt)&&typeof xt!="string")throw new TypeError(e+" must be a string or a buffer")}function HashBase$2(xt){Transform$b.call(this),this._block=Buffer$E.allocUnsafe(xt),this._blockSize=xt,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}inherits$q(HashBase$2,Transform$b);HashBase$2.prototype._transform=function(xt,e,At){var kt=null;try{this.update(xt,e)}catch(Bt){kt=Bt}At(kt)};HashBase$2.prototype._flush=function(xt){var e=null;try{this.push(this.digest())}catch(At){e=At}xt(e)};HashBase$2.prototype.update=function(xt,e){if(throwIfNotStringOrBuffer(xt,"Data"),this._finalized)throw new Error("Digest already called");Buffer$E.isBuffer(xt)||(xt=Buffer$E.from(xt,e));for(var At=this._block,kt=0;this._blockOffset+xt.length-kt>=this._blockSize;){for(var Bt=this._blockOffset;Bt<this._blockSize;)At[Bt++]=xt[kt++];this._update(),this._blockOffset=0}for(;kt<xt.length;)At[this._blockOffset++]=xt[kt++];for(var Nt=0,jt=xt.length*8;jt>0;++Nt)this._length[Nt]+=jt,jt=this._length[Nt]/4294967296|0,jt>0&&(this._length[Nt]-=4294967296*jt);return this};HashBase$2.prototype._update=function(){throw new Error("_update is not implemented")};HashBase$2.prototype.digest=function(xt){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var e=this._digest();xt!==void 0&&(e=e.toString(xt)),this._block.fill(0),this._blockOffset=0;for(var At=0;At<4;++At)this._length[At]=0;return e};HashBase$2.prototype._digest=function(){throw new Error("_digest is not implemented")};var hashBase=HashBase$2,inherits$p=inherits_browserExports,HashBase$1=hashBase,Buffer$D=safeBufferExports$1.Buffer,ARRAY16$1=new Array(16);function MD5$3(){HashBase$1.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}inherits$p(MD5$3,HashBase$1);MD5$3.prototype._update=function(){for(var xt=ARRAY16$1,e=0;e<16;++e)xt[e]=this._block.readInt32LE(e*4);var At=this._a,kt=this._b,Bt=this._c,Nt=this._d;At=fnF(At,kt,Bt,Nt,xt[0],3614090360,7),Nt=fnF(Nt,At,kt,Bt,xt[1],3905402710,12),Bt=fnF(Bt,Nt,At,kt,xt[2],606105819,17),kt=fnF(kt,Bt,Nt,At,xt[3],3250441966,22),At=fnF(At,kt,Bt,Nt,xt[4],4118548399,7),Nt=fnF(Nt,At,kt,Bt,xt[5],1200080426,12),Bt=fnF(Bt,Nt,At,kt,xt[6],2821735955,17),kt=fnF(kt,Bt,Nt,At,xt[7],4249261313,22),At=fnF(At,kt,Bt,Nt,xt[8],1770035416,7),Nt=fnF(Nt,At,kt,Bt,xt[9],2336552879,12),Bt=fnF(Bt,Nt,At,kt,xt[10],4294925233,17),kt=fnF(kt,Bt,Nt,At,xt[11],2304563134,22),At=fnF(At,kt,Bt,Nt,xt[12],1804603682,7),Nt=fnF(Nt,At,kt,Bt,xt[13],4254626195,12),Bt=fnF(Bt,Nt,At,kt,xt[14],2792965006,17),kt=fnF(kt,Bt,Nt,At,xt[15],1236535329,22),At=fnG(At,kt,Bt,Nt,xt[1],4129170786,5),Nt=fnG(Nt,At,kt,Bt,xt[6],3225465664,9),Bt=fnG(Bt,Nt,At,kt,xt[11],643717713,14),kt=fnG(kt,Bt,Nt,At,xt[0],3921069994,20),At=fnG(At,kt,Bt,Nt,xt[5],3593408605,5),Nt=fnG(Nt,At,kt,Bt,xt[10],38016083,9),Bt=fnG(Bt,Nt,At,kt,xt[15],3634488961,14),kt=fnG(kt,Bt,Nt,At,xt[4],3889429448,20),At=fnG(At,kt,Bt,Nt,xt[9],568446438,5),Nt=fnG(Nt,At,kt,Bt,xt[14],3275163606,9),Bt=fnG(Bt,Nt,At,kt,xt[3],4107603335,14),kt=fnG(kt,Bt,Nt,At,xt[8],1163531501,20),At=fnG(At,kt,Bt,Nt,xt[13],2850285829,5),Nt=fnG(Nt,At,kt,Bt,xt[2],4243563512,9),Bt=fnG(Bt,Nt,At,kt,xt[7],1735328473,14),kt=fnG(kt,Bt,Nt,At,xt[12],2368359562,20),At=fnH(At,kt,Bt,Nt,xt[5],4294588738,4),Nt=fnH(Nt,At,kt,Bt,xt[8],2272392833,11),Bt=fnH(Bt,Nt,At,kt,xt[11],1839030562,16),kt=fnH(kt,Bt,Nt,At,xt[14],4259657740,23),At=fnH(At,kt,Bt,Nt,xt[1],2763975236,4),Nt=fnH(Nt,At,kt,Bt,xt[4],1272893353,11),Bt=fnH(Bt,Nt,At,kt,xt[7],4139469664,16),kt=fnH(kt,Bt,Nt,At,xt[10],3200236656,23),At=fnH(At,kt,Bt,Nt,xt[13],681279174,4),Nt=fnH(Nt,At,kt,Bt,xt[0],3936430074,11),Bt=fnH(Bt,Nt,At,kt,xt[3],3572445317,16),kt=fnH(kt,Bt,Nt,At,xt[6],76029189,23),At=fnH(At,kt,Bt,Nt,xt[9],3654602809,4),Nt=fnH(Nt,At,kt,Bt,xt[12],3873151461,11),Bt=fnH(Bt,Nt,At,kt,xt[15],530742520,16),kt=fnH(kt,Bt,Nt,At,xt[2],3299628645,23),At=fnI(At,kt,Bt,Nt,xt[0],4096336452,6),Nt=fnI(Nt,At,kt,Bt,xt[7],1126891415,10),Bt=fnI(Bt,Nt,At,kt,xt[14],2878612391,15),kt=fnI(kt,Bt,Nt,At,xt[5],4237533241,21),At=fnI(At,kt,Bt,Nt,xt[12],1700485571,6),Nt=fnI(Nt,At,kt,Bt,xt[3],2399980690,10),Bt=fnI(Bt,Nt,At,kt,xt[10],4293915773,15),kt=fnI(kt,Bt,Nt,At,xt[1],2240044497,21),At=fnI(At,kt,Bt,Nt,xt[8],1873313359,6),Nt=fnI(Nt,At,kt,Bt,xt[15],4264355552,10),Bt=fnI(Bt,Nt,At,kt,xt[6],2734768916,15),kt=fnI(kt,Bt,Nt,At,xt[13],1309151649,21),At=fnI(At,kt,Bt,Nt,xt[4],4149444226,6),Nt=fnI(Nt,At,kt,Bt,xt[11],3174756917,10),Bt=fnI(Bt,Nt,At,kt,xt[2],718787259,15),kt=fnI(kt,Bt,Nt,At,xt[9],3951481745,21),this._a=this._a+At|0,this._b=this._b+kt|0,this._c=this._c+Bt|0,this._d=this._d+Nt|0};MD5$3.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var xt=Buffer$D.allocUnsafe(16);return xt.writeInt32LE(this._a,0),xt.writeInt32LE(this._b,4),xt.writeInt32LE(this._c,8),xt.writeInt32LE(this._d,12),xt};function rotl$3(xt,e){return xt<<e|xt>>>32-e}function fnF(xt,e,At,kt,Bt,Nt,jt){return rotl$3(xt+(e&At|~e&kt)+Bt+Nt|0,jt)+e|0}function fnG(xt,e,At,kt,Bt,Nt,jt){return rotl$3(xt+(e&kt|At&~kt)+Bt+Nt|0,jt)+e|0}function fnH(xt,e,At,kt,Bt,Nt,jt){return rotl$3(xt+(e^At^kt)+Bt+Nt|0,jt)+e|0}function fnI(xt,e,At,kt,Bt,Nt,jt){return rotl$3(xt+(At^(e|~kt))+Bt+Nt|0,jt)+e|0}var md5_js=MD5$3,Buffer$C=buffer$2.Buffer,inherits$o=inherits_browserExports,HashBase=hashBase,ARRAY16=new Array(16),zl=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],zr=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],sl=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],sr=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],hl=[0,1518500249,1859775393,2400959708,2840853838],hr=[1352829926,1548603684,1836072691,2053994217,0];function RIPEMD160$5(){HashBase.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}inherits$o(RIPEMD160$5,HashBase);RIPEMD160$5.prototype._update=function(){for(var xt=ARRAY16,e=0;e<16;++e)xt[e]=this._block.readInt32LE(e*4);for(var At=this._a|0,kt=this._b|0,Bt=this._c|0,Nt=this._d|0,jt=this._e|0,Lt=this._a|0,er=this._b|0,tr=this._c|0,zt=this._d|0,rr=this._e|0,nr=0;nr<80;nr+=1){var ir,ar;nr<16?(ir=fn1(At,kt,Bt,Nt,jt,xt[zl[nr]],hl[0],sl[nr]),ar=fn5(Lt,er,tr,zt,rr,xt[zr[nr]],hr[0],sr[nr])):nr<32?(ir=fn2(At,kt,Bt,Nt,jt,xt[zl[nr]],hl[1],sl[nr]),ar=fn4(Lt,er,tr,zt,rr,xt[zr[nr]],hr[1],sr[nr])):nr<48?(ir=fn3(At,kt,Bt,Nt,jt,xt[zl[nr]],hl[2],sl[nr]),ar=fn3(Lt,er,tr,zt,rr,xt[zr[nr]],hr[2],sr[nr])):nr<64?(ir=fn4(At,kt,Bt,Nt,jt,xt[zl[nr]],hl[3],sl[nr]),ar=fn2(Lt,er,tr,zt,rr,xt[zr[nr]],hr[3],sr[nr])):(ir=fn5(At,kt,Bt,Nt,jt,xt[zl[nr]],hl[4],sl[nr]),ar=fn1(Lt,er,tr,zt,rr,xt[zr[nr]],hr[4],sr[nr])),At=jt,jt=Nt,Nt=rotl$2(Bt,10),Bt=kt,kt=ir,Lt=rr,rr=zt,zt=rotl$2(tr,10),tr=er,er=ar}var dr=this._b+Bt+zt|0;this._b=this._c+Nt+rr|0,this._c=this._d+jt+Lt|0,this._d=this._e+At+er|0,this._e=this._a+kt+tr|0,this._a=dr};RIPEMD160$5.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var xt=Buffer$C.alloc?Buffer$C.alloc(20):new Buffer$C(20);return xt.writeInt32LE(this._a,0),xt.writeInt32LE(this._b,4),xt.writeInt32LE(this._c,8),xt.writeInt32LE(this._d,12),xt.writeInt32LE(this._e,16),xt};function rotl$2(xt,e){return xt<<e|xt>>>32-e}function fn1(xt,e,At,kt,Bt,Nt,jt,Lt){return rotl$2(xt+(e^At^kt)+Nt+jt|0,Lt)+Bt|0}function fn2(xt,e,At,kt,Bt,Nt,jt,Lt){return rotl$2(xt+(e&At|~e&kt)+Nt+jt|0,Lt)+Bt|0}function fn3(xt,e,At,kt,Bt,Nt,jt,Lt){return rotl$2(xt+((e|~At)^kt)+Nt+jt|0,Lt)+Bt|0}function fn4(xt,e,At,kt,Bt,Nt,jt,Lt){return rotl$2(xt+(e&kt|At&~kt)+Nt+jt|0,Lt)+Bt|0}function fn5(xt,e,At,kt,Bt,Nt,jt,Lt){return rotl$2(xt+(e^(At|~kt))+Nt+jt|0,Lt)+Bt|0}var ripemd160$1=RIPEMD160$5,sha_js={exports:{}},Buffer$B=safeBufferExports$1.Buffer;function Hash$8(xt,e){this._block=Buffer$B.alloc(xt),this._finalSize=e,this._blockSize=xt,this._len=0}Hash$8.prototype.update=function(xt,e){typeof xt=="string"&&(e=e||"utf8",xt=Buffer$B.from(xt,e));for(var At=this._block,kt=this._blockSize,Bt=xt.length,Nt=this._len,jt=0;jt<Bt;){for(var Lt=Nt%kt,er=Math.min(Bt-jt,kt-Lt),tr=0;tr<er;tr++)At[Lt+tr]=xt[jt+tr];Nt+=er,jt+=er,Nt%kt===0&&this._update(At)}return this._len+=Bt,this};Hash$8.prototype.digest=function(xt){var e=this._len%this._blockSize;this._block[e]=128,this._block.fill(0,e+1),e>=this._finalSize&&(this._update(this._block),this._block.fill(0));var At=this._len*8;if(At<=4294967295)this._block.writeUInt32BE(At,this._blockSize-4);else{var kt=(At&4294967295)>>>0,Bt=(At-kt)/4294967296;this._block.writeUInt32BE(Bt,this._blockSize-8),this._block.writeUInt32BE(kt,this._blockSize-4)}this._update(this._block);var Nt=this._hash();return xt?Nt.toString(xt):Nt};Hash$8.prototype._update=function(){throw new Error("_update must be implemented by subclass")};var hash$6=Hash$8,inherits$n=inherits_browserExports,Hash$7=hash$6,Buffer$A=safeBufferExports$1.Buffer,K$5=[1518500249,1859775393,-1894007588,-899497514],W$6=new Array(80);function Sha(){this.init(),this._w=W$6,Hash$7.call(this,64,56)}inherits$n(Sha,Hash$7);Sha.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function rotl5$1(xt){return xt<<5|xt>>>27}function rotl30$1(xt){return xt<<30|xt>>>2}function ft$2(xt,e,At,kt){return xt===0?e&At|~e&kt:xt===2?e&At|e&kt|At&kt:e^At^kt}Sha.prototype._update=function(xt){for(var e=this._w,At=this._a|0,kt=this._b|0,Bt=this._c|0,Nt=this._d|0,jt=this._e|0,Lt=0;Lt<16;++Lt)e[Lt]=xt.readInt32BE(Lt*4);for(;Lt<80;++Lt)e[Lt]=e[Lt-3]^e[Lt-8]^e[Lt-14]^e[Lt-16];for(var er=0;er<80;++er){var tr=~~(er/20),zt=rotl5$1(At)+ft$2(tr,kt,Bt,Nt)+jt+e[er]+K$5[tr]|0;jt=Nt,Nt=Bt,Bt=rotl30$1(kt),kt=At,At=zt}this._a=At+this._a|0,this._b=kt+this._b|0,this._c=Bt+this._c|0,this._d=Nt+this._d|0,this._e=jt+this._e|0};Sha.prototype._hash=function(){var xt=Buffer$A.allocUnsafe(20);return xt.writeInt32BE(this._a|0,0),xt.writeInt32BE(this._b|0,4),xt.writeInt32BE(this._c|0,8),xt.writeInt32BE(this._d|0,12),xt.writeInt32BE(this._e|0,16),xt};var sha$4=Sha,inherits$m=inherits_browserExports,Hash$6=hash$6,Buffer$z=safeBufferExports$1.Buffer,K$4=[1518500249,1859775393,-1894007588,-899497514],W$5=new Array(80);function Sha1(){this.init(),this._w=W$5,Hash$6.call(this,64,56)}inherits$m(Sha1,Hash$6);Sha1.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this};function rotl1(xt){return xt<<1|xt>>>31}function rotl5(xt){return xt<<5|xt>>>27}function rotl30(xt){return xt<<30|xt>>>2}function ft$1(xt,e,At,kt){return xt===0?e&At|~e&kt:xt===2?e&At|e&kt|At&kt:e^At^kt}Sha1.prototype._update=function(xt){for(var e=this._w,At=this._a|0,kt=this._b|0,Bt=this._c|0,Nt=this._d|0,jt=this._e|0,Lt=0;Lt<16;++Lt)e[Lt]=xt.readInt32BE(Lt*4);for(;Lt<80;++Lt)e[Lt]=rotl1(e[Lt-3]^e[Lt-8]^e[Lt-14]^e[Lt-16]);for(var er=0;er<80;++er){var tr=~~(er/20),zt=rotl5(At)+ft$1(tr,kt,Bt,Nt)+jt+e[er]+K$4[tr]|0;jt=Nt,Nt=Bt,Bt=rotl30(kt),kt=At,At=zt}this._a=At+this._a|0,this._b=kt+this._b|0,this._c=Bt+this._c|0,this._d=Nt+this._d|0,this._e=jt+this._e|0};Sha1.prototype._hash=function(){var xt=Buffer$z.allocUnsafe(20);return xt.writeInt32BE(this._a|0,0),xt.writeInt32BE(this._b|0,4),xt.writeInt32BE(this._c|0,8),xt.writeInt32BE(this._d|0,12),xt.writeInt32BE(this._e|0,16),xt};var sha1=Sha1,inherits$l=inherits_browserExports,Hash$5=hash$6,Buffer$y=safeBufferExports$1.Buffer,K$3=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],W$4=new Array(64);function Sha256$4(){this.init(),this._w=W$4,Hash$5.call(this,64,56)}inherits$l(Sha256$4,Hash$5);Sha256$4.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this};function ch(xt,e,At){return At^xt&(e^At)}function maj$1(xt,e,At){return xt&e|At&(xt|e)}function sigma0$1(xt){return(xt>>>2|xt<<30)^(xt>>>13|xt<<19)^(xt>>>22|xt<<10)}function sigma1$1(xt){return(xt>>>6|xt<<26)^(xt>>>11|xt<<21)^(xt>>>25|xt<<7)}function gamma0(xt){return(xt>>>7|xt<<25)^(xt>>>18|xt<<14)^xt>>>3}function gamma1(xt){return(xt>>>17|xt<<15)^(xt>>>19|xt<<13)^xt>>>10}Sha256$4.prototype._update=function(xt){for(var e=this._w,At=this._a|0,kt=this._b|0,Bt=this._c|0,Nt=this._d|0,jt=this._e|0,Lt=this._f|0,er=this._g|0,tr=this._h|0,zt=0;zt<16;++zt)e[zt]=xt.readInt32BE(zt*4);for(;zt<64;++zt)e[zt]=gamma1(e[zt-2])+e[zt-7]+gamma0(e[zt-15])+e[zt-16]|0;for(var rr=0;rr<64;++rr){var nr=tr+sigma1$1(jt)+ch(jt,Lt,er)+K$3[rr]+e[rr]|0,ir=sigma0$1(At)+maj$1(At,kt,Bt)|0;tr=er,er=Lt,Lt=jt,jt=Nt+nr|0,Nt=Bt,Bt=kt,kt=At,At=nr+ir|0}this._a=At+this._a|0,this._b=kt+this._b|0,this._c=Bt+this._c|0,this._d=Nt+this._d|0,this._e=jt+this._e|0,this._f=Lt+this._f|0,this._g=er+this._g|0,this._h=tr+this._h|0};Sha256$4.prototype._hash=function(){var xt=Buffer$y.allocUnsafe(32);return xt.writeInt32BE(this._a,0),xt.writeInt32BE(this._b,4),xt.writeInt32BE(this._c,8),xt.writeInt32BE(this._d,12),xt.writeInt32BE(this._e,16),xt.writeInt32BE(this._f,20),xt.writeInt32BE(this._g,24),xt.writeInt32BE(this._h,28),xt};var sha256$3=Sha256$4,inherits$k=inherits_browserExports,Sha256$3=sha256$3,Hash$4=hash$6,Buffer$x=safeBufferExports$1.Buffer,W$3=new Array(64);function Sha224(){this.init(),this._w=W$3,Hash$4.call(this,64,56)}inherits$k(Sha224,Sha256$3);Sha224.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this};Sha224.prototype._hash=function(){var xt=Buffer$x.allocUnsafe(28);return xt.writeInt32BE(this._a,0),xt.writeInt32BE(this._b,4),xt.writeInt32BE(this._c,8),xt.writeInt32BE(this._d,12),xt.writeInt32BE(this._e,16),xt.writeInt32BE(this._f,20),xt.writeInt32BE(this._g,24),xt};var sha224$1=Sha224,inherits$j=inherits_browserExports,Hash$3=hash$6,Buffer$w=safeBufferExports$1.Buffer,K$2=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],W$2=new Array(160);function Sha512(){this.init(),this._w=W$2,Hash$3.call(this,128,112)}inherits$j(Sha512,Hash$3);Sha512.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this};function Ch(xt,e,At){return At^xt&(e^At)}function maj(xt,e,At){return xt&e|At&(xt|e)}function sigma0(xt,e){return(xt>>>28|e<<4)^(e>>>2|xt<<30)^(e>>>7|xt<<25)}function sigma1(xt,e){return(xt>>>14|e<<18)^(xt>>>18|e<<14)^(e>>>9|xt<<23)}function Gamma0(xt,e){return(xt>>>1|e<<31)^(xt>>>8|e<<24)^xt>>>7}function Gamma0l(xt,e){return(xt>>>1|e<<31)^(xt>>>8|e<<24)^(xt>>>7|e<<25)}function Gamma1(xt,e){return(xt>>>19|e<<13)^(e>>>29|xt<<3)^xt>>>6}function Gamma1l(xt,e){return(xt>>>19|e<<13)^(e>>>29|xt<<3)^(xt>>>6|e<<26)}function getCarry(xt,e){return xt>>>0<e>>>0?1:0}Sha512.prototype._update=function(xt){for(var e=this._w,At=this._ah|0,kt=this._bh|0,Bt=this._ch|0,Nt=this._dh|0,jt=this._eh|0,Lt=this._fh|0,er=this._gh|0,tr=this._hh|0,zt=this._al|0,rr=this._bl|0,nr=this._cl|0,ir=this._dl|0,ar=this._el|0,dr=this._fl|0,ur=this._gl|0,fr=this._hl|0,pr=0;pr<32;pr+=2)e[pr]=xt.readInt32BE(pr*4),e[pr+1]=xt.readInt32BE(pr*4+4);for(;pr<160;pr+=2){var lr=e[pr-30],yr=e[pr-15*2+1],br=Gamma0(lr,yr),Ar=Gamma0l(yr,lr);lr=e[pr-2*2],yr=e[pr-2*2+1];var Pr=Gamma1(lr,yr),kr=Gamma1l(yr,lr),Ur=e[pr-7*2],Hr=e[pr-7*2+1],Lr=e[pr-16*2],Sr=e[pr-16*2+1],_r=Ar+Hr|0,gr=br+Ur+getCarry(_r,Ar)|0;_r=_r+kr|0,gr=gr+Pr+getCarry(_r,kr)|0,_r=_r+Sr|0,gr=gr+Lr+getCarry(_r,Sr)|0,e[pr]=gr,e[pr+1]=_r}for(var wr=0;wr<160;wr+=2){gr=e[wr],_r=e[wr+1];var Dr=maj(At,kt,Bt),xr=maj(zt,rr,nr),Ir=sigma0(At,zt),$r=sigma0(zt,At),vr=sigma1(jt,ar),Er=sigma1(ar,jt),Tr=K$2[wr],Rr=K$2[wr+1],Mr=Ch(jt,Lt,er),Gr=Ch(ar,dr,ur),Br=fr+Er|0,Cr=tr+vr+getCarry(Br,fr)|0;Br=Br+Gr|0,Cr=Cr+Mr+getCarry(Br,Gr)|0,Br=Br+Rr|0,Cr=Cr+Tr+getCarry(Br,Rr)|0,Br=Br+_r|0,Cr=Cr+gr+getCarry(Br,_r)|0;var jr=$r+xr|0,Yr=Ir+Dr+getCarry(jr,$r)|0;tr=er,fr=ur,er=Lt,ur=dr,Lt=jt,dr=ar,ar=ir+Br|0,jt=Nt+Cr+getCarry(ar,ir)|0,Nt=Bt,ir=nr,Bt=kt,nr=rr,kt=At,rr=zt,zt=Br+jr|0,At=Cr+Yr+getCarry(zt,Br)|0}this._al=this._al+zt|0,this._bl=this._bl+rr|0,this._cl=this._cl+nr|0,this._dl=this._dl+ir|0,this._el=this._el+ar|0,this._fl=this._fl+dr|0,this._gl=this._gl+ur|0,this._hl=this._hl+fr|0,this._ah=this._ah+At+getCarry(this._al,zt)|0,this._bh=this._bh+kt+getCarry(this._bl,rr)|0,this._ch=this._ch+Bt+getCarry(this._cl,nr)|0,this._dh=this._dh+Nt+getCarry(this._dl,ir)|0,this._eh=this._eh+jt+getCarry(this._el,ar)|0,this._fh=this._fh+Lt+getCarry(this._fl,dr)|0,this._gh=this._gh+er+getCarry(this._gl,ur)|0,this._hh=this._hh+tr+getCarry(this._hl,fr)|0};Sha512.prototype._hash=function(){var xt=Buffer$w.allocUnsafe(64);function e(At,kt,Bt){xt.writeInt32BE(At,Bt),xt.writeInt32BE(kt,Bt+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),e(this._gh,this._gl,48),e(this._hh,this._hl,56),xt};var sha512$3=Sha512,inherits$i=inherits_browserExports,SHA512$4=sha512$3,Hash$2=hash$6,Buffer$v=safeBufferExports$1.Buffer,W$1=new Array(160);function Sha384(){this.init(),this._w=W$1,Hash$2.call(this,128,112)}inherits$i(Sha384,SHA512$4);Sha384.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this};Sha384.prototype._hash=function(){var xt=Buffer$v.allocUnsafe(48);function e(At,kt,Bt){xt.writeInt32BE(At,Bt),xt.writeInt32BE(kt,Bt+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),xt};var sha384$1=Sha384,exports=sha_js.exports=function(e){e=e.toLowerCase();var At=exports[e];if(!At)throw new Error(e+" is not supported (we accept pull requests)");return new At};exports.sha=sha$4;exports.sha1=sha1;exports.sha224=sha224$1;exports.sha256=sha256$3;exports.sha384=sha384$1;exports.sha512=sha512$3;var sha_jsExports=sha_js.exports,streamBrowserify=Stream$4,EE$2=eventsExports.EventEmitter,inherits$h=inherits_browserExports;inherits$h(Stream$4,EE$2);Stream$4.Readable=require_stream_readable$1();Stream$4.Writable=require_stream_writable$1();Stream$4.Duplex=require_stream_duplex$1();Stream$4.Transform=_stream_transform$1;Stream$4.PassThrough=_stream_passthrough$1;Stream$4.finished=endOfStream$2;Stream$4.pipeline=pipeline_1$2;Stream$4.Stream=Stream$4;function Stream$4(){EE$2.call(this)}Stream$4.prototype.pipe=function(xt,e){var At=this;function kt(zt){xt.writable&&xt.write(zt)===!1&&At.pause&&At.pause()}At.on("data",kt);function Bt(){At.readable&&At.resume&&At.resume()}xt.on("drain",Bt),!xt._isStdio&&(!e||e.end!==!1)&&(At.on("end",jt),At.on("close",Lt));var Nt=!1;function jt(){Nt||(Nt=!0,xt.end())}function Lt(){Nt||(Nt=!0,typeof xt.destroy=="function"&&xt.destroy())}function er(zt){if(tr(),EE$2.listenerCount(this,"error")===0)throw zt}At.on("error",er),xt.on("error",er);function tr(){At.removeListener("data",kt),xt.removeListener("drain",Bt),At.removeListener("end",jt),At.removeListener("close",Lt),At.removeListener("error",er),xt.removeListener("error",er),At.removeListener("end",tr),At.removeListener("close",tr),xt.removeListener("close",tr)}return At.on("end",tr),At.on("close",tr),xt.on("close",tr),xt.emit("pipe",At),xt};var Buffer$u=safeBufferExports$1.Buffer,Transform$a=streamBrowserify.Transform,StringDecoder=string_decoder.StringDecoder,inherits$g=inherits_browserExports;function CipherBase$1(xt){Transform$a.call(this),this.hashMode=typeof xt=="string",this.hashMode?this[xt]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}inherits$g(CipherBase$1,Transform$a);CipherBase$1.prototype.update=function(xt,e,At){typeof xt=="string"&&(xt=Buffer$u.from(xt,e));var kt=this._update(xt);return this.hashMode?this:(At&&(kt=this._toString(kt,At)),kt)};CipherBase$1.prototype.setAutoPadding=function(){};CipherBase$1.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")};CipherBase$1.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")};CipherBase$1.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")};CipherBase$1.prototype._transform=function(xt,e,At){var kt;try{this.hashMode?this._update(xt):this.push(this._update(xt))}catch(Bt){kt=Bt}finally{At(kt)}};CipherBase$1.prototype._flush=function(xt){var e;try{this.push(this.__final())}catch(At){e=At}xt(e)};CipherBase$1.prototype._finalOrDigest=function(xt){var e=this.__final()||Buffer$u.alloc(0);return xt&&(e=this._toString(e,xt,!0)),e};CipherBase$1.prototype._toString=function(xt,e,At){if(this._decoder||(this._decoder=new StringDecoder(e),this._encoding=e),this._encoding!==e)throw new Error("can't switch encodings");var kt=this._decoder.write(xt);return At&&(kt+=this._decoder.end()),kt};var cipherBase=CipherBase$1,inherits$f=inherits_browserExports,MD5$2=md5_js,RIPEMD160$4=ripemd160$1,sha$3=sha_jsExports,Base$5=cipherBase;function Hash$1(xt){Base$5.call(this,"digest"),this._hash=xt}inherits$f(Hash$1,Base$5);Hash$1.prototype._update=function(xt){this._hash.update(xt)};Hash$1.prototype._final=function(){return this._hash.digest()};var browser$c=function(e){return e=e.toLowerCase(),e==="md5"?new MD5$2:e==="rmd160"||e==="ripemd160"?new RIPEMD160$4:new Hash$1(sha$3(e))},inherits$e=inherits_browserExports,Buffer$t=safeBufferExports$1.Buffer,Base$4=cipherBase,ZEROS$2=Buffer$t.alloc(128),blocksize=64;function Hmac$3(xt,e){Base$4.call(this,"digest"),typeof e=="string"&&(e=Buffer$t.from(e)),this._alg=xt,this._key=e,e.length>blocksize?e=xt(e):e.length<blocksize&&(e=Buffer$t.concat([e,ZEROS$2],blocksize));for(var At=this._ipad=Buffer$t.allocUnsafe(blocksize),kt=this._opad=Buffer$t.allocUnsafe(blocksize),Bt=0;Bt<blocksize;Bt++)At[Bt]=e[Bt]^54,kt[Bt]=e[Bt]^92;this._hash=[At]}inherits$e(Hmac$3,Base$4);Hmac$3.prototype._update=function(xt){this._hash.push(xt)};Hmac$3.prototype._final=function(){var xt=this._alg(Buffer$t.concat(this._hash));return this._alg(Buffer$t.concat([this._opad,xt]))};var legacy$2=Hmac$3,MD5$1=md5_js,md5$2=function(xt){return new MD5$1().update(xt).digest()},inherits$d=inherits_browserExports,Legacy=legacy$2,Base$3=cipherBase,Buffer$s=safeBufferExports$1.Buffer,md5$1=md5$2,RIPEMD160$3=ripemd160$1,sha$2=sha_jsExports,ZEROS$1=Buffer$s.alloc(128);function Hmac$2(xt,e){Base$3.call(this,"digest"),typeof e=="string"&&(e=Buffer$s.from(e));var At=xt==="sha512"||xt==="sha384"?128:64;if(this._alg=xt,this._key=e,e.length>At){var kt=xt==="rmd160"?new RIPEMD160$3:sha$2(xt);e=kt.update(e).digest()}else e.length<At&&(e=Buffer$s.concat([e,ZEROS$1],At));for(var Bt=this._ipad=Buffer$s.allocUnsafe(At),Nt=this._opad=Buffer$s.allocUnsafe(At),jt=0;jt<At;jt++)Bt[jt]=e[jt]^54,Nt[jt]=e[jt]^92;this._hash=xt==="rmd160"?new RIPEMD160$3:sha$2(xt),this._hash.update(Bt)}inherits$d(Hmac$2,Base$3);Hmac$2.prototype._update=function(xt){this._hash.update(xt)};Hmac$2.prototype._final=function(){var xt=this._hash.digest(),e=this._alg==="rmd160"?new RIPEMD160$3:sha$2(this._alg);return e.update(this._opad).update(xt).digest()};var browser$b=function(e,At){return e=e.toLowerCase(),e==="rmd160"||e==="ripemd160"?new Hmac$2("rmd160",At):e==="md5"?new Legacy(md5$1,At):new Hmac$2(e,At)};const sha224WithRSAEncryption={sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption={sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption={sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption={sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},sha256$2={sign:"ecdsa",hash:"sha256",id:""},sha224={sign:"ecdsa",hash:"sha224",id:""},sha384={sign:"ecdsa",hash:"sha384",id:""},sha512$2={sign:"ecdsa",hash:"sha512",id:""},DSA={sign:"dsa",hash:"sha1",id:""},ripemd160WithRSA={sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption={sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},require$$6$1={sha224WithRSAEncryption,"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption,"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption,"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption,"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:sha256$2,sha224,sha384,sha512:sha512$2,"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA,"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA,"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption,"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}};var algos=require$$6$1,browser$a={},MAX_ALLOC=Math.pow(2,30)-1,precondition=function(xt,e){if(typeof xt!="number")throw new TypeError("Iterations not a number");if(xt<0)throw new TypeError("Bad iterations");if(typeof e!="number")throw new TypeError("Key length not a number");if(e<0||e>MAX_ALLOC||e!==e)throw new TypeError("Bad key length")},defaultEncoding$2;if(globalThis.process&&globalThis.process.browser)defaultEncoding$2="utf-8";else if(globalThis.process&&globalThis.process.version){var pVersionMajor=parseInt(process$9.version.split(".")[0].slice(1),10);defaultEncoding$2=pVersionMajor>=6?"utf-8":"binary"}else defaultEncoding$2="utf-8";var defaultEncoding_1=defaultEncoding$2,Buffer$r=safeBufferExports$1.Buffer,toBuffer$2=function(xt,e,At){if(Buffer$r.isBuffer(xt))return xt;if(typeof xt=="string")return Buffer$r.from(xt,e);if(ArrayBuffer.isView(xt))return Buffer$r.from(xt.buffer);throw new TypeError(At+" must be a string, a Buffer, a typed array or a DataView")},md5=md5$2,RIPEMD160$2=ripemd160$1,sha$1=sha_jsExports,Buffer$q=safeBufferExports$1.Buffer,checkParameters$1=precondition,defaultEncoding$1=defaultEncoding_1,toBuffer$1=toBuffer$2,ZEROS=Buffer$q.alloc(128),sizes={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function Hmac$1(xt,e,At){var kt=getDigest(xt),Bt=xt==="sha512"||xt==="sha384"?128:64;e.length>Bt?e=kt(e):e.length<Bt&&(e=Buffer$q.concat([e,ZEROS],Bt));for(var Nt=Buffer$q.allocUnsafe(Bt+sizes[xt]),jt=Buffer$q.allocUnsafe(Bt+sizes[xt]),Lt=0;Lt<Bt;Lt++)Nt[Lt]=e[Lt]^54,jt[Lt]=e[Lt]^92;var er=Buffer$q.allocUnsafe(Bt+At+4);Nt.copy(er,0,0,Bt),this.ipad1=er,this.ipad2=Nt,this.opad=jt,this.alg=xt,this.blocksize=Bt,this.hash=kt,this.size=sizes[xt]}Hmac$1.prototype.run=function(xt,e){xt.copy(e,this.blocksize);var At=this.hash(e);return At.copy(this.opad,this.blocksize),this.hash(this.opad)};function getDigest(xt){function e(kt){return sha$1(xt).update(kt).digest()}function At(kt){return new RIPEMD160$2().update(kt).digest()}return xt==="rmd160"||xt==="ripemd160"?At:xt==="md5"?md5:e}function pbkdf2(xt,e,At,kt,Bt){checkParameters$1(At,kt),xt=toBuffer$1(xt,defaultEncoding$1,"Password"),e=toBuffer$1(e,defaultEncoding$1,"Salt"),Bt=Bt||"sha1";var Nt=new Hmac$1(Bt,xt,e.length),jt=Buffer$q.allocUnsafe(kt),Lt=Buffer$q.allocUnsafe(e.length+4);e.copy(Lt,0,0,e.length);for(var er=0,tr=sizes[Bt],zt=Math.ceil(kt/tr),rr=1;rr<=zt;rr++){Lt.writeUInt32BE(rr,e.length);for(var nr=Nt.run(Lt,Nt.ipad1),ir=nr,ar=1;ar<At;ar++){ir=Nt.run(ir,Nt.ipad2);for(var dr=0;dr<tr;dr++)nr[dr]^=ir[dr]}nr.copy(jt,er),er+=tr}return jt}var syncBrowser=pbkdf2,Buffer$p=safeBufferExports$1.Buffer,checkParameters=precondition,defaultEncoding=defaultEncoding_1,sync=syncBrowser,toBuffer=toBuffer$2,ZERO_BUF,subtle=globalThis.crypto&&globalThis.crypto.subtle,toBrowser={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},checks=[];function checkNative(xt){if(globalThis.process&&!globalThis.process.browser||!subtle||!subtle.importKey||!subtle.deriveBits)return Promise.resolve(!1);if(checks[xt]!==void 0)return checks[xt];ZERO_BUF=ZERO_BUF||Buffer$p.alloc(8);var e=browserPbkdf2(ZERO_BUF,ZERO_BUF,10,128,xt).then(function(){return!0}).catch(function(){return!1});return checks[xt]=e,e}var nextTick$3;function getNextTick(){return nextTick$3||(globalThis.process&&globalThis.process.nextTick?nextTick$3=globalThis.process.nextTick:globalThis.queueMicrotask?nextTick$3=globalThis.queueMicrotask:globalThis.setImmediate?nextTick$3=globalThis.setImmediate:nextTick$3=globalThis.setTimeout,nextTick$3)}function browserPbkdf2(xt,e,At,kt,Bt){return subtle.importKey("raw",xt,{name:"PBKDF2"},!1,["deriveBits"]).then(function(Nt){return subtle.deriveBits({name:"PBKDF2",salt:e,iterations:At,hash:{name:Bt}},Nt,kt<<3)}).then(function(Nt){return Buffer$p.from(Nt)})}function resolvePromise(xt,e){xt.then(function(At){getNextTick()(function(){e(null,At)})},function(At){getNextTick()(function(){e(At)})})}var async=function(xt,e,At,kt,Bt,Nt){typeof Bt=="function"&&(Nt=Bt,Bt=void 0),Bt=Bt||"sha1";var jt=toBrowser[Bt.toLowerCase()];if(!jt||typeof globalThis.Promise!="function"){getNextTick()(function(){var Lt;try{Lt=sync(xt,e,At,kt,Bt)}catch(er){return Nt(er)}Nt(null,Lt)});return}if(checkParameters(At,kt),xt=toBuffer(xt,defaultEncoding,"Password"),e=toBuffer(e,defaultEncoding,"Salt"),typeof Nt!="function")throw new Error("No callback provided to pbkdf2");resolvePromise(checkNative(jt).then(function(Lt){return Lt?browserPbkdf2(xt,e,At,kt,jt):sync(xt,e,At,kt,Bt)}),Nt)};browser$a.pbkdf2=async;browser$a.pbkdf2Sync=syncBrowser;var browser$9={},des$2={},utils$v={};utils$v.readUInt32BE=function(e,At){var kt=e[0+At]<<24|e[1+At]<<16|e[2+At]<<8|e[3+At];return kt>>>0};utils$v.writeUInt32BE=function(e,At,kt){e[0+kt]=At>>>24,e[1+kt]=At>>>16&255,e[2+kt]=At>>>8&255,e[3+kt]=At&255};utils$v.ip=function(e,At,kt,Bt){for(var Nt=0,jt=0,Lt=6;Lt>=0;Lt-=2){for(var er=0;er<=24;er+=8)Nt<<=1,Nt|=At>>>er+Lt&1;for(var er=0;er<=24;er+=8)Nt<<=1,Nt|=e>>>er+Lt&1}for(var Lt=6;Lt>=0;Lt-=2){for(var er=1;er<=25;er+=8)jt<<=1,jt|=At>>>er+Lt&1;for(var er=1;er<=25;er+=8)jt<<=1,jt|=e>>>er+Lt&1}kt[Bt+0]=Nt>>>0,kt[Bt+1]=jt>>>0};utils$v.rip=function(e,At,kt,Bt){for(var Nt=0,jt=0,Lt=0;Lt<4;Lt++)for(var er=24;er>=0;er-=8)Nt<<=1,Nt|=At>>>er+Lt&1,Nt<<=1,Nt|=e>>>er+Lt&1;for(var Lt=4;Lt<8;Lt++)for(var er=24;er>=0;er-=8)jt<<=1,jt|=At>>>er+Lt&1,jt<<=1,jt|=e>>>er+Lt&1;kt[Bt+0]=Nt>>>0,kt[Bt+1]=jt>>>0};utils$v.pc1=function(e,At,kt,Bt){for(var Nt=0,jt=0,Lt=7;Lt>=5;Lt--){for(var er=0;er<=24;er+=8)Nt<<=1,Nt|=At>>er+Lt&1;for(var er=0;er<=24;er+=8)Nt<<=1,Nt|=e>>er+Lt&1}for(var er=0;er<=24;er+=8)Nt<<=1,Nt|=At>>er+Lt&1;for(var Lt=1;Lt<=3;Lt++){for(var er=0;er<=24;er+=8)jt<<=1,jt|=At>>er+Lt&1;for(var er=0;er<=24;er+=8)jt<<=1,jt|=e>>er+Lt&1}for(var er=0;er<=24;er+=8)jt<<=1,jt|=e>>er+Lt&1;kt[Bt+0]=Nt>>>0,kt[Bt+1]=jt>>>0};utils$v.r28shl=function(e,At){return e<<At&268435455|e>>>28-At};var pc2table=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];utils$v.pc2=function(e,At,kt,Bt){for(var Nt=0,jt=0,Lt=pc2table.length>>>1,er=0;er<Lt;er++)Nt<<=1,Nt|=e>>>pc2table[er]&1;for(var er=Lt;er<pc2table.length;er++)jt<<=1,jt|=At>>>pc2table[er]&1;kt[Bt+0]=Nt>>>0,kt[Bt+1]=jt>>>0};utils$v.expand=function(e,At,kt){var Bt=0,Nt=0;Bt=(e&1)<<5|e>>>27;for(var jt=23;jt>=15;jt-=4)Bt<<=6,Bt|=e>>>jt&63;for(var jt=11;jt>=3;jt-=4)Nt|=e>>>jt&63,Nt<<=6;Nt|=(e&31)<<1|e>>>31,At[kt+0]=Bt>>>0,At[kt+1]=Nt>>>0};var sTable=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];utils$v.substitute=function(e,At){for(var kt=0,Bt=0;Bt<4;Bt++){var Nt=e>>>18-Bt*6&63,jt=sTable[Bt*64+Nt];kt<<=4,kt|=jt}for(var Bt=0;Bt<4;Bt++){var Nt=At>>>18-Bt*6&63,jt=sTable[4*64+Bt*64+Nt];kt<<=4,kt|=jt}return kt>>>0};var permuteTable=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];utils$v.permute=function(e){for(var At=0,kt=0;kt<permuteTable.length;kt++)At<<=1,At|=e>>>permuteTable[kt]&1;return At>>>0};utils$v.padSplit=function(e,At,kt){for(var Bt=e.toString(2);Bt.length<At;)Bt="0"+Bt;for(var Nt=[],jt=0;jt<At;jt+=kt)Nt.push(Bt.slice(jt,jt+kt));return Nt.join(" ")};var minimalisticAssert=assert$m;function assert$m(xt,e){if(!xt)throw new Error(e||"Assertion failed")}assert$m.equal=function(e,At,kt){if(e!=At)throw new Error(kt||"Assertion failed: "+e+" != "+At)};var assert$l=minimalisticAssert;function Cipher$3(xt){this.options=xt,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0,this.padding=xt.padding!==!1}var cipher=Cipher$3;Cipher$3.prototype._init=function(){};Cipher$3.prototype.update=function(e){return e.length===0?[]:this.type==="decrypt"?this._updateDecrypt(e):this._updateEncrypt(e)};Cipher$3.prototype._buffer=function(e,At){for(var kt=Math.min(this.buffer.length-this.bufferOff,e.length-At),Bt=0;Bt<kt;Bt++)this.buffer[this.bufferOff+Bt]=e[At+Bt];return this.bufferOff+=kt,kt};Cipher$3.prototype._flushBuffer=function(e,At){return this._update(this.buffer,0,e,At),this.bufferOff=0,this.blockSize};Cipher$3.prototype._updateEncrypt=function(e){var At=0,kt=0,Bt=(this.bufferOff+e.length)/this.blockSize|0,Nt=new Array(Bt*this.blockSize);this.bufferOff!==0&&(At+=this._buffer(e,At),this.bufferOff===this.buffer.length&&(kt+=this._flushBuffer(Nt,kt)));for(var jt=e.length-(e.length-At)%this.blockSize;At<jt;At+=this.blockSize)this._update(e,At,Nt,kt),kt+=this.blockSize;for(;At<e.length;At++,this.bufferOff++)this.buffer[this.bufferOff]=e[At];return Nt};Cipher$3.prototype._updateDecrypt=function(e){for(var At=0,kt=0,Bt=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,Nt=new Array(Bt*this.blockSize);Bt>0;Bt--)At+=this._buffer(e,At),kt+=this._flushBuffer(Nt,kt);return At+=this._buffer(e,At),Nt};Cipher$3.prototype.final=function(e){var At;e&&(At=this.update(e));var kt;return this.type==="encrypt"?kt=this._finalEncrypt():kt=this._finalDecrypt(),At?At.concat(kt):kt};Cipher$3.prototype._pad=function(e,At){if(At===0)return!1;for(;At<e.length;)e[At++]=0;return!0};Cipher$3.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e};Cipher$3.prototype._unpad=function(e){return e};Cipher$3.prototype._finalDecrypt=function(){assert$l.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)};var assert$k=minimalisticAssert,inherits$c=inherits_browserExports,utils$u=utils$v,Cipher$2=cipher;function DESState(){this.tmp=new Array(2),this.keys=null}function DES$3(xt){Cipher$2.call(this,xt);var e=new DESState;this._desState=e,this.deriveKeys(e,xt.key)}inherits$c(DES$3,Cipher$2);var des$1=DES$3;DES$3.create=function(e){return new DES$3(e)};var shiftTable=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];DES$3.prototype.deriveKeys=function(e,At){e.keys=new Array(16*2),assert$k.equal(At.length,this.blockSize,"Invalid key length");var kt=utils$u.readUInt32BE(At,0),Bt=utils$u.readUInt32BE(At,4);utils$u.pc1(kt,Bt,e.tmp,0),kt=e.tmp[0],Bt=e.tmp[1];for(var Nt=0;Nt<e.keys.length;Nt+=2){var jt=shiftTable[Nt>>>1];kt=utils$u.r28shl(kt,jt),Bt=utils$u.r28shl(Bt,jt),utils$u.pc2(kt,Bt,e.keys,Nt)}};DES$3.prototype._update=function(e,At,kt,Bt){var Nt=this._desState,jt=utils$u.readUInt32BE(e,At),Lt=utils$u.readUInt32BE(e,At+4);utils$u.ip(jt,Lt,Nt.tmp,0),jt=Nt.tmp[0],Lt=Nt.tmp[1],this.type==="encrypt"?this._encrypt(Nt,jt,Lt,Nt.tmp,0):this._decrypt(Nt,jt,Lt,Nt.tmp,0),jt=Nt.tmp[0],Lt=Nt.tmp[1],utils$u.writeUInt32BE(kt,jt,Bt),utils$u.writeUInt32BE(kt,Lt,Bt+4)};DES$3.prototype._pad=function(e,At){if(this.padding===!1)return!1;for(var kt=e.length-At,Bt=At;Bt<e.length;Bt++)e[Bt]=kt;return!0};DES$3.prototype._unpad=function(e){if(this.padding===!1)return e;for(var At=e[e.length-1],kt=e.length-At;kt<e.length;kt++)assert$k.equal(e[kt],At);return e.slice(0,e.length-At)};DES$3.prototype._encrypt=function(e,At,kt,Bt,Nt){for(var jt=At,Lt=kt,er=0;er<e.keys.length;er+=2){var tr=e.keys[er],zt=e.keys[er+1];utils$u.expand(Lt,e.tmp,0),tr^=e.tmp[0],zt^=e.tmp[1];var rr=utils$u.substitute(tr,zt),nr=utils$u.permute(rr),ir=Lt;Lt=(jt^nr)>>>0,jt=ir}utils$u.rip(Lt,jt,Bt,Nt)};DES$3.prototype._decrypt=function(e,At,kt,Bt,Nt){for(var jt=kt,Lt=At,er=e.keys.length-2;er>=0;er-=2){var tr=e.keys[er],zt=e.keys[er+1];utils$u.expand(jt,e.tmp,0),tr^=e.tmp[0],zt^=e.tmp[1];var rr=utils$u.substitute(tr,zt),nr=utils$u.permute(rr),ir=jt;jt=(Lt^nr)>>>0,Lt=ir}utils$u.rip(jt,Lt,Bt,Nt)};var cbc$1={},assert$j=minimalisticAssert,inherits$b=inherits_browserExports,proto={};function CBCState(xt){assert$j.equal(xt.length,8,"Invalid IV length"),this.iv=new Array(8);for(var e=0;e<this.iv.length;e++)this.iv[e]=xt[e]}function instantiate(xt){function e(Nt){xt.call(this,Nt),this._cbcInit()}inherits$b(e,xt);for(var At=Object.keys(proto),kt=0;kt<At.length;kt++){var Bt=At[kt];e.prototype[Bt]=proto[Bt]}return e.create=function(jt){return new e(jt)},e}cbc$1.instantiate=instantiate;proto._cbcInit=function(){var e=new CBCState(this.options.iv);this._cbcState=e};proto._update=function(e,At,kt,Bt){var Nt=this._cbcState,jt=this.constructor.super_.prototype,Lt=Nt.iv;if(this.type==="encrypt"){for(var er=0;er<this.blockSize;er++)Lt[er]^=e[At+er];jt._update.call(this,Lt,0,kt,Bt);for(var er=0;er<this.blockSize;er++)Lt[er]=kt[Bt+er]}else{jt._update.call(this,e,At,kt,Bt);for(var er=0;er<this.blockSize;er++)kt[Bt+er]^=Lt[er];for(var er=0;er<this.blockSize;er++)Lt[er]=e[At+er]}};var assert$i=minimalisticAssert,inherits$a=inherits_browserExports,Cipher$1=cipher,DES$2=des$1;function EDEState(xt,e){assert$i.equal(e.length,24,"Invalid key length");var At=e.slice(0,8),kt=e.slice(8,16),Bt=e.slice(16,24);xt==="encrypt"?this.ciphers=[DES$2.create({type:"encrypt",key:At}),DES$2.create({type:"decrypt",key:kt}),DES$2.create({type:"encrypt",key:Bt})]:this.ciphers=[DES$2.create({type:"decrypt",key:Bt}),DES$2.create({type:"encrypt",key:kt}),DES$2.create({type:"decrypt",key:At})]}function EDE(xt){Cipher$1.call(this,xt);var e=new EDEState(this.type,this.options.key);this._edeState=e}inherits$a(EDE,Cipher$1);var ede=EDE;EDE.create=function(e){return new EDE(e)};EDE.prototype._update=function(e,At,kt,Bt){var Nt=this._edeState;Nt.ciphers[0]._update(e,At,kt,Bt),Nt.ciphers[1]._update(kt,Bt,kt,Bt),Nt.ciphers[2]._update(kt,Bt,kt,Bt)};EDE.prototype._pad=DES$2.prototype._pad;EDE.prototype._unpad=DES$2.prototype._unpad;des$2.utils=utils$v;des$2.Cipher=cipher;des$2.DES=des$1;des$2.CBC=cbc$1;des$2.EDE=ede;var CipherBase=cipherBase,des=des$2,inherits$9=inherits_browserExports,Buffer$o=safeBufferExports$1.Buffer,modes$3={"des-ede3-cbc":des.CBC.instantiate(des.EDE),"des-ede3":des.EDE,"des-ede-cbc":des.CBC.instantiate(des.EDE),"des-ede":des.EDE,"des-cbc":des.CBC.instantiate(des.DES),"des-ecb":des.DES};modes$3.des=modes$3["des-cbc"];modes$3.des3=modes$3["des-ede3-cbc"];var browserifyDes=DES$1;inherits$9(DES$1,CipherBase);function DES$1(xt){CipherBase.call(this);var e=xt.mode.toLowerCase(),At=modes$3[e],kt;xt.decrypt?kt="decrypt":kt="encrypt";var Bt=xt.key;Buffer$o.isBuffer(Bt)||(Bt=Buffer$o.from(Bt)),(e==="des-ede"||e==="des-ede-cbc")&&(Bt=Buffer$o.concat([Bt,Bt.slice(0,8)]));var Nt=xt.iv;Buffer$o.isBuffer(Nt)||(Nt=Buffer$o.from(Nt)),this._des=At.create({key:Bt,iv:Nt,type:kt})}DES$1.prototype._update=function(xt){return Buffer$o.from(this._des.update(xt))};DES$1.prototype._final=function(){return Buffer$o.from(this._des.final())};var browser$8={},encrypter={},ecb={};ecb.encrypt=function(xt,e){return xt._cipher.encryptBlock(e)};ecb.decrypt=function(xt,e){return xt._cipher.decryptBlock(e)};var cbc={},bufferXor=function(e,At){for(var kt=Math.min(e.length,At.length),Bt=new buffer$2.Buffer(kt),Nt=0;Nt<kt;++Nt)Bt[Nt]=e[Nt]^At[Nt];return Bt},xor$7=bufferXor;cbc.encrypt=function(xt,e){var At=xor$7(e,xt._prev);return xt._prev=xt._cipher.encryptBlock(At),xt._prev};cbc.decrypt=function(xt,e){var At=xt._prev;xt._prev=e;var kt=xt._cipher.decryptBlock(e);return xor$7(kt,At)};var cfb={},Buffer$n=safeBufferExports$1.Buffer,xor$6=bufferXor;function encryptStart(xt,e,At){var kt=e.length,Bt=xor$6(e,xt._cache);return xt._cache=xt._cache.slice(kt),xt._prev=Buffer$n.concat([xt._prev,At?e:Bt]),Bt}cfb.encrypt=function(xt,e,At){for(var kt=Buffer$n.allocUnsafe(0),Bt;e.length;)if(xt._cache.length===0&&(xt._cache=xt._cipher.encryptBlock(xt._prev),xt._prev=Buffer$n.allocUnsafe(0)),xt._cache.length<=e.length)Bt=xt._cache.length,kt=Buffer$n.concat([kt,encryptStart(xt,e.slice(0,Bt),At)]),e=e.slice(Bt);else{kt=Buffer$n.concat([kt,encryptStart(xt,e,At)]);break}return kt};var cfb8={},Buffer$m=safeBufferExports$1.Buffer;function encryptByte$1(xt,e,At){var kt=xt._cipher.encryptBlock(xt._prev),Bt=kt[0]^e;return xt._prev=Buffer$m.concat([xt._prev.slice(1),Buffer$m.from([At?e:Bt])]),Bt}cfb8.encrypt=function(xt,e,At){for(var kt=e.length,Bt=Buffer$m.allocUnsafe(kt),Nt=-1;++Nt<kt;)Bt[Nt]=encryptByte$1(xt,e[Nt],At);return Bt};var cfb1={},Buffer$l=safeBufferExports$1.Buffer;function encryptByte(xt,e,At){for(var kt,Bt=-1,Nt=8,jt=0,Lt,er;++Bt<Nt;)kt=xt._cipher.encryptBlock(xt._prev),Lt=e&1<<7-Bt?128:0,er=kt[0]^Lt,jt+=(er&128)>>Bt%8,xt._prev=shiftIn(xt._prev,At?Lt:er);return jt}function shiftIn(xt,e){var At=xt.length,kt=-1,Bt=Buffer$l.allocUnsafe(xt.length);for(xt=Buffer$l.concat([xt,Buffer$l.from([e])]);++kt<At;)Bt[kt]=xt[kt]<<1|xt[kt+1]>>7;return Bt}cfb1.encrypt=function(xt,e,At){for(var kt=e.length,Bt=Buffer$l.allocUnsafe(kt),Nt=-1;++Nt<kt;)Bt[Nt]=encryptByte(xt,e[Nt],At);return Bt};var ofb={},xor$5=bufferXor;function getBlock$1(xt){return xt._prev=xt._cipher.encryptBlock(xt._prev),xt._prev}ofb.encrypt=function(xt,e){for(;xt._cache.length<e.length;)xt._cache=buffer$2.Buffer.concat([xt._cache,getBlock$1(xt)]);var At=xt._cache.slice(0,e.length);return xt._cache=xt._cache.slice(e.length),xor$5(e,At)};var ctr={};function incr32$2(xt){for(var e=xt.length,At;e--;)if(At=xt.readUInt8(e),At===255)xt.writeUInt8(0,e);else{At++,xt.writeUInt8(At,e);break}}var incr32_1=incr32$2,xor$4=bufferXor,Buffer$k=safeBufferExports$1.Buffer,incr32$1=incr32_1;function getBlock(xt){var e=xt._cipher.encryptBlockRaw(xt._prev);return incr32$1(xt._prev),e}var blockSize=16;ctr.encrypt=function(xt,e){var At=Math.ceil(e.length/blockSize),kt=xt._cache.length;xt._cache=Buffer$k.concat([xt._cache,Buffer$k.allocUnsafe(At*blockSize)]);for(var Bt=0;Bt<At;Bt++){var Nt=getBlock(xt),jt=kt+Bt*blockSize;xt._cache.writeUInt32BE(Nt[0],jt+0),xt._cache.writeUInt32BE(Nt[1],jt+4),xt._cache.writeUInt32BE(Nt[2],jt+8),xt._cache.writeUInt32BE(Nt[3],jt+12)}var Lt=xt._cache.slice(0,e.length);return xt._cache=xt._cache.slice(e.length),xor$4(e,Lt)};const aes128={cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192={cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256={cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},require$$2$1={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128,aes192,aes256,"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}};var modeModules={ECB:ecb,CBC:cbc,CFB:cfb,CFB8:cfb8,CFB1:cfb1,OFB:ofb,CTR:ctr,GCM:ctr},modes$2=require$$2$1;for(var key$2 in modes$2)modes$2[key$2].module=modeModules[modes$2[key$2].mode];var modes_1=modes$2,aes$5={},Buffer$j=safeBufferExports$1.Buffer;function asUInt32Array(xt){Buffer$j.isBuffer(xt)||(xt=Buffer$j.from(xt));for(var e=xt.length/4|0,At=new Array(e),kt=0;kt<e;kt++)At[kt]=xt.readUInt32BE(kt*4);return At}function scrubVec(xt){for(var e=0;e<xt.length;xt++)xt[e]=0}function cryptBlock(xt,e,At,kt,Bt){for(var Nt=At[0],jt=At[1],Lt=At[2],er=At[3],tr=xt[0]^e[0],zt=xt[1]^e[1],rr=xt[2]^e[2],nr=xt[3]^e[3],ir,ar,dr,ur,fr=4,pr=1;pr<Bt;pr++)ir=Nt[tr>>>24]^jt[zt>>>16&255]^Lt[rr>>>8&255]^er[nr&255]^e[fr++],ar=Nt[zt>>>24]^jt[rr>>>16&255]^Lt[nr>>>8&255]^er[tr&255]^e[fr++],dr=Nt[rr>>>24]^jt[nr>>>16&255]^Lt[tr>>>8&255]^er[zt&255]^e[fr++],ur=Nt[nr>>>24]^jt[tr>>>16&255]^Lt[zt>>>8&255]^er[rr&255]^e[fr++],tr=ir,zt=ar,rr=dr,nr=ur;return ir=(kt[tr>>>24]<<24|kt[zt>>>16&255]<<16|kt[rr>>>8&255]<<8|kt[nr&255])^e[fr++],ar=(kt[zt>>>24]<<24|kt[rr>>>16&255]<<16|kt[nr>>>8&255]<<8|kt[tr&255])^e[fr++],dr=(kt[rr>>>24]<<24|kt[nr>>>16&255]<<16|kt[tr>>>8&255]<<8|kt[zt&255])^e[fr++],ur=(kt[nr>>>24]<<24|kt[tr>>>16&255]<<16|kt[zt>>>8&255]<<8|kt[rr&255])^e[fr++],ir=ir>>>0,ar=ar>>>0,dr=dr>>>0,ur=ur>>>0,[ir,ar,dr,ur]}var RCON=[0,1,2,4,8,16,32,64,128,27,54],G$1=function(){for(var xt=new Array(256),e=0;e<256;e++)e<128?xt[e]=e<<1:xt[e]=e<<1^283;for(var At=[],kt=[],Bt=[[],[],[],[]],Nt=[[],[],[],[]],jt=0,Lt=0,er=0;er<256;++er){var tr=Lt^Lt<<1^Lt<<2^Lt<<3^Lt<<4;tr=tr>>>8^tr&255^99,At[jt]=tr,kt[tr]=jt;var zt=xt[jt],rr=xt[zt],nr=xt[rr],ir=xt[tr]*257^tr*16843008;Bt[0][jt]=ir<<24|ir>>>8,Bt[1][jt]=ir<<16|ir>>>16,Bt[2][jt]=ir<<8|ir>>>24,Bt[3][jt]=ir,ir=nr*16843009^rr*65537^zt*257^jt*16843008,Nt[0][tr]=ir<<24|ir>>>8,Nt[1][tr]=ir<<16|ir>>>16,Nt[2][tr]=ir<<8|ir>>>24,Nt[3][tr]=ir,jt===0?jt=Lt=1:(jt=zt^xt[xt[xt[nr^zt]]],Lt^=xt[xt[Lt]])}return{SBOX:At,INV_SBOX:kt,SUB_MIX:Bt,INV_SUB_MIX:Nt}}();function AES(xt){this._key=asUInt32Array(xt),this._reset()}AES.blockSize=4*4;AES.keySize=256/8;AES.prototype.blockSize=AES.blockSize;AES.prototype.keySize=AES.keySize;AES.prototype._reset=function(){for(var xt=this._key,e=xt.length,At=e+6,kt=(At+1)*4,Bt=[],Nt=0;Nt<e;Nt++)Bt[Nt]=xt[Nt];for(Nt=e;Nt<kt;Nt++){var jt=Bt[Nt-1];Nt%e===0?(jt=jt<<8|jt>>>24,jt=G$1.SBOX[jt>>>24]<<24|G$1.SBOX[jt>>>16&255]<<16|G$1.SBOX[jt>>>8&255]<<8|G$1.SBOX[jt&255],jt^=RCON[Nt/e|0]<<24):e>6&&Nt%e===4&&(jt=G$1.SBOX[jt>>>24]<<24|G$1.SBOX[jt>>>16&255]<<16|G$1.SBOX[jt>>>8&255]<<8|G$1.SBOX[jt&255]),Bt[Nt]=Bt[Nt-e]^jt}for(var Lt=[],er=0;er<kt;er++){var tr=kt-er,zt=Bt[tr-(er%4?0:4)];er<4||tr<=4?Lt[er]=zt:Lt[er]=G$1.INV_SUB_MIX[0][G$1.SBOX[zt>>>24]]^G$1.INV_SUB_MIX[1][G$1.SBOX[zt>>>16&255]]^G$1.INV_SUB_MIX[2][G$1.SBOX[zt>>>8&255]]^G$1.INV_SUB_MIX[3][G$1.SBOX[zt&255]]}this._nRounds=At,this._keySchedule=Bt,this._invKeySchedule=Lt};AES.prototype.encryptBlockRaw=function(xt){return xt=asUInt32Array(xt),cryptBlock(xt,this._keySchedule,G$1.SUB_MIX,G$1.SBOX,this._nRounds)};AES.prototype.encryptBlock=function(xt){var e=this.encryptBlockRaw(xt),At=Buffer$j.allocUnsafe(16);return At.writeUInt32BE(e[0],0),At.writeUInt32BE(e[1],4),At.writeUInt32BE(e[2],8),At.writeUInt32BE(e[3],12),At};AES.prototype.decryptBlock=function(xt){xt=asUInt32Array(xt);var e=xt[1];xt[1]=xt[3],xt[3]=e;var At=cryptBlock(xt,this._invKeySchedule,G$1.INV_SUB_MIX,G$1.INV_SBOX,this._nRounds),kt=Buffer$j.allocUnsafe(16);return kt.writeUInt32BE(At[0],0),kt.writeUInt32BE(At[3],4),kt.writeUInt32BE(At[2],8),kt.writeUInt32BE(At[1],12),kt};AES.prototype.scrub=function(){scrubVec(this._keySchedule),scrubVec(this._invKeySchedule),scrubVec(this._key)};aes$5.AES=AES;var Buffer$i=safeBufferExports$1.Buffer,ZEROES=Buffer$i.alloc(16,0);function toArray$3(xt){return[xt.readUInt32BE(0),xt.readUInt32BE(4),xt.readUInt32BE(8),xt.readUInt32BE(12)]}function fromArray(xt){var e=Buffer$i.allocUnsafe(16);return e.writeUInt32BE(xt[0]>>>0,0),e.writeUInt32BE(xt[1]>>>0,4),e.writeUInt32BE(xt[2]>>>0,8),e.writeUInt32BE(xt[3]>>>0,12),e}function GHASH$1(xt){this.h=xt,this.state=Buffer$i.alloc(16,0),this.cache=Buffer$i.allocUnsafe(0)}GHASH$1.prototype.ghash=function(xt){for(var e=-1;++e<xt.length;)this.state[e]^=xt[e];this._multiply()};GHASH$1.prototype._multiply=function(){for(var xt=toArray$3(this.h),e=[0,0,0,0],At,kt,Bt,Nt=-1;++Nt<128;){for(kt=(this.state[~~(Nt/8)]&1<<7-Nt%8)!==0,kt&&(e[0]^=xt[0],e[1]^=xt[1],e[2]^=xt[2],e[3]^=xt[3]),Bt=(xt[3]&1)!==0,At=3;At>0;At--)xt[At]=xt[At]>>>1|(xt[At-1]&1)<<31;xt[0]=xt[0]>>>1,Bt&&(xt[0]=xt[0]^225<<24)}this.state=fromArray(e)};GHASH$1.prototype.update=function(xt){this.cache=Buffer$i.concat([this.cache,xt]);for(var e;this.cache.length>=16;)e=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(e)};GHASH$1.prototype.final=function(xt,e){return this.cache.length&&this.ghash(Buffer$i.concat([this.cache,ZEROES],16)),this.ghash(fromArray([0,xt,0,e])),this.state};var ghash=GHASH$1,aes$4=aes$5,Buffer$h=safeBufferExports$1.Buffer,Transform$9=cipherBase,inherits$8=inherits_browserExports,GHASH=ghash,xor$3=bufferXor,incr32=incr32_1;function xorTest(xt,e){var At=0;xt.length!==e.length&&At++;for(var kt=Math.min(xt.length,e.length),Bt=0;Bt<kt;++Bt)At+=xt[Bt]^e[Bt];return At}function calcIv(xt,e,At){if(e.length===12)return xt._finID=Buffer$h.concat([e,Buffer$h.from([0,0,0,1])]),Buffer$h.concat([e,Buffer$h.from([0,0,0,2])]);var kt=new GHASH(At),Bt=e.length,Nt=Bt%16;kt.update(e),Nt&&(Nt=16-Nt,kt.update(Buffer$h.alloc(Nt,0))),kt.update(Buffer$h.alloc(8,0));var jt=Bt*8,Lt=Buffer$h.alloc(8);Lt.writeUIntBE(jt,0,8),kt.update(Lt),xt._finID=kt.state;var er=Buffer$h.from(xt._finID);return incr32(er),er}function StreamCipher$3(xt,e,At,kt){Transform$9.call(this);var Bt=Buffer$h.alloc(4,0);this._cipher=new aes$4.AES(e);var Nt=this._cipher.encryptBlock(Bt);this._ghash=new GHASH(Nt),At=calcIv(this,At,Nt),this._prev=Buffer$h.from(At),this._cache=Buffer$h.allocUnsafe(0),this._secCache=Buffer$h.allocUnsafe(0),this._decrypt=kt,this._alen=0,this._len=0,this._mode=xt,this._authTag=null,this._called=!1}inherits$8(StreamCipher$3,Transform$9);StreamCipher$3.prototype._update=function(xt){if(!this._called&&this._alen){var e=16-this._alen%16;e<16&&(e=Buffer$h.alloc(e,0),this._ghash.update(e))}this._called=!0;var At=this._mode.encrypt(this,xt);return this._decrypt?this._ghash.update(xt):this._ghash.update(At),this._len+=xt.length,At};StreamCipher$3.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var xt=xor$3(this._ghash.final(this._alen*8,this._len*8),this._cipher.encryptBlock(this._finID));if(this._decrypt&&xorTest(xt,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=xt,this._cipher.scrub()};StreamCipher$3.prototype.getAuthTag=function(){if(this._decrypt||!Buffer$h.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag};StreamCipher$3.prototype.setAuthTag=function(e){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=e};StreamCipher$3.prototype.setAAD=function(e){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(e),this._alen+=e.length};var authCipher=StreamCipher$3,aes$3=aes$5,Buffer$g=safeBufferExports$1.Buffer,Transform$8=cipherBase,inherits$7=inherits_browserExports;function StreamCipher$2(xt,e,At,kt){Transform$8.call(this),this._cipher=new aes$3.AES(e),this._prev=Buffer$g.from(At),this._cache=Buffer$g.allocUnsafe(0),this._secCache=Buffer$g.allocUnsafe(0),this._decrypt=kt,this._mode=xt}inherits$7(StreamCipher$2,Transform$8);StreamCipher$2.prototype._update=function(xt){return this._mode.encrypt(this,xt,this._decrypt)};StreamCipher$2.prototype._final=function(){this._cipher.scrub()};var streamCipher=StreamCipher$2,Buffer$f=safeBufferExports$1.Buffer,MD5=md5_js;function EVP_BytesToKey(xt,e,At,kt){if(Buffer$f.isBuffer(xt)||(xt=Buffer$f.from(xt,"binary")),e&&(Buffer$f.isBuffer(e)||(e=Buffer$f.from(e,"binary")),e.length!==8))throw new RangeError("salt should be Buffer with 8 byte length");for(var Bt=At/8,Nt=Buffer$f.alloc(Bt),jt=Buffer$f.alloc(kt||0),Lt=Buffer$f.alloc(0);Bt>0||kt>0;){var er=new MD5;er.update(Lt),er.update(xt),e&&er.update(e),Lt=er.digest();var tr=0;if(Bt>0){var zt=Nt.length-Bt;tr=Math.min(Bt,Lt.length),Lt.copy(Nt,zt,0,tr),Bt-=tr}if(tr<Lt.length&&kt>0){var rr=jt.length-kt,nr=Math.min(kt,Lt.length-tr);Lt.copy(jt,rr,tr,tr+nr),kt-=nr}}return Lt.fill(0),{key:Nt,iv:jt}}var evp_bytestokey=EVP_BytesToKey,MODES$1=modes_1,AuthCipher$1=authCipher,Buffer$e=safeBufferExports$1.Buffer,StreamCipher$1=streamCipher,Transform$7=cipherBase,aes$2=aes$5,ebtk$2=evp_bytestokey,inherits$6=inherits_browserExports;function Cipher(xt,e,At){Transform$7.call(this),this._cache=new Splitter$1,this._cipher=new aes$2.AES(e),this._prev=Buffer$e.from(At),this._mode=xt,this._autopadding=!0}inherits$6(Cipher,Transform$7);Cipher.prototype._update=function(xt){this._cache.add(xt);for(var e,At,kt=[];e=this._cache.get();)At=this._mode.encrypt(this,e),kt.push(At);return Buffer$e.concat(kt)};var PADDING=Buffer$e.alloc(16,16);Cipher.prototype._final=function(){var xt=this._cache.flush();if(this._autopadding)return xt=this._mode.encrypt(this,xt),this._cipher.scrub(),xt;if(!xt.equals(PADDING))throw this._cipher.scrub(),new Error("data not multiple of block length")};Cipher.prototype.setAutoPadding=function(xt){return this._autopadding=!!xt,this};function Splitter$1(){this.cache=Buffer$e.allocUnsafe(0)}Splitter$1.prototype.add=function(xt){this.cache=Buffer$e.concat([this.cache,xt])};Splitter$1.prototype.get=function(){if(this.cache.length>15){var xt=this.cache.slice(0,16);return this.cache=this.cache.slice(16),xt}return null};Splitter$1.prototype.flush=function(){for(var xt=16-this.cache.length,e=Buffer$e.allocUnsafe(xt),At=-1;++At<xt;)e.writeUInt8(xt,At);return Buffer$e.concat([this.cache,e])};function createCipheriv$1(xt,e,At){var kt=MODES$1[xt.toLowerCase()];if(!kt)throw new TypeError("invalid suite type");if(typeof e=="string"&&(e=Buffer$e.from(e)),e.length!==kt.key/8)throw new TypeError("invalid key length "+e.length);if(typeof At=="string"&&(At=Buffer$e.from(At)),kt.mode!=="GCM"&&At.length!==kt.iv)throw new TypeError("invalid iv length "+At.length);return kt.type==="stream"?new StreamCipher$1(kt.module,e,At):kt.type==="auth"?new AuthCipher$1(kt.module,e,At):new Cipher(kt.module,e,At)}function createCipher$2(xt,e){var At=MODES$1[xt.toLowerCase()];if(!At)throw new TypeError("invalid suite type");var kt=ebtk$2(e,!1,At.key,At.iv);return createCipheriv$1(xt,kt.key,kt.iv)}encrypter.createCipheriv=createCipheriv$1;encrypter.createCipher=createCipher$2;var decrypter={},AuthCipher=authCipher,Buffer$d=safeBufferExports$1.Buffer,MODES=modes_1,StreamCipher=streamCipher,Transform$6=cipherBase,aes$1=aes$5,ebtk$1=evp_bytestokey,inherits$5=inherits_browserExports;function Decipher(xt,e,At){Transform$6.call(this),this._cache=new Splitter,this._last=void 0,this._cipher=new aes$1.AES(e),this._prev=Buffer$d.from(At),this._mode=xt,this._autopadding=!0}inherits$5(Decipher,Transform$6);Decipher.prototype._update=function(xt){this._cache.add(xt);for(var e,At,kt=[];e=this._cache.get(this._autopadding);)At=this._mode.decrypt(this,e),kt.push(At);return Buffer$d.concat(kt)};Decipher.prototype._final=function(){var xt=this._cache.flush();if(this._autopadding)return unpad(this._mode.decrypt(this,xt));if(xt)throw new Error("data not multiple of block length")};Decipher.prototype.setAutoPadding=function(xt){return this._autopadding=!!xt,this};function Splitter(){this.cache=Buffer$d.allocUnsafe(0)}Splitter.prototype.add=function(xt){this.cache=Buffer$d.concat([this.cache,xt])};Splitter.prototype.get=function(xt){var e;if(xt){if(this.cache.length>16)return e=this.cache.slice(0,16),this.cache=this.cache.slice(16),e}else if(this.cache.length>=16)return e=this.cache.slice(0,16),this.cache=this.cache.slice(16),e;return null};Splitter.prototype.flush=function(){if(this.cache.length)return this.cache};function unpad(xt){var e=xt[15];if(e<1||e>16)throw new Error("unable to decrypt data");for(var At=-1;++At<e;)if(xt[At+(16-e)]!==e)throw new Error("unable to decrypt data");if(e!==16)return xt.slice(0,16-e)}function createDecipheriv$1(xt,e,At){var kt=MODES[xt.toLowerCase()];if(!kt)throw new TypeError("invalid suite type");if(typeof At=="string"&&(At=Buffer$d.from(At)),kt.mode!=="GCM"&&At.length!==kt.iv)throw new TypeError("invalid iv length "+At.length);if(typeof e=="string"&&(e=Buffer$d.from(e)),e.length!==kt.key/8)throw new TypeError("invalid key length "+e.length);return kt.type==="stream"?new StreamCipher(kt.module,e,At,!0):kt.type==="auth"?new AuthCipher(kt.module,e,At,!0):new Decipher(kt.module,e,At)}function createDecipher$1(xt,e){var At=MODES[xt.toLowerCase()];if(!At)throw new TypeError("invalid suite type");var kt=ebtk$1(e,!1,At.key,At.iv);return createDecipheriv$1(xt,kt.key,kt.iv)}decrypter.createDecipher=createDecipher$1;decrypter.createDecipheriv=createDecipheriv$1;var ciphers$2=encrypter,deciphers=decrypter,modes$1=require$$2$1;function getCiphers$1(){return Object.keys(modes$1)}browser$8.createCipher=browser$8.Cipher=ciphers$2.createCipher;browser$8.createCipheriv=browser$8.Cipheriv=ciphers$2.createCipheriv;browser$8.createDecipher=browser$8.Decipher=deciphers.createDecipher;browser$8.createDecipheriv=browser$8.Decipheriv=deciphers.createDecipheriv;browser$8.listCiphers=browser$8.getCiphers=getCiphers$1;var modes={};(function(xt){xt["des-ecb"]={key:8,iv:0},xt["des-cbc"]=xt.des={key:8,iv:8},xt["des-ede3-cbc"]=xt.des3={key:24,iv:8},xt["des-ede3"]={key:24,iv:0},xt["des-ede-cbc"]={key:16,iv:8},xt["des-ede"]={key:16,iv:0}})(modes);var DES=browserifyDes,aes=browser$8,aesModes=modes_1,desModes=modes,ebtk=evp_bytestokey;function createCipher$1(xt,e){xt=xt.toLowerCase();var At,kt;if(aesModes[xt])At=aesModes[xt].key,kt=aesModes[xt].iv;else if(desModes[xt])At=desModes[xt].key*8,kt=desModes[xt].iv;else throw new TypeError("invalid suite type");var Bt=ebtk(e,!1,At,kt);return createCipheriv(xt,Bt.key,Bt.iv)}function createDecipher(xt,e){xt=xt.toLowerCase();var At,kt;if(aesModes[xt])At=aesModes[xt].key,kt=aesModes[xt].iv;else if(desModes[xt])At=desModes[xt].key*8,kt=desModes[xt].iv;else throw new TypeError("invalid suite type");var Bt=ebtk(e,!1,At,kt);return createDecipheriv(xt,Bt.key,Bt.iv)}function createCipheriv(xt,e,At){if(xt=xt.toLowerCase(),aesModes[xt])return aes.createCipheriv(xt,e,At);if(desModes[xt])return new DES({key:e,iv:At,mode:xt});throw new TypeError("invalid suite type")}function createDecipheriv(xt,e,At){if(xt=xt.toLowerCase(),aesModes[xt])return aes.createDecipheriv(xt,e,At);if(desModes[xt])return new DES({key:e,iv:At,mode:xt,decrypt:!0});throw new TypeError("invalid suite type")}function getCiphers(){return Object.keys(desModes).concat(aes.getCiphers())}browser$9.createCipher=browser$9.Cipher=createCipher$1;browser$9.createCipheriv=browser$9.Cipheriv=createCipheriv;browser$9.createDecipher=browser$9.Decipher=createDecipher;browser$9.createDecipheriv=browser$9.Decipheriv=createDecipheriv;browser$9.listCiphers=browser$9.getCiphers=getCiphers;var browser$7={},bn$1={exports:{}};bn$1.exports;(function(xt){(function(e,At){function kt(Lr,Sr){if(!Lr)throw new Error(Sr||"Assertion failed")}function Bt(Lr,Sr){Lr.super_=Sr;var _r=function(){};_r.prototype=Sr.prototype,Lr.prototype=new _r,Lr.prototype.constructor=Lr}function Nt(Lr,Sr,_r){if(Nt.isBN(Lr))return Lr;this.negative=0,this.words=null,this.length=0,this.red=null,Lr!==null&&((Sr==="le"||Sr==="be")&&(_r=Sr,Sr=10),this._init(Lr||0,Sr||10,_r||"be"))}typeof e=="object"?e.exports=Nt:At.BN=Nt,Nt.BN=Nt,Nt.wordSize=26;var jt;try{typeof window<"u"&&typeof window.Buffer<"u"?jt=window.Buffer:jt=buffer$2.Buffer}catch{}Nt.isBN=function(Sr){return Sr instanceof Nt?!0:Sr!==null&&typeof Sr=="object"&&Sr.constructor.wordSize===Nt.wordSize&&Array.isArray(Sr.words)},Nt.max=function(Sr,_r){return Sr.cmp(_r)>0?Sr:_r},Nt.min=function(Sr,_r){return Sr.cmp(_r)<0?Sr:_r},Nt.prototype._init=function(Sr,_r,gr){if(typeof Sr=="number")return this._initNumber(Sr,_r,gr);if(typeof Sr=="object")return this._initArray(Sr,_r,gr);_r==="hex"&&(_r=16),kt(_r===(_r|0)&&_r>=2&&_r<=36),Sr=Sr.toString().replace(/\s+/g,"");var wr=0;Sr[0]==="-"&&(wr++,this.negative=1),wr<Sr.length&&(_r===16?this._parseHex(Sr,wr,gr):(this._parseBase(Sr,_r,wr),gr==="le"&&this._initArray(this.toArray(),_r,gr)))},Nt.prototype._initNumber=function(Sr,_r,gr){Sr<0&&(this.negative=1,Sr=-Sr),Sr<67108864?(this.words=[Sr&67108863],this.length=1):Sr<4503599627370496?(this.words=[Sr&67108863,Sr/67108864&67108863],this.length=2):(kt(Sr<9007199254740992),this.words=[Sr&67108863,Sr/67108864&67108863,1],this.length=3),gr==="le"&&this._initArray(this.toArray(),_r,gr)},Nt.prototype._initArray=function(Sr,_r,gr){if(kt(typeof Sr.length=="number"),Sr.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(Sr.length/3),this.words=new Array(this.length);for(var wr=0;wr<this.length;wr++)this.words[wr]=0;var Dr,xr,Ir=0;if(gr==="be")for(wr=Sr.length-1,Dr=0;wr>=0;wr-=3)xr=Sr[wr]|Sr[wr-1]<<8|Sr[wr-2]<<16,this.words[Dr]|=xr<<Ir&67108863,this.words[Dr+1]=xr>>>26-Ir&67108863,Ir+=24,Ir>=26&&(Ir-=26,Dr++);else if(gr==="le")for(wr=0,Dr=0;wr<Sr.length;wr+=3)xr=Sr[wr]|Sr[wr+1]<<8|Sr[wr+2]<<16,this.words[Dr]|=xr<<Ir&67108863,this.words[Dr+1]=xr>>>26-Ir&67108863,Ir+=24,Ir>=26&&(Ir-=26,Dr++);return this.strip()};function Lt(Lr,Sr){var _r=Lr.charCodeAt(Sr);return _r>=65&&_r<=70?_r-55:_r>=97&&_r<=102?_r-87:_r-48&15}function er(Lr,Sr,_r){var gr=Lt(Lr,_r);return _r-1>=Sr&&(gr|=Lt(Lr,_r-1)<<4),gr}Nt.prototype._parseHex=function(Sr,_r,gr){this.length=Math.ceil((Sr.length-_r)/6),this.words=new Array(this.length);for(var wr=0;wr<this.length;wr++)this.words[wr]=0;var Dr=0,xr=0,Ir;if(gr==="be")for(wr=Sr.length-1;wr>=_r;wr-=2)Ir=er(Sr,_r,wr)<<Dr,this.words[xr]|=Ir&67108863,Dr>=18?(Dr-=18,xr+=1,this.words[xr]|=Ir>>>26):Dr+=8;else{var $r=Sr.length-_r;for(wr=$r%2===0?_r+1:_r;wr<Sr.length;wr+=2)Ir=er(Sr,_r,wr)<<Dr,this.words[xr]|=Ir&67108863,Dr>=18?(Dr-=18,xr+=1,this.words[xr]|=Ir>>>26):Dr+=8}this.strip()};function tr(Lr,Sr,_r,gr){for(var wr=0,Dr=Math.min(Lr.length,_r),xr=Sr;xr<Dr;xr++){var Ir=Lr.charCodeAt(xr)-48;wr*=gr,Ir>=49?wr+=Ir-49+10:Ir>=17?wr+=Ir-17+10:wr+=Ir}return wr}Nt.prototype._parseBase=function(Sr,_r,gr){this.words=[0],this.length=1;for(var wr=0,Dr=1;Dr<=67108863;Dr*=_r)wr++;wr--,Dr=Dr/_r|0;for(var xr=Sr.length-gr,Ir=xr%wr,$r=Math.min(xr,xr-Ir)+gr,vr=0,Er=gr;Er<$r;Er+=wr)vr=tr(Sr,Er,Er+wr,_r),this.imuln(Dr),this.words[0]+vr<67108864?this.words[0]+=vr:this._iaddn(vr);if(Ir!==0){var Tr=1;for(vr=tr(Sr,Er,Sr.length,_r),Er=0;Er<Ir;Er++)Tr*=_r;this.imuln(Tr),this.words[0]+vr<67108864?this.words[0]+=vr:this._iaddn(vr)}this.strip()},Nt.prototype.copy=function(Sr){Sr.words=new Array(this.length);for(var _r=0;_r<this.length;_r++)Sr.words[_r]=this.words[_r];Sr.length=this.length,Sr.negative=this.negative,Sr.red=this.red},Nt.prototype.clone=function(){var Sr=new Nt(null);return this.copy(Sr),Sr},Nt.prototype._expand=function(Sr){for(;this.length<Sr;)this.words[this.length++]=0;return this},Nt.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},Nt.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},Nt.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var zt=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],rr=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],nr=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];Nt.prototype.toString=function(Sr,_r){Sr=Sr||10,_r=_r|0||1;var gr;if(Sr===16||Sr==="hex"){gr="";for(var wr=0,Dr=0,xr=0;xr<this.length;xr++){var Ir=this.words[xr],$r=((Ir<<wr|Dr)&16777215).toString(16);Dr=Ir>>>24-wr&16777215,Dr!==0||xr!==this.length-1?gr=zt[6-$r.length]+$r+gr:gr=$r+gr,wr+=2,wr>=26&&(wr-=26,xr--)}for(Dr!==0&&(gr=Dr.toString(16)+gr);gr.length%_r!==0;)gr="0"+gr;return this.negative!==0&&(gr="-"+gr),gr}if(Sr===(Sr|0)&&Sr>=2&&Sr<=36){var vr=rr[Sr],Er=nr[Sr];gr="";var Tr=this.clone();for(Tr.negative=0;!Tr.isZero();){var Rr=Tr.modn(Er).toString(Sr);Tr=Tr.idivn(Er),Tr.isZero()?gr=Rr+gr:gr=zt[vr-Rr.length]+Rr+gr}for(this.isZero()&&(gr="0"+gr);gr.length%_r!==0;)gr="0"+gr;return this.negative!==0&&(gr="-"+gr),gr}kt(!1,"Base should be between 2 and 36")},Nt.prototype.toNumber=function(){var Sr=this.words[0];return this.length===2?Sr+=this.words[1]*67108864:this.length===3&&this.words[2]===1?Sr+=4503599627370496+this.words[1]*67108864:this.length>2&&kt(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-Sr:Sr},Nt.prototype.toJSON=function(){return this.toString(16)},Nt.prototype.toBuffer=function(Sr,_r){return kt(typeof jt<"u"),this.toArrayLike(jt,Sr,_r)},Nt.prototype.toArray=function(Sr,_r){return this.toArrayLike(Array,Sr,_r)},Nt.prototype.toArrayLike=function(Sr,_r,gr){var wr=this.byteLength(),Dr=gr||Math.max(1,wr);kt(wr<=Dr,"byte array longer than desired length"),kt(Dr>0,"Requested array length <= 0"),this.strip();var xr=_r==="le",Ir=new Sr(Dr),$r,vr,Er=this.clone();if(xr){for(vr=0;!Er.isZero();vr++)$r=Er.andln(255),Er.iushrn(8),Ir[vr]=$r;for(;vr<Dr;vr++)Ir[vr]=0}else{for(vr=0;vr<Dr-wr;vr++)Ir[vr]=0;for(vr=0;!Er.isZero();vr++)$r=Er.andln(255),Er.iushrn(8),Ir[Dr-vr-1]=$r}return Ir},Math.clz32?Nt.prototype._countBits=function(Sr){return 32-Math.clz32(Sr)}:Nt.prototype._countBits=function(Sr){var _r=Sr,gr=0;return _r>=4096&&(gr+=13,_r>>>=13),_r>=64&&(gr+=7,_r>>>=7),_r>=8&&(gr+=4,_r>>>=4),_r>=2&&(gr+=2,_r>>>=2),gr+_r},Nt.prototype._zeroBits=function(Sr){if(Sr===0)return 26;var _r=Sr,gr=0;return _r&8191||(gr+=13,_r>>>=13),_r&127||(gr+=7,_r>>>=7),_r&15||(gr+=4,_r>>>=4),_r&3||(gr+=2,_r>>>=2),_r&1||gr++,gr},Nt.prototype.bitLength=function(){var Sr=this.words[this.length-1],_r=this._countBits(Sr);return(this.length-1)*26+_r};function ir(Lr){for(var Sr=new Array(Lr.bitLength()),_r=0;_r<Sr.length;_r++){var gr=_r/26|0,wr=_r%26;Sr[_r]=(Lr.words[gr]&1<<wr)>>>wr}return Sr}Nt.prototype.zeroBits=function(){if(this.isZero())return 0;for(var Sr=0,_r=0;_r<this.length;_r++){var gr=this._zeroBits(this.words[_r]);if(Sr+=gr,gr!==26)break}return Sr},Nt.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},Nt.prototype.toTwos=function(Sr){return this.negative!==0?this.abs().inotn(Sr).iaddn(1):this.clone()},Nt.prototype.fromTwos=function(Sr){return this.testn(Sr-1)?this.notn(Sr).iaddn(1).ineg():this.clone()},Nt.prototype.isNeg=function(){return this.negative!==0},Nt.prototype.neg=function(){return this.clone().ineg()},Nt.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},Nt.prototype.iuor=function(Sr){for(;this.length<Sr.length;)this.words[this.length++]=0;for(var _r=0;_r<Sr.length;_r++)this.words[_r]=this.words[_r]|Sr.words[_r];return this.strip()},Nt.prototype.ior=function(Sr){return kt((this.negative|Sr.negative)===0),this.iuor(Sr)},Nt.prototype.or=function(Sr){return this.length>Sr.length?this.clone().ior(Sr):Sr.clone().ior(this)},Nt.prototype.uor=function(Sr){return this.length>Sr.length?this.clone().iuor(Sr):Sr.clone().iuor(this)},Nt.prototype.iuand=function(Sr){var _r;this.length>Sr.length?_r=Sr:_r=this;for(var gr=0;gr<_r.length;gr++)this.words[gr]=this.words[gr]&Sr.words[gr];return this.length=_r.length,this.strip()},Nt.prototype.iand=function(Sr){return kt((this.negative|Sr.negative)===0),this.iuand(Sr)},Nt.prototype.and=function(Sr){return this.length>Sr.length?this.clone().iand(Sr):Sr.clone().iand(this)},Nt.prototype.uand=function(Sr){return this.length>Sr.length?this.clone().iuand(Sr):Sr.clone().iuand(this)},Nt.prototype.iuxor=function(Sr){var _r,gr;this.length>Sr.length?(_r=this,gr=Sr):(_r=Sr,gr=this);for(var wr=0;wr<gr.length;wr++)this.words[wr]=_r.words[wr]^gr.words[wr];if(this!==_r)for(;wr<_r.length;wr++)this.words[wr]=_r.words[wr];return this.length=_r.length,this.strip()},Nt.prototype.ixor=function(Sr){return kt((this.negative|Sr.negative)===0),this.iuxor(Sr)},Nt.prototype.xor=function(Sr){return this.length>Sr.length?this.clone().ixor(Sr):Sr.clone().ixor(this)},Nt.prototype.uxor=function(Sr){return this.length>Sr.length?this.clone().iuxor(Sr):Sr.clone().iuxor(this)},Nt.prototype.inotn=function(Sr){kt(typeof Sr=="number"&&Sr>=0);var _r=Math.ceil(Sr/26)|0,gr=Sr%26;this._expand(_r),gr>0&&_r--;for(var wr=0;wr<_r;wr++)this.words[wr]=~this.words[wr]&67108863;return gr>0&&(this.words[wr]=~this.words[wr]&67108863>>26-gr),this.strip()},Nt.prototype.notn=function(Sr){return this.clone().inotn(Sr)},Nt.prototype.setn=function(Sr,_r){kt(typeof Sr=="number"&&Sr>=0);var gr=Sr/26|0,wr=Sr%26;return this._expand(gr+1),_r?this.words[gr]=this.words[gr]|1<<wr:this.words[gr]=this.words[gr]&~(1<<wr),this.strip()},Nt.prototype.iadd=function(Sr){var _r;if(this.negative!==0&&Sr.negative===0)return this.negative=0,_r=this.isub(Sr),this.negative^=1,this._normSign();if(this.negative===0&&Sr.negative!==0)return Sr.negative=0,_r=this.isub(Sr),Sr.negative=1,_r._normSign();var gr,wr;this.length>Sr.length?(gr=this,wr=Sr):(gr=Sr,wr=this);for(var Dr=0,xr=0;xr<wr.length;xr++)_r=(gr.words[xr]|0)+(wr.words[xr]|0)+Dr,this.words[xr]=_r&67108863,Dr=_r>>>26;for(;Dr!==0&&xr<gr.length;xr++)_r=(gr.words[xr]|0)+Dr,this.words[xr]=_r&67108863,Dr=_r>>>26;if(this.length=gr.length,Dr!==0)this.words[this.length]=Dr,this.length++;else if(gr!==this)for(;xr<gr.length;xr++)this.words[xr]=gr.words[xr];return this},Nt.prototype.add=function(Sr){var _r;return Sr.negative!==0&&this.negative===0?(Sr.negative=0,_r=this.sub(Sr),Sr.negative^=1,_r):Sr.negative===0&&this.negative!==0?(this.negative=0,_r=Sr.sub(this),this.negative=1,_r):this.length>Sr.length?this.clone().iadd(Sr):Sr.clone().iadd(this)},Nt.prototype.isub=function(Sr){if(Sr.negative!==0){Sr.negative=0;var _r=this.iadd(Sr);return Sr.negative=1,_r._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(Sr),this.negative=1,this._normSign();var gr=this.cmp(Sr);if(gr===0)return this.negative=0,this.length=1,this.words[0]=0,this;var wr,Dr;gr>0?(wr=this,Dr=Sr):(wr=Sr,Dr=this);for(var xr=0,Ir=0;Ir<Dr.length;Ir++)_r=(wr.words[Ir]|0)-(Dr.words[Ir]|0)+xr,xr=_r>>26,this.words[Ir]=_r&67108863;for(;xr!==0&&Ir<wr.length;Ir++)_r=(wr.words[Ir]|0)+xr,xr=_r>>26,this.words[Ir]=_r&67108863;if(xr===0&&Ir<wr.length&&wr!==this)for(;Ir<wr.length;Ir++)this.words[Ir]=wr.words[Ir];return this.length=Math.max(this.length,Ir),wr!==this&&(this.negative=1),this.strip()},Nt.prototype.sub=function(Sr){return this.clone().isub(Sr)};function ar(Lr,Sr,_r){_r.negative=Sr.negative^Lr.negative;var gr=Lr.length+Sr.length|0;_r.length=gr,gr=gr-1|0;var wr=Lr.words[0]|0,Dr=Sr.words[0]|0,xr=wr*Dr,Ir=xr&67108863,$r=xr/67108864|0;_r.words[0]=Ir;for(var vr=1;vr<gr;vr++){for(var Er=$r>>>26,Tr=$r&67108863,Rr=Math.min(vr,Sr.length-1),Mr=Math.max(0,vr-Lr.length+1);Mr<=Rr;Mr++){var Gr=vr-Mr|0;wr=Lr.words[Gr]|0,Dr=Sr.words[Mr]|0,xr=wr*Dr+Tr,Er+=xr/67108864|0,Tr=xr&67108863}_r.words[vr]=Tr|0,$r=Er|0}return $r!==0?_r.words[vr]=$r|0:_r.length--,_r.strip()}var dr=function(Sr,_r,gr){var wr=Sr.words,Dr=_r.words,xr=gr.words,Ir=0,$r,vr,Er,Tr=wr[0]|0,Rr=Tr&8191,Mr=Tr>>>13,Gr=wr[1]|0,Br=Gr&8191,Cr=Gr>>>13,jr=wr[2]|0,Yr=jr&8191,Qr=jr>>>13,Jr=wr[3]|0,Wr=Jr&8191,Nr=Jr>>>13,Vr=wr[4]|0,Xr=Vr&8191,qr=Vr>>>13,Or=wr[5]|0,Fr=Or&8191,Zr=Or>>>13,rn=wr[6]|0,un=rn&8191,dn=rn>>>13,vn=wr[7]|0,$n=vn&8191,en=vn>>>13,tn=wr[8]|0,hn=tn&8191,mn=tn>>>13,yn=wr[9]|0,xn=yn&8191,In=yn>>>13,On=Dr[0]|0,Dn=On&8191,Yn=On>>>13,Hn=Dr[1]|0,Mn=Hn&8191,zn=Hn>>>13,Pn=Dr[2]|0,Rn=Pn&8191,Nn=Pn>>>13,Wn=Dr[3]|0,kn=Wn&8191,Zn=Wn>>>13,eo=Dr[4]|0,qn=eo&8191,io=eo>>>13,nn=Dr[5]|0,sn=nn&8191,_n=nn>>>13,En=Dr[6]|0,Sn=En&8191,Qn=En>>>13,Xn=Dr[7]|0,an=Xn&8191,on=Xn>>>13,fn=Dr[8]|0,pn=fn&8191,gn=fn>>>13,An=Dr[9]|0,Tn=An&8191,Bn=An>>>13;gr.negative=Sr.negative^_r.negative,gr.length=19,$r=Math.imul(Rr,Dn),vr=Math.imul(Rr,Yn),vr=vr+Math.imul(Mr,Dn)|0,Er=Math.imul(Mr,Yn);var Un=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(Un>>>26)|0,Un&=67108863,$r=Math.imul(Br,Dn),vr=Math.imul(Br,Yn),vr=vr+Math.imul(Cr,Dn)|0,Er=Math.imul(Cr,Yn),$r=$r+Math.imul(Rr,Mn)|0,vr=vr+Math.imul(Rr,zn)|0,vr=vr+Math.imul(Mr,Mn)|0,Er=Er+Math.imul(Mr,zn)|0;var Ln=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(Ln>>>26)|0,Ln&=67108863,$r=Math.imul(Yr,Dn),vr=Math.imul(Yr,Yn),vr=vr+Math.imul(Qr,Dn)|0,Er=Math.imul(Qr,Yn),$r=$r+Math.imul(Br,Mn)|0,vr=vr+Math.imul(Br,zn)|0,vr=vr+Math.imul(Cr,Mn)|0,Er=Er+Math.imul(Cr,zn)|0,$r=$r+Math.imul(Rr,Rn)|0,vr=vr+Math.imul(Rr,Nn)|0,vr=vr+Math.imul(Mr,Rn)|0,Er=Er+Math.imul(Mr,Nn)|0;var Kn=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(Kn>>>26)|0,Kn&=67108863,$r=Math.imul(Wr,Dn),vr=Math.imul(Wr,Yn),vr=vr+Math.imul(Nr,Dn)|0,Er=Math.imul(Nr,Yn),$r=$r+Math.imul(Yr,Mn)|0,vr=vr+Math.imul(Yr,zn)|0,vr=vr+Math.imul(Qr,Mn)|0,Er=Er+Math.imul(Qr,zn)|0,$r=$r+Math.imul(Br,Rn)|0,vr=vr+Math.imul(Br,Nn)|0,vr=vr+Math.imul(Cr,Rn)|0,Er=Er+Math.imul(Cr,Nn)|0,$r=$r+Math.imul(Rr,kn)|0,vr=vr+Math.imul(Rr,Zn)|0,vr=vr+Math.imul(Mr,kn)|0,Er=Er+Math.imul(Mr,Zn)|0;var Vn=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(Vn>>>26)|0,Vn&=67108863,$r=Math.imul(Xr,Dn),vr=Math.imul(Xr,Yn),vr=vr+Math.imul(qr,Dn)|0,Er=Math.imul(qr,Yn),$r=$r+Math.imul(Wr,Mn)|0,vr=vr+Math.imul(Wr,zn)|0,vr=vr+Math.imul(Nr,Mn)|0,Er=Er+Math.imul(Nr,zn)|0,$r=$r+Math.imul(Yr,Rn)|0,vr=vr+Math.imul(Yr,Nn)|0,vr=vr+Math.imul(Qr,Rn)|0,Er=Er+Math.imul(Qr,Nn)|0,$r=$r+Math.imul(Br,kn)|0,vr=vr+Math.imul(Br,Zn)|0,vr=vr+Math.imul(Cr,kn)|0,Er=Er+Math.imul(Cr,Zn)|0,$r=$r+Math.imul(Rr,qn)|0,vr=vr+Math.imul(Rr,io)|0,vr=vr+Math.imul(Mr,qn)|0,Er=Er+Math.imul(Mr,io)|0;var oo=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(oo>>>26)|0,oo&=67108863,$r=Math.imul(Fr,Dn),vr=Math.imul(Fr,Yn),vr=vr+Math.imul(Zr,Dn)|0,Er=Math.imul(Zr,Yn),$r=$r+Math.imul(Xr,Mn)|0,vr=vr+Math.imul(Xr,zn)|0,vr=vr+Math.imul(qr,Mn)|0,Er=Er+Math.imul(qr,zn)|0,$r=$r+Math.imul(Wr,Rn)|0,vr=vr+Math.imul(Wr,Nn)|0,vr=vr+Math.imul(Nr,Rn)|0,Er=Er+Math.imul(Nr,Nn)|0,$r=$r+Math.imul(Yr,kn)|0,vr=vr+Math.imul(Yr,Zn)|0,vr=vr+Math.imul(Qr,kn)|0,Er=Er+Math.imul(Qr,Zn)|0,$r=$r+Math.imul(Br,qn)|0,vr=vr+Math.imul(Br,io)|0,vr=vr+Math.imul(Cr,qn)|0,Er=Er+Math.imul(Cr,io)|0,$r=$r+Math.imul(Rr,sn)|0,vr=vr+Math.imul(Rr,_n)|0,vr=vr+Math.imul(Mr,sn)|0,Er=Er+Math.imul(Mr,_n)|0;var Fn=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(Fn>>>26)|0,Fn&=67108863,$r=Math.imul(un,Dn),vr=Math.imul(un,Yn),vr=vr+Math.imul(dn,Dn)|0,Er=Math.imul(dn,Yn),$r=$r+Math.imul(Fr,Mn)|0,vr=vr+Math.imul(Fr,zn)|0,vr=vr+Math.imul(Zr,Mn)|0,Er=Er+Math.imul(Zr,zn)|0,$r=$r+Math.imul(Xr,Rn)|0,vr=vr+Math.imul(Xr,Nn)|0,vr=vr+Math.imul(qr,Rn)|0,Er=Er+Math.imul(qr,Nn)|0,$r=$r+Math.imul(Wr,kn)|0,vr=vr+Math.imul(Wr,Zn)|0,vr=vr+Math.imul(Nr,kn)|0,Er=Er+Math.imul(Nr,Zn)|0,$r=$r+Math.imul(Yr,qn)|0,vr=vr+Math.imul(Yr,io)|0,vr=vr+Math.imul(Qr,qn)|0,Er=Er+Math.imul(Qr,io)|0,$r=$r+Math.imul(Br,sn)|0,vr=vr+Math.imul(Br,_n)|0,vr=vr+Math.imul(Cr,sn)|0,Er=Er+Math.imul(Cr,_n)|0,$r=$r+Math.imul(Rr,Sn)|0,vr=vr+Math.imul(Rr,Qn)|0,vr=vr+Math.imul(Mr,Sn)|0,Er=Er+Math.imul(Mr,Qn)|0;var to=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(to>>>26)|0,to&=67108863,$r=Math.imul($n,Dn),vr=Math.imul($n,Yn),vr=vr+Math.imul(en,Dn)|0,Er=Math.imul(en,Yn),$r=$r+Math.imul(un,Mn)|0,vr=vr+Math.imul(un,zn)|0,vr=vr+Math.imul(dn,Mn)|0,Er=Er+Math.imul(dn,zn)|0,$r=$r+Math.imul(Fr,Rn)|0,vr=vr+Math.imul(Fr,Nn)|0,vr=vr+Math.imul(Zr,Rn)|0,Er=Er+Math.imul(Zr,Nn)|0,$r=$r+Math.imul(Xr,kn)|0,vr=vr+Math.imul(Xr,Zn)|0,vr=vr+Math.imul(qr,kn)|0,Er=Er+Math.imul(qr,Zn)|0,$r=$r+Math.imul(Wr,qn)|0,vr=vr+Math.imul(Wr,io)|0,vr=vr+Math.imul(Nr,qn)|0,Er=Er+Math.imul(Nr,io)|0,$r=$r+Math.imul(Yr,sn)|0,vr=vr+Math.imul(Yr,_n)|0,vr=vr+Math.imul(Qr,sn)|0,Er=Er+Math.imul(Qr,_n)|0,$r=$r+Math.imul(Br,Sn)|0,vr=vr+Math.imul(Br,Qn)|0,vr=vr+Math.imul(Cr,Sn)|0,Er=Er+Math.imul(Cr,Qn)|0,$r=$r+Math.imul(Rr,an)|0,vr=vr+Math.imul(Rr,on)|0,vr=vr+Math.imul(Mr,an)|0,Er=Er+Math.imul(Mr,on)|0;var so=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(so>>>26)|0,so&=67108863,$r=Math.imul(hn,Dn),vr=Math.imul(hn,Yn),vr=vr+Math.imul(mn,Dn)|0,Er=Math.imul(mn,Yn),$r=$r+Math.imul($n,Mn)|0,vr=vr+Math.imul($n,zn)|0,vr=vr+Math.imul(en,Mn)|0,Er=Er+Math.imul(en,zn)|0,$r=$r+Math.imul(un,Rn)|0,vr=vr+Math.imul(un,Nn)|0,vr=vr+Math.imul(dn,Rn)|0,Er=Er+Math.imul(dn,Nn)|0,$r=$r+Math.imul(Fr,kn)|0,vr=vr+Math.imul(Fr,Zn)|0,vr=vr+Math.imul(Zr,kn)|0,Er=Er+Math.imul(Zr,Zn)|0,$r=$r+Math.imul(Xr,qn)|0,vr=vr+Math.imul(Xr,io)|0,vr=vr+Math.imul(qr,qn)|0,Er=Er+Math.imul(qr,io)|0,$r=$r+Math.imul(Wr,sn)|0,vr=vr+Math.imul(Wr,_n)|0,vr=vr+Math.imul(Nr,sn)|0,Er=Er+Math.imul(Nr,_n)|0,$r=$r+Math.imul(Yr,Sn)|0,vr=vr+Math.imul(Yr,Qn)|0,vr=vr+Math.imul(Qr,Sn)|0,Er=Er+Math.imul(Qr,Qn)|0,$r=$r+Math.imul(Br,an)|0,vr=vr+Math.imul(Br,on)|0,vr=vr+Math.imul(Cr,an)|0,Er=Er+Math.imul(Cr,on)|0,$r=$r+Math.imul(Rr,pn)|0,vr=vr+Math.imul(Rr,gn)|0,vr=vr+Math.imul(Mr,pn)|0,Er=Er+Math.imul(Mr,gn)|0;var ro=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(ro>>>26)|0,ro&=67108863,$r=Math.imul(xn,Dn),vr=Math.imul(xn,Yn),vr=vr+Math.imul(In,Dn)|0,Er=Math.imul(In,Yn),$r=$r+Math.imul(hn,Mn)|0,vr=vr+Math.imul(hn,zn)|0,vr=vr+Math.imul(mn,Mn)|0,Er=Er+Math.imul(mn,zn)|0,$r=$r+Math.imul($n,Rn)|0,vr=vr+Math.imul($n,Nn)|0,vr=vr+Math.imul(en,Rn)|0,Er=Er+Math.imul(en,Nn)|0,$r=$r+Math.imul(un,kn)|0,vr=vr+Math.imul(un,Zn)|0,vr=vr+Math.imul(dn,kn)|0,Er=Er+Math.imul(dn,Zn)|0,$r=$r+Math.imul(Fr,qn)|0,vr=vr+Math.imul(Fr,io)|0,vr=vr+Math.imul(Zr,qn)|0,Er=Er+Math.imul(Zr,io)|0,$r=$r+Math.imul(Xr,sn)|0,vr=vr+Math.imul(Xr,_n)|0,vr=vr+Math.imul(qr,sn)|0,Er=Er+Math.imul(qr,_n)|0,$r=$r+Math.imul(Wr,Sn)|0,vr=vr+Math.imul(Wr,Qn)|0,vr=vr+Math.imul(Nr,Sn)|0,Er=Er+Math.imul(Nr,Qn)|0,$r=$r+Math.imul(Yr,an)|0,vr=vr+Math.imul(Yr,on)|0,vr=vr+Math.imul(Qr,an)|0,Er=Er+Math.imul(Qr,on)|0,$r=$r+Math.imul(Br,pn)|0,vr=vr+Math.imul(Br,gn)|0,vr=vr+Math.imul(Cr,pn)|0,Er=Er+Math.imul(Cr,gn)|0,$r=$r+Math.imul(Rr,Tn)|0,vr=vr+Math.imul(Rr,Bn)|0,vr=vr+Math.imul(Mr,Tn)|0,Er=Er+Math.imul(Mr,Bn)|0;var bo=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(bo>>>26)|0,bo&=67108863,$r=Math.imul(xn,Mn),vr=Math.imul(xn,zn),vr=vr+Math.imul(In,Mn)|0,Er=Math.imul(In,zn),$r=$r+Math.imul(hn,Rn)|0,vr=vr+Math.imul(hn,Nn)|0,vr=vr+Math.imul(mn,Rn)|0,Er=Er+Math.imul(mn,Nn)|0,$r=$r+Math.imul($n,kn)|0,vr=vr+Math.imul($n,Zn)|0,vr=vr+Math.imul(en,kn)|0,Er=Er+Math.imul(en,Zn)|0,$r=$r+Math.imul(un,qn)|0,vr=vr+Math.imul(un,io)|0,vr=vr+Math.imul(dn,qn)|0,Er=Er+Math.imul(dn,io)|0,$r=$r+Math.imul(Fr,sn)|0,vr=vr+Math.imul(Fr,_n)|0,vr=vr+Math.imul(Zr,sn)|0,Er=Er+Math.imul(Zr,_n)|0,$r=$r+Math.imul(Xr,Sn)|0,vr=vr+Math.imul(Xr,Qn)|0,vr=vr+Math.imul(qr,Sn)|0,Er=Er+Math.imul(qr,Qn)|0,$r=$r+Math.imul(Wr,an)|0,vr=vr+Math.imul(Wr,on)|0,vr=vr+Math.imul(Nr,an)|0,Er=Er+Math.imul(Nr,on)|0,$r=$r+Math.imul(Yr,pn)|0,vr=vr+Math.imul(Yr,gn)|0,vr=vr+Math.imul(Qr,pn)|0,Er=Er+Math.imul(Qr,gn)|0,$r=$r+Math.imul(Br,Tn)|0,vr=vr+Math.imul(Br,Bn)|0,vr=vr+Math.imul(Cr,Tn)|0,Er=Er+Math.imul(Cr,Bn)|0;var po=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(po>>>26)|0,po&=67108863,$r=Math.imul(xn,Rn),vr=Math.imul(xn,Nn),vr=vr+Math.imul(In,Rn)|0,Er=Math.imul(In,Nn),$r=$r+Math.imul(hn,kn)|0,vr=vr+Math.imul(hn,Zn)|0,vr=vr+Math.imul(mn,kn)|0,Er=Er+Math.imul(mn,Zn)|0,$r=$r+Math.imul($n,qn)|0,vr=vr+Math.imul($n,io)|0,vr=vr+Math.imul(en,qn)|0,Er=Er+Math.imul(en,io)|0,$r=$r+Math.imul(un,sn)|0,vr=vr+Math.imul(un,_n)|0,vr=vr+Math.imul(dn,sn)|0,Er=Er+Math.imul(dn,_n)|0,$r=$r+Math.imul(Fr,Sn)|0,vr=vr+Math.imul(Fr,Qn)|0,vr=vr+Math.imul(Zr,Sn)|0,Er=Er+Math.imul(Zr,Qn)|0,$r=$r+Math.imul(Xr,an)|0,vr=vr+Math.imul(Xr,on)|0,vr=vr+Math.imul(qr,an)|0,Er=Er+Math.imul(qr,on)|0,$r=$r+Math.imul(Wr,pn)|0,vr=vr+Math.imul(Wr,gn)|0,vr=vr+Math.imul(Nr,pn)|0,Er=Er+Math.imul(Nr,gn)|0,$r=$r+Math.imul(Yr,Tn)|0,vr=vr+Math.imul(Yr,Bn)|0,vr=vr+Math.imul(Qr,Tn)|0,Er=Er+Math.imul(Qr,Bn)|0;var yo=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(yo>>>26)|0,yo&=67108863,$r=Math.imul(xn,kn),vr=Math.imul(xn,Zn),vr=vr+Math.imul(In,kn)|0,Er=Math.imul(In,Zn),$r=$r+Math.imul(hn,qn)|0,vr=vr+Math.imul(hn,io)|0,vr=vr+Math.imul(mn,qn)|0,Er=Er+Math.imul(mn,io)|0,$r=$r+Math.imul($n,sn)|0,vr=vr+Math.imul($n,_n)|0,vr=vr+Math.imul(en,sn)|0,Er=Er+Math.imul(en,_n)|0,$r=$r+Math.imul(un,Sn)|0,vr=vr+Math.imul(un,Qn)|0,vr=vr+Math.imul(dn,Sn)|0,Er=Er+Math.imul(dn,Qn)|0,$r=$r+Math.imul(Fr,an)|0,vr=vr+Math.imul(Fr,on)|0,vr=vr+Math.imul(Zr,an)|0,Er=Er+Math.imul(Zr,on)|0,$r=$r+Math.imul(Xr,pn)|0,vr=vr+Math.imul(Xr,gn)|0,vr=vr+Math.imul(qr,pn)|0,Er=Er+Math.imul(qr,gn)|0,$r=$r+Math.imul(Wr,Tn)|0,vr=vr+Math.imul(Wr,Bn)|0,vr=vr+Math.imul(Nr,Tn)|0,Er=Er+Math.imul(Nr,Bn)|0;var Io=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(Io>>>26)|0,Io&=67108863,$r=Math.imul(xn,qn),vr=Math.imul(xn,io),vr=vr+Math.imul(In,qn)|0,Er=Math.imul(In,io),$r=$r+Math.imul(hn,sn)|0,vr=vr+Math.imul(hn,_n)|0,vr=vr+Math.imul(mn,sn)|0,Er=Er+Math.imul(mn,_n)|0,$r=$r+Math.imul($n,Sn)|0,vr=vr+Math.imul($n,Qn)|0,vr=vr+Math.imul(en,Sn)|0,Er=Er+Math.imul(en,Qn)|0,$r=$r+Math.imul(un,an)|0,vr=vr+Math.imul(un,on)|0,vr=vr+Math.imul(dn,an)|0,Er=Er+Math.imul(dn,on)|0,$r=$r+Math.imul(Fr,pn)|0,vr=vr+Math.imul(Fr,gn)|0,vr=vr+Math.imul(Zr,pn)|0,Er=Er+Math.imul(Zr,gn)|0,$r=$r+Math.imul(Xr,Tn)|0,vr=vr+Math.imul(Xr,Bn)|0,vr=vr+Math.imul(qr,Tn)|0,Er=Er+Math.imul(qr,Bn)|0;var So=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(So>>>26)|0,So&=67108863,$r=Math.imul(xn,sn),vr=Math.imul(xn,_n),vr=vr+Math.imul(In,sn)|0,Er=Math.imul(In,_n),$r=$r+Math.imul(hn,Sn)|0,vr=vr+Math.imul(hn,Qn)|0,vr=vr+Math.imul(mn,Sn)|0,Er=Er+Math.imul(mn,Qn)|0,$r=$r+Math.imul($n,an)|0,vr=vr+Math.imul($n,on)|0,vr=vr+Math.imul(en,an)|0,Er=Er+Math.imul(en,on)|0,$r=$r+Math.imul(un,pn)|0,vr=vr+Math.imul(un,gn)|0,vr=vr+Math.imul(dn,pn)|0,Er=Er+Math.imul(dn,gn)|0,$r=$r+Math.imul(Fr,Tn)|0,vr=vr+Math.imul(Fr,Bn)|0,vr=vr+Math.imul(Zr,Tn)|0,Er=Er+Math.imul(Zr,Bn)|0;var uo=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(uo>>>26)|0,uo&=67108863,$r=Math.imul(xn,Sn),vr=Math.imul(xn,Qn),vr=vr+Math.imul(In,Sn)|0,Er=Math.imul(In,Qn),$r=$r+Math.imul(hn,an)|0,vr=vr+Math.imul(hn,on)|0,vr=vr+Math.imul(mn,an)|0,Er=Er+Math.imul(mn,on)|0,$r=$r+Math.imul($n,pn)|0,vr=vr+Math.imul($n,gn)|0,vr=vr+Math.imul(en,pn)|0,Er=Er+Math.imul(en,gn)|0,$r=$r+Math.imul(un,Tn)|0,vr=vr+Math.imul(un,Bn)|0,vr=vr+Math.imul(dn,Tn)|0,Er=Er+Math.imul(dn,Bn)|0;var mo=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(mo>>>26)|0,mo&=67108863,$r=Math.imul(xn,an),vr=Math.imul(xn,on),vr=vr+Math.imul(In,an)|0,Er=Math.imul(In,on),$r=$r+Math.imul(hn,pn)|0,vr=vr+Math.imul(hn,gn)|0,vr=vr+Math.imul(mn,pn)|0,Er=Er+Math.imul(mn,gn)|0,$r=$r+Math.imul($n,Tn)|0,vr=vr+Math.imul($n,Bn)|0,vr=vr+Math.imul(en,Tn)|0,Er=Er+Math.imul(en,Bn)|0;var To=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(To>>>26)|0,To&=67108863,$r=Math.imul(xn,pn),vr=Math.imul(xn,gn),vr=vr+Math.imul(In,pn)|0,Er=Math.imul(In,gn),$r=$r+Math.imul(hn,Tn)|0,vr=vr+Math.imul(hn,Bn)|0,vr=vr+Math.imul(mn,Tn)|0,Er=Er+Math.imul(mn,Bn)|0;var vo=(Ir+$r|0)+((vr&8191)<<13)|0;Ir=(Er+(vr>>>13)|0)+(vo>>>26)|0,vo&=67108863,$r=Math.imul(xn,Tn),vr=Math.imul(xn,Bn),vr=vr+Math.imul(In,Tn)|0,Er=Math.imul(In,Bn);var Ro=(Ir+$r|0)+((vr&8191)<<13)|0;return Ir=(Er+(vr>>>13)|0)+(Ro>>>26)|0,Ro&=67108863,xr[0]=Un,xr[1]=Ln,xr[2]=Kn,xr[3]=Vn,xr[4]=oo,xr[5]=Fn,xr[6]=to,xr[7]=so,xr[8]=ro,xr[9]=bo,xr[10]=po,xr[11]=yo,xr[12]=Io,xr[13]=So,xr[14]=uo,xr[15]=mo,xr[16]=To,xr[17]=vo,xr[18]=Ro,Ir!==0&&(xr[19]=Ir,gr.length++),gr};Math.imul||(dr=ar);function ur(Lr,Sr,_r){_r.negative=Sr.negative^Lr.negative,_r.length=Lr.length+Sr.length;for(var gr=0,wr=0,Dr=0;Dr<_r.length-1;Dr++){var xr=wr;wr=0;for(var Ir=gr&67108863,$r=Math.min(Dr,Sr.length-1),vr=Math.max(0,Dr-Lr.length+1);vr<=$r;vr++){var Er=Dr-vr,Tr=Lr.words[Er]|0,Rr=Sr.words[vr]|0,Mr=Tr*Rr,Gr=Mr&67108863;xr=xr+(Mr/67108864|0)|0,Gr=Gr+Ir|0,Ir=Gr&67108863,xr=xr+(Gr>>>26)|0,wr+=xr>>>26,xr&=67108863}_r.words[Dr]=Ir,gr=xr,xr=wr}return gr!==0?_r.words[Dr]=gr:_r.length--,_r.strip()}function fr(Lr,Sr,_r){var gr=new pr;return gr.mulp(Lr,Sr,_r)}Nt.prototype.mulTo=function(Sr,_r){var gr,wr=this.length+Sr.length;return this.length===10&&Sr.length===10?gr=dr(this,Sr,_r):wr<63?gr=ar(this,Sr,_r):wr<1024?gr=ur(this,Sr,_r):gr=fr(this,Sr,_r),gr};function pr(Lr,Sr){this.x=Lr,this.y=Sr}pr.prototype.makeRBT=function(Sr){for(var _r=new Array(Sr),gr=Nt.prototype._countBits(Sr)-1,wr=0;wr<Sr;wr++)_r[wr]=this.revBin(wr,gr,Sr);return _r},pr.prototype.revBin=function(Sr,_r,gr){if(Sr===0||Sr===gr-1)return Sr;for(var wr=0,Dr=0;Dr<_r;Dr++)wr|=(Sr&1)<<_r-Dr-1,Sr>>=1;return wr},pr.prototype.permute=function(Sr,_r,gr,wr,Dr,xr){for(var Ir=0;Ir<xr;Ir++)wr[Ir]=_r[Sr[Ir]],Dr[Ir]=gr[Sr[Ir]]},pr.prototype.transform=function(Sr,_r,gr,wr,Dr,xr){this.permute(xr,Sr,_r,gr,wr,Dr);for(var Ir=1;Ir<Dr;Ir<<=1)for(var $r=Ir<<1,vr=Math.cos(2*Math.PI/$r),Er=Math.sin(2*Math.PI/$r),Tr=0;Tr<Dr;Tr+=$r)for(var Rr=vr,Mr=Er,Gr=0;Gr<Ir;Gr++){var Br=gr[Tr+Gr],Cr=wr[Tr+Gr],jr=gr[Tr+Gr+Ir],Yr=wr[Tr+Gr+Ir],Qr=Rr*jr-Mr*Yr;Yr=Rr*Yr+Mr*jr,jr=Qr,gr[Tr+Gr]=Br+jr,wr[Tr+Gr]=Cr+Yr,gr[Tr+Gr+Ir]=Br-jr,wr[Tr+Gr+Ir]=Cr-Yr,Gr!==$r&&(Qr=vr*Rr-Er*Mr,Mr=vr*Mr+Er*Rr,Rr=Qr)}},pr.prototype.guessLen13b=function(Sr,_r){var gr=Math.max(_r,Sr)|1,wr=gr&1,Dr=0;for(gr=gr/2|0;gr;gr=gr>>>1)Dr++;return 1<<Dr+1+wr},pr.prototype.conjugate=function(Sr,_r,gr){if(!(gr<=1))for(var wr=0;wr<gr/2;wr++){var Dr=Sr[wr];Sr[wr]=Sr[gr-wr-1],Sr[gr-wr-1]=Dr,Dr=_r[wr],_r[wr]=-_r[gr-wr-1],_r[gr-wr-1]=-Dr}},pr.prototype.normalize13b=function(Sr,_r){for(var gr=0,wr=0;wr<_r/2;wr++){var Dr=Math.round(Sr[2*wr+1]/_r)*8192+Math.round(Sr[2*wr]/_r)+gr;Sr[wr]=Dr&67108863,Dr<67108864?gr=0:gr=Dr/67108864|0}return Sr},pr.prototype.convert13b=function(Sr,_r,gr,wr){for(var Dr=0,xr=0;xr<_r;xr++)Dr=Dr+(Sr[xr]|0),gr[2*xr]=Dr&8191,Dr=Dr>>>13,gr[2*xr+1]=Dr&8191,Dr=Dr>>>13;for(xr=2*_r;xr<wr;++xr)gr[xr]=0;kt(Dr===0),kt((Dr&-8192)===0)},pr.prototype.stub=function(Sr){for(var _r=new Array(Sr),gr=0;gr<Sr;gr++)_r[gr]=0;return _r},pr.prototype.mulp=function(Sr,_r,gr){var wr=2*this.guessLen13b(Sr.length,_r.length),Dr=this.makeRBT(wr),xr=this.stub(wr),Ir=new Array(wr),$r=new Array(wr),vr=new Array(wr),Er=new Array(wr),Tr=new Array(wr),Rr=new Array(wr),Mr=gr.words;Mr.length=wr,this.convert13b(Sr.words,Sr.length,Ir,wr),this.convert13b(_r.words,_r.length,Er,wr),this.transform(Ir,xr,$r,vr,wr,Dr),this.transform(Er,xr,Tr,Rr,wr,Dr);for(var Gr=0;Gr<wr;Gr++){var Br=$r[Gr]*Tr[Gr]-vr[Gr]*Rr[Gr];vr[Gr]=$r[Gr]*Rr[Gr]+vr[Gr]*Tr[Gr],$r[Gr]=Br}return this.conjugate($r,vr,wr),this.transform($r,vr,Mr,xr,wr,Dr),this.conjugate(Mr,xr,wr),this.normalize13b(Mr,wr),gr.negative=Sr.negative^_r.negative,gr.length=Sr.length+_r.length,gr.strip()},Nt.prototype.mul=function(Sr){var _r=new Nt(null);return _r.words=new Array(this.length+Sr.length),this.mulTo(Sr,_r)},Nt.prototype.mulf=function(Sr){var _r=new Nt(null);return _r.words=new Array(this.length+Sr.length),fr(this,Sr,_r)},Nt.prototype.imul=function(Sr){return this.clone().mulTo(Sr,this)},Nt.prototype.imuln=function(Sr){kt(typeof Sr=="number"),kt(Sr<67108864);for(var _r=0,gr=0;gr<this.length;gr++){var wr=(this.words[gr]|0)*Sr,Dr=(wr&67108863)+(_r&67108863);_r>>=26,_r+=wr/67108864|0,_r+=Dr>>>26,this.words[gr]=Dr&67108863}return _r!==0&&(this.words[gr]=_r,this.length++),this},Nt.prototype.muln=function(Sr){return this.clone().imuln(Sr)},Nt.prototype.sqr=function(){return this.mul(this)},Nt.prototype.isqr=function(){return this.imul(this.clone())},Nt.prototype.pow=function(Sr){var _r=ir(Sr);if(_r.length===0)return new Nt(1);for(var gr=this,wr=0;wr<_r.length&&_r[wr]===0;wr++,gr=gr.sqr());if(++wr<_r.length)for(var Dr=gr.sqr();wr<_r.length;wr++,Dr=Dr.sqr())_r[wr]!==0&&(gr=gr.mul(Dr));return gr},Nt.prototype.iushln=function(Sr){kt(typeof Sr=="number"&&Sr>=0);var _r=Sr%26,gr=(Sr-_r)/26,wr=67108863>>>26-_r<<26-_r,Dr;if(_r!==0){var xr=0;for(Dr=0;Dr<this.length;Dr++){var Ir=this.words[Dr]&wr,$r=(this.words[Dr]|0)-Ir<<_r;this.words[Dr]=$r|xr,xr=Ir>>>26-_r}xr&&(this.words[Dr]=xr,this.length++)}if(gr!==0){for(Dr=this.length-1;Dr>=0;Dr--)this.words[Dr+gr]=this.words[Dr];for(Dr=0;Dr<gr;Dr++)this.words[Dr]=0;this.length+=gr}return this.strip()},Nt.prototype.ishln=function(Sr){return kt(this.negative===0),this.iushln(Sr)},Nt.prototype.iushrn=function(Sr,_r,gr){kt(typeof Sr=="number"&&Sr>=0);var wr;_r?wr=(_r-_r%26)/26:wr=0;var Dr=Sr%26,xr=Math.min((Sr-Dr)/26,this.length),Ir=67108863^67108863>>>Dr<<Dr,$r=gr;if(wr-=xr,wr=Math.max(0,wr),$r){for(var vr=0;vr<xr;vr++)$r.words[vr]=this.words[vr];$r.length=xr}if(xr!==0)if(this.length>xr)for(this.length-=xr,vr=0;vr<this.length;vr++)this.words[vr]=this.words[vr+xr];else this.words[0]=0,this.length=1;var Er=0;for(vr=this.length-1;vr>=0&&(Er!==0||vr>=wr);vr--){var Tr=this.words[vr]|0;this.words[vr]=Er<<26-Dr|Tr>>>Dr,Er=Tr&Ir}return $r&&Er!==0&&($r.words[$r.length++]=Er),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},Nt.prototype.ishrn=function(Sr,_r,gr){return kt(this.negative===0),this.iushrn(Sr,_r,gr)},Nt.prototype.shln=function(Sr){return this.clone().ishln(Sr)},Nt.prototype.ushln=function(Sr){return this.clone().iushln(Sr)},Nt.prototype.shrn=function(Sr){return this.clone().ishrn(Sr)},Nt.prototype.ushrn=function(Sr){return this.clone().iushrn(Sr)},Nt.prototype.testn=function(Sr){kt(typeof Sr=="number"&&Sr>=0);var _r=Sr%26,gr=(Sr-_r)/26,wr=1<<_r;if(this.length<=gr)return!1;var Dr=this.words[gr];return!!(Dr&wr)},Nt.prototype.imaskn=function(Sr){kt(typeof Sr=="number"&&Sr>=0);var _r=Sr%26,gr=(Sr-_r)/26;if(kt(this.negative===0,"imaskn works only with positive numbers"),this.length<=gr)return this;if(_r!==0&&gr++,this.length=Math.min(gr,this.length),_r!==0){var wr=67108863^67108863>>>_r<<_r;this.words[this.length-1]&=wr}return this.strip()},Nt.prototype.maskn=function(Sr){return this.clone().imaskn(Sr)},Nt.prototype.iaddn=function(Sr){return kt(typeof Sr=="number"),kt(Sr<67108864),Sr<0?this.isubn(-Sr):this.negative!==0?this.length===1&&(this.words[0]|0)<Sr?(this.words[0]=Sr-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(Sr),this.negative=1,this):this._iaddn(Sr)},Nt.prototype._iaddn=function(Sr){this.words[0]+=Sr;for(var _r=0;_r<this.length&&this.words[_r]>=67108864;_r++)this.words[_r]-=67108864,_r===this.length-1?this.words[_r+1]=1:this.words[_r+1]++;return this.length=Math.max(this.length,_r+1),this},Nt.prototype.isubn=function(Sr){if(kt(typeof Sr=="number"),kt(Sr<67108864),Sr<0)return this.iaddn(-Sr);if(this.negative!==0)return this.negative=0,this.iaddn(Sr),this.negative=1,this;if(this.words[0]-=Sr,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var _r=0;_r<this.length&&this.words[_r]<0;_r++)this.words[_r]+=67108864,this.words[_r+1]-=1;return this.strip()},Nt.prototype.addn=function(Sr){return this.clone().iaddn(Sr)},Nt.prototype.subn=function(Sr){return this.clone().isubn(Sr)},Nt.prototype.iabs=function(){return this.negative=0,this},Nt.prototype.abs=function(){return this.clone().iabs()},Nt.prototype._ishlnsubmul=function(Sr,_r,gr){var wr=Sr.length+gr,Dr;this._expand(wr);var xr,Ir=0;for(Dr=0;Dr<Sr.length;Dr++){xr=(this.words[Dr+gr]|0)+Ir;var $r=(Sr.words[Dr]|0)*_r;xr-=$r&67108863,Ir=(xr>>26)-($r/67108864|0),this.words[Dr+gr]=xr&67108863}for(;Dr<this.length-gr;Dr++)xr=(this.words[Dr+gr]|0)+Ir,Ir=xr>>26,this.words[Dr+gr]=xr&67108863;if(Ir===0)return this.strip();for(kt(Ir===-1),Ir=0,Dr=0;Dr<this.length;Dr++)xr=-(this.words[Dr]|0)+Ir,Ir=xr>>26,this.words[Dr]=xr&67108863;return this.negative=1,this.strip()},Nt.prototype._wordDiv=function(Sr,_r){var gr=this.length-Sr.length,wr=this.clone(),Dr=Sr,xr=Dr.words[Dr.length-1]|0,Ir=this._countBits(xr);gr=26-Ir,gr!==0&&(Dr=Dr.ushln(gr),wr.iushln(gr),xr=Dr.words[Dr.length-1]|0);var $r=wr.length-Dr.length,vr;if(_r!=="mod"){vr=new Nt(null),vr.length=$r+1,vr.words=new Array(vr.length);for(var Er=0;Er<vr.length;Er++)vr.words[Er]=0}var Tr=wr.clone()._ishlnsubmul(Dr,1,$r);Tr.negative===0&&(wr=Tr,vr&&(vr.words[$r]=1));for(var Rr=$r-1;Rr>=0;Rr--){var Mr=(wr.words[Dr.length+Rr]|0)*67108864+(wr.words[Dr.length+Rr-1]|0);for(Mr=Math.min(Mr/xr|0,67108863),wr._ishlnsubmul(Dr,Mr,Rr);wr.negative!==0;)Mr--,wr.negative=0,wr._ishlnsubmul(Dr,1,Rr),wr.isZero()||(wr.negative^=1);vr&&(vr.words[Rr]=Mr)}return vr&&vr.strip(),wr.strip(),_r!=="div"&&gr!==0&&wr.iushrn(gr),{div:vr||null,mod:wr}},Nt.prototype.divmod=function(Sr,_r,gr){if(kt(!Sr.isZero()),this.isZero())return{div:new Nt(0),mod:new Nt(0)};var wr,Dr,xr;return this.negative!==0&&Sr.negative===0?(xr=this.neg().divmod(Sr,_r),_r!=="mod"&&(wr=xr.div.neg()),_r!=="div"&&(Dr=xr.mod.neg(),gr&&Dr.negative!==0&&Dr.iadd(Sr)),{div:wr,mod:Dr}):this.negative===0&&Sr.negative!==0?(xr=this.divmod(Sr.neg(),_r),_r!=="mod"&&(wr=xr.div.neg()),{div:wr,mod:xr.mod}):this.negative&Sr.negative?(xr=this.neg().divmod(Sr.neg(),_r),_r!=="div"&&(Dr=xr.mod.neg(),gr&&Dr.negative!==0&&Dr.isub(Sr)),{div:xr.div,mod:Dr}):Sr.length>this.length||this.cmp(Sr)<0?{div:new Nt(0),mod:this}:Sr.length===1?_r==="div"?{div:this.divn(Sr.words[0]),mod:null}:_r==="mod"?{div:null,mod:new Nt(this.modn(Sr.words[0]))}:{div:this.divn(Sr.words[0]),mod:new Nt(this.modn(Sr.words[0]))}:this._wordDiv(Sr,_r)},Nt.prototype.div=function(Sr){return this.divmod(Sr,"div",!1).div},Nt.prototype.mod=function(Sr){return this.divmod(Sr,"mod",!1).mod},Nt.prototype.umod=function(Sr){return this.divmod(Sr,"mod",!0).mod},Nt.prototype.divRound=function(Sr){var _r=this.divmod(Sr);if(_r.mod.isZero())return _r.div;var gr=_r.div.negative!==0?_r.mod.isub(Sr):_r.mod,wr=Sr.ushrn(1),Dr=Sr.andln(1),xr=gr.cmp(wr);return xr<0||Dr===1&&xr===0?_r.div:_r.div.negative!==0?_r.div.isubn(1):_r.div.iaddn(1)},Nt.prototype.modn=function(Sr){kt(Sr<=67108863);for(var _r=(1<<26)%Sr,gr=0,wr=this.length-1;wr>=0;wr--)gr=(_r*gr+(this.words[wr]|0))%Sr;return gr},Nt.prototype.idivn=function(Sr){kt(Sr<=67108863);for(var _r=0,gr=this.length-1;gr>=0;gr--){var wr=(this.words[gr]|0)+_r*67108864;this.words[gr]=wr/Sr|0,_r=wr%Sr}return this.strip()},Nt.prototype.divn=function(Sr){return this.clone().idivn(Sr)},Nt.prototype.egcd=function(Sr){kt(Sr.negative===0),kt(!Sr.isZero());var _r=this,gr=Sr.clone();_r.negative!==0?_r=_r.umod(Sr):_r=_r.clone();for(var wr=new Nt(1),Dr=new Nt(0),xr=new Nt(0),Ir=new Nt(1),$r=0;_r.isEven()&&gr.isEven();)_r.iushrn(1),gr.iushrn(1),++$r;for(var vr=gr.clone(),Er=_r.clone();!_r.isZero();){for(var Tr=0,Rr=1;!(_r.words[0]&Rr)&&Tr<26;++Tr,Rr<<=1);if(Tr>0)for(_r.iushrn(Tr);Tr-- >0;)(wr.isOdd()||Dr.isOdd())&&(wr.iadd(vr),Dr.isub(Er)),wr.iushrn(1),Dr.iushrn(1);for(var Mr=0,Gr=1;!(gr.words[0]&Gr)&&Mr<26;++Mr,Gr<<=1);if(Mr>0)for(gr.iushrn(Mr);Mr-- >0;)(xr.isOdd()||Ir.isOdd())&&(xr.iadd(vr),Ir.isub(Er)),xr.iushrn(1),Ir.iushrn(1);_r.cmp(gr)>=0?(_r.isub(gr),wr.isub(xr),Dr.isub(Ir)):(gr.isub(_r),xr.isub(wr),Ir.isub(Dr))}return{a:xr,b:Ir,gcd:gr.iushln($r)}},Nt.prototype._invmp=function(Sr){kt(Sr.negative===0),kt(!Sr.isZero());var _r=this,gr=Sr.clone();_r.negative!==0?_r=_r.umod(Sr):_r=_r.clone();for(var wr=new Nt(1),Dr=new Nt(0),xr=gr.clone();_r.cmpn(1)>0&&gr.cmpn(1)>0;){for(var Ir=0,$r=1;!(_r.words[0]&$r)&&Ir<26;++Ir,$r<<=1);if(Ir>0)for(_r.iushrn(Ir);Ir-- >0;)wr.isOdd()&&wr.iadd(xr),wr.iushrn(1);for(var vr=0,Er=1;!(gr.words[0]&Er)&&vr<26;++vr,Er<<=1);if(vr>0)for(gr.iushrn(vr);vr-- >0;)Dr.isOdd()&&Dr.iadd(xr),Dr.iushrn(1);_r.cmp(gr)>=0?(_r.isub(gr),wr.isub(Dr)):(gr.isub(_r),Dr.isub(wr))}var Tr;return _r.cmpn(1)===0?Tr=wr:Tr=Dr,Tr.cmpn(0)<0&&Tr.iadd(Sr),Tr},Nt.prototype.gcd=function(Sr){if(this.isZero())return Sr.abs();if(Sr.isZero())return this.abs();var _r=this.clone(),gr=Sr.clone();_r.negative=0,gr.negative=0;for(var wr=0;_r.isEven()&&gr.isEven();wr++)_r.iushrn(1),gr.iushrn(1);do{for(;_r.isEven();)_r.iushrn(1);for(;gr.isEven();)gr.iushrn(1);var Dr=_r.cmp(gr);if(Dr<0){var xr=_r;_r=gr,gr=xr}else if(Dr===0||gr.cmpn(1)===0)break;_r.isub(gr)}while(!0);return gr.iushln(wr)},Nt.prototype.invm=function(Sr){return this.egcd(Sr).a.umod(Sr)},Nt.prototype.isEven=function(){return(this.words[0]&1)===0},Nt.prototype.isOdd=function(){return(this.words[0]&1)===1},Nt.prototype.andln=function(Sr){return this.words[0]&Sr},Nt.prototype.bincn=function(Sr){kt(typeof Sr=="number");var _r=Sr%26,gr=(Sr-_r)/26,wr=1<<_r;if(this.length<=gr)return this._expand(gr+1),this.words[gr]|=wr,this;for(var Dr=wr,xr=gr;Dr!==0&&xr<this.length;xr++){var Ir=this.words[xr]|0;Ir+=Dr,Dr=Ir>>>26,Ir&=67108863,this.words[xr]=Ir}return Dr!==0&&(this.words[xr]=Dr,this.length++),this},Nt.prototype.isZero=function(){return this.length===1&&this.words[0]===0},Nt.prototype.cmpn=function(Sr){var _r=Sr<0;if(this.negative!==0&&!_r)return-1;if(this.negative===0&&_r)return 1;this.strip();var gr;if(this.length>1)gr=1;else{_r&&(Sr=-Sr),kt(Sr<=67108863,"Number is too big");var wr=this.words[0]|0;gr=wr===Sr?0:wr<Sr?-1:1}return this.negative!==0?-gr|0:gr},Nt.prototype.cmp=function(Sr){if(this.negative!==0&&Sr.negative===0)return-1;if(this.negative===0&&Sr.negative!==0)return 1;var _r=this.ucmp(Sr);return this.negative!==0?-_r|0:_r},Nt.prototype.ucmp=function(Sr){if(this.length>Sr.length)return 1;if(this.length<Sr.length)return-1;for(var _r=0,gr=this.length-1;gr>=0;gr--){var wr=this.words[gr]|0,Dr=Sr.words[gr]|0;if(wr!==Dr){wr<Dr?_r=-1:wr>Dr&&(_r=1);break}}return _r},Nt.prototype.gtn=function(Sr){return this.cmpn(Sr)===1},Nt.prototype.gt=function(Sr){return this.cmp(Sr)===1},Nt.prototype.gten=function(Sr){return this.cmpn(Sr)>=0},Nt.prototype.gte=function(Sr){return this.cmp(Sr)>=0},Nt.prototype.ltn=function(Sr){return this.cmpn(Sr)===-1},Nt.prototype.lt=function(Sr){return this.cmp(Sr)===-1},Nt.prototype.lten=function(Sr){return this.cmpn(Sr)<=0},Nt.prototype.lte=function(Sr){return this.cmp(Sr)<=0},Nt.prototype.eqn=function(Sr){return this.cmpn(Sr)===0},Nt.prototype.eq=function(Sr){return this.cmp(Sr)===0},Nt.red=function(Sr){return new Ur(Sr)},Nt.prototype.toRed=function(Sr){return kt(!this.red,"Already a number in reduction context"),kt(this.negative===0,"red works only with positives"),Sr.convertTo(this)._forceRed(Sr)},Nt.prototype.fromRed=function(){return kt(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},Nt.prototype._forceRed=function(Sr){return this.red=Sr,this},Nt.prototype.forceRed=function(Sr){return kt(!this.red,"Already a number in reduction context"),this._forceRed(Sr)},Nt.prototype.redAdd=function(Sr){return kt(this.red,"redAdd works only with red numbers"),this.red.add(this,Sr)},Nt.prototype.redIAdd=function(Sr){return kt(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,Sr)},Nt.prototype.redSub=function(Sr){return kt(this.red,"redSub works only with red numbers"),this.red.sub(this,Sr)},Nt.prototype.redISub=function(Sr){return kt(this.red,"redISub works only with red numbers"),this.red.isub(this,Sr)},Nt.prototype.redShl=function(Sr){return kt(this.red,"redShl works only with red numbers"),this.red.shl(this,Sr)},Nt.prototype.redMul=function(Sr){return kt(this.red,"redMul works only with red numbers"),this.red._verify2(this,Sr),this.red.mul(this,Sr)},Nt.prototype.redIMul=function(Sr){return kt(this.red,"redMul works only with red numbers"),this.red._verify2(this,Sr),this.red.imul(this,Sr)},Nt.prototype.redSqr=function(){return kt(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},Nt.prototype.redISqr=function(){return kt(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},Nt.prototype.redSqrt=function(){return kt(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},Nt.prototype.redInvm=function(){return kt(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},Nt.prototype.redNeg=function(){return kt(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},Nt.prototype.redPow=function(Sr){return kt(this.red&&!Sr.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,Sr)};var lr={k256:null,p224:null,p192:null,p25519:null};function yr(Lr,Sr){this.name=Lr,this.p=new Nt(Sr,16),this.n=this.p.bitLength(),this.k=new Nt(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}yr.prototype._tmp=function(){var Sr=new Nt(null);return Sr.words=new Array(Math.ceil(this.n/13)),Sr},yr.prototype.ireduce=function(Sr){var _r=Sr,gr;do this.split(_r,this.tmp),_r=this.imulK(_r),_r=_r.iadd(this.tmp),gr=_r.bitLength();while(gr>this.n);var wr=gr<this.n?-1:_r.ucmp(this.p);return wr===0?(_r.words[0]=0,_r.length=1):wr>0?_r.isub(this.p):_r.strip!==void 0?_r.strip():_r._strip(),_r},yr.prototype.split=function(Sr,_r){Sr.iushrn(this.n,0,_r)},yr.prototype.imulK=function(Sr){return Sr.imul(this.k)};function br(){yr.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}Bt(br,yr),br.prototype.split=function(Sr,_r){for(var gr=4194303,wr=Math.min(Sr.length,9),Dr=0;Dr<wr;Dr++)_r.words[Dr]=Sr.words[Dr];if(_r.length=wr,Sr.length<=9){Sr.words[0]=0,Sr.length=1;return}var xr=Sr.words[9];for(_r.words[_r.length++]=xr&gr,Dr=10;Dr<Sr.length;Dr++){var Ir=Sr.words[Dr]|0;Sr.words[Dr-10]=(Ir&gr)<<4|xr>>>22,xr=Ir}xr>>>=22,Sr.words[Dr-10]=xr,xr===0&&Sr.length>10?Sr.length-=10:Sr.length-=9},br.prototype.imulK=function(Sr){Sr.words[Sr.length]=0,Sr.words[Sr.length+1]=0,Sr.length+=2;for(var _r=0,gr=0;gr<Sr.length;gr++){var wr=Sr.words[gr]|0;_r+=wr*977,Sr.words[gr]=_r&67108863,_r=wr*64+(_r/67108864|0)}return Sr.words[Sr.length-1]===0&&(Sr.length--,Sr.words[Sr.length-1]===0&&Sr.length--),Sr};function Ar(){yr.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}Bt(Ar,yr);function Pr(){yr.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}Bt(Pr,yr);function kr(){yr.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}Bt(kr,yr),kr.prototype.imulK=function(Sr){for(var _r=0,gr=0;gr<Sr.length;gr++){var wr=(Sr.words[gr]|0)*19+_r,Dr=wr&67108863;wr>>>=26,Sr.words[gr]=Dr,_r=wr}return _r!==0&&(Sr.words[Sr.length++]=_r),Sr},Nt._prime=function(Sr){if(lr[Sr])return lr[Sr];var _r;if(Sr==="k256")_r=new br;else if(Sr==="p224")_r=new Ar;else if(Sr==="p192")_r=new Pr;else if(Sr==="p25519")_r=new kr;else throw new Error("Unknown prime "+Sr);return lr[Sr]=_r,_r};function Ur(Lr){if(typeof Lr=="string"){var Sr=Nt._prime(Lr);this.m=Sr.p,this.prime=Sr}else kt(Lr.gtn(1),"modulus must be greater than 1"),this.m=Lr,this.prime=null}Ur.prototype._verify1=function(Sr){kt(Sr.negative===0,"red works only with positives"),kt(Sr.red,"red works only with red numbers")},Ur.prototype._verify2=function(Sr,_r){kt((Sr.negative|_r.negative)===0,"red works only with positives"),kt(Sr.red&&Sr.red===_r.red,"red works only with red numbers")},Ur.prototype.imod=function(Sr){return this.prime?this.prime.ireduce(Sr)._forceRed(this):Sr.umod(this.m)._forceRed(this)},Ur.prototype.neg=function(Sr){return Sr.isZero()?Sr.clone():this.m.sub(Sr)._forceRed(this)},Ur.prototype.add=function(Sr,_r){this._verify2(Sr,_r);var gr=Sr.add(_r);return gr.cmp(this.m)>=0&&gr.isub(this.m),gr._forceRed(this)},Ur.prototype.iadd=function(Sr,_r){this._verify2(Sr,_r);var gr=Sr.iadd(_r);return gr.cmp(this.m)>=0&&gr.isub(this.m),gr},Ur.prototype.sub=function(Sr,_r){this._verify2(Sr,_r);var gr=Sr.sub(_r);return gr.cmpn(0)<0&&gr.iadd(this.m),gr._forceRed(this)},Ur.prototype.isub=function(Sr,_r){this._verify2(Sr,_r);var gr=Sr.isub(_r);return gr.cmpn(0)<0&&gr.iadd(this.m),gr},Ur.prototype.shl=function(Sr,_r){return this._verify1(Sr),this.imod(Sr.ushln(_r))},Ur.prototype.imul=function(Sr,_r){return this._verify2(Sr,_r),this.imod(Sr.imul(_r))},Ur.prototype.mul=function(Sr,_r){return this._verify2(Sr,_r),this.imod(Sr.mul(_r))},Ur.prototype.isqr=function(Sr){return this.imul(Sr,Sr.clone())},Ur.prototype.sqr=function(Sr){return this.mul(Sr,Sr)},Ur.prototype.sqrt=function(Sr){if(Sr.isZero())return Sr.clone();var _r=this.m.andln(3);if(kt(_r%2===1),_r===3){var gr=this.m.add(new Nt(1)).iushrn(2);return this.pow(Sr,gr)}for(var wr=this.m.subn(1),Dr=0;!wr.isZero()&&wr.andln(1)===0;)Dr++,wr.iushrn(1);kt(!wr.isZero());var xr=new Nt(1).toRed(this),Ir=xr.redNeg(),$r=this.m.subn(1).iushrn(1),vr=this.m.bitLength();for(vr=new Nt(2*vr*vr).toRed(this);this.pow(vr,$r).cmp(Ir)!==0;)vr.redIAdd(Ir);for(var Er=this.pow(vr,wr),Tr=this.pow(Sr,wr.addn(1).iushrn(1)),Rr=this.pow(Sr,wr),Mr=Dr;Rr.cmp(xr)!==0;){for(var Gr=Rr,Br=0;Gr.cmp(xr)!==0;Br++)Gr=Gr.redSqr();kt(Br<Mr);var Cr=this.pow(Er,new Nt(1).iushln(Mr-Br-1));Tr=Tr.redMul(Cr),Er=Cr.redSqr(),Rr=Rr.redMul(Er),Mr=Br}return Tr},Ur.prototype.invm=function(Sr){var _r=Sr._invmp(this.m);return _r.negative!==0?(_r.negative=0,this.imod(_r).redNeg()):this.imod(_r)},Ur.prototype.pow=function(Sr,_r){if(_r.isZero())return new Nt(1).toRed(this);if(_r.cmpn(1)===0)return Sr.clone();var gr=4,wr=new Array(1<<gr);wr[0]=new Nt(1).toRed(this),wr[1]=Sr;for(var Dr=2;Dr<wr.length;Dr++)wr[Dr]=this.mul(wr[Dr-1],Sr);var xr=wr[0],Ir=0,$r=0,vr=_r.bitLength()%26;for(vr===0&&(vr=26),Dr=_r.length-1;Dr>=0;Dr--){for(var Er=_r.words[Dr],Tr=vr-1;Tr>=0;Tr--){var Rr=Er>>Tr&1;if(xr!==wr[0]&&(xr=this.sqr(xr)),Rr===0&&Ir===0){$r=0;continue}Ir<<=1,Ir|=Rr,$r++,!($r!==gr&&(Dr!==0||Tr!==0))&&(xr=this.mul(xr,wr[Ir]),$r=0,Ir=0)}vr=26}return xr},Ur.prototype.convertTo=function(Sr){var _r=Sr.umod(this.m);return _r===Sr?_r.clone():_r},Ur.prototype.convertFrom=function(Sr){var _r=Sr.clone();return _r.red=null,_r},Nt.mont=function(Sr){return new Hr(Sr)};function Hr(Lr){Ur.call(this,Lr),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new Nt(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}Bt(Hr,Ur),Hr.prototype.convertTo=function(Sr){return this.imod(Sr.ushln(this.shift))},Hr.prototype.convertFrom=function(Sr){var _r=this.imod(Sr.mul(this.rinv));return _r.red=null,_r},Hr.prototype.imul=function(Sr,_r){if(Sr.isZero()||_r.isZero())return Sr.words[0]=0,Sr.length=1,Sr;var gr=Sr.imul(_r),wr=gr.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Dr=gr.isub(wr).iushrn(this.shift),xr=Dr;return Dr.cmp(this.m)>=0?xr=Dr.isub(this.m):Dr.cmpn(0)<0&&(xr=Dr.iadd(this.m)),xr._forceRed(this)},Hr.prototype.mul=function(Sr,_r){if(Sr.isZero()||_r.isZero())return new Nt(0)._forceRed(this);var gr=Sr.mul(_r),wr=gr.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Dr=gr.isub(wr).iushrn(this.shift),xr=Dr;return Dr.cmp(this.m)>=0?xr=Dr.isub(this.m):Dr.cmpn(0)<0&&(xr=Dr.iadd(this.m)),xr._forceRed(this)},Hr.prototype.invm=function(Sr){var _r=this.imod(Sr._invmp(this.m).mul(this.r2));return _r._forceRed(this)}})(xt,commonjsGlobal)})(bn$1);var bnExports$1=bn$1.exports,brorand={exports:{}},hasRequiredBrorand;function requireBrorand(){if(hasRequiredBrorand)return brorand.exports;hasRequiredBrorand=1;var xt;brorand.exports=function(Bt){return xt||(xt=new e(null)),xt.generate(Bt)};function e(kt){this.rand=kt}if(brorand.exports.Rand=e,e.prototype.generate=function(Bt){return this._rand(Bt)},e.prototype._rand=function(Bt){if(this.rand.getBytes)return this.rand.getBytes(Bt);for(var Nt=new Uint8Array(Bt),jt=0;jt<Nt.length;jt++)Nt[jt]=this.rand.getByte();return Nt},typeof self=="object")self.crypto&&self.crypto.getRandomValues?e.prototype._rand=function(Bt){var Nt=new Uint8Array(Bt);return self.crypto.getRandomValues(Nt),Nt}:self.msCrypto&&self.msCrypto.getRandomValues?e.prototype._rand=function(Bt){var Nt=new Uint8Array(Bt);return self.msCrypto.getRandomValues(Nt),Nt}:typeof window=="object"&&(e.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var At=requireCryptoBrowserify();if(typeof At.randomBytes!="function")throw new Error("Not supported");e.prototype._rand=function(Bt){return At.randomBytes(Bt)}}catch{}return brorand.exports}var mr,hasRequiredMr;function requireMr(){if(hasRequiredMr)return mr;hasRequiredMr=1;var xt=bnExports$1,e=requireBrorand();function At(kt){this.rand=kt||new e.Rand}return mr=At,At.create=function(Bt){return new At(Bt)},At.prototype._randbelow=function(Bt){var Nt=Bt.bitLength(),jt=Math.ceil(Nt/8);do var Lt=new xt(this.rand.generate(jt));while(Lt.cmp(Bt)>=0);return Lt},At.prototype._randrange=function(Bt,Nt){var jt=Nt.sub(Bt);return Bt.add(this._randbelow(jt))},At.prototype.test=function(Bt,Nt,jt){var Lt=Bt.bitLength(),er=xt.mont(Bt),tr=new xt(1).toRed(er);Nt||(Nt=Math.max(1,Lt/48|0));for(var zt=Bt.subn(1),rr=0;!zt.testn(rr);rr++);for(var nr=Bt.shrn(rr),ir=zt.toRed(er),ar=!0;Nt>0;Nt--){var dr=this._randrange(new xt(2),zt);jt&&jt(dr);var ur=dr.toRed(er).redPow(nr);if(!(ur.cmp(tr)===0||ur.cmp(ir)===0)){for(var fr=1;fr<rr;fr++){if(ur=ur.redSqr(),ur.cmp(tr)===0)return!1;if(ur.cmp(ir)===0)break}if(fr===rr)return!1}}return ar},At.prototype.getDivisor=function(Bt,Nt){var jt=Bt.bitLength(),Lt=xt.mont(Bt),er=new xt(1).toRed(Lt);Nt||(Nt=Math.max(1,jt/48|0));for(var tr=Bt.subn(1),zt=0;!tr.testn(zt);zt++);for(var rr=Bt.shrn(zt),nr=tr.toRed(Lt);Nt>0;Nt--){var ir=this._randrange(new xt(2),tr),ar=Bt.gcd(ir);if(ar.cmpn(1)!==0)return ar;var dr=ir.toRed(Lt).redPow(rr);if(!(dr.cmp(er)===0||dr.cmp(nr)===0)){for(var ur=1;ur<zt;ur++){if(dr=dr.redSqr(),dr.cmp(er)===0)return dr.fromRed().subn(1).gcd(Bt);if(dr.cmp(nr)===0)break}if(ur===zt)return dr=dr.redSqr(),dr.fromRed().subn(1).gcd(Bt)}}return!1},mr}var generatePrime,hasRequiredGeneratePrime;function requireGeneratePrime(){if(hasRequiredGeneratePrime)return generatePrime;hasRequiredGeneratePrime=1;var xt=browserExports$2;generatePrime=ur,ur.simpleSieve=ar,ur.fermatTest=dr;var e=bnExports$1,At=new e(24),kt=requireMr(),Bt=new kt,Nt=new e(1),jt=new e(2),Lt=new e(5);new e(16),new e(8);var er=new e(10),tr=new e(3);new e(7);var zt=new e(11),rr=new e(4);new e(12);var nr=null;function ir(){if(nr!==null)return nr;var fr=1048576,pr=[];pr[0]=2;for(var lr=1,yr=3;yr<fr;yr+=2){for(var br=Math.ceil(Math.sqrt(yr)),Ar=0;Ar<lr&&pr[Ar]<=br&&yr%pr[Ar]!==0;Ar++);lr!==Ar&&pr[Ar]<=br||(pr[lr++]=yr)}return nr=pr,pr}function ar(fr){for(var pr=ir(),lr=0;lr<pr.length;lr++)if(fr.modn(pr[lr])===0)return fr.cmpn(pr[lr])===0;return!0}function dr(fr){var pr=e.mont(fr);return jt.toRed(pr).redPow(fr.subn(1)).fromRed().cmpn(1)===0}function ur(fr,pr){if(fr<16)return pr===2||pr===5?new e([140,123]):new e([140,39]);pr=new e(pr);for(var lr,yr;;){for(lr=new e(xt(Math.ceil(fr/8)));lr.bitLength()>fr;)lr.ishrn(1);if(lr.isEven()&&lr.iadd(Nt),lr.testn(1)||lr.iadd(jt),pr.cmp(jt)){if(!pr.cmp(Lt))for(;lr.mod(er).cmp(tr);)lr.iadd(rr)}else for(;lr.mod(At).cmp(zt);)lr.iadd(rr);if(yr=lr.shrn(1),ar(yr)&&ar(lr)&&dr(yr)&&dr(lr)&&Bt.test(yr)&&Bt.test(lr))return lr}}return generatePrime}const modp1={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18={gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"},require$$1$3={modp1,modp2,modp5,modp14,modp15,modp16,modp17,modp18};var dh,hasRequiredDh;function requireDh(){if(hasRequiredDh)return dh;hasRequiredDh=1;var xt=bnExports$1,e=requireMr(),At=new e,kt=new xt(24),Bt=new xt(11),Nt=new xt(10),jt=new xt(3),Lt=new xt(7),er=requireGeneratePrime(),tr=browserExports$2;dh=ar;function zt(ur,fr){return fr=fr||"utf8",buffer$2.Buffer.isBuffer(ur)||(ur=new buffer$2.Buffer(ur,fr)),this._pub=new xt(ur),this}function rr(ur,fr){return fr=fr||"utf8",buffer$2.Buffer.isBuffer(ur)||(ur=new buffer$2.Buffer(ur,fr)),this._priv=new xt(ur),this}var nr={};function ir(ur,fr){var pr=fr.toString("hex"),lr=[pr,ur.toString(16)].join("_");if(lr in nr)return nr[lr];var yr=0;if(ur.isEven()||!er.simpleSieve||!er.fermatTest(ur)||!At.test(ur))return yr+=1,pr==="02"||pr==="05"?yr+=8:yr+=4,nr[lr]=yr,yr;At.test(ur.shrn(1))||(yr+=2);var br;switch(pr){case"02":ur.mod(kt).cmp(Bt)&&(yr+=8);break;case"05":br=ur.mod(Nt),br.cmp(jt)&&br.cmp(Lt)&&(yr+=8);break;default:yr+=4}return nr[lr]=yr,yr}function ar(ur,fr,pr){this.setGenerator(fr),this.__prime=new xt(ur),this._prime=xt.mont(this.__prime),this._primeLen=ur.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,pr?(this.setPublicKey=zt,this.setPrivateKey=rr):this._primeCode=8}Object.defineProperty(ar.prototype,"verifyError",{enumerable:!0,get:function(){return typeof this._primeCode!="number"&&(this._primeCode=ir(this.__prime,this.__gen)),this._primeCode}}),ar.prototype.generateKeys=function(){return this._priv||(this._priv=new xt(tr(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},ar.prototype.computeSecret=function(ur){ur=new xt(ur),ur=ur.toRed(this._prime);var fr=ur.redPow(this._priv).fromRed(),pr=new buffer$2.Buffer(fr.toArray()),lr=this.getPrime();if(pr.length<lr.length){var yr=new buffer$2.Buffer(lr.length-pr.length);yr.fill(0),pr=buffer$2.Buffer.concat([yr,pr])}return pr},ar.prototype.getPublicKey=function(fr){return dr(this._pub,fr)},ar.prototype.getPrivateKey=function(fr){return dr(this._priv,fr)},ar.prototype.getPrime=function(ur){return dr(this.__prime,ur)},ar.prototype.getGenerator=function(ur){return dr(this._gen,ur)},ar.prototype.setGenerator=function(ur,fr){return fr=fr||"utf8",buffer$2.Buffer.isBuffer(ur)||(ur=new buffer$2.Buffer(ur,fr)),this.__gen=ur,this._gen=new xt(ur),this};function dr(ur,fr){var pr=new buffer$2.Buffer(ur.toArray());return fr?pr.toString(fr):pr}return dh}var hasRequiredBrowser$3;function requireBrowser$3(){if(hasRequiredBrowser$3)return browser$7;hasRequiredBrowser$3=1;var xt=requireGeneratePrime(),e=require$$1$3,At=requireDh();function kt(jt){var Lt=new buffer$2.Buffer(e[jt].prime,"hex"),er=new buffer$2.Buffer(e[jt].gen,"hex");return new At(Lt,er)}var Bt={binary:!0,hex:!0,base64:!0};function Nt(jt,Lt,er,tr){return buffer$2.Buffer.isBuffer(Lt)||Bt[Lt]===void 0?Nt(jt,"binary",Lt,er):(Lt=Lt||"binary",tr=tr||"binary",er=er||new buffer$2.Buffer([2]),buffer$2.Buffer.isBuffer(er)||(er=new buffer$2.Buffer(er,tr)),typeof jt=="number"?new At(xt(jt,er),er,!0):(buffer$2.Buffer.isBuffer(jt)||(jt=new buffer$2.Buffer(jt,Lt)),new At(jt,er,!0)))}return browser$7.DiffieHellmanGroup=browser$7.createDiffieHellmanGroup=browser$7.getDiffieHellman=kt,browser$7.createDiffieHellman=browser$7.DiffieHellman=Nt,browser$7}var readableBrowser={exports:{}},processNextickArgs={exports:{}};typeof process$9>"u"||!process$9.version||process$9.version.indexOf("v0.")===0||process$9.version.indexOf("v1.")===0&&process$9.version.indexOf("v1.8.")!==0?processNextickArgs.exports={nextTick:nextTick$2}:processNextickArgs.exports=process$9;function nextTick$2(xt,e,At,kt){if(typeof xt!="function")throw new TypeError('"callback" argument must be a function');var Bt=arguments.length,Nt,jt;switch(Bt){case 0:case 1:return process$9.nextTick(xt);case 2:return process$9.nextTick(function(){xt.call(null,e)});case 3:return process$9.nextTick(function(){xt.call(null,e,At)});case 4:return process$9.nextTick(function(){xt.call(null,e,At,kt)});default:for(Nt=new Array(Bt-1),jt=0;jt<Nt.length;)Nt[jt++]=arguments[jt];return process$9.nextTick(function(){xt.apply(null,Nt)})}}var processNextickArgsExports=processNextickArgs.exports,toString$5={}.toString,isarray=Array.isArray||function(xt){return toString$5.call(xt)=="[object Array]"},streamBrowser=eventsExports.EventEmitter,safeBuffer$1={exports:{}};(function(xt,e){var At=buffer$2,kt=At.Buffer;function Bt(jt,Lt){for(var er in jt)Lt[er]=jt[er]}kt.from&&kt.alloc&&kt.allocUnsafe&&kt.allocUnsafeSlow?xt.exports=At:(Bt(At,e),e.Buffer=Nt);function Nt(jt,Lt,er){return kt(jt,Lt,er)}Bt(kt,Nt),Nt.from=function(jt,Lt,er){if(typeof jt=="number")throw new TypeError("Argument must not be a number");return kt(jt,Lt,er)},Nt.alloc=function(jt,Lt,er){if(typeof jt!="number")throw new TypeError("Argument must be a number");var tr=kt(jt);return Lt!==void 0?typeof er=="string"?tr.fill(Lt,er):tr.fill(Lt):tr.fill(0),tr},Nt.allocUnsafe=function(jt){if(typeof jt!="number")throw new TypeError("Argument must be a number");return kt(jt)},Nt.allocUnsafeSlow=function(jt){if(typeof jt!="number")throw new TypeError("Argument must be a number");return At.SlowBuffer(jt)}})(safeBuffer$1,safeBuffer$1.exports);var safeBufferExports=safeBuffer$1.exports,util$5={};function isArray(xt){return Array.isArray?Array.isArray(xt):objectToString$1(xt)==="[object Array]"}util$5.isArray=isArray;function isBoolean(xt){return typeof xt=="boolean"}util$5.isBoolean=isBoolean;function isNull(xt){return xt===null}util$5.isNull=isNull;function isNullOrUndefined(xt){return xt==null}util$5.isNullOrUndefined=isNullOrUndefined;function isNumber(xt){return typeof xt=="number"}util$5.isNumber=isNumber;function isString(xt){return typeof xt=="string"}util$5.isString=isString;function isSymbol(xt){return typeof xt=="symbol"}util$5.isSymbol=isSymbol;function isUndefined(xt){return xt===void 0}util$5.isUndefined=isUndefined;function isRegExp(xt){return objectToString$1(xt)==="[object RegExp]"}util$5.isRegExp=isRegExp;function isObject(xt){return typeof xt=="object"&&xt!==null}util$5.isObject=isObject;function isDate(xt){return objectToString$1(xt)==="[object Date]"}util$5.isDate=isDate;function isError$1(xt){return objectToString$1(xt)==="[object Error]"||xt instanceof Error}util$5.isError=isError$1;function isFunction(xt){return typeof xt=="function"}util$5.isFunction=isFunction;function isPrimitive(xt){return xt===null||typeof xt=="boolean"||typeof xt=="number"||typeof xt=="string"||typeof xt=="symbol"||typeof xt>"u"}util$5.isPrimitive=isPrimitive;util$5.isBuffer=buffer$2.Buffer.isBuffer;function objectToString$1(xt){return Object.prototype.toString.call(xt)}var BufferList={exports:{}},hasRequiredBufferList;function requireBufferList(){return hasRequiredBufferList||(hasRequiredBufferList=1,function(xt){function e(Nt,jt){if(!(Nt instanceof jt))throw new TypeError("Cannot call a class as a function")}var At=safeBufferExports.Buffer,kt=util$6;function Bt(Nt,jt,Lt){Nt.copy(jt,Lt)}xt.exports=function(){function Nt(){e(this,Nt),this.head=null,this.tail=null,this.length=0}return Nt.prototype.push=function(Lt){var er={data:Lt,next:null};this.length>0?this.tail.next=er:this.head=er,this.tail=er,++this.length},Nt.prototype.unshift=function(Lt){var er={data:Lt,next:this.head};this.length===0&&(this.tail=er),this.head=er,++this.length},Nt.prototype.shift=function(){if(this.length!==0){var Lt=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,Lt}},Nt.prototype.clear=function(){this.head=this.tail=null,this.length=0},Nt.prototype.join=function(Lt){if(this.length===0)return"";for(var er=this.head,tr=""+er.data;er=er.next;)tr+=Lt+er.data;return tr},Nt.prototype.concat=function(Lt){if(this.length===0)return At.alloc(0);for(var er=At.allocUnsafe(Lt>>>0),tr=this.head,zt=0;tr;)Bt(tr.data,er,zt),zt+=tr.data.length,tr=tr.next;return er},Nt}(),kt&&kt.inspect&&kt.inspect.custom&&(xt.exports.prototype[kt.inspect.custom]=function(){var Nt=kt.inspect({length:this.length});return this.constructor.name+" "+Nt})}(BufferList)),BufferList.exports}var pna=processNextickArgsExports;function destroy$2(xt,e){var At=this,kt=this._readableState&&this._readableState.destroyed,Bt=this._writableState&&this._writableState.destroyed;return kt||Bt?(e?e(xt):xt&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,pna.nextTick(emitErrorNT$2,this,xt)):pna.nextTick(emitErrorNT$2,this,xt)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(xt||null,function(Nt){!e&&Nt?At._writableState?At._writableState.errorEmitted||(At._writableState.errorEmitted=!0,pna.nextTick(emitErrorNT$2,At,Nt)):pna.nextTick(emitErrorNT$2,At,Nt):e&&e(Nt)}),this)}function undestroy$2(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function emitErrorNT$2(xt,e){xt.emit("error",e)}var destroy_1$2={destroy:destroy$2,undestroy:undestroy$2},_stream_writable,hasRequired_stream_writable;function require_stream_writable(){if(hasRequired_stream_writable)return _stream_writable;hasRequired_stream_writable=1;var xt=processNextickArgsExports;_stream_writable=dr;function e(xr){var Ir=this;this.next=null,this.entry=null,this.finish=function(){Dr(Ir,xr)}}var At=!process$9.browser&&["v0.10","v0.9."].indexOf(process$9.version.slice(0,5))>-1?setImmediate:xt.nextTick,kt;dr.WritableState=ir;var Bt=Object.create(util$5);Bt.inherits=inherits_browserExports;var Nt={deprecate:browser$d},jt=streamBrowser,Lt=safeBufferExports.Buffer,er=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function tr(xr){return Lt.from(xr)}function zt(xr){return Lt.isBuffer(xr)||xr instanceof er}var rr=destroy_1$2;Bt.inherits(dr,jt);function nr(){}function ir(xr,Ir){kt=kt||require_stream_duplex(),xr=xr||{};var $r=Ir instanceof kt;this.objectMode=!!xr.objectMode,$r&&(this.objectMode=this.objectMode||!!xr.writableObjectMode);var vr=xr.highWaterMark,Er=xr.writableHighWaterMark,Tr=this.objectMode?16:16*1024;vr||vr===0?this.highWaterMark=vr:$r&&(Er||Er===0)?this.highWaterMark=Er:this.highWaterMark=Tr,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var Rr=xr.decodeStrings===!1;this.decodeStrings=!Rr,this.defaultEncoding=xr.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(Mr){Pr(Ir,Mr)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}ir.prototype.getBuffer=function(){for(var Ir=this.bufferedRequest,$r=[];Ir;)$r.push(Ir),Ir=Ir.next;return $r},function(){try{Object.defineProperty(ir.prototype,"buffer",{get:Nt.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var ar;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(ar=Function.prototype[Symbol.hasInstance],Object.defineProperty(dr,Symbol.hasInstance,{value:function(xr){return ar.call(this,xr)?!0:this!==dr?!1:xr&&xr._writableState instanceof ir}})):ar=function(xr){return xr instanceof this};function dr(xr){if(kt=kt||require_stream_duplex(),!ar.call(dr,this)&&!(this instanceof kt))return new dr(xr);this._writableState=new ir(xr,this),this.writable=!0,xr&&(typeof xr.write=="function"&&(this._write=xr.write),typeof xr.writev=="function"&&(this._writev=xr.writev),typeof xr.destroy=="function"&&(this._destroy=xr.destroy),typeof xr.final=="function"&&(this._final=xr.final)),jt.call(this)}dr.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function ur(xr,Ir){var $r=new Error("write after end");xr.emit("error",$r),xt.nextTick(Ir,$r)}function fr(xr,Ir,$r,vr){var Er=!0,Tr=!1;return $r===null?Tr=new TypeError("May not write null values to stream"):typeof $r!="string"&&$r!==void 0&&!Ir.objectMode&&(Tr=new TypeError("Invalid non-string/buffer chunk")),Tr&&(xr.emit("error",Tr),xt.nextTick(vr,Tr),Er=!1),Er}dr.prototype.write=function(xr,Ir,$r){var vr=this._writableState,Er=!1,Tr=!vr.objectMode&&zt(xr);return Tr&&!Lt.isBuffer(xr)&&(xr=tr(xr)),typeof Ir=="function"&&($r=Ir,Ir=null),Tr?Ir="buffer":Ir||(Ir=vr.defaultEncoding),typeof $r!="function"&&($r=nr),vr.ended?ur(this,$r):(Tr||fr(this,vr,xr,$r))&&(vr.pendingcb++,Er=lr(this,vr,Tr,xr,Ir,$r)),Er},dr.prototype.cork=function(){var xr=this._writableState;xr.corked++},dr.prototype.uncork=function(){var xr=this._writableState;xr.corked&&(xr.corked--,!xr.writing&&!xr.corked&&!xr.bufferProcessing&&xr.bufferedRequest&&Hr(this,xr))},dr.prototype.setDefaultEncoding=function(Ir){if(typeof Ir=="string"&&(Ir=Ir.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((Ir+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+Ir);return this._writableState.defaultEncoding=Ir,this};function pr(xr,Ir,$r){return!xr.objectMode&&xr.decodeStrings!==!1&&typeof Ir=="string"&&(Ir=Lt.from(Ir,$r)),Ir}Object.defineProperty(dr.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function lr(xr,Ir,$r,vr,Er,Tr){if(!$r){var Rr=pr(Ir,vr,Er);vr!==Rr&&($r=!0,Er="buffer",vr=Rr)}var Mr=Ir.objectMode?1:vr.length;Ir.length+=Mr;var Gr=Ir.length<Ir.highWaterMark;if(Gr||(Ir.needDrain=!0),Ir.writing||Ir.corked){var Br=Ir.lastBufferedRequest;Ir.lastBufferedRequest={chunk:vr,encoding:Er,isBuf:$r,callback:Tr,next:null},Br?Br.next=Ir.lastBufferedRequest:Ir.bufferedRequest=Ir.lastBufferedRequest,Ir.bufferedRequestCount+=1}else yr(xr,Ir,!1,Mr,vr,Er,Tr);return Gr}function yr(xr,Ir,$r,vr,Er,Tr,Rr){Ir.writelen=vr,Ir.writecb=Rr,Ir.writing=!0,Ir.sync=!0,$r?xr._writev(Er,Ir.onwrite):xr._write(Er,Tr,Ir.onwrite),Ir.sync=!1}function br(xr,Ir,$r,vr,Er){--Ir.pendingcb,$r?(xt.nextTick(Er,vr),xt.nextTick(gr,xr,Ir),xr._writableState.errorEmitted=!0,xr.emit("error",vr)):(Er(vr),xr._writableState.errorEmitted=!0,xr.emit("error",vr),gr(xr,Ir))}function Ar(xr){xr.writing=!1,xr.writecb=null,xr.length-=xr.writelen,xr.writelen=0}function Pr(xr,Ir){var $r=xr._writableState,vr=$r.sync,Er=$r.writecb;if(Ar($r),Ir)br(xr,$r,vr,Ir,Er);else{var Tr=Lr($r);!Tr&&!$r.corked&&!$r.bufferProcessing&&$r.bufferedRequest&&Hr(xr,$r),vr?At(kr,xr,$r,Tr,Er):kr(xr,$r,Tr,Er)}}function kr(xr,Ir,$r,vr){$r||Ur(xr,Ir),Ir.pendingcb--,vr(),gr(xr,Ir)}function Ur(xr,Ir){Ir.length===0&&Ir.needDrain&&(Ir.needDrain=!1,xr.emit("drain"))}function Hr(xr,Ir){Ir.bufferProcessing=!0;var $r=Ir.bufferedRequest;if(xr._writev&&$r&&$r.next){var vr=Ir.bufferedRequestCount,Er=new Array(vr),Tr=Ir.corkedRequestsFree;Tr.entry=$r;for(var Rr=0,Mr=!0;$r;)Er[Rr]=$r,$r.isBuf||(Mr=!1),$r=$r.next,Rr+=1;Er.allBuffers=Mr,yr(xr,Ir,!0,Ir.length,Er,"",Tr.finish),Ir.pendingcb++,Ir.lastBufferedRequest=null,Tr.next?(Ir.corkedRequestsFree=Tr.next,Tr.next=null):Ir.corkedRequestsFree=new e(Ir),Ir.bufferedRequestCount=0}else{for(;$r;){var Gr=$r.chunk,Br=$r.encoding,Cr=$r.callback,jr=Ir.objectMode?1:Gr.length;if(yr(xr,Ir,!1,jr,Gr,Br,Cr),$r=$r.next,Ir.bufferedRequestCount--,Ir.writing)break}$r===null&&(Ir.lastBufferedRequest=null)}Ir.bufferedRequest=$r,Ir.bufferProcessing=!1}dr.prototype._write=function(xr,Ir,$r){$r(new Error("_write() is not implemented"))},dr.prototype._writev=null,dr.prototype.end=function(xr,Ir,$r){var vr=this._writableState;typeof xr=="function"?($r=xr,xr=null,Ir=null):typeof Ir=="function"&&($r=Ir,Ir=null),xr!=null&&this.write(xr,Ir),vr.corked&&(vr.corked=1,this.uncork()),vr.ending||wr(this,vr,$r)};function Lr(xr){return xr.ending&&xr.length===0&&xr.bufferedRequest===null&&!xr.finished&&!xr.writing}function Sr(xr,Ir){xr._final(function($r){Ir.pendingcb--,$r&&xr.emit("error",$r),Ir.prefinished=!0,xr.emit("prefinish"),gr(xr,Ir)})}function _r(xr,Ir){!Ir.prefinished&&!Ir.finalCalled&&(typeof xr._final=="function"?(Ir.pendingcb++,Ir.finalCalled=!0,xt.nextTick(Sr,xr,Ir)):(Ir.prefinished=!0,xr.emit("prefinish")))}function gr(xr,Ir){var $r=Lr(Ir);return $r&&(_r(xr,Ir),Ir.pendingcb===0&&(Ir.finished=!0,xr.emit("finish"))),$r}function wr(xr,Ir,$r){Ir.ending=!0,gr(xr,Ir),$r&&(Ir.finished?xt.nextTick($r):xr.once("finish",$r)),Ir.ended=!0,xr.writable=!1}function Dr(xr,Ir,$r){var vr=xr.entry;for(xr.entry=null;vr;){var Er=vr.callback;Ir.pendingcb--,Er($r),vr=vr.next}Ir.corkedRequestsFree.next=xr}return Object.defineProperty(dr.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(xr){this._writableState&&(this._writableState.destroyed=xr)}}),dr.prototype.destroy=rr.destroy,dr.prototype._undestroy=rr.undestroy,dr.prototype._destroy=function(xr,Ir){this.end(),Ir(xr)},_stream_writable}var _stream_duplex,hasRequired_stream_duplex;function require_stream_duplex(){if(hasRequired_stream_duplex)return _stream_duplex;hasRequired_stream_duplex=1;var xt=processNextickArgsExports,e=Object.keys||function(rr){var nr=[];for(var ir in rr)nr.push(ir);return nr};_stream_duplex=er;var At=Object.create(util$5);At.inherits=inherits_browserExports;var kt=require_stream_readable(),Bt=require_stream_writable();At.inherits(er,kt);for(var Nt=e(Bt.prototype),jt=0;jt<Nt.length;jt++){var Lt=Nt[jt];er.prototype[Lt]||(er.prototype[Lt]=Bt.prototype[Lt])}function er(rr){if(!(this instanceof er))return new er(rr);kt.call(this,rr),Bt.call(this,rr),rr&&rr.readable===!1&&(this.readable=!1),rr&&rr.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,rr&&rr.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",tr)}Object.defineProperty(er.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function tr(){this.allowHalfOpen||this._writableState.ended||xt.nextTick(zt,this)}function zt(rr){rr.end()}return Object.defineProperty(er.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(rr){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=rr,this._writableState.destroyed=rr)}}),er.prototype._destroy=function(rr,nr){this.push(null),this.end(),xt.nextTick(nr,rr)},_stream_duplex}var _stream_readable,hasRequired_stream_readable;function require_stream_readable(){if(hasRequired_stream_readable)return _stream_readable;hasRequired_stream_readable=1;var xt=processNextickArgsExports;_stream_readable=pr;var e=isarray,At;pr.ReadableState=fr,eventsExports.EventEmitter;var kt=function(Cr,jr){return Cr.listeners(jr).length},Bt=streamBrowser,Nt=safeBufferExports.Buffer,jt=(typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function Lt(Cr){return Nt.from(Cr)}function er(Cr){return Nt.isBuffer(Cr)||Cr instanceof jt}var tr=Object.create(util$5);tr.inherits=inherits_browserExports;var zt=util$6,rr=void 0;zt&&zt.debuglog?rr=zt.debuglog("stream"):rr=function(){};var nr=requireBufferList(),ir=destroy_1$2,ar;tr.inherits(pr,Bt);var dr=["error","close","destroy","pause","resume"];function ur(Cr,jr,Yr){if(typeof Cr.prependListener=="function")return Cr.prependListener(jr,Yr);!Cr._events||!Cr._events[jr]?Cr.on(jr,Yr):e(Cr._events[jr])?Cr._events[jr].unshift(Yr):Cr._events[jr]=[Yr,Cr._events[jr]]}function fr(Cr,jr){At=At||require_stream_duplex(),Cr=Cr||{};var Yr=jr instanceof At;this.objectMode=!!Cr.objectMode,Yr&&(this.objectMode=this.objectMode||!!Cr.readableObjectMode);var Qr=Cr.highWaterMark,Jr=Cr.readableHighWaterMark,Wr=this.objectMode?16:16*1024;Qr||Qr===0?this.highWaterMark=Qr:Yr&&(Jr||Jr===0)?this.highWaterMark=Jr:this.highWaterMark=Wr,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new nr,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=Cr.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,Cr.encoding&&(ar||(ar=string_decoder.StringDecoder),this.decoder=new ar(Cr.encoding),this.encoding=Cr.encoding)}function pr(Cr){if(At=At||require_stream_duplex(),!(this instanceof pr))return new pr(Cr);this._readableState=new fr(Cr,this),this.readable=!0,Cr&&(typeof Cr.read=="function"&&(this._read=Cr.read),typeof Cr.destroy=="function"&&(this._destroy=Cr.destroy)),Bt.call(this)}Object.defineProperty(pr.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(Cr){this._readableState&&(this._readableState.destroyed=Cr)}}),pr.prototype.destroy=ir.destroy,pr.prototype._undestroy=ir.undestroy,pr.prototype._destroy=function(Cr,jr){this.push(null),jr(Cr)},pr.prototype.push=function(Cr,jr){var Yr=this._readableState,Qr;return Yr.objectMode?Qr=!0:typeof Cr=="string"&&(jr=jr||Yr.defaultEncoding,jr!==Yr.encoding&&(Cr=Nt.from(Cr,jr),jr=""),Qr=!0),lr(this,Cr,jr,!1,Qr)},pr.prototype.unshift=function(Cr){return lr(this,Cr,null,!0,!1)};function lr(Cr,jr,Yr,Qr,Jr){var Wr=Cr._readableState;if(jr===null)Wr.reading=!1,Hr(Cr,Wr);else{var Nr;Jr||(Nr=br(Wr,jr)),Nr?Cr.emit("error",Nr):Wr.objectMode||jr&&jr.length>0?(typeof jr!="string"&&!Wr.objectMode&&Object.getPrototypeOf(jr)!==Nt.prototype&&(jr=Lt(jr)),Qr?Wr.endEmitted?Cr.emit("error",new Error("stream.unshift() after end event")):yr(Cr,Wr,jr,!0):Wr.ended?Cr.emit("error",new Error("stream.push() after EOF")):(Wr.reading=!1,Wr.decoder&&!Yr?(jr=Wr.decoder.write(jr),Wr.objectMode||jr.length!==0?yr(Cr,Wr,jr,!1):_r(Cr,Wr)):yr(Cr,Wr,jr,!1))):Qr||(Wr.reading=!1)}return Ar(Wr)}function yr(Cr,jr,Yr,Qr){jr.flowing&&jr.length===0&&!jr.sync?(Cr.emit("data",Yr),Cr.read(0)):(jr.length+=jr.objectMode?1:Yr.length,Qr?jr.buffer.unshift(Yr):jr.buffer.push(Yr),jr.needReadable&&Lr(Cr)),_r(Cr,jr)}function br(Cr,jr){var Yr;return!er(jr)&&typeof jr!="string"&&jr!==void 0&&!Cr.objectMode&&(Yr=new TypeError("Invalid non-string/buffer chunk")),Yr}function Ar(Cr){return!Cr.ended&&(Cr.needReadable||Cr.length<Cr.highWaterMark||Cr.length===0)}pr.prototype.isPaused=function(){return this._readableState.flowing===!1},pr.prototype.setEncoding=function(Cr){return ar||(ar=string_decoder.StringDecoder),this._readableState.decoder=new ar(Cr),this._readableState.encoding=Cr,this};var Pr=8388608;function kr(Cr){return Cr>=Pr?Cr=Pr:(Cr--,Cr|=Cr>>>1,Cr|=Cr>>>2,Cr|=Cr>>>4,Cr|=Cr>>>8,Cr|=Cr>>>16,Cr++),Cr}function Ur(Cr,jr){return Cr<=0||jr.length===0&&jr.ended?0:jr.objectMode?1:Cr!==Cr?jr.flowing&&jr.length?jr.buffer.head.data.length:jr.length:(Cr>jr.highWaterMark&&(jr.highWaterMark=kr(Cr)),Cr<=jr.length?Cr:jr.ended?jr.length:(jr.needReadable=!0,0))}pr.prototype.read=function(Cr){rr("read",Cr),Cr=parseInt(Cr,10);var jr=this._readableState,Yr=Cr;if(Cr!==0&&(jr.emittedReadable=!1),Cr===0&&jr.needReadable&&(jr.length>=jr.highWaterMark||jr.ended))return rr("read: emitReadable",jr.length,jr.ended),jr.length===0&&jr.ended?Mr(this):Lr(this),null;if(Cr=Ur(Cr,jr),Cr===0&&jr.ended)return jr.length===0&&Mr(this),null;var Qr=jr.needReadable;rr("need readable",Qr),(jr.length===0||jr.length-Cr<jr.highWaterMark)&&(Qr=!0,rr("length less than watermark",Qr)),jr.ended||jr.reading?(Qr=!1,rr("reading or ended",Qr)):Qr&&(rr("do read"),jr.reading=!0,jr.sync=!0,jr.length===0&&(jr.needReadable=!0),this._read(jr.highWaterMark),jr.sync=!1,jr.reading||(Cr=Ur(Yr,jr)));var Jr;return Cr>0?Jr=vr(Cr,jr):Jr=null,Jr===null?(jr.needReadable=!0,Cr=0):jr.length-=Cr,jr.length===0&&(jr.ended||(jr.needReadable=!0),Yr!==Cr&&jr.ended&&Mr(this)),Jr!==null&&this.emit("data",Jr),Jr};function Hr(Cr,jr){if(!jr.ended){if(jr.decoder){var Yr=jr.decoder.end();Yr&&Yr.length&&(jr.buffer.push(Yr),jr.length+=jr.objectMode?1:Yr.length)}jr.ended=!0,Lr(Cr)}}function Lr(Cr){var jr=Cr._readableState;jr.needReadable=!1,jr.emittedReadable||(rr("emitReadable",jr.flowing),jr.emittedReadable=!0,jr.sync?xt.nextTick(Sr,Cr):Sr(Cr))}function Sr(Cr){rr("emit readable"),Cr.emit("readable"),$r(Cr)}function _r(Cr,jr){jr.readingMore||(jr.readingMore=!0,xt.nextTick(gr,Cr,jr))}function gr(Cr,jr){for(var Yr=jr.length;!jr.reading&&!jr.flowing&&!jr.ended&&jr.length<jr.highWaterMark&&(rr("maybeReadMore read 0"),Cr.read(0),Yr!==jr.length);)Yr=jr.length;jr.readingMore=!1}pr.prototype._read=function(Cr){this.emit("error",new Error("_read() is not implemented"))},pr.prototype.pipe=function(Cr,jr){var Yr=this,Qr=this._readableState;switch(Qr.pipesCount){case 0:Qr.pipes=Cr;break;case 1:Qr.pipes=[Qr.pipes,Cr];break;default:Qr.pipes.push(Cr);break}Qr.pipesCount+=1,rr("pipe count=%d opts=%j",Qr.pipesCount,jr);var Jr=(!jr||jr.end!==!1)&&Cr!==process$9.stdout&&Cr!==process$9.stderr,Wr=Jr?Vr:vn;Qr.endEmitted?xt.nextTick(Wr):Yr.once("end",Wr),Cr.on("unpipe",Nr);function Nr($n,en){rr("onunpipe"),$n===Yr&&en&&en.hasUnpiped===!1&&(en.hasUnpiped=!0,Or())}function Vr(){rr("onend"),Cr.end()}var Xr=wr(Yr);Cr.on("drain",Xr);var qr=!1;function Or(){rr("cleanup"),Cr.removeListener("close",un),Cr.removeListener("finish",dn),Cr.removeListener("drain",Xr),Cr.removeListener("error",rn),Cr.removeListener("unpipe",Nr),Yr.removeListener("end",Vr),Yr.removeListener("end",vn),Yr.removeListener("data",Zr),qr=!0,Qr.awaitDrain&&(!Cr._writableState||Cr._writableState.needDrain)&&Xr()}var Fr=!1;Yr.on("data",Zr);function Zr($n){rr("ondata"),Fr=!1;var en=Cr.write($n);en===!1&&!Fr&&((Qr.pipesCount===1&&Qr.pipes===Cr||Qr.pipesCount>1&&Br(Qr.pipes,Cr)!==-1)&&!qr&&(rr("false write response, pause",Qr.awaitDrain),Qr.awaitDrain++,Fr=!0),Yr.pause())}function rn($n){rr("onerror",$n),vn(),Cr.removeListener("error",rn),kt(Cr,"error")===0&&Cr.emit("error",$n)}ur(Cr,"error",rn);function un(){Cr.removeListener("finish",dn),vn()}Cr.once("close",un);function dn(){rr("onfinish"),Cr.removeListener("close",un),vn()}Cr.once("finish",dn);function vn(){rr("unpipe"),Yr.unpipe(Cr)}return Cr.emit("pipe",Yr),Qr.flowing||(rr("pipe resume"),Yr.resume()),Cr};function wr(Cr){return function(){var jr=Cr._readableState;rr("pipeOnDrain",jr.awaitDrain),jr.awaitDrain&&jr.awaitDrain--,jr.awaitDrain===0&&kt(Cr,"data")&&(jr.flowing=!0,$r(Cr))}}pr.prototype.unpipe=function(Cr){var jr=this._readableState,Yr={hasUnpiped:!1};if(jr.pipesCount===0)return this;if(jr.pipesCount===1)return Cr&&Cr!==jr.pipes?this:(Cr||(Cr=jr.pipes),jr.pipes=null,jr.pipesCount=0,jr.flowing=!1,Cr&&Cr.emit("unpipe",this,Yr),this);if(!Cr){var Qr=jr.pipes,Jr=jr.pipesCount;jr.pipes=null,jr.pipesCount=0,jr.flowing=!1;for(var Wr=0;Wr<Jr;Wr++)Qr[Wr].emit("unpipe",this,{hasUnpiped:!1});return this}var Nr=Br(jr.pipes,Cr);return Nr===-1?this:(jr.pipes.splice(Nr,1),jr.pipesCount-=1,jr.pipesCount===1&&(jr.pipes=jr.pipes[0]),Cr.emit("unpipe",this,Yr),this)},pr.prototype.on=function(Cr,jr){var Yr=Bt.prototype.on.call(this,Cr,jr);if(Cr==="data")this._readableState.flowing!==!1&&this.resume();else if(Cr==="readable"){var Qr=this._readableState;!Qr.endEmitted&&!Qr.readableListening&&(Qr.readableListening=Qr.needReadable=!0,Qr.emittedReadable=!1,Qr.reading?Qr.length&&Lr(this):xt.nextTick(Dr,this))}return Yr},pr.prototype.addListener=pr.prototype.on;function Dr(Cr){rr("readable nexttick read 0"),Cr.read(0)}pr.prototype.resume=function(){var Cr=this._readableState;return Cr.flowing||(rr("resume"),Cr.flowing=!0,xr(this,Cr)),this};function xr(Cr,jr){jr.resumeScheduled||(jr.resumeScheduled=!0,xt.nextTick(Ir,Cr,jr))}function Ir(Cr,jr){jr.reading||(rr("resume read 0"),Cr.read(0)),jr.resumeScheduled=!1,jr.awaitDrain=0,Cr.emit("resume"),$r(Cr),jr.flowing&&!jr.reading&&Cr.read(0)}pr.prototype.pause=function(){return rr("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(rr("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function $r(Cr){var jr=Cr._readableState;for(rr("flow",jr.flowing);jr.flowing&&Cr.read()!==null;);}pr.prototype.wrap=function(Cr){var jr=this,Yr=this._readableState,Qr=!1;Cr.on("end",function(){if(rr("wrapped end"),Yr.decoder&&!Yr.ended){var Nr=Yr.decoder.end();Nr&&Nr.length&&jr.push(Nr)}jr.push(null)}),Cr.on("data",function(Nr){if(rr("wrapped data"),Yr.decoder&&(Nr=Yr.decoder.write(Nr)),!(Yr.objectMode&&Nr==null)&&!(!Yr.objectMode&&(!Nr||!Nr.length))){var Vr=jr.push(Nr);Vr||(Qr=!0,Cr.pause())}});for(var Jr in Cr)this[Jr]===void 0&&typeof Cr[Jr]=="function"&&(this[Jr]=function(Nr){return function(){return Cr[Nr].apply(Cr,arguments)}}(Jr));for(var Wr=0;Wr<dr.length;Wr++)Cr.on(dr[Wr],this.emit.bind(this,dr[Wr]));return this._read=function(Nr){rr("wrapped _read",Nr),Qr&&(Qr=!1,Cr.resume())},this},Object.defineProperty(pr.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),pr._fromList=vr;function vr(Cr,jr){if(jr.length===0)return null;var Yr;return jr.objectMode?Yr=jr.buffer.shift():!Cr||Cr>=jr.length?(jr.decoder?Yr=jr.buffer.join(""):jr.buffer.length===1?Yr=jr.buffer.head.data:Yr=jr.buffer.concat(jr.length),jr.buffer.clear()):Yr=Er(Cr,jr.buffer,jr.decoder),Yr}function Er(Cr,jr,Yr){var Qr;return Cr<jr.head.data.length?(Qr=jr.head.data.slice(0,Cr),jr.head.data=jr.head.data.slice(Cr)):Cr===jr.head.data.length?Qr=jr.shift():Qr=Yr?Tr(Cr,jr):Rr(Cr,jr),Qr}function Tr(Cr,jr){var Yr=jr.head,Qr=1,Jr=Yr.data;for(Cr-=Jr.length;Yr=Yr.next;){var Wr=Yr.data,Nr=Cr>Wr.length?Wr.length:Cr;if(Nr===Wr.length?Jr+=Wr:Jr+=Wr.slice(0,Cr),Cr-=Nr,Cr===0){Nr===Wr.length?(++Qr,Yr.next?jr.head=Yr.next:jr.head=jr.tail=null):(jr.head=Yr,Yr.data=Wr.slice(Nr));break}++Qr}return jr.length-=Qr,Jr}function Rr(Cr,jr){var Yr=Nt.allocUnsafe(Cr),Qr=jr.head,Jr=1;for(Qr.data.copy(Yr),Cr-=Qr.data.length;Qr=Qr.next;){var Wr=Qr.data,Nr=Cr>Wr.length?Wr.length:Cr;if(Wr.copy(Yr,Yr.length-Cr,0,Nr),Cr-=Nr,Cr===0){Nr===Wr.length?(++Jr,Qr.next?jr.head=Qr.next:jr.head=jr.tail=null):(jr.head=Qr,Qr.data=Wr.slice(Nr));break}++Jr}return jr.length-=Jr,Yr}function Mr(Cr){var jr=Cr._readableState;if(jr.length>0)throw new Error('"endReadable()" called on non-empty stream');jr.endEmitted||(jr.ended=!0,xt.nextTick(Gr,jr,Cr))}function Gr(Cr,jr){!Cr.endEmitted&&Cr.length===0&&(Cr.endEmitted=!0,jr.readable=!1,jr.emit("end"))}function Br(Cr,jr){for(var Yr=0,Qr=Cr.length;Yr<Qr;Yr++)if(Cr[Yr]===jr)return Yr;return-1}return _stream_readable}var _stream_transform=Transform$5,Duplex$6=require_stream_duplex(),util$4=Object.create(util$5);util$4.inherits=inherits_browserExports;util$4.inherits(Transform$5,Duplex$6);function afterTransform(xt,e){var At=this._transformState;At.transforming=!1;var kt=At.writecb;if(!kt)return this.emit("error",new Error("write callback called multiple times"));At.writechunk=null,At.writecb=null,e!=null&&this.push(e),kt(xt);var Bt=this._readableState;Bt.reading=!1,(Bt.needReadable||Bt.length<Bt.highWaterMark)&&this._read(Bt.highWaterMark)}function Transform$5(xt){if(!(this instanceof Transform$5))return new Transform$5(xt);Duplex$6.call(this,xt),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,xt&&(typeof xt.transform=="function"&&(this._transform=xt.transform),typeof xt.flush=="function"&&(this._flush=xt.flush)),this.on("prefinish",prefinish$2)}function prefinish$2(){var xt=this;typeof this._flush=="function"?this._flush(function(e,At){done(xt,e,At)}):done(this,null,null)}Transform$5.prototype.push=function(xt,e){return this._transformState.needTransform=!1,Duplex$6.prototype.push.call(this,xt,e)};Transform$5.prototype._transform=function(xt,e,At){throw new Error("_transform() is not implemented")};Transform$5.prototype._write=function(xt,e,At){var kt=this._transformState;if(kt.writecb=At,kt.writechunk=xt,kt.writeencoding=e,!kt.transforming){var Bt=this._readableState;(kt.needTransform||Bt.needReadable||Bt.length<Bt.highWaterMark)&&this._read(Bt.highWaterMark)}};Transform$5.prototype._read=function(xt){var e=this._transformState;e.writechunk!==null&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};Transform$5.prototype._destroy=function(xt,e){var At=this;Duplex$6.prototype._destroy.call(this,xt,function(kt){e(kt),At.emit("close")})};function done(xt,e,At){if(e)return xt.emit("error",e);if(At!=null&&xt.push(At),xt._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(xt._transformState.transforming)throw new Error("Calling transform done when still transforming");return xt.push(null)}var _stream_passthrough=PassThrough$4,Transform$4=_stream_transform,util$3=Object.create(util$5);util$3.inherits=inherits_browserExports;util$3.inherits(PassThrough$4,Transform$4);function PassThrough$4(xt){if(!(this instanceof PassThrough$4))return new PassThrough$4(xt);Transform$4.call(this,xt)}PassThrough$4.prototype._transform=function(xt,e,At){At(null,xt)};(function(xt,e){e=xt.exports=require_stream_readable(),e.Stream=e,e.Readable=e,e.Writable=require_stream_writable(),e.Duplex=require_stream_duplex(),e.Transform=_stream_transform,e.PassThrough=_stream_passthrough})(readableBrowser,readableBrowser.exports);var readableBrowserExports=readableBrowser.exports,sign={exports:{}},bn={exports:{}};bn.exports;(function(xt){(function(e,At){function kt(_r,gr){if(!_r)throw new Error(gr||"Assertion failed")}function Bt(_r,gr){_r.super_=gr;var wr=function(){};wr.prototype=gr.prototype,_r.prototype=new wr,_r.prototype.constructor=_r}function Nt(_r,gr,wr){if(Nt.isBN(_r))return _r;this.negative=0,this.words=null,this.length=0,this.red=null,_r!==null&&((gr==="le"||gr==="be")&&(wr=gr,gr=10),this._init(_r||0,gr||10,wr||"be"))}typeof e=="object"?e.exports=Nt:At.BN=Nt,Nt.BN=Nt,Nt.wordSize=26;var jt;try{typeof window<"u"&&typeof window.Buffer<"u"?jt=window.Buffer:jt=buffer$2.Buffer}catch{}Nt.isBN=function(gr){return gr instanceof Nt?!0:gr!==null&&typeof gr=="object"&&gr.constructor.wordSize===Nt.wordSize&&Array.isArray(gr.words)},Nt.max=function(gr,wr){return gr.cmp(wr)>0?gr:wr},Nt.min=function(gr,wr){return gr.cmp(wr)<0?gr:wr},Nt.prototype._init=function(gr,wr,Dr){if(typeof gr=="number")return this._initNumber(gr,wr,Dr);if(typeof gr=="object")return this._initArray(gr,wr,Dr);wr==="hex"&&(wr=16),kt(wr===(wr|0)&&wr>=2&&wr<=36),gr=gr.toString().replace(/\s+/g,"");var xr=0;gr[0]==="-"&&(xr++,this.negative=1),xr<gr.length&&(wr===16?this._parseHex(gr,xr,Dr):(this._parseBase(gr,wr,xr),Dr==="le"&&this._initArray(this.toArray(),wr,Dr)))},Nt.prototype._initNumber=function(gr,wr,Dr){gr<0&&(this.negative=1,gr=-gr),gr<67108864?(this.words=[gr&67108863],this.length=1):gr<4503599627370496?(this.words=[gr&67108863,gr/67108864&67108863],this.length=2):(kt(gr<9007199254740992),this.words=[gr&67108863,gr/67108864&67108863,1],this.length=3),Dr==="le"&&this._initArray(this.toArray(),wr,Dr)},Nt.prototype._initArray=function(gr,wr,Dr){if(kt(typeof gr.length=="number"),gr.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(gr.length/3),this.words=new Array(this.length);for(var xr=0;xr<this.length;xr++)this.words[xr]=0;var Ir,$r,vr=0;if(Dr==="be")for(xr=gr.length-1,Ir=0;xr>=0;xr-=3)$r=gr[xr]|gr[xr-1]<<8|gr[xr-2]<<16,this.words[Ir]|=$r<<vr&67108863,this.words[Ir+1]=$r>>>26-vr&67108863,vr+=24,vr>=26&&(vr-=26,Ir++);else if(Dr==="le")for(xr=0,Ir=0;xr<gr.length;xr+=3)$r=gr[xr]|gr[xr+1]<<8|gr[xr+2]<<16,this.words[Ir]|=$r<<vr&67108863,this.words[Ir+1]=$r>>>26-vr&67108863,vr+=24,vr>=26&&(vr-=26,Ir++);return this._strip()};function Lt(_r,gr){var wr=_r.charCodeAt(gr);if(wr>=48&&wr<=57)return wr-48;if(wr>=65&&wr<=70)return wr-55;if(wr>=97&&wr<=102)return wr-87;kt(!1,"Invalid character in "+_r)}function er(_r,gr,wr){var Dr=Lt(_r,wr);return wr-1>=gr&&(Dr|=Lt(_r,wr-1)<<4),Dr}Nt.prototype._parseHex=function(gr,wr,Dr){this.length=Math.ceil((gr.length-wr)/6),this.words=new Array(this.length);for(var xr=0;xr<this.length;xr++)this.words[xr]=0;var Ir=0,$r=0,vr;if(Dr==="be")for(xr=gr.length-1;xr>=wr;xr-=2)vr=er(gr,wr,xr)<<Ir,this.words[$r]|=vr&67108863,Ir>=18?(Ir-=18,$r+=1,this.words[$r]|=vr>>>26):Ir+=8;else{var Er=gr.length-wr;for(xr=Er%2===0?wr+1:wr;xr<gr.length;xr+=2)vr=er(gr,wr,xr)<<Ir,this.words[$r]|=vr&67108863,Ir>=18?(Ir-=18,$r+=1,this.words[$r]|=vr>>>26):Ir+=8}this._strip()};function tr(_r,gr,wr,Dr){for(var xr=0,Ir=0,$r=Math.min(_r.length,wr),vr=gr;vr<$r;vr++){var Er=_r.charCodeAt(vr)-48;xr*=Dr,Er>=49?Ir=Er-49+10:Er>=17?Ir=Er-17+10:Ir=Er,kt(Er>=0&&Ir<Dr,"Invalid character"),xr+=Ir}return xr}Nt.prototype._parseBase=function(gr,wr,Dr){this.words=[0],this.length=1;for(var xr=0,Ir=1;Ir<=67108863;Ir*=wr)xr++;xr--,Ir=Ir/wr|0;for(var $r=gr.length-Dr,vr=$r%xr,Er=Math.min($r,$r-vr)+Dr,Tr=0,Rr=Dr;Rr<Er;Rr+=xr)Tr=tr(gr,Rr,Rr+xr,wr),this.imuln(Ir),this.words[0]+Tr<67108864?this.words[0]+=Tr:this._iaddn(Tr);if(vr!==0){var Mr=1;for(Tr=tr(gr,Rr,gr.length,wr),Rr=0;Rr<vr;Rr++)Mr*=wr;this.imuln(Mr),this.words[0]+Tr<67108864?this.words[0]+=Tr:this._iaddn(Tr)}this._strip()},Nt.prototype.copy=function(gr){gr.words=new Array(this.length);for(var wr=0;wr<this.length;wr++)gr.words[wr]=this.words[wr];gr.length=this.length,gr.negative=this.negative,gr.red=this.red};function zt(_r,gr){_r.words=gr.words,_r.length=gr.length,_r.negative=gr.negative,_r.red=gr.red}if(Nt.prototype._move=function(gr){zt(gr,this)},Nt.prototype.clone=function(){var gr=new Nt(null);return this.copy(gr),gr},Nt.prototype._expand=function(gr){for(;this.length<gr;)this.words[this.length++]=0;return this},Nt.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},Nt.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{Nt.prototype[Symbol.for("nodejs.util.inspect.custom")]=rr}catch{Nt.prototype.inspect=rr}else Nt.prototype.inspect=rr;function rr(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var nr=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],ir=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],ar=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];Nt.prototype.toString=function(gr,wr){gr=gr||10,wr=wr|0||1;var Dr;if(gr===16||gr==="hex"){Dr="";for(var xr=0,Ir=0,$r=0;$r<this.length;$r++){var vr=this.words[$r],Er=((vr<<xr|Ir)&16777215).toString(16);Ir=vr>>>24-xr&16777215,xr+=2,xr>=26&&(xr-=26,$r--),Ir!==0||$r!==this.length-1?Dr=nr[6-Er.length]+Er+Dr:Dr=Er+Dr}for(Ir!==0&&(Dr=Ir.toString(16)+Dr);Dr.length%wr!==0;)Dr="0"+Dr;return this.negative!==0&&(Dr="-"+Dr),Dr}if(gr===(gr|0)&&gr>=2&&gr<=36){var Tr=ir[gr],Rr=ar[gr];Dr="";var Mr=this.clone();for(Mr.negative=0;!Mr.isZero();){var Gr=Mr.modrn(Rr).toString(gr);Mr=Mr.idivn(Rr),Mr.isZero()?Dr=Gr+Dr:Dr=nr[Tr-Gr.length]+Gr+Dr}for(this.isZero()&&(Dr="0"+Dr);Dr.length%wr!==0;)Dr="0"+Dr;return this.negative!==0&&(Dr="-"+Dr),Dr}kt(!1,"Base should be between 2 and 36")},Nt.prototype.toNumber=function(){var gr=this.words[0];return this.length===2?gr+=this.words[1]*67108864:this.length===3&&this.words[2]===1?gr+=4503599627370496+this.words[1]*67108864:this.length>2&&kt(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-gr:gr},Nt.prototype.toJSON=function(){return this.toString(16,2)},jt&&(Nt.prototype.toBuffer=function(gr,wr){return this.toArrayLike(jt,gr,wr)}),Nt.prototype.toArray=function(gr,wr){return this.toArrayLike(Array,gr,wr)};var dr=function(gr,wr){return gr.allocUnsafe?gr.allocUnsafe(wr):new gr(wr)};Nt.prototype.toArrayLike=function(gr,wr,Dr){this._strip();var xr=this.byteLength(),Ir=Dr||Math.max(1,xr);kt(xr<=Ir,"byte array longer than desired length"),kt(Ir>0,"Requested array length <= 0");var $r=dr(gr,Ir),vr=wr==="le"?"LE":"BE";return this["_toArrayLike"+vr]($r,xr),$r},Nt.prototype._toArrayLikeLE=function(gr,wr){for(var Dr=0,xr=0,Ir=0,$r=0;Ir<this.length;Ir++){var vr=this.words[Ir]<<$r|xr;gr[Dr++]=vr&255,Dr<gr.length&&(gr[Dr++]=vr>>8&255),Dr<gr.length&&(gr[Dr++]=vr>>16&255),$r===6?(Dr<gr.length&&(gr[Dr++]=vr>>24&255),xr=0,$r=0):(xr=vr>>>24,$r+=2)}if(Dr<gr.length)for(gr[Dr++]=xr;Dr<gr.length;)gr[Dr++]=0},Nt.prototype._toArrayLikeBE=function(gr,wr){for(var Dr=gr.length-1,xr=0,Ir=0,$r=0;Ir<this.length;Ir++){var vr=this.words[Ir]<<$r|xr;gr[Dr--]=vr&255,Dr>=0&&(gr[Dr--]=vr>>8&255),Dr>=0&&(gr[Dr--]=vr>>16&255),$r===6?(Dr>=0&&(gr[Dr--]=vr>>24&255),xr=0,$r=0):(xr=vr>>>24,$r+=2)}if(Dr>=0)for(gr[Dr--]=xr;Dr>=0;)gr[Dr--]=0},Math.clz32?Nt.prototype._countBits=function(gr){return 32-Math.clz32(gr)}:Nt.prototype._countBits=function(gr){var wr=gr,Dr=0;return wr>=4096&&(Dr+=13,wr>>>=13),wr>=64&&(Dr+=7,wr>>>=7),wr>=8&&(Dr+=4,wr>>>=4),wr>=2&&(Dr+=2,wr>>>=2),Dr+wr},Nt.prototype._zeroBits=function(gr){if(gr===0)return 26;var wr=gr,Dr=0;return wr&8191||(Dr+=13,wr>>>=13),wr&127||(Dr+=7,wr>>>=7),wr&15||(Dr+=4,wr>>>=4),wr&3||(Dr+=2,wr>>>=2),wr&1||Dr++,Dr},Nt.prototype.bitLength=function(){var gr=this.words[this.length-1],wr=this._countBits(gr);return(this.length-1)*26+wr};function ur(_r){for(var gr=new Array(_r.bitLength()),wr=0;wr<gr.length;wr++){var Dr=wr/26|0,xr=wr%26;gr[wr]=_r.words[Dr]>>>xr&1}return gr}Nt.prototype.zeroBits=function(){if(this.isZero())return 0;for(var gr=0,wr=0;wr<this.length;wr++){var Dr=this._zeroBits(this.words[wr]);if(gr+=Dr,Dr!==26)break}return gr},Nt.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},Nt.prototype.toTwos=function(gr){return this.negative!==0?this.abs().inotn(gr).iaddn(1):this.clone()},Nt.prototype.fromTwos=function(gr){return this.testn(gr-1)?this.notn(gr).iaddn(1).ineg():this.clone()},Nt.prototype.isNeg=function(){return this.negative!==0},Nt.prototype.neg=function(){return this.clone().ineg()},Nt.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},Nt.prototype.iuor=function(gr){for(;this.length<gr.length;)this.words[this.length++]=0;for(var wr=0;wr<gr.length;wr++)this.words[wr]=this.words[wr]|gr.words[wr];return this._strip()},Nt.prototype.ior=function(gr){return kt((this.negative|gr.negative)===0),this.iuor(gr)},Nt.prototype.or=function(gr){return this.length>gr.length?this.clone().ior(gr):gr.clone().ior(this)},Nt.prototype.uor=function(gr){return this.length>gr.length?this.clone().iuor(gr):gr.clone().iuor(this)},Nt.prototype.iuand=function(gr){var wr;this.length>gr.length?wr=gr:wr=this;for(var Dr=0;Dr<wr.length;Dr++)this.words[Dr]=this.words[Dr]&gr.words[Dr];return this.length=wr.length,this._strip()},Nt.prototype.iand=function(gr){return kt((this.negative|gr.negative)===0),this.iuand(gr)},Nt.prototype.and=function(gr){return this.length>gr.length?this.clone().iand(gr):gr.clone().iand(this)},Nt.prototype.uand=function(gr){return this.length>gr.length?this.clone().iuand(gr):gr.clone().iuand(this)},Nt.prototype.iuxor=function(gr){var wr,Dr;this.length>gr.length?(wr=this,Dr=gr):(wr=gr,Dr=this);for(var xr=0;xr<Dr.length;xr++)this.words[xr]=wr.words[xr]^Dr.words[xr];if(this!==wr)for(;xr<wr.length;xr++)this.words[xr]=wr.words[xr];return this.length=wr.length,this._strip()},Nt.prototype.ixor=function(gr){return kt((this.negative|gr.negative)===0),this.iuxor(gr)},Nt.prototype.xor=function(gr){return this.length>gr.length?this.clone().ixor(gr):gr.clone().ixor(this)},Nt.prototype.uxor=function(gr){return this.length>gr.length?this.clone().iuxor(gr):gr.clone().iuxor(this)},Nt.prototype.inotn=function(gr){kt(typeof gr=="number"&&gr>=0);var wr=Math.ceil(gr/26)|0,Dr=gr%26;this._expand(wr),Dr>0&&wr--;for(var xr=0;xr<wr;xr++)this.words[xr]=~this.words[xr]&67108863;return Dr>0&&(this.words[xr]=~this.words[xr]&67108863>>26-Dr),this._strip()},Nt.prototype.notn=function(gr){return this.clone().inotn(gr)},Nt.prototype.setn=function(gr,wr){kt(typeof gr=="number"&&gr>=0);var Dr=gr/26|0,xr=gr%26;return this._expand(Dr+1),wr?this.words[Dr]=this.words[Dr]|1<<xr:this.words[Dr]=this.words[Dr]&~(1<<xr),this._strip()},Nt.prototype.iadd=function(gr){var wr;if(this.negative!==0&&gr.negative===0)return this.negative=0,wr=this.isub(gr),this.negative^=1,this._normSign();if(this.negative===0&&gr.negative!==0)return gr.negative=0,wr=this.isub(gr),gr.negative=1,wr._normSign();var Dr,xr;this.length>gr.length?(Dr=this,xr=gr):(Dr=gr,xr=this);for(var Ir=0,$r=0;$r<xr.length;$r++)wr=(Dr.words[$r]|0)+(xr.words[$r]|0)+Ir,this.words[$r]=wr&67108863,Ir=wr>>>26;for(;Ir!==0&&$r<Dr.length;$r++)wr=(Dr.words[$r]|0)+Ir,this.words[$r]=wr&67108863,Ir=wr>>>26;if(this.length=Dr.length,Ir!==0)this.words[this.length]=Ir,this.length++;else if(Dr!==this)for(;$r<Dr.length;$r++)this.words[$r]=Dr.words[$r];return this},Nt.prototype.add=function(gr){var wr;return gr.negative!==0&&this.negative===0?(gr.negative=0,wr=this.sub(gr),gr.negative^=1,wr):gr.negative===0&&this.negative!==0?(this.negative=0,wr=gr.sub(this),this.negative=1,wr):this.length>gr.length?this.clone().iadd(gr):gr.clone().iadd(this)},Nt.prototype.isub=function(gr){if(gr.negative!==0){gr.negative=0;var wr=this.iadd(gr);return gr.negative=1,wr._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(gr),this.negative=1,this._normSign();var Dr=this.cmp(gr);if(Dr===0)return this.negative=0,this.length=1,this.words[0]=0,this;var xr,Ir;Dr>0?(xr=this,Ir=gr):(xr=gr,Ir=this);for(var $r=0,vr=0;vr<Ir.length;vr++)wr=(xr.words[vr]|0)-(Ir.words[vr]|0)+$r,$r=wr>>26,this.words[vr]=wr&67108863;for(;$r!==0&&vr<xr.length;vr++)wr=(xr.words[vr]|0)+$r,$r=wr>>26,this.words[vr]=wr&67108863;if($r===0&&vr<xr.length&&xr!==this)for(;vr<xr.length;vr++)this.words[vr]=xr.words[vr];return this.length=Math.max(this.length,vr),xr!==this&&(this.negative=1),this._strip()},Nt.prototype.sub=function(gr){return this.clone().isub(gr)};function fr(_r,gr,wr){wr.negative=gr.negative^_r.negative;var Dr=_r.length+gr.length|0;wr.length=Dr,Dr=Dr-1|0;var xr=_r.words[0]|0,Ir=gr.words[0]|0,$r=xr*Ir,vr=$r&67108863,Er=$r/67108864|0;wr.words[0]=vr;for(var Tr=1;Tr<Dr;Tr++){for(var Rr=Er>>>26,Mr=Er&67108863,Gr=Math.min(Tr,gr.length-1),Br=Math.max(0,Tr-_r.length+1);Br<=Gr;Br++){var Cr=Tr-Br|0;xr=_r.words[Cr]|0,Ir=gr.words[Br]|0,$r=xr*Ir+Mr,Rr+=$r/67108864|0,Mr=$r&67108863}wr.words[Tr]=Mr|0,Er=Rr|0}return Er!==0?wr.words[Tr]=Er|0:wr.length--,wr._strip()}var pr=function(gr,wr,Dr){var xr=gr.words,Ir=wr.words,$r=Dr.words,vr=0,Er,Tr,Rr,Mr=xr[0]|0,Gr=Mr&8191,Br=Mr>>>13,Cr=xr[1]|0,jr=Cr&8191,Yr=Cr>>>13,Qr=xr[2]|0,Jr=Qr&8191,Wr=Qr>>>13,Nr=xr[3]|0,Vr=Nr&8191,Xr=Nr>>>13,qr=xr[4]|0,Or=qr&8191,Fr=qr>>>13,Zr=xr[5]|0,rn=Zr&8191,un=Zr>>>13,dn=xr[6]|0,vn=dn&8191,$n=dn>>>13,en=xr[7]|0,tn=en&8191,hn=en>>>13,mn=xr[8]|0,yn=mn&8191,xn=mn>>>13,In=xr[9]|0,On=In&8191,Dn=In>>>13,Yn=Ir[0]|0,Hn=Yn&8191,Mn=Yn>>>13,zn=Ir[1]|0,Pn=zn&8191,Rn=zn>>>13,Nn=Ir[2]|0,Wn=Nn&8191,kn=Nn>>>13,Zn=Ir[3]|0,eo=Zn&8191,qn=Zn>>>13,io=Ir[4]|0,nn=io&8191,sn=io>>>13,_n=Ir[5]|0,En=_n&8191,Sn=_n>>>13,Qn=Ir[6]|0,Xn=Qn&8191,an=Qn>>>13,on=Ir[7]|0,fn=on&8191,pn=on>>>13,gn=Ir[8]|0,An=gn&8191,Tn=gn>>>13,Bn=Ir[9]|0,Un=Bn&8191,Ln=Bn>>>13;Dr.negative=gr.negative^wr.negative,Dr.length=19,Er=Math.imul(Gr,Hn),Tr=Math.imul(Gr,Mn),Tr=Tr+Math.imul(Br,Hn)|0,Rr=Math.imul(Br,Mn);var Kn=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(Kn>>>26)|0,Kn&=67108863,Er=Math.imul(jr,Hn),Tr=Math.imul(jr,Mn),Tr=Tr+Math.imul(Yr,Hn)|0,Rr=Math.imul(Yr,Mn),Er=Er+Math.imul(Gr,Pn)|0,Tr=Tr+Math.imul(Gr,Rn)|0,Tr=Tr+Math.imul(Br,Pn)|0,Rr=Rr+Math.imul(Br,Rn)|0;var Vn=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(Vn>>>26)|0,Vn&=67108863,Er=Math.imul(Jr,Hn),Tr=Math.imul(Jr,Mn),Tr=Tr+Math.imul(Wr,Hn)|0,Rr=Math.imul(Wr,Mn),Er=Er+Math.imul(jr,Pn)|0,Tr=Tr+Math.imul(jr,Rn)|0,Tr=Tr+Math.imul(Yr,Pn)|0,Rr=Rr+Math.imul(Yr,Rn)|0,Er=Er+Math.imul(Gr,Wn)|0,Tr=Tr+Math.imul(Gr,kn)|0,Tr=Tr+Math.imul(Br,Wn)|0,Rr=Rr+Math.imul(Br,kn)|0;var oo=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(oo>>>26)|0,oo&=67108863,Er=Math.imul(Vr,Hn),Tr=Math.imul(Vr,Mn),Tr=Tr+Math.imul(Xr,Hn)|0,Rr=Math.imul(Xr,Mn),Er=Er+Math.imul(Jr,Pn)|0,Tr=Tr+Math.imul(Jr,Rn)|0,Tr=Tr+Math.imul(Wr,Pn)|0,Rr=Rr+Math.imul(Wr,Rn)|0,Er=Er+Math.imul(jr,Wn)|0,Tr=Tr+Math.imul(jr,kn)|0,Tr=Tr+Math.imul(Yr,Wn)|0,Rr=Rr+Math.imul(Yr,kn)|0,Er=Er+Math.imul(Gr,eo)|0,Tr=Tr+Math.imul(Gr,qn)|0,Tr=Tr+Math.imul(Br,eo)|0,Rr=Rr+Math.imul(Br,qn)|0;var Fn=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(Fn>>>26)|0,Fn&=67108863,Er=Math.imul(Or,Hn),Tr=Math.imul(Or,Mn),Tr=Tr+Math.imul(Fr,Hn)|0,Rr=Math.imul(Fr,Mn),Er=Er+Math.imul(Vr,Pn)|0,Tr=Tr+Math.imul(Vr,Rn)|0,Tr=Tr+Math.imul(Xr,Pn)|0,Rr=Rr+Math.imul(Xr,Rn)|0,Er=Er+Math.imul(Jr,Wn)|0,Tr=Tr+Math.imul(Jr,kn)|0,Tr=Tr+Math.imul(Wr,Wn)|0,Rr=Rr+Math.imul(Wr,kn)|0,Er=Er+Math.imul(jr,eo)|0,Tr=Tr+Math.imul(jr,qn)|0,Tr=Tr+Math.imul(Yr,eo)|0,Rr=Rr+Math.imul(Yr,qn)|0,Er=Er+Math.imul(Gr,nn)|0,Tr=Tr+Math.imul(Gr,sn)|0,Tr=Tr+Math.imul(Br,nn)|0,Rr=Rr+Math.imul(Br,sn)|0;var to=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(to>>>26)|0,to&=67108863,Er=Math.imul(rn,Hn),Tr=Math.imul(rn,Mn),Tr=Tr+Math.imul(un,Hn)|0,Rr=Math.imul(un,Mn),Er=Er+Math.imul(Or,Pn)|0,Tr=Tr+Math.imul(Or,Rn)|0,Tr=Tr+Math.imul(Fr,Pn)|0,Rr=Rr+Math.imul(Fr,Rn)|0,Er=Er+Math.imul(Vr,Wn)|0,Tr=Tr+Math.imul(Vr,kn)|0,Tr=Tr+Math.imul(Xr,Wn)|0,Rr=Rr+Math.imul(Xr,kn)|0,Er=Er+Math.imul(Jr,eo)|0,Tr=Tr+Math.imul(Jr,qn)|0,Tr=Tr+Math.imul(Wr,eo)|0,Rr=Rr+Math.imul(Wr,qn)|0,Er=Er+Math.imul(jr,nn)|0,Tr=Tr+Math.imul(jr,sn)|0,Tr=Tr+Math.imul(Yr,nn)|0,Rr=Rr+Math.imul(Yr,sn)|0,Er=Er+Math.imul(Gr,En)|0,Tr=Tr+Math.imul(Gr,Sn)|0,Tr=Tr+Math.imul(Br,En)|0,Rr=Rr+Math.imul(Br,Sn)|0;var so=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(so>>>26)|0,so&=67108863,Er=Math.imul(vn,Hn),Tr=Math.imul(vn,Mn),Tr=Tr+Math.imul($n,Hn)|0,Rr=Math.imul($n,Mn),Er=Er+Math.imul(rn,Pn)|0,Tr=Tr+Math.imul(rn,Rn)|0,Tr=Tr+Math.imul(un,Pn)|0,Rr=Rr+Math.imul(un,Rn)|0,Er=Er+Math.imul(Or,Wn)|0,Tr=Tr+Math.imul(Or,kn)|0,Tr=Tr+Math.imul(Fr,Wn)|0,Rr=Rr+Math.imul(Fr,kn)|0,Er=Er+Math.imul(Vr,eo)|0,Tr=Tr+Math.imul(Vr,qn)|0,Tr=Tr+Math.imul(Xr,eo)|0,Rr=Rr+Math.imul(Xr,qn)|0,Er=Er+Math.imul(Jr,nn)|0,Tr=Tr+Math.imul(Jr,sn)|0,Tr=Tr+Math.imul(Wr,nn)|0,Rr=Rr+Math.imul(Wr,sn)|0,Er=Er+Math.imul(jr,En)|0,Tr=Tr+Math.imul(jr,Sn)|0,Tr=Tr+Math.imul(Yr,En)|0,Rr=Rr+Math.imul(Yr,Sn)|0,Er=Er+Math.imul(Gr,Xn)|0,Tr=Tr+Math.imul(Gr,an)|0,Tr=Tr+Math.imul(Br,Xn)|0,Rr=Rr+Math.imul(Br,an)|0;var ro=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(ro>>>26)|0,ro&=67108863,Er=Math.imul(tn,Hn),Tr=Math.imul(tn,Mn),Tr=Tr+Math.imul(hn,Hn)|0,Rr=Math.imul(hn,Mn),Er=Er+Math.imul(vn,Pn)|0,Tr=Tr+Math.imul(vn,Rn)|0,Tr=Tr+Math.imul($n,Pn)|0,Rr=Rr+Math.imul($n,Rn)|0,Er=Er+Math.imul(rn,Wn)|0,Tr=Tr+Math.imul(rn,kn)|0,Tr=Tr+Math.imul(un,Wn)|0,Rr=Rr+Math.imul(un,kn)|0,Er=Er+Math.imul(Or,eo)|0,Tr=Tr+Math.imul(Or,qn)|0,Tr=Tr+Math.imul(Fr,eo)|0,Rr=Rr+Math.imul(Fr,qn)|0,Er=Er+Math.imul(Vr,nn)|0,Tr=Tr+Math.imul(Vr,sn)|0,Tr=Tr+Math.imul(Xr,nn)|0,Rr=Rr+Math.imul(Xr,sn)|0,Er=Er+Math.imul(Jr,En)|0,Tr=Tr+Math.imul(Jr,Sn)|0,Tr=Tr+Math.imul(Wr,En)|0,Rr=Rr+Math.imul(Wr,Sn)|0,Er=Er+Math.imul(jr,Xn)|0,Tr=Tr+Math.imul(jr,an)|0,Tr=Tr+Math.imul(Yr,Xn)|0,Rr=Rr+Math.imul(Yr,an)|0,Er=Er+Math.imul(Gr,fn)|0,Tr=Tr+Math.imul(Gr,pn)|0,Tr=Tr+Math.imul(Br,fn)|0,Rr=Rr+Math.imul(Br,pn)|0;var bo=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(bo>>>26)|0,bo&=67108863,Er=Math.imul(yn,Hn),Tr=Math.imul(yn,Mn),Tr=Tr+Math.imul(xn,Hn)|0,Rr=Math.imul(xn,Mn),Er=Er+Math.imul(tn,Pn)|0,Tr=Tr+Math.imul(tn,Rn)|0,Tr=Tr+Math.imul(hn,Pn)|0,Rr=Rr+Math.imul(hn,Rn)|0,Er=Er+Math.imul(vn,Wn)|0,Tr=Tr+Math.imul(vn,kn)|0,Tr=Tr+Math.imul($n,Wn)|0,Rr=Rr+Math.imul($n,kn)|0,Er=Er+Math.imul(rn,eo)|0,Tr=Tr+Math.imul(rn,qn)|0,Tr=Tr+Math.imul(un,eo)|0,Rr=Rr+Math.imul(un,qn)|0,Er=Er+Math.imul(Or,nn)|0,Tr=Tr+Math.imul(Or,sn)|0,Tr=Tr+Math.imul(Fr,nn)|0,Rr=Rr+Math.imul(Fr,sn)|0,Er=Er+Math.imul(Vr,En)|0,Tr=Tr+Math.imul(Vr,Sn)|0,Tr=Tr+Math.imul(Xr,En)|0,Rr=Rr+Math.imul(Xr,Sn)|0,Er=Er+Math.imul(Jr,Xn)|0,Tr=Tr+Math.imul(Jr,an)|0,Tr=Tr+Math.imul(Wr,Xn)|0,Rr=Rr+Math.imul(Wr,an)|0,Er=Er+Math.imul(jr,fn)|0,Tr=Tr+Math.imul(jr,pn)|0,Tr=Tr+Math.imul(Yr,fn)|0,Rr=Rr+Math.imul(Yr,pn)|0,Er=Er+Math.imul(Gr,An)|0,Tr=Tr+Math.imul(Gr,Tn)|0,Tr=Tr+Math.imul(Br,An)|0,Rr=Rr+Math.imul(Br,Tn)|0;var po=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(po>>>26)|0,po&=67108863,Er=Math.imul(On,Hn),Tr=Math.imul(On,Mn),Tr=Tr+Math.imul(Dn,Hn)|0,Rr=Math.imul(Dn,Mn),Er=Er+Math.imul(yn,Pn)|0,Tr=Tr+Math.imul(yn,Rn)|0,Tr=Tr+Math.imul(xn,Pn)|0,Rr=Rr+Math.imul(xn,Rn)|0,Er=Er+Math.imul(tn,Wn)|0,Tr=Tr+Math.imul(tn,kn)|0,Tr=Tr+Math.imul(hn,Wn)|0,Rr=Rr+Math.imul(hn,kn)|0,Er=Er+Math.imul(vn,eo)|0,Tr=Tr+Math.imul(vn,qn)|0,Tr=Tr+Math.imul($n,eo)|0,Rr=Rr+Math.imul($n,qn)|0,Er=Er+Math.imul(rn,nn)|0,Tr=Tr+Math.imul(rn,sn)|0,Tr=Tr+Math.imul(un,nn)|0,Rr=Rr+Math.imul(un,sn)|0,Er=Er+Math.imul(Or,En)|0,Tr=Tr+Math.imul(Or,Sn)|0,Tr=Tr+Math.imul(Fr,En)|0,Rr=Rr+Math.imul(Fr,Sn)|0,Er=Er+Math.imul(Vr,Xn)|0,Tr=Tr+Math.imul(Vr,an)|0,Tr=Tr+Math.imul(Xr,Xn)|0,Rr=Rr+Math.imul(Xr,an)|0,Er=Er+Math.imul(Jr,fn)|0,Tr=Tr+Math.imul(Jr,pn)|0,Tr=Tr+Math.imul(Wr,fn)|0,Rr=Rr+Math.imul(Wr,pn)|0,Er=Er+Math.imul(jr,An)|0,Tr=Tr+Math.imul(jr,Tn)|0,Tr=Tr+Math.imul(Yr,An)|0,Rr=Rr+Math.imul(Yr,Tn)|0,Er=Er+Math.imul(Gr,Un)|0,Tr=Tr+Math.imul(Gr,Ln)|0,Tr=Tr+Math.imul(Br,Un)|0,Rr=Rr+Math.imul(Br,Ln)|0;var yo=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(yo>>>26)|0,yo&=67108863,Er=Math.imul(On,Pn),Tr=Math.imul(On,Rn),Tr=Tr+Math.imul(Dn,Pn)|0,Rr=Math.imul(Dn,Rn),Er=Er+Math.imul(yn,Wn)|0,Tr=Tr+Math.imul(yn,kn)|0,Tr=Tr+Math.imul(xn,Wn)|0,Rr=Rr+Math.imul(xn,kn)|0,Er=Er+Math.imul(tn,eo)|0,Tr=Tr+Math.imul(tn,qn)|0,Tr=Tr+Math.imul(hn,eo)|0,Rr=Rr+Math.imul(hn,qn)|0,Er=Er+Math.imul(vn,nn)|0,Tr=Tr+Math.imul(vn,sn)|0,Tr=Tr+Math.imul($n,nn)|0,Rr=Rr+Math.imul($n,sn)|0,Er=Er+Math.imul(rn,En)|0,Tr=Tr+Math.imul(rn,Sn)|0,Tr=Tr+Math.imul(un,En)|0,Rr=Rr+Math.imul(un,Sn)|0,Er=Er+Math.imul(Or,Xn)|0,Tr=Tr+Math.imul(Or,an)|0,Tr=Tr+Math.imul(Fr,Xn)|0,Rr=Rr+Math.imul(Fr,an)|0,Er=Er+Math.imul(Vr,fn)|0,Tr=Tr+Math.imul(Vr,pn)|0,Tr=Tr+Math.imul(Xr,fn)|0,Rr=Rr+Math.imul(Xr,pn)|0,Er=Er+Math.imul(Jr,An)|0,Tr=Tr+Math.imul(Jr,Tn)|0,Tr=Tr+Math.imul(Wr,An)|0,Rr=Rr+Math.imul(Wr,Tn)|0,Er=Er+Math.imul(jr,Un)|0,Tr=Tr+Math.imul(jr,Ln)|0,Tr=Tr+Math.imul(Yr,Un)|0,Rr=Rr+Math.imul(Yr,Ln)|0;var Io=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(Io>>>26)|0,Io&=67108863,Er=Math.imul(On,Wn),Tr=Math.imul(On,kn),Tr=Tr+Math.imul(Dn,Wn)|0,Rr=Math.imul(Dn,kn),Er=Er+Math.imul(yn,eo)|0,Tr=Tr+Math.imul(yn,qn)|0,Tr=Tr+Math.imul(xn,eo)|0,Rr=Rr+Math.imul(xn,qn)|0,Er=Er+Math.imul(tn,nn)|0,Tr=Tr+Math.imul(tn,sn)|0,Tr=Tr+Math.imul(hn,nn)|0,Rr=Rr+Math.imul(hn,sn)|0,Er=Er+Math.imul(vn,En)|0,Tr=Tr+Math.imul(vn,Sn)|0,Tr=Tr+Math.imul($n,En)|0,Rr=Rr+Math.imul($n,Sn)|0,Er=Er+Math.imul(rn,Xn)|0,Tr=Tr+Math.imul(rn,an)|0,Tr=Tr+Math.imul(un,Xn)|0,Rr=Rr+Math.imul(un,an)|0,Er=Er+Math.imul(Or,fn)|0,Tr=Tr+Math.imul(Or,pn)|0,Tr=Tr+Math.imul(Fr,fn)|0,Rr=Rr+Math.imul(Fr,pn)|0,Er=Er+Math.imul(Vr,An)|0,Tr=Tr+Math.imul(Vr,Tn)|0,Tr=Tr+Math.imul(Xr,An)|0,Rr=Rr+Math.imul(Xr,Tn)|0,Er=Er+Math.imul(Jr,Un)|0,Tr=Tr+Math.imul(Jr,Ln)|0,Tr=Tr+Math.imul(Wr,Un)|0,Rr=Rr+Math.imul(Wr,Ln)|0;var So=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(So>>>26)|0,So&=67108863,Er=Math.imul(On,eo),Tr=Math.imul(On,qn),Tr=Tr+Math.imul(Dn,eo)|0,Rr=Math.imul(Dn,qn),Er=Er+Math.imul(yn,nn)|0,Tr=Tr+Math.imul(yn,sn)|0,Tr=Tr+Math.imul(xn,nn)|0,Rr=Rr+Math.imul(xn,sn)|0,Er=Er+Math.imul(tn,En)|0,Tr=Tr+Math.imul(tn,Sn)|0,Tr=Tr+Math.imul(hn,En)|0,Rr=Rr+Math.imul(hn,Sn)|0,Er=Er+Math.imul(vn,Xn)|0,Tr=Tr+Math.imul(vn,an)|0,Tr=Tr+Math.imul($n,Xn)|0,Rr=Rr+Math.imul($n,an)|0,Er=Er+Math.imul(rn,fn)|0,Tr=Tr+Math.imul(rn,pn)|0,Tr=Tr+Math.imul(un,fn)|0,Rr=Rr+Math.imul(un,pn)|0,Er=Er+Math.imul(Or,An)|0,Tr=Tr+Math.imul(Or,Tn)|0,Tr=Tr+Math.imul(Fr,An)|0,Rr=Rr+Math.imul(Fr,Tn)|0,Er=Er+Math.imul(Vr,Un)|0,Tr=Tr+Math.imul(Vr,Ln)|0,Tr=Tr+Math.imul(Xr,Un)|0,Rr=Rr+Math.imul(Xr,Ln)|0;var uo=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(uo>>>26)|0,uo&=67108863,Er=Math.imul(On,nn),Tr=Math.imul(On,sn),Tr=Tr+Math.imul(Dn,nn)|0,Rr=Math.imul(Dn,sn),Er=Er+Math.imul(yn,En)|0,Tr=Tr+Math.imul(yn,Sn)|0,Tr=Tr+Math.imul(xn,En)|0,Rr=Rr+Math.imul(xn,Sn)|0,Er=Er+Math.imul(tn,Xn)|0,Tr=Tr+Math.imul(tn,an)|0,Tr=Tr+Math.imul(hn,Xn)|0,Rr=Rr+Math.imul(hn,an)|0,Er=Er+Math.imul(vn,fn)|0,Tr=Tr+Math.imul(vn,pn)|0,Tr=Tr+Math.imul($n,fn)|0,Rr=Rr+Math.imul($n,pn)|0,Er=Er+Math.imul(rn,An)|0,Tr=Tr+Math.imul(rn,Tn)|0,Tr=Tr+Math.imul(un,An)|0,Rr=Rr+Math.imul(un,Tn)|0,Er=Er+Math.imul(Or,Un)|0,Tr=Tr+Math.imul(Or,Ln)|0,Tr=Tr+Math.imul(Fr,Un)|0,Rr=Rr+Math.imul(Fr,Ln)|0;var mo=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(mo>>>26)|0,mo&=67108863,Er=Math.imul(On,En),Tr=Math.imul(On,Sn),Tr=Tr+Math.imul(Dn,En)|0,Rr=Math.imul(Dn,Sn),Er=Er+Math.imul(yn,Xn)|0,Tr=Tr+Math.imul(yn,an)|0,Tr=Tr+Math.imul(xn,Xn)|0,Rr=Rr+Math.imul(xn,an)|0,Er=Er+Math.imul(tn,fn)|0,Tr=Tr+Math.imul(tn,pn)|0,Tr=Tr+Math.imul(hn,fn)|0,Rr=Rr+Math.imul(hn,pn)|0,Er=Er+Math.imul(vn,An)|0,Tr=Tr+Math.imul(vn,Tn)|0,Tr=Tr+Math.imul($n,An)|0,Rr=Rr+Math.imul($n,Tn)|0,Er=Er+Math.imul(rn,Un)|0,Tr=Tr+Math.imul(rn,Ln)|0,Tr=Tr+Math.imul(un,Un)|0,Rr=Rr+Math.imul(un,Ln)|0;var To=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(To>>>26)|0,To&=67108863,Er=Math.imul(On,Xn),Tr=Math.imul(On,an),Tr=Tr+Math.imul(Dn,Xn)|0,Rr=Math.imul(Dn,an),Er=Er+Math.imul(yn,fn)|0,Tr=Tr+Math.imul(yn,pn)|0,Tr=Tr+Math.imul(xn,fn)|0,Rr=Rr+Math.imul(xn,pn)|0,Er=Er+Math.imul(tn,An)|0,Tr=Tr+Math.imul(tn,Tn)|0,Tr=Tr+Math.imul(hn,An)|0,Rr=Rr+Math.imul(hn,Tn)|0,Er=Er+Math.imul(vn,Un)|0,Tr=Tr+Math.imul(vn,Ln)|0,Tr=Tr+Math.imul($n,Un)|0,Rr=Rr+Math.imul($n,Ln)|0;var vo=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(vo>>>26)|0,vo&=67108863,Er=Math.imul(On,fn),Tr=Math.imul(On,pn),Tr=Tr+Math.imul(Dn,fn)|0,Rr=Math.imul(Dn,pn),Er=Er+Math.imul(yn,An)|0,Tr=Tr+Math.imul(yn,Tn)|0,Tr=Tr+Math.imul(xn,An)|0,Rr=Rr+Math.imul(xn,Tn)|0,Er=Er+Math.imul(tn,Un)|0,Tr=Tr+Math.imul(tn,Ln)|0,Tr=Tr+Math.imul(hn,Un)|0,Rr=Rr+Math.imul(hn,Ln)|0;var Ro=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(Ro>>>26)|0,Ro&=67108863,Er=Math.imul(On,An),Tr=Math.imul(On,Tn),Tr=Tr+Math.imul(Dn,An)|0,Rr=Math.imul(Dn,Tn),Er=Er+Math.imul(yn,Un)|0,Tr=Tr+Math.imul(yn,Ln)|0,Tr=Tr+Math.imul(xn,Un)|0,Rr=Rr+Math.imul(xn,Ln)|0;var ys=(vr+Er|0)+((Tr&8191)<<13)|0;vr=(Rr+(Tr>>>13)|0)+(ys>>>26)|0,ys&=67108863,Er=Math.imul(On,Un),Tr=Math.imul(On,Ln),Tr=Tr+Math.imul(Dn,Un)|0,Rr=Math.imul(Dn,Ln);var gs=(vr+Er|0)+((Tr&8191)<<13)|0;return vr=(Rr+(Tr>>>13)|0)+(gs>>>26)|0,gs&=67108863,$r[0]=Kn,$r[1]=Vn,$r[2]=oo,$r[3]=Fn,$r[4]=to,$r[5]=so,$r[6]=ro,$r[7]=bo,$r[8]=po,$r[9]=yo,$r[10]=Io,$r[11]=So,$r[12]=uo,$r[13]=mo,$r[14]=To,$r[15]=vo,$r[16]=Ro,$r[17]=ys,$r[18]=gs,vr!==0&&($r[19]=vr,Dr.length++),Dr};Math.imul||(pr=fr);function lr(_r,gr,wr){wr.negative=gr.negative^_r.negative,wr.length=_r.length+gr.length;for(var Dr=0,xr=0,Ir=0;Ir<wr.length-1;Ir++){var $r=xr;xr=0;for(var vr=Dr&67108863,Er=Math.min(Ir,gr.length-1),Tr=Math.max(0,Ir-_r.length+1);Tr<=Er;Tr++){var Rr=Ir-Tr,Mr=_r.words[Rr]|0,Gr=gr.words[Tr]|0,Br=Mr*Gr,Cr=Br&67108863;$r=$r+(Br/67108864|0)|0,Cr=Cr+vr|0,vr=Cr&67108863,$r=$r+(Cr>>>26)|0,xr+=$r>>>26,$r&=67108863}wr.words[Ir]=vr,Dr=$r,$r=xr}return Dr!==0?wr.words[Ir]=Dr:wr.length--,wr._strip()}function yr(_r,gr,wr){return lr(_r,gr,wr)}Nt.prototype.mulTo=function(gr,wr){var Dr,xr=this.length+gr.length;return this.length===10&&gr.length===10?Dr=pr(this,gr,wr):xr<63?Dr=fr(this,gr,wr):xr<1024?Dr=lr(this,gr,wr):Dr=yr(this,gr,wr),Dr},Nt.prototype.mul=function(gr){var wr=new Nt(null);return wr.words=new Array(this.length+gr.length),this.mulTo(gr,wr)},Nt.prototype.mulf=function(gr){var wr=new Nt(null);return wr.words=new Array(this.length+gr.length),yr(this,gr,wr)},Nt.prototype.imul=function(gr){return this.clone().mulTo(gr,this)},Nt.prototype.imuln=function(gr){var wr=gr<0;wr&&(gr=-gr),kt(typeof gr=="number"),kt(gr<67108864);for(var Dr=0,xr=0;xr<this.length;xr++){var Ir=(this.words[xr]|0)*gr,$r=(Ir&67108863)+(Dr&67108863);Dr>>=26,Dr+=Ir/67108864|0,Dr+=$r>>>26,this.words[xr]=$r&67108863}return Dr!==0&&(this.words[xr]=Dr,this.length++),wr?this.ineg():this},Nt.prototype.muln=function(gr){return this.clone().imuln(gr)},Nt.prototype.sqr=function(){return this.mul(this)},Nt.prototype.isqr=function(){return this.imul(this.clone())},Nt.prototype.pow=function(gr){var wr=ur(gr);if(wr.length===0)return new Nt(1);for(var Dr=this,xr=0;xr<wr.length&&wr[xr]===0;xr++,Dr=Dr.sqr());if(++xr<wr.length)for(var Ir=Dr.sqr();xr<wr.length;xr++,Ir=Ir.sqr())wr[xr]!==0&&(Dr=Dr.mul(Ir));return Dr},Nt.prototype.iushln=function(gr){kt(typeof gr=="number"&&gr>=0);var wr=gr%26,Dr=(gr-wr)/26,xr=67108863>>>26-wr<<26-wr,Ir;if(wr!==0){var $r=0;for(Ir=0;Ir<this.length;Ir++){var vr=this.words[Ir]&xr,Er=(this.words[Ir]|0)-vr<<wr;this.words[Ir]=Er|$r,$r=vr>>>26-wr}$r&&(this.words[Ir]=$r,this.length++)}if(Dr!==0){for(Ir=this.length-1;Ir>=0;Ir--)this.words[Ir+Dr]=this.words[Ir];for(Ir=0;Ir<Dr;Ir++)this.words[Ir]=0;this.length+=Dr}return this._strip()},Nt.prototype.ishln=function(gr){return kt(this.negative===0),this.iushln(gr)},Nt.prototype.iushrn=function(gr,wr,Dr){kt(typeof gr=="number"&&gr>=0);var xr;wr?xr=(wr-wr%26)/26:xr=0;var Ir=gr%26,$r=Math.min((gr-Ir)/26,this.length),vr=67108863^67108863>>>Ir<<Ir,Er=Dr;if(xr-=$r,xr=Math.max(0,xr),Er){for(var Tr=0;Tr<$r;Tr++)Er.words[Tr]=this.words[Tr];Er.length=$r}if($r!==0)if(this.length>$r)for(this.length-=$r,Tr=0;Tr<this.length;Tr++)this.words[Tr]=this.words[Tr+$r];else this.words[0]=0,this.length=1;var Rr=0;for(Tr=this.length-1;Tr>=0&&(Rr!==0||Tr>=xr);Tr--){var Mr=this.words[Tr]|0;this.words[Tr]=Rr<<26-Ir|Mr>>>Ir,Rr=Mr&vr}return Er&&Rr!==0&&(Er.words[Er.length++]=Rr),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},Nt.prototype.ishrn=function(gr,wr,Dr){return kt(this.negative===0),this.iushrn(gr,wr,Dr)},Nt.prototype.shln=function(gr){return this.clone().ishln(gr)},Nt.prototype.ushln=function(gr){return this.clone().iushln(gr)},Nt.prototype.shrn=function(gr){return this.clone().ishrn(gr)},Nt.prototype.ushrn=function(gr){return this.clone().iushrn(gr)},Nt.prototype.testn=function(gr){kt(typeof gr=="number"&&gr>=0);var wr=gr%26,Dr=(gr-wr)/26,xr=1<<wr;if(this.length<=Dr)return!1;var Ir=this.words[Dr];return!!(Ir&xr)},Nt.prototype.imaskn=function(gr){kt(typeof gr=="number"&&gr>=0);var wr=gr%26,Dr=(gr-wr)/26;if(kt(this.negative===0,"imaskn works only with positive numbers"),this.length<=Dr)return this;if(wr!==0&&Dr++,this.length=Math.min(Dr,this.length),wr!==0){var xr=67108863^67108863>>>wr<<wr;this.words[this.length-1]&=xr}return this._strip()},Nt.prototype.maskn=function(gr){return this.clone().imaskn(gr)},Nt.prototype.iaddn=function(gr){return kt(typeof gr=="number"),kt(gr<67108864),gr<0?this.isubn(-gr):this.negative!==0?this.length===1&&(this.words[0]|0)<=gr?(this.words[0]=gr-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(gr),this.negative=1,this):this._iaddn(gr)},Nt.prototype._iaddn=function(gr){this.words[0]+=gr;for(var wr=0;wr<this.length&&this.words[wr]>=67108864;wr++)this.words[wr]-=67108864,wr===this.length-1?this.words[wr+1]=1:this.words[wr+1]++;return this.length=Math.max(this.length,wr+1),this},Nt.prototype.isubn=function(gr){if(kt(typeof gr=="number"),kt(gr<67108864),gr<0)return this.iaddn(-gr);if(this.negative!==0)return this.negative=0,this.iaddn(gr),this.negative=1,this;if(this.words[0]-=gr,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var wr=0;wr<this.length&&this.words[wr]<0;wr++)this.words[wr]+=67108864,this.words[wr+1]-=1;return this._strip()},Nt.prototype.addn=function(gr){return this.clone().iaddn(gr)},Nt.prototype.subn=function(gr){return this.clone().isubn(gr)},Nt.prototype.iabs=function(){return this.negative=0,this},Nt.prototype.abs=function(){return this.clone().iabs()},Nt.prototype._ishlnsubmul=function(gr,wr,Dr){var xr=gr.length+Dr,Ir;this._expand(xr);var $r,vr=0;for(Ir=0;Ir<gr.length;Ir++){$r=(this.words[Ir+Dr]|0)+vr;var Er=(gr.words[Ir]|0)*wr;$r-=Er&67108863,vr=($r>>26)-(Er/67108864|0),this.words[Ir+Dr]=$r&67108863}for(;Ir<this.length-Dr;Ir++)$r=(this.words[Ir+Dr]|0)+vr,vr=$r>>26,this.words[Ir+Dr]=$r&67108863;if(vr===0)return this._strip();for(kt(vr===-1),vr=0,Ir=0;Ir<this.length;Ir++)$r=-(this.words[Ir]|0)+vr,vr=$r>>26,this.words[Ir]=$r&67108863;return this.negative=1,this._strip()},Nt.prototype._wordDiv=function(gr,wr){var Dr=this.length-gr.length,xr=this.clone(),Ir=gr,$r=Ir.words[Ir.length-1]|0,vr=this._countBits($r);Dr=26-vr,Dr!==0&&(Ir=Ir.ushln(Dr),xr.iushln(Dr),$r=Ir.words[Ir.length-1]|0);var Er=xr.length-Ir.length,Tr;if(wr!=="mod"){Tr=new Nt(null),Tr.length=Er+1,Tr.words=new Array(Tr.length);for(var Rr=0;Rr<Tr.length;Rr++)Tr.words[Rr]=0}var Mr=xr.clone()._ishlnsubmul(Ir,1,Er);Mr.negative===0&&(xr=Mr,Tr&&(Tr.words[Er]=1));for(var Gr=Er-1;Gr>=0;Gr--){var Br=(xr.words[Ir.length+Gr]|0)*67108864+(xr.words[Ir.length+Gr-1]|0);for(Br=Math.min(Br/$r|0,67108863),xr._ishlnsubmul(Ir,Br,Gr);xr.negative!==0;)Br--,xr.negative=0,xr._ishlnsubmul(Ir,1,Gr),xr.isZero()||(xr.negative^=1);Tr&&(Tr.words[Gr]=Br)}return Tr&&Tr._strip(),xr._strip(),wr!=="div"&&Dr!==0&&xr.iushrn(Dr),{div:Tr||null,mod:xr}},Nt.prototype.divmod=function(gr,wr,Dr){if(kt(!gr.isZero()),this.isZero())return{div:new Nt(0),mod:new Nt(0)};var xr,Ir,$r;return this.negative!==0&&gr.negative===0?($r=this.neg().divmod(gr,wr),wr!=="mod"&&(xr=$r.div.neg()),wr!=="div"&&(Ir=$r.mod.neg(),Dr&&Ir.negative!==0&&Ir.iadd(gr)),{div:xr,mod:Ir}):this.negative===0&&gr.negative!==0?($r=this.divmod(gr.neg(),wr),wr!=="mod"&&(xr=$r.div.neg()),{div:xr,mod:$r.mod}):this.negative&gr.negative?($r=this.neg().divmod(gr.neg(),wr),wr!=="div"&&(Ir=$r.mod.neg(),Dr&&Ir.negative!==0&&Ir.isub(gr)),{div:$r.div,mod:Ir}):gr.length>this.length||this.cmp(gr)<0?{div:new Nt(0),mod:this}:gr.length===1?wr==="div"?{div:this.divn(gr.words[0]),mod:null}:wr==="mod"?{div:null,mod:new Nt(this.modrn(gr.words[0]))}:{div:this.divn(gr.words[0]),mod:new Nt(this.modrn(gr.words[0]))}:this._wordDiv(gr,wr)},Nt.prototype.div=function(gr){return this.divmod(gr,"div",!1).div},Nt.prototype.mod=function(gr){return this.divmod(gr,"mod",!1).mod},Nt.prototype.umod=function(gr){return this.divmod(gr,"mod",!0).mod},Nt.prototype.divRound=function(gr){var wr=this.divmod(gr);if(wr.mod.isZero())return wr.div;var Dr=wr.div.negative!==0?wr.mod.isub(gr):wr.mod,xr=gr.ushrn(1),Ir=gr.andln(1),$r=Dr.cmp(xr);return $r<0||Ir===1&&$r===0?wr.div:wr.div.negative!==0?wr.div.isubn(1):wr.div.iaddn(1)},Nt.prototype.modrn=function(gr){var wr=gr<0;wr&&(gr=-gr),kt(gr<=67108863);for(var Dr=(1<<26)%gr,xr=0,Ir=this.length-1;Ir>=0;Ir--)xr=(Dr*xr+(this.words[Ir]|0))%gr;return wr?-xr:xr},Nt.prototype.modn=function(gr){return this.modrn(gr)},Nt.prototype.idivn=function(gr){var wr=gr<0;wr&&(gr=-gr),kt(gr<=67108863);for(var Dr=0,xr=this.length-1;xr>=0;xr--){var Ir=(this.words[xr]|0)+Dr*67108864;this.words[xr]=Ir/gr|0,Dr=Ir%gr}return this._strip(),wr?this.ineg():this},Nt.prototype.divn=function(gr){return this.clone().idivn(gr)},Nt.prototype.egcd=function(gr){kt(gr.negative===0),kt(!gr.isZero());var wr=this,Dr=gr.clone();wr.negative!==0?wr=wr.umod(gr):wr=wr.clone();for(var xr=new Nt(1),Ir=new Nt(0),$r=new Nt(0),vr=new Nt(1),Er=0;wr.isEven()&&Dr.isEven();)wr.iushrn(1),Dr.iushrn(1),++Er;for(var Tr=Dr.clone(),Rr=wr.clone();!wr.isZero();){for(var Mr=0,Gr=1;!(wr.words[0]&Gr)&&Mr<26;++Mr,Gr<<=1);if(Mr>0)for(wr.iushrn(Mr);Mr-- >0;)(xr.isOdd()||Ir.isOdd())&&(xr.iadd(Tr),Ir.isub(Rr)),xr.iushrn(1),Ir.iushrn(1);for(var Br=0,Cr=1;!(Dr.words[0]&Cr)&&Br<26;++Br,Cr<<=1);if(Br>0)for(Dr.iushrn(Br);Br-- >0;)($r.isOdd()||vr.isOdd())&&($r.iadd(Tr),vr.isub(Rr)),$r.iushrn(1),vr.iushrn(1);wr.cmp(Dr)>=0?(wr.isub(Dr),xr.isub($r),Ir.isub(vr)):(Dr.isub(wr),$r.isub(xr),vr.isub(Ir))}return{a:$r,b:vr,gcd:Dr.iushln(Er)}},Nt.prototype._invmp=function(gr){kt(gr.negative===0),kt(!gr.isZero());var wr=this,Dr=gr.clone();wr.negative!==0?wr=wr.umod(gr):wr=wr.clone();for(var xr=new Nt(1),Ir=new Nt(0),$r=Dr.clone();wr.cmpn(1)>0&&Dr.cmpn(1)>0;){for(var vr=0,Er=1;!(wr.words[0]&Er)&&vr<26;++vr,Er<<=1);if(vr>0)for(wr.iushrn(vr);vr-- >0;)xr.isOdd()&&xr.iadd($r),xr.iushrn(1);for(var Tr=0,Rr=1;!(Dr.words[0]&Rr)&&Tr<26;++Tr,Rr<<=1);if(Tr>0)for(Dr.iushrn(Tr);Tr-- >0;)Ir.isOdd()&&Ir.iadd($r),Ir.iushrn(1);wr.cmp(Dr)>=0?(wr.isub(Dr),xr.isub(Ir)):(Dr.isub(wr),Ir.isub(xr))}var Mr;return wr.cmpn(1)===0?Mr=xr:Mr=Ir,Mr.cmpn(0)<0&&Mr.iadd(gr),Mr},Nt.prototype.gcd=function(gr){if(this.isZero())return gr.abs();if(gr.isZero())return this.abs();var wr=this.clone(),Dr=gr.clone();wr.negative=0,Dr.negative=0;for(var xr=0;wr.isEven()&&Dr.isEven();xr++)wr.iushrn(1),Dr.iushrn(1);do{for(;wr.isEven();)wr.iushrn(1);for(;Dr.isEven();)Dr.iushrn(1);var Ir=wr.cmp(Dr);if(Ir<0){var $r=wr;wr=Dr,Dr=$r}else if(Ir===0||Dr.cmpn(1)===0)break;wr.isub(Dr)}while(!0);return Dr.iushln(xr)},Nt.prototype.invm=function(gr){return this.egcd(gr).a.umod(gr)},Nt.prototype.isEven=function(){return(this.words[0]&1)===0},Nt.prototype.isOdd=function(){return(this.words[0]&1)===1},Nt.prototype.andln=function(gr){return this.words[0]&gr},Nt.prototype.bincn=function(gr){kt(typeof gr=="number");var wr=gr%26,Dr=(gr-wr)/26,xr=1<<wr;if(this.length<=Dr)return this._expand(Dr+1),this.words[Dr]|=xr,this;for(var Ir=xr,$r=Dr;Ir!==0&&$r<this.length;$r++){var vr=this.words[$r]|0;vr+=Ir,Ir=vr>>>26,vr&=67108863,this.words[$r]=vr}return Ir!==0&&(this.words[$r]=Ir,this.length++),this},Nt.prototype.isZero=function(){return this.length===1&&this.words[0]===0},Nt.prototype.cmpn=function(gr){var wr=gr<0;if(this.negative!==0&&!wr)return-1;if(this.negative===0&&wr)return 1;this._strip();var Dr;if(this.length>1)Dr=1;else{wr&&(gr=-gr),kt(gr<=67108863,"Number is too big");var xr=this.words[0]|0;Dr=xr===gr?0:xr<gr?-1:1}return this.negative!==0?-Dr|0:Dr},Nt.prototype.cmp=function(gr){if(this.negative!==0&&gr.negative===0)return-1;if(this.negative===0&&gr.negative!==0)return 1;var wr=this.ucmp(gr);return this.negative!==0?-wr|0:wr},Nt.prototype.ucmp=function(gr){if(this.length>gr.length)return 1;if(this.length<gr.length)return-1;for(var wr=0,Dr=this.length-1;Dr>=0;Dr--){var xr=this.words[Dr]|0,Ir=gr.words[Dr]|0;if(xr!==Ir){xr<Ir?wr=-1:xr>Ir&&(wr=1);break}}return wr},Nt.prototype.gtn=function(gr){return this.cmpn(gr)===1},Nt.prototype.gt=function(gr){return this.cmp(gr)===1},Nt.prototype.gten=function(gr){return this.cmpn(gr)>=0},Nt.prototype.gte=function(gr){return this.cmp(gr)>=0},Nt.prototype.ltn=function(gr){return this.cmpn(gr)===-1},Nt.prototype.lt=function(gr){return this.cmp(gr)===-1},Nt.prototype.lten=function(gr){return this.cmpn(gr)<=0},Nt.prototype.lte=function(gr){return this.cmp(gr)<=0},Nt.prototype.eqn=function(gr){return this.cmpn(gr)===0},Nt.prototype.eq=function(gr){return this.cmp(gr)===0},Nt.red=function(gr){return new Lr(gr)},Nt.prototype.toRed=function(gr){return kt(!this.red,"Already a number in reduction context"),kt(this.negative===0,"red works only with positives"),gr.convertTo(this)._forceRed(gr)},Nt.prototype.fromRed=function(){return kt(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},Nt.prototype._forceRed=function(gr){return this.red=gr,this},Nt.prototype.forceRed=function(gr){return kt(!this.red,"Already a number in reduction context"),this._forceRed(gr)},Nt.prototype.redAdd=function(gr){return kt(this.red,"redAdd works only with red numbers"),this.red.add(this,gr)},Nt.prototype.redIAdd=function(gr){return kt(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,gr)},Nt.prototype.redSub=function(gr){return kt(this.red,"redSub works only with red numbers"),this.red.sub(this,gr)},Nt.prototype.redISub=function(gr){return kt(this.red,"redISub works only with red numbers"),this.red.isub(this,gr)},Nt.prototype.redShl=function(gr){return kt(this.red,"redShl works only with red numbers"),this.red.shl(this,gr)},Nt.prototype.redMul=function(gr){return kt(this.red,"redMul works only with red numbers"),this.red._verify2(this,gr),this.red.mul(this,gr)},Nt.prototype.redIMul=function(gr){return kt(this.red,"redMul works only with red numbers"),this.red._verify2(this,gr),this.red.imul(this,gr)},Nt.prototype.redSqr=function(){return kt(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},Nt.prototype.redISqr=function(){return kt(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},Nt.prototype.redSqrt=function(){return kt(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},Nt.prototype.redInvm=function(){return kt(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},Nt.prototype.redNeg=function(){return kt(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},Nt.prototype.redPow=function(gr){return kt(this.red&&!gr.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,gr)};var br={k256:null,p224:null,p192:null,p25519:null};function Ar(_r,gr){this.name=_r,this.p=new Nt(gr,16),this.n=this.p.bitLength(),this.k=new Nt(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}Ar.prototype._tmp=function(){var gr=new Nt(null);return gr.words=new Array(Math.ceil(this.n/13)),gr},Ar.prototype.ireduce=function(gr){var wr=gr,Dr;do this.split(wr,this.tmp),wr=this.imulK(wr),wr=wr.iadd(this.tmp),Dr=wr.bitLength();while(Dr>this.n);var xr=Dr<this.n?-1:wr.ucmp(this.p);return xr===0?(wr.words[0]=0,wr.length=1):xr>0?wr.isub(this.p):wr.strip!==void 0?wr.strip():wr._strip(),wr},Ar.prototype.split=function(gr,wr){gr.iushrn(this.n,0,wr)},Ar.prototype.imulK=function(gr){return gr.imul(this.k)};function Pr(){Ar.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}Bt(Pr,Ar),Pr.prototype.split=function(gr,wr){for(var Dr=4194303,xr=Math.min(gr.length,9),Ir=0;Ir<xr;Ir++)wr.words[Ir]=gr.words[Ir];if(wr.length=xr,gr.length<=9){gr.words[0]=0,gr.length=1;return}var $r=gr.words[9];for(wr.words[wr.length++]=$r&Dr,Ir=10;Ir<gr.length;Ir++){var vr=gr.words[Ir]|0;gr.words[Ir-10]=(vr&Dr)<<4|$r>>>22,$r=vr}$r>>>=22,gr.words[Ir-10]=$r,$r===0&&gr.length>10?gr.length-=10:gr.length-=9},Pr.prototype.imulK=function(gr){gr.words[gr.length]=0,gr.words[gr.length+1]=0,gr.length+=2;for(var wr=0,Dr=0;Dr<gr.length;Dr++){var xr=gr.words[Dr]|0;wr+=xr*977,gr.words[Dr]=wr&67108863,wr=xr*64+(wr/67108864|0)}return gr.words[gr.length-1]===0&&(gr.length--,gr.words[gr.length-1]===0&&gr.length--),gr};function kr(){Ar.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}Bt(kr,Ar);function Ur(){Ar.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}Bt(Ur,Ar);function Hr(){Ar.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}Bt(Hr,Ar),Hr.prototype.imulK=function(gr){for(var wr=0,Dr=0;Dr<gr.length;Dr++){var xr=(gr.words[Dr]|0)*19+wr,Ir=xr&67108863;xr>>>=26,gr.words[Dr]=Ir,wr=xr}return wr!==0&&(gr.words[gr.length++]=wr),gr},Nt._prime=function(gr){if(br[gr])return br[gr];var wr;if(gr==="k256")wr=new Pr;else if(gr==="p224")wr=new kr;else if(gr==="p192")wr=new Ur;else if(gr==="p25519")wr=new Hr;else throw new Error("Unknown prime "+gr);return br[gr]=wr,wr};function Lr(_r){if(typeof _r=="string"){var gr=Nt._prime(_r);this.m=gr.p,this.prime=gr}else kt(_r.gtn(1),"modulus must be greater than 1"),this.m=_r,this.prime=null}Lr.prototype._verify1=function(gr){kt(gr.negative===0,"red works only with positives"),kt(gr.red,"red works only with red numbers")},Lr.prototype._verify2=function(gr,wr){kt((gr.negative|wr.negative)===0,"red works only with positives"),kt(gr.red&&gr.red===wr.red,"red works only with red numbers")},Lr.prototype.imod=function(gr){return this.prime?this.prime.ireduce(gr)._forceRed(this):(zt(gr,gr.umod(this.m)._forceRed(this)),gr)},Lr.prototype.neg=function(gr){return gr.isZero()?gr.clone():this.m.sub(gr)._forceRed(this)},Lr.prototype.add=function(gr,wr){this._verify2(gr,wr);var Dr=gr.add(wr);return Dr.cmp(this.m)>=0&&Dr.isub(this.m),Dr._forceRed(this)},Lr.prototype.iadd=function(gr,wr){this._verify2(gr,wr);var Dr=gr.iadd(wr);return Dr.cmp(this.m)>=0&&Dr.isub(this.m),Dr},Lr.prototype.sub=function(gr,wr){this._verify2(gr,wr);var Dr=gr.sub(wr);return Dr.cmpn(0)<0&&Dr.iadd(this.m),Dr._forceRed(this)},Lr.prototype.isub=function(gr,wr){this._verify2(gr,wr);var Dr=gr.isub(wr);return Dr.cmpn(0)<0&&Dr.iadd(this.m),Dr},Lr.prototype.shl=function(gr,wr){return this._verify1(gr),this.imod(gr.ushln(wr))},Lr.prototype.imul=function(gr,wr){return this._verify2(gr,wr),this.imod(gr.imul(wr))},Lr.prototype.mul=function(gr,wr){return this._verify2(gr,wr),this.imod(gr.mul(wr))},Lr.prototype.isqr=function(gr){return this.imul(gr,gr.clone())},Lr.prototype.sqr=function(gr){return this.mul(gr,gr)},Lr.prototype.sqrt=function(gr){if(gr.isZero())return gr.clone();var wr=this.m.andln(3);if(kt(wr%2===1),wr===3){var Dr=this.m.add(new Nt(1)).iushrn(2);return this.pow(gr,Dr)}for(var xr=this.m.subn(1),Ir=0;!xr.isZero()&&xr.andln(1)===0;)Ir++,xr.iushrn(1);kt(!xr.isZero());var $r=new Nt(1).toRed(this),vr=$r.redNeg(),Er=this.m.subn(1).iushrn(1),Tr=this.m.bitLength();for(Tr=new Nt(2*Tr*Tr).toRed(this);this.pow(Tr,Er).cmp(vr)!==0;)Tr.redIAdd(vr);for(var Rr=this.pow(Tr,xr),Mr=this.pow(gr,xr.addn(1).iushrn(1)),Gr=this.pow(gr,xr),Br=Ir;Gr.cmp($r)!==0;){for(var Cr=Gr,jr=0;Cr.cmp($r)!==0;jr++)Cr=Cr.redSqr();kt(jr<Br);var Yr=this.pow(Rr,new Nt(1).iushln(Br-jr-1));Mr=Mr.redMul(Yr),Rr=Yr.redSqr(),Gr=Gr.redMul(Rr),Br=jr}return Mr},Lr.prototype.invm=function(gr){var wr=gr._invmp(this.m);return wr.negative!==0?(wr.negative=0,this.imod(wr).redNeg()):this.imod(wr)},Lr.prototype.pow=function(gr,wr){if(wr.isZero())return new Nt(1).toRed(this);if(wr.cmpn(1)===0)return gr.clone();var Dr=4,xr=new Array(1<<Dr);xr[0]=new Nt(1).toRed(this),xr[1]=gr;for(var Ir=2;Ir<xr.length;Ir++)xr[Ir]=this.mul(xr[Ir-1],gr);var $r=xr[0],vr=0,Er=0,Tr=wr.bitLength()%26;for(Tr===0&&(Tr=26),Ir=wr.length-1;Ir>=0;Ir--){for(var Rr=wr.words[Ir],Mr=Tr-1;Mr>=0;Mr--){var Gr=Rr>>Mr&1;if($r!==xr[0]&&($r=this.sqr($r)),Gr===0&&vr===0){Er=0;continue}vr<<=1,vr|=Gr,Er++,!(Er!==Dr&&(Ir!==0||Mr!==0))&&($r=this.mul($r,xr[vr]),Er=0,vr=0)}Tr=26}return $r},Lr.prototype.convertTo=function(gr){var wr=gr.umod(this.m);return wr===gr?wr.clone():wr},Lr.prototype.convertFrom=function(gr){var wr=gr.clone();return wr.red=null,wr},Nt.mont=function(gr){return new Sr(gr)};function Sr(_r){Lr.call(this,_r),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new Nt(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}Bt(Sr,Lr),Sr.prototype.convertTo=function(gr){return this.imod(gr.ushln(this.shift))},Sr.prototype.convertFrom=function(gr){var wr=this.imod(gr.mul(this.rinv));return wr.red=null,wr},Sr.prototype.imul=function(gr,wr){if(gr.isZero()||wr.isZero())return gr.words[0]=0,gr.length=1,gr;var Dr=gr.imul(wr),xr=Dr.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Ir=Dr.isub(xr).iushrn(this.shift),$r=Ir;return Ir.cmp(this.m)>=0?$r=Ir.isub(this.m):Ir.cmpn(0)<0&&($r=Ir.iadd(this.m)),$r._forceRed(this)},Sr.prototype.mul=function(gr,wr){if(gr.isZero()||wr.isZero())return new Nt(0)._forceRed(this);var Dr=gr.mul(wr),xr=Dr.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),Ir=Dr.isub(xr).iushrn(this.shift),$r=Ir;return Ir.cmp(this.m)>=0?$r=Ir.isub(this.m):Ir.cmpn(0)<0&&($r=Ir.iadd(this.m)),$r._forceRed(this)},Sr.prototype.invm=function(gr){var wr=this.imod(gr._invmp(this.m).mul(this.r2));return wr._forceRed(this)}})(xt,commonjsGlobal)})(bn);var bnExports=bn.exports,BN$a=bnExports,randomBytes$5=browserExports$2;function blind(xt){var e=getr(xt),At=e.toRed(BN$a.mont(xt.modulus)).redPow(new BN$a(xt.publicExponent)).fromRed();return{blinder:At,unblinder:e.invm(xt.modulus)}}function getr(xt){var e=xt.modulus.byteLength(),At;do At=new BN$a(randomBytes$5(e));while(At.cmp(xt.modulus)>=0||!At.umod(xt.prime1)||!At.umod(xt.prime2));return At}function crt$2(xt,e){var At=blind(e),kt=e.modulus.byteLength(),Bt=new BN$a(xt).mul(At.blinder).umod(e.modulus),Nt=Bt.toRed(BN$a.mont(e.prime1)),jt=Bt.toRed(BN$a.mont(e.prime2)),Lt=e.coefficient,er=e.prime1,tr=e.prime2,zt=Nt.redPow(e.exponent1).fromRed(),rr=jt.redPow(e.exponent2).fromRed(),nr=zt.isub(rr).imul(Lt).umod(er).imul(tr);return rr.iadd(nr).imul(At.unblinder).umod(e.modulus).toArrayLike(buffer$2.Buffer,"be",kt)}crt$2.getr=getr;var browserifyRsa=crt$2,elliptic$1={};const name$2="elliptic",version="6.5.6",description$1="EC cryptography",main="lib/elliptic.js",files=["lib"],scripts={lint:"eslint lib test","lint:fix":"npm run lint -- --fix",unit:"istanbul test _mocha --reporter=spec test/index.js",test:"npm run lint && npm run unit",version:"grunt dist && git add dist/"},repository={type:"git",url:"git@github.com:indutny/elliptic"},keywords=["EC","Elliptic","curve","Cryptography"],author="Fedor Indutny <fedor@indutny.com>",license="MIT",bugs={url:"https://github.com/indutny/elliptic/issues"},homepage="https://github.com/indutny/elliptic",devDependencies={brfs:"^2.0.2",coveralls:"^3.1.0",eslint:"^7.6.0",grunt:"^1.2.1","grunt-browserify":"^5.3.0","grunt-cli":"^1.3.2","grunt-contrib-connect":"^3.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^5.0.0","grunt-mocha-istanbul":"^5.0.2","grunt-saucelabs":"^9.0.1",istanbul:"^0.4.5",mocha:"^8.0.1"},dependencies$1={"bn.js":"^4.11.9",brorand:"^1.1.0","hash.js":"^1.0.0","hmac-drbg":"^1.0.1",inherits:"^2.0.4","minimalistic-assert":"^1.0.1","minimalistic-crypto-utils":"^1.0.1"},require$$0$3={name:name$2,version,description:description$1,main,files,scripts,repository,keywords,author,license,bugs,homepage,devDependencies,dependencies:dependencies$1};var utils$t={},utils$s={};(function(xt){var e=xt;function At(Nt,jt){if(Array.isArray(Nt))return Nt.slice();if(!Nt)return[];var Lt=[];if(typeof Nt!="string"){for(var er=0;er<Nt.length;er++)Lt[er]=Nt[er]|0;return Lt}if(jt==="hex"){Nt=Nt.replace(/[^a-z0-9]+/ig,""),Nt.length%2!==0&&(Nt="0"+Nt);for(var er=0;er<Nt.length;er+=2)Lt.push(parseInt(Nt[er]+Nt[er+1],16))}else for(var er=0;er<Nt.length;er++){var tr=Nt.charCodeAt(er),zt=tr>>8,rr=tr&255;zt?Lt.push(zt,rr):Lt.push(rr)}return Lt}e.toArray=At;function kt(Nt){return Nt.length===1?"0"+Nt:Nt}e.zero2=kt;function Bt(Nt){for(var jt="",Lt=0;Lt<Nt.length;Lt++)jt+=kt(Nt[Lt].toString(16));return jt}e.toHex=Bt,e.encode=function(jt,Lt){return Lt==="hex"?Bt(jt):jt}})(utils$s);(function(xt){var e=xt,At=bnExports$1,kt=minimalisticAssert,Bt=utils$s;e.assert=kt,e.toArray=Bt.toArray,e.zero2=Bt.zero2,e.toHex=Bt.toHex,e.encode=Bt.encode;function Nt(zt,rr,nr){var ir=new Array(Math.max(zt.bitLength(),nr)+1),ar;for(ar=0;ar<ir.length;ar+=1)ir[ar]=0;var dr=1<<rr+1,ur=zt.clone();for(ar=0;ar<ir.length;ar++){var fr,pr=ur.andln(dr-1);ur.isOdd()?(pr>(dr>>1)-1?fr=(dr>>1)-pr:fr=pr,ur.isubn(fr)):fr=0,ir[ar]=fr,ur.iushrn(1)}return ir}e.getNAF=Nt;function jt(zt,rr){var nr=[[],[]];zt=zt.clone(),rr=rr.clone();for(var ir=0,ar=0,dr;zt.cmpn(-ir)>0||rr.cmpn(-ar)>0;){var ur=zt.andln(3)+ir&3,fr=rr.andln(3)+ar&3;ur===3&&(ur=-1),fr===3&&(fr=-1);var pr;ur&1?(dr=zt.andln(7)+ir&7,(dr===3||dr===5)&&fr===2?pr=-ur:pr=ur):pr=0,nr[0].push(pr);var lr;fr&1?(dr=rr.andln(7)+ar&7,(dr===3||dr===5)&&ur===2?lr=-fr:lr=fr):lr=0,nr[1].push(lr),2*ir===pr+1&&(ir=1-ir),2*ar===lr+1&&(ar=1-ar),zt.iushrn(1),rr.iushrn(1)}return nr}e.getJSF=jt;function Lt(zt,rr,nr){var ir="_"+rr;zt.prototype[rr]=function(){return this[ir]!==void 0?this[ir]:this[ir]=nr.call(this)}}e.cachedProperty=Lt;function er(zt){return typeof zt=="string"?e.toArray(zt,"hex"):zt}e.parseBytes=er;function tr(zt){return new At(zt,"hex","le")}e.intFromLE=tr})(utils$t);var curve$1={},BN$9=bnExports$1,utils$r=utils$t,getNAF=utils$r.getNAF,getJSF=utils$r.getJSF,assert$h=utils$r.assert;function BaseCurve(xt,e){this.type=xt,this.p=new BN$9(e.p,16),this.red=e.prime?BN$9.red(e.prime):BN$9.mont(this.p),this.zero=new BN$9(0).toRed(this.red),this.one=new BN$9(1).toRed(this.red),this.two=new BN$9(2).toRed(this.red),this.n=e.n&&new BN$9(e.n,16),this.g=e.g&&this.pointFromJSON(e.g,e.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var At=this.n&&this.p.div(this.n);!At||At.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}var base$2=BaseCurve;BaseCurve.prototype.point=function(){throw new Error("Not implemented")};BaseCurve.prototype.validate=function(){throw new Error("Not implemented")};BaseCurve.prototype._fixedNafMul=function(e,At){assert$h(e.precomputed);var kt=e._getDoubles(),Bt=getNAF(At,1,this._bitLength),Nt=(1<<kt.step+1)-(kt.step%2===0?2:1);Nt/=3;var jt=[],Lt,er;for(Lt=0;Lt<Bt.length;Lt+=kt.step){er=0;for(var tr=Lt+kt.step-1;tr>=Lt;tr--)er=(er<<1)+Bt[tr];jt.push(er)}for(var zt=this.jpoint(null,null,null),rr=this.jpoint(null,null,null),nr=Nt;nr>0;nr--){for(Lt=0;Lt<jt.length;Lt++)er=jt[Lt],er===nr?rr=rr.mixedAdd(kt.points[Lt]):er===-nr&&(rr=rr.mixedAdd(kt.points[Lt].neg()));zt=zt.add(rr)}return zt.toP()};BaseCurve.prototype._wnafMul=function(e,At){var kt=4,Bt=e._getNAFPoints(kt);kt=Bt.wnd;for(var Nt=Bt.points,jt=getNAF(At,kt,this._bitLength),Lt=this.jpoint(null,null,null),er=jt.length-1;er>=0;er--){for(var tr=0;er>=0&&jt[er]===0;er--)tr++;if(er>=0&&tr++,Lt=Lt.dblp(tr),er<0)break;var zt=jt[er];assert$h(zt!==0),e.type==="affine"?zt>0?Lt=Lt.mixedAdd(Nt[zt-1>>1]):Lt=Lt.mixedAdd(Nt[-zt-1>>1].neg()):zt>0?Lt=Lt.add(Nt[zt-1>>1]):Lt=Lt.add(Nt[-zt-1>>1].neg())}return e.type==="affine"?Lt.toP():Lt};BaseCurve.prototype._wnafMulAdd=function(e,At,kt,Bt,Nt){var jt=this._wnafT1,Lt=this._wnafT2,er=this._wnafT3,tr=0,zt,rr,nr;for(zt=0;zt<Bt;zt++){nr=At[zt];var ir=nr._getNAFPoints(e);jt[zt]=ir.wnd,Lt[zt]=ir.points}for(zt=Bt-1;zt>=1;zt-=2){var ar=zt-1,dr=zt;if(jt[ar]!==1||jt[dr]!==1){er[ar]=getNAF(kt[ar],jt[ar],this._bitLength),er[dr]=getNAF(kt[dr],jt[dr],this._bitLength),tr=Math.max(er[ar].length,tr),tr=Math.max(er[dr].length,tr);continue}var ur=[At[ar],null,null,At[dr]];At[ar].y.cmp(At[dr].y)===0?(ur[1]=At[ar].add(At[dr]),ur[2]=At[ar].toJ().mixedAdd(At[dr].neg())):At[ar].y.cmp(At[dr].y.redNeg())===0?(ur[1]=At[ar].toJ().mixedAdd(At[dr]),ur[2]=At[ar].add(At[dr].neg())):(ur[1]=At[ar].toJ().mixedAdd(At[dr]),ur[2]=At[ar].toJ().mixedAdd(At[dr].neg()));var fr=[-3,-1,-5,-7,0,7,5,1,3],pr=getJSF(kt[ar],kt[dr]);for(tr=Math.max(pr[0].length,tr),er[ar]=new Array(tr),er[dr]=new Array(tr),rr=0;rr<tr;rr++){var lr=pr[0][rr]|0,yr=pr[1][rr]|0;er[ar][rr]=fr[(lr+1)*3+(yr+1)],er[dr][rr]=0,Lt[ar]=ur}}var br=this.jpoint(null,null,null),Ar=this._wnafT4;for(zt=tr;zt>=0;zt--){for(var Pr=0;zt>=0;){var kr=!0;for(rr=0;rr<Bt;rr++)Ar[rr]=er[rr][zt]|0,Ar[rr]!==0&&(kr=!1);if(!kr)break;Pr++,zt--}if(zt>=0&&Pr++,br=br.dblp(Pr),zt<0)break;for(rr=0;rr<Bt;rr++){var Ur=Ar[rr];Ur!==0&&(Ur>0?nr=Lt[rr][Ur-1>>1]:Ur<0&&(nr=Lt[rr][-Ur-1>>1].neg()),nr.type==="affine"?br=br.mixedAdd(nr):br=br.add(nr))}}for(zt=0;zt<Bt;zt++)Lt[zt]=null;return Nt?br:br.toP()};function BasePoint(xt,e){this.curve=xt,this.type=e,this.precomputed=null}BaseCurve.BasePoint=BasePoint;BasePoint.prototype.eq=function(){throw new Error("Not implemented")};BasePoint.prototype.validate=function(){return this.curve.validate(this)};BaseCurve.prototype.decodePoint=function(e,At){e=utils$r.toArray(e,At);var kt=this.p.byteLength();if((e[0]===4||e[0]===6||e[0]===7)&&e.length-1===2*kt){e[0]===6?assert$h(e[e.length-1]%2===0):e[0]===7&&assert$h(e[e.length-1]%2===1);var Bt=this.point(e.slice(1,1+kt),e.slice(1+kt,1+2*kt));return Bt}else if((e[0]===2||e[0]===3)&&e.length-1===kt)return this.pointFromX(e.slice(1,1+kt),e[0]===3);throw new Error("Unknown point format")};BasePoint.prototype.encodeCompressed=function(e){return this.encode(e,!0)};BasePoint.prototype._encode=function(e){var At=this.curve.p.byteLength(),kt=this.getX().toArray("be",At);return e?[this.getY().isEven()?2:3].concat(kt):[4].concat(kt,this.getY().toArray("be",At))};BasePoint.prototype.encode=function(e,At){return utils$r.encode(this._encode(At),e)};BasePoint.prototype.precompute=function(e){if(this.precomputed)return this;var At={doubles:null,naf:null,beta:null};return At.naf=this._getNAFPoints(8),At.doubles=this._getDoubles(4,e),At.beta=this._getBeta(),this.precomputed=At,this};BasePoint.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var At=this.precomputed.doubles;return At?At.points.length>=Math.ceil((e.bitLength()+1)/At.step):!1};BasePoint.prototype._getDoubles=function(e,At){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var kt=[this],Bt=this,Nt=0;Nt<At;Nt+=e){for(var jt=0;jt<e;jt++)Bt=Bt.dbl();kt.push(Bt)}return{step:e,points:kt}};BasePoint.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var At=[this],kt=(1<<e)-1,Bt=kt===1?null:this.dbl(),Nt=1;Nt<kt;Nt++)At[Nt]=At[Nt-1].add(Bt);return{wnd:e,points:At}};BasePoint.prototype._getBeta=function(){return null};BasePoint.prototype.dblp=function(e){for(var At=this,kt=0;kt<e;kt++)At=At.dbl();return At};var utils$q=utils$t,BN$8=bnExports$1,inherits$4=inherits_browserExports,Base$2=base$2,assert$g=utils$q.assert;function ShortCurve(xt){Base$2.call(this,"short",xt),this.a=new BN$8(xt.a,16).toRed(this.red),this.b=new BN$8(xt.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(xt),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}inherits$4(ShortCurve,Base$2);var short=ShortCurve;ShortCurve.prototype._getEndomorphism=function(e){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var At,kt;if(e.beta)At=new BN$8(e.beta,16).toRed(this.red);else{var Bt=this._getEndoRoots(this.p);At=Bt[0].cmp(Bt[1])<0?Bt[0]:Bt[1],At=At.toRed(this.red)}if(e.lambda)kt=new BN$8(e.lambda,16);else{var Nt=this._getEndoRoots(this.n);this.g.mul(Nt[0]).x.cmp(this.g.x.redMul(At))===0?kt=Nt[0]:(kt=Nt[1],assert$g(this.g.mul(kt).x.cmp(this.g.x.redMul(At))===0))}var jt;return e.basis?jt=e.basis.map(function(Lt){return{a:new BN$8(Lt.a,16),b:new BN$8(Lt.b,16)}}):jt=this._getEndoBasis(kt),{beta:At,lambda:kt,basis:jt}}};ShortCurve.prototype._getEndoRoots=function(e){var At=e===this.p?this.red:BN$8.mont(e),kt=new BN$8(2).toRed(At).redInvm(),Bt=kt.redNeg(),Nt=new BN$8(3).toRed(At).redNeg().redSqrt().redMul(kt),jt=Bt.redAdd(Nt).fromRed(),Lt=Bt.redSub(Nt).fromRed();return[jt,Lt]};ShortCurve.prototype._getEndoBasis=function(e){for(var At=this.n.ushrn(Math.floor(this.n.bitLength()/2)),kt=e,Bt=this.n.clone(),Nt=new BN$8(1),jt=new BN$8(0),Lt=new BN$8(0),er=new BN$8(1),tr,zt,rr,nr,ir,ar,dr,ur=0,fr,pr;kt.cmpn(0)!==0;){var lr=Bt.div(kt);fr=Bt.sub(lr.mul(kt)),pr=Lt.sub(lr.mul(Nt));var yr=er.sub(lr.mul(jt));if(!rr&&fr.cmp(At)<0)tr=dr.neg(),zt=Nt,rr=fr.neg(),nr=pr;else if(rr&&++ur===2)break;dr=fr,Bt=kt,kt=fr,Lt=Nt,Nt=pr,er=jt,jt=yr}ir=fr.neg(),ar=pr;var br=rr.sqr().add(nr.sqr()),Ar=ir.sqr().add(ar.sqr());return Ar.cmp(br)>=0&&(ir=tr,ar=zt),rr.negative&&(rr=rr.neg(),nr=nr.neg()),ir.negative&&(ir=ir.neg(),ar=ar.neg()),[{a:rr,b:nr},{a:ir,b:ar}]};ShortCurve.prototype._endoSplit=function(e){var At=this.endo.basis,kt=At[0],Bt=At[1],Nt=Bt.b.mul(e).divRound(this.n),jt=kt.b.neg().mul(e).divRound(this.n),Lt=Nt.mul(kt.a),er=jt.mul(Bt.a),tr=Nt.mul(kt.b),zt=jt.mul(Bt.b),rr=e.sub(Lt).sub(er),nr=tr.add(zt).neg();return{k1:rr,k2:nr}};ShortCurve.prototype.pointFromX=function(e,At){e=new BN$8(e,16),e.red||(e=e.toRed(this.red));var kt=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),Bt=kt.redSqrt();if(Bt.redSqr().redSub(kt).cmp(this.zero)!==0)throw new Error("invalid point");var Nt=Bt.fromRed().isOdd();return(At&&!Nt||!At&&Nt)&&(Bt=Bt.redNeg()),this.point(e,Bt)};ShortCurve.prototype.validate=function(e){if(e.inf)return!0;var At=e.x,kt=e.y,Bt=this.a.redMul(At),Nt=At.redSqr().redMul(At).redIAdd(Bt).redIAdd(this.b);return kt.redSqr().redISub(Nt).cmpn(0)===0};ShortCurve.prototype._endoWnafMulAdd=function(e,At,kt){for(var Bt=this._endoWnafT1,Nt=this._endoWnafT2,jt=0;jt<e.length;jt++){var Lt=this._endoSplit(At[jt]),er=e[jt],tr=er._getBeta();Lt.k1.negative&&(Lt.k1.ineg(),er=er.neg(!0)),Lt.k2.negative&&(Lt.k2.ineg(),tr=tr.neg(!0)),Bt[jt*2]=er,Bt[jt*2+1]=tr,Nt[jt*2]=Lt.k1,Nt[jt*2+1]=Lt.k2}for(var zt=this._wnafMulAdd(1,Bt,Nt,jt*2,kt),rr=0;rr<jt*2;rr++)Bt[rr]=null,Nt[rr]=null;return zt};function Point$2(xt,e,At,kt){Base$2.BasePoint.call(this,xt,"affine"),e===null&&At===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new BN$8(e,16),this.y=new BN$8(At,16),kt&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}inherits$4(Point$2,Base$2.BasePoint);ShortCurve.prototype.point=function(e,At,kt){return new Point$2(this,e,At,kt)};ShortCurve.prototype.pointFromJSON=function(e,At){return Point$2.fromJSON(this,e,At)};Point$2.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var At=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var kt=this.curve,Bt=function(Nt){return kt.point(Nt.x.redMul(kt.endo.beta),Nt.y)};e.beta=At,At.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(Bt)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(Bt)}}}return At}};Point$2.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]};Point$2.fromJSON=function(e,At,kt){typeof At=="string"&&(At=JSON.parse(At));var Bt=e.point(At[0],At[1],kt);if(!At[2])return Bt;function Nt(Lt){return e.point(Lt[0],Lt[1],kt)}var jt=At[2];return Bt.precomputed={beta:null,doubles:jt.doubles&&{step:jt.doubles.step,points:[Bt].concat(jt.doubles.points.map(Nt))},naf:jt.naf&&{wnd:jt.naf.wnd,points:[Bt].concat(jt.naf.points.map(Nt))}},Bt};Point$2.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"};Point$2.prototype.isInfinity=function(){return this.inf};Point$2.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(this.x.cmp(e.x)===0)return this.curve.point(null,null);var At=this.y.redSub(e.y);At.cmpn(0)!==0&&(At=At.redMul(this.x.redSub(e.x).redInvm()));var kt=At.redSqr().redISub(this.x).redISub(e.x),Bt=At.redMul(this.x.redSub(kt)).redISub(this.y);return this.curve.point(kt,Bt)};Point$2.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(e.cmpn(0)===0)return this.curve.point(null,null);var At=this.curve.a,kt=this.x.redSqr(),Bt=e.redInvm(),Nt=kt.redAdd(kt).redIAdd(kt).redIAdd(At).redMul(Bt),jt=Nt.redSqr().redISub(this.x.redAdd(this.x)),Lt=Nt.redMul(this.x.redSub(jt)).redISub(this.y);return this.curve.point(jt,Lt)};Point$2.prototype.getX=function(){return this.x.fromRed()};Point$2.prototype.getY=function(){return this.y.fromRed()};Point$2.prototype.mul=function(e){return e=new BN$8(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)};Point$2.prototype.mulAdd=function(e,At,kt){var Bt=[this,At],Nt=[e,kt];return this.curve.endo?this.curve._endoWnafMulAdd(Bt,Nt):this.curve._wnafMulAdd(1,Bt,Nt,2)};Point$2.prototype.jmulAdd=function(e,At,kt){var Bt=[this,At],Nt=[e,kt];return this.curve.endo?this.curve._endoWnafMulAdd(Bt,Nt,!0):this.curve._wnafMulAdd(1,Bt,Nt,2,!0)};Point$2.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||this.x.cmp(e.x)===0&&this.y.cmp(e.y)===0)};Point$2.prototype.neg=function(e){if(this.inf)return this;var At=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var kt=this.precomputed,Bt=function(Nt){return Nt.neg()};At.precomputed={naf:kt.naf&&{wnd:kt.naf.wnd,points:kt.naf.points.map(Bt)},doubles:kt.doubles&&{step:kt.doubles.step,points:kt.doubles.points.map(Bt)}}}return At};Point$2.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var e=this.curve.jpoint(this.x,this.y,this.curve.one);return e};function JPoint(xt,e,At,kt){Base$2.BasePoint.call(this,xt,"jacobian"),e===null&&At===null&&kt===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new BN$8(0)):(this.x=new BN$8(e,16),this.y=new BN$8(At,16),this.z=new BN$8(kt,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}inherits$4(JPoint,Base$2.BasePoint);ShortCurve.prototype.jpoint=function(e,At,kt){return new JPoint(this,e,At,kt)};JPoint.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),At=e.redSqr(),kt=this.x.redMul(At),Bt=this.y.redMul(At).redMul(e);return this.curve.point(kt,Bt)};JPoint.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)};JPoint.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var At=e.z.redSqr(),kt=this.z.redSqr(),Bt=this.x.redMul(At),Nt=e.x.redMul(kt),jt=this.y.redMul(At.redMul(e.z)),Lt=e.y.redMul(kt.redMul(this.z)),er=Bt.redSub(Nt),tr=jt.redSub(Lt);if(er.cmpn(0)===0)return tr.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var zt=er.redSqr(),rr=zt.redMul(er),nr=Bt.redMul(zt),ir=tr.redSqr().redIAdd(rr).redISub(nr).redISub(nr),ar=tr.redMul(nr.redISub(ir)).redISub(jt.redMul(rr)),dr=this.z.redMul(e.z).redMul(er);return this.curve.jpoint(ir,ar,dr)};JPoint.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var At=this.z.redSqr(),kt=this.x,Bt=e.x.redMul(At),Nt=this.y,jt=e.y.redMul(At).redMul(this.z),Lt=kt.redSub(Bt),er=Nt.redSub(jt);if(Lt.cmpn(0)===0)return er.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var tr=Lt.redSqr(),zt=tr.redMul(Lt),rr=kt.redMul(tr),nr=er.redSqr().redIAdd(zt).redISub(rr).redISub(rr),ir=er.redMul(rr.redISub(nr)).redISub(Nt.redMul(zt)),ar=this.z.redMul(Lt);return this.curve.jpoint(nr,ir,ar)};JPoint.prototype.dblp=function(e){if(e===0)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var At;if(this.curve.zeroA||this.curve.threeA){var kt=this;for(At=0;At<e;At++)kt=kt.dbl();return kt}var Bt=this.curve.a,Nt=this.curve.tinv,jt=this.x,Lt=this.y,er=this.z,tr=er.redSqr().redSqr(),zt=Lt.redAdd(Lt);for(At=0;At<e;At++){var rr=jt.redSqr(),nr=zt.redSqr(),ir=nr.redSqr(),ar=rr.redAdd(rr).redIAdd(rr).redIAdd(Bt.redMul(tr)),dr=jt.redMul(nr),ur=ar.redSqr().redISub(dr.redAdd(dr)),fr=dr.redISub(ur),pr=ar.redMul(fr);pr=pr.redIAdd(pr).redISub(ir);var lr=zt.redMul(er);At+1<e&&(tr=tr.redMul(ir)),jt=ur,er=lr,zt=pr}return this.curve.jpoint(jt,zt.redMul(Nt),er)};JPoint.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()};JPoint.prototype._zeroDbl=function(){var e,At,kt;if(this.zOne){var Bt=this.x.redSqr(),Nt=this.y.redSqr(),jt=Nt.redSqr(),Lt=this.x.redAdd(Nt).redSqr().redISub(Bt).redISub(jt);Lt=Lt.redIAdd(Lt);var er=Bt.redAdd(Bt).redIAdd(Bt),tr=er.redSqr().redISub(Lt).redISub(Lt),zt=jt.redIAdd(jt);zt=zt.redIAdd(zt),zt=zt.redIAdd(zt),e=tr,At=er.redMul(Lt.redISub(tr)).redISub(zt),kt=this.y.redAdd(this.y)}else{var rr=this.x.redSqr(),nr=this.y.redSqr(),ir=nr.redSqr(),ar=this.x.redAdd(nr).redSqr().redISub(rr).redISub(ir);ar=ar.redIAdd(ar);var dr=rr.redAdd(rr).redIAdd(rr),ur=dr.redSqr(),fr=ir.redIAdd(ir);fr=fr.redIAdd(fr),fr=fr.redIAdd(fr),e=ur.redISub(ar).redISub(ar),At=dr.redMul(ar.redISub(e)).redISub(fr),kt=this.y.redMul(this.z),kt=kt.redIAdd(kt)}return this.curve.jpoint(e,At,kt)};JPoint.prototype._threeDbl=function(){var e,At,kt;if(this.zOne){var Bt=this.x.redSqr(),Nt=this.y.redSqr(),jt=Nt.redSqr(),Lt=this.x.redAdd(Nt).redSqr().redISub(Bt).redISub(jt);Lt=Lt.redIAdd(Lt);var er=Bt.redAdd(Bt).redIAdd(Bt).redIAdd(this.curve.a),tr=er.redSqr().redISub(Lt).redISub(Lt);e=tr;var zt=jt.redIAdd(jt);zt=zt.redIAdd(zt),zt=zt.redIAdd(zt),At=er.redMul(Lt.redISub(tr)).redISub(zt),kt=this.y.redAdd(this.y)}else{var rr=this.z.redSqr(),nr=this.y.redSqr(),ir=this.x.redMul(nr),ar=this.x.redSub(rr).redMul(this.x.redAdd(rr));ar=ar.redAdd(ar).redIAdd(ar);var dr=ir.redIAdd(ir);dr=dr.redIAdd(dr);var ur=dr.redAdd(dr);e=ar.redSqr().redISub(ur),kt=this.y.redAdd(this.z).redSqr().redISub(nr).redISub(rr);var fr=nr.redSqr();fr=fr.redIAdd(fr),fr=fr.redIAdd(fr),fr=fr.redIAdd(fr),At=ar.redMul(dr.redISub(e)).redISub(fr)}return this.curve.jpoint(e,At,kt)};JPoint.prototype._dbl=function(){var e=this.curve.a,At=this.x,kt=this.y,Bt=this.z,Nt=Bt.redSqr().redSqr(),jt=At.redSqr(),Lt=kt.redSqr(),er=jt.redAdd(jt).redIAdd(jt).redIAdd(e.redMul(Nt)),tr=At.redAdd(At);tr=tr.redIAdd(tr);var zt=tr.redMul(Lt),rr=er.redSqr().redISub(zt.redAdd(zt)),nr=zt.redISub(rr),ir=Lt.redSqr();ir=ir.redIAdd(ir),ir=ir.redIAdd(ir),ir=ir.redIAdd(ir);var ar=er.redMul(nr).redISub(ir),dr=kt.redAdd(kt).redMul(Bt);return this.curve.jpoint(rr,ar,dr)};JPoint.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),At=this.y.redSqr(),kt=this.z.redSqr(),Bt=At.redSqr(),Nt=e.redAdd(e).redIAdd(e),jt=Nt.redSqr(),Lt=this.x.redAdd(At).redSqr().redISub(e).redISub(Bt);Lt=Lt.redIAdd(Lt),Lt=Lt.redAdd(Lt).redIAdd(Lt),Lt=Lt.redISub(jt);var er=Lt.redSqr(),tr=Bt.redIAdd(Bt);tr=tr.redIAdd(tr),tr=tr.redIAdd(tr),tr=tr.redIAdd(tr);var zt=Nt.redIAdd(Lt).redSqr().redISub(jt).redISub(er).redISub(tr),rr=At.redMul(zt);rr=rr.redIAdd(rr),rr=rr.redIAdd(rr);var nr=this.x.redMul(er).redISub(rr);nr=nr.redIAdd(nr),nr=nr.redIAdd(nr);var ir=this.y.redMul(zt.redMul(tr.redISub(zt)).redISub(Lt.redMul(er)));ir=ir.redIAdd(ir),ir=ir.redIAdd(ir),ir=ir.redIAdd(ir);var ar=this.z.redAdd(Lt).redSqr().redISub(kt).redISub(er);return this.curve.jpoint(nr,ir,ar)};JPoint.prototype.mul=function(e,At){return e=new BN$8(e,At),this.curve._wnafMul(this,e)};JPoint.prototype.eq=function(e){if(e.type==="affine")return this.eq(e.toJ());if(this===e)return!0;var At=this.z.redSqr(),kt=e.z.redSqr();if(this.x.redMul(kt).redISub(e.x.redMul(At)).cmpn(0)!==0)return!1;var Bt=At.redMul(this.z),Nt=kt.redMul(e.z);return this.y.redMul(Nt).redISub(e.y.redMul(Bt)).cmpn(0)===0};JPoint.prototype.eqXToP=function(e){var At=this.z.redSqr(),kt=e.toRed(this.curve.red).redMul(At);if(this.x.cmp(kt)===0)return!0;for(var Bt=e.clone(),Nt=this.curve.redN.redMul(At);;){if(Bt.iadd(this.curve.n),Bt.cmp(this.curve.p)>=0)return!1;if(kt.redIAdd(Nt),this.x.cmp(kt)===0)return!0}};JPoint.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"};JPoint.prototype.isInfinity=function(){return this.z.cmpn(0)===0};var BN$7=bnExports$1,inherits$3=inherits_browserExports,Base$1=base$2,utils$p=utils$t;function MontCurve(xt){Base$1.call(this,"mont",xt),this.a=new BN$7(xt.a,16).toRed(this.red),this.b=new BN$7(xt.b,16).toRed(this.red),this.i4=new BN$7(4).toRed(this.red).redInvm(),this.two=new BN$7(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}inherits$3(MontCurve,Base$1);var mont=MontCurve;MontCurve.prototype.validate=function(e){var At=e.normalize().x,kt=At.redSqr(),Bt=kt.redMul(At).redAdd(kt.redMul(this.a)).redAdd(At),Nt=Bt.redSqrt();return Nt.redSqr().cmp(Bt)===0};function Point$1(xt,e,At){Base$1.BasePoint.call(this,xt,"projective"),e===null&&At===null?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new BN$7(e,16),this.z=new BN$7(At,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}inherits$3(Point$1,Base$1.BasePoint);MontCurve.prototype.decodePoint=function(e,At){return this.point(utils$p.toArray(e,At),1)};MontCurve.prototype.point=function(e,At){return new Point$1(this,e,At)};MontCurve.prototype.pointFromJSON=function(e){return Point$1.fromJSON(this,e)};Point$1.prototype.precompute=function(){};Point$1.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())};Point$1.fromJSON=function(e,At){return new Point$1(e,At[0],At[1]||e.one)};Point$1.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};Point$1.prototype.isInfinity=function(){return this.z.cmpn(0)===0};Point$1.prototype.dbl=function(){var e=this.x.redAdd(this.z),At=e.redSqr(),kt=this.x.redSub(this.z),Bt=kt.redSqr(),Nt=At.redSub(Bt),jt=At.redMul(Bt),Lt=Nt.redMul(Bt.redAdd(this.curve.a24.redMul(Nt)));return this.curve.point(jt,Lt)};Point$1.prototype.add=function(){throw new Error("Not supported on Montgomery curve")};Point$1.prototype.diffAdd=function(e,At){var kt=this.x.redAdd(this.z),Bt=this.x.redSub(this.z),Nt=e.x.redAdd(e.z),jt=e.x.redSub(e.z),Lt=jt.redMul(kt),er=Nt.redMul(Bt),tr=At.z.redMul(Lt.redAdd(er).redSqr()),zt=At.x.redMul(Lt.redISub(er).redSqr());return this.curve.point(tr,zt)};Point$1.prototype.mul=function(e){for(var At=e.clone(),kt=this,Bt=this.curve.point(null,null),Nt=this,jt=[];At.cmpn(0)!==0;At.iushrn(1))jt.push(At.andln(1));for(var Lt=jt.length-1;Lt>=0;Lt--)jt[Lt]===0?(kt=kt.diffAdd(Bt,Nt),Bt=Bt.dbl()):(Bt=kt.diffAdd(Bt,Nt),kt=kt.dbl());return Bt};Point$1.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")};Point$1.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")};Point$1.prototype.eq=function(e){return this.getX().cmp(e.getX())===0};Point$1.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this};Point$1.prototype.getX=function(){return this.normalize(),this.x.fromRed()};var utils$o=utils$t,BN$6=bnExports$1,inherits$2=inherits_browserExports,Base=base$2,assert$f=utils$o.assert;function EdwardsCurve(xt){this.twisted=(xt.a|0)!==1,this.mOneA=this.twisted&&(xt.a|0)===-1,this.extended=this.mOneA,Base.call(this,"edwards",xt),this.a=new BN$6(xt.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new BN$6(xt.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new BN$6(xt.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),assert$f(!this.twisted||this.c.fromRed().cmpn(1)===0),this.oneC=(xt.c|0)===1}inherits$2(EdwardsCurve,Base);var edwards$1=EdwardsCurve;EdwardsCurve.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)};EdwardsCurve.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)};EdwardsCurve.prototype.jpoint=function(e,At,kt,Bt){return this.point(e,At,kt,Bt)};EdwardsCurve.prototype.pointFromX=function(e,At){e=new BN$6(e,16),e.red||(e=e.toRed(this.red));var kt=e.redSqr(),Bt=this.c2.redSub(this.a.redMul(kt)),Nt=this.one.redSub(this.c2.redMul(this.d).redMul(kt)),jt=Bt.redMul(Nt.redInvm()),Lt=jt.redSqrt();if(Lt.redSqr().redSub(jt).cmp(this.zero)!==0)throw new Error("invalid point");var er=Lt.fromRed().isOdd();return(At&&!er||!At&&er)&&(Lt=Lt.redNeg()),this.point(e,Lt)};EdwardsCurve.prototype.pointFromY=function(e,At){e=new BN$6(e,16),e.red||(e=e.toRed(this.red));var kt=e.redSqr(),Bt=kt.redSub(this.c2),Nt=kt.redMul(this.d).redMul(this.c2).redSub(this.a),jt=Bt.redMul(Nt.redInvm());if(jt.cmp(this.zero)===0){if(At)throw new Error("invalid point");return this.point(this.zero,e)}var Lt=jt.redSqrt();if(Lt.redSqr().redSub(jt).cmp(this.zero)!==0)throw new Error("invalid point");return Lt.fromRed().isOdd()!==At&&(Lt=Lt.redNeg()),this.point(Lt,e)};EdwardsCurve.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var At=e.x.redSqr(),kt=e.y.redSqr(),Bt=At.redMul(this.a).redAdd(kt),Nt=this.c2.redMul(this.one.redAdd(this.d.redMul(At).redMul(kt)));return Bt.cmp(Nt)===0};function Point(xt,e,At,kt,Bt){Base.BasePoint.call(this,xt,"projective"),e===null&&At===null&&kt===null?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new BN$6(e,16),this.y=new BN$6(At,16),this.z=kt?new BN$6(kt,16):this.curve.one,this.t=Bt&&new BN$6(Bt,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}inherits$2(Point,Base.BasePoint);EdwardsCurve.prototype.pointFromJSON=function(e){return Point.fromJSON(this,e)};EdwardsCurve.prototype.point=function(e,At,kt,Bt){return new Point(this,e,At,kt,Bt)};Point.fromJSON=function(e,At){return new Point(e,At[0],At[1],At[2])};Point.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"};Point.prototype.isInfinity=function(){return this.x.cmpn(0)===0&&(this.y.cmp(this.z)===0||this.zOne&&this.y.cmp(this.curve.c)===0)};Point.prototype._extDbl=function(){var e=this.x.redSqr(),At=this.y.redSqr(),kt=this.z.redSqr();kt=kt.redIAdd(kt);var Bt=this.curve._mulA(e),Nt=this.x.redAdd(this.y).redSqr().redISub(e).redISub(At),jt=Bt.redAdd(At),Lt=jt.redSub(kt),er=Bt.redSub(At),tr=Nt.redMul(Lt),zt=jt.redMul(er),rr=Nt.redMul(er),nr=Lt.redMul(jt);return this.curve.point(tr,zt,nr,rr)};Point.prototype._projDbl=function(){var e=this.x.redAdd(this.y).redSqr(),At=this.x.redSqr(),kt=this.y.redSqr(),Bt,Nt,jt,Lt,er,tr;if(this.curve.twisted){Lt=this.curve._mulA(At);var zt=Lt.redAdd(kt);this.zOne?(Bt=e.redSub(At).redSub(kt).redMul(zt.redSub(this.curve.two)),Nt=zt.redMul(Lt.redSub(kt)),jt=zt.redSqr().redSub(zt).redSub(zt)):(er=this.z.redSqr(),tr=zt.redSub(er).redISub(er),Bt=e.redSub(At).redISub(kt).redMul(tr),Nt=zt.redMul(Lt.redSub(kt)),jt=zt.redMul(tr))}else Lt=At.redAdd(kt),er=this.curve._mulC(this.z).redSqr(),tr=Lt.redSub(er).redSub(er),Bt=this.curve._mulC(e.redISub(Lt)).redMul(tr),Nt=this.curve._mulC(Lt).redMul(At.redISub(kt)),jt=Lt.redMul(tr);return this.curve.point(Bt,Nt,jt)};Point.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()};Point.prototype._extAdd=function(e){var At=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),kt=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),Bt=this.t.redMul(this.curve.dd).redMul(e.t),Nt=this.z.redMul(e.z.redAdd(e.z)),jt=kt.redSub(At),Lt=Nt.redSub(Bt),er=Nt.redAdd(Bt),tr=kt.redAdd(At),zt=jt.redMul(Lt),rr=er.redMul(tr),nr=jt.redMul(tr),ir=Lt.redMul(er);return this.curve.point(zt,rr,ir,nr)};Point.prototype._projAdd=function(e){var At=this.z.redMul(e.z),kt=At.redSqr(),Bt=this.x.redMul(e.x),Nt=this.y.redMul(e.y),jt=this.curve.d.redMul(Bt).redMul(Nt),Lt=kt.redSub(jt),er=kt.redAdd(jt),tr=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(Bt).redISub(Nt),zt=At.redMul(Lt).redMul(tr),rr,nr;return this.curve.twisted?(rr=At.redMul(er).redMul(Nt.redSub(this.curve._mulA(Bt))),nr=Lt.redMul(er)):(rr=At.redMul(er).redMul(Nt.redSub(Bt)),nr=this.curve._mulC(Lt).redMul(er)),this.curve.point(zt,rr,nr)};Point.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)};Point.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)};Point.prototype.mulAdd=function(e,At,kt){return this.curve._wnafMulAdd(1,[this,At],[e,kt],2,!1)};Point.prototype.jmulAdd=function(e,At,kt){return this.curve._wnafMulAdd(1,[this,At],[e,kt],2,!0)};Point.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this};Point.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())};Point.prototype.getX=function(){return this.normalize(),this.x.fromRed()};Point.prototype.getY=function(){return this.normalize(),this.y.fromRed()};Point.prototype.eq=function(e){return this===e||this.getX().cmp(e.getX())===0&&this.getY().cmp(e.getY())===0};Point.prototype.eqXToP=function(e){var At=e.toRed(this.curve.red).redMul(this.z);if(this.x.cmp(At)===0)return!0;for(var kt=e.clone(),Bt=this.curve.redN.redMul(this.z);;){if(kt.iadd(this.curve.n),kt.cmp(this.curve.p)>=0)return!1;if(At.redIAdd(Bt),this.x.cmp(At)===0)return!0}};Point.prototype.toP=Point.prototype.normalize;Point.prototype.mixedAdd=Point.prototype.add;(function(xt){var e=xt;e.base=base$2,e.short=short,e.mont=mont,e.edwards=edwards$1})(curve$1);var curves$1={},hash$5={},utils$n={},assert$e=minimalisticAssert,inherits$1=inherits_browserExports;utils$n.inherits=inherits$1;function isSurrogatePair(xt,e){return(xt.charCodeAt(e)&64512)!==55296||e<0||e+1>=xt.length?!1:(xt.charCodeAt(e+1)&64512)===56320}function toArray$2(xt,e){if(Array.isArray(xt))return xt.slice();if(!xt)return[];var At=[];if(typeof xt=="string")if(e){if(e==="hex")for(xt=xt.replace(/[^a-z0-9]+/ig,""),xt.length%2!==0&&(xt="0"+xt),Bt=0;Bt<xt.length;Bt+=2)At.push(parseInt(xt[Bt]+xt[Bt+1],16))}else for(var kt=0,Bt=0;Bt<xt.length;Bt++){var Nt=xt.charCodeAt(Bt);Nt<128?At[kt++]=Nt:Nt<2048?(At[kt++]=Nt>>6|192,At[kt++]=Nt&63|128):isSurrogatePair(xt,Bt)?(Nt=65536+((Nt&1023)<<10)+(xt.charCodeAt(++Bt)&1023),At[kt++]=Nt>>18|240,At[kt++]=Nt>>12&63|128,At[kt++]=Nt>>6&63|128,At[kt++]=Nt&63|128):(At[kt++]=Nt>>12|224,At[kt++]=Nt>>6&63|128,At[kt++]=Nt&63|128)}else for(Bt=0;Bt<xt.length;Bt++)At[Bt]=xt[Bt]|0;return At}utils$n.toArray=toArray$2;function toHex$1(xt){for(var e="",At=0;At<xt.length;At++)e+=zero2(xt[At].toString(16));return e}utils$n.toHex=toHex$1;function htonl(xt){var e=xt>>>24|xt>>>8&65280|xt<<8&16711680|(xt&255)<<24;return e>>>0}utils$n.htonl=htonl;function toHex32(xt,e){for(var At="",kt=0;kt<xt.length;kt++){var Bt=xt[kt];e==="little"&&(Bt=htonl(Bt)),At+=zero8(Bt.toString(16))}return At}utils$n.toHex32=toHex32;function zero2(xt){return xt.length===1?"0"+xt:xt}utils$n.zero2=zero2;function zero8(xt){return xt.length===7?"0"+xt:xt.length===6?"00"+xt:xt.length===5?"000"+xt:xt.length===4?"0000"+xt:xt.length===3?"00000"+xt:xt.length===2?"000000"+xt:xt.length===1?"0000000"+xt:xt}utils$n.zero8=zero8;function join32(xt,e,At,kt){var Bt=At-e;assert$e(Bt%4===0);for(var Nt=new Array(Bt/4),jt=0,Lt=e;jt<Nt.length;jt++,Lt+=4){var er;kt==="big"?er=xt[Lt]<<24|xt[Lt+1]<<16|xt[Lt+2]<<8|xt[Lt+3]:er=xt[Lt+3]<<24|xt[Lt+2]<<16|xt[Lt+1]<<8|xt[Lt],Nt[jt]=er>>>0}return Nt}utils$n.join32=join32;function split32(xt,e){for(var At=new Array(xt.length*4),kt=0,Bt=0;kt<xt.length;kt++,Bt+=4){var Nt=xt[kt];e==="big"?(At[Bt]=Nt>>>24,At[Bt+1]=Nt>>>16&255,At[Bt+2]=Nt>>>8&255,At[Bt+3]=Nt&255):(At[Bt+3]=Nt>>>24,At[Bt+2]=Nt>>>16&255,At[Bt+1]=Nt>>>8&255,At[Bt]=Nt&255)}return At}utils$n.split32=split32;function rotr32$1(xt,e){return xt>>>e|xt<<32-e}utils$n.rotr32=rotr32$1;function rotl32$2(xt,e){return xt<<e|xt>>>32-e}utils$n.rotl32=rotl32$2;function sum32$3(xt,e){return xt+e>>>0}utils$n.sum32=sum32$3;function sum32_3$1(xt,e,At){return xt+e+At>>>0}utils$n.sum32_3=sum32_3$1;function sum32_4$2(xt,e,At,kt){return xt+e+At+kt>>>0}utils$n.sum32_4=sum32_4$2;function sum32_5$2(xt,e,At,kt,Bt){return xt+e+At+kt+Bt>>>0}utils$n.sum32_5=sum32_5$2;function sum64$1(xt,e,At,kt){var Bt=xt[e],Nt=xt[e+1],jt=kt+Nt>>>0,Lt=(jt<kt?1:0)+At+Bt;xt[e]=Lt>>>0,xt[e+1]=jt}utils$n.sum64=sum64$1;function sum64_hi$1(xt,e,At,kt){var Bt=e+kt>>>0,Nt=(Bt<e?1:0)+xt+At;return Nt>>>0}utils$n.sum64_hi=sum64_hi$1;function sum64_lo$1(xt,e,At,kt){var Bt=e+kt;return Bt>>>0}utils$n.sum64_lo=sum64_lo$1;function sum64_4_hi$1(xt,e,At,kt,Bt,Nt,jt,Lt){var er=0,tr=e;tr=tr+kt>>>0,er+=tr<e?1:0,tr=tr+Nt>>>0,er+=tr<Nt?1:0,tr=tr+Lt>>>0,er+=tr<Lt?1:0;var zt=xt+At+Bt+jt+er;return zt>>>0}utils$n.sum64_4_hi=sum64_4_hi$1;function sum64_4_lo$1(xt,e,At,kt,Bt,Nt,jt,Lt){var er=e+kt+Nt+Lt;return er>>>0}utils$n.sum64_4_lo=sum64_4_lo$1;function sum64_5_hi$1(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr){var zt=0,rr=e;rr=rr+kt>>>0,zt+=rr<e?1:0,rr=rr+Nt>>>0,zt+=rr<Nt?1:0,rr=rr+Lt>>>0,zt+=rr<Lt?1:0,rr=rr+tr>>>0,zt+=rr<tr?1:0;var nr=xt+At+Bt+jt+er+zt;return nr>>>0}utils$n.sum64_5_hi=sum64_5_hi$1;function sum64_5_lo$1(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr){var zt=e+kt+Nt+Lt+tr;return zt>>>0}utils$n.sum64_5_lo=sum64_5_lo$1;function rotr64_hi$1(xt,e,At){var kt=e<<32-At|xt>>>At;return kt>>>0}utils$n.rotr64_hi=rotr64_hi$1;function rotr64_lo$1(xt,e,At){var kt=xt<<32-At|e>>>At;return kt>>>0}utils$n.rotr64_lo=rotr64_lo$1;function shr64_hi$1(xt,e,At){return xt>>>At}utils$n.shr64_hi=shr64_hi$1;function shr64_lo$1(xt,e,At){var kt=xt<<32-At|e>>>At;return kt>>>0}utils$n.shr64_lo=shr64_lo$1;var common$6={},utils$m=utils$n,assert$d=minimalisticAssert;function BlockHash$4(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}common$6.BlockHash=BlockHash$4;BlockHash$4.prototype.update=function(e,At){if(e=utils$m.toArray(e,At),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){e=this.pending;var kt=e.length%this._delta8;this.pending=e.slice(e.length-kt,e.length),this.pending.length===0&&(this.pending=null),e=utils$m.join32(e,0,e.length-kt,this.endian);for(var Bt=0;Bt<e.length;Bt+=this._delta32)this._update(e,Bt,Bt+this._delta32)}return this};BlockHash$4.prototype.digest=function(e){return this.update(this._pad()),assert$d(this.pending===null),this._digest(e)};BlockHash$4.prototype._pad=function(){var e=this.pendingTotal,At=this._delta8,kt=At-(e+this.padLength)%At,Bt=new Array(kt+this.padLength);Bt[0]=128;for(var Nt=1;Nt<kt;Nt++)Bt[Nt]=0;if(e<<=3,this.endian==="big"){for(var jt=8;jt<this.padLength;jt++)Bt[Nt++]=0;Bt[Nt++]=0,Bt[Nt++]=0,Bt[Nt++]=0,Bt[Nt++]=0,Bt[Nt++]=e>>>24&255,Bt[Nt++]=e>>>16&255,Bt[Nt++]=e>>>8&255,Bt[Nt++]=e&255}else for(Bt[Nt++]=e&255,Bt[Nt++]=e>>>8&255,Bt[Nt++]=e>>>16&255,Bt[Nt++]=e>>>24&255,Bt[Nt++]=0,Bt[Nt++]=0,Bt[Nt++]=0,Bt[Nt++]=0,jt=8;jt<this.padLength;jt++)Bt[Nt++]=0;return Bt};var sha={},common$5={},utils$l=utils$n,rotr32=utils$l.rotr32;function ft_1$1(xt,e,At,kt){if(xt===0)return ch32$1(e,At,kt);if(xt===1||xt===3)return p32(e,At,kt);if(xt===2)return maj32$1(e,At,kt)}common$5.ft_1=ft_1$1;function ch32$1(xt,e,At){return xt&e^~xt&At}common$5.ch32=ch32$1;function maj32$1(xt,e,At){return xt&e^xt&At^e&At}common$5.maj32=maj32$1;function p32(xt,e,At){return xt^e^At}common$5.p32=p32;function s0_256$1(xt){return rotr32(xt,2)^rotr32(xt,13)^rotr32(xt,22)}common$5.s0_256=s0_256$1;function s1_256$1(xt){return rotr32(xt,6)^rotr32(xt,11)^rotr32(xt,25)}common$5.s1_256=s1_256$1;function g0_256$1(xt){return rotr32(xt,7)^rotr32(xt,18)^xt>>>3}common$5.g0_256=g0_256$1;function g1_256$1(xt){return rotr32(xt,17)^rotr32(xt,19)^xt>>>10}common$5.g1_256=g1_256$1;var utils$k=utils$n,common$4=common$6,shaCommon$1=common$5,rotl32$1=utils$k.rotl32,sum32$2=utils$k.sum32,sum32_5$1=utils$k.sum32_5,ft_1=shaCommon$1.ft_1,BlockHash$3=common$4.BlockHash,sha1_K=[1518500249,1859775393,2400959708,3395469782];function SHA1(){if(!(this instanceof SHA1))return new SHA1;BlockHash$3.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}utils$k.inherits(SHA1,BlockHash$3);var _1=SHA1;SHA1.blockSize=512;SHA1.outSize=160;SHA1.hmacStrength=80;SHA1.padLength=64;SHA1.prototype._update=function(e,At){for(var kt=this.W,Bt=0;Bt<16;Bt++)kt[Bt]=e[At+Bt];for(;Bt<kt.length;Bt++)kt[Bt]=rotl32$1(kt[Bt-3]^kt[Bt-8]^kt[Bt-14]^kt[Bt-16],1);var Nt=this.h[0],jt=this.h[1],Lt=this.h[2],er=this.h[3],tr=this.h[4];for(Bt=0;Bt<kt.length;Bt++){var zt=~~(Bt/20),rr=sum32_5$1(rotl32$1(Nt,5),ft_1(zt,jt,Lt,er),tr,kt[Bt],sha1_K[zt]);tr=er,er=Lt,Lt=rotl32$1(jt,30),jt=Nt,Nt=rr}this.h[0]=sum32$2(this.h[0],Nt),this.h[1]=sum32$2(this.h[1],jt),this.h[2]=sum32$2(this.h[2],Lt),this.h[3]=sum32$2(this.h[3],er),this.h[4]=sum32$2(this.h[4],tr)};SHA1.prototype._digest=function(e){return e==="hex"?utils$k.toHex32(this.h,"big"):utils$k.split32(this.h,"big")};var utils$j=utils$n,common$3=common$6,shaCommon=common$5,assert$c=minimalisticAssert,sum32$1=utils$j.sum32,sum32_4$1=utils$j.sum32_4,sum32_5=utils$j.sum32_5,ch32=shaCommon.ch32,maj32=shaCommon.maj32,s0_256=shaCommon.s0_256,s1_256=shaCommon.s1_256,g0_256=shaCommon.g0_256,g1_256=shaCommon.g1_256,BlockHash$2=common$3.BlockHash,sha256_K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function SHA256$3(){if(!(this instanceof SHA256$3))return new SHA256$3;BlockHash$2.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=sha256_K,this.W=new Array(64)}utils$j.inherits(SHA256$3,BlockHash$2);var _256=SHA256$3;SHA256$3.blockSize=512;SHA256$3.outSize=256;SHA256$3.hmacStrength=192;SHA256$3.padLength=64;SHA256$3.prototype._update=function(e,At){for(var kt=this.W,Bt=0;Bt<16;Bt++)kt[Bt]=e[At+Bt];for(;Bt<kt.length;Bt++)kt[Bt]=sum32_4$1(g1_256(kt[Bt-2]),kt[Bt-7],g0_256(kt[Bt-15]),kt[Bt-16]);var Nt=this.h[0],jt=this.h[1],Lt=this.h[2],er=this.h[3],tr=this.h[4],zt=this.h[5],rr=this.h[6],nr=this.h[7];for(assert$c(this.k.length===kt.length),Bt=0;Bt<kt.length;Bt++){var ir=sum32_5(nr,s1_256(tr),ch32(tr,zt,rr),this.k[Bt],kt[Bt]),ar=sum32$1(s0_256(Nt),maj32(Nt,jt,Lt));nr=rr,rr=zt,zt=tr,tr=sum32$1(er,ir),er=Lt,Lt=jt,jt=Nt,Nt=sum32$1(ir,ar)}this.h[0]=sum32$1(this.h[0],Nt),this.h[1]=sum32$1(this.h[1],jt),this.h[2]=sum32$1(this.h[2],Lt),this.h[3]=sum32$1(this.h[3],er),this.h[4]=sum32$1(this.h[4],tr),this.h[5]=sum32$1(this.h[5],zt),this.h[6]=sum32$1(this.h[6],rr),this.h[7]=sum32$1(this.h[7],nr)};SHA256$3.prototype._digest=function(e){return e==="hex"?utils$j.toHex32(this.h,"big"):utils$j.split32(this.h,"big")};var utils$i=utils$n,SHA256$2=_256;function SHA224$1(){if(!(this instanceof SHA224$1))return new SHA224$1;SHA256$2.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}utils$i.inherits(SHA224$1,SHA256$2);var _224=SHA224$1;SHA224$1.blockSize=512;SHA224$1.outSize=224;SHA224$1.hmacStrength=192;SHA224$1.padLength=64;SHA224$1.prototype._digest=function(e){return e==="hex"?utils$i.toHex32(this.h.slice(0,7),"big"):utils$i.split32(this.h.slice(0,7),"big")};var utils$h=utils$n,common$2=common$6,assert$b=minimalisticAssert,rotr64_hi=utils$h.rotr64_hi,rotr64_lo=utils$h.rotr64_lo,shr64_hi=utils$h.shr64_hi,shr64_lo=utils$h.shr64_lo,sum64=utils$h.sum64,sum64_hi=utils$h.sum64_hi,sum64_lo=utils$h.sum64_lo,sum64_4_hi=utils$h.sum64_4_hi,sum64_4_lo=utils$h.sum64_4_lo,sum64_5_hi=utils$h.sum64_5_hi,sum64_5_lo=utils$h.sum64_5_lo,BlockHash$1=common$2.BlockHash,sha512_K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function SHA512$3(){if(!(this instanceof SHA512$3))return new SHA512$3;BlockHash$1.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=sha512_K,this.W=new Array(160)}utils$h.inherits(SHA512$3,BlockHash$1);var _512=SHA512$3;SHA512$3.blockSize=1024;SHA512$3.outSize=512;SHA512$3.hmacStrength=192;SHA512$3.padLength=128;SHA512$3.prototype._prepareBlock=function(e,At){for(var kt=this.W,Bt=0;Bt<32;Bt++)kt[Bt]=e[At+Bt];for(;Bt<kt.length;Bt+=2){var Nt=g1_512_hi(kt[Bt-4],kt[Bt-3]),jt=g1_512_lo(kt[Bt-4],kt[Bt-3]),Lt=kt[Bt-14],er=kt[Bt-13],tr=g0_512_hi(kt[Bt-30],kt[Bt-29]),zt=g0_512_lo(kt[Bt-30],kt[Bt-29]),rr=kt[Bt-32],nr=kt[Bt-31];kt[Bt]=sum64_4_hi(Nt,jt,Lt,er,tr,zt,rr,nr),kt[Bt+1]=sum64_4_lo(Nt,jt,Lt,er,tr,zt,rr,nr)}};SHA512$3.prototype._update=function(e,At){this._prepareBlock(e,At);var kt=this.W,Bt=this.h[0],Nt=this.h[1],jt=this.h[2],Lt=this.h[3],er=this.h[4],tr=this.h[5],zt=this.h[6],rr=this.h[7],nr=this.h[8],ir=this.h[9],ar=this.h[10],dr=this.h[11],ur=this.h[12],fr=this.h[13],pr=this.h[14],lr=this.h[15];assert$b(this.k.length===kt.length);for(var yr=0;yr<kt.length;yr+=2){var br=pr,Ar=lr,Pr=s1_512_hi(nr,ir),kr=s1_512_lo(nr,ir),Ur=ch64_hi(nr,ir,ar,dr,ur),Hr=ch64_lo(nr,ir,ar,dr,ur,fr),Lr=this.k[yr],Sr=this.k[yr+1],_r=kt[yr],gr=kt[yr+1],wr=sum64_5_hi(br,Ar,Pr,kr,Ur,Hr,Lr,Sr,_r,gr),Dr=sum64_5_lo(br,Ar,Pr,kr,Ur,Hr,Lr,Sr,_r,gr);br=s0_512_hi(Bt,Nt),Ar=s0_512_lo(Bt,Nt),Pr=maj64_hi(Bt,Nt,jt,Lt,er),kr=maj64_lo(Bt,Nt,jt,Lt,er,tr);var xr=sum64_hi(br,Ar,Pr,kr),Ir=sum64_lo(br,Ar,Pr,kr);pr=ur,lr=fr,ur=ar,fr=dr,ar=nr,dr=ir,nr=sum64_hi(zt,rr,wr,Dr),ir=sum64_lo(rr,rr,wr,Dr),zt=er,rr=tr,er=jt,tr=Lt,jt=Bt,Lt=Nt,Bt=sum64_hi(wr,Dr,xr,Ir),Nt=sum64_lo(wr,Dr,xr,Ir)}sum64(this.h,0,Bt,Nt),sum64(this.h,2,jt,Lt),sum64(this.h,4,er,tr),sum64(this.h,6,zt,rr),sum64(this.h,8,nr,ir),sum64(this.h,10,ar,dr),sum64(this.h,12,ur,fr),sum64(this.h,14,pr,lr)};SHA512$3.prototype._digest=function(e){return e==="hex"?utils$h.toHex32(this.h,"big"):utils$h.split32(this.h,"big")};function ch64_hi(xt,e,At,kt,Bt){var Nt=xt&At^~xt&Bt;return Nt<0&&(Nt+=4294967296),Nt}function ch64_lo(xt,e,At,kt,Bt,Nt){var jt=e&kt^~e&Nt;return jt<0&&(jt+=4294967296),jt}function maj64_hi(xt,e,At,kt,Bt){var Nt=xt&At^xt&Bt^At&Bt;return Nt<0&&(Nt+=4294967296),Nt}function maj64_lo(xt,e,At,kt,Bt,Nt){var jt=e&kt^e&Nt^kt&Nt;return jt<0&&(jt+=4294967296),jt}function s0_512_hi(xt,e){var At=rotr64_hi(xt,e,28),kt=rotr64_hi(e,xt,2),Bt=rotr64_hi(e,xt,7),Nt=At^kt^Bt;return Nt<0&&(Nt+=4294967296),Nt}function s0_512_lo(xt,e){var At=rotr64_lo(xt,e,28),kt=rotr64_lo(e,xt,2),Bt=rotr64_lo(e,xt,7),Nt=At^kt^Bt;return Nt<0&&(Nt+=4294967296),Nt}function s1_512_hi(xt,e){var At=rotr64_hi(xt,e,14),kt=rotr64_hi(xt,e,18),Bt=rotr64_hi(e,xt,9),Nt=At^kt^Bt;return Nt<0&&(Nt+=4294967296),Nt}function s1_512_lo(xt,e){var At=rotr64_lo(xt,e,14),kt=rotr64_lo(xt,e,18),Bt=rotr64_lo(e,xt,9),Nt=At^kt^Bt;return Nt<0&&(Nt+=4294967296),Nt}function g0_512_hi(xt,e){var At=rotr64_hi(xt,e,1),kt=rotr64_hi(xt,e,8),Bt=shr64_hi(xt,e,7),Nt=At^kt^Bt;return Nt<0&&(Nt+=4294967296),Nt}function g0_512_lo(xt,e){var At=rotr64_lo(xt,e,1),kt=rotr64_lo(xt,e,8),Bt=shr64_lo(xt,e,7),Nt=At^kt^Bt;return Nt<0&&(Nt+=4294967296),Nt}function g1_512_hi(xt,e){var At=rotr64_hi(xt,e,19),kt=rotr64_hi(e,xt,29),Bt=shr64_hi(xt,e,6),Nt=At^kt^Bt;return Nt<0&&(Nt+=4294967296),Nt}function g1_512_lo(xt,e){var At=rotr64_lo(xt,e,19),kt=rotr64_lo(e,xt,29),Bt=shr64_lo(xt,e,6),Nt=At^kt^Bt;return Nt<0&&(Nt+=4294967296),Nt}var utils$g=utils$n,SHA512$2=_512;function SHA384$1(){if(!(this instanceof SHA384$1))return new SHA384$1;SHA512$2.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}utils$g.inherits(SHA384$1,SHA512$2);var _384=SHA384$1;SHA384$1.blockSize=1024;SHA384$1.outSize=384;SHA384$1.hmacStrength=192;SHA384$1.padLength=128;SHA384$1.prototype._digest=function(e){return e==="hex"?utils$g.toHex32(this.h.slice(0,12),"big"):utils$g.split32(this.h.slice(0,12),"big")};sha.sha1=_1;sha.sha224=_224;sha.sha256=_256;sha.sha384=_384;sha.sha512=_512;var ripemd={},utils$f=utils$n,common$1=common$6,rotl32=utils$f.rotl32,sum32=utils$f.sum32,sum32_3=utils$f.sum32_3,sum32_4=utils$f.sum32_4,BlockHash=common$1.BlockHash;function RIPEMD160$1(){if(!(this instanceof RIPEMD160$1))return new RIPEMD160$1;BlockHash.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}utils$f.inherits(RIPEMD160$1,BlockHash);ripemd.ripemd160=RIPEMD160$1;RIPEMD160$1.blockSize=512;RIPEMD160$1.outSize=160;RIPEMD160$1.hmacStrength=192;RIPEMD160$1.padLength=64;RIPEMD160$1.prototype._update=function(e,At){for(var kt=this.h[0],Bt=this.h[1],Nt=this.h[2],jt=this.h[3],Lt=this.h[4],er=kt,tr=Bt,zt=Nt,rr=jt,nr=Lt,ir=0;ir<80;ir++){var ar=sum32(rotl32(sum32_4(kt,f$2(ir,Bt,Nt,jt),e[r$1[ir]+At],K$1(ir)),s$2[ir]),Lt);kt=Lt,Lt=jt,jt=rotl32(Nt,10),Nt=Bt,Bt=ar,ar=sum32(rotl32(sum32_4(er,f$2(79-ir,tr,zt,rr),e[rh[ir]+At],Kh(ir)),sh[ir]),nr),er=nr,nr=rr,rr=rotl32(zt,10),zt=tr,tr=ar}ar=sum32_3(this.h[1],Nt,rr),this.h[1]=sum32_3(this.h[2],jt,nr),this.h[2]=sum32_3(this.h[3],Lt,er),this.h[3]=sum32_3(this.h[4],kt,tr),this.h[4]=sum32_3(this.h[0],Bt,zt),this.h[0]=ar};RIPEMD160$1.prototype._digest=function(e){return e==="hex"?utils$f.toHex32(this.h,"little"):utils$f.split32(this.h,"little")};function f$2(xt,e,At,kt){return xt<=15?e^At^kt:xt<=31?e&At|~e&kt:xt<=47?(e|~At)^kt:xt<=63?e&kt|At&~kt:e^(At|~kt)}function K$1(xt){return xt<=15?0:xt<=31?1518500249:xt<=47?1859775393:xt<=63?2400959708:2840853838}function Kh(xt){return xt<=15?1352829926:xt<=31?1548603684:xt<=47?1836072691:xt<=63?2053994217:0}var r$1=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],rh=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],s$2=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],sh=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],utils$e=utils$n,assert$a=minimalisticAssert;function Hmac(xt,e,At){if(!(this instanceof Hmac))return new Hmac(xt,e,At);this.Hash=xt,this.blockSize=xt.blockSize/8,this.outSize=xt.outSize/8,this.inner=null,this.outer=null,this._init(utils$e.toArray(e,At))}var hmac$2=Hmac;Hmac.prototype._init=function(e){e.length>this.blockSize&&(e=new this.Hash().update(e).digest()),assert$a(e.length<=this.blockSize);for(var At=e.length;At<this.blockSize;At++)e.push(0);for(At=0;At<e.length;At++)e[At]^=54;for(this.inner=new this.Hash().update(e),At=0;At<e.length;At++)e[At]^=106;this.outer=new this.Hash().update(e)};Hmac.prototype.update=function(e,At){return this.inner.update(e,At),this};Hmac.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)};(function(xt){var e=xt;e.utils=utils$n,e.common=common$6,e.sha=sha,e.ripemd=ripemd,e.hmac=hmac$2,e.sha1=e.sha.sha1,e.sha256=e.sha.sha256,e.sha224=e.sha.sha224,e.sha384=e.sha.sha384,e.sha512=e.sha.sha512,e.ripemd160=e.ripemd.ripemd160})(hash$5);var secp256k1$2,hasRequiredSecp256k1;function requireSecp256k1(){return hasRequiredSecp256k1||(hasRequiredSecp256k1=1,secp256k1$2={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}),secp256k1$2}(function(xt){var e=xt,At=hash$5,kt=curve$1,Bt=utils$t,Nt=Bt.assert;function jt(tr){tr.type==="short"?this.curve=new kt.short(tr):tr.type==="edwards"?this.curve=new kt.edwards(tr):this.curve=new kt.mont(tr),this.g=this.curve.g,this.n=this.curve.n,this.hash=tr.hash,Nt(this.g.validate(),"Invalid curve"),Nt(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}e.PresetCurve=jt;function Lt(tr,zt){Object.defineProperty(e,tr,{configurable:!0,enumerable:!0,get:function(){var rr=new jt(zt);return Object.defineProperty(e,tr,{configurable:!0,enumerable:!0,value:rr}),rr}})}Lt("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:At.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),Lt("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:At.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),Lt("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:At.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),Lt("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:At.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),Lt("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:At.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),Lt("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:At.sha256,gRed:!1,g:["9"]}),Lt("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:At.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var er;try{er=requireSecp256k1()}catch{er=void 0}Lt("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:At.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",er]})})(curves$1);var hash$4=hash$5,utils$d=utils$s,assert$9=minimalisticAssert;function HmacDRBG(xt){if(!(this instanceof HmacDRBG))return new HmacDRBG(xt);this.hash=xt.hash,this.predResist=!!xt.predResist,this.outLen=this.hash.outSize,this.minEntropy=xt.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var e=utils$d.toArray(xt.entropy,xt.entropyEnc||"hex"),At=utils$d.toArray(xt.nonce,xt.nonceEnc||"hex"),kt=utils$d.toArray(xt.pers,xt.persEnc||"hex");assert$9(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(e,At,kt)}var hmacDrbg=HmacDRBG;HmacDRBG.prototype._init=function(e,At,kt){var Bt=e.concat(At).concat(kt);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var Nt=0;Nt<this.V.length;Nt++)this.K[Nt]=0,this.V[Nt]=1;this._update(Bt),this._reseed=1,this.reseedInterval=281474976710656};HmacDRBG.prototype._hmac=function(){return new hash$4.hmac(this.hash,this.K)};HmacDRBG.prototype._update=function(e){var At=this._hmac().update(this.V).update([0]);e&&(At=At.update(e)),this.K=At.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())};HmacDRBG.prototype.reseed=function(e,At,kt,Bt){typeof At!="string"&&(Bt=kt,kt=At,At=null),e=utils$d.toArray(e,At),kt=utils$d.toArray(kt,Bt),assert$9(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(kt||[])),this._reseed=1};HmacDRBG.prototype.generate=function(e,At,kt,Bt){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof At!="string"&&(Bt=kt,kt=At,At=null),kt&&(kt=utils$d.toArray(kt,Bt||"hex"),this._update(kt));for(var Nt=[];Nt.length<e;)this.V=this._hmac().update(this.V).digest(),Nt=Nt.concat(this.V);var jt=Nt.slice(0,e);return this._update(kt),this._reseed++,utils$d.encode(jt,At)};var BN$5=bnExports$1,utils$c=utils$t,assert$8=utils$c.assert;function KeyPair$2(xt,e){this.ec=xt,this.priv=null,this.pub=null,e.priv&&this._importPrivate(e.priv,e.privEnc),e.pub&&this._importPublic(e.pub,e.pubEnc)}var key$1=KeyPair$2;KeyPair$2.fromPublic=function(e,At,kt){return At instanceof KeyPair$2?At:new KeyPair$2(e,{pub:At,pubEnc:kt})};KeyPair$2.fromPrivate=function(e,At,kt){return At instanceof KeyPair$2?At:new KeyPair$2(e,{priv:At,privEnc:kt})};KeyPair$2.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}};KeyPair$2.prototype.getPublic=function(e,At){return typeof e=="string"&&(At=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),At?this.pub.encode(At,e):this.pub};KeyPair$2.prototype.getPrivate=function(e){return e==="hex"?this.priv.toString(16,2):this.priv};KeyPair$2.prototype._importPrivate=function(e,At){this.priv=new BN$5(e,At||16),this.priv=this.priv.umod(this.ec.curve.n)};KeyPair$2.prototype._importPublic=function(e,At){if(e.x||e.y){this.ec.curve.type==="mont"?assert$8(e.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&assert$8(e.x&&e.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(e.x,e.y);return}this.pub=this.ec.curve.decodePoint(e,At)};KeyPair$2.prototype.derive=function(e){return e.validate()||assert$8(e.validate(),"public point not validated"),e.mul(this.priv).getX()};KeyPair$2.prototype.sign=function(e,At,kt){return this.ec.sign(e,this,At,kt)};KeyPair$2.prototype.verify=function(e,At){return this.ec.verify(e,At,this)};KeyPair$2.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"};var BN$4=bnExports$1,utils$b=utils$t,assert$7=utils$b.assert;function Signature$2(xt,e){if(xt instanceof Signature$2)return xt;this._importDER(xt,e)||(assert$7(xt.r&&xt.s,"Signature without r or s"),this.r=new BN$4(xt.r,16),this.s=new BN$4(xt.s,16),xt.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=xt.recoveryParam)}var signature$1=Signature$2;function Position(){this.place=0}function getLength(xt,e){var At=xt[e.place++];if(!(At&128))return At;var kt=At&15;if(kt===0||kt>4)return!1;for(var Bt=0,Nt=0,jt=e.place;Nt<kt;Nt++,jt++)Bt<<=8,Bt|=xt[jt],Bt>>>=0;return Bt<=127?!1:(e.place=jt,Bt)}function rmPadding(xt){for(var e=0,At=xt.length-1;!xt[e]&&!(xt[e+1]&128)&&e<At;)e++;return e===0?xt:xt.slice(e)}Signature$2.prototype._importDER=function(e,At){e=utils$b.toArray(e,At);var kt=new Position;if(e[kt.place++]!==48)return!1;var Bt=getLength(e,kt);if(Bt===!1||Bt+kt.place!==e.length||e[kt.place++]!==2)return!1;var Nt=getLength(e,kt);if(Nt===!1)return!1;var jt=e.slice(kt.place,Nt+kt.place);if(kt.place+=Nt,e[kt.place++]!==2)return!1;var Lt=getLength(e,kt);if(Lt===!1||e.length!==Lt+kt.place)return!1;var er=e.slice(kt.place,Lt+kt.place);if(jt[0]===0)if(jt[1]&128)jt=jt.slice(1);else return!1;if(er[0]===0)if(er[1]&128)er=er.slice(1);else return!1;return this.r=new BN$4(jt),this.s=new BN$4(er),this.recoveryParam=null,!0};function constructLength(xt,e){if(e<128){xt.push(e);return}var At=1+(Math.log(e)/Math.LN2>>>3);for(xt.push(At|128);--At;)xt.push(e>>>(At<<3)&255);xt.push(e)}Signature$2.prototype.toDER=function(e){var At=this.r.toArray(),kt=this.s.toArray();for(At[0]&128&&(At=[0].concat(At)),kt[0]&128&&(kt=[0].concat(kt)),At=rmPadding(At),kt=rmPadding(kt);!kt[0]&&!(kt[1]&128);)kt=kt.slice(1);var Bt=[2];constructLength(Bt,At.length),Bt=Bt.concat(At),Bt.push(2),constructLength(Bt,kt.length);var Nt=Bt.concat(kt),jt=[48];return constructLength(jt,Nt.length),jt=jt.concat(Nt),utils$b.encode(jt,e)};var ec,hasRequiredEc;function requireEc(){if(hasRequiredEc)return ec;hasRequiredEc=1;var xt=bnExports$1,e=hmacDrbg,At=utils$t,kt=curves$1,Bt=requireBrorand(),Nt=At.assert,jt=key$1,Lt=signature$1;function er(tr){if(!(this instanceof er))return new er(tr);typeof tr=="string"&&(Nt(Object.prototype.hasOwnProperty.call(kt,tr),"Unknown curve "+tr),tr=kt[tr]),tr instanceof kt.PresetCurve&&(tr={curve:tr}),this.curve=tr.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=tr.curve.g,this.g.precompute(tr.curve.n.bitLength()+1),this.hash=tr.hash||tr.curve.hash}return ec=er,er.prototype.keyPair=function(zt){return new jt(this,zt)},er.prototype.keyFromPrivate=function(zt,rr){return jt.fromPrivate(this,zt,rr)},er.prototype.keyFromPublic=function(zt,rr){return jt.fromPublic(this,zt,rr)},er.prototype.genKeyPair=function(zt){zt||(zt={});for(var rr=new e({hash:this.hash,pers:zt.pers,persEnc:zt.persEnc||"utf8",entropy:zt.entropy||Bt(this.hash.hmacStrength),entropyEnc:zt.entropy&&zt.entropyEnc||"utf8",nonce:this.n.toArray()}),nr=this.n.byteLength(),ir=this.n.sub(new xt(2));;){var ar=new xt(rr.generate(nr));if(!(ar.cmp(ir)>0))return ar.iaddn(1),this.keyFromPrivate(ar)}},er.prototype._truncateToN=function(zt,rr){var nr=zt.byteLength()*8-this.n.bitLength();return nr>0&&(zt=zt.ushrn(nr)),!rr&&zt.cmp(this.n)>=0?zt.sub(this.n):zt},er.prototype.sign=function(zt,rr,nr,ir){typeof nr=="object"&&(ir=nr,nr=null),ir||(ir={}),rr=this.keyFromPrivate(rr,nr),zt=this._truncateToN(new xt(zt,16));for(var ar=this.n.byteLength(),dr=rr.getPrivate().toArray("be",ar),ur=zt.toArray("be",ar),fr=new e({hash:this.hash,entropy:dr,nonce:ur,pers:ir.pers,persEnc:ir.persEnc||"utf8"}),pr=this.n.sub(new xt(1)),lr=0;;lr++){var yr=ir.k?ir.k(lr):new xt(fr.generate(this.n.byteLength()));if(yr=this._truncateToN(yr,!0),!(yr.cmpn(1)<=0||yr.cmp(pr)>=0)){var br=this.g.mul(yr);if(!br.isInfinity()){var Ar=br.getX(),Pr=Ar.umod(this.n);if(Pr.cmpn(0)!==0){var kr=yr.invm(this.n).mul(Pr.mul(rr.getPrivate()).iadd(zt));if(kr=kr.umod(this.n),kr.cmpn(0)!==0){var Ur=(br.getY().isOdd()?1:0)|(Ar.cmp(Pr)!==0?2:0);return ir.canonical&&kr.cmp(this.nh)>0&&(kr=this.n.sub(kr),Ur^=1),new Lt({r:Pr,s:kr,recoveryParam:Ur})}}}}}},er.prototype.verify=function(zt,rr,nr,ir){zt=this._truncateToN(new xt(zt,16)),nr=this.keyFromPublic(nr,ir),rr=new Lt(rr,"hex");var ar=rr.r,dr=rr.s;if(ar.cmpn(1)<0||ar.cmp(this.n)>=0||dr.cmpn(1)<0||dr.cmp(this.n)>=0)return!1;var ur=dr.invm(this.n),fr=ur.mul(zt).umod(this.n),pr=ur.mul(ar).umod(this.n),lr;return this.curve._maxwellTrick?(lr=this.g.jmulAdd(fr,nr.getPublic(),pr),lr.isInfinity()?!1:lr.eqXToP(ar)):(lr=this.g.mulAdd(fr,nr.getPublic(),pr),lr.isInfinity()?!1:lr.getX().umod(this.n).cmp(ar)===0)},er.prototype.recoverPubKey=function(tr,zt,rr,nr){Nt((3&rr)===rr,"The recovery param is more than two bits"),zt=new Lt(zt,nr);var ir=this.n,ar=new xt(tr),dr=zt.r,ur=zt.s,fr=rr&1,pr=rr>>1;if(dr.cmp(this.curve.p.umod(this.curve.n))>=0&&pr)throw new Error("Unable to find sencond key candinate");pr?dr=this.curve.pointFromX(dr.add(this.curve.n),fr):dr=this.curve.pointFromX(dr,fr);var lr=zt.r.invm(ir),yr=ir.sub(ar).mul(lr).umod(ir),br=ur.mul(lr).umod(ir);return this.g.mulAdd(yr,dr,br)},er.prototype.getKeyRecoveryParam=function(tr,zt,rr,nr){if(zt=new Lt(zt,nr),zt.recoveryParam!==null)return zt.recoveryParam;for(var ir=0;ir<4;ir++){var ar;try{ar=this.recoverPubKey(tr,zt,ir)}catch{continue}if(ar.eq(rr))return ir}throw new Error("Unable to find valid recovery factor")},ec}var utils$a=utils$t,assert$6=utils$a.assert,parseBytes$2=utils$a.parseBytes,cachedProperty$1=utils$a.cachedProperty;function KeyPair$1(xt,e){this.eddsa=xt,this._secret=parseBytes$2(e.secret),xt.isPoint(e.pub)?this._pub=e.pub:this._pubBytes=parseBytes$2(e.pub)}KeyPair$1.fromPublic=function(e,At){return At instanceof KeyPair$1?At:new KeyPair$1(e,{pub:At})};KeyPair$1.fromSecret=function(e,At){return At instanceof KeyPair$1?At:new KeyPair$1(e,{secret:At})};KeyPair$1.prototype.secret=function(){return this._secret};cachedProperty$1(KeyPair$1,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())});cachedProperty$1(KeyPair$1,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())});cachedProperty$1(KeyPair$1,"privBytes",function(){var e=this.eddsa,At=this.hash(),kt=e.encodingLength-1,Bt=At.slice(0,e.encodingLength);return Bt[0]&=248,Bt[kt]&=127,Bt[kt]|=64,Bt});cachedProperty$1(KeyPair$1,"priv",function(){return this.eddsa.decodeInt(this.privBytes())});cachedProperty$1(KeyPair$1,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()});cachedProperty$1(KeyPair$1,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)});KeyPair$1.prototype.sign=function(e){return assert$6(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)};KeyPair$1.prototype.verify=function(e,At){return this.eddsa.verify(e,At,this)};KeyPair$1.prototype.getSecret=function(e){return assert$6(this._secret,"KeyPair is public only"),utils$a.encode(this.secret(),e)};KeyPair$1.prototype.getPublic=function(e){return utils$a.encode(this.pubBytes(),e)};var key=KeyPair$1,BN$3=bnExports$1,utils$9=utils$t,assert$5=utils$9.assert,cachedProperty=utils$9.cachedProperty,parseBytes$1=utils$9.parseBytes;function Signature$1(xt,e){this.eddsa=xt,typeof e!="object"&&(e=parseBytes$1(e)),Array.isArray(e)&&(e={R:e.slice(0,xt.encodingLength),S:e.slice(xt.encodingLength)}),assert$5(e.R&&e.S,"Signature without R or S"),xt.isPoint(e.R)&&(this._R=e.R),e.S instanceof BN$3&&(this._S=e.S),this._Rencoded=Array.isArray(e.R)?e.R:e.Rencoded,this._Sencoded=Array.isArray(e.S)?e.S:e.Sencoded}cachedProperty(Signature$1,"S",function(){return this.eddsa.decodeInt(this.Sencoded())});cachedProperty(Signature$1,"R",function(){return this.eddsa.decodePoint(this.Rencoded())});cachedProperty(Signature$1,"Rencoded",function(){return this.eddsa.encodePoint(this.R())});cachedProperty(Signature$1,"Sencoded",function(){return this.eddsa.encodeInt(this.S())});Signature$1.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())};Signature$1.prototype.toHex=function(){return utils$9.encode(this.toBytes(),"hex").toUpperCase()};var signature=Signature$1,hash$3=hash$5,curves=curves$1,utils$8=utils$t,assert$4=utils$8.assert,parseBytes=utils$8.parseBytes,KeyPair=key,Signature=signature;function EDDSA(xt){if(assert$4(xt==="ed25519","only tested with ed25519 so far"),!(this instanceof EDDSA))return new EDDSA(xt);xt=curves[xt].curve,this.curve=xt,this.g=xt.g,this.g.precompute(xt.n.bitLength()+1),this.pointClass=xt.point().constructor,this.encodingLength=Math.ceil(xt.n.bitLength()/8),this.hash=hash$3.sha512}var eddsa=EDDSA;EDDSA.prototype.sign=function(e,At){e=parseBytes(e);var kt=this.keyFromSecret(At),Bt=this.hashInt(kt.messagePrefix(),e),Nt=this.g.mul(Bt),jt=this.encodePoint(Nt),Lt=this.hashInt(jt,kt.pubBytes(),e).mul(kt.priv()),er=Bt.add(Lt).umod(this.curve.n);return this.makeSignature({R:Nt,S:er,Rencoded:jt})};EDDSA.prototype.verify=function(e,At,kt){if(e=parseBytes(e),At=this.makeSignature(At),At.S().gte(At.eddsa.curve.n)||At.S().isNeg())return!1;var Bt=this.keyFromPublic(kt),Nt=this.hashInt(At.Rencoded(),Bt.pubBytes(),e),jt=this.g.mul(At.S()),Lt=At.R().add(Bt.pub().mul(Nt));return Lt.eq(jt)};EDDSA.prototype.hashInt=function(){for(var e=this.hash(),At=0;At<arguments.length;At++)e.update(arguments[At]);return utils$8.intFromLE(e.digest()).umod(this.curve.n)};EDDSA.prototype.keyFromPublic=function(e){return KeyPair.fromPublic(this,e)};EDDSA.prototype.keyFromSecret=function(e){return KeyPair.fromSecret(this,e)};EDDSA.prototype.makeSignature=function(e){return e instanceof Signature?e:new Signature(this,e)};EDDSA.prototype.encodePoint=function(e){var At=e.getY().toArray("le",this.encodingLength);return At[this.encodingLength-1]|=e.getX().isOdd()?128:0,At};EDDSA.prototype.decodePoint=function(e){e=utils$8.parseBytes(e);var At=e.length-1,kt=e.slice(0,At).concat(e[At]&-129),Bt=(e[At]&128)!==0,Nt=utils$8.intFromLE(kt);return this.curve.pointFromY(Nt,Bt)};EDDSA.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)};EDDSA.prototype.decodeInt=function(e){return utils$8.intFromLE(e)};EDDSA.prototype.isPoint=function(e){return e instanceof this.pointClass};var hasRequiredElliptic;function requireElliptic(){return hasRequiredElliptic||(hasRequiredElliptic=1,function(xt){var e=xt;e.version=require$$0$3.version,e.utils=utils$t,e.rand=requireBrorand(),e.curve=curve$1,e.curves=curves$1,e.ec=requireEc(),e.eddsa=eddsa}(elliptic$1)),elliptic$1}var asn1$3={},asn1$2={},api={},vmBrowserify={},hasRequiredVmBrowserify;function requireVmBrowserify(){return hasRequiredVmBrowserify||(hasRequiredVmBrowserify=1,function(exports){var indexOf=function(xt,e){if(xt.indexOf)return xt.indexOf(e);for(var At=0;At<xt.length;At++)if(xt[At]===e)return At;return-1},Object_keys=function(xt){if(Object.keys)return Object.keys(xt);var e=[];for(var At in xt)e.push(At);return e},forEach=function(xt,e){if(xt.forEach)return xt.forEach(e);for(var At=0;At<xt.length;At++)e(xt[At],At,xt)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(xt,e,At){Object.defineProperty(xt,e,{writable:!0,enumerable:!1,configurable:!0,value:At})}}catch{return function(e,At,kt){e[At]=kt}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(e){if(!(this instanceof Script))return new Script(e);this.code=e};Script.prototype.runInContext=function(xt){if(!(xt instanceof Context))throw new TypeError("needs a 'context' argument.");var e=document.createElement("iframe");e.style||(e.style={}),e.style.display="none",document.body.appendChild(e);var At=e.contentWindow,kt=At.eval,Bt=At.execScript;!kt&&Bt&&(Bt.call(At,"null"),kt=At.eval),forEach(Object_keys(xt),function(Lt){At[Lt]=xt[Lt]}),forEach(globals,function(Lt){xt[Lt]&&(At[Lt]=xt[Lt])});var Nt=Object_keys(At),jt=kt.call(At,this.code);return forEach(Object_keys(At),function(Lt){(Lt in xt||indexOf(Nt,Lt)===-1)&&(xt[Lt]=At[Lt])}),forEach(globals,function(Lt){Lt in xt||defineProp(xt,Lt,At[Lt])}),document.body.removeChild(e),jt},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(xt){var e=Script.createContext(xt),At=this.runInContext(e);return xt&&forEach(Object_keys(e),function(kt){xt[kt]=e[kt]}),At},forEach(Object_keys(Script.prototype),function(xt){exports[xt]=Script[xt]=function(e){var At=Script(e);return At[xt].apply(At,[].slice.call(arguments,1))}}),exports.isContext=function(xt){return xt instanceof Context},exports.createScript=function(xt){return exports.Script(xt)},exports.createContext=Script.createContext=function(xt){var e=new Context;return typeof xt=="object"&&forEach(Object_keys(xt),function(At){e[At]=xt[At]}),e}}(vmBrowserify)),vmBrowserify}var hasRequiredApi;function requireApi(){return hasRequiredApi||(hasRequiredApi=1,function(xt){var e=requireAsn1(),At=inherits_browserExports,kt=xt;kt.define=function(jt,Lt){return new Bt(jt,Lt)};function Bt(Nt,jt){this.name=Nt,this.body=jt,this.decoders={},this.encoders={}}Bt.prototype._createNamed=function(jt){var Lt;try{Lt=requireVmBrowserify().runInThisContext("(function "+this.name+`(entity) {
  this._initNamed(entity);
})`)}catch{Lt=function(tr){this._initNamed(tr)}}return At(Lt,jt),Lt.prototype._initNamed=function(tr){jt.call(this,tr)},new Lt(this)},Bt.prototype._getDecoder=function(jt){return jt=jt||"der",this.decoders.hasOwnProperty(jt)||(this.decoders[jt]=this._createNamed(e.decoders[jt])),this.decoders[jt]},Bt.prototype.decode=function(jt,Lt,er){return this._getDecoder(Lt).decode(jt,er)},Bt.prototype._getEncoder=function(jt){return jt=jt||"der",this.encoders.hasOwnProperty(jt)||(this.encoders[jt]=this._createNamed(e.encoders[jt])),this.encoders[jt]},Bt.prototype.encode=function(jt,Lt,er){return this._getEncoder(Lt).encode(jt,er)}}(api)),api}var base$1={},reporter={},inherits=inherits_browserExports;function Reporter(xt){this._reporterState={obj:null,path:[],options:xt||{},errors:[]}}reporter.Reporter=Reporter;Reporter.prototype.isError=function xt(e){return e instanceof ReporterError};Reporter.prototype.save=function xt(){var e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}};Reporter.prototype.restore=function xt(e){var At=this._reporterState;At.obj=e.obj,At.path=At.path.slice(0,e.pathLen)};Reporter.prototype.enterKey=function xt(e){return this._reporterState.path.push(e)};Reporter.prototype.exitKey=function xt(e){var At=this._reporterState;At.path=At.path.slice(0,e-1)};Reporter.prototype.leaveKey=function xt(e,At,kt){var Bt=this._reporterState;this.exitKey(e),Bt.obj!==null&&(Bt.obj[At]=kt)};Reporter.prototype.path=function xt(){return this._reporterState.path.join("/")};Reporter.prototype.enterObject=function xt(){var e=this._reporterState,At=e.obj;return e.obj={},At};Reporter.prototype.leaveObject=function xt(e){var At=this._reporterState,kt=At.obj;return At.obj=e,kt};Reporter.prototype.error=function xt(e){var At,kt=this._reporterState,Bt=e instanceof ReporterError;if(Bt?At=e:At=new ReporterError(kt.path.map(function(Nt){return"["+JSON.stringify(Nt)+"]"}).join(""),e.message||e,e.stack),!kt.options.partial)throw At;return Bt||kt.errors.push(At),At};Reporter.prototype.wrapResult=function xt(e){var At=this._reporterState;return At.options.partial?{result:this.isError(e)?null:e,errors:At.errors}:e};function ReporterError(xt,e){this.path=xt,this.rethrow(e)}inherits(ReporterError,Error);ReporterError.prototype.rethrow=function xt(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,ReporterError),!this.stack)try{throw new Error(this.message)}catch(At){this.stack=At.stack}return this};var buffer={},hasRequiredBuffer;function requireBuffer(){if(hasRequiredBuffer)return buffer;hasRequiredBuffer=1;var xt=inherits_browserExports,e=requireBase().Reporter,At=buffer$2.Buffer;function kt(Nt,jt){if(e.call(this,jt),!At.isBuffer(Nt)){this.error("Input not Buffer");return}this.base=Nt,this.offset=0,this.length=Nt.length}xt(kt,e),buffer.DecoderBuffer=kt,kt.prototype.save=function(){return{offset:this.offset,reporter:e.prototype.save.call(this)}},kt.prototype.restore=function(jt){var Lt=new kt(this.base);return Lt.offset=jt.offset,Lt.length=this.offset,this.offset=jt.offset,e.prototype.restore.call(this,jt.reporter),Lt},kt.prototype.isEmpty=function(){return this.offset===this.length},kt.prototype.readUInt8=function(jt){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(jt||"DecoderBuffer overrun")},kt.prototype.skip=function(jt,Lt){if(!(this.offset+jt<=this.length))return this.error(Lt||"DecoderBuffer overrun");var er=new kt(this.base);return er._reporterState=this._reporterState,er.offset=this.offset,er.length=this.offset+jt,this.offset+=jt,er},kt.prototype.raw=function(jt){return this.base.slice(jt?jt.offset:this.offset,this.length)};function Bt(Nt,jt){if(Array.isArray(Nt))this.length=0,this.value=Nt.map(function(Lt){return Lt instanceof Bt||(Lt=new Bt(Lt,jt)),this.length+=Lt.length,Lt},this);else if(typeof Nt=="number"){if(!(0<=Nt&&Nt<=255))return jt.error("non-byte EncoderBuffer value");this.value=Nt,this.length=1}else if(typeof Nt=="string")this.value=Nt,this.length=At.byteLength(Nt);else if(At.isBuffer(Nt))this.value=Nt,this.length=Nt.length;else return jt.error("Unsupported type: "+typeof Nt)}return buffer.EncoderBuffer=Bt,Bt.prototype.join=function(jt,Lt){return jt||(jt=new At(this.length)),Lt||(Lt=0),this.length===0||(Array.isArray(this.value)?this.value.forEach(function(er){er.join(jt,Lt),Lt+=er.length}):(typeof this.value=="number"?jt[Lt]=this.value:typeof this.value=="string"?jt.write(this.value,Lt):At.isBuffer(this.value)&&this.value.copy(jt,Lt),Lt+=this.length)),jt},buffer}var node,hasRequiredNode;function requireNode(){if(hasRequiredNode)return node;hasRequiredNode=1;var xt=requireBase().Reporter,e=requireBase().EncoderBuffer,At=requireBase().DecoderBuffer,kt=minimalisticAssert,Bt=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],Nt=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(Bt),jt=["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"];function Lt(tr,zt){var rr={};this._baseState=rr,rr.enc=tr,rr.parent=zt||null,rr.children=null,rr.tag=null,rr.args=null,rr.reverseArgs=null,rr.choice=null,rr.optional=!1,rr.any=!1,rr.obj=!1,rr.use=null,rr.useDecoder=null,rr.key=null,rr.default=null,rr.explicit=null,rr.implicit=null,rr.contains=null,rr.parent||(rr.children=[],this._wrap())}node=Lt;var er=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];return Lt.prototype.clone=function(){var zt=this._baseState,rr={};er.forEach(function(ir){rr[ir]=zt[ir]});var nr=new this.constructor(rr.parent);return nr._baseState=rr,nr},Lt.prototype._wrap=function(){var zt=this._baseState;Nt.forEach(function(rr){this[rr]=function(){var ir=new this.constructor(this);return zt.children.push(ir),ir[rr].apply(ir,arguments)}},this)},Lt.prototype._init=function(zt){var rr=this._baseState;kt(rr.parent===null),zt.call(this),rr.children=rr.children.filter(function(nr){return nr._baseState.parent===this},this),kt.equal(rr.children.length,1,"Root node can have only one child")},Lt.prototype._useArgs=function(zt){var rr=this._baseState,nr=zt.filter(function(ir){return ir instanceof this.constructor},this);zt=zt.filter(function(ir){return!(ir instanceof this.constructor)},this),nr.length!==0&&(kt(rr.children===null),rr.children=nr,nr.forEach(function(ir){ir._baseState.parent=this},this)),zt.length!==0&&(kt(rr.args===null),rr.args=zt,rr.reverseArgs=zt.map(function(ir){if(typeof ir!="object"||ir.constructor!==Object)return ir;var ar={};return Object.keys(ir).forEach(function(dr){dr==(dr|0)&&(dr|=0);var ur=ir[dr];ar[ur]=dr}),ar}))},jt.forEach(function(tr){Lt.prototype[tr]=function(){var rr=this._baseState;throw new Error(tr+" not implemented for encoding: "+rr.enc)}}),Bt.forEach(function(tr){Lt.prototype[tr]=function(){var rr=this._baseState,nr=Array.prototype.slice.call(arguments);return kt(rr.tag===null),rr.tag=tr,this._useArgs(nr),this}}),Lt.prototype.use=function(zt){kt(zt);var rr=this._baseState;return kt(rr.use===null),rr.use=zt,this},Lt.prototype.optional=function(){var zt=this._baseState;return zt.optional=!0,this},Lt.prototype.def=function(zt){var rr=this._baseState;return kt(rr.default===null),rr.default=zt,rr.optional=!0,this},Lt.prototype.explicit=function(zt){var rr=this._baseState;return kt(rr.explicit===null&&rr.implicit===null),rr.explicit=zt,this},Lt.prototype.implicit=function(zt){var rr=this._baseState;return kt(rr.explicit===null&&rr.implicit===null),rr.implicit=zt,this},Lt.prototype.obj=function(){var zt=this._baseState,rr=Array.prototype.slice.call(arguments);return zt.obj=!0,rr.length!==0&&this._useArgs(rr),this},Lt.prototype.key=function(zt){var rr=this._baseState;return kt(rr.key===null),rr.key=zt,this},Lt.prototype.any=function(){var zt=this._baseState;return zt.any=!0,this},Lt.prototype.choice=function(zt){var rr=this._baseState;return kt(rr.choice===null),rr.choice=zt,this._useArgs(Object.keys(zt).map(function(nr){return zt[nr]})),this},Lt.prototype.contains=function(zt){var rr=this._baseState;return kt(rr.use===null),rr.contains=zt,this},Lt.prototype._decode=function(zt,rr){var nr=this._baseState;if(nr.parent===null)return zt.wrapResult(nr.children[0]._decode(zt,rr));var ir=nr.default,ar=!0,dr=null;if(nr.key!==null&&(dr=zt.enterKey(nr.key)),nr.optional){var ur=null;if(nr.explicit!==null?ur=nr.explicit:nr.implicit!==null?ur=nr.implicit:nr.tag!==null&&(ur=nr.tag),ur===null&&!nr.any){var fr=zt.save();try{nr.choice===null?this._decodeGeneric(nr.tag,zt,rr):this._decodeChoice(zt,rr),ar=!0}catch{ar=!1}zt.restore(fr)}else if(ar=this._peekTag(zt,ur,nr.any),zt.isError(ar))return ar}var pr;if(nr.obj&&ar&&(pr=zt.enterObject()),ar){if(nr.explicit!==null){var lr=this._decodeTag(zt,nr.explicit);if(zt.isError(lr))return lr;zt=lr}var yr=zt.offset;if(nr.use===null&&nr.choice===null){if(nr.any)var fr=zt.save();var br=this._decodeTag(zt,nr.implicit!==null?nr.implicit:nr.tag,nr.any);if(zt.isError(br))return br;nr.any?ir=zt.raw(fr):zt=br}if(rr&&rr.track&&nr.tag!==null&&rr.track(zt.path(),yr,zt.length,"tagged"),rr&&rr.track&&nr.tag!==null&&rr.track(zt.path(),zt.offset,zt.length,"content"),nr.any?ir=ir:nr.choice===null?ir=this._decodeGeneric(nr.tag,zt,rr):ir=this._decodeChoice(zt,rr),zt.isError(ir))return ir;if(!nr.any&&nr.choice===null&&nr.children!==null&&nr.children.forEach(function(kr){kr._decode(zt,rr)}),nr.contains&&(nr.tag==="octstr"||nr.tag==="bitstr")){var Ar=new At(ir);ir=this._getUse(nr.contains,zt._reporterState.obj)._decode(Ar,rr)}}return nr.obj&&ar&&(ir=zt.leaveObject(pr)),nr.key!==null&&(ir!==null||ar===!0)?zt.leaveKey(dr,nr.key,ir):dr!==null&&zt.exitKey(dr),ir},Lt.prototype._decodeGeneric=function(zt,rr,nr){var ir=this._baseState;return zt==="seq"||zt==="set"?null:zt==="seqof"||zt==="setof"?this._decodeList(rr,zt,ir.args[0],nr):/str$/.test(zt)?this._decodeStr(rr,zt,nr):zt==="objid"&&ir.args?this._decodeObjid(rr,ir.args[0],ir.args[1],nr):zt==="objid"?this._decodeObjid(rr,null,null,nr):zt==="gentime"||zt==="utctime"?this._decodeTime(rr,zt,nr):zt==="null_"?this._decodeNull(rr,nr):zt==="bool"?this._decodeBool(rr,nr):zt==="objDesc"?this._decodeStr(rr,zt,nr):zt==="int"||zt==="enum"?this._decodeInt(rr,ir.args&&ir.args[0],nr):ir.use!==null?this._getUse(ir.use,rr._reporterState.obj)._decode(rr,nr):rr.error("unknown tag: "+zt)},Lt.prototype._getUse=function(zt,rr){var nr=this._baseState;return nr.useDecoder=this._use(zt,rr),kt(nr.useDecoder._baseState.parent===null),nr.useDecoder=nr.useDecoder._baseState.children[0],nr.implicit!==nr.useDecoder._baseState.implicit&&(nr.useDecoder=nr.useDecoder.clone(),nr.useDecoder._baseState.implicit=nr.implicit),nr.useDecoder},Lt.prototype._decodeChoice=function(zt,rr){var nr=this._baseState,ir=null,ar=!1;return Object.keys(nr.choice).some(function(dr){var ur=zt.save(),fr=nr.choice[dr];try{var pr=fr._decode(zt,rr);if(zt.isError(pr))return!1;ir={type:dr,value:pr},ar=!0}catch{return zt.restore(ur),!1}return!0},this),ar?ir:zt.error("Choice not matched")},Lt.prototype._createEncoderBuffer=function(zt){return new e(zt,this.reporter)},Lt.prototype._encode=function(zt,rr,nr){var ir=this._baseState;if(!(ir.default!==null&&ir.default===zt)){var ar=this._encodeValue(zt,rr,nr);if(ar!==void 0&&!this._skipDefault(ar,rr,nr))return ar}},Lt.prototype._encodeValue=function(zt,rr,nr){var ir=this._baseState;if(ir.parent===null)return ir.children[0]._encode(zt,rr||new xt);var fr=null;if(this.reporter=rr,ir.optional&&zt===void 0)if(ir.default!==null)zt=ir.default;else return;var ar=null,dr=!1;if(ir.any)fr=this._createEncoderBuffer(zt);else if(ir.choice)fr=this._encodeChoice(zt,rr);else if(ir.contains)ar=this._getUse(ir.contains,nr)._encode(zt,rr),dr=!0;else if(ir.children)ar=ir.children.map(function(yr){if(yr._baseState.tag==="null_")return yr._encode(null,rr,zt);if(yr._baseState.key===null)return rr.error("Child should have a key");var br=rr.enterKey(yr._baseState.key);if(typeof zt!="object")return rr.error("Child expected, but input is not object");var Ar=yr._encode(zt[yr._baseState.key],rr,zt);return rr.leaveKey(br),Ar},this).filter(function(yr){return yr}),ar=this._createEncoderBuffer(ar);else if(ir.tag==="seqof"||ir.tag==="setof"){if(!(ir.args&&ir.args.length===1))return rr.error("Too many args for : "+ir.tag);if(!Array.isArray(zt))return rr.error("seqof/setof, but data is not Array");var ur=this.clone();ur._baseState.implicit=null,ar=this._createEncoderBuffer(zt.map(function(yr){var br=this._baseState;return this._getUse(br.args[0],zt)._encode(yr,rr)},ur))}else ir.use!==null?fr=this._getUse(ir.use,nr)._encode(zt,rr):(ar=this._encodePrimitive(ir.tag,zt),dr=!0);var fr;if(!ir.any&&ir.choice===null){var pr=ir.implicit!==null?ir.implicit:ir.tag,lr=ir.implicit===null?"universal":"context";pr===null?ir.use===null&&rr.error("Tag could be omitted only for .use()"):ir.use===null&&(fr=this._encodeComposite(pr,dr,lr,ar))}return ir.explicit!==null&&(fr=this._encodeComposite(ir.explicit,!1,"context",fr)),fr},Lt.prototype._encodeChoice=function(zt,rr){var nr=this._baseState,ir=nr.choice[zt.type];return ir||kt(!1,zt.type+" not found in "+JSON.stringify(Object.keys(nr.choice))),ir._encode(zt.value,rr)},Lt.prototype._encodePrimitive=function(zt,rr){var nr=this._baseState;if(/str$/.test(zt))return this._encodeStr(rr,zt);if(zt==="objid"&&nr.args)return this._encodeObjid(rr,nr.reverseArgs[0],nr.args[1]);if(zt==="objid")return this._encodeObjid(rr,null,null);if(zt==="gentime"||zt==="utctime")return this._encodeTime(rr,zt);if(zt==="null_")return this._encodeNull();if(zt==="int"||zt==="enum")return this._encodeInt(rr,nr.args&&nr.reverseArgs[0]);if(zt==="bool")return this._encodeBool(rr);if(zt==="objDesc")return this._encodeStr(rr,zt);throw new Error("Unsupported tag: "+zt)},Lt.prototype._isNumstr=function(zt){return/^[0-9 ]*$/.test(zt)},Lt.prototype._isPrintstr=function(zt){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(zt)},node}var hasRequiredBase;function requireBase(){return hasRequiredBase||(hasRequiredBase=1,function(xt){var e=xt;e.Reporter=reporter.Reporter,e.DecoderBuffer=requireBuffer().DecoderBuffer,e.EncoderBuffer=requireBuffer().EncoderBuffer,e.Node=requireNode()}(base$1)),base$1}var constants={},der={},hasRequiredDer$2;function requireDer$2(){return hasRequiredDer$2||(hasRequiredDer$2=1,function(xt){var e=requireConstants();xt.tagClass={0:"universal",1:"application",2:"context",3:"private"},xt.tagClassByName=e._reverse(xt.tagClass),xt.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},xt.tagByName=e._reverse(xt.tag)}(der)),der}var hasRequiredConstants;function requireConstants(){return hasRequiredConstants||(hasRequiredConstants=1,function(xt){var e=xt;e._reverse=function(kt){var Bt={};return Object.keys(kt).forEach(function(Nt){(Nt|0)==Nt&&(Nt=Nt|0);var jt=kt[Nt];Bt[jt]=Nt}),Bt},e.der=requireDer$2()}(constants)),constants}var decoders={},der_1$1,hasRequiredDer$1;function requireDer$1(){if(hasRequiredDer$1)return der_1$1;hasRequiredDer$1=1;var xt=inherits_browserExports,e=requireAsn1(),At=e.base,kt=e.bignum,Bt=e.constants.der;function Nt(tr){this.enc="der",this.name=tr.name,this.entity=tr,this.tree=new jt,this.tree._init(tr.body)}der_1$1=Nt,Nt.prototype.decode=function(zt,rr){return zt instanceof At.DecoderBuffer||(zt=new At.DecoderBuffer(zt,rr)),this.tree._decode(zt,rr)};function jt(tr){At.Node.call(this,"der",tr)}xt(jt,At.Node),jt.prototype._peekTag=function(zt,rr,nr){if(zt.isEmpty())return!1;var ir=zt.save(),ar=Lt(zt,'Failed to peek tag: "'+rr+'"');return zt.isError(ar)?ar:(zt.restore(ir),ar.tag===rr||ar.tagStr===rr||ar.tagStr+"of"===rr||nr)},jt.prototype._decodeTag=function(zt,rr,nr){var ir=Lt(zt,'Failed to decode tag of "'+rr+'"');if(zt.isError(ir))return ir;var ar=er(zt,ir.primitive,'Failed to get length of "'+rr+'"');if(zt.isError(ar))return ar;if(!nr&&ir.tag!==rr&&ir.tagStr!==rr&&ir.tagStr+"of"!==rr)return zt.error('Failed to match tag: "'+rr+'"');if(ir.primitive||ar!==null)return zt.skip(ar,'Failed to match body of: "'+rr+'"');var dr=zt.save(),ur=this._skipUntilEnd(zt,'Failed to skip indefinite length body: "'+this.tag+'"');return zt.isError(ur)?ur:(ar=zt.offset-dr.offset,zt.restore(dr),zt.skip(ar,'Failed to match body of: "'+rr+'"'))},jt.prototype._skipUntilEnd=function(zt,rr){for(;;){var nr=Lt(zt,rr);if(zt.isError(nr))return nr;var ir=er(zt,nr.primitive,rr);if(zt.isError(ir))return ir;var ar;if(nr.primitive||ir!==null?ar=zt.skip(ir):ar=this._skipUntilEnd(zt,rr),zt.isError(ar))return ar;if(nr.tagStr==="end")break}},jt.prototype._decodeList=function(zt,rr,nr,ir){for(var ar=[];!zt.isEmpty();){var dr=this._peekTag(zt,"end");if(zt.isError(dr))return dr;var ur=nr.decode(zt,"der",ir);if(zt.isError(ur)&&dr)break;ar.push(ur)}return ar},jt.prototype._decodeStr=function(zt,rr){if(rr==="bitstr"){var nr=zt.readUInt8();return zt.isError(nr)?nr:{unused:nr,data:zt.raw()}}else if(rr==="bmpstr"){var ir=zt.raw();if(ir.length%2===1)return zt.error("Decoding of string type: bmpstr length mismatch");for(var ar="",dr=0;dr<ir.length/2;dr++)ar+=String.fromCharCode(ir.readUInt16BE(dr*2));return ar}else if(rr==="numstr"){var ur=zt.raw().toString("ascii");return this._isNumstr(ur)?ur:zt.error("Decoding of string type: numstr unsupported characters")}else{if(rr==="octstr")return zt.raw();if(rr==="objDesc")return zt.raw();if(rr==="printstr"){var fr=zt.raw().toString("ascii");return this._isPrintstr(fr)?fr:zt.error("Decoding of string type: printstr unsupported characters")}else return/str$/.test(rr)?zt.raw().toString():zt.error("Decoding of string type: "+rr+" unsupported")}},jt.prototype._decodeObjid=function(zt,rr,nr){for(var ir,ar=[],dr=0;!zt.isEmpty();){var ur=zt.readUInt8();dr<<=7,dr|=ur&127,ur&128||(ar.push(dr),dr=0)}ur&128&&ar.push(dr);var fr=ar[0]/40|0,pr=ar[0]%40;if(nr?ir=ar:ir=[fr,pr].concat(ar.slice(1)),rr){var lr=rr[ir.join(" ")];lr===void 0&&(lr=rr[ir.join(".")]),lr!==void 0&&(ir=lr)}return ir},jt.prototype._decodeTime=function(zt,rr){var nr=zt.raw().toString();if(rr==="gentime")var ir=nr.slice(0,4)|0,ar=nr.slice(4,6)|0,dr=nr.slice(6,8)|0,ur=nr.slice(8,10)|0,fr=nr.slice(10,12)|0,pr=nr.slice(12,14)|0;else if(rr==="utctime"){var ir=nr.slice(0,2)|0,ar=nr.slice(2,4)|0,dr=nr.slice(4,6)|0,ur=nr.slice(6,8)|0,fr=nr.slice(8,10)|0,pr=nr.slice(10,12)|0;ir<70?ir=2e3+ir:ir=1900+ir}else return zt.error("Decoding "+rr+" time is not supported yet");return Date.UTC(ir,ar-1,dr,ur,fr,pr,0)},jt.prototype._decodeNull=function(zt){return null},jt.prototype._decodeBool=function(zt){var rr=zt.readUInt8();return zt.isError(rr)?rr:rr!==0},jt.prototype._decodeInt=function(zt,rr){var nr=zt.raw(),ir=new kt(nr);return rr&&(ir=rr[ir.toString(10)]||ir),ir},jt.prototype._use=function(zt,rr){return typeof zt=="function"&&(zt=zt(rr)),zt._getDecoder("der").tree};function Lt(tr,zt){var rr=tr.readUInt8(zt);if(tr.isError(rr))return rr;var nr=Bt.tagClass[rr>>6],ir=(rr&32)===0;if((rr&31)===31){var ar=rr;for(rr=0;(ar&128)===128;){if(ar=tr.readUInt8(zt),tr.isError(ar))return ar;rr<<=7,rr|=ar&127}}else rr&=31;var dr=Bt.tag[rr];return{cls:nr,primitive:ir,tag:rr,tagStr:dr}}function er(tr,zt,rr){var nr=tr.readUInt8(rr);if(tr.isError(nr))return nr;if(!zt&&nr===128)return null;if(!(nr&128))return nr;var ir=nr&127;if(ir>4)return tr.error("length octect is too long");nr=0;for(var ar=0;ar<ir;ar++){nr<<=8;var dr=tr.readUInt8(rr);if(tr.isError(dr))return dr;nr|=dr}return nr}return der_1$1}var pem$1,hasRequiredPem$1;function requirePem$1(){if(hasRequiredPem$1)return pem$1;hasRequiredPem$1=1;var xt=inherits_browserExports,e=buffer$2.Buffer,At=requireDer$1();function kt(Bt){At.call(this,Bt),this.enc="pem"}return xt(kt,At),pem$1=kt,kt.prototype.decode=function(Nt,jt){for(var Lt=Nt.toString().split(/[\r\n]+/g),er=jt.label.toUpperCase(),tr=/^-----(BEGIN|END) ([^-]+)-----$/,zt=-1,rr=-1,nr=0;nr<Lt.length;nr++){var ir=Lt[nr].match(tr);if(ir!==null&&ir[2]===er)if(zt===-1){if(ir[1]!=="BEGIN")break;zt=nr}else{if(ir[1]!=="END")break;rr=nr;break}}if(zt===-1||rr===-1)throw new Error("PEM section not found for: "+er);var ar=Lt.slice(zt+1,rr).join("");ar.replace(/[^a-z0-9\+\/=]+/gi,"");var dr=new e(ar,"base64");return At.prototype.decode.call(this,dr,jt)},pem$1}var hasRequiredDecoders;function requireDecoders(){return hasRequiredDecoders||(hasRequiredDecoders=1,function(xt){var e=xt;e.der=requireDer$1(),e.pem=requirePem$1()}(decoders)),decoders}var encoders={},der_1,hasRequiredDer;function requireDer(){if(hasRequiredDer)return der_1;hasRequiredDer=1;var xt=inherits_browserExports,e=buffer$2.Buffer,At=requireAsn1(),kt=At.base,Bt=At.constants.der;function Nt(tr){this.enc="der",this.name=tr.name,this.entity=tr,this.tree=new jt,this.tree._init(tr.body)}der_1=Nt,Nt.prototype.encode=function(zt,rr){return this.tree._encode(zt,rr).join()};function jt(tr){kt.Node.call(this,"der",tr)}xt(jt,kt.Node),jt.prototype._encodeComposite=function(zt,rr,nr,ir){var ar=er(zt,rr,nr,this.reporter);if(ir.length<128){var fr=new e(2);return fr[0]=ar,fr[1]=ir.length,this._createEncoderBuffer([fr,ir])}for(var dr=1,ur=ir.length;ur>=256;ur>>=8)dr++;var fr=new e(2+dr);fr[0]=ar,fr[1]=128|dr;for(var ur=1+dr,pr=ir.length;pr>0;ur--,pr>>=8)fr[ur]=pr&255;return this._createEncoderBuffer([fr,ir])},jt.prototype._encodeStr=function(zt,rr){if(rr==="bitstr")return this._createEncoderBuffer([zt.unused|0,zt.data]);if(rr==="bmpstr"){for(var nr=new e(zt.length*2),ir=0;ir<zt.length;ir++)nr.writeUInt16BE(zt.charCodeAt(ir),ir*2);return this._createEncoderBuffer(nr)}else return rr==="numstr"?this._isNumstr(zt)?this._createEncoderBuffer(zt):this.reporter.error("Encoding of string type: numstr supports only digits and space"):rr==="printstr"?this._isPrintstr(zt)?this._createEncoderBuffer(zt):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(rr)?this._createEncoderBuffer(zt):rr==="objDesc"?this._createEncoderBuffer(zt):this.reporter.error("Encoding of string type: "+rr+" unsupported")},jt.prototype._encodeObjid=function(zt,rr,nr){if(typeof zt=="string"){if(!rr)return this.reporter.error("string objid given, but no values map found");if(!rr.hasOwnProperty(zt))return this.reporter.error("objid not found in values map");zt=rr[zt].split(/[\s\.]+/g);for(var ir=0;ir<zt.length;ir++)zt[ir]|=0}else if(Array.isArray(zt)){zt=zt.slice();for(var ir=0;ir<zt.length;ir++)zt[ir]|=0}if(!Array.isArray(zt))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(zt));if(!nr){if(zt[1]>=40)return this.reporter.error("Second objid identifier OOB");zt.splice(0,2,zt[0]*40+zt[1])}for(var ar=0,ir=0;ir<zt.length;ir++){var dr=zt[ir];for(ar++;dr>=128;dr>>=7)ar++}for(var ur=new e(ar),fr=ur.length-1,ir=zt.length-1;ir>=0;ir--){var dr=zt[ir];for(ur[fr--]=dr&127;(dr>>=7)>0;)ur[fr--]=128|dr&127}return this._createEncoderBuffer(ur)};function Lt(tr){return tr<10?"0"+tr:tr}jt.prototype._encodeTime=function(zt,rr){var nr,ir=new Date(zt);return rr==="gentime"?nr=[Lt(ir.getFullYear()),Lt(ir.getUTCMonth()+1),Lt(ir.getUTCDate()),Lt(ir.getUTCHours()),Lt(ir.getUTCMinutes()),Lt(ir.getUTCSeconds()),"Z"].join(""):rr==="utctime"?nr=[Lt(ir.getFullYear()%100),Lt(ir.getUTCMonth()+1),Lt(ir.getUTCDate()),Lt(ir.getUTCHours()),Lt(ir.getUTCMinutes()),Lt(ir.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+rr+" time is not supported yet"),this._encodeStr(nr,"octstr")},jt.prototype._encodeNull=function(){return this._createEncoderBuffer("")},jt.prototype._encodeInt=function(zt,rr){if(typeof zt=="string"){if(!rr)return this.reporter.error("String int or enum given, but no values map");if(!rr.hasOwnProperty(zt))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(zt));zt=rr[zt]}if(typeof zt!="number"&&!e.isBuffer(zt)){var nr=zt.toArray();!zt.sign&&nr[0]&128&&nr.unshift(0),zt=new e(nr)}if(e.isBuffer(zt)){var ir=zt.length;zt.length===0&&ir++;var dr=new e(ir);return zt.copy(dr),zt.length===0&&(dr[0]=0),this._createEncoderBuffer(dr)}if(zt<128)return this._createEncoderBuffer(zt);if(zt<256)return this._createEncoderBuffer([0,zt]);for(var ir=1,ar=zt;ar>=256;ar>>=8)ir++;for(var dr=new Array(ir),ar=dr.length-1;ar>=0;ar--)dr[ar]=zt&255,zt>>=8;return dr[0]&128&&dr.unshift(0),this._createEncoderBuffer(new e(dr))},jt.prototype._encodeBool=function(zt){return this._createEncoderBuffer(zt?255:0)},jt.prototype._use=function(zt,rr){return typeof zt=="function"&&(zt=zt(rr)),zt._getEncoder("der").tree},jt.prototype._skipDefault=function(zt,rr,nr){var ir=this._baseState,ar;if(ir.default===null)return!1;var dr=zt.join();if(ir.defaultBuffer===void 0&&(ir.defaultBuffer=this._encodeValue(ir.default,rr,nr).join()),dr.length!==ir.defaultBuffer.length)return!1;for(ar=0;ar<dr.length;ar++)if(dr[ar]!==ir.defaultBuffer[ar])return!1;return!0};function er(tr,zt,rr,nr){var ir;if(tr==="seqof"?tr="seq":tr==="setof"&&(tr="set"),Bt.tagByName.hasOwnProperty(tr))ir=Bt.tagByName[tr];else if(typeof tr=="number"&&(tr|0)===tr)ir=tr;else return nr.error("Unknown tag: "+tr);return ir>=31?nr.error("Multi-octet tag encoding unsupported"):(zt||(ir|=32),ir|=Bt.tagClassByName[rr||"universal"]<<6,ir)}return der_1}var pem,hasRequiredPem;function requirePem(){if(hasRequiredPem)return pem;hasRequiredPem=1;var xt=inherits_browserExports,e=requireDer();function At(kt){e.call(this,kt),this.enc="pem"}return xt(At,e),pem=At,At.prototype.encode=function(Bt,Nt){for(var jt=e.prototype.encode.call(this,Bt),Lt=jt.toString("base64"),er=["-----BEGIN "+Nt.label+"-----"],tr=0;tr<Lt.length;tr+=64)er.push(Lt.slice(tr,tr+64));return er.push("-----END "+Nt.label+"-----"),er.join(`
`)},pem}var hasRequiredEncoders;function requireEncoders(){return hasRequiredEncoders||(hasRequiredEncoders=1,function(xt){var e=xt;e.der=requireDer(),e.pem=requirePem()}(encoders)),encoders}var hasRequiredAsn1;function requireAsn1(){return hasRequiredAsn1||(hasRequiredAsn1=1,function(xt){var e=xt;e.bignum=bnExports$1,e.define=requireApi().define,e.base=requireBase(),e.constants=requireConstants(),e.decoders=requireDecoders(),e.encoders=requireEncoders()}(asn1$2)),asn1$2}var asn=requireAsn1(),Time$1=asn.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),AttributeTypeValue=asn.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),AlgorithmIdentifier$1=asn.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())}),SubjectPublicKeyInfo=asn.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(AlgorithmIdentifier$1),this.key("subjectPublicKey").bitstr())}),RelativeDistinguishedName=asn.define("RelativeDistinguishedName",function(){this.setof(AttributeTypeValue)}),RDNSequence=asn.define("RDNSequence",function(){this.seqof(RelativeDistinguishedName)}),Name=asn.define("Name",function(){this.choice({rdnSequence:this.use(RDNSequence)})}),Validity=asn.define("Validity",function(){this.seq().obj(this.key("notBefore").use(Time$1),this.key("notAfter").use(Time$1))}),Extension=asn.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),TBSCertificate=asn.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(AlgorithmIdentifier$1),this.key("issuer").use(Name),this.key("validity").use(Validity),this.key("subject").use(Name),this.key("subjectPublicKeyInfo").use(SubjectPublicKeyInfo),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(Extension).optional())}),X509Certificate=asn.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(TBSCertificate),this.key("signatureAlgorithm").use(AlgorithmIdentifier$1),this.key("signatureValue").bitstr())}),certificate=X509Certificate,asn1$1=requireAsn1();asn1$3.certificate=certificate;var RSAPrivateKey=asn1$1.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});asn1$3.RSAPrivateKey=RSAPrivateKey;var RSAPublicKey=asn1$1.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});asn1$3.RSAPublicKey=RSAPublicKey;var AlgorithmIdentifier=asn1$1.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),PublicKey$2=asn1$1.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(AlgorithmIdentifier),this.key("subjectPublicKey").bitstr())});asn1$3.PublicKey=PublicKey$2;var PrivateKeyInfo=asn1$1.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(AlgorithmIdentifier),this.key("subjectPrivateKey").octstr())});asn1$3.PrivateKey=PrivateKeyInfo;var EncryptedPrivateKeyInfo=asn1$1.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});asn1$3.EncryptedPrivateKey=EncryptedPrivateKeyInfo;var DSAPrivateKey=asn1$1.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});asn1$3.DSAPrivateKey=DSAPrivateKey;asn1$3.DSAparam=asn1$1.define("DSAparam",function(){this.int()});var ECParameters=asn1$1.define("ECParameters",function(){this.choice({namedCurve:this.objid()})}),ECPrivateKey=asn1$1.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(ECParameters),this.key("publicKey").optional().explicit(1).bitstr())});asn1$3.ECPrivateKey=ECPrivateKey;asn1$3.signature=asn1$1.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())});const require$$1$2={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"};var findProc=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,startRegex=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,fullRegex=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,evp=evp_bytestokey,ciphers$1=browser$8,Buffer$c=safeBufferExports$1.Buffer,fixProc$1=function(xt,e){var At=xt.toString(),kt=At.match(findProc),Bt;if(kt){var jt="aes"+kt[1],Lt=Buffer$c.from(kt[2],"hex"),er=Buffer$c.from(kt[3].replace(/[\r\n]/g,""),"base64"),tr=evp(e,Lt.slice(0,8),parseInt(kt[1],10)).key,zt=[],rr=ciphers$1.createDecipheriv(jt,tr,Lt);zt.push(rr.update(er)),zt.push(rr.final()),Bt=Buffer$c.concat(zt)}else{var Nt=At.match(fullRegex);Bt=Buffer$c.from(Nt[2].replace(/[\r\n]/g,""),"base64")}var nr=At.match(startRegex)[1];return{tag:nr,data:Bt}},asn1=asn1$3,aesid=require$$1$2,fixProc=fixProc$1,ciphers=browser$8,compat$1=browser$a,Buffer$b=safeBufferExports$1.Buffer;function decrypt(xt,e){var At=xt.algorithm.decrypt.kde.kdeparams.salt,kt=parseInt(xt.algorithm.decrypt.kde.kdeparams.iters.toString(),10),Bt=aesid[xt.algorithm.decrypt.cipher.algo.join(".")],Nt=xt.algorithm.decrypt.cipher.iv,jt=xt.subjectPrivateKey,Lt=parseInt(Bt.split("-")[1],10)/8,er=compat$1.pbkdf2Sync(e,At,kt,Lt,"sha1"),tr=ciphers.createDecipheriv(Bt,er,Nt),zt=[];return zt.push(tr.update(jt)),zt.push(tr.final()),Buffer$b.concat(zt)}function parseKeys$2(xt){var e;typeof xt=="object"&&!Buffer$b.isBuffer(xt)&&(e=xt.passphrase,xt=xt.key),typeof xt=="string"&&(xt=Buffer$b.from(xt));var At=fixProc(xt,e),kt=At.tag,Bt=At.data,Nt,jt;switch(kt){case"CERTIFICATE":jt=asn1.certificate.decode(Bt,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(jt||(jt=asn1.PublicKey.decode(Bt,"der")),Nt=jt.algorithm.algorithm.join("."),Nt){case"1.2.840.113549.1.1.1":return asn1.RSAPublicKey.decode(jt.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return jt.subjectPrivateKey=jt.subjectPublicKey,{type:"ec",data:jt};case"1.2.840.10040.4.1":return jt.algorithm.params.pub_key=asn1.DSAparam.decode(jt.subjectPublicKey.data,"der"),{type:"dsa",data:jt.algorithm.params};default:throw new Error("unknown key id "+Nt)}case"ENCRYPTED PRIVATE KEY":Bt=asn1.EncryptedPrivateKey.decode(Bt,"der"),Bt=decrypt(Bt,e);case"PRIVATE KEY":switch(jt=asn1.PrivateKey.decode(Bt,"der"),Nt=jt.algorithm.algorithm.join("."),Nt){case"1.2.840.113549.1.1.1":return asn1.RSAPrivateKey.decode(jt.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:jt.algorithm.curve,privateKey:asn1.ECPrivateKey.decode(jt.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return jt.algorithm.params.priv_key=asn1.DSAparam.decode(jt.subjectPrivateKey,"der"),{type:"dsa",params:jt.algorithm.params};default:throw new Error("unknown key id "+Nt)}case"RSA PUBLIC KEY":return asn1.RSAPublicKey.decode(Bt,"der");case"RSA PRIVATE KEY":return asn1.RSAPrivateKey.decode(Bt,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:asn1.DSAPrivateKey.decode(Bt,"der")};case"EC PRIVATE KEY":return Bt=asn1.ECPrivateKey.decode(Bt,"der"),{curve:Bt.parameters.value,privateKey:Bt.privateKey};default:throw new Error("unknown key type "+kt)}}parseKeys$2.signature=asn1.signature;var parseAsn1=parseKeys$2;const require$$4$1={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"};var hasRequiredSign;function requireSign(){if(hasRequiredSign)return sign.exports;hasRequiredSign=1;var xt=safeBufferExports$1.Buffer,e=browser$b,At=browserifyRsa,kt=requireElliptic().ec,Bt=bnExports,Nt=parseAsn1,jt=require$$4$1,Lt=1;function er(fr,pr,lr,yr,br){var Ar=Nt(pr);if(Ar.curve){if(yr!=="ecdsa"&&yr!=="ecdsa/rsa")throw new Error("wrong private key type");return tr(fr,Ar)}else if(Ar.type==="dsa"){if(yr!=="dsa")throw new Error("wrong private key type");return zt(fr,Ar,lr)}if(yr!=="rsa"&&yr!=="ecdsa/rsa")throw new Error("wrong private key type");if(pr.padding!==void 0&&pr.padding!==Lt)throw new Error("illegal or unsupported padding mode");fr=xt.concat([br,fr]);for(var Pr=Ar.modulus.byteLength(),kr=[0,1];fr.length+kr.length+1<Pr;)kr.push(255);kr.push(0);for(var Ur=-1;++Ur<fr.length;)kr.push(fr[Ur]);var Hr=At(kr,Ar);return Hr}function tr(fr,pr){var lr=jt[pr.curve.join(".")];if(!lr)throw new Error("unknown curve "+pr.curve.join("."));var yr=new kt(lr),br=yr.keyFromPrivate(pr.privateKey),Ar=br.sign(fr);return xt.from(Ar.toDER())}function zt(fr,pr,lr){for(var yr=pr.params.priv_key,br=pr.params.p,Ar=pr.params.q,Pr=pr.params.g,kr=new Bt(0),Ur,Hr=ir(fr,Ar).mod(Ar),Lr=!1,Sr=nr(yr,Ar,fr,lr);Lr===!1;)Ur=dr(Ar,Sr,lr),kr=ur(Pr,Ur,br,Ar),Lr=Ur.invm(Ar).imul(Hr.add(yr.mul(kr))).mod(Ar),Lr.cmpn(0)===0&&(Lr=!1,kr=new Bt(0));return rr(kr,Lr)}function rr(fr,pr){fr=fr.toArray(),pr=pr.toArray(),fr[0]&128&&(fr=[0].concat(fr)),pr[0]&128&&(pr=[0].concat(pr));var lr=fr.length+pr.length+4,yr=[48,lr,2,fr.length];return yr=yr.concat(fr,[2,pr.length],pr),xt.from(yr)}function nr(fr,pr,lr,yr){if(fr=xt.from(fr.toArray()),fr.length<pr.byteLength()){var br=xt.alloc(pr.byteLength()-fr.length);fr=xt.concat([br,fr])}var Ar=lr.length,Pr=ar(lr,pr),kr=xt.alloc(Ar);kr.fill(1);var Ur=xt.alloc(Ar);return Ur=e(yr,Ur).update(kr).update(xt.from([0])).update(fr).update(Pr).digest(),kr=e(yr,Ur).update(kr).digest(),Ur=e(yr,Ur).update(kr).update(xt.from([1])).update(fr).update(Pr).digest(),kr=e(yr,Ur).update(kr).digest(),{k:Ur,v:kr}}function ir(fr,pr){var lr=new Bt(fr),yr=(fr.length<<3)-pr.bitLength();return yr>0&&lr.ishrn(yr),lr}function ar(fr,pr){fr=ir(fr,pr),fr=fr.mod(pr);var lr=xt.from(fr.toArray());if(lr.length<pr.byteLength()){var yr=xt.alloc(pr.byteLength()-lr.length);lr=xt.concat([yr,lr])}return lr}function dr(fr,pr,lr){var yr,br;do{for(yr=xt.alloc(0);yr.length*8<fr.bitLength();)pr.v=e(lr,pr.k).update(pr.v).digest(),yr=xt.concat([yr,pr.v]);br=ir(yr,fr),pr.k=e(lr,pr.k).update(pr.v).update(xt.from([0])).digest(),pr.v=e(lr,pr.k).update(pr.v).digest()}while(br.cmp(fr)!==-1);return br}function ur(fr,pr,lr,yr){return fr.toRed(Bt.mont(lr)).redPow(pr).fromRed().mod(yr)}return sign.exports=er,sign.exports.getKey=nr,sign.exports.makeKey=dr,sign.exports}var verify_1,hasRequiredVerify;function requireVerify(){if(hasRequiredVerify)return verify_1;hasRequiredVerify=1;var xt=safeBufferExports$1.Buffer,e=bnExports,At=requireElliptic().ec,kt=parseAsn1,Bt=require$$4$1;function Nt(tr,zt,rr,nr,ir){var ar=kt(rr);if(ar.type==="ec"){if(nr!=="ecdsa"&&nr!=="ecdsa/rsa")throw new Error("wrong public key type");return jt(tr,zt,ar)}else if(ar.type==="dsa"){if(nr!=="dsa")throw new Error("wrong public key type");return Lt(tr,zt,ar)}if(nr!=="rsa"&&nr!=="ecdsa/rsa")throw new Error("wrong public key type");zt=xt.concat([ir,zt]);for(var dr=ar.modulus.byteLength(),ur=[1],fr=0;zt.length+ur.length+2<dr;)ur.push(255),fr+=1;ur.push(0);for(var pr=-1;++pr<zt.length;)ur.push(zt[pr]);ur=xt.from(ur);var lr=e.mont(ar.modulus);tr=new e(tr).toRed(lr),tr=tr.redPow(new e(ar.publicExponent)),tr=xt.from(tr.fromRed().toArray());var yr=fr<8?1:0;for(dr=Math.min(tr.length,ur.length),tr.length!==ur.length&&(yr=1),pr=-1;++pr<dr;)yr|=tr[pr]^ur[pr];return yr===0}function jt(tr,zt,rr){var nr=Bt[rr.data.algorithm.curve.join(".")];if(!nr)throw new Error("unknown curve "+rr.data.algorithm.curve.join("."));var ir=new At(nr),ar=rr.data.subjectPrivateKey.data;return ir.verify(zt,tr,ar)}function Lt(tr,zt,rr){var nr=rr.data.p,ir=rr.data.q,ar=rr.data.g,dr=rr.data.pub_key,ur=kt.signature.decode(tr,"der"),fr=ur.s,pr=ur.r;er(fr,ir),er(pr,ir);var lr=e.mont(nr),yr=fr.invm(ir),br=ar.toRed(lr).redPow(new e(zt).mul(yr).mod(ir)).fromRed().mul(dr.toRed(lr).redPow(pr.mul(yr).mod(ir)).fromRed()).mod(nr).mod(ir);return br.cmp(pr)===0}function er(tr,zt){if(tr.cmpn(0)<=0)throw new Error("invalid sig");if(tr.cmp(zt)>=0)throw new Error("invalid sig")}return verify_1=Nt,verify_1}var browser$6,hasRequiredBrowser$2;function requireBrowser$2(){if(hasRequiredBrowser$2)return browser$6;hasRequiredBrowser$2=1;var xt=safeBufferExports$1.Buffer,e=browser$c,At=readableBrowserExports,kt=inherits_browserExports,Bt=requireSign(),Nt=requireVerify(),jt=require$$6$1;Object.keys(jt).forEach(function(rr){jt[rr].id=xt.from(jt[rr].id,"hex"),jt[rr.toLowerCase()]=jt[rr]});function Lt(rr){At.Writable.call(this);var nr=jt[rr];if(!nr)throw new Error("Unknown message digest");this._hashType=nr.hash,this._hash=e(nr.hash),this._tag=nr.id,this._signType=nr.sign}kt(Lt,At.Writable),Lt.prototype._write=function(nr,ir,ar){this._hash.update(nr),ar()},Lt.prototype.update=function(nr,ir){return this._hash.update(typeof nr=="string"?xt.from(nr,ir):nr),this},Lt.prototype.sign=function(nr,ir){this.end();var ar=this._hash.digest(),dr=Bt(ar,nr,this._hashType,this._signType,this._tag);return ir?dr.toString(ir):dr};function er(rr){At.Writable.call(this);var nr=jt[rr];if(!nr)throw new Error("Unknown message digest");this._hash=e(nr.hash),this._tag=nr.id,this._signType=nr.sign}kt(er,At.Writable),er.prototype._write=function(nr,ir,ar){this._hash.update(nr),ar()},er.prototype.update=function(nr,ir){return this._hash.update(typeof nr=="string"?xt.from(nr,ir):nr),this},er.prototype.verify=function(nr,ir,ar){var dr=typeof ir=="string"?xt.from(ir,ar):ir;this.end();var ur=this._hash.digest();return Nt(dr,ur,nr,this._signType,this._tag)};function tr(rr){return new Lt(rr)}function zt(rr){return new er(rr)}return browser$6={Sign:tr,Verify:zt,createSign:tr,createVerify:zt},browser$6}var browser$5,hasRequiredBrowser$1;function requireBrowser$1(){if(hasRequiredBrowser$1)return browser$5;hasRequiredBrowser$1=1;var xt=requireElliptic(),e=bnExports$1;browser$5=function(jt){return new kt(jt)};var At={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};At.p224=At.secp224r1,At.p256=At.secp256r1=At.prime256v1,At.p192=At.secp192r1=At.prime192v1,At.p384=At.secp384r1,At.p521=At.secp521r1;function kt(Nt){this.curveType=At[Nt],this.curveType||(this.curveType={name:Nt}),this.curve=new xt.ec(this.curveType.name),this.keys=void 0}kt.prototype.generateKeys=function(Nt,jt){return this.keys=this.curve.genKeyPair(),this.getPublicKey(Nt,jt)},kt.prototype.computeSecret=function(Nt,jt,Lt){jt=jt||"utf8",buffer$2.Buffer.isBuffer(Nt)||(Nt=new buffer$2.Buffer(Nt,jt));var er=this.curve.keyFromPublic(Nt).getPublic(),tr=er.mul(this.keys.getPrivate()).getX();return Bt(tr,Lt,this.curveType.byteLength)},kt.prototype.getPublicKey=function(Nt,jt){var Lt=this.keys.getPublic(jt==="compressed",!0);return jt==="hybrid"&&(Lt[Lt.length-1]%2?Lt[0]=7:Lt[0]=6),Bt(Lt,Nt)},kt.prototype.getPrivateKey=function(Nt){return Bt(this.keys.getPrivate(),Nt)},kt.prototype.setPublicKey=function(Nt,jt){return jt=jt||"utf8",buffer$2.Buffer.isBuffer(Nt)||(Nt=new buffer$2.Buffer(Nt,jt)),this.keys._importPublic(Nt),this},kt.prototype.setPrivateKey=function(Nt,jt){jt=jt||"utf8",buffer$2.Buffer.isBuffer(Nt)||(Nt=new buffer$2.Buffer(Nt,jt));var Lt=new e(Nt);return Lt=Lt.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(Lt),this};function Bt(Nt,jt,Lt){Array.isArray(Nt)||(Nt=Nt.toArray());var er=new buffer$2.Buffer(Nt);if(Lt&&er.length<Lt){var tr=new buffer$2.Buffer(Lt-er.length);tr.fill(0),er=buffer$2.Buffer.concat([tr,er])}return jt?er.toString(jt):er}return browser$5}var browser$4={},createHash$2=browser$c,Buffer$a=safeBufferExports$1.Buffer,mgf$2=function(xt,e){for(var At=Buffer$a.alloc(0),kt=0,Bt;At.length<e;)Bt=i2ops(kt++),At=Buffer$a.concat([At,createHash$2("sha1").update(xt).update(Bt).digest()]);return At.slice(0,e)};function i2ops(xt){var e=Buffer$a.allocUnsafe(4);return e.writeUInt32BE(xt,0),e}var xor$2=function xt(e,At){for(var kt=e.length,Bt=-1;++Bt<kt;)e[Bt]^=At[Bt];return e},BN$2=bnExports$1,Buffer$9=safeBufferExports$1.Buffer;function withPublic$2(xt,e){return Buffer$9.from(xt.toRed(BN$2.mont(e.modulus)).redPow(new BN$2(e.publicExponent)).fromRed().toArray())}var withPublic_1=withPublic$2,parseKeys$1=parseAsn1,randomBytes$4=browserExports$2,createHash$1=browser$c,mgf$1=mgf$2,xor$1=xor$2,BN$1=bnExports$1,withPublic$1=withPublic_1,crt$1=browserifyRsa,Buffer$8=safeBufferExports$1.Buffer,publicEncrypt=function xt(e,At,kt){var Bt;e.padding?Bt=e.padding:kt?Bt=1:Bt=4;var Nt=parseKeys$1(e),jt;if(Bt===4)jt=oaep$1(Nt,At);else if(Bt===1)jt=pkcs1$1(Nt,At,kt);else if(Bt===3){if(jt=new BN$1(At),jt.cmp(Nt.modulus)>=0)throw new Error("data too long for modulus")}else throw new Error("unknown padding");return kt?crt$1(jt,Nt):withPublic$1(jt,Nt)};function oaep$1(xt,e){var At=xt.modulus.byteLength(),kt=e.length,Bt=createHash$1("sha1").update(Buffer$8.alloc(0)).digest(),Nt=Bt.length,jt=2*Nt;if(kt>At-jt-2)throw new Error("message too long");var Lt=Buffer$8.alloc(At-kt-jt-2),er=At-Nt-1,tr=randomBytes$4(Nt),zt=xor$1(Buffer$8.concat([Bt,Lt,Buffer$8.alloc(1,1),e],er),mgf$1(tr,er)),rr=xor$1(tr,mgf$1(zt,Nt));return new BN$1(Buffer$8.concat([Buffer$8.alloc(1),rr,zt],At))}function pkcs1$1(xt,e,At){var kt=e.length,Bt=xt.modulus.byteLength();if(kt>Bt-11)throw new Error("message too long");var Nt;return At?Nt=Buffer$8.alloc(Bt-kt-3,255):Nt=nonZero(Bt-kt-3),new BN$1(Buffer$8.concat([Buffer$8.from([0,At?1:2]),Nt,Buffer$8.alloc(1),e],Bt))}function nonZero(xt){for(var e=Buffer$8.allocUnsafe(xt),At=0,kt=randomBytes$4(xt*2),Bt=0,Nt;At<xt;)Bt===kt.length&&(kt=randomBytes$4(xt*2),Bt=0),Nt=kt[Bt++],Nt&&(e[At++]=Nt);return e}var parseKeys=parseAsn1,mgf=mgf$2,xor=xor$2,BN=bnExports$1,crt=browserifyRsa,createHash=browser$c,withPublic=withPublic_1,Buffer$7=safeBufferExports$1.Buffer,privateDecrypt=function xt(e,At,kt){var Bt;e.padding?Bt=e.padding:kt?Bt=1:Bt=4;var Nt=parseKeys(e),jt=Nt.modulus.byteLength();if(At.length>jt||new BN(At).cmp(Nt.modulus)>=0)throw new Error("decryption error");var Lt;kt?Lt=withPublic(new BN(At),Nt):Lt=crt(At,Nt);var er=Buffer$7.alloc(jt-Lt.length);if(Lt=Buffer$7.concat([er,Lt],jt),Bt===4)return oaep(Nt,Lt);if(Bt===1)return pkcs1(Nt,Lt,kt);if(Bt===3)return Lt;throw new Error("unknown padding")};function oaep(xt,e){var At=xt.modulus.byteLength(),kt=createHash("sha1").update(Buffer$7.alloc(0)).digest(),Bt=kt.length;if(e[0]!==0)throw new Error("decryption error");var Nt=e.slice(1,Bt+1),jt=e.slice(Bt+1),Lt=xor(Nt,mgf(jt,Bt)),er=xor(jt,mgf(Lt,At-Bt-1));if(compare(kt,er.slice(0,Bt)))throw new Error("decryption error");for(var tr=Bt;er[tr]===0;)tr++;if(er[tr++]!==1)throw new Error("decryption error");return er.slice(tr)}function pkcs1(xt,e,At){for(var kt=e.slice(0,2),Bt=2,Nt=0;e[Bt++]!==0;)if(Bt>=e.length){Nt++;break}var jt=e.slice(2,Bt-1);if((kt.toString("hex")!=="0002"&&!At||kt.toString("hex")!=="0001"&&At)&&Nt++,jt.length<8&&Nt++,Nt)throw new Error("decryption error");return e.slice(Bt)}function compare(xt,e){xt=Buffer$7.from(xt),e=Buffer$7.from(e);var At=0,kt=xt.length;xt.length!==e.length&&(At++,kt=Math.min(xt.length,e.length));for(var Bt=-1;++Bt<kt;)At+=xt[Bt]^e[Bt];return At}(function(xt){xt.publicEncrypt=publicEncrypt,xt.privateDecrypt=privateDecrypt,xt.privateEncrypt=function(At,kt){return xt.publicEncrypt(At,kt,!0)},xt.publicDecrypt=function(At,kt){return xt.privateDecrypt(At,kt,!0)}})(browser$4);var browser$3={};function oldBrowser(){throw new Error(`secure random number generation not supported by this browser
use chrome, FireFox or Internet Explorer 11`)}var safeBuffer=safeBufferExports$1,randombytes=browserExports$2,Buffer$6=safeBuffer.Buffer,kBufferMaxLength=safeBuffer.kMaxLength,crypto$5=globalThis.crypto||globalThis.msCrypto,kMaxUint32=Math.pow(2,32)-1;function assertOffset(xt,e){if(typeof xt!="number"||xt!==xt)throw new TypeError("offset must be a number");if(xt>kMaxUint32||xt<0)throw new TypeError("offset must be a uint32");if(xt>kBufferMaxLength||xt>e)throw new RangeError("offset out of range")}function assertSize(xt,e,At){if(typeof xt!="number"||xt!==xt)throw new TypeError("size must be a number");if(xt>kMaxUint32||xt<0)throw new TypeError("size must be a uint32");if(xt+e>At||xt>kBufferMaxLength)throw new RangeError("buffer too small")}crypto$5&&crypto$5.getRandomValues||!process$9.browser?(browser$3.randomFill=randomFill,browser$3.randomFillSync=randomFillSync):(browser$3.randomFill=oldBrowser,browser$3.randomFillSync=oldBrowser);function randomFill(xt,e,At,kt){if(!Buffer$6.isBuffer(xt)&&!(xt instanceof globalThis.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if(typeof e=="function")kt=e,e=0,At=xt.length;else if(typeof At=="function")kt=At,At=xt.length-e;else if(typeof kt!="function")throw new TypeError('"cb" argument must be a function');return assertOffset(e,xt.length),assertSize(At,e,xt.length),actualFill(xt,e,At,kt)}function actualFill(xt,e,At,kt){if(process$9.browser){var Bt=xt.buffer,Nt=new Uint8Array(Bt,e,At);if(crypto$5.getRandomValues(Nt),kt){process$9.nextTick(function(){kt(null,xt)});return}return xt}if(kt){randombytes(At,function(Lt,er){if(Lt)return kt(Lt);er.copy(xt,e),kt(null,xt)});return}var jt=randombytes(At);return jt.copy(xt,e),xt}function randomFillSync(xt,e,At){if(typeof e>"u"&&(e=0),!Buffer$6.isBuffer(xt)&&!(xt instanceof globalThis.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return assertOffset(e,xt.length),At===void 0&&(At=xt.length-e),assertSize(At,e,xt.length),actualFill(xt,e,At)}var hasRequiredCryptoBrowserify;function requireCryptoBrowserify(){if(hasRequiredCryptoBrowserify)return cryptoBrowserify;hasRequiredCryptoBrowserify=1,cryptoBrowserify.randomBytes=cryptoBrowserify.rng=cryptoBrowserify.pseudoRandomBytes=cryptoBrowserify.prng=browserExports$2,cryptoBrowserify.createHash=cryptoBrowserify.Hash=browser$c,cryptoBrowserify.createHmac=cryptoBrowserify.Hmac=browser$b;var xt=algos,e=Object.keys(xt),At=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(e);cryptoBrowserify.getHashes=function(){return At};var kt=browser$a;cryptoBrowserify.pbkdf2=kt.pbkdf2,cryptoBrowserify.pbkdf2Sync=kt.pbkdf2Sync;var Bt=browser$9;cryptoBrowserify.Cipher=Bt.Cipher,cryptoBrowserify.createCipher=Bt.createCipher,cryptoBrowserify.Cipheriv=Bt.Cipheriv,cryptoBrowserify.createCipheriv=Bt.createCipheriv,cryptoBrowserify.Decipher=Bt.Decipher,cryptoBrowserify.createDecipher=Bt.createDecipher,cryptoBrowserify.Decipheriv=Bt.Decipheriv,cryptoBrowserify.createDecipheriv=Bt.createDecipheriv,cryptoBrowserify.getCiphers=Bt.getCiphers,cryptoBrowserify.listCiphers=Bt.listCiphers;var Nt=requireBrowser$3();cryptoBrowserify.DiffieHellmanGroup=Nt.DiffieHellmanGroup,cryptoBrowserify.createDiffieHellmanGroup=Nt.createDiffieHellmanGroup,cryptoBrowserify.getDiffieHellman=Nt.getDiffieHellman,cryptoBrowserify.createDiffieHellman=Nt.createDiffieHellman,cryptoBrowserify.DiffieHellman=Nt.DiffieHellman;var jt=requireBrowser$2();cryptoBrowserify.createSign=jt.createSign,cryptoBrowserify.Sign=jt.Sign,cryptoBrowserify.createVerify=jt.createVerify,cryptoBrowserify.Verify=jt.Verify,cryptoBrowserify.createECDH=requireBrowser$1();var Lt=browser$4;cryptoBrowserify.publicEncrypt=Lt.publicEncrypt,cryptoBrowserify.privateEncrypt=Lt.privateEncrypt,cryptoBrowserify.publicDecrypt=Lt.publicDecrypt,cryptoBrowserify.privateDecrypt=Lt.privateDecrypt;var er=browser$3;return cryptoBrowserify.randomFill=er.randomFill,cryptoBrowserify.randomFillSync=er.randomFillSync,cryptoBrowserify.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join(`
`))},cryptoBrowserify.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6},cryptoBrowserify}var cryptoBrowserifyExports=requireCryptoBrowserify(),dist={},utils$7={};(function(xt){/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */Object.defineProperty(xt,"__esModule",{value:!0}),xt.setBigUint64=xt.Hash=xt.equalBytes=xt.ensureBytes=xt.checkOpts=xt.concatBytes=xt.toBytes=xt.bytesToUtf8=xt.utf8ToBytes=xt.asyncLoop=xt.nextTick=xt.hexToBytes=xt.bytesToHex=xt.isLE=xt.createView=xt.u32=xt.u16=xt.u8=void 0;const e=br=>br instanceof Uint8Array,At=br=>new Uint8Array(br.buffer,br.byteOffset,br.byteLength);xt.u8=At;const kt=br=>new Uint16Array(br.buffer,br.byteOffset,Math.floor(br.byteLength/2));xt.u16=kt;const Bt=br=>new Uint32Array(br.buffer,br.byteOffset,Math.floor(br.byteLength/4));xt.u32=Bt;const Nt=br=>new DataView(br.buffer,br.byteOffset,br.byteLength);if(xt.createView=Nt,xt.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68,!xt.isLE)throw new Error("Non little-endian hardware is not supported");const jt=Array.from({length:256},(br,Ar)=>Ar.toString(16).padStart(2,"0"));function Lt(br){if(!e(br))throw new Error("Uint8Array expected");let Ar="";for(let Pr=0;Pr<br.length;Pr++)Ar+=jt[br[Pr]];return Ar}xt.bytesToHex=Lt;function er(br){if(typeof br!="string")throw new Error("hex string expected, got "+typeof br);const Ar=br.length;if(Ar%2)throw new Error("padded hex string expected, got unpadded hex of length "+Ar);const Pr=new Uint8Array(Ar/2);for(let kr=0;kr<Pr.length;kr++){const Ur=kr*2,Hr=br.slice(Ur,Ur+2),Lr=Number.parseInt(Hr,16);if(Number.isNaN(Lr)||Lr<0)throw new Error("Invalid byte sequence");Pr[kr]=Lr}return Pr}xt.hexToBytes=er;const tr=async()=>{};xt.nextTick=tr;async function zt(br,Ar,Pr){let kr=Date.now();for(let Ur=0;Ur<br;Ur++){Pr(Ur);const Hr=Date.now()-kr;Hr>=0&&Hr<Ar||(await(0,xt.nextTick)(),kr+=Hr)}}xt.asyncLoop=zt;function rr(br){if(typeof br!="string")throw new Error(`utf8ToBytes expected string, got ${typeof br}`);return new Uint8Array(new TextEncoder().encode(br))}xt.utf8ToBytes=rr;function nr(br){return new TextDecoder().decode(br)}xt.bytesToUtf8=nr;function ir(br){if(typeof br=="string"&&(br=rr(br)),!e(br))throw new Error(`expected Uint8Array, got ${typeof br}`);return br}xt.toBytes=ir;function ar(...br){const Ar=new Uint8Array(br.reduce((kr,Ur)=>kr+Ur.length,0));let Pr=0;return br.forEach(kr=>{if(!e(kr))throw new Error("Uint8Array expected");Ar.set(kr,Pr),Pr+=kr.length}),Ar}xt.concatBytes=ar;const dr=br=>Object.prototype.toString.call(br)==="[object Object]"&&br.constructor===Object;function ur(br,Ar){if(Ar!==void 0&&(typeof Ar!="object"||!dr(Ar)))throw new Error("options must be object or undefined");return Object.assign(br,Ar)}xt.checkOpts=ur;function fr(br,Ar){if(!(br instanceof Uint8Array))throw new Error("Uint8Array expected");if(typeof Ar=="number"&&br.length!==Ar)throw new Error(`Uint8Array length ${Ar} expected`)}xt.ensureBytes=fr;function pr(br,Ar){if(br.length!==Ar.length)throw new Error("equalBytes: Different size of Uint8Arrays");let Pr=!0;for(let kr=0;kr<br.length;kr++)Pr&&(Pr=br[kr]===Ar[kr]);return Pr}xt.equalBytes=pr;class lr{}xt.Hash=lr;function yr(br,Ar,Pr,kr){if(typeof br.setBigUint64=="function")return br.setBigUint64(Ar,Pr,kr);const Ur=BigInt(32),Hr=BigInt(4294967295),Lr=Number(Pr>>Ur&Hr),Sr=Number(Pr&Hr),_r=kr?4:0,gr=kr?0:4;br.setUint32(Ar+_r,Lr,kr),br.setUint32(Ar+gr,Sr,kr)}xt.setBigUint64=yr})(utils$7);var config={},consts={};Object.defineProperty(consts,"__esModule",{value:!0});consts.AEAD_TAG_LENGTH=consts.XCHACHA20_NONCE_LENGTH=consts.CURVE25519_PUBLIC_KEY_SIZE=consts.ETH_PUBLIC_KEY_SIZE=consts.UNCOMPRESSED_PUBLIC_KEY_SIZE=consts.COMPRESSED_PUBLIC_KEY_SIZE=consts.SECRET_KEY_LENGTH=void 0;consts.SECRET_KEY_LENGTH=32;consts.COMPRESSED_PUBLIC_KEY_SIZE=33;consts.UNCOMPRESSED_PUBLIC_KEY_SIZE=65;consts.ETH_PUBLIC_KEY_SIZE=64;consts.CURVE25519_PUBLIC_KEY_SIZE=32;consts.XCHACHA20_NONCE_LENGTH=24;consts.AEAD_TAG_LENGTH=16;(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.ephemeralKeySize=xt.symmetricNonceLength=xt.symmetricAlgorithm=xt.isHkdfKeyCompressed=xt.isEphemeralKeyCompressed=xt.ellipticCurve=xt.ECIES_CONFIG=void 0;var e=consts,At=function(){function tr(){this.ellipticCurve="secp256k1",this.isEphemeralKeyCompressed=!1,this.isHkdfKeyCompressed=!1,this.symmetricAlgorithm="aes-256-gcm",this.symmetricNonceLength=16}return tr}();xt.ECIES_CONFIG=new At;var kt=function(){return xt.ECIES_CONFIG.ellipticCurve};xt.ellipticCurve=kt;var Bt=function(){return xt.ECIES_CONFIG.isEphemeralKeyCompressed};xt.isEphemeralKeyCompressed=Bt;var Nt=function(){return xt.ECIES_CONFIG.isHkdfKeyCompressed};xt.isHkdfKeyCompressed=Nt;var jt=function(){return xt.ECIES_CONFIG.symmetricAlgorithm};xt.symmetricAlgorithm=jt;var Lt=function(){return xt.ECIES_CONFIG.symmetricNonceLength};xt.symmetricNonceLength=Lt;var er=function(){var tr={secp256k1:xt.ECIES_CONFIG.isEphemeralKeyCompressed?e.COMPRESSED_PUBLIC_KEY_SIZE:e.UNCOMPRESSED_PUBLIC_KEY_SIZE,x25519:e.CURVE25519_PUBLIC_KEY_SIZE,ed25519:e.CURVE25519_PUBLIC_KEY_SIZE};if(xt.ECIES_CONFIG.ellipticCurve in tr)return tr[xt.ECIES_CONFIG.ellipticCurve];throw new Error("Not implemented")};xt.ephemeralKeySize=er})(config);var keys={},PrivateKey$1={},utils$6={},elliptic={},utils$5={},crypto$4={};Object.defineProperty(crypto$4,"__esModule",{value:!0});crypto$4.crypto=void 0;crypto$4.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;Object.defineProperty(utils$5,"__esModule",{value:!0});utils$5.getWebcryptoSubtle=utils$5.randomBytes=void 0;const crypto_1$1=crypto$4;function randomBytes$3(xt=32){if(crypto_1$1.crypto&&typeof crypto_1$1.crypto.getRandomValues=="function")return crypto_1$1.crypto.getRandomValues(new Uint8Array(xt));throw new Error("crypto.getRandomValues must be defined")}utils$5.randomBytes=randomBytes$3;function getWebcryptoSubtle$1(){if(crypto_1$1.crypto&&typeof crypto_1$1.crypto.subtle=="object"&&crypto_1$1.crypto.subtle!=null)return crypto_1$1.crypto.subtle;throw new Error("crypto.subtle must be defined")}utils$5.getWebcryptoSubtle=getWebcryptoSubtle$1;var ed25519$1={},sha512$1={},_md={},_assert$1={};Object.defineProperty(_assert$1,"__esModule",{value:!0});_assert$1.output=_assert$1.exists=_assert$1.hash=_assert$1.bytes=_assert$1.bool=_assert$1.number=_assert$1.isBytes=void 0;function number$3(xt){if(!Number.isSafeInteger(xt)||xt<0)throw new Error(`positive integer expected, not ${xt}`)}_assert$1.number=number$3;function bool$2(xt){if(typeof xt!="boolean")throw new Error(`boolean expected, not ${xt}`)}_assert$1.bool=bool$2;function isBytes$8(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}_assert$1.isBytes=isBytes$8;function bytes$4(xt,...e){if(!isBytes$8(xt))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(xt.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${xt.length}`)}_assert$1.bytes=bytes$4;function hash$2(xt){if(typeof xt!="function"||typeof xt.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$3(xt.outputLen),number$3(xt.blockLen)}_assert$1.hash=hash$2;function exists$4(xt,e=!0){if(xt.destroyed)throw new Error("Hash instance has been destroyed");if(e&&xt.finished)throw new Error("Hash#digest() has already been called")}_assert$1.exists=exists$4;function output$4(xt,e){bytes$4(xt);const At=e.outputLen;if(xt.length<At)throw new Error(`digestInto() expects output buffer of length at least ${At}`)}_assert$1.output=output$4;const assert$3={number:number$3,bool:bool$2,bytes:bytes$4,hash:hash$2,exists:exists$4,output:output$4};_assert$1.default=assert$3;var utils$4={},crypto$3={};Object.defineProperty(crypto$3,"__esModule",{value:!0});crypto$3.crypto=void 0;crypto$3.crypto=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;(function(xt){/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(xt,"__esModule",{value:!0}),xt.randomBytes=xt.wrapXOFConstructorWithOpts=xt.wrapConstructorWithOpts=xt.wrapConstructor=xt.checkOpts=xt.Hash=xt.concatBytes=xt.toBytes=xt.utf8ToBytes=xt.asyncLoop=xt.nextTick=xt.hexToBytes=xt.bytesToHex=xt.byteSwap32=xt.byteSwapIfBE=xt.byteSwap=xt.isLE=xt.rotl=xt.rotr=xt.createView=xt.u32=xt.u8=xt.isBytes=void 0;const e=crypto$3,At=_assert$1;function kt(Sr){return Sr instanceof Uint8Array||Sr!=null&&typeof Sr=="object"&&Sr.constructor.name==="Uint8Array"}xt.isBytes=kt;const Bt=Sr=>new Uint8Array(Sr.buffer,Sr.byteOffset,Sr.byteLength);xt.u8=Bt;const Nt=Sr=>new Uint32Array(Sr.buffer,Sr.byteOffset,Math.floor(Sr.byteLength/4));xt.u32=Nt;const jt=Sr=>new DataView(Sr.buffer,Sr.byteOffset,Sr.byteLength);xt.createView=jt;const Lt=(Sr,_r)=>Sr<<32-_r|Sr>>>_r;xt.rotr=Lt;const er=(Sr,_r)=>Sr<<_r|Sr>>>32-_r>>>0;xt.rotl=er,xt.isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;const tr=Sr=>Sr<<24&4278190080|Sr<<8&16711680|Sr>>>8&65280|Sr>>>24&255;xt.byteSwap=tr,xt.byteSwapIfBE=xt.isLE?Sr=>Sr:Sr=>(0,xt.byteSwap)(Sr);function zt(Sr){for(let _r=0;_r<Sr.length;_r++)Sr[_r]=(0,xt.byteSwap)(Sr[_r])}xt.byteSwap32=zt;const rr=Array.from({length:256},(Sr,_r)=>_r.toString(16).padStart(2,"0"));function nr(Sr){(0,At.bytes)(Sr);let _r="";for(let gr=0;gr<Sr.length;gr++)_r+=rr[Sr[gr]];return _r}xt.bytesToHex=nr;const ir={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function ar(Sr){if(Sr>=ir._0&&Sr<=ir._9)return Sr-ir._0;if(Sr>=ir._A&&Sr<=ir._F)return Sr-(ir._A-10);if(Sr>=ir._a&&Sr<=ir._f)return Sr-(ir._a-10)}function dr(Sr){if(typeof Sr!="string")throw new Error("hex string expected, got "+typeof Sr);const _r=Sr.length,gr=_r/2;if(_r%2)throw new Error("padded hex string expected, got unpadded hex of length "+_r);const wr=new Uint8Array(gr);for(let Dr=0,xr=0;Dr<gr;Dr++,xr+=2){const Ir=ar(Sr.charCodeAt(xr)),$r=ar(Sr.charCodeAt(xr+1));if(Ir===void 0||$r===void 0){const vr=Sr[xr]+Sr[xr+1];throw new Error('hex string expected, got non-hex character "'+vr+'" at index '+xr)}wr[Dr]=Ir*16+$r}return wr}xt.hexToBytes=dr;const ur=async()=>{};xt.nextTick=ur;async function fr(Sr,_r,gr){let wr=Date.now();for(let Dr=0;Dr<Sr;Dr++){gr(Dr);const xr=Date.now()-wr;xr>=0&&xr<_r||(await(0,xt.nextTick)(),wr+=xr)}}xt.asyncLoop=fr;function pr(Sr){if(typeof Sr!="string")throw new Error(`utf8ToBytes expected string, got ${typeof Sr}`);return new Uint8Array(new TextEncoder().encode(Sr))}xt.utf8ToBytes=pr;function lr(Sr){return typeof Sr=="string"&&(Sr=pr(Sr)),(0,At.bytes)(Sr),Sr}xt.toBytes=lr;function yr(...Sr){let _r=0;for(let wr=0;wr<Sr.length;wr++){const Dr=Sr[wr];(0,At.bytes)(Dr),_r+=Dr.length}const gr=new Uint8Array(_r);for(let wr=0,Dr=0;wr<Sr.length;wr++){const xr=Sr[wr];gr.set(xr,Dr),Dr+=xr.length}return gr}xt.concatBytes=yr;class br{clone(){return this._cloneInto()}}xt.Hash=br;const Ar={}.toString;function Pr(Sr,_r){if(_r!==void 0&&Ar.call(_r)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(Sr,_r)}xt.checkOpts=Pr;function kr(Sr){const _r=wr=>Sr().update(lr(wr)).digest(),gr=Sr();return _r.outputLen=gr.outputLen,_r.blockLen=gr.blockLen,_r.create=()=>Sr(),_r}xt.wrapConstructor=kr;function Ur(Sr){const _r=(wr,Dr)=>Sr(Dr).update(lr(wr)).digest(),gr=Sr({});return _r.outputLen=gr.outputLen,_r.blockLen=gr.blockLen,_r.create=wr=>Sr(wr),_r}xt.wrapConstructorWithOpts=Ur;function Hr(Sr){const _r=(wr,Dr)=>Sr(Dr).update(lr(wr)).digest(),gr=Sr({});return _r.outputLen=gr.outputLen,_r.blockLen=gr.blockLen,_r.create=wr=>Sr(wr),_r}xt.wrapXOFConstructorWithOpts=Hr;function Lr(Sr=32){if(e.crypto&&typeof e.crypto.getRandomValues=="function")return e.crypto.getRandomValues(new Uint8Array(Sr));throw new Error("crypto.getRandomValues must be defined")}xt.randomBytes=Lr})(utils$4);Object.defineProperty(_md,"__esModule",{value:!0});_md.HashMD=_md.Maj=_md.Chi=void 0;const _assert_js_1$3=_assert$1,utils_js_1$a=utils$4;function setBigUint64$2(xt,e,At,kt){if(typeof xt.setBigUint64=="function")return xt.setBigUint64(e,At,kt);const Bt=BigInt(32),Nt=BigInt(4294967295),jt=Number(At>>Bt&Nt),Lt=Number(At&Nt),er=kt?4:0,tr=kt?0:4;xt.setUint32(e+er,jt,kt),xt.setUint32(e+tr,Lt,kt)}const Chi$1=(xt,e,At)=>xt&e^~xt&At;_md.Chi=Chi$1;const Maj$1=(xt,e,At)=>xt&e^xt&At^e&At;_md.Maj=Maj$1;class HashMD extends utils_js_1$a.Hash{constructor(e,At,kt,Bt){super(),this.blockLen=e,this.outputLen=At,this.padOffset=kt,this.isLE=Bt,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=(0,utils_js_1$a.createView)(this.buffer)}update(e){(0,_assert_js_1$3.exists)(this);const{view:At,buffer:kt,blockLen:Bt}=this;e=(0,utils_js_1$a.toBytes)(e);const Nt=e.length;for(let jt=0;jt<Nt;){const Lt=Math.min(Bt-this.pos,Nt-jt);if(Lt===Bt){const er=(0,utils_js_1$a.createView)(e);for(;Bt<=Nt-jt;jt+=Bt)this.process(er,jt);continue}kt.set(e.subarray(jt,jt+Lt),this.pos),this.pos+=Lt,jt+=Lt,this.pos===Bt&&(this.process(At,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){(0,_assert_js_1$3.exists)(this),(0,_assert_js_1$3.output)(e,this),this.finished=!0;const{buffer:At,view:kt,blockLen:Bt,isLE:Nt}=this;let{pos:jt}=this;At[jt++]=128,this.buffer.subarray(jt).fill(0),this.padOffset>Bt-jt&&(this.process(kt,0),jt=0);for(let rr=jt;rr<Bt;rr++)At[rr]=0;setBigUint64$2(kt,Bt-8,BigInt(this.length*8),Nt),this.process(kt,0);const Lt=(0,utils_js_1$a.createView)(e),er=this.outputLen;if(er%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const tr=er/4,zt=this.get();if(tr>zt.length)throw new Error("_sha2: outputLen bigger than state");for(let rr=0;rr<tr;rr++)Lt.setUint32(4*rr,zt[rr],Nt)}digest(){const{buffer:e,outputLen:At}=this;this.digestInto(e);const kt=e.slice(0,At);return this.destroy(),kt}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:At,buffer:kt,length:Bt,finished:Nt,destroyed:jt,pos:Lt}=this;return e.length=Bt,e.pos=Lt,e.finished=Nt,e.destroyed=jt,Bt%At&&e.buffer.set(kt),e}}_md.HashMD=HashMD;var _u64={};Object.defineProperty(_u64,"__esModule",{value:!0});_u64.add5L=_u64.add5H=_u64.add4H=_u64.add4L=_u64.add3H=_u64.add3L=_u64.add=_u64.rotlBL=_u64.rotlBH=_u64.rotlSL=_u64.rotlSH=_u64.rotr32L=_u64.rotr32H=_u64.rotrBL=_u64.rotrBH=_u64.rotrSL=_u64.rotrSH=_u64.shrSL=_u64.shrSH=_u64.toBig=_u64.split=_u64.fromBig=void 0;const U32_MASK64$1=BigInt(2**32-1),_32n$1=BigInt(32);function fromBig$1(xt,e=!1){return e?{h:Number(xt&U32_MASK64$1),l:Number(xt>>_32n$1&U32_MASK64$1)}:{h:Number(xt>>_32n$1&U32_MASK64$1)|0,l:Number(xt&U32_MASK64$1)|0}}_u64.fromBig=fromBig$1;function split$1(xt,e=!1){let At=new Uint32Array(xt.length),kt=new Uint32Array(xt.length);for(let Bt=0;Bt<xt.length;Bt++){const{h:Nt,l:jt}=fromBig$1(xt[Bt],e);[At[Bt],kt[Bt]]=[Nt,jt]}return[At,kt]}_u64.split=split$1;const toBig$1=(xt,e)=>BigInt(xt>>>0)<<_32n$1|BigInt(e>>>0);_u64.toBig=toBig$1;const shrSH$1=(xt,e,At)=>xt>>>At;_u64.shrSH=shrSH$1;const shrSL$1=(xt,e,At)=>xt<<32-At|e>>>At;_u64.shrSL=shrSL$1;const rotrSH$1=(xt,e,At)=>xt>>>At|e<<32-At;_u64.rotrSH=rotrSH$1;const rotrSL$1=(xt,e,At)=>xt<<32-At|e>>>At;_u64.rotrSL=rotrSL$1;const rotrBH$1=(xt,e,At)=>xt<<64-At|e>>>At-32;_u64.rotrBH=rotrBH$1;const rotrBL$1=(xt,e,At)=>xt>>>At-32|e<<64-At;_u64.rotrBL=rotrBL$1;const rotr32H$1=(xt,e)=>e;_u64.rotr32H=rotr32H$1;const rotr32L$1=(xt,e)=>xt;_u64.rotr32L=rotr32L$1;const rotlSH$1=(xt,e,At)=>xt<<At|e>>>32-At;_u64.rotlSH=rotlSH$1;const rotlSL$1=(xt,e,At)=>e<<At|xt>>>32-At;_u64.rotlSL=rotlSL$1;const rotlBH$1=(xt,e,At)=>e<<At-32|xt>>>64-At;_u64.rotlBH=rotlBH$1;const rotlBL$1=(xt,e,At)=>xt<<At-32|e>>>64-At;_u64.rotlBL=rotlBL$1;function add$1(xt,e,At,kt){const Bt=(e>>>0)+(kt>>>0);return{h:xt+At+(Bt/2**32|0)|0,l:Bt|0}}_u64.add=add$1;const add3L$1=(xt,e,At)=>(xt>>>0)+(e>>>0)+(At>>>0);_u64.add3L=add3L$1;const add3H$1=(xt,e,At,kt)=>e+At+kt+(xt/2**32|0)|0;_u64.add3H=add3H$1;const add4L$1=(xt,e,At,kt)=>(xt>>>0)+(e>>>0)+(At>>>0)+(kt>>>0);_u64.add4L=add4L$1;const add4H$1=(xt,e,At,kt,Bt)=>e+At+kt+Bt+(xt/2**32|0)|0;_u64.add4H=add4H$1;const add5L$1=(xt,e,At,kt,Bt)=>(xt>>>0)+(e>>>0)+(At>>>0)+(kt>>>0)+(Bt>>>0);_u64.add5L=add5L$1;const add5H$1=(xt,e,At,kt,Bt,Nt)=>e+At+kt+Bt+Nt+(xt/2**32|0)|0;_u64.add5H=add5H$1;const u64$1={fromBig:fromBig$1,split:split$1,toBig:toBig$1,shrSH:shrSH$1,shrSL:shrSL$1,rotrSH:rotrSH$1,rotrSL:rotrSL$1,rotrBH:rotrBH$1,rotrBL:rotrBL$1,rotr32H:rotr32H$1,rotr32L:rotr32L$1,rotlSH:rotlSH$1,rotlSL:rotlSL$1,rotlBH:rotlBH$1,rotlBL:rotlBL$1,add:add$1,add3L:add3L$1,add3H:add3H$1,add4L:add4L$1,add4H:add4H$1,add5H:add5H$1,add5L:add5L$1};_u64.default=u64$1;Object.defineProperty(sha512$1,"__esModule",{value:!0});sha512$1.sha384=sha512$1.sha512_256=sha512$1.sha512_224=sha512$1.sha512=sha512$1.SHA512=void 0;const _md_js_1$1=_md,_u64_js_1=_u64,utils_js_1$9=utils$4,[SHA512_Kh$1,SHA512_Kl$1]=_u64_js_1.default.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(xt=>BigInt(xt))),SHA512_W_H$1=new Uint32Array(80),SHA512_W_L$1=new Uint32Array(80);let SHA512$1=class extends _md_js_1$1.HashMD{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:At,Bh:kt,Bl:Bt,Ch:Nt,Cl:jt,Dh:Lt,Dl:er,Eh:tr,El:zt,Fh:rr,Fl:nr,Gh:ir,Gl:ar,Hh:dr,Hl:ur}=this;return[e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar,dr,ur]}set(e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar,dr,ur){this.Ah=e|0,this.Al=At|0,this.Bh=kt|0,this.Bl=Bt|0,this.Ch=Nt|0,this.Cl=jt|0,this.Dh=Lt|0,this.Dl=er|0,this.Eh=tr|0,this.El=zt|0,this.Fh=rr|0,this.Fl=nr|0,this.Gh=ir|0,this.Gl=ar|0,this.Hh=dr|0,this.Hl=ur|0}process(e,At){for(let lr=0;lr<16;lr++,At+=4)SHA512_W_H$1[lr]=e.getUint32(At),SHA512_W_L$1[lr]=e.getUint32(At+=4);for(let lr=16;lr<80;lr++){const yr=SHA512_W_H$1[lr-15]|0,br=SHA512_W_L$1[lr-15]|0,Ar=_u64_js_1.default.rotrSH(yr,br,1)^_u64_js_1.default.rotrSH(yr,br,8)^_u64_js_1.default.shrSH(yr,br,7),Pr=_u64_js_1.default.rotrSL(yr,br,1)^_u64_js_1.default.rotrSL(yr,br,8)^_u64_js_1.default.shrSL(yr,br,7),kr=SHA512_W_H$1[lr-2]|0,Ur=SHA512_W_L$1[lr-2]|0,Hr=_u64_js_1.default.rotrSH(kr,Ur,19)^_u64_js_1.default.rotrBH(kr,Ur,61)^_u64_js_1.default.shrSH(kr,Ur,6),Lr=_u64_js_1.default.rotrSL(kr,Ur,19)^_u64_js_1.default.rotrBL(kr,Ur,61)^_u64_js_1.default.shrSL(kr,Ur,6),Sr=_u64_js_1.default.add4L(Pr,Lr,SHA512_W_L$1[lr-7],SHA512_W_L$1[lr-16]),_r=_u64_js_1.default.add4H(Sr,Ar,Hr,SHA512_W_H$1[lr-7],SHA512_W_H$1[lr-16]);SHA512_W_H$1[lr]=_r|0,SHA512_W_L$1[lr]=Sr|0}let{Ah:kt,Al:Bt,Bh:Nt,Bl:jt,Ch:Lt,Cl:er,Dh:tr,Dl:zt,Eh:rr,El:nr,Fh:ir,Fl:ar,Gh:dr,Gl:ur,Hh:fr,Hl:pr}=this;for(let lr=0;lr<80;lr++){const yr=_u64_js_1.default.rotrSH(rr,nr,14)^_u64_js_1.default.rotrSH(rr,nr,18)^_u64_js_1.default.rotrBH(rr,nr,41),br=_u64_js_1.default.rotrSL(rr,nr,14)^_u64_js_1.default.rotrSL(rr,nr,18)^_u64_js_1.default.rotrBL(rr,nr,41),Ar=rr&ir^~rr&dr,Pr=nr&ar^~nr&ur,kr=_u64_js_1.default.add5L(pr,br,Pr,SHA512_Kl$1[lr],SHA512_W_L$1[lr]),Ur=_u64_js_1.default.add5H(kr,fr,yr,Ar,SHA512_Kh$1[lr],SHA512_W_H$1[lr]),Hr=kr|0,Lr=_u64_js_1.default.rotrSH(kt,Bt,28)^_u64_js_1.default.rotrBH(kt,Bt,34)^_u64_js_1.default.rotrBH(kt,Bt,39),Sr=_u64_js_1.default.rotrSL(kt,Bt,28)^_u64_js_1.default.rotrBL(kt,Bt,34)^_u64_js_1.default.rotrBL(kt,Bt,39),_r=kt&Nt^kt&Lt^Nt&Lt,gr=Bt&jt^Bt&er^jt&er;fr=dr|0,pr=ur|0,dr=ir|0,ur=ar|0,ir=rr|0,ar=nr|0,{h:rr,l:nr}=_u64_js_1.default.add(tr|0,zt|0,Ur|0,Hr|0),tr=Lt|0,zt=er|0,Lt=Nt|0,er=jt|0,Nt=kt|0,jt=Bt|0;const wr=_u64_js_1.default.add3L(Hr,Sr,gr);kt=_u64_js_1.default.add3H(wr,Ur,Lr,_r),Bt=wr|0}({h:kt,l:Bt}=_u64_js_1.default.add(this.Ah|0,this.Al|0,kt|0,Bt|0)),{h:Nt,l:jt}=_u64_js_1.default.add(this.Bh|0,this.Bl|0,Nt|0,jt|0),{h:Lt,l:er}=_u64_js_1.default.add(this.Ch|0,this.Cl|0,Lt|0,er|0),{h:tr,l:zt}=_u64_js_1.default.add(this.Dh|0,this.Dl|0,tr|0,zt|0),{h:rr,l:nr}=_u64_js_1.default.add(this.Eh|0,this.El|0,rr|0,nr|0),{h:ir,l:ar}=_u64_js_1.default.add(this.Fh|0,this.Fl|0,ir|0,ar|0),{h:dr,l:ur}=_u64_js_1.default.add(this.Gh|0,this.Gl|0,dr|0,ur|0),{h:fr,l:pr}=_u64_js_1.default.add(this.Hh|0,this.Hl|0,fr|0,pr|0),this.set(kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar,dr,ur,fr,pr)}roundClean(){SHA512_W_H$1.fill(0),SHA512_W_L$1.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};sha512$1.SHA512=SHA512$1;class SHA512_224 extends SHA512$1{constructor(){super(),this.Ah=-1942145080,this.Al=424955298,this.Bh=1944164710,this.Bl=-1982016298,this.Ch=502970286,this.Cl=855612546,this.Dh=1738396948,this.Dl=1479516111,this.Eh=258812777,this.El=2077511080,this.Fh=2011393907,this.Fl=79989058,this.Gh=1067287976,this.Gl=1780299464,this.Hh=286451373,this.Hl=-1848208735,this.outputLen=28}}class SHA512_256 extends SHA512$1{constructor(){super(),this.Ah=573645204,this.Al=-64227540,this.Bh=-1621794909,this.Bl=-934517566,this.Ch=596883563,this.Cl=1867755857,this.Dh=-1774684391,this.Dl=1497426621,this.Eh=-1775747358,this.El=-1467023389,this.Fh=-1101128155,this.Fl=1401305490,this.Gh=721525244,this.Gl=746961066,this.Hh=246885852,this.Hl=-2117784414,this.outputLen=32}}class SHA384 extends SHA512$1{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}}sha512$1.sha512=(0,utils_js_1$9.wrapConstructor)(()=>new SHA512$1);sha512$1.sha512_224=(0,utils_js_1$9.wrapConstructor)(()=>new SHA512_224);sha512$1.sha512_256=(0,utils_js_1$9.wrapConstructor)(()=>new SHA512_256);sha512$1.sha384=(0,utils_js_1$9.wrapConstructor)(()=>new SHA384);const require$$1$1=getAugmentedNamespace(utils$w);var edwards={},curve={},modular={},utils$3={};Object.defineProperty(utils$3,"__esModule",{value:!0});utils$3.bitMask=void 0;utils$3.isBytes=isBytes$7;utils$3.abytes=abytes;utils$3.bytesToHex=bytesToHex$2;utils$3.numberToHexUnpadded=numberToHexUnpadded$1;utils$3.hexToNumber=hexToNumber$1;utils$3.hexToBytes=hexToBytes$2;utils$3.bytesToNumberBE=bytesToNumberBE$1;utils$3.bytesToNumberLE=bytesToNumberLE$1;utils$3.numberToBytesBE=numberToBytesBE$1;utils$3.numberToBytesLE=numberToBytesLE$1;utils$3.numberToVarBytesBE=numberToVarBytesBE$1;utils$3.ensureBytes=ensureBytes$3;utils$3.concatBytes=concatBytes$2;utils$3.equalBytes=equalBytes$2;utils$3.utf8ToBytes=utf8ToBytes$4;utils$3.bitLen=bitLen$1;utils$3.bitGet=bitGet$1;utils$3.bitSet=bitSet$1;utils$3.createHmacDrbg=createHmacDrbg$1;utils$3.validateObject=validateObject$7;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$a=BigInt(0),_1n$c=BigInt(1),_2n$7=BigInt(2);function isBytes$7(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}function abytes(xt){if(!isBytes$7(xt))throw new Error("Uint8Array expected")}const hexes$2=Array.from({length:256},(xt,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$2(xt){abytes(xt);let e="";for(let At=0;At<xt.length;At++)e+=hexes$2[xt[At]];return e}function numberToHexUnpadded$1(xt){const e=xt.toString(16);return e.length&1?`0${e}`:e}function hexToNumber$1(xt){if(typeof xt!="string")throw new Error("hex string expected, got "+typeof xt);return BigInt(xt===""?"0":`0x${xt}`)}const asciis$2={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16$2(xt){if(xt>=asciis$2._0&&xt<=asciis$2._9)return xt-asciis$2._0;if(xt>=asciis$2._A&&xt<=asciis$2._F)return xt-(asciis$2._A-10);if(xt>=asciis$2._a&&xt<=asciis$2._f)return xt-(asciis$2._a-10)}function hexToBytes$2(xt){if(typeof xt!="string")throw new Error("hex string expected, got "+typeof xt);const e=xt.length,At=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const kt=new Uint8Array(At);for(let Bt=0,Nt=0;Bt<At;Bt++,Nt+=2){const jt=asciiToBase16$2(xt.charCodeAt(Nt)),Lt=asciiToBase16$2(xt.charCodeAt(Nt+1));if(jt===void 0||Lt===void 0){const er=xt[Nt]+xt[Nt+1];throw new Error('hex string expected, got non-hex character "'+er+'" at index '+Nt)}kt[Bt]=jt*16+Lt}return kt}function bytesToNumberBE$1(xt){return hexToNumber$1(bytesToHex$2(xt))}function bytesToNumberLE$1(xt){return abytes(xt),hexToNumber$1(bytesToHex$2(Uint8Array.from(xt).reverse()))}function numberToBytesBE$1(xt,e){return hexToBytes$2(xt.toString(16).padStart(e*2,"0"))}function numberToBytesLE$1(xt,e){return numberToBytesBE$1(xt,e).reverse()}function numberToVarBytesBE$1(xt){return hexToBytes$2(numberToHexUnpadded$1(xt))}function ensureBytes$3(xt,e,At){let kt;if(typeof e=="string")try{kt=hexToBytes$2(e)}catch(Nt){throw new Error(`${xt} must be valid hex string, got "${e}". Cause: ${Nt}`)}else if(isBytes$7(e))kt=Uint8Array.from(e);else throw new Error(`${xt} must be hex string or Uint8Array`);const Bt=kt.length;if(typeof At=="number"&&Bt!==At)throw new Error(`${xt} expected ${At} bytes, got ${Bt}`);return kt}function concatBytes$2(...xt){let e=0;for(let kt=0;kt<xt.length;kt++){const Bt=xt[kt];abytes(Bt),e+=Bt.length}const At=new Uint8Array(e);for(let kt=0,Bt=0;kt<xt.length;kt++){const Nt=xt[kt];At.set(Nt,Bt),Bt+=Nt.length}return At}function equalBytes$2(xt,e){if(xt.length!==e.length)return!1;let At=0;for(let kt=0;kt<xt.length;kt++)At|=xt[kt]^e[kt];return At===0}function utf8ToBytes$4(xt){if(typeof xt!="string")throw new Error(`utf8ToBytes expected string, got ${typeof xt}`);return new Uint8Array(new TextEncoder().encode(xt))}function bitLen$1(xt){let e;for(e=0;xt>_0n$a;xt>>=_1n$c,e+=1);return e}function bitGet$1(xt,e){return xt>>BigInt(e)&_1n$c}function bitSet$1(xt,e,At){return xt|(At?_1n$c:_0n$a)<<BigInt(e)}const bitMask$1=xt=>(_2n$7<<BigInt(xt-1))-_1n$c;utils$3.bitMask=bitMask$1;const u8n$1=xt=>new Uint8Array(xt),u8fr$1=xt=>Uint8Array.from(xt);function createHmacDrbg$1(xt,e,At){if(typeof xt!="number"||xt<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof At!="function")throw new Error("hmacFn must be a function");let kt=u8n$1(xt),Bt=u8n$1(xt),Nt=0;const jt=()=>{kt.fill(1),Bt.fill(0),Nt=0},Lt=(...rr)=>At(Bt,kt,...rr),er=(rr=u8n$1())=>{Bt=Lt(u8fr$1([0]),rr),kt=Lt(),rr.length!==0&&(Bt=Lt(u8fr$1([1]),rr),kt=Lt())},tr=()=>{if(Nt++>=1e3)throw new Error("drbg: tried 1000 values");let rr=0;const nr=[];for(;rr<e;){kt=Lt();const ir=kt.slice();nr.push(ir),rr+=kt.length}return concatBytes$2(...nr)};return(rr,nr)=>{jt(),er(rr);let ir;for(;!(ir=nr(tr()));)er();return jt(),ir}}const validatorFns$1={bigint:xt=>typeof xt=="bigint",function:xt=>typeof xt=="function",boolean:xt=>typeof xt=="boolean",string:xt=>typeof xt=="string",stringOrUint8Array:xt=>typeof xt=="string"||isBytes$7(xt),isSafeInteger:xt=>Number.isSafeInteger(xt),array:xt=>Array.isArray(xt),field:(xt,e)=>e.Fp.isValid(xt),hash:xt=>typeof xt=="function"&&Number.isSafeInteger(xt.outputLen)};function validateObject$7(xt,e,At={}){const kt=(Bt,Nt,jt)=>{const Lt=validatorFns$1[Nt];if(typeof Lt!="function")throw new Error(`Invalid validator "${Nt}", expected function`);const er=xt[Bt];if(!(jt&&er===void 0)&&!Lt(er,xt))throw new Error(`Invalid param ${String(Bt)}=${er} (${typeof er}), expected ${Nt}`)};for(const[Bt,Nt]of Object.entries(e))kt(Bt,Nt,!1);for(const[Bt,Nt]of Object.entries(At))kt(Bt,Nt,!0);return xt}Object.defineProperty(modular,"__esModule",{value:!0});modular.isNegativeLE=void 0;modular.mod=mod$1;modular.pow=pow$1;modular.pow2=pow2$1;modular.invert=invert$1;modular.tonelliShanks=tonelliShanks$1;modular.FpSqrt=FpSqrt$1;modular.validateField=validateField$1;modular.FpPow=FpPow$1;modular.FpInvertBatch=FpInvertBatch$1;modular.FpDiv=FpDiv;modular.FpIsSquare=FpIsSquare;modular.nLength=nLength$1;modular.Field=Field$1;modular.FpSqrtOdd=FpSqrtOdd;modular.FpSqrtEven=FpSqrtEven$1;modular.hashToPrivateScalar=hashToPrivateScalar;modular.getFieldBytesLength=getFieldBytesLength$1;modular.getMinHashLength=getMinHashLength$1;modular.mapHashToField=mapHashToField$1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const utils_js_1$8=utils$3,_0n$9=BigInt(0),_1n$b=BigInt(1),_2n$6=BigInt(2),_3n$2=BigInt(3),_4n$1=BigInt(4),_5n$2=BigInt(5),_8n$3=BigInt(8);BigInt(9);BigInt(16);function mod$1(xt,e){const At=xt%e;return At>=_0n$9?At:e+At}function pow$1(xt,e,At){if(At<=_0n$9||e<_0n$9)throw new Error("Expected power/modulo > 0");if(At===_1n$b)return _0n$9;let kt=_1n$b;for(;e>_0n$9;)e&_1n$b&&(kt=kt*xt%At),xt=xt*xt%At,e>>=_1n$b;return kt}function pow2$1(xt,e,At){let kt=xt;for(;e-- >_0n$9;)kt*=kt,kt%=At;return kt}function invert$1(xt,e){if(xt===_0n$9||e<=_0n$9)throw new Error(`invert: expected positive integers, got n=${xt} mod=${e}`);let At=mod$1(xt,e),kt=e,Bt=_0n$9,Nt=_1n$b;for(;At!==_0n$9;){const Lt=kt/At,er=kt%At,tr=Bt-Nt*Lt;kt=At,At=er,Bt=Nt,Nt=tr}if(kt!==_1n$b)throw new Error("invert: does not exist");return mod$1(Bt,e)}function tonelliShanks$1(xt){const e=(xt-_1n$b)/_2n$6;let At,kt,Bt;for(At=xt-_1n$b,kt=0;At%_2n$6===_0n$9;At/=_2n$6,kt++);for(Bt=_2n$6;Bt<xt&&pow$1(Bt,e,xt)!==xt-_1n$b;Bt++);if(kt===1){const jt=(xt+_1n$b)/_4n$1;return function(er,tr){const zt=er.pow(tr,jt);if(!er.eql(er.sqr(zt),tr))throw new Error("Cannot find square root");return zt}}const Nt=(At+_1n$b)/_2n$6;return function(Lt,er){if(Lt.pow(er,e)===Lt.neg(Lt.ONE))throw new Error("Cannot find square root");let tr=kt,zt=Lt.pow(Lt.mul(Lt.ONE,Bt),At),rr=Lt.pow(er,Nt),nr=Lt.pow(er,At);for(;!Lt.eql(nr,Lt.ONE);){if(Lt.eql(nr,Lt.ZERO))return Lt.ZERO;let ir=1;for(let dr=Lt.sqr(nr);ir<tr&&!Lt.eql(dr,Lt.ONE);ir++)dr=Lt.sqr(dr);const ar=Lt.pow(zt,_1n$b<<BigInt(tr-ir-1));zt=Lt.sqr(ar),rr=Lt.mul(rr,ar),nr=Lt.mul(nr,zt),tr=ir}return rr}}function FpSqrt$1(xt){if(xt%_4n$1===_3n$2){const e=(xt+_1n$b)/_4n$1;return function(kt,Bt){const Nt=kt.pow(Bt,e);if(!kt.eql(kt.sqr(Nt),Bt))throw new Error("Cannot find square root");return Nt}}if(xt%_8n$3===_5n$2){const e=(xt-_5n$2)/_8n$3;return function(kt,Bt){const Nt=kt.mul(Bt,_2n$6),jt=kt.pow(Nt,e),Lt=kt.mul(Bt,jt),er=kt.mul(kt.mul(Lt,_2n$6),jt),tr=kt.mul(Lt,kt.sub(er,kt.ONE));if(!kt.eql(kt.sqr(tr),Bt))throw new Error("Cannot find square root");return tr}}return tonelliShanks$1(xt)}const isNegativeLE$1=(xt,e)=>(mod$1(xt,e)&_1n$b)===_1n$b;modular.isNegativeLE=isNegativeLE$1;const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(xt){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},At=FIELD_FIELDS$1.reduce((kt,Bt)=>(kt[Bt]="function",kt),e);return(0,utils_js_1$8.validateObject)(xt,At)}function FpPow$1(xt,e,At){if(At<_0n$9)throw new Error("Expected power > 0");if(At===_0n$9)return xt.ONE;if(At===_1n$b)return e;let kt=xt.ONE,Bt=e;for(;At>_0n$9;)At&_1n$b&&(kt=xt.mul(kt,Bt)),Bt=xt.sqr(Bt),At>>=_1n$b;return kt}function FpInvertBatch$1(xt,e){const At=new Array(e.length),kt=e.reduce((Nt,jt,Lt)=>xt.is0(jt)?Nt:(At[Lt]=Nt,xt.mul(Nt,jt)),xt.ONE),Bt=xt.inv(kt);return e.reduceRight((Nt,jt,Lt)=>xt.is0(jt)?Nt:(At[Lt]=xt.mul(Nt,At[Lt]),xt.mul(Nt,jt)),Bt),At}function FpDiv(xt,e,At){return xt.mul(e,typeof At=="bigint"?invert$1(At,xt.ORDER):xt.inv(At))}function FpIsSquare(xt){const e=(xt.ORDER-_1n$b)/_2n$6;return At=>{const kt=xt.pow(At,e);return xt.eql(kt,xt.ZERO)||xt.eql(kt,xt.ONE)}}function nLength$1(xt,e){const At=e!==void 0?e:xt.toString(2).length,kt=Math.ceil(At/8);return{nBitLength:At,nByteLength:kt}}function Field$1(xt,e,At=!1,kt={}){if(xt<=_0n$9)throw new Error(`Expected Field ORDER > 0, got ${xt}`);const{nBitLength:Bt,nByteLength:Nt}=nLength$1(xt,e);if(Nt>2048)throw new Error("Field lengths over 2048 bytes are not supported");const jt=FpSqrt$1(xt),Lt=Object.freeze({ORDER:xt,BITS:Bt,BYTES:Nt,MASK:(0,utils_js_1$8.bitMask)(Bt),ZERO:_0n$9,ONE:_1n$b,create:er=>mod$1(er,xt),isValid:er=>{if(typeof er!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof er}`);return _0n$9<=er&&er<xt},is0:er=>er===_0n$9,isOdd:er=>(er&_1n$b)===_1n$b,neg:er=>mod$1(-er,xt),eql:(er,tr)=>er===tr,sqr:er=>mod$1(er*er,xt),add:(er,tr)=>mod$1(er+tr,xt),sub:(er,tr)=>mod$1(er-tr,xt),mul:(er,tr)=>mod$1(er*tr,xt),pow:(er,tr)=>FpPow$1(Lt,er,tr),div:(er,tr)=>mod$1(er*invert$1(tr,xt),xt),sqrN:er=>er*er,addN:(er,tr)=>er+tr,subN:(er,tr)=>er-tr,mulN:(er,tr)=>er*tr,inv:er=>invert$1(er,xt),sqrt:kt.sqrt||(er=>jt(Lt,er)),invertBatch:er=>FpInvertBatch$1(Lt,er),cmov:(er,tr,zt)=>zt?tr:er,toBytes:er=>At?(0,utils_js_1$8.numberToBytesLE)(er,Nt):(0,utils_js_1$8.numberToBytesBE)(er,Nt),fromBytes:er=>{if(er.length!==Nt)throw new Error(`Fp.fromBytes: expected ${Nt}, got ${er.length}`);return At?(0,utils_js_1$8.bytesToNumberLE)(er):(0,utils_js_1$8.bytesToNumberBE)(er)}});return Object.freeze(Lt)}function FpSqrtOdd(xt,e){if(!xt.isOdd)throw new Error("Field doesn't have isOdd");const At=xt.sqrt(e);return xt.isOdd(At)?At:xt.neg(At)}function FpSqrtEven$1(xt,e){if(!xt.isOdd)throw new Error("Field doesn't have isOdd");const At=xt.sqrt(e);return xt.isOdd(At)?xt.neg(At):At}function hashToPrivateScalar(xt,e,At=!1){xt=(0,utils_js_1$8.ensureBytes)("privateHash",xt);const kt=xt.length,Bt=nLength$1(e).nByteLength+8;if(Bt<24||kt<Bt||kt>1024)throw new Error(`hashToPrivateScalar: expected ${Bt}-1024 bytes of input, got ${kt}`);const Nt=At?(0,utils_js_1$8.bytesToNumberLE)(xt):(0,utils_js_1$8.bytesToNumberBE)(xt);return mod$1(Nt,e-_1n$b)+_1n$b}function getFieldBytesLength$1(xt){if(typeof xt!="bigint")throw new Error("field order must be bigint");const e=xt.toString(2).length;return Math.ceil(e/8)}function getMinHashLength$1(xt){const e=getFieldBytesLength$1(xt);return e+Math.ceil(e/2)}function mapHashToField$1(xt,e,At=!1){const kt=xt.length,Bt=getFieldBytesLength$1(e),Nt=getMinHashLength$1(e);if(kt<16||kt<Nt||kt>1024)throw new Error(`expected ${Nt}-1024 bytes of input, got ${kt}`);const jt=At?(0,utils_js_1$8.bytesToNumberBE)(xt):(0,utils_js_1$8.bytesToNumberLE)(xt),Lt=mod$1(jt,e-_1n$b)+_1n$b;return At?(0,utils_js_1$8.numberToBytesLE)(Lt,Bt):(0,utils_js_1$8.numberToBytesBE)(Lt,Bt)}Object.defineProperty(curve,"__esModule",{value:!0});curve.wNAF=wNAF$1;curve.validateBasic=validateBasic$1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const modular_js_1$3=modular,utils_js_1$7=utils$3,_0n$8=BigInt(0),_1n$a=BigInt(1);function wNAF$1(xt,e){const At=(Bt,Nt)=>{const jt=Nt.negate();return Bt?jt:Nt},kt=Bt=>{const Nt=Math.ceil(e/Bt)+1,jt=2**(Bt-1);return{windows:Nt,windowSize:jt}};return{constTimeNegate:At,unsafeLadder(Bt,Nt){let jt=xt.ZERO,Lt=Bt;for(;Nt>_0n$8;)Nt&_1n$a&&(jt=jt.add(Lt)),Lt=Lt.double(),Nt>>=_1n$a;return jt},precomputeWindow(Bt,Nt){const{windows:jt,windowSize:Lt}=kt(Nt),er=[];let tr=Bt,zt=tr;for(let rr=0;rr<jt;rr++){zt=tr,er.push(zt);for(let nr=1;nr<Lt;nr++)zt=zt.add(tr),er.push(zt);tr=zt.double()}return er},wNAF(Bt,Nt,jt){const{windows:Lt,windowSize:er}=kt(Bt);let tr=xt.ZERO,zt=xt.BASE;const rr=BigInt(2**Bt-1),nr=2**Bt,ir=BigInt(Bt);for(let ar=0;ar<Lt;ar++){const dr=ar*er;let ur=Number(jt&rr);jt>>=ir,ur>er&&(ur-=nr,jt+=_1n$a);const fr=dr,pr=dr+Math.abs(ur)-1,lr=ar%2!==0,yr=ur<0;ur===0?zt=zt.add(At(lr,Nt[fr])):tr=tr.add(At(yr,Nt[pr]))}return{p:tr,f:zt}},wNAFCached(Bt,Nt,jt,Lt){const er=Bt._WINDOW_SIZE||1;let tr=Nt.get(Bt);return tr||(tr=this.precomputeWindow(Bt,er),er!==1&&Nt.set(Bt,Lt(tr))),this.wNAF(er,tr,jt)}}}function validateBasic$1(xt){return(0,modular_js_1$3.validateField)(xt.Fp),(0,utils_js_1$7.validateObject)(xt,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...(0,modular_js_1$3.nLength)(xt.n,xt.nBitLength),...xt,p:xt.Fp.ORDER})}Object.defineProperty(edwards,"__esModule",{value:!0});edwards.twistedEdwards=twistedEdwards$1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const curve_js_1=curve,modular_js_1$2=modular,ut$1=utils$3,utils_js_1$6=utils$3,_0n$7=BigInt(0),_1n$9=BigInt(1),_2n$5=BigInt(2),_8n$2=BigInt(8),VERIFY_DEFAULT$1={zip215:!0};function validateOpts$4(xt){const e=(0,curve_js_1.validateBasic)(xt);return ut$1.validateObject(xt,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function twistedEdwards$1(xt){const e=validateOpts$4(xt),{Fp:At,n:kt,prehash:Bt,hash:Nt,randomBytes:jt,nByteLength:Lt,h:er}=e,tr=_2n$5<<BigInt(Lt*8)-_1n$9,zt=At.create,rr=e.uvRatio||((Ir,$r)=>{try{return{isValid:!0,value:At.sqrt(Ir*At.inv($r))}}catch{return{isValid:!1,value:_0n$7}}}),nr=e.adjustScalarBytes||(Ir=>Ir),ir=e.domain||((Ir,$r,vr)=>{if($r.length||vr)throw new Error("Contexts/pre-hash are not supported");return Ir}),ar=Ir=>typeof Ir=="bigint"&&_0n$7<Ir,dr=(Ir,$r)=>ar(Ir)&&ar($r)&&Ir<$r,ur=Ir=>Ir===_0n$7||dr(Ir,tr);function fr(Ir,$r){if(dr(Ir,$r))return Ir;throw new Error(`Expected valid scalar < ${$r}, got ${typeof Ir} ${Ir}`)}function pr(Ir){return Ir===_0n$7?Ir:fr(Ir,kt)}const lr=new Map;function yr(Ir){if(!(Ir instanceof br))throw new Error("ExtendedPoint expected")}class br{constructor($r,vr,Er,Tr){if(this.ex=$r,this.ey=vr,this.ez=Er,this.et=Tr,!ur($r))throw new Error("x required");if(!ur(vr))throw new Error("y required");if(!ur(Er))throw new Error("z required");if(!ur(Tr))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine($r){if($r instanceof br)throw new Error("extended point not allowed");const{x:vr,y:Er}=$r||{};if(!ur(vr)||!ur(Er))throw new Error("invalid affine point");return new br(vr,Er,_1n$9,zt(vr*Er))}static normalizeZ($r){const vr=At.invertBatch($r.map(Er=>Er.ez));return $r.map((Er,Tr)=>Er.toAffine(vr[Tr])).map(br.fromAffine)}_setWindowSize($r){this._WINDOW_SIZE=$r,lr.delete(this)}assertValidity(){const{a:$r,d:vr}=e;if(this.is0())throw new Error("bad point: ZERO");const{ex:Er,ey:Tr,ez:Rr,et:Mr}=this,Gr=zt(Er*Er),Br=zt(Tr*Tr),Cr=zt(Rr*Rr),jr=zt(Cr*Cr),Yr=zt(Gr*$r),Qr=zt(Cr*zt(Yr+Br)),Jr=zt(jr+zt(vr*zt(Gr*Br)));if(Qr!==Jr)throw new Error("bad point: equation left != right (1)");const Wr=zt(Er*Tr),Nr=zt(Rr*Mr);if(Wr!==Nr)throw new Error("bad point: equation left != right (2)")}equals($r){yr($r);const{ex:vr,ey:Er,ez:Tr}=this,{ex:Rr,ey:Mr,ez:Gr}=$r,Br=zt(vr*Gr),Cr=zt(Rr*Tr),jr=zt(Er*Gr),Yr=zt(Mr*Tr);return Br===Cr&&jr===Yr}is0(){return this.equals(br.ZERO)}negate(){return new br(zt(-this.ex),this.ey,this.ez,zt(-this.et))}double(){const{a:$r}=e,{ex:vr,ey:Er,ez:Tr}=this,Rr=zt(vr*vr),Mr=zt(Er*Er),Gr=zt(_2n$5*zt(Tr*Tr)),Br=zt($r*Rr),Cr=vr+Er,jr=zt(zt(Cr*Cr)-Rr-Mr),Yr=Br+Mr,Qr=Yr-Gr,Jr=Br-Mr,Wr=zt(jr*Qr),Nr=zt(Yr*Jr),Vr=zt(jr*Jr),Xr=zt(Qr*Yr);return new br(Wr,Nr,Xr,Vr)}add($r){yr($r);const{a:vr,d:Er}=e,{ex:Tr,ey:Rr,ez:Mr,et:Gr}=this,{ex:Br,ey:Cr,ez:jr,et:Yr}=$r;if(vr===BigInt(-1)){const dn=zt((Rr-Tr)*(Cr+Br)),vn=zt((Rr+Tr)*(Cr-Br)),$n=zt(vn-dn);if($n===_0n$7)return this.double();const en=zt(Mr*_2n$5*Yr),tn=zt(Gr*_2n$5*jr),hn=tn+en,mn=vn+dn,yn=tn-en,xn=zt(hn*$n),In=zt(mn*yn),On=zt(hn*yn),Dn=zt($n*mn);return new br(xn,In,Dn,On)}const Qr=zt(Tr*Br),Jr=zt(Rr*Cr),Wr=zt(Gr*Er*Yr),Nr=zt(Mr*jr),Vr=zt((Tr+Rr)*(Br+Cr)-Qr-Jr),Xr=Nr-Wr,qr=Nr+Wr,Or=zt(Jr-vr*Qr),Fr=zt(Vr*Xr),Zr=zt(qr*Or),rn=zt(Vr*Or),un=zt(Xr*qr);return new br(Fr,Zr,un,rn)}subtract($r){return this.add($r.negate())}wNAF($r){return kr.wNAFCached(this,lr,$r,br.normalizeZ)}multiply($r){const{p:vr,f:Er}=this.wNAF(fr($r,kt));return br.normalizeZ([vr,Er])[0]}multiplyUnsafe($r){let vr=pr($r);return vr===_0n$7?Pr:this.equals(Pr)||vr===_1n$9?this:this.equals(Ar)?this.wNAF(vr).p:kr.unsafeLadder(this,vr)}isSmallOrder(){return this.multiplyUnsafe(er).is0()}isTorsionFree(){return kr.unsafeLadder(this,kt).is0()}toAffine($r){const{ex:vr,ey:Er,ez:Tr}=this,Rr=this.is0();$r==null&&($r=Rr?_8n$2:At.inv(Tr));const Mr=zt(vr*$r),Gr=zt(Er*$r),Br=zt(Tr*$r);if(Rr)return{x:_0n$7,y:_1n$9};if(Br!==_1n$9)throw new Error("invZ was invalid");return{x:Mr,y:Gr}}clearCofactor(){const{h:$r}=e;return $r===_1n$9?this:this.multiplyUnsafe($r)}static fromHex($r,vr=!1){const{d:Er,a:Tr}=e,Rr=At.BYTES;$r=(0,utils_js_1$6.ensureBytes)("pointHex",$r,Rr);const Mr=$r.slice(),Gr=$r[Rr-1];Mr[Rr-1]=Gr&-129;const Br=ut$1.bytesToNumberLE(Mr);Br===_0n$7||(vr?fr(Br,tr):fr(Br,At.ORDER));const Cr=zt(Br*Br),jr=zt(Cr-_1n$9),Yr=zt(Er*Cr-Tr);let{isValid:Qr,value:Jr}=rr(jr,Yr);if(!Qr)throw new Error("Point.fromHex: invalid y coordinate");const Wr=(Jr&_1n$9)===_1n$9,Nr=(Gr&128)!==0;if(!vr&&Jr===_0n$7&&Nr)throw new Error("Point.fromHex: x=0 and x_0=1");return Nr!==Wr&&(Jr=zt(-Jr)),br.fromAffine({x:Jr,y:Br})}static fromPrivateKey($r){return Lr($r).point}toRawBytes(){const{x:$r,y:vr}=this.toAffine(),Er=ut$1.numberToBytesLE(vr,At.BYTES);return Er[Er.length-1]|=$r&_1n$9?128:0,Er}toHex(){return ut$1.bytesToHex(this.toRawBytes())}}br.BASE=new br(e.Gx,e.Gy,_1n$9,zt(e.Gx*e.Gy)),br.ZERO=new br(_0n$7,_1n$9,_1n$9,_0n$7);const{BASE:Ar,ZERO:Pr}=br,kr=(0,curve_js_1.wNAF)(br,Lt*8);function Ur(Ir){return(0,modular_js_1$2.mod)(Ir,kt)}function Hr(Ir){return Ur(ut$1.bytesToNumberLE(Ir))}function Lr(Ir){const $r=Lt;Ir=(0,utils_js_1$6.ensureBytes)("private key",Ir,$r);const vr=(0,utils_js_1$6.ensureBytes)("hashed private key",Nt(Ir),2*$r),Er=nr(vr.slice(0,$r)),Tr=vr.slice($r,2*$r),Rr=Hr(Er),Mr=Ar.multiply(Rr),Gr=Mr.toRawBytes();return{head:Er,prefix:Tr,scalar:Rr,point:Mr,pointBytes:Gr}}function Sr(Ir){return Lr(Ir).pointBytes}function _r(Ir=new Uint8Array,...$r){const vr=ut$1.concatBytes(...$r);return Hr(Nt(ir(vr,(0,utils_js_1$6.ensureBytes)("context",Ir),!!Bt)))}function gr(Ir,$r,vr={}){Ir=(0,utils_js_1$6.ensureBytes)("message",Ir),Bt&&(Ir=Bt(Ir));const{prefix:Er,scalar:Tr,pointBytes:Rr}=Lr($r),Mr=_r(vr.context,Er,Ir),Gr=Ar.multiply(Mr).toRawBytes(),Br=_r(vr.context,Gr,Rr,Ir),Cr=Ur(Mr+Br*Tr);pr(Cr);const jr=ut$1.concatBytes(Gr,ut$1.numberToBytesLE(Cr,At.BYTES));return(0,utils_js_1$6.ensureBytes)("result",jr,Lt*2)}const wr=VERIFY_DEFAULT$1;function Dr(Ir,$r,vr,Er=wr){const{context:Tr,zip215:Rr}=Er,Mr=At.BYTES;Ir=(0,utils_js_1$6.ensureBytes)("signature",Ir,2*Mr),$r=(0,utils_js_1$6.ensureBytes)("message",$r),Bt&&($r=Bt($r));const Gr=ut$1.bytesToNumberLE(Ir.slice(Mr,2*Mr));let Br,Cr,jr;try{Br=br.fromHex(vr,Rr),Cr=br.fromHex(Ir.slice(0,Mr),Rr),jr=Ar.multiplyUnsafe(Gr)}catch{return!1}if(!Rr&&Br.isSmallOrder())return!1;const Yr=_r(Tr,Cr.toRawBytes(),Br.toRawBytes(),$r);return Cr.add(Br.multiplyUnsafe(Yr)).subtract(jr).clearCofactor().equals(br.ZERO)}return Ar._setWindowSize(8),{CURVE:e,getPublicKey:Sr,sign:gr,verify:Dr,ExtendedPoint:br,utils:{getExtendedPublicKey:Lr,randomPrivateKey:()=>jt(At.BYTES),precompute(Ir=8,$r=br.BASE){return $r._setWindowSize(Ir),$r.multiply(BigInt(3)),$r}}}}var hashToCurve={};Object.defineProperty(hashToCurve,"__esModule",{value:!0});hashToCurve.expand_message_xmd=expand_message_xmd;hashToCurve.expand_message_xof=expand_message_xof;hashToCurve.hash_to_field=hash_to_field;hashToCurve.isogenyMap=isogenyMap;hashToCurve.createHasher=createHasher;const modular_js_1$1=modular,utils_js_1$5=utils$3,os2ip=utils_js_1$5.bytesToNumberBE;function i2osp(xt,e){if(xt<0||xt>=1<<8*e)throw new Error(`bad I2OSP call: value=${xt} length=${e}`);const At=Array.from({length:e}).fill(0);for(let kt=e-1;kt>=0;kt--)At[kt]=xt&255,xt>>>=8;return new Uint8Array(At)}function strxor(xt,e){const At=new Uint8Array(xt.length);for(let kt=0;kt<xt.length;kt++)At[kt]=xt[kt]^e[kt];return At}function anum(xt){if(!Number.isSafeInteger(xt))throw new Error("number expected")}function expand_message_xmd(xt,e,At,kt){(0,utils_js_1$5.abytes)(xt),(0,utils_js_1$5.abytes)(e),anum(At),e.length>255&&(e=kt((0,utils_js_1$5.concatBytes)((0,utils_js_1$5.utf8ToBytes)("H2C-OVERSIZE-DST-"),e)));const{outputLen:Bt,blockLen:Nt}=kt,jt=Math.ceil(At/Bt);if(jt>255)throw new Error("Invalid xmd length");const Lt=(0,utils_js_1$5.concatBytes)(e,i2osp(e.length,1)),er=i2osp(0,Nt),tr=i2osp(At,2),zt=new Array(jt),rr=kt((0,utils_js_1$5.concatBytes)(er,xt,tr,i2osp(0,1),Lt));zt[0]=kt((0,utils_js_1$5.concatBytes)(rr,i2osp(1,1),Lt));for(let ir=1;ir<=jt;ir++){const ar=[strxor(rr,zt[ir-1]),i2osp(ir+1,1),Lt];zt[ir]=kt((0,utils_js_1$5.concatBytes)(...ar))}return(0,utils_js_1$5.concatBytes)(...zt).slice(0,At)}function expand_message_xof(xt,e,At,kt,Bt){if((0,utils_js_1$5.abytes)(xt),(0,utils_js_1$5.abytes)(e),anum(At),e.length>255){const Nt=Math.ceil(2*kt/8);e=Bt.create({dkLen:Nt}).update((0,utils_js_1$5.utf8ToBytes)("H2C-OVERSIZE-DST-")).update(e).digest()}if(At>65535||e.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return Bt.create({dkLen:At}).update(xt).update(i2osp(At,2)).update(e).update(i2osp(e.length,1)).digest()}function hash_to_field(xt,e,At){(0,utils_js_1$5.validateObject)(At,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:kt,k:Bt,m:Nt,hash:jt,expand:Lt,DST:er}=At;(0,utils_js_1$5.abytes)(xt),anum(e);const tr=typeof er=="string"?(0,utils_js_1$5.utf8ToBytes)(er):er,zt=kt.toString(2).length,rr=Math.ceil((zt+Bt)/8),nr=e*Nt*rr;let ir;if(Lt==="xmd")ir=expand_message_xmd(xt,tr,nr,jt);else if(Lt==="xof")ir=expand_message_xof(xt,tr,nr,Bt,jt);else if(Lt==="_internal_pass")ir=xt;else throw new Error('expand must be "xmd" or "xof"');const ar=new Array(e);for(let dr=0;dr<e;dr++){const ur=new Array(Nt);for(let fr=0;fr<Nt;fr++){const pr=rr*(fr+dr*Nt),lr=ir.subarray(pr,pr+rr);ur[fr]=(0,modular_js_1$1.mod)(os2ip(lr),kt)}ar[dr]=ur}return ar}function isogenyMap(xt,e){const At=e.map(kt=>Array.from(kt).reverse());return(kt,Bt)=>{const[Nt,jt,Lt,er]=At.map(tr=>tr.reduce((zt,rr)=>xt.add(xt.mul(zt,kt),rr)));return kt=xt.div(Nt,jt),Bt=xt.mul(Bt,xt.div(Lt,er)),{x:kt,y:Bt}}}function createHasher(xt,e,At){if(typeof e!="function")throw new Error("mapToCurve() must be defined");return{hashToCurve(kt,Bt){const Nt=hash_to_field(kt,2,{...At,DST:At.DST,...Bt}),jt=xt.fromAffine(e(Nt[0])),Lt=xt.fromAffine(e(Nt[1])),er=jt.add(Lt).clearCofactor();return er.assertValidity(),er},encodeToCurve(kt,Bt){const Nt=hash_to_field(kt,1,{...At,DST:At.encodeDST,...Bt}),jt=xt.fromAffine(e(Nt[0])).clearCofactor();return jt.assertValidity(),jt},mapToCurve(kt){if(!Array.isArray(kt))throw new Error("mapToCurve: expected array of bigints");for(const Nt of kt)if(typeof Nt!="bigint")throw new Error(`mapToCurve: expected array of bigints, got ${Nt} in array`);const Bt=xt.fromAffine(e(kt)).clearCofactor();return Bt.assertValidity(),Bt}}}var montgomery$2={};Object.defineProperty(montgomery$2,"__esModule",{value:!0});montgomery$2.montgomery=montgomery$1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const modular_js_1=modular,utils_js_1$4=utils$3,_0n$6=BigInt(0),_1n$8=BigInt(1);function validateOpts$3(xt){return(0,utils_js_1$4.validateObject)(xt,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...xt})}function montgomery$1(xt){const e=validateOpts$3(xt),{P:At}=e,kt=lr=>(0,modular_js_1.mod)(lr,At),Bt=e.montgomeryBits,Nt=Math.ceil(Bt/8),jt=e.nByteLength,Lt=e.adjustScalarBytes||(lr=>lr),er=e.powPminus2||(lr=>(0,modular_js_1.pow)(lr,At-BigInt(2),At));function tr(lr,yr,br){const Ar=kt(lr*(yr-br));return yr=kt(yr-Ar),br=kt(br+Ar),[yr,br]}function zt(lr){if(typeof lr=="bigint"&&_0n$6<=lr&&lr<At)return lr;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const rr=(e.a-BigInt(2))/BigInt(4);function nr(lr,yr){const br=zt(lr),Ar=zt(yr),Pr=br;let kr=_1n$8,Ur=_0n$6,Hr=br,Lr=_1n$8,Sr=_0n$6,_r;for(let wr=BigInt(Bt-1);wr>=_0n$6;wr--){const Dr=Ar>>wr&_1n$8;Sr^=Dr,_r=tr(Sr,kr,Hr),kr=_r[0],Hr=_r[1],_r=tr(Sr,Ur,Lr),Ur=_r[0],Lr=_r[1],Sr=Dr;const xr=kr+Ur,Ir=kt(xr*xr),$r=kr-Ur,vr=kt($r*$r),Er=Ir-vr,Tr=Hr+Lr,Rr=Hr-Lr,Mr=kt(Rr*xr),Gr=kt(Tr*$r),Br=Mr+Gr,Cr=Mr-Gr;Hr=kt(Br*Br),Lr=kt(Pr*kt(Cr*Cr)),kr=kt(Ir*vr),Ur=kt(Er*(Ir+kt(rr*Er)))}_r=tr(Sr,kr,Hr),kr=_r[0],Hr=_r[1],_r=tr(Sr,Ur,Lr),Ur=_r[0],Lr=_r[1];const gr=er(Ur);return kt(kr*gr)}function ir(lr){return(0,utils_js_1$4.numberToBytesLE)(kt(lr),Nt)}function ar(lr){const yr=(0,utils_js_1$4.ensureBytes)("u coordinate",lr,Nt);return jt===32&&(yr[31]&=127),(0,utils_js_1$4.bytesToNumberLE)(yr)}function dr(lr){const yr=(0,utils_js_1$4.ensureBytes)("scalar",lr),br=yr.length;if(br!==Nt&&br!==jt)throw new Error(`Expected ${Nt} or ${jt} bytes, got ${br}`);return(0,utils_js_1$4.bytesToNumberLE)(Lt(yr))}function ur(lr,yr){const br=ar(yr),Ar=dr(lr),Pr=nr(br,Ar);if(Pr===_0n$6)throw new Error("Invalid private or public key received");return ir(Pr)}const fr=ir(e.Gu);function pr(lr){return ur(lr,fr)}return{scalarMult:ur,scalarMultBase:pr,getSharedSecret:(lr,yr)=>ur(lr,yr),getPublicKey:lr=>pr(lr),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:fr}}(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.hash_to_ristretto255=xt.hashToRistretto255=xt.RistrettoPoint=xt.encodeToCurve=xt.hashToCurve=xt.edwardsToMontgomery=xt.x25519=xt.ed25519ph=xt.ed25519ctx=xt.ed25519=xt.ED25519_TORSION_SUBGROUP=void 0,xt.edwardsToMontgomeryPub=Ar,xt.edwardsToMontgomeryPriv=Pr;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const e=sha512$1,At=require$$1$1,kt=edwards,Bt=hashToCurve,Nt=modular,jt=montgomery$2,Lt=utils$3,er=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),tr=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),zt=BigInt(0),rr=BigInt(1),nr=BigInt(2),ir=BigInt(3),ar=BigInt(5),dr=BigInt(8);function ur(Cr){const jr=BigInt(10),Yr=BigInt(20),Qr=BigInt(40),Jr=BigInt(80),Wr=er,Vr=Cr*Cr%Wr*Cr%Wr,Xr=(0,Nt.pow2)(Vr,nr,Wr)*Vr%Wr,qr=(0,Nt.pow2)(Xr,rr,Wr)*Cr%Wr,Or=(0,Nt.pow2)(qr,ar,Wr)*qr%Wr,Fr=(0,Nt.pow2)(Or,jr,Wr)*Or%Wr,Zr=(0,Nt.pow2)(Fr,Yr,Wr)*Fr%Wr,rn=(0,Nt.pow2)(Zr,Qr,Wr)*Zr%Wr,un=(0,Nt.pow2)(rn,Jr,Wr)*rn%Wr,dn=(0,Nt.pow2)(un,Jr,Wr)*rn%Wr,vn=(0,Nt.pow2)(dn,jr,Wr)*Or%Wr;return{pow_p_5_8:(0,Nt.pow2)(vn,nr,Wr)*Cr%Wr,b2:Vr}}function fr(Cr){return Cr[0]&=248,Cr[31]&=127,Cr[31]|=64,Cr}function pr(Cr,jr){const Yr=er,Qr=(0,Nt.mod)(jr*jr*jr,Yr),Jr=(0,Nt.mod)(Qr*Qr*jr,Yr),Wr=ur(Cr*Jr).pow_p_5_8;let Nr=(0,Nt.mod)(Cr*Qr*Wr,Yr);const Vr=(0,Nt.mod)(jr*Nr*Nr,Yr),Xr=Nr,qr=(0,Nt.mod)(Nr*tr,Yr),Or=Vr===Cr,Fr=Vr===(0,Nt.mod)(-Cr,Yr),Zr=Vr===(0,Nt.mod)(-Cr*tr,Yr);return Or&&(Nr=Xr),(Fr||Zr)&&(Nr=qr),(0,Nt.isNegativeLE)(Nr,Yr)&&(Nr=(0,Nt.mod)(-Nr,Yr)),{isValid:Or||Fr,value:Nr}}xt.ED25519_TORSION_SUBGROUP=["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"];const lr=(0,Nt.Field)(er,void 0,!0),yr={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:lr,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:dr,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:e.sha512,randomBytes:At.randomBytes,adjustScalarBytes:fr,uvRatio:pr};xt.ed25519=(0,kt.twistedEdwards)(yr);function br(Cr,jr,Yr){if(jr.length>255)throw new Error("Context is too big");return(0,At.concatBytes)((0,At.utf8ToBytes)("SigEd25519 no Ed25519 collisions"),new Uint8Array([Yr?1:0,jr.length]),jr,Cr)}xt.ed25519ctx=(0,kt.twistedEdwards)({...yr,domain:br}),xt.ed25519ph=(0,kt.twistedEdwards)(Object.assign({},yr,{domain:br,prehash:e.sha512})),xt.x25519=(0,jt.montgomery)({P:er,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:Cr=>{const jr=er,{pow_p_5_8:Yr,b2:Qr}=ur(Cr);return(0,Nt.mod)((0,Nt.pow2)(Yr,ir,jr)*Qr,jr)},adjustScalarBytes:fr,randomBytes:At.randomBytes});function Ar(Cr){const{y:jr}=xt.ed25519.ExtendedPoint.fromHex(Cr),Yr=BigInt(1);return lr.toBytes(lr.create((Yr+jr)*lr.inv(Yr-jr)))}xt.edwardsToMontgomery=Ar;function Pr(Cr){const jr=yr.hash(Cr.subarray(0,32));return yr.adjustScalarBytes(jr).subarray(0,32)}const kr=(lr.ORDER+ir)/dr,Ur=lr.pow(nr,kr),Hr=lr.sqrt(lr.neg(lr.ONE));function Lr(Cr){const jr=(lr.ORDER-ar)/dr,Yr=BigInt(486662);let Qr=lr.sqr(Cr);Qr=lr.mul(Qr,nr);let Jr=lr.add(Qr,lr.ONE),Wr=lr.neg(Yr),Nr=lr.sqr(Jr),Vr=lr.mul(Nr,Jr),Xr=lr.mul(Qr,Yr);Xr=lr.mul(Xr,Wr),Xr=lr.add(Xr,Nr),Xr=lr.mul(Xr,Wr);let qr=lr.sqr(Vr);Nr=lr.sqr(qr),qr=lr.mul(qr,Vr),qr=lr.mul(qr,Xr),Nr=lr.mul(Nr,qr);let Or=lr.pow(Nr,jr);Or=lr.mul(Or,qr);let Fr=lr.mul(Or,Hr);Nr=lr.sqr(Or),Nr=lr.mul(Nr,Vr);let Zr=lr.eql(Nr,Xr),rn=lr.cmov(Fr,Or,Zr),un=lr.mul(Wr,Qr),dn=lr.mul(Or,Cr);dn=lr.mul(dn,Ur);let vn=lr.mul(dn,Hr),$n=lr.mul(Xr,Qr);Nr=lr.sqr(dn),Nr=lr.mul(Nr,Vr);let en=lr.eql(Nr,$n),tn=lr.cmov(vn,dn,en);Nr=lr.sqr(rn),Nr=lr.mul(Nr,Vr);let hn=lr.eql(Nr,Xr),mn=lr.cmov(un,Wr,hn),yn=lr.cmov(tn,rn,hn),xn=lr.isOdd(yn);return yn=lr.cmov(yn,lr.neg(yn),hn!==xn),{xMn:mn,xMd:Jr,yMn:yn,yMd:rr}}const Sr=(0,Nt.FpSqrtEven)(lr,lr.neg(BigInt(486664)));function _r(Cr){const{xMn:jr,xMd:Yr,yMn:Qr,yMd:Jr}=Lr(Cr);let Wr=lr.mul(jr,Jr);Wr=lr.mul(Wr,Sr);let Nr=lr.mul(Yr,Qr),Vr=lr.sub(jr,Yr),Xr=lr.add(jr,Yr),qr=lr.mul(Nr,Xr),Or=lr.eql(qr,lr.ZERO);Wr=lr.cmov(Wr,lr.ZERO,Or),Nr=lr.cmov(Nr,lr.ONE,Or),Vr=lr.cmov(Vr,lr.ONE,Or),Xr=lr.cmov(Xr,lr.ONE,Or);const Fr=lr.invertBatch([Nr,Xr]);return{x:lr.mul(Wr,Fr[0]),y:lr.mul(Vr,Fr[1])}}const gr=(0,Bt.createHasher)(xt.ed25519.ExtendedPoint,Cr=>_r(Cr[0]),{DST:"edwards25519_XMD:SHA-512_ELL2_RO_",encodeDST:"edwards25519_XMD:SHA-512_ELL2_NU_",p:lr.ORDER,m:1,k:128,expand:"xmd",hash:e.sha512});xt.hashToCurve=gr.hashToCurve,xt.encodeToCurve=gr.encodeToCurve;function wr(Cr){if(!(Cr instanceof Gr))throw new Error("RistrettoPoint expected")}const Dr=tr,xr=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),Ir=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),$r=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),vr=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Er=Cr=>pr(rr,Cr),Tr=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Rr=Cr=>xt.ed25519.CURVE.Fp.create((0,Lt.bytesToNumberLE)(Cr)&Tr);function Mr(Cr){const{d:jr}=xt.ed25519.CURVE,Yr=xt.ed25519.CURVE.Fp.ORDER,Qr=xt.ed25519.CURVE.Fp.create,Jr=Qr(Dr*Cr*Cr),Wr=Qr((Jr+rr)*$r);let Nr=BigInt(-1);const Vr=Qr((Nr-jr*Jr)*Qr(Jr+jr));let{isValid:Xr,value:qr}=pr(Wr,Vr),Or=Qr(qr*Cr);(0,Nt.isNegativeLE)(Or,Yr)||(Or=Qr(-Or)),Xr||(qr=Or),Xr||(Nr=Jr);const Fr=Qr(Nr*(Jr-rr)*vr-Vr),Zr=qr*qr,rn=Qr((qr+qr)*Vr),un=Qr(Fr*xr),dn=Qr(rr-Zr),vn=Qr(rr+Zr);return new xt.ed25519.ExtendedPoint(Qr(rn*vn),Qr(dn*un),Qr(un*vn),Qr(rn*dn))}class Gr{constructor(jr){this.ep=jr}static fromAffine(jr){return new Gr(xt.ed25519.ExtendedPoint.fromAffine(jr))}static hashToCurve(jr){jr=(0,Lt.ensureBytes)("ristrettoHash",jr,64);const Yr=Rr(jr.slice(0,32)),Qr=Mr(Yr),Jr=Rr(jr.slice(32,64)),Wr=Mr(Jr);return new Gr(Qr.add(Wr))}static fromHex(jr){jr=(0,Lt.ensureBytes)("ristrettoHex",jr,32);const{a:Yr,d:Qr}=xt.ed25519.CURVE,Jr=xt.ed25519.CURVE.Fp.ORDER,Wr=xt.ed25519.CURVE.Fp.create,Nr="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",Vr=Rr(jr);if(!(0,Lt.equalBytes)((0,Lt.numberToBytesLE)(Vr,32),jr)||(0,Nt.isNegativeLE)(Vr,Jr))throw new Error(Nr);const Xr=Wr(Vr*Vr),qr=Wr(rr+Yr*Xr),Or=Wr(rr-Yr*Xr),Fr=Wr(qr*qr),Zr=Wr(Or*Or),rn=Wr(Yr*Qr*Fr-Zr),{isValid:un,value:dn}=Er(Wr(rn*Zr)),vn=Wr(dn*Or),$n=Wr(dn*vn*rn);let en=Wr((Vr+Vr)*vn);(0,Nt.isNegativeLE)(en,Jr)&&(en=Wr(-en));const tn=Wr(qr*$n),hn=Wr(en*tn);if(!un||(0,Nt.isNegativeLE)(hn,Jr)||tn===zt)throw new Error(Nr);return new Gr(new xt.ed25519.ExtendedPoint(en,tn,rr,hn))}toRawBytes(){let{ex:jr,ey:Yr,ez:Qr,et:Jr}=this.ep;const Wr=xt.ed25519.CURVE.Fp.ORDER,Nr=xt.ed25519.CURVE.Fp.create,Vr=Nr(Nr(Qr+Yr)*Nr(Qr-Yr)),Xr=Nr(jr*Yr),qr=Nr(Xr*Xr),{value:Or}=Er(Nr(Vr*qr)),Fr=Nr(Or*Vr),Zr=Nr(Or*Xr),rn=Nr(Fr*Zr*Jr);let un;if((0,Nt.isNegativeLE)(Jr*rn,Wr)){let vn=Nr(Yr*Dr),$n=Nr(jr*Dr);jr=vn,Yr=$n,un=Nr(Fr*Ir)}else un=Zr;(0,Nt.isNegativeLE)(jr*rn,Wr)&&(Yr=Nr(-Yr));let dn=Nr((Qr-Yr)*un);return(0,Nt.isNegativeLE)(dn,Wr)&&(dn=Nr(-dn)),(0,Lt.numberToBytesLE)(dn,32)}toHex(){return(0,Lt.bytesToHex)(this.toRawBytes())}toString(){return this.toHex()}equals(jr){wr(jr);const{ex:Yr,ey:Qr}=this.ep,{ex:Jr,ey:Wr}=jr.ep,Nr=xt.ed25519.CURVE.Fp.create,Vr=Nr(Yr*Wr)===Nr(Qr*Jr),Xr=Nr(Qr*Wr)===Nr(Yr*Jr);return Vr||Xr}add(jr){return wr(jr),new Gr(this.ep.add(jr.ep))}subtract(jr){return wr(jr),new Gr(this.ep.subtract(jr.ep))}multiply(jr){return new Gr(this.ep.multiply(jr))}multiplyUnsafe(jr){return new Gr(this.ep.multiplyUnsafe(jr))}double(){return new Gr(this.ep.double())}negate(){return new Gr(this.ep.negate())}}xt.RistrettoPoint=(Gr.BASE||(Gr.BASE=new Gr(xt.ed25519.ExtendedPoint.BASE)),Gr.ZERO||(Gr.ZERO=new Gr(xt.ed25519.ExtendedPoint.ZERO)),Gr);const Br=(Cr,jr)=>{const Yr=jr.DST,Qr=typeof Yr=="string"?(0,At.utf8ToBytes)(Yr):Yr,Jr=(0,Bt.expand_message_xmd)(Cr,Qr,64,e.sha512);return Gr.hashToCurve(Jr)};xt.hashToRistretto255=Br,xt.hash_to_ristretto255=xt.hashToRistretto255})(ed25519$1);var secp256k1$1={};const require$$0$2=getAugmentedNamespace(sha256$6);var _shortw_utils={};const require$$0$1=getAugmentedNamespace(hmac$4);var weierstrass$1={};(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.DER=void 0,xt.weierstrassPoints=ir,xt.weierstrass=dr,xt.SWUFpSqrtRatio=ur,xt.mapToCurveSimpleSWU=fr;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const e=curve,At=modular,kt=utils$3,Bt=utils$3;function Nt(pr){const lr=(0,e.validateBasic)(pr);kt.validateObject(lr,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:yr,Fp:br,a:Ar}=lr;if(yr){if(!br.eql(Ar,br.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof yr!="object"||typeof yr.beta!="bigint"||typeof yr.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...lr})}const{bytesToNumberBE:jt,hexToBytes:Lt}=kt;xt.DER={Err:class extends Error{constructor(lr=""){super(lr)}},_parseInt(pr){const{Err:lr}=xt.DER;if(pr.length<2||pr[0]!==2)throw new lr("Invalid signature integer tag");const yr=pr[1],br=pr.subarray(2,yr+2);if(!yr||br.length!==yr)throw new lr("Invalid signature integer: wrong length");if(br[0]&128)throw new lr("Invalid signature integer: negative");if(br[0]===0&&!(br[1]&128))throw new lr("Invalid signature integer: unnecessary leading zero");return{d:jt(br),l:pr.subarray(yr+2)}},toSig(pr){const{Err:lr}=xt.DER,yr=typeof pr=="string"?Lt(pr):pr;kt.abytes(yr);let br=yr.length;if(br<2||yr[0]!=48)throw new lr("Invalid signature tag");if(yr[1]!==br-2)throw new lr("Invalid signature: incorrect length");const{d:Ar,l:Pr}=xt.DER._parseInt(yr.subarray(2)),{d:kr,l:Ur}=xt.DER._parseInt(Pr);if(Ur.length)throw new lr("Invalid signature: left bytes after parsing");return{r:Ar,s:kr}},hexFromSig(pr){const lr=Lr=>Number.parseInt(Lr[0],16)&8?"00"+Lr:Lr,yr=Lr=>{const Sr=Lr.toString(16);return Sr.length&1?`0${Sr}`:Sr},br=lr(yr(pr.s)),Ar=lr(yr(pr.r)),Pr=br.length/2,kr=Ar.length/2,Ur=yr(Pr),Hr=yr(kr);return`30${yr(kr+Pr+4)}02${Hr}${Ar}02${Ur}${br}`}};const er=BigInt(0),tr=BigInt(1),zt=BigInt(2),rr=BigInt(3),nr=BigInt(4);function ir(pr){const lr=Nt(pr),{Fp:yr}=lr,br=lr.toBytes||((Dr,xr,Ir)=>{const $r=xr.toAffine();return kt.concatBytes(Uint8Array.from([4]),yr.toBytes($r.x),yr.toBytes($r.y))}),Ar=lr.fromBytes||(Dr=>{const xr=Dr.subarray(1),Ir=yr.fromBytes(xr.subarray(0,yr.BYTES)),$r=yr.fromBytes(xr.subarray(yr.BYTES,2*yr.BYTES));return{x:Ir,y:$r}});function Pr(Dr){const{a:xr,b:Ir}=lr,$r=yr.sqr(Dr),vr=yr.mul($r,Dr);return yr.add(yr.add(vr,yr.mul(Dr,xr)),Ir)}if(!yr.eql(yr.sqr(lr.Gy),Pr(lr.Gx)))throw new Error("bad generator point: equation left != right");function kr(Dr){return typeof Dr=="bigint"&&er<Dr&&Dr<lr.n}function Ur(Dr){if(!kr(Dr))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function Hr(Dr){const{allowedPrivateKeyLengths:xr,nByteLength:Ir,wrapPrivateKey:$r,n:vr}=lr;if(xr&&typeof Dr!="bigint"){if(kt.isBytes(Dr)&&(Dr=kt.bytesToHex(Dr)),typeof Dr!="string"||!xr.includes(Dr.length))throw new Error("Invalid key");Dr=Dr.padStart(Ir*2,"0")}let Er;try{Er=typeof Dr=="bigint"?Dr:kt.bytesToNumberBE((0,Bt.ensureBytes)("private key",Dr,Ir))}catch{throw new Error(`private key must be ${Ir} bytes, hex or bigint, not ${typeof Dr}`)}return $r&&(Er=At.mod(Er,vr)),Ur(Er),Er}const Lr=new Map;function Sr(Dr){if(!(Dr instanceof _r))throw new Error("ProjectivePoint expected")}class _r{constructor(xr,Ir,$r){if(this.px=xr,this.py=Ir,this.pz=$r,xr==null||!yr.isValid(xr))throw new Error("x required");if(Ir==null||!yr.isValid(Ir))throw new Error("y required");if($r==null||!yr.isValid($r))throw new Error("z required")}static fromAffine(xr){const{x:Ir,y:$r}=xr||{};if(!xr||!yr.isValid(Ir)||!yr.isValid($r))throw new Error("invalid affine point");if(xr instanceof _r)throw new Error("projective point not allowed");const vr=Er=>yr.eql(Er,yr.ZERO);return vr(Ir)&&vr($r)?_r.ZERO:new _r(Ir,$r,yr.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(xr){const Ir=yr.invertBatch(xr.map($r=>$r.pz));return xr.map(($r,vr)=>$r.toAffine(Ir[vr])).map(_r.fromAffine)}static fromHex(xr){const Ir=_r.fromAffine(Ar((0,Bt.ensureBytes)("pointHex",xr)));return Ir.assertValidity(),Ir}static fromPrivateKey(xr){return _r.BASE.multiply(Hr(xr))}_setWindowSize(xr){this._WINDOW_SIZE=xr,Lr.delete(this)}assertValidity(){if(this.is0()){if(lr.allowInfinityPoint&&!yr.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:xr,y:Ir}=this.toAffine();if(!yr.isValid(xr)||!yr.isValid(Ir))throw new Error("bad point: x or y not FE");const $r=yr.sqr(Ir),vr=Pr(xr);if(!yr.eql($r,vr))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:xr}=this.toAffine();if(yr.isOdd)return!yr.isOdd(xr);throw new Error("Field doesn't support isOdd")}equals(xr){Sr(xr);const{px:Ir,py:$r,pz:vr}=this,{px:Er,py:Tr,pz:Rr}=xr,Mr=yr.eql(yr.mul(Ir,Rr),yr.mul(Er,vr)),Gr=yr.eql(yr.mul($r,Rr),yr.mul(Tr,vr));return Mr&&Gr}negate(){return new _r(this.px,yr.neg(this.py),this.pz)}double(){const{a:xr,b:Ir}=lr,$r=yr.mul(Ir,rr),{px:vr,py:Er,pz:Tr}=this;let Rr=yr.ZERO,Mr=yr.ZERO,Gr=yr.ZERO,Br=yr.mul(vr,vr),Cr=yr.mul(Er,Er),jr=yr.mul(Tr,Tr),Yr=yr.mul(vr,Er);return Yr=yr.add(Yr,Yr),Gr=yr.mul(vr,Tr),Gr=yr.add(Gr,Gr),Rr=yr.mul(xr,Gr),Mr=yr.mul($r,jr),Mr=yr.add(Rr,Mr),Rr=yr.sub(Cr,Mr),Mr=yr.add(Cr,Mr),Mr=yr.mul(Rr,Mr),Rr=yr.mul(Yr,Rr),Gr=yr.mul($r,Gr),jr=yr.mul(xr,jr),Yr=yr.sub(Br,jr),Yr=yr.mul(xr,Yr),Yr=yr.add(Yr,Gr),Gr=yr.add(Br,Br),Br=yr.add(Gr,Br),Br=yr.add(Br,jr),Br=yr.mul(Br,Yr),Mr=yr.add(Mr,Br),jr=yr.mul(Er,Tr),jr=yr.add(jr,jr),Br=yr.mul(jr,Yr),Rr=yr.sub(Rr,Br),Gr=yr.mul(jr,Cr),Gr=yr.add(Gr,Gr),Gr=yr.add(Gr,Gr),new _r(Rr,Mr,Gr)}add(xr){Sr(xr);const{px:Ir,py:$r,pz:vr}=this,{px:Er,py:Tr,pz:Rr}=xr;let Mr=yr.ZERO,Gr=yr.ZERO,Br=yr.ZERO;const Cr=lr.a,jr=yr.mul(lr.b,rr);let Yr=yr.mul(Ir,Er),Qr=yr.mul($r,Tr),Jr=yr.mul(vr,Rr),Wr=yr.add(Ir,$r),Nr=yr.add(Er,Tr);Wr=yr.mul(Wr,Nr),Nr=yr.add(Yr,Qr),Wr=yr.sub(Wr,Nr),Nr=yr.add(Ir,vr);let Vr=yr.add(Er,Rr);return Nr=yr.mul(Nr,Vr),Vr=yr.add(Yr,Jr),Nr=yr.sub(Nr,Vr),Vr=yr.add($r,vr),Mr=yr.add(Tr,Rr),Vr=yr.mul(Vr,Mr),Mr=yr.add(Qr,Jr),Vr=yr.sub(Vr,Mr),Br=yr.mul(Cr,Nr),Mr=yr.mul(jr,Jr),Br=yr.add(Mr,Br),Mr=yr.sub(Qr,Br),Br=yr.add(Qr,Br),Gr=yr.mul(Mr,Br),Qr=yr.add(Yr,Yr),Qr=yr.add(Qr,Yr),Jr=yr.mul(Cr,Jr),Nr=yr.mul(jr,Nr),Qr=yr.add(Qr,Jr),Jr=yr.sub(Yr,Jr),Jr=yr.mul(Cr,Jr),Nr=yr.add(Nr,Jr),Yr=yr.mul(Qr,Nr),Gr=yr.add(Gr,Yr),Yr=yr.mul(Vr,Nr),Mr=yr.mul(Wr,Mr),Mr=yr.sub(Mr,Yr),Yr=yr.mul(Wr,Qr),Br=yr.mul(Vr,Br),Br=yr.add(Br,Yr),new _r(Mr,Gr,Br)}subtract(xr){return this.add(xr.negate())}is0(){return this.equals(_r.ZERO)}wNAF(xr){return wr.wNAFCached(this,Lr,xr,Ir=>{const $r=yr.invertBatch(Ir.map(vr=>vr.pz));return Ir.map((vr,Er)=>vr.toAffine($r[Er])).map(_r.fromAffine)})}multiplyUnsafe(xr){const Ir=_r.ZERO;if(xr===er)return Ir;if(Ur(xr),xr===tr)return this;const{endo:$r}=lr;if(!$r)return wr.unsafeLadder(this,xr);let{k1neg:vr,k1:Er,k2neg:Tr,k2:Rr}=$r.splitScalar(xr),Mr=Ir,Gr=Ir,Br=this;for(;Er>er||Rr>er;)Er&tr&&(Mr=Mr.add(Br)),Rr&tr&&(Gr=Gr.add(Br)),Br=Br.double(),Er>>=tr,Rr>>=tr;return vr&&(Mr=Mr.negate()),Tr&&(Gr=Gr.negate()),Gr=new _r(yr.mul(Gr.px,$r.beta),Gr.py,Gr.pz),Mr.add(Gr)}multiply(xr){Ur(xr);let Ir=xr,$r,vr;const{endo:Er}=lr;if(Er){const{k1neg:Tr,k1:Rr,k2neg:Mr,k2:Gr}=Er.splitScalar(Ir);let{p:Br,f:Cr}=this.wNAF(Rr),{p:jr,f:Yr}=this.wNAF(Gr);Br=wr.constTimeNegate(Tr,Br),jr=wr.constTimeNegate(Mr,jr),jr=new _r(yr.mul(jr.px,Er.beta),jr.py,jr.pz),$r=Br.add(jr),vr=Cr.add(Yr)}else{const{p:Tr,f:Rr}=this.wNAF(Ir);$r=Tr,vr=Rr}return _r.normalizeZ([$r,vr])[0]}multiplyAndAddUnsafe(xr,Ir,$r){const vr=_r.BASE,Er=(Rr,Mr)=>Mr===er||Mr===tr||!Rr.equals(vr)?Rr.multiplyUnsafe(Mr):Rr.multiply(Mr),Tr=Er(this,Ir).add(Er(xr,$r));return Tr.is0()?void 0:Tr}toAffine(xr){const{px:Ir,py:$r,pz:vr}=this,Er=this.is0();xr==null&&(xr=Er?yr.ONE:yr.inv(vr));const Tr=yr.mul(Ir,xr),Rr=yr.mul($r,xr),Mr=yr.mul(vr,xr);if(Er)return{x:yr.ZERO,y:yr.ZERO};if(!yr.eql(Mr,yr.ONE))throw new Error("invZ was invalid");return{x:Tr,y:Rr}}isTorsionFree(){const{h:xr,isTorsionFree:Ir}=lr;if(xr===tr)return!0;if(Ir)return Ir(_r,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:xr,clearCofactor:Ir}=lr;return xr===tr?this:Ir?Ir(_r,this):this.multiplyUnsafe(lr.h)}toRawBytes(xr=!0){return this.assertValidity(),br(_r,this,xr)}toHex(xr=!0){return kt.bytesToHex(this.toRawBytes(xr))}}_r.BASE=new _r(lr.Gx,lr.Gy,yr.ONE),_r.ZERO=new _r(yr.ZERO,yr.ONE,yr.ZERO);const gr=lr.nBitLength,wr=(0,e.wNAF)(_r,lr.endo?Math.ceil(gr/2):gr);return{CURVE:lr,ProjectivePoint:_r,normPrivateKeyToScalar:Hr,weierstrassEquation:Pr,isWithinCurveOrder:kr}}function ar(pr){const lr=(0,e.validateBasic)(pr);return kt.validateObject(lr,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...lr})}function dr(pr){const lr=ar(pr),{Fp:yr,n:br}=lr,Ar=yr.BYTES+1,Pr=2*yr.BYTES+1;function kr(Nr){return er<Nr&&Nr<yr.ORDER}function Ur(Nr){return At.mod(Nr,br)}function Hr(Nr){return At.invert(Nr,br)}const{ProjectivePoint:Lr,normPrivateKeyToScalar:Sr,weierstrassEquation:_r,isWithinCurveOrder:gr}=ir({...lr,toBytes(Nr,Vr,Xr){const qr=Vr.toAffine(),Or=yr.toBytes(qr.x),Fr=kt.concatBytes;return Xr?Fr(Uint8Array.from([Vr.hasEvenY()?2:3]),Or):Fr(Uint8Array.from([4]),Or,yr.toBytes(qr.y))},fromBytes(Nr){const Vr=Nr.length,Xr=Nr[0],qr=Nr.subarray(1);if(Vr===Ar&&(Xr===2||Xr===3)){const Or=kt.bytesToNumberBE(qr);if(!kr(Or))throw new Error("Point is not on curve");const Fr=_r(Or);let Zr;try{Zr=yr.sqrt(Fr)}catch(dn){const vn=dn instanceof Error?": "+dn.message:"";throw new Error("Point is not on curve"+vn)}const rn=(Zr&tr)===tr;return(Xr&1)===1!==rn&&(Zr=yr.neg(Zr)),{x:Or,y:Zr}}else if(Vr===Pr&&Xr===4){const Or=yr.fromBytes(qr.subarray(0,yr.BYTES)),Fr=yr.fromBytes(qr.subarray(yr.BYTES,2*yr.BYTES));return{x:Or,y:Fr}}else throw new Error(`Point of length ${Vr} was invalid. Expected ${Ar} compressed bytes or ${Pr} uncompressed bytes`)}}),wr=Nr=>kt.bytesToHex(kt.numberToBytesBE(Nr,lr.nByteLength));function Dr(Nr){const Vr=br>>tr;return Nr>Vr}function xr(Nr){return Dr(Nr)?Ur(-Nr):Nr}const Ir=(Nr,Vr,Xr)=>kt.bytesToNumberBE(Nr.slice(Vr,Xr));class $r{constructor(Vr,Xr,qr){this.r=Vr,this.s=Xr,this.recovery=qr,this.assertValidity()}static fromCompact(Vr){const Xr=lr.nByteLength;return Vr=(0,Bt.ensureBytes)("compactSignature",Vr,Xr*2),new $r(Ir(Vr,0,Xr),Ir(Vr,Xr,2*Xr))}static fromDER(Vr){const{r:Xr,s:qr}=xt.DER.toSig((0,Bt.ensureBytes)("DER",Vr));return new $r(Xr,qr)}assertValidity(){if(!gr(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!gr(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Vr){return new $r(this.r,this.s,Vr)}recoverPublicKey(Vr){const{r:Xr,s:qr,recovery:Or}=this,Fr=Gr((0,Bt.ensureBytes)("msgHash",Vr));if(Or==null||![0,1,2,3].includes(Or))throw new Error("recovery id invalid");const Zr=Or===2||Or===3?Xr+lr.n:Xr;if(Zr>=yr.ORDER)throw new Error("recovery id 2 or 3 invalid");const rn=Or&1?"03":"02",un=Lr.fromHex(rn+wr(Zr)),dn=Hr(Zr),vn=Ur(-Fr*dn),$n=Ur(qr*dn),en=Lr.BASE.multiplyAndAddUnsafe(un,vn,$n);if(!en)throw new Error("point at infinify");return en.assertValidity(),en}hasHighS(){return Dr(this.s)}normalizeS(){return this.hasHighS()?new $r(this.r,Ur(-this.s),this.recovery):this}toDERRawBytes(){return kt.hexToBytes(this.toDERHex())}toDERHex(){return xt.DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return kt.hexToBytes(this.toCompactHex())}toCompactHex(){return wr(this.r)+wr(this.s)}}const vr={isValidPrivateKey(Nr){try{return Sr(Nr),!0}catch{return!1}},normPrivateKeyToScalar:Sr,randomPrivateKey:()=>{const Nr=At.getMinHashLength(lr.n);return At.mapHashToField(lr.randomBytes(Nr),lr.n)},precompute(Nr=8,Vr=Lr.BASE){return Vr._setWindowSize(Nr),Vr.multiply(BigInt(3)),Vr}};function Er(Nr,Vr=!0){return Lr.fromPrivateKey(Nr).toRawBytes(Vr)}function Tr(Nr){const Vr=kt.isBytes(Nr),Xr=typeof Nr=="string",qr=(Vr||Xr)&&Nr.length;return Vr?qr===Ar||qr===Pr:Xr?qr===2*Ar||qr===2*Pr:Nr instanceof Lr}function Rr(Nr,Vr,Xr=!0){if(Tr(Nr))throw new Error("first arg must be private key");if(!Tr(Vr))throw new Error("second arg must be public key");return Lr.fromHex(Vr).multiply(Sr(Nr)).toRawBytes(Xr)}const Mr=lr.bits2int||function(Nr){const Vr=kt.bytesToNumberBE(Nr),Xr=Nr.length*8-lr.nBitLength;return Xr>0?Vr>>BigInt(Xr):Vr},Gr=lr.bits2int_modN||function(Nr){return Ur(Mr(Nr))},Br=kt.bitMask(lr.nBitLength);function Cr(Nr){if(typeof Nr!="bigint")throw new Error("bigint expected");if(!(er<=Nr&&Nr<Br))throw new Error(`bigint expected < 2^${lr.nBitLength}`);return kt.numberToBytesBE(Nr,lr.nByteLength)}function jr(Nr,Vr,Xr=Yr){if(["recovered","canonical"].some(hn=>hn in Xr))throw new Error("sign() legacy options not supported");const{hash:qr,randomBytes:Or}=lr;let{lowS:Fr,prehash:Zr,extraEntropy:rn}=Xr;Fr==null&&(Fr=!0),Nr=(0,Bt.ensureBytes)("msgHash",Nr),Zr&&(Nr=(0,Bt.ensureBytes)("prehashed msgHash",qr(Nr)));const un=Gr(Nr),dn=Sr(Vr),vn=[Cr(dn),Cr(un)];if(rn!=null&&rn!==!1){const hn=rn===!0?Or(yr.BYTES):rn;vn.push((0,Bt.ensureBytes)("extraEntropy",hn))}const $n=kt.concatBytes(...vn),en=un;function tn(hn){const mn=Mr(hn);if(!gr(mn))return;const yn=Hr(mn),xn=Lr.BASE.multiply(mn).toAffine(),In=Ur(xn.x);if(In===er)return;const On=Ur(yn*Ur(en+In*dn));if(On===er)return;let Dn=(xn.x===In?0:2)|Number(xn.y&tr),Yn=On;return Fr&&Dr(On)&&(Yn=xr(On),Dn^=1),new $r(In,Yn,Dn)}return{seed:$n,k2sig:tn}}const Yr={lowS:lr.lowS,prehash:!1},Qr={lowS:lr.lowS,prehash:!1};function Jr(Nr,Vr,Xr=Yr){const{seed:qr,k2sig:Or}=jr(Nr,Vr,Xr),Fr=lr;return kt.createHmacDrbg(Fr.hash.outputLen,Fr.nByteLength,Fr.hmac)(qr,Or)}Lr.BASE._setWindowSize(8);function Wr(Nr,Vr,Xr,qr=Qr){var xn;const Or=Nr;if(Vr=(0,Bt.ensureBytes)("msgHash",Vr),Xr=(0,Bt.ensureBytes)("publicKey",Xr),"strict"in qr)throw new Error("options.strict was renamed to lowS");const{lowS:Fr,prehash:Zr}=qr;let rn,un;try{if(typeof Or=="string"||kt.isBytes(Or))try{rn=$r.fromDER(Or)}catch(In){if(!(In instanceof xt.DER.Err))throw In;rn=$r.fromCompact(Or)}else if(typeof Or=="object"&&typeof Or.r=="bigint"&&typeof Or.s=="bigint"){const{r:In,s:On}=Or;rn=new $r(In,On)}else throw new Error("PARSE");un=Lr.fromHex(Xr)}catch(In){if(In.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(Fr&&rn.hasHighS())return!1;Zr&&(Vr=lr.hash(Vr));const{r:dn,s:vn}=rn,$n=Gr(Vr),en=Hr(vn),tn=Ur($n*en),hn=Ur(dn*en),mn=(xn=Lr.BASE.multiplyAndAddUnsafe(un,tn,hn))==null?void 0:xn.toAffine();return mn?Ur(mn.x)===dn:!1}return{CURVE:lr,getPublicKey:Er,getSharedSecret:Rr,sign:Jr,verify:Wr,ProjectivePoint:Lr,Signature:$r,utils:vr}}function ur(pr,lr){const yr=pr.ORDER;let br=er;for(let Dr=yr-tr;Dr%zt===er;Dr/=zt)br+=tr;const Ar=br,Pr=zt<<Ar-tr-tr,kr=Pr*zt,Ur=(yr-tr)/kr,Hr=(Ur-tr)/zt,Lr=kr-tr,Sr=Pr,_r=pr.pow(lr,Ur),gr=pr.pow(lr,(Ur+tr)/zt);let wr=(Dr,xr)=>{let Ir=_r,$r=pr.pow(xr,Lr),vr=pr.sqr($r);vr=pr.mul(vr,xr);let Er=pr.mul(Dr,vr);Er=pr.pow(Er,Hr),Er=pr.mul(Er,$r),$r=pr.mul(Er,xr),vr=pr.mul(Er,Dr);let Tr=pr.mul(vr,$r);Er=pr.pow(Tr,Sr);let Rr=pr.eql(Er,pr.ONE);$r=pr.mul(vr,gr),Er=pr.mul(Tr,Ir),vr=pr.cmov($r,vr,Rr),Tr=pr.cmov(Er,Tr,Rr);for(let Mr=Ar;Mr>tr;Mr--){let Gr=Mr-zt;Gr=zt<<Gr-tr;let Br=pr.pow(Tr,Gr);const Cr=pr.eql(Br,pr.ONE);$r=pr.mul(vr,Ir),Ir=pr.mul(Ir,Ir),Br=pr.mul(Tr,Ir),vr=pr.cmov($r,vr,Cr),Tr=pr.cmov(Br,Tr,Cr)}return{isValid:Rr,value:vr}};if(pr.ORDER%nr===rr){const Dr=(pr.ORDER-rr)/nr,xr=pr.sqrt(pr.neg(lr));wr=(Ir,$r)=>{let vr=pr.sqr($r);const Er=pr.mul(Ir,$r);vr=pr.mul(vr,Er);let Tr=pr.pow(vr,Dr);Tr=pr.mul(Tr,Er);const Rr=pr.mul(Tr,xr),Mr=pr.mul(pr.sqr(Tr),$r),Gr=pr.eql(Mr,Ir);let Br=pr.cmov(Rr,Tr,Gr);return{isValid:Gr,value:Br}}}return wr}function fr(pr,lr){if(At.validateField(pr),!pr.isValid(lr.A)||!pr.isValid(lr.B)||!pr.isValid(lr.Z))throw new Error("mapToCurveSimpleSWU: invalid opts");const yr=ur(pr,lr.Z);if(!pr.isOdd)throw new Error("Fp.isOdd is not implemented!");return br=>{let Ar,Pr,kr,Ur,Hr,Lr,Sr,_r;Ar=pr.sqr(br),Ar=pr.mul(Ar,lr.Z),Pr=pr.sqr(Ar),Pr=pr.add(Pr,Ar),kr=pr.add(Pr,pr.ONE),kr=pr.mul(kr,lr.B),Ur=pr.cmov(lr.Z,pr.neg(Pr),!pr.eql(Pr,pr.ZERO)),Ur=pr.mul(Ur,lr.A),Pr=pr.sqr(kr),Lr=pr.sqr(Ur),Hr=pr.mul(Lr,lr.A),Pr=pr.add(Pr,Hr),Pr=pr.mul(Pr,kr),Lr=pr.mul(Lr,Ur),Hr=pr.mul(Lr,lr.B),Pr=pr.add(Pr,Hr),Sr=pr.mul(Ar,kr);const{isValid:gr,value:wr}=yr(Pr,Lr);_r=pr.mul(Ar,br),_r=pr.mul(_r,wr),Sr=pr.cmov(Sr,kr,gr),_r=pr.cmov(_r,wr,gr);const Dr=pr.isOdd(br)===pr.isOdd(_r);return _r=pr.cmov(pr.neg(_r),_r,Dr),Sr=pr.div(Sr,Ur),{x:Sr,y:_r}}}})(weierstrass$1);Object.defineProperty(_shortw_utils,"__esModule",{value:!0});_shortw_utils.getHash=getHash$1;_shortw_utils.createCurve=createCurve$1;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const hmac_1=require$$0$1,utils_1$6=require$$1$1,weierstrass_js_1=weierstrass$1;function getHash$1(xt){return{hash:xt,hmac:(e,...At)=>(0,hmac_1.hmac)(xt,e,(0,utils_1$6.concatBytes)(...At)),randomBytes:utils_1$6.randomBytes}}function createCurve$1(xt,e){const At=kt=>(0,weierstrass_js_1.weierstrass)({...xt,...getHash$1(kt)});return Object.freeze({...At(e),create:At})}(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.encodeToCurve=xt.hashToCurve=xt.schnorr=xt.secp256k1=void 0;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const e=require$$0$2,At=require$$1$1,kt=_shortw_utils,Bt=hashToCurve,Nt=modular,jt=utils$3,Lt=weierstrass$1,er=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),tr=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),zt=BigInt(1),rr=BigInt(2),nr=($r,vr)=>($r+vr/rr)/vr;function ir($r){const vr=er,Er=BigInt(3),Tr=BigInt(6),Rr=BigInt(11),Mr=BigInt(22),Gr=BigInt(23),Br=BigInt(44),Cr=BigInt(88),jr=$r*$r*$r%vr,Yr=jr*jr*$r%vr,Qr=(0,Nt.pow2)(Yr,Er,vr)*Yr%vr,Jr=(0,Nt.pow2)(Qr,Er,vr)*Yr%vr,Wr=(0,Nt.pow2)(Jr,rr,vr)*jr%vr,Nr=(0,Nt.pow2)(Wr,Rr,vr)*Wr%vr,Vr=(0,Nt.pow2)(Nr,Mr,vr)*Nr%vr,Xr=(0,Nt.pow2)(Vr,Br,vr)*Vr%vr,qr=(0,Nt.pow2)(Xr,Cr,vr)*Xr%vr,Or=(0,Nt.pow2)(qr,Br,vr)*Vr%vr,Fr=(0,Nt.pow2)(Or,Er,vr)*Yr%vr,Zr=(0,Nt.pow2)(Fr,Gr,vr)*Nr%vr,rn=(0,Nt.pow2)(Zr,Tr,vr)*jr%vr,un=(0,Nt.pow2)(rn,rr,vr);if(!ar.eql(ar.sqr(un),$r))throw new Error("Cannot find square root");return un}const ar=(0,Nt.Field)(er,void 0,void 0,{sqrt:ir});xt.secp256k1=(0,kt.createCurve)({a:BigInt(0),b:BigInt(7),Fp:ar,n:tr,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:$r=>{const vr=tr,Er=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),Tr=-zt*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),Rr=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),Mr=Er,Gr=BigInt("0x100000000000000000000000000000000"),Br=nr(Mr*$r,vr),Cr=nr(-Tr*$r,vr);let jr=(0,Nt.mod)($r-Br*Er-Cr*Rr,vr),Yr=(0,Nt.mod)(-Br*Tr-Cr*Mr,vr);const Qr=jr>Gr,Jr=Yr>Gr;if(Qr&&(jr=vr-jr),Jr&&(Yr=vr-Yr),jr>Gr||Yr>Gr)throw new Error("splitScalar: Endomorphism failed, k="+$r);return{k1neg:Qr,k1:jr,k2neg:Jr,k2:Yr}}}},e.sha256);const dr=BigInt(0),ur=$r=>typeof $r=="bigint"&&dr<$r&&$r<er,fr=$r=>typeof $r=="bigint"&&dr<$r&&$r<tr,pr={};function lr($r,...vr){let Er=pr[$r];if(Er===void 0){const Tr=(0,e.sha256)(Uint8Array.from($r,Rr=>Rr.charCodeAt(0)));Er=(0,jt.concatBytes)(Tr,Tr),pr[$r]=Er}return(0,e.sha256)((0,jt.concatBytes)(Er,...vr))}const yr=$r=>$r.toRawBytes(!0).slice(1),br=$r=>(0,jt.numberToBytesBE)($r,32),Ar=$r=>(0,Nt.mod)($r,er),Pr=$r=>(0,Nt.mod)($r,tr),kr=xt.secp256k1.ProjectivePoint,Ur=($r,vr,Er)=>kr.BASE.multiplyAndAddUnsafe($r,vr,Er);function Hr($r){let vr=xt.secp256k1.utils.normPrivateKeyToScalar($r),Er=kr.fromPrivateKey(vr);return{scalar:Er.hasEvenY()?vr:Pr(-vr),bytes:yr(Er)}}function Lr($r){if(!ur($r))throw new Error("bad x: need 0 < x < p");const vr=Ar($r*$r),Er=Ar(vr*$r+BigInt(7));let Tr=ir(Er);Tr%rr!==dr&&(Tr=Ar(-Tr));const Rr=new kr($r,Tr,zt);return Rr.assertValidity(),Rr}function Sr(...$r){return Pr((0,jt.bytesToNumberBE)(lr("BIP0340/challenge",...$r)))}function _r($r){return Hr($r).bytes}function gr($r,vr,Er=(0,At.randomBytes)(32)){const Tr=(0,jt.ensureBytes)("message",$r),{bytes:Rr,scalar:Mr}=Hr(vr),Gr=(0,jt.ensureBytes)("auxRand",Er,32),Br=br(Mr^(0,jt.bytesToNumberBE)(lr("BIP0340/aux",Gr))),Cr=lr("BIP0340/nonce",Br,Rr,Tr),jr=Pr((0,jt.bytesToNumberBE)(Cr));if(jr===dr)throw new Error("sign failed: k is zero");const{bytes:Yr,scalar:Qr}=Hr(jr),Jr=Sr(Yr,Rr,Tr),Wr=new Uint8Array(64);if(Wr.set(Yr,0),Wr.set(br(Pr(Qr+Jr*Mr)),32),!wr(Wr,Tr,Rr))throw new Error("sign: Invalid signature produced");return Wr}function wr($r,vr,Er){const Tr=(0,jt.ensureBytes)("signature",$r,64),Rr=(0,jt.ensureBytes)("message",vr),Mr=(0,jt.ensureBytes)("publicKey",Er,32);try{const Gr=Lr((0,jt.bytesToNumberBE)(Mr)),Br=(0,jt.bytesToNumberBE)(Tr.subarray(0,32));if(!ur(Br))return!1;const Cr=(0,jt.bytesToNumberBE)(Tr.subarray(32,64));if(!fr(Cr))return!1;const jr=Sr(br(Br),yr(Gr),Rr),Yr=Ur(Gr,Cr,Pr(-jr));return!(!Yr||!Yr.hasEvenY()||Yr.toAffine().x!==Br)}catch{return!1}}xt.schnorr={getPublicKey:_r,sign:gr,verify:wr,utils:{randomPrivateKey:xt.secp256k1.utils.randomPrivateKey,lift_x:Lr,pointToBytes:yr,numberToBytesBE:jt.numberToBytesBE,bytesToNumberBE:jt.bytesToNumberBE,taggedHash:lr,mod:Nt.mod}};const Dr=(0,Bt.isogenyMap)(ar,[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map($r=>$r.map(vr=>BigInt(vr)))),xr=(0,Lt.mapToCurveSimpleSWU)(ar,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:ar.create(BigInt("-11"))}),Ir=(0,Bt.createHasher)(xt.secp256k1.ProjectivePoint,$r=>{const{x:vr,y:Er}=xr(ar.create($r[0]));return Dr(vr,Er)},{DST:"secp256k1_XMD:SHA-256_SSWU_RO_",encodeDST:"secp256k1_XMD:SHA-256_SSWU_NU_",p:ar.ORDER,m:1,k:128,expand:"xmd",hash:e.sha256});xt.hashToCurve=Ir.hashToCurve,xt.encodeToCurve=Ir.encodeToCurve})(secp256k1$1);var hex={};Object.defineProperty(hex,"__esModule",{value:!0});hex.decodeHex=hex.remove0x=void 0;var utils_1$5=utils$7;function remove0x(xt){return xt.startsWith("0x")||xt.startsWith("0X")?xt.slice(2):xt}hex.remove0x=remove0x;function decodeHex(xt){return(0,utils_1$5.hexToBytes)(remove0x(xt))}hex.decodeHex=decodeHex;var symmetric={},chacha={},_poly1305={},_assert={};Object.defineProperty(_assert,"__esModule",{value:!0});_assert.output=_assert.exists=_assert.hash=_assert.bytes=_assert.bool=_assert.number=void 0;function number$2(xt){if(!Number.isSafeInteger(xt)||xt<0)throw new Error(`Wrong positive integer: ${xt}`)}_assert.number=number$2;function bool$1(xt){if(typeof xt!="boolean")throw new Error(`Expected boolean, not ${xt}`)}_assert.bool=bool$1;function bytes$3(xt,...e){if(!(xt instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(xt.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${xt.length}`)}_assert.bytes=bytes$3;function hash$1(xt){if(typeof xt!="function"||typeof xt.create!="function")throw new Error("hash must be wrapped by utils.wrapConstructor");number$2(xt.outputLen),number$2(xt.blockLen)}_assert.hash=hash$1;function exists$3(xt,e=!0){if(xt.destroyed)throw new Error("Hash instance has been destroyed");if(e&&xt.finished)throw new Error("Hash#digest() has already been called")}_assert.exists=exists$3;function output$3(xt,e){bytes$3(xt);const At=e.outputLen;if(xt.length<At)throw new Error(`digestInto() expects output buffer of length at least ${At}`)}_assert.output=output$3;const assert$2={number:number$2,bool:bool$1,bytes:bytes$3,hash:hash$1,exists:exists$3,output:output$3};_assert.default=assert$2;Object.defineProperty(_poly1305,"__esModule",{value:!0});_poly1305.poly1305=_poly1305.wrapConstructorWithKey=void 0;const utils_js_1$3=utils$7,_assert_js_1$2=_assert,u8to16$2=(xt,e)=>xt[e++]&255|(xt[e++]&255)<<8;let Poly1305$2=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=(0,utils_js_1$3.toBytes)(e),(0,utils_js_1$3.ensureBytes)(e,32);const At=u8to16$2(e,0),kt=u8to16$2(e,2),Bt=u8to16$2(e,4),Nt=u8to16$2(e,6),jt=u8to16$2(e,8),Lt=u8to16$2(e,10),er=u8to16$2(e,12),tr=u8to16$2(e,14);this.r[0]=At&8191,this.r[1]=(At>>>13|kt<<3)&8191,this.r[2]=(kt>>>10|Bt<<6)&7939,this.r[3]=(Bt>>>7|Nt<<9)&8191,this.r[4]=(Nt>>>4|jt<<12)&255,this.r[5]=jt>>>1&8190,this.r[6]=(jt>>>14|Lt<<2)&8191,this.r[7]=(Lt>>>11|er<<5)&8065,this.r[8]=(er>>>8|tr<<8)&8191,this.r[9]=tr>>>5&127;for(let zt=0;zt<8;zt++)this.pad[zt]=u8to16$2(e,16+2*zt)}process(e,At,kt=!1){const Bt=kt?0:2048,{h:Nt,r:jt}=this,Lt=jt[0],er=jt[1],tr=jt[2],zt=jt[3],rr=jt[4],nr=jt[5],ir=jt[6],ar=jt[7],dr=jt[8],ur=jt[9],fr=u8to16$2(e,At+0),pr=u8to16$2(e,At+2),lr=u8to16$2(e,At+4),yr=u8to16$2(e,At+6),br=u8to16$2(e,At+8),Ar=u8to16$2(e,At+10),Pr=u8to16$2(e,At+12),kr=u8to16$2(e,At+14);let Ur=Nt[0]+(fr&8191),Hr=Nt[1]+((fr>>>13|pr<<3)&8191),Lr=Nt[2]+((pr>>>10|lr<<6)&8191),Sr=Nt[3]+((lr>>>7|yr<<9)&8191),_r=Nt[4]+((yr>>>4|br<<12)&8191),gr=Nt[5]+(br>>>1&8191),wr=Nt[6]+((br>>>14|Ar<<2)&8191),Dr=Nt[7]+((Ar>>>11|Pr<<5)&8191),xr=Nt[8]+((Pr>>>8|kr<<8)&8191),Ir=Nt[9]+(kr>>>5|Bt),$r=0,vr=$r+Ur*Lt+Hr*(5*ur)+Lr*(5*dr)+Sr*(5*ar)+_r*(5*ir);$r=vr>>>13,vr&=8191,vr+=gr*(5*nr)+wr*(5*rr)+Dr*(5*zt)+xr*(5*tr)+Ir*(5*er),$r+=vr>>>13,vr&=8191;let Er=$r+Ur*er+Hr*Lt+Lr*(5*ur)+Sr*(5*dr)+_r*(5*ar);$r=Er>>>13,Er&=8191,Er+=gr*(5*ir)+wr*(5*nr)+Dr*(5*rr)+xr*(5*zt)+Ir*(5*tr),$r+=Er>>>13,Er&=8191;let Tr=$r+Ur*tr+Hr*er+Lr*Lt+Sr*(5*ur)+_r*(5*dr);$r=Tr>>>13,Tr&=8191,Tr+=gr*(5*ar)+wr*(5*ir)+Dr*(5*nr)+xr*(5*rr)+Ir*(5*zt),$r+=Tr>>>13,Tr&=8191;let Rr=$r+Ur*zt+Hr*tr+Lr*er+Sr*Lt+_r*(5*ur);$r=Rr>>>13,Rr&=8191,Rr+=gr*(5*dr)+wr*(5*ar)+Dr*(5*ir)+xr*(5*nr)+Ir*(5*rr),$r+=Rr>>>13,Rr&=8191;let Mr=$r+Ur*rr+Hr*zt+Lr*tr+Sr*er+_r*Lt;$r=Mr>>>13,Mr&=8191,Mr+=gr*(5*ur)+wr*(5*dr)+Dr*(5*ar)+xr*(5*ir)+Ir*(5*nr),$r+=Mr>>>13,Mr&=8191;let Gr=$r+Ur*nr+Hr*rr+Lr*zt+Sr*tr+_r*er;$r=Gr>>>13,Gr&=8191,Gr+=gr*Lt+wr*(5*ur)+Dr*(5*dr)+xr*(5*ar)+Ir*(5*ir),$r+=Gr>>>13,Gr&=8191;let Br=$r+Ur*ir+Hr*nr+Lr*rr+Sr*zt+_r*tr;$r=Br>>>13,Br&=8191,Br+=gr*er+wr*Lt+Dr*(5*ur)+xr*(5*dr)+Ir*(5*ar),$r+=Br>>>13,Br&=8191;let Cr=$r+Ur*ar+Hr*ir+Lr*nr+Sr*rr+_r*zt;$r=Cr>>>13,Cr&=8191,Cr+=gr*tr+wr*er+Dr*Lt+xr*(5*ur)+Ir*(5*dr),$r+=Cr>>>13,Cr&=8191;let jr=$r+Ur*dr+Hr*ar+Lr*ir+Sr*nr+_r*rr;$r=jr>>>13,jr&=8191,jr+=gr*zt+wr*tr+Dr*er+xr*Lt+Ir*(5*ur),$r+=jr>>>13,jr&=8191;let Yr=$r+Ur*ur+Hr*dr+Lr*ar+Sr*ir+_r*nr;$r=Yr>>>13,Yr&=8191,Yr+=gr*rr+wr*zt+Dr*tr+xr*er+Ir*Lt,$r+=Yr>>>13,Yr&=8191,$r=($r<<2)+$r|0,$r=$r+vr|0,vr=$r&8191,$r=$r>>>13,Er+=$r,Nt[0]=vr,Nt[1]=Er,Nt[2]=Tr,Nt[3]=Rr,Nt[4]=Mr,Nt[5]=Gr,Nt[6]=Br,Nt[7]=Cr,Nt[8]=jr,Nt[9]=Yr}finalize(){const{h:e,pad:At}=this,kt=new Uint16Array(10);let Bt=e[1]>>>13;e[1]&=8191;for(let Lt=2;Lt<10;Lt++)e[Lt]+=Bt,Bt=e[Lt]>>>13,e[Lt]&=8191;e[0]+=Bt*5,Bt=e[0]>>>13,e[0]&=8191,e[1]+=Bt,Bt=e[1]>>>13,e[1]&=8191,e[2]+=Bt,kt[0]=e[0]+5,Bt=kt[0]>>>13,kt[0]&=8191;for(let Lt=1;Lt<10;Lt++)kt[Lt]=e[Lt]+Bt,Bt=kt[Lt]>>>13,kt[Lt]&=8191;kt[9]-=8192;let Nt=(Bt^1)-1;for(let Lt=0;Lt<10;Lt++)kt[Lt]&=Nt;Nt=~Nt;for(let Lt=0;Lt<10;Lt++)e[Lt]=e[Lt]&Nt|kt[Lt];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let jt=e[0]+At[0];e[0]=jt&65535;for(let Lt=1;Lt<8;Lt++)jt=(e[Lt]+At[Lt]|0)+(jt>>>16)|0,e[Lt]=jt&65535}update(e){_assert_js_1$2.default.exists(this);const{buffer:At,blockLen:kt}=this;e=(0,utils_js_1$3.toBytes)(e);const Bt=e.length;for(let Nt=0;Nt<Bt;){const jt=Math.min(kt-this.pos,Bt-Nt);if(jt===kt){for(;kt<=Bt-Nt;Nt+=kt)this.process(e,Nt);continue}At.set(e.subarray(Nt,Nt+jt),this.pos),this.pos+=jt,Nt+=jt,this.pos===kt&&(this.process(At,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){_assert_js_1$2.default.exists(this),_assert_js_1$2.default.output(e,this),this.finished=!0;const{buffer:At,h:kt}=this;let{pos:Bt}=this;if(Bt){for(At[Bt++]=1;Bt<16;Bt++)At[Bt]=0;this.process(At,0,!0)}this.finalize();let Nt=0;for(let jt=0;jt<8;jt++)e[Nt++]=kt[jt]>>>0,e[Nt++]=kt[jt]>>>8;return e}digest(){const{buffer:e,outputLen:At}=this;this.digestInto(e);const kt=e.slice(0,At);return this.destroy(),kt}};function wrapConstructorWithKey$2(xt){const e=(kt,Bt)=>xt(Bt).update((0,utils_js_1$3.toBytes)(kt)).digest(),At=xt(new Uint8Array(32));return e.outputLen=At.outputLen,e.blockLen=At.blockLen,e.create=kt=>xt(kt),e}_poly1305.wrapConstructorWithKey=wrapConstructorWithKey$2;_poly1305.poly1305=wrapConstructorWithKey$2(xt=>new Poly1305$2(xt));var _salsa={};Object.defineProperty(_salsa,"__esModule",{value:!0});_salsa.salsaBasic=void 0;const _assert_js_1$1=_assert,utils_js_1$2=utils$7,sigma16$2=(0,utils_js_1$2.utf8ToBytes)("expand 16-byte k"),sigma32$2=(0,utils_js_1$2.utf8ToBytes)("expand 32-byte k"),sigma16_32$1=(0,utils_js_1$2.u32)(sigma16$2),sigma32_32$1=(0,utils_js_1$2.u32)(sigma32$2),isAligned32$1=xt=>!(xt.byteOffset%4),salsaBasic=xt=>{const{core:e,rounds:At,counterRight:kt,counterLen:Bt,allow128bitKeys:Nt,extendNonceFn:jt,blockLen:Lt}=(0,utils_js_1$2.checkOpts)({rounds:20,counterRight:!1,counterLen:8,allow128bitKeys:!0,blockLen:64},xt);_assert_js_1$1.default.number(Bt),_assert_js_1$1.default.number(At),_assert_js_1$1.default.number(Lt),_assert_js_1$1.default.bool(kt),_assert_js_1$1.default.bool(Nt);const er=Lt/4;if(Lt%4!==0)throw new Error("Salsa/ChaCha: blockLen must be aligned to 4 bytes");return(tr,zt,rr,nr,ir=0)=>{if(_assert_js_1$1.default.bytes(tr),_assert_js_1$1.default.bytes(zt),_assert_js_1$1.default.bytes(rr),nr||(nr=new Uint8Array(rr.length)),_assert_js_1$1.default.bytes(nr),_assert_js_1$1.default.number(ir),ir<0||ir>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");if(nr.length<rr.length)throw new Error(`Salsa/ChaCha: output (${nr.length}) is shorter than data (${rr.length})`);const ar=[];let dr,ur;if(tr.length===32)isAligned32$1(tr)?dr=tr:(dr=tr.slice(),ar.push(dr)),ur=sigma32_32$1;else if(tr.length===16&&Nt)dr=new Uint8Array(32),dr.set(tr),dr.set(tr,16),ur=sigma16_32$1,ar.push(dr);else throw new Error(`Salsa/ChaCha: invalid 32-byte key, got length=${tr.length}`);if(isAligned32$1(zt)||(zt=zt.slice(),ar.push(zt)),jt){if(zt.length<=16)throw new Error("Salsa/ChaCha: extended nonce must be bigger than 16 bytes");dr=jt(ur,dr,zt.subarray(0,16),new Uint8Array(32)),ar.push(dr),zt=zt.subarray(16)}const fr=16-Bt;if(zt.length!==fr)throw new Error(`Salsa/ChaCha: nonce must be ${fr} or 16 bytes`);if(fr!==12){const Ur=new Uint8Array(12);Ur.set(zt,kt?0:12-zt.length),ar.push(zt=Ur)}const pr=new Uint8Array(Lt),lr=(0,utils_js_1$2.u32)(pr),yr=(0,utils_js_1$2.u32)(dr),br=(0,utils_js_1$2.u32)(zt),Ar=isAligned32$1(rr)&&(0,utils_js_1$2.u32)(rr),Pr=isAligned32$1(nr)&&(0,utils_js_1$2.u32)(nr);ar.push(lr);const kr=rr.length;for(let Ur=0,Hr=ir;Ur<kr;Hr++){if(e(ur,yr,br,lr,Hr,At),Hr>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");const Lr=Math.min(Lt,kr-Ur);if(Lr===Lt&&Pr&&Ar){const Sr=Ur/4;if(Ur%4!==0)throw new Error("Salsa/ChaCha: invalid block position");for(let _r=0;_r<er;_r++)Pr[Sr+_r]=Ar[Sr+_r]^lr[_r];Ur+=Lt;continue}for(let Sr=0;Sr<Lr;Sr++)nr[Ur+Sr]=rr[Ur+Sr]^pr[Sr];Ur+=Lr}for(let Ur=0;Ur<ar.length;Ur++)ar[Ur].fill(0);return nr}};_salsa.salsaBasic=salsaBasic;(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.xchacha20poly1305=xt.chacha20poly1305=xt._poly1305_aead=xt.chacha12=xt.chacha8=xt.xchacha20=xt.chacha20=xt.chacha20orig=xt.hchacha=void 0;const e=utils$7,At=_poly1305,kt=_salsa,Bt=(rr,nr)=>rr<<nr|rr>>>32-nr;function Nt(rr,nr,ir,ar,dr,ur=20){let fr=rr[0],pr=rr[1],lr=rr[2],yr=rr[3],br=nr[0],Ar=nr[1],Pr=nr[2],kr=nr[3],Ur=nr[4],Hr=nr[5],Lr=nr[6],Sr=nr[7],_r=dr,gr=ir[0],wr=ir[1],Dr=ir[2],xr=fr,Ir=pr,$r=lr,vr=yr,Er=br,Tr=Ar,Rr=Pr,Mr=kr,Gr=Ur,Br=Hr,Cr=Lr,jr=Sr,Yr=_r,Qr=gr,Jr=wr,Wr=Dr;for(let Vr=0;Vr<ur;Vr+=2)xr=xr+Er|0,Yr=Bt(Yr^xr,16),Gr=Gr+Yr|0,Er=Bt(Er^Gr,12),xr=xr+Er|0,Yr=Bt(Yr^xr,8),Gr=Gr+Yr|0,Er=Bt(Er^Gr,7),Ir=Ir+Tr|0,Qr=Bt(Qr^Ir,16),Br=Br+Qr|0,Tr=Bt(Tr^Br,12),Ir=Ir+Tr|0,Qr=Bt(Qr^Ir,8),Br=Br+Qr|0,Tr=Bt(Tr^Br,7),$r=$r+Rr|0,Jr=Bt(Jr^$r,16),Cr=Cr+Jr|0,Rr=Bt(Rr^Cr,12),$r=$r+Rr|0,Jr=Bt(Jr^$r,8),Cr=Cr+Jr|0,Rr=Bt(Rr^Cr,7),vr=vr+Mr|0,Wr=Bt(Wr^vr,16),jr=jr+Wr|0,Mr=Bt(Mr^jr,12),vr=vr+Mr|0,Wr=Bt(Wr^vr,8),jr=jr+Wr|0,Mr=Bt(Mr^jr,7),xr=xr+Tr|0,Wr=Bt(Wr^xr,16),Cr=Cr+Wr|0,Tr=Bt(Tr^Cr,12),xr=xr+Tr|0,Wr=Bt(Wr^xr,8),Cr=Cr+Wr|0,Tr=Bt(Tr^Cr,7),Ir=Ir+Rr|0,Yr=Bt(Yr^Ir,16),jr=jr+Yr|0,Rr=Bt(Rr^jr,12),Ir=Ir+Rr|0,Yr=Bt(Yr^Ir,8),jr=jr+Yr|0,Rr=Bt(Rr^jr,7),$r=$r+Mr|0,Qr=Bt(Qr^$r,16),Gr=Gr+Qr|0,Mr=Bt(Mr^Gr,12),$r=$r+Mr|0,Qr=Bt(Qr^$r,8),Gr=Gr+Qr|0,Mr=Bt(Mr^Gr,7),vr=vr+Er|0,Jr=Bt(Jr^vr,16),Br=Br+Jr|0,Er=Bt(Er^Br,12),vr=vr+Er|0,Jr=Bt(Jr^vr,8),Br=Br+Jr|0,Er=Bt(Er^Br,7);let Nr=0;ar[Nr++]=fr+xr|0,ar[Nr++]=pr+Ir|0,ar[Nr++]=lr+$r|0,ar[Nr++]=yr+vr|0,ar[Nr++]=br+Er|0,ar[Nr++]=Ar+Tr|0,ar[Nr++]=Pr+Rr|0,ar[Nr++]=kr+Mr|0,ar[Nr++]=Ur+Gr|0,ar[Nr++]=Hr+Br|0,ar[Nr++]=Lr+Cr|0,ar[Nr++]=Sr+jr|0,ar[Nr++]=_r+Yr|0,ar[Nr++]=gr+Qr|0,ar[Nr++]=wr+Jr|0,ar[Nr++]=Dr+Wr|0}function jt(rr,nr,ir,ar){const dr=(0,e.u32)(nr),ur=(0,e.u32)(ir),fr=(0,e.u32)(ar);let pr=rr[0],lr=rr[1],yr=rr[2],br=rr[3],Ar=dr[0],Pr=dr[1],kr=dr[2],Ur=dr[3],Hr=dr[4],Lr=dr[5],Sr=dr[6],_r=dr[7],gr=ur[0],wr=ur[1],Dr=ur[2],xr=ur[3];for(let Ir=0;Ir<20;Ir+=2)pr=pr+Ar|0,gr=Bt(gr^pr,16),Hr=Hr+gr|0,Ar=Bt(Ar^Hr,12),pr=pr+Ar|0,gr=Bt(gr^pr,8),Hr=Hr+gr|0,Ar=Bt(Ar^Hr,7),lr=lr+Pr|0,wr=Bt(wr^lr,16),Lr=Lr+wr|0,Pr=Bt(Pr^Lr,12),lr=lr+Pr|0,wr=Bt(wr^lr,8),Lr=Lr+wr|0,Pr=Bt(Pr^Lr,7),yr=yr+kr|0,Dr=Bt(Dr^yr,16),Sr=Sr+Dr|0,kr=Bt(kr^Sr,12),yr=yr+kr|0,Dr=Bt(Dr^yr,8),Sr=Sr+Dr|0,kr=Bt(kr^Sr,7),br=br+Ur|0,xr=Bt(xr^br,16),_r=_r+xr|0,Ur=Bt(Ur^_r,12),br=br+Ur|0,xr=Bt(xr^br,8),_r=_r+xr|0,Ur=Bt(Ur^_r,7),pr=pr+Pr|0,xr=Bt(xr^pr,16),Sr=Sr+xr|0,Pr=Bt(Pr^Sr,12),pr=pr+Pr|0,xr=Bt(xr^pr,8),Sr=Sr+xr|0,Pr=Bt(Pr^Sr,7),lr=lr+kr|0,gr=Bt(gr^lr,16),_r=_r+gr|0,kr=Bt(kr^_r,12),lr=lr+kr|0,gr=Bt(gr^lr,8),_r=_r+gr|0,kr=Bt(kr^_r,7),yr=yr+Ur|0,wr=Bt(wr^yr,16),Hr=Hr+wr|0,Ur=Bt(Ur^Hr,12),yr=yr+Ur|0,wr=Bt(wr^yr,8),Hr=Hr+wr|0,Ur=Bt(Ur^Hr,7),br=br+Ar|0,Dr=Bt(Dr^br,16),Lr=Lr+Dr|0,Ar=Bt(Ar^Lr,12),br=br+Ar|0,Dr=Bt(Dr^br,8),Lr=Lr+Dr|0,Ar=Bt(Ar^Lr,7);return fr[0]=pr,fr[1]=lr,fr[2]=yr,fr[3]=br,fr[4]=gr,fr[5]=wr,fr[6]=Dr,fr[7]=xr,ar}xt.hchacha=jt,xt.chacha20orig=(0,kt.salsaBasic)({core:Nt,counterRight:!1,counterLen:8}),xt.chacha20=(0,kt.salsaBasic)({core:Nt,counterRight:!1,counterLen:4,allow128bitKeys:!1}),xt.xchacha20=(0,kt.salsaBasic)({core:Nt,counterRight:!1,counterLen:8,extendNonceFn:jt,allow128bitKeys:!1}),xt.chacha8=(0,kt.salsaBasic)({core:Nt,counterRight:!1,counterLen:4,rounds:8}),xt.chacha12=(0,kt.salsaBasic)({core:Nt,counterRight:!1,counterLen:4,rounds:12});const Lt=new Uint8Array(16),er=(rr,nr)=>{rr.update(nr);const ir=nr.length%16;ir&&rr.update(Lt.subarray(ir))},tr=(rr,nr,ir,ar,dr)=>{const ur=rr(nr,ir,new Uint8Array(32)),fr=At.poly1305.create(ur);dr&&er(fr,dr),er(fr,ar);const pr=new Uint8Array(16),lr=(0,e.createView)(pr);(0,e.setBigUint64)(lr,0,BigInt(dr?dr.length:0),!0),(0,e.setBigUint64)(lr,8,BigInt(ar.length),!0),fr.update(pr);const yr=fr.digest();return ur.fill(0),yr},zt=rr=>(nr,ir,ar)=>((0,e.ensureBytes)(nr,32),(0,e.ensureBytes)(ir),{tagLength:16,encrypt:(ur,fr)=>{const pr=ur.length,lr=pr+16;fr?(0,e.ensureBytes)(fr,lr):fr=new Uint8Array(lr),rr(nr,ir,ur,fr,1);const yr=tr(rr,nr,ir,fr.subarray(0,-16),ar);return fr.set(yr,pr),fr},decrypt:(ur,fr)=>{const pr=ur.length,lr=pr-16;if(pr<16)throw new Error("encrypted data must be at least 16 bytes");fr?(0,e.ensureBytes)(fr,lr):fr=new Uint8Array(lr);const yr=ur.subarray(0,-16),br=ur.subarray(-16),Ar=tr(rr,nr,ir,yr,ar);if(!(0,e.equalBytes)(br,Ar))throw new Error("invalid tag");return rr(nr,ir,yr,fr,1),fr}});xt._poly1305_aead=zt,xt.chacha20poly1305=(0,xt._poly1305_aead)(xt.chacha20),xt.xchacha20poly1305=(0,xt._poly1305_aead)(xt.xchacha20)})(chacha);var hkdf$1={},hmac$1={};(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.hmac=xt.HMAC=void 0;const e=_assert$1,At=utils$4;class kt extends At.Hash{constructor(jt,Lt){super(),this.finished=!1,this.destroyed=!1,(0,e.hash)(jt);const er=(0,At.toBytes)(Lt);if(this.iHash=jt.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const tr=this.blockLen,zt=new Uint8Array(tr);zt.set(er.length>tr?jt.create().update(er).digest():er);for(let rr=0;rr<zt.length;rr++)zt[rr]^=54;this.iHash.update(zt),this.oHash=jt.create();for(let rr=0;rr<zt.length;rr++)zt[rr]^=106;this.oHash.update(zt),zt.fill(0)}update(jt){return(0,e.exists)(this),this.iHash.update(jt),this}digestInto(jt){(0,e.exists)(this),(0,e.bytes)(jt,this.outputLen),this.finished=!0,this.iHash.digestInto(jt),this.oHash.update(jt),this.oHash.digestInto(jt),this.destroy()}digest(){const jt=new Uint8Array(this.oHash.outputLen);return this.digestInto(jt),jt}_cloneInto(jt){jt||(jt=Object.create(Object.getPrototypeOf(this),{}));const{oHash:Lt,iHash:er,finished:tr,destroyed:zt,blockLen:rr,outputLen:nr}=this;return jt=jt,jt.finished=tr,jt.destroyed=zt,jt.blockLen=rr,jt.outputLen=nr,jt.oHash=Lt._cloneInto(jt.oHash),jt.iHash=er._cloneInto(jt.iHash),jt}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}xt.HMAC=kt;const Bt=(Nt,jt,Lt)=>new kt(Nt,jt).update(Lt).digest();xt.hmac=Bt,xt.hmac.create=(Nt,jt)=>new kt(Nt,jt)})(hmac$1);Object.defineProperty(hkdf$1,"__esModule",{value:!0});hkdf$1.hkdf=hkdf$1.expand=hkdf$1.extract=void 0;const _assert_js_1=_assert$1,utils_js_1$1=utils$4,hmac_js_1=hmac$1;function extract(xt,e,At){return(0,_assert_js_1.hash)(xt),At===void 0&&(At=new Uint8Array(xt.outputLen)),(0,hmac_js_1.hmac)(xt,(0,utils_js_1$1.toBytes)(At),(0,utils_js_1$1.toBytes)(e))}hkdf$1.extract=extract;const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(xt,e,At,kt=32){if((0,_assert_js_1.hash)(xt),(0,_assert_js_1.number)(kt),kt>255*xt.outputLen)throw new Error("Length should be <= 255*HashLen");const Bt=Math.ceil(kt/xt.outputLen);At===void 0&&(At=EMPTY_BUFFER);const Nt=new Uint8Array(Bt*xt.outputLen),jt=hmac_js_1.hmac.create(xt,e),Lt=jt._cloneInto(),er=new Uint8Array(jt.outputLen);for(let tr=0;tr<Bt;tr++)HKDF_COUNTER[0]=tr+1,Lt.update(tr===0?EMPTY_BUFFER:er).update(At).update(HKDF_COUNTER).digestInto(er),Nt.set(er,xt.outputLen*tr),jt._cloneInto(Lt);return jt.destroy(),Lt.destroy(),er.fill(0),HKDF_COUNTER.fill(0),Nt.slice(0,kt)}hkdf$1.expand=expand;const hkdf=(xt,e,At,kt,Bt)=>expand(xt,extract(xt,e,At),kt,Bt);hkdf$1.hkdf=hkdf;var sha256$1={};Object.defineProperty(sha256$1,"__esModule",{value:!0});sha256$1.sha224=sha256$1.sha256=void 0;const _md_js_1=_md,utils_js_1=utils$4,SHA256_K$1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends _md_js_1.HashMD{constructor(){super(64,32,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:e,B:At,C:kt,D:Bt,E:Nt,F:jt,G:Lt,H:er}=this;return[e,At,kt,Bt,Nt,jt,Lt,er]}set(e,At,kt,Bt,Nt,jt,Lt,er){this.A=e|0,this.B=At|0,this.C=kt|0,this.D=Bt|0,this.E=Nt|0,this.F=jt|0,this.G=Lt|0,this.H=er|0}process(e,At){for(let rr=0;rr<16;rr++,At+=4)SHA256_W$1[rr]=e.getUint32(At,!1);for(let rr=16;rr<64;rr++){const nr=SHA256_W$1[rr-15],ir=SHA256_W$1[rr-2],ar=(0,utils_js_1.rotr)(nr,7)^(0,utils_js_1.rotr)(nr,18)^nr>>>3,dr=(0,utils_js_1.rotr)(ir,17)^(0,utils_js_1.rotr)(ir,19)^ir>>>10;SHA256_W$1[rr]=dr+SHA256_W$1[rr-7]+ar+SHA256_W$1[rr-16]|0}let{A:kt,B:Bt,C:Nt,D:jt,E:Lt,F:er,G:tr,H:zt}=this;for(let rr=0;rr<64;rr++){const nr=(0,utils_js_1.rotr)(Lt,6)^(0,utils_js_1.rotr)(Lt,11)^(0,utils_js_1.rotr)(Lt,25),ir=zt+nr+(0,_md_js_1.Chi)(Lt,er,tr)+SHA256_K$1[rr]+SHA256_W$1[rr]|0,dr=((0,utils_js_1.rotr)(kt,2)^(0,utils_js_1.rotr)(kt,13)^(0,utils_js_1.rotr)(kt,22))+(0,_md_js_1.Maj)(kt,Bt,Nt)|0;zt=tr,tr=er,er=Lt,Lt=jt+ir|0,jt=Nt,Nt=Bt,Bt=kt,kt=ir+dr|0}kt=kt+this.A|0,Bt=Bt+this.B|0,Nt=Nt+this.C|0,jt=jt+this.D|0,Lt=Lt+this.E|0,er=er+this.F|0,tr=tr+this.G|0,zt=zt+this.H|0,this.set(kt,Bt,Nt,jt,Lt,er,tr,zt)}roundClean(){SHA256_W$1.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class SHA224 extends SHA256$1{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}sha256$1.sha256=(0,utils_js_1.wrapConstructor)(()=>new SHA256$1);sha256$1.sha224=(0,utils_js_1.wrapConstructor)(()=>new SHA224);var compat={};Object.defineProperty(compat,"__esModule",{value:!0});compat.aes256gcm=void 0;var utils_1$4=utils$7,crypto_1=requireCryptoBrowserify(),consts_1$2=consts;function aes256gcm(xt,e,At){var kt=function(Nt){var jt=(0,crypto_1.createCipheriv)("aes-256-gcm",xt,e);At&&jt.setAAD(At);var Lt=jt.update(Nt),er=jt.final();return(0,utils_1$4.concatBytes)(Lt,er,jt.getAuthTag())},Bt=function(Nt){var jt=Nt.subarray(0,Nt.length-consts_1$2.AEAD_TAG_LENGTH),Lt=Nt.subarray(-consts_1$2.AEAD_TAG_LENGTH),er=(0,crypto_1.createDecipheriv)("aes-256-gcm",xt,e);At&&er.setAAD(At),er.setAuthTag(Lt);var tr=er.update(jt),zt=er.final();return(0,utils_1$4.concatBytes)(tr,zt)};return{tagLength:consts_1$2.AEAD_TAG_LENGTH,encrypt:kt,decrypt:Bt}}compat.aes256gcm=aes256gcm;Object.defineProperty(symmetric,"__esModule",{value:!0});symmetric.deriveKey=symmetric.aesDecrypt=symmetric.aesEncrypt=void 0;var chacha_1=chacha,utils_1$3=utils$7,utils_2$3=utils$5,hkdf_1=hkdf$1,sha256_1=sha256$1,config_1$3=config,consts_1$1=consts,compat_1=compat;function aesEncrypt(xt,e){return _exec$1(!0,xt,e)}symmetric.aesEncrypt=aesEncrypt;function aesDecrypt(xt,e){return _exec$1(!1,xt,e)}symmetric.aesDecrypt=aesDecrypt;function deriveKey(xt){return(0,hkdf_1.hkdf)(sha256_1.sha256,xt,void 0,void 0,32)}symmetric.deriveKey=deriveKey;function _exec$1(xt,e,At){var kt=(0,config_1$3.symmetricAlgorithm)(),Bt=xt?_encrypt:_decrypt;if(kt==="aes-256-gcm")return Bt(compat_1.aes256gcm,e,At,(0,config_1$3.symmetricNonceLength)());if(kt==="xchacha20")return Bt(chacha_1.xchacha20poly1305,e,At,consts_1$1.XCHACHA20_NONCE_LENGTH);throw new Error("Not implemented")}function _encrypt(xt,e,At,kt){var Bt=(0,utils_2$3.randomBytes)(kt),Nt=xt(e,Bt),jt=Nt.encrypt(At),Lt=jt.subarray(0,jt.length-consts_1$1.AEAD_TAG_LENGTH),er=jt.subarray(-consts_1$1.AEAD_TAG_LENGTH);return(0,utils_1$3.concatBytes)(Bt,er,Lt)}function _decrypt(xt,e,At,kt){var Bt=kt+consts_1$1.AEAD_TAG_LENGTH,Nt=At.subarray(0,kt),jt=At.subarray(kt,Bt),Lt=At.subarray(Bt),er=xt(e,Uint8Array.from(Nt)),tr=(0,utils_1$3.concatBytes)(Lt,jt);return er.decrypt(tr)}Object.defineProperty(elliptic,"__esModule",{value:!0});elliptic.hexToPublicKey=elliptic.convertPublicKeyFormat=elliptic.getSharedPoint=elliptic.getSharedKey=elliptic.getPublicKey=elliptic.isValidPrivateKey=elliptic.getValidSecret=void 0;var utils_1$2=utils$7,utils_2$2=utils$5,ed25519_1=ed25519$1,secp256k1_1=secp256k1$1,config_1$2=config,consts_1=consts,hex_1=hex,symmetric_1=symmetric;function getValidSecret(){var xt;do xt=(0,utils_2$2.randomBytes)(consts_1.SECRET_KEY_LENGTH);while(!isValidPrivateKey(xt));return xt}elliptic.getValidSecret=getValidSecret;function isValidPrivateKey(xt){return _exec(function(e){return e.utils.isValidPrivateKey(xt)},function(){return!0},function(){return!0})}elliptic.isValidPrivateKey=isValidPrivateKey;function getPublicKey(xt){return _exec(function(e){return e.getPublicKey(xt)},function(e){return e.getPublicKey(xt)},function(e){return e.getPublicKey(xt)})}elliptic.getPublicKey=getPublicKey;function getSharedKey(xt,e){return(0,symmetric_1.deriveKey)((0,utils_1$2.concatBytes)(xt,e))}elliptic.getSharedKey=getSharedKey;function getSharedPoint(xt,e,At){return _exec(function(kt){return kt.getSharedSecret(xt,e,At)},function(kt){return kt.getSharedSecret(xt,e)},function(kt){var Bt=kt.utils.getExtendedPublicKey(xt).scalar,Nt=kt.ExtendedPoint.fromHex(e).multiply(Bt);return Nt.toRawBytes()})}elliptic.getSharedPoint=getSharedPoint;function convertPublicKeyFormat(xt,e){return _exec(function(At){return At.getSharedSecret(BigInt(1),xt,e)},function(){return xt},function(){return xt})}elliptic.convertPublicKeyFormat=convertPublicKeyFormat;function hexToPublicKey(xt){var e=(0,hex_1.decodeHex)(xt);return _exec(function(){if(e.length===consts_1.ETH_PUBLIC_KEY_SIZE){var At=new Uint8Array(1+e.length);return At.set([4]),At.set(e,1),At}return e},function(){return e},function(){return e})}elliptic.hexToPublicKey=hexToPublicKey;function _exec(xt,e,At){if((0,config_1$2.ellipticCurve)()==="secp256k1")return xt(secp256k1_1.secp256k1);if((0,config_1$2.ellipticCurve)()==="x25519")return e(ed25519_1.x25519);if((0,config_1$2.ellipticCurve)()==="ed25519")return At(ed25519_1.ed25519);throw new Error("Not implemented")}(function(xt){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(kt,Bt,Nt,jt){jt===void 0&&(jt=Nt);var Lt=Object.getOwnPropertyDescriptor(Bt,Nt);(!Lt||("get"in Lt?!Bt.__esModule:Lt.writable||Lt.configurable))&&(Lt={enumerable:!0,get:function(){return Bt[Nt]}}),Object.defineProperty(kt,jt,Lt)}:function(kt,Bt,Nt,jt){jt===void 0&&(jt=Nt),kt[jt]=Bt[Nt]}),At=commonjsGlobal&&commonjsGlobal.__exportStar||function(kt,Bt){for(var Nt in kt)Nt!=="default"&&!Object.prototype.hasOwnProperty.call(Bt,Nt)&&e(Bt,kt,Nt)};Object.defineProperty(xt,"__esModule",{value:!0}),At(elliptic,xt),At(hex,xt),At(symmetric,xt)})(utils$6);var PublicKey$1={};Object.defineProperty(PublicKey$1,"__esModule",{value:!0});PublicKey$1.PublicKey=void 0;var utils_1$1=utils$7,config_1$1=config,utils_2$1=utils$6,PublicKey=function(){function xt(e){this.data=(0,utils_2$1.convertPublicKeyFormat)(e,!0)}return xt.fromHex=function(e){return new xt((0,utils_2$1.hexToPublicKey)(e))},Object.defineProperty(xt.prototype,"uncompressed",{get:function(){return buffer$2.Buffer.from((0,utils_2$1.convertPublicKeyFormat)(this.data,!1))},enumerable:!1,configurable:!0}),Object.defineProperty(xt.prototype,"compressed",{get:function(){return buffer$2.Buffer.from(this.data)},enumerable:!1,configurable:!0}),xt.prototype.toHex=function(e){return e===void 0&&(e=!0),e?(0,utils_1$1.bytesToHex)(this.data):(0,utils_1$1.bytesToHex)(this.uncompressed)},xt.prototype.decapsulate=function(e){var At,kt;return(0,config_1$1.isHkdfKeyCompressed)()?(At=this.data,kt=e.multiply(this,!0)):(At=this.uncompressed,kt=e.multiply(this,!1)),(0,utils_2$1.getSharedKey)(At,kt)},xt.prototype.equals=function(e){return(0,utils_1$1.equalBytes)(this.data,e.data)},xt}();PublicKey$1.PublicKey=PublicKey;Object.defineProperty(PrivateKey$1,"__esModule",{value:!0});PrivateKey$1.PrivateKey=void 0;var utils_1=utils$7,config_1=config,utils_2=utils$6,PublicKey_1=PublicKey$1,PrivateKey=function(){function xt(e){var At=e===void 0?(0,utils_2.getValidSecret)():e;if(!(0,utils_2.isValidPrivateKey)(At))throw new Error("Invalid private key");this.data=At,this.publicKey=new PublicKey_1.PublicKey((0,utils_2.getPublicKey)(At))}return xt.fromHex=function(e){return new xt((0,utils_2.decodeHex)(e))},Object.defineProperty(xt.prototype,"secret",{get:function(){return buffer$2.Buffer.from(this.data)},enumerable:!1,configurable:!0}),xt.prototype.toHex=function(){return(0,utils_1.bytesToHex)(this.data)},xt.prototype.encapsulate=function(e){var At,kt;return(0,config_1.isHkdfKeyCompressed)()?(At=this.publicKey.compressed,kt=this.multiply(e,!0)):(At=this.publicKey.uncompressed,kt=this.multiply(e,!1)),(0,utils_2.getSharedKey)(At,kt)},xt.prototype.multiply=function(e,At){return At===void 0&&(At=!1),(0,utils_2.getSharedPoint)(this.data,e.compressed,At)},xt.prototype.equals=function(e){return(0,utils_1.equalBytes)(this.data,e.data)},xt}();PrivateKey$1.PrivateKey=PrivateKey;(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.PublicKey=xt.PrivateKey=void 0;var e=PrivateKey$1;Object.defineProperty(xt,"PrivateKey",{enumerable:!0,get:function(){return e.PrivateKey}});var At=PublicKey$1;Object.defineProperty(xt,"PublicKey",{enumerable:!0,get:function(){return At.PublicKey}})})(keys);(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.utils=xt.PublicKey=xt.PrivateKey=xt.ECIES_CONFIG=xt.decrypt=xt.encrypt=void 0;var e=utils$7,At=config,kt=keys,Bt=utils$6;function Nt(tr,zt){var rr=new kt.PrivateKey,nr=tr instanceof Uint8Array?new kt.PublicKey(tr):kt.PublicKey.fromHex(tr),ir=rr.encapsulate(nr),ar=(0,Bt.aesEncrypt)(ir,zt),dr;return(0,At.isEphemeralKeyCompressed)()?dr=rr.publicKey.compressed:dr=rr.publicKey.uncompressed,buffer$2.Buffer.from((0,e.concatBytes)(dr,ar))}xt.encrypt=Nt;function jt(tr,zt){var rr=tr instanceof Uint8Array?new kt.PrivateKey(tr):kt.PrivateKey.fromHex(tr),nr=(0,At.ephemeralKeySize)(),ir=new kt.PublicKey(zt.subarray(0,nr)),ar=zt.subarray(nr),dr=ir.decapsulate(rr);return buffer$2.Buffer.from((0,Bt.aesDecrypt)(dr,ar))}xt.decrypt=jt;var Lt=config;Object.defineProperty(xt,"ECIES_CONFIG",{enumerable:!0,get:function(){return Lt.ECIES_CONFIG}});var er=keys;Object.defineProperty(xt,"PrivateKey",{enumerable:!0,get:function(){return er.PrivateKey}}),Object.defineProperty(xt,"PublicKey",{enumerable:!0,get:function(){return er.PublicKey}}),xt.utils={aesDecrypt:Bt.aesDecrypt,aesEncrypt:Bt.aesEncrypt,decodeHex:Bt.decodeHex,getValidSecret:Bt.getValidSecret,remove0x:Bt.remove0x}})(dist);var browser$2={exports:{}},stream$1={exports:{}},primordials$1={ArrayIsArray(xt){return Array.isArray(xt)},ArrayPrototypeIncludes(xt,e){return xt.includes(e)},ArrayPrototypeIndexOf(xt,e){return xt.indexOf(e)},ArrayPrototypeJoin(xt,e){return xt.join(e)},ArrayPrototypeMap(xt,e){return xt.map(e)},ArrayPrototypePop(xt,e){return xt.pop(e)},ArrayPrototypePush(xt,e){return xt.push(e)},ArrayPrototypeSlice(xt,e,At){return xt.slice(e,At)},Error,FunctionPrototypeCall(xt,e,...At){return xt.call(e,...At)},FunctionPrototypeSymbolHasInstance(xt,e){return Function.prototype[Symbol.hasInstance].call(xt,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(xt,e){return Object.defineProperties(xt,e)},ObjectDefineProperty(xt,e,At){return Object.defineProperty(xt,e,At)},ObjectGetOwnPropertyDescriptor(xt,e){return Object.getOwnPropertyDescriptor(xt,e)},ObjectKeys(xt){return Object.keys(xt)},ObjectSetPrototypeOf(xt,e){return Object.setPrototypeOf(xt,e)},Promise,PromisePrototypeCatch(xt,e){return xt.catch(e)},PromisePrototypeThen(xt,e,At){return xt.then(e,At)},PromiseReject(xt){return Promise.reject(xt)},PromiseResolve(xt){return Promise.resolve(xt)},ReflectApply:Reflect.apply,RegExpPrototypeTest(xt,e){return xt.test(e)},SafeSet:Set,String,StringPrototypeSlice(xt,e,At){return xt.slice(e,At)},StringPrototypeToLowerCase(xt){return xt.toLowerCase()},StringPrototypeToUpperCase(xt){return xt.toUpperCase()},StringPrototypeTrim(xt){return xt.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,SymbolDispose:Symbol.dispose||Symbol("Symbol.dispose"),SymbolAsyncDispose:Symbol.asyncDispose||Symbol("Symbol.asyncDispose"),TypedArrayPrototypeSet(xt,e,At){return xt.set(e,At)},Boolean,Uint8Array},util$2={exports:{}},browser$1={exports:{}},hasRequiredBrowser;function requireBrowser(){if(hasRequiredBrowser)return browser$1.exports;hasRequiredBrowser=1;const{AbortController:xt,AbortSignal:e}=typeof self<"u"?self:typeof window<"u"?window:void 0;return browser$1.exports=xt,browser$1.exports.AbortSignal=e,browser$1.exports.default=xt,browser$1.exports}(function(xt){const e=buffer$2,{kResistStopPropagation:At,SymbolDispose:kt}=primordials$1,Bt=globalThis.AbortSignal||requireBrowser().AbortSignal,Nt=globalThis.AbortController||requireBrowser().AbortController,jt=Object.getPrototypeOf(async function(){}).constructor,Lt=globalThis.Blob||e.Blob,er=typeof Lt<"u"?function(ir){return ir instanceof Lt}:function(ir){return!1},tr=(nr,ir)=>{if(nr!==void 0&&(nr===null||typeof nr!="object"||!("aborted"in nr)))throw new ERR_INVALID_ARG_TYPE(ir,"AbortSignal",nr)},zt=(nr,ir)=>{if(typeof nr!="function")throw new ERR_INVALID_ARG_TYPE(ir,"Function",nr)};class rr extends Error{constructor(ir){if(!Array.isArray(ir))throw new TypeError(`Expected input to be an Array, got ${typeof ir}`);let ar="";for(let dr=0;dr<ir.length;dr++)ar+=`    ${ir[dr].stack}
`;super(ar),this.name="AggregateError",this.errors=ir}}xt.exports={AggregateError:rr,kEmptyObject:Object.freeze({}),once(nr){let ir=!1;return function(...ar){ir||(ir=!0,nr.apply(this,ar))}},createDeferredPromise:function(){let nr,ir;return{promise:new Promise((dr,ur)=>{nr=dr,ir=ur}),resolve:nr,reject:ir}},promisify(nr){return new Promise((ir,ar)=>{nr((dr,...ur)=>dr?ar(dr):ir(...ur))})},debuglog(){return function(){}},format(nr,...ir){return nr.replace(/%([sdifj])/g,function(...[ar,dr]){const ur=ir.shift();return dr==="f"?ur.toFixed(6):dr==="j"?JSON.stringify(ur):dr==="s"&&typeof ur=="object"?`${ur.constructor!==Object?ur.constructor.name:""} {}`.trim():ur.toString()})},inspect(nr){switch(typeof nr){case"string":if(nr.includes("'"))if(nr.includes('"')){if(!nr.includes("`")&&!nr.includes("${"))return`\`${nr}\``}else return`"${nr}"`;return`'${nr}'`;case"number":return isNaN(nr)?"NaN":Object.is(nr,-0)?String(nr):nr;case"bigint":return`${String(nr)}n`;case"boolean":case"undefined":return String(nr);case"object":return"{}"}},types:{isAsyncFunction(nr){return nr instanceof jt},isArrayBufferView(nr){return ArrayBuffer.isView(nr)}},isBlob:er,deprecate(nr,ir){return nr},addAbortListener:eventsExports.addAbortListener||function(ir,ar){if(ir===void 0)throw new ERR_INVALID_ARG_TYPE("signal","AbortSignal",ir);tr(ir,"signal"),zt(ar,"listener");let dr;return ir.aborted?queueMicrotask(()=>ar()):(ir.addEventListener("abort",ar,{__proto__:null,once:!0,[At]:!0}),dr=()=>{ir.removeEventListener("abort",ar)}),{__proto__:null,[kt](){var ur;(ur=dr)===null||ur===void 0||ur()}}},AbortSignalAny:Bt.any||function(ir){if(ir.length===1)return ir[0];const ar=new Nt,dr=()=>ar.abort();return ir.forEach(ur=>{tr(ur,"signals"),ur.addEventListener("abort",dr,{once:!0})}),ar.signal.addEventListener("abort",()=>{ir.forEach(ur=>ur.removeEventListener("abort",dr))},{once:!0}),ar.signal}},xt.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(util$2);var utilExports$1=util$2.exports,operators$1={};const{format:format$5,inspect:inspect$3,AggregateError:CustomAggregateError$1}=utilExports$1,AggregateError$2=globalThis.AggregateError||CustomAggregateError$1,kIsNodeError$1=Symbol("kIsNodeError"),kTypes$1=["string","function","number","object","Function","Object","boolean","bigint","symbol"],classRegExp$1=/^([A-Z][a-z0-9]*)+$/,nodeInternalPrefix$1="__node_internal_",codes$3={};function assert$1(xt,e){if(!xt)throw new codes$3.ERR_INTERNAL_ASSERTION(e)}function addNumericalSeparator$1(xt){let e="",At=xt.length;const kt=xt[0]==="-"?1:0;for(;At>=kt+4;At-=3)e=`_${xt.slice(At-3,At)}${e}`;return`${xt.slice(0,At)}${e}`}function getMessage$1(xt,e,At){if(typeof e=="function")return assert$1(e.length<=At.length,`Code: ${xt}; The provided arguments length (${At.length}) does not match the required ones (${e.length}).`),e(...At);const kt=(e.match(/%[dfijoOs]/g)||[]).length;return assert$1(kt===At.length,`Code: ${xt}; The provided arguments length (${At.length}) does not match the required ones (${kt}).`),At.length===0?e:format$5(e,...At)}function E$3(xt,e,At){At||(At=Error);class kt extends At{constructor(...Nt){super(getMessage$1(xt,e,Nt))}toString(){return`${this.name} [${xt}]: ${this.message}`}}Object.defineProperties(kt.prototype,{name:{value:At.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${xt}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),kt.prototype.code=xt,kt.prototype[kIsNodeError$1]=!0,codes$3[xt]=kt}function hideStackFrames$3(xt){const e=nodeInternalPrefix$1+xt.name;return Object.defineProperty(xt,"name",{value:e}),xt}function aggregateTwoErrors$5(xt,e){if(xt&&e&&xt!==e){if(Array.isArray(e.errors))return e.errors.push(xt),e;const At=new AggregateError$2([e,xt],e.message);return At.code=e.code,At}return xt||e}let AbortError$e=class extends Error{constructor(e="The operation was aborted",At=void 0){if(At!==void 0&&typeof At!="object")throw new codes$3.ERR_INVALID_ARG_TYPE("options","Object",At);super(e,At),this.code="ABORT_ERR",this.name="AbortError"}};E$3("ERR_ASSERTION","%s",Error);E$3("ERR_INVALID_ARG_TYPE",(xt,e,At)=>{assert$1(typeof xt=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let kt="The ";xt.endsWith(" argument")?kt+=`${xt} `:kt+=`"${xt}" ${xt.includes(".")?"property":"argument"} `,kt+="must be ";const Bt=[],Nt=[],jt=[];for(const er of e)assert$1(typeof er=="string","All expected entries have to be of type string"),kTypes$1.includes(er)?Bt.push(er.toLowerCase()):classRegExp$1.test(er)?Nt.push(er):(assert$1(er!=="object",'The value "object" should be written as "Object"'),jt.push(er));if(Nt.length>0){const er=Bt.indexOf("object");er!==-1&&(Bt.splice(Bt,er,1),Nt.push("Object"))}if(Bt.length>0){switch(Bt.length){case 1:kt+=`of type ${Bt[0]}`;break;case 2:kt+=`one of type ${Bt[0]} or ${Bt[1]}`;break;default:{const er=Bt.pop();kt+=`one of type ${Bt.join(", ")}, or ${er}`}}(Nt.length>0||jt.length>0)&&(kt+=" or ")}if(Nt.length>0){switch(Nt.length){case 1:kt+=`an instance of ${Nt[0]}`;break;case 2:kt+=`an instance of ${Nt[0]} or ${Nt[1]}`;break;default:{const er=Nt.pop();kt+=`an instance of ${Nt.join(", ")}, or ${er}`}}jt.length>0&&(kt+=" or ")}switch(jt.length){case 0:break;case 1:jt[0].toLowerCase()!==jt[0]&&(kt+="an "),kt+=`${jt[0]}`;break;case 2:kt+=`one of ${jt[0]} or ${jt[1]}`;break;default:{const er=jt.pop();kt+=`one of ${jt.join(", ")}, or ${er}`}}if(At==null)kt+=`. Received ${At}`;else if(typeof At=="function"&&At.name)kt+=`. Received function ${At.name}`;else if(typeof At=="object"){var Lt;if((Lt=At.constructor)!==null&&Lt!==void 0&&Lt.name)kt+=`. Received an instance of ${At.constructor.name}`;else{const er=inspect$3(At,{depth:-1});kt+=`. Received ${er}`}}else{let er=inspect$3(At,{colors:!1});er.length>25&&(er=`${er.slice(0,25)}...`),kt+=`. Received type ${typeof At} (${er})`}return kt},TypeError);E$3("ERR_INVALID_ARG_VALUE",(xt,e,At="is invalid")=>{let kt=inspect$3(e);return kt.length>128&&(kt=kt.slice(0,128)+"..."),`The ${xt.includes(".")?"property":"argument"} '${xt}' ${At}. Received ${kt}`},TypeError);E$3("ERR_INVALID_RETURN_VALUE",(xt,e,At)=>{var kt;const Bt=At!=null&&(kt=At.constructor)!==null&&kt!==void 0&&kt.name?`instance of ${At.constructor.name}`:`type ${typeof At}`;return`Expected ${xt} to be returned from the "${e}" function but got ${Bt}.`},TypeError);E$3("ERR_MISSING_ARGS",(...xt)=>{assert$1(xt.length>0,"At least one arg needs to be specified");let e;const At=xt.length;switch(xt=(Array.isArray(xt)?xt:[xt]).map(kt=>`"${kt}"`).join(" or "),At){case 1:e+=`The ${xt[0]} argument`;break;case 2:e+=`The ${xt[0]} and ${xt[1]} arguments`;break;default:{const kt=xt.pop();e+=`The ${xt.join(", ")}, and ${kt} arguments`}break}return`${e} must be specified`},TypeError);E$3("ERR_OUT_OF_RANGE",(xt,e,At)=>{assert$1(e,'Missing "range" argument');let kt;return Number.isInteger(At)&&Math.abs(At)>2**32?kt=addNumericalSeparator$1(String(At)):typeof At=="bigint"?(kt=String(At),(At>2n**32n||At<-(2n**32n))&&(kt=addNumericalSeparator$1(kt)),kt+="n"):kt=inspect$3(At),`The value of "${xt}" is out of range. It must be ${e}. Received ${kt}`},RangeError);E$3("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);E$3("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);E$3("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);E$3("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);E$3("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);E$3("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);E$3("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);E$3("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);E$3("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);E$3("ERR_STREAM_WRITE_AFTER_END","write after end",Error);E$3("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var errors$2={AbortError:AbortError$e,aggregateTwoErrors:hideStackFrames$3(aggregateTwoErrors$5),hideStackFrames:hideStackFrames$3,codes:codes$3};const{ArrayIsArray:ArrayIsArray$5,ArrayPrototypeIncludes:ArrayPrototypeIncludes$1,ArrayPrototypeJoin:ArrayPrototypeJoin$1,ArrayPrototypeMap:ArrayPrototypeMap$1,NumberIsInteger:NumberIsInteger$3,NumberIsNaN:NumberIsNaN$3,NumberMAX_SAFE_INTEGER:NumberMAX_SAFE_INTEGER$1,NumberMIN_SAFE_INTEGER:NumberMIN_SAFE_INTEGER$1,NumberParseInt:NumberParseInt$1,ObjectPrototypeHasOwnProperty:ObjectPrototypeHasOwnProperty$1,RegExpPrototypeExec:RegExpPrototypeExec$1,String:String$2,StringPrototypeToUpperCase:StringPrototypeToUpperCase$1,StringPrototypeTrim:StringPrototypeTrim$1}=primordials$1,{hideStackFrames:hideStackFrames$2,codes:{ERR_SOCKET_BAD_PORT:ERR_SOCKET_BAD_PORT$1,ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$a,ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$7,ERR_OUT_OF_RANGE:ERR_OUT_OF_RANGE$3,ERR_UNKNOWN_SIGNAL:ERR_UNKNOWN_SIGNAL$1}}=errors$2,{normalizeEncoding:normalizeEncoding$1}=utilExports$1,{isAsyncFunction:isAsyncFunction$1,isArrayBufferView:isArrayBufferView$1}=utilExports$1.types,signals$1={};function isInt32$1(xt){return xt===(xt|0)}function isUint32$1(xt){return xt===xt>>>0}const octalReg$1=/^[0-7]+$/,modeDesc$1="must be a 32-bit unsigned integer or an octal string";function parseFileMode$1(xt,e,At){if(typeof xt>"u"&&(xt=At),typeof xt=="string"){if(RegExpPrototypeExec$1(octalReg$1,xt)===null)throw new ERR_INVALID_ARG_VALUE$7(e,xt,modeDesc$1);xt=NumberParseInt$1(xt,8)}return validateUint32$1(xt,e),xt}const validateInteger$4=hideStackFrames$2((xt,e,At=NumberMIN_SAFE_INTEGER$1,kt=NumberMAX_SAFE_INTEGER$1)=>{if(typeof xt!="number")throw new ERR_INVALID_ARG_TYPE$a(e,"number",xt);if(!NumberIsInteger$3(xt))throw new ERR_OUT_OF_RANGE$3(e,"an integer",xt);if(xt<At||xt>kt)throw new ERR_OUT_OF_RANGE$3(e,`>= ${At} && <= ${kt}`,xt)}),validateInt32$1=hideStackFrames$2((xt,e,At=-2147483648,kt=2147483647)=>{if(typeof xt!="number")throw new ERR_INVALID_ARG_TYPE$a(e,"number",xt);if(!NumberIsInteger$3(xt))throw new ERR_OUT_OF_RANGE$3(e,"an integer",xt);if(xt<At||xt>kt)throw new ERR_OUT_OF_RANGE$3(e,`>= ${At} && <= ${kt}`,xt)}),validateUint32$1=hideStackFrames$2((xt,e,At=!1)=>{if(typeof xt!="number")throw new ERR_INVALID_ARG_TYPE$a(e,"number",xt);if(!NumberIsInteger$3(xt))throw new ERR_OUT_OF_RANGE$3(e,"an integer",xt);const kt=At?1:0,Bt=4294967295;if(xt<kt||xt>Bt)throw new ERR_OUT_OF_RANGE$3(e,`>= ${kt} && <= ${Bt}`,xt)});function validateString$1(xt,e){if(typeof xt!="string")throw new ERR_INVALID_ARG_TYPE$a(e,"string",xt)}function validateNumber$1(xt,e,At=void 0,kt){if(typeof xt!="number")throw new ERR_INVALID_ARG_TYPE$a(e,"number",xt);if(At!=null&&xt<At||kt!=null&&xt>kt||(At!=null||kt!=null)&&NumberIsNaN$3(xt))throw new ERR_OUT_OF_RANGE$3(e,`${At!=null?`>= ${At}`:""}${At!=null&&kt!=null?" && ":""}${kt!=null?`<= ${kt}`:""}`,xt)}const validateOneOf$1=hideStackFrames$2((xt,e,At)=>{if(!ArrayPrototypeIncludes$1(At,xt)){const Bt="must be one of: "+ArrayPrototypeJoin$1(ArrayPrototypeMap$1(At,Nt=>typeof Nt=="string"?`'${Nt}'`:String$2(Nt)),", ");throw new ERR_INVALID_ARG_VALUE$7(e,xt,Bt)}});function validateBoolean$3(xt,e){if(typeof xt!="boolean")throw new ERR_INVALID_ARG_TYPE$a(e,"boolean",xt)}function getOwnPropertyValueOrDefault$1(xt,e,At){return xt==null||!ObjectPrototypeHasOwnProperty$1(xt,e)?At:xt[e]}const validateObject$6=hideStackFrames$2((xt,e,At=null)=>{const kt=getOwnPropertyValueOrDefault$1(At,"allowArray",!1),Bt=getOwnPropertyValueOrDefault$1(At,"allowFunction",!1);if(!getOwnPropertyValueOrDefault$1(At,"nullable",!1)&&xt===null||!kt&&ArrayIsArray$5(xt)||typeof xt!="object"&&(!Bt||typeof xt!="function"))throw new ERR_INVALID_ARG_TYPE$a(e,"Object",xt)}),validateDictionary$1=hideStackFrames$2((xt,e)=>{if(xt!=null&&typeof xt!="object"&&typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$a(e,"a dictionary",xt)}),validateArray$2=hideStackFrames$2((xt,e,At=0)=>{if(!ArrayIsArray$5(xt))throw new ERR_INVALID_ARG_TYPE$a(e,"Array",xt);if(xt.length<At){const kt=`must be longer than ${At}`;throw new ERR_INVALID_ARG_VALUE$7(e,xt,kt)}});function validateStringArray$1(xt,e){validateArray$2(xt,e);for(let At=0;At<xt.length;At++)validateString$1(xt[At],`${e}[${At}]`)}function validateBooleanArray$1(xt,e){validateArray$2(xt,e);for(let At=0;At<xt.length;At++)validateBoolean$3(xt[At],`${e}[${At}]`)}function validateAbortSignalArray(xt,e){validateArray$2(xt,e);for(let At=0;At<xt.length;At++){const kt=xt[At],Bt=`${e}[${At}]`;if(kt==null)throw new ERR_INVALID_ARG_TYPE$a(Bt,"AbortSignal",kt);validateAbortSignal$7(kt,Bt)}}function validateSignalName$1(xt,e="signal"){if(validateString$1(xt,e),signals$1[xt]===void 0)throw signals$1[StringPrototypeToUpperCase$1(xt)]!==void 0?new ERR_UNKNOWN_SIGNAL$1(xt+" (signals must use all capital letters)"):new ERR_UNKNOWN_SIGNAL$1(xt)}const validateBuffer$1=hideStackFrames$2((xt,e="buffer")=>{if(!isArrayBufferView$1(xt))throw new ERR_INVALID_ARG_TYPE$a(e,["Buffer","TypedArray","DataView"],xt)});function validateEncoding$1(xt,e){const At=normalizeEncoding$1(e),kt=xt.length;if(At==="hex"&&kt%2!==0)throw new ERR_INVALID_ARG_VALUE$7("encoding",e,`is invalid for data of length ${kt}`)}function validatePort$1(xt,e="Port",At=!0){if(typeof xt!="number"&&typeof xt!="string"||typeof xt=="string"&&StringPrototypeTrim$1(xt).length===0||+xt!==+xt>>>0||xt>65535||xt===0&&!At)throw new ERR_SOCKET_BAD_PORT$1(e,xt,At);return xt|0}const validateAbortSignal$7=hideStackFrames$2((xt,e)=>{if(xt!==void 0&&(xt===null||typeof xt!="object"||!("aborted"in xt)))throw new ERR_INVALID_ARG_TYPE$a(e,"AbortSignal",xt)}),validateFunction$6=hideStackFrames$2((xt,e)=>{if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$a(e,"Function",xt)}),validatePlainFunction$1=hideStackFrames$2((xt,e)=>{if(typeof xt!="function"||isAsyncFunction$1(xt))throw new ERR_INVALID_ARG_TYPE$a(e,"Function",xt)}),validateUndefined$1=hideStackFrames$2((xt,e)=>{if(xt!==void 0)throw new ERR_INVALID_ARG_TYPE$a(e,"undefined",xt)});function validateUnion$2(xt,e,At){if(!ArrayPrototypeIncludes$1(At,xt))throw new ERR_INVALID_ARG_TYPE$a(e,`('${ArrayPrototypeJoin$1(At,"|")}')`,xt)}const linkValueRegExp$1=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function validateLinkHeaderFormat$1(xt,e){if(typeof xt>"u"||!RegExpPrototypeExec$1(linkValueRegExp$1,xt))throw new ERR_INVALID_ARG_VALUE$7(e,xt,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function validateLinkHeaderValue$1(xt){if(typeof xt=="string")return validateLinkHeaderFormat$1(xt,"hints"),xt;if(ArrayIsArray$5(xt)){const e=xt.length;let At="";if(e===0)return At;for(let kt=0;kt<e;kt++){const Bt=xt[kt];validateLinkHeaderFormat$1(Bt,"hints"),At+=Bt,kt!==e-1&&(At+=", ")}return At}throw new ERR_INVALID_ARG_VALUE$7("hints",xt,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}var validators$1={isInt32:isInt32$1,isUint32:isUint32$1,parseFileMode:parseFileMode$1,validateArray:validateArray$2,validateStringArray:validateStringArray$1,validateBooleanArray:validateBooleanArray$1,validateAbortSignalArray,validateBoolean:validateBoolean$3,validateBuffer:validateBuffer$1,validateDictionary:validateDictionary$1,validateEncoding:validateEncoding$1,validateFunction:validateFunction$6,validateInt32:validateInt32$1,validateInteger:validateInteger$4,validateNumber:validateNumber$1,validateObject:validateObject$6,validateOneOf:validateOneOf$1,validatePlainFunction:validatePlainFunction$1,validatePort:validatePort$1,validateSignalName:validateSignalName$1,validateString:validateString$1,validateUint32:validateUint32$1,validateUndefined:validateUndefined$1,validateUnion:validateUnion$2,validateAbortSignal:validateAbortSignal$7,validateLinkHeaderValue:validateLinkHeaderValue$1},endOfStream$1={exports:{}};const{SymbolAsyncIterator:SymbolAsyncIterator$5,SymbolIterator:SymbolIterator$5,SymbolFor:SymbolFor$1}=primordials$1,kIsDestroyed$1=SymbolFor$1("nodejs.stream.destroyed"),kIsErrored$1=SymbolFor$1("nodejs.stream.errored"),kIsReadable$1=SymbolFor$1("nodejs.stream.readable"),kIsWritable=SymbolFor$1("nodejs.stream.writable"),kIsDisturbed$1=SymbolFor$1("nodejs.stream.disturbed"),kIsClosedPromise$3=SymbolFor$1("nodejs.webstream.isClosedPromise"),kControllerErrorFunction$1=SymbolFor$1("nodejs.webstream.controllerErrorFunction");function isReadableNodeStream$5(xt,e=!1){var At;return!!(xt&&typeof xt.pipe=="function"&&typeof xt.on=="function"&&(!e||typeof xt.pause=="function"&&typeof xt.resume=="function")&&(!xt._writableState||((At=xt._readableState)===null||At===void 0?void 0:At.readable)!==!1)&&(!xt._writableState||xt._readableState))}function isWritableNodeStream$3(xt){var e;return!!(xt&&typeof xt.write=="function"&&typeof xt.on=="function"&&(!xt._readableState||((e=xt._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function isDuplexNodeStream$1(xt){return!!(xt&&typeof xt.pipe=="function"&&xt._readableState&&typeof xt.on=="function"&&typeof xt.write=="function")}function isNodeStream$9(xt){return xt&&(xt._readableState||xt._writableState||typeof xt.write=="function"&&typeof xt.on=="function"||typeof xt.pipe=="function"&&typeof xt.on=="function")}function isReadableStream$7(xt){return!!(xt&&!isNodeStream$9(xt)&&typeof xt.pipeThrough=="function"&&typeof xt.getReader=="function"&&typeof xt.cancel=="function")}function isWritableStream$5(xt){return!!(xt&&!isNodeStream$9(xt)&&typeof xt.getWriter=="function"&&typeof xt.abort=="function")}function isTransformStream$5(xt){return!!(xt&&!isNodeStream$9(xt)&&typeof xt.readable=="object"&&typeof xt.writable=="object")}function isWebStream$5(xt){return isReadableStream$7(xt)||isWritableStream$5(xt)||isTransformStream$5(xt)}function isIterable$4(xt,e){return xt==null?!1:e===!0?typeof xt[SymbolAsyncIterator$5]=="function":e===!1?typeof xt[SymbolIterator$5]=="function":typeof xt[SymbolAsyncIterator$5]=="function"||typeof xt[SymbolIterator$5]=="function"}function isDestroyed$3(xt){if(!isNodeStream$9(xt))return null;const e=xt._writableState,At=xt._readableState,kt=e||At;return!!(xt.destroyed||xt[kIsDestroyed$1]||kt!=null&&kt.destroyed)}function isWritableEnded$1(xt){if(!isWritableNodeStream$3(xt))return null;if(xt.writableEnded===!0)return!0;const e=xt._writableState;return e!=null&&e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function isWritableFinished$3(xt,e){if(!isWritableNodeStream$3(xt))return null;if(xt.writableFinished===!0)return!0;const At=xt._writableState;return At!=null&&At.errored?!1:typeof(At==null?void 0:At.finished)!="boolean"?null:!!(At.finished||e===!1&&At.ended===!0&&At.length===0)}function isReadableEnded$2(xt){if(!isReadableNodeStream$5(xt))return null;if(xt.readableEnded===!0)return!0;const e=xt._readableState;return!e||e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function isReadableFinished$4(xt,e){if(!isReadableNodeStream$5(xt))return null;const At=xt._readableState;return At!=null&&At.errored?!1:typeof(At==null?void 0:At.endEmitted)!="boolean"?null:!!(At.endEmitted||e===!1&&At.ended===!0&&At.length===0)}function isReadable$7(xt){return xt&&xt[kIsReadable$1]!=null?xt[kIsReadable$1]:typeof(xt==null?void 0:xt.readable)!="boolean"?null:isDestroyed$3(xt)?!1:isReadableNodeStream$5(xt)&&xt.readable&&!isReadableFinished$4(xt)}function isWritable$7(xt){return xt&&xt[kIsWritable]!=null?xt[kIsWritable]:typeof(xt==null?void 0:xt.writable)!="boolean"?null:isDestroyed$3(xt)?!1:isWritableNodeStream$3(xt)&&xt.writable&&!isWritableEnded$1(xt)}function isFinished$3(xt,e){return isNodeStream$9(xt)?isDestroyed$3(xt)?!0:!((e==null?void 0:e.readable)!==!1&&isReadable$7(xt)||(e==null?void 0:e.writable)!==!1&&isWritable$7(xt)):null}function isWritableErrored$3(xt){var e,At;return isNodeStream$9(xt)?xt.writableErrored?xt.writableErrored:(e=(At=xt._writableState)===null||At===void 0?void 0:At.errored)!==null&&e!==void 0?e:null:null}function isReadableErrored$3(xt){var e,At;return isNodeStream$9(xt)?xt.readableErrored?xt.readableErrored:(e=(At=xt._readableState)===null||At===void 0?void 0:At.errored)!==null&&e!==void 0?e:null:null}function isClosed$3(xt){if(!isNodeStream$9(xt))return null;if(typeof xt.closed=="boolean")return xt.closed;const e=xt._writableState,At=xt._readableState;return typeof(e==null?void 0:e.closed)=="boolean"||typeof(At==null?void 0:At.closed)=="boolean"?(e==null?void 0:e.closed)||(At==null?void 0:At.closed):typeof xt._closed=="boolean"&&isOutgoingMessage$1(xt)?xt._closed:null}function isOutgoingMessage$1(xt){return typeof xt._closed=="boolean"&&typeof xt._defaultKeepAlive=="boolean"&&typeof xt._removedConnection=="boolean"&&typeof xt._removedContLen=="boolean"}function isServerResponse$1(xt){return typeof xt._sent100=="boolean"&&isOutgoingMessage$1(xt)}function isServerRequest$3(xt){var e;return typeof xt._consuming=="boolean"&&typeof xt._dumped=="boolean"&&((e=xt.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function willEmitClose$1(xt){if(!isNodeStream$9(xt))return null;const e=xt._writableState,At=xt._readableState,kt=e||At;return!kt&&isServerResponse$1(xt)||!!(kt&&kt.autoDestroy&&kt.emitClose&&kt.closed===!1)}function isDisturbed$1(xt){var e;return!!(xt&&((e=xt[kIsDisturbed$1])!==null&&e!==void 0?e:xt.readableDidRead||xt.readableAborted))}function isErrored$1(xt){var e,At,kt,Bt,Nt,jt,Lt,er,tr,zt;return!!(xt&&((e=(At=(kt=(Bt=(Nt=(jt=xt[kIsErrored$1])!==null&&jt!==void 0?jt:xt.readableErrored)!==null&&Nt!==void 0?Nt:xt.writableErrored)!==null&&Bt!==void 0?Bt:(Lt=xt._readableState)===null||Lt===void 0?void 0:Lt.errorEmitted)!==null&&kt!==void 0?kt:(er=xt._writableState)===null||er===void 0?void 0:er.errorEmitted)!==null&&At!==void 0?At:(tr=xt._readableState)===null||tr===void 0?void 0:tr.errored)!==null&&e!==void 0?e:!((zt=xt._writableState)===null||zt===void 0)&&zt.errored))}var utils$2={isDestroyed:isDestroyed$3,kIsDestroyed:kIsDestroyed$1,isDisturbed:isDisturbed$1,kIsDisturbed:kIsDisturbed$1,isErrored:isErrored$1,kIsErrored:kIsErrored$1,isReadable:isReadable$7,kIsReadable:kIsReadable$1,kIsClosedPromise:kIsClosedPromise$3,kControllerErrorFunction:kControllerErrorFunction$1,kIsWritable,isClosed:isClosed$3,isDuplexNodeStream:isDuplexNodeStream$1,isFinished:isFinished$3,isIterable:isIterable$4,isReadableNodeStream:isReadableNodeStream$5,isReadableStream:isReadableStream$7,isReadableEnded:isReadableEnded$2,isReadableFinished:isReadableFinished$4,isReadableErrored:isReadableErrored$3,isNodeStream:isNodeStream$9,isWebStream:isWebStream$5,isWritable:isWritable$7,isWritableNodeStream:isWritableNodeStream$3,isWritableStream:isWritableStream$5,isWritableEnded:isWritableEnded$1,isWritableFinished:isWritableFinished$3,isWritableErrored:isWritableErrored$3,isServerRequest:isServerRequest$3,isServerResponse:isServerResponse$1,willEmitClose:willEmitClose$1,isTransformStream:isTransformStream$5};const process$7=browserExports$3,{AbortError:AbortError$d,codes:codes$2}=errors$2,{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$9,ERR_STREAM_PREMATURE_CLOSE:ERR_STREAM_PREMATURE_CLOSE$3}=codes$2,{kEmptyObject:kEmptyObject$1,once:once$3}=utilExports$1,{validateAbortSignal:validateAbortSignal$6,validateFunction:validateFunction$5,validateObject:validateObject$5,validateBoolean:validateBoolean$2}=validators$1,{Promise:Promise$6,PromisePrototypeThen:PromisePrototypeThen$5,SymbolDispose:SymbolDispose$1}=primordials$1,{isClosed:isClosed$2,isReadable:isReadable$6,isReadableNodeStream:isReadableNodeStream$4,isReadableStream:isReadableStream$6,isReadableFinished:isReadableFinished$3,isReadableErrored:isReadableErrored$2,isWritable:isWritable$6,isWritableNodeStream:isWritableNodeStream$2,isWritableStream:isWritableStream$4,isWritableFinished:isWritableFinished$2,isWritableErrored:isWritableErrored$2,isNodeStream:isNodeStream$8,willEmitClose:_willEmitClose$1,kIsClosedPromise:kIsClosedPromise$2}=utils$2;let addAbortListener$1;function isRequest$3(xt){return xt.setHeader&&typeof xt.abort=="function"}const nop$1=()=>{};function eos$5(xt,e,At){var kt,Bt;if(arguments.length===2?(At=e,e=kEmptyObject$1):e==null?e=kEmptyObject$1:validateObject$5(e,"options"),validateFunction$5(At,"callback"),validateAbortSignal$6(e.signal,"options.signal"),At=once$3(At),isReadableStream$6(xt)||isWritableStream$4(xt))return eosWeb$1(xt,e,At);if(!isNodeStream$8(xt))throw new ERR_INVALID_ARG_TYPE$9("stream",["ReadableStream","WritableStream","Stream"],xt);const Nt=(kt=e.readable)!==null&&kt!==void 0?kt:isReadableNodeStream$4(xt),jt=(Bt=e.writable)!==null&&Bt!==void 0?Bt:isWritableNodeStream$2(xt),Lt=xt._writableState,er=xt._readableState,tr=()=>{xt.writable||nr()};let zt=_willEmitClose$1(xt)&&isReadableNodeStream$4(xt)===Nt&&isWritableNodeStream$2(xt)===jt,rr=isWritableFinished$2(xt,!1);const nr=()=>{rr=!0,xt.destroyed&&(zt=!1),!(zt&&(!xt.readable||Nt))&&(!Nt||ir)&&At.call(xt)};let ir=isReadableFinished$3(xt,!1);const ar=()=>{ir=!0,xt.destroyed&&(zt=!1),!(zt&&(!xt.writable||jt))&&(!jt||rr)&&At.call(xt)},dr=br=>{At.call(xt,br)};let ur=isClosed$2(xt);const fr=()=>{ur=!0;const br=isWritableErrored$2(xt)||isReadableErrored$2(xt);if(br&&typeof br!="boolean")return At.call(xt,br);if(Nt&&!ir&&isReadableNodeStream$4(xt,!0)&&!isReadableFinished$3(xt,!1))return At.call(xt,new ERR_STREAM_PREMATURE_CLOSE$3);if(jt&&!rr&&!isWritableFinished$2(xt,!1))return At.call(xt,new ERR_STREAM_PREMATURE_CLOSE$3);At.call(xt)},pr=()=>{ur=!0;const br=isWritableErrored$2(xt)||isReadableErrored$2(xt);if(br&&typeof br!="boolean")return At.call(xt,br);At.call(xt)},lr=()=>{xt.req.on("finish",nr)};isRequest$3(xt)?(xt.on("complete",nr),zt||xt.on("abort",fr),xt.req?lr():xt.on("request",lr)):jt&&!Lt&&(xt.on("end",tr),xt.on("close",tr)),!zt&&typeof xt.aborted=="boolean"&&xt.on("aborted",fr),xt.on("end",ar),xt.on("finish",nr),e.error!==!1&&xt.on("error",dr),xt.on("close",fr),ur?process$7.nextTick(fr):Lt!=null&&Lt.errorEmitted||er!=null&&er.errorEmitted?zt||process$7.nextTick(pr):(!Nt&&(!zt||isReadable$6(xt))&&(rr||isWritable$6(xt)===!1)||!jt&&(!zt||isWritable$6(xt))&&(ir||isReadable$6(xt)===!1)||er&&xt.req&&xt.aborted)&&process$7.nextTick(pr);const yr=()=>{At=nop$1,xt.removeListener("aborted",fr),xt.removeListener("complete",nr),xt.removeListener("abort",fr),xt.removeListener("request",lr),xt.req&&xt.req.removeListener("finish",nr),xt.removeListener("end",tr),xt.removeListener("close",tr),xt.removeListener("finish",nr),xt.removeListener("end",ar),xt.removeListener("error",dr),xt.removeListener("close",fr)};if(e.signal&&!ur){const br=()=>{const Ar=At;yr(),Ar.call(xt,new AbortError$d(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)process$7.nextTick(br);else{addAbortListener$1=addAbortListener$1||utilExports$1.addAbortListener;const Ar=addAbortListener$1(e.signal,br),Pr=At;At=once$3((...kr)=>{Ar[SymbolDispose$1](),Pr.apply(xt,kr)})}}return yr}function eosWeb$1(xt,e,At){let kt=!1,Bt=nop$1;if(e.signal)if(Bt=()=>{kt=!0,At.call(xt,new AbortError$d(void 0,{cause:e.signal.reason}))},e.signal.aborted)process$7.nextTick(Bt);else{addAbortListener$1=addAbortListener$1||utilExports$1.addAbortListener;const jt=addAbortListener$1(e.signal,Bt),Lt=At;At=once$3((...er)=>{jt[SymbolDispose$1](),Lt.apply(xt,er)})}const Nt=(...jt)=>{kt||process$7.nextTick(()=>At.apply(xt,jt))};return PromisePrototypeThen$5(xt[kIsClosedPromise$2].promise,Nt,Nt),nop$1}function finished$3(xt,e){var At;let kt=!1;return e===null&&(e=kEmptyObject$1),(At=e)!==null&&At!==void 0&&At.cleanup&&(validateBoolean$2(e.cleanup,"cleanup"),kt=e.cleanup),new Promise$6((Bt,Nt)=>{const jt=eos$5(xt,e,Lt=>{kt&&jt(),Lt?Nt(Lt):Bt()})})}endOfStream$1.exports=eos$5;endOfStream$1.exports.finished=finished$3;var endOfStreamExports$1=endOfStream$1.exports;const process$6=browserExports$3,{aggregateTwoErrors:aggregateTwoErrors$4,codes:{ERR_MULTIPLE_CALLBACK:ERR_MULTIPLE_CALLBACK$1},AbortError:AbortError$c}=errors$2,{Symbol:Symbol$7}=primordials$1,{kIsDestroyed,isDestroyed:isDestroyed$2,isFinished:isFinished$2,isServerRequest:isServerRequest$2}=utils$2,kDestroy$1=Symbol$7("kDestroy"),kConstruct$1=Symbol$7("kConstruct");function checkError$1(xt,e,At){xt&&(xt.stack,e&&!e.errored&&(e.errored=xt),At&&!At.errored&&(At.errored=xt))}function destroy$1(xt,e){const At=this._readableState,kt=this._writableState,Bt=kt||At;return kt!=null&&kt.destroyed||At!=null&&At.destroyed?(typeof e=="function"&&e(),this):(checkError$1(xt,kt,At),kt&&(kt.destroyed=!0),At&&(At.destroyed=!0),Bt.constructed?_destroy$1(this,xt,e):this.once(kDestroy$1,function(Nt){_destroy$1(this,aggregateTwoErrors$4(Nt,xt),e)}),this)}function _destroy$1(xt,e,At){let kt=!1;function Bt(Nt){if(kt)return;kt=!0;const jt=xt._readableState,Lt=xt._writableState;checkError$1(Nt,Lt,jt),Lt&&(Lt.closed=!0),jt&&(jt.closed=!0),typeof At=="function"&&At(Nt),Nt?process$6.nextTick(emitErrorCloseNT$1,xt,Nt):process$6.nextTick(emitCloseNT$1,xt)}try{xt._destroy(e||null,Bt)}catch(Nt){Bt(Nt)}}function emitErrorCloseNT$1(xt,e){emitErrorNT$1(xt,e),emitCloseNT$1(xt)}function emitCloseNT$1(xt){const e=xt._readableState,At=xt._writableState;At&&(At.closeEmitted=!0),e&&(e.closeEmitted=!0),(At!=null&&At.emitClose||e!=null&&e.emitClose)&&xt.emit("close")}function emitErrorNT$1(xt,e){const At=xt._readableState,kt=xt._writableState;kt!=null&&kt.errorEmitted||At!=null&&At.errorEmitted||(kt&&(kt.errorEmitted=!0),At&&(At.errorEmitted=!0),xt.emit("error",e))}function undestroy$1(){const xt=this._readableState,e=this._writableState;xt&&(xt.constructed=!0,xt.closed=!1,xt.closeEmitted=!1,xt.destroyed=!1,xt.errored=null,xt.errorEmitted=!1,xt.reading=!1,xt.ended=xt.readable===!1,xt.endEmitted=xt.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function errorOrDestroy$1(xt,e,At){const kt=xt._readableState,Bt=xt._writableState;if(Bt!=null&&Bt.destroyed||kt!=null&&kt.destroyed)return this;kt!=null&&kt.autoDestroy||Bt!=null&&Bt.autoDestroy?xt.destroy(e):e&&(e.stack,Bt&&!Bt.errored&&(Bt.errored=e),kt&&!kt.errored&&(kt.errored=e),At?process$6.nextTick(emitErrorNT$1,xt,e):emitErrorNT$1(xt,e))}function construct$1(xt,e){if(typeof xt._construct!="function")return;const At=xt._readableState,kt=xt._writableState;At&&(At.constructed=!1),kt&&(kt.constructed=!1),xt.once(kConstruct$1,e),!(xt.listenerCount(kConstruct$1)>1)&&process$6.nextTick(constructNT$1,xt)}function constructNT$1(xt){let e=!1;function At(kt){if(e){errorOrDestroy$1(xt,kt??new ERR_MULTIPLE_CALLBACK$1);return}e=!0;const Bt=xt._readableState,Nt=xt._writableState,jt=Nt||Bt;Bt&&(Bt.constructed=!0),Nt&&(Nt.constructed=!0),jt.destroyed?xt.emit(kDestroy$1,kt):kt?errorOrDestroy$1(xt,kt,!0):process$6.nextTick(emitConstructNT$1,xt)}try{xt._construct(kt=>{process$6.nextTick(At,kt)})}catch(kt){process$6.nextTick(At,kt)}}function emitConstructNT$1(xt){xt.emit(kConstruct$1)}function isRequest$2(xt){return(xt==null?void 0:xt.setHeader)&&typeof xt.abort=="function"}function emitCloseLegacy$1(xt){xt.emit("close")}function emitErrorCloseLegacy$1(xt,e){xt.emit("error",e),process$6.nextTick(emitCloseLegacy$1,xt)}function destroyer$5(xt,e){!xt||isDestroyed$2(xt)||(!e&&!isFinished$2(xt)&&(e=new AbortError$c),isServerRequest$2(xt)?(xt.socket=null,xt.destroy(e)):isRequest$2(xt)?xt.abort():isRequest$2(xt.req)?xt.req.abort():typeof xt.destroy=="function"?xt.destroy(e):typeof xt.close=="function"?xt.close():e?process$6.nextTick(emitErrorCloseLegacy$1,xt,e):process$6.nextTick(emitCloseLegacy$1,xt),xt.destroyed||(xt[kIsDestroyed]=!0))}var destroy_1$1={construct:construct$1,destroyer:destroyer$5,destroy:destroy$1,undestroy:undestroy$1,errorOrDestroy:errorOrDestroy$1};const{ArrayIsArray:ArrayIsArray$4,ObjectSetPrototypeOf:ObjectSetPrototypeOf$5}=primordials$1,{EventEmitter:EE$1}=eventsExports;function Stream$3(xt){EE$1.call(this,xt)}ObjectSetPrototypeOf$5(Stream$3.prototype,EE$1.prototype);ObjectSetPrototypeOf$5(Stream$3,EE$1);Stream$3.prototype.pipe=function(xt,e){const At=this;function kt(zt){xt.writable&&xt.write(zt)===!1&&At.pause&&At.pause()}At.on("data",kt);function Bt(){At.readable&&At.resume&&At.resume()}xt.on("drain",Bt),!xt._isStdio&&(!e||e.end!==!1)&&(At.on("end",jt),At.on("close",Lt));let Nt=!1;function jt(){Nt||(Nt=!0,xt.end())}function Lt(){Nt||(Nt=!0,typeof xt.destroy=="function"&&xt.destroy())}function er(zt){tr(),EE$1.listenerCount(this,"error")===0&&this.emit("error",zt)}prependListener$1(At,"error",er),prependListener$1(xt,"error",er);function tr(){At.removeListener("data",kt),xt.removeListener("drain",Bt),At.removeListener("end",jt),At.removeListener("close",Lt),At.removeListener("error",er),xt.removeListener("error",er),At.removeListener("end",tr),At.removeListener("close",tr),xt.removeListener("close",tr)}return At.on("end",tr),At.on("close",tr),xt.on("close",tr),xt.emit("pipe",At),xt};function prependListener$1(xt,e,At){if(typeof xt.prependListener=="function")return xt.prependListener(e,At);!xt._events||!xt._events[e]?xt.on(e,At):ArrayIsArray$4(xt._events[e])?xt._events[e].unshift(At):xt._events[e]=[At,xt._events[e]]}var legacy$1={Stream:Stream$3,prependListener:prependListener$1},addAbortSignal$1={exports:{}};(function(xt){const{SymbolDispose:e}=primordials$1,{AbortError:At,codes:kt}=errors$2,{isNodeStream:Bt,isWebStream:Nt,kControllerErrorFunction:jt}=utils$2,Lt=endOfStreamExports$1,{ERR_INVALID_ARG_TYPE:er}=kt;let tr;const zt=(rr,nr)=>{if(typeof rr!="object"||!("aborted"in rr))throw new er(nr,"AbortSignal",rr)};xt.exports.addAbortSignal=function(nr,ir){if(zt(nr,"signal"),!Bt(ir)&&!Nt(ir))throw new er("stream",["ReadableStream","WritableStream","Stream"],ir);return xt.exports.addAbortSignalNoValidate(nr,ir)},xt.exports.addAbortSignalNoValidate=function(rr,nr){if(typeof rr!="object"||!("aborted"in rr))return nr;const ir=Bt(nr)?()=>{nr.destroy(new At(void 0,{cause:rr.reason}))}:()=>{nr[jt](new At(void 0,{cause:rr.reason}))};if(rr.aborted)ir();else{tr=tr||utilExports$1.addAbortListener;const ar=tr(rr,ir);Lt(nr,ar[e])}return nr}})(addAbortSignal$1);var addAbortSignalExports$1=addAbortSignal$1.exports;const{StringPrototypeSlice:StringPrototypeSlice$1,SymbolIterator:SymbolIterator$4,TypedArrayPrototypeSet:TypedArrayPrototypeSet$1,Uint8Array:Uint8Array$2}=primordials$1,{Buffer:Buffer$5}=buffer$2,{inspect:inspect$2}=utilExports$1;var buffer_list$1=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const At={data:e,next:null};this.length>0?this.tail.next=At:this.head=At,this.tail=At,++this.length}unshift(e){const At={data:e,next:this.head};this.length===0&&(this.tail=At),this.head=At,++this.length}shift(){if(this.length===0)return;const e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let At=this.head,kt=""+At.data;for(;(At=At.next)!==null;)kt+=e+At.data;return kt}concat(e){if(this.length===0)return Buffer$5.alloc(0);const At=Buffer$5.allocUnsafe(e>>>0);let kt=this.head,Bt=0;for(;kt;)TypedArrayPrototypeSet$1(At,kt.data,Bt),Bt+=kt.data.length,kt=kt.next;return At}consume(e,At){const kt=this.head.data;if(e<kt.length){const Bt=kt.slice(0,e);return this.head.data=kt.slice(e),Bt}return e===kt.length?this.shift():At?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[SymbolIterator$4](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let At="",kt=this.head,Bt=0;do{const Nt=kt.data;if(e>Nt.length)At+=Nt,e-=Nt.length;else{e===Nt.length?(At+=Nt,++Bt,kt.next?this.head=kt.next:this.head=this.tail=null):(At+=StringPrototypeSlice$1(Nt,0,e),this.head=kt,kt.data=StringPrototypeSlice$1(Nt,e));break}++Bt}while((kt=kt.next)!==null);return this.length-=Bt,At}_getBuffer(e){const At=Buffer$5.allocUnsafe(e),kt=e;let Bt=this.head,Nt=0;do{const jt=Bt.data;if(e>jt.length)TypedArrayPrototypeSet$1(At,jt,kt-e),e-=jt.length;else{e===jt.length?(TypedArrayPrototypeSet$1(At,jt,kt-e),++Nt,Bt.next?this.head=Bt.next:this.head=this.tail=null):(TypedArrayPrototypeSet$1(At,new Uint8Array$2(jt.buffer,jt.byteOffset,e),kt-e),this.head=Bt,Bt.data=jt.slice(e));break}++Nt}while((Bt=Bt.next)!==null);return this.length-=Nt,At}[Symbol.for("nodejs.util.inspect.custom")](e,At){return inspect$2(this,{...At,depth:0,customInspect:!1})}};const{MathFloor:MathFloor$3,NumberIsInteger:NumberIsInteger$2}=primordials$1,{validateInteger:validateInteger$3}=validators$1,{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$6}=errors$2.codes;let defaultHighWaterMarkBytes=16*1024,defaultHighWaterMarkObjectMode=16;function highWaterMarkFrom$1(xt,e,At){return xt.highWaterMark!=null?xt.highWaterMark:e?xt[At]:null}function getDefaultHighWaterMark$1(xt){return xt?defaultHighWaterMarkObjectMode:defaultHighWaterMarkBytes}function setDefaultHighWaterMark(xt,e){validateInteger$3(e,"value",0),xt?defaultHighWaterMarkObjectMode=e:defaultHighWaterMarkBytes=e}function getHighWaterMark$3(xt,e,At,kt){const Bt=highWaterMarkFrom$1(e,kt,At);if(Bt!=null){if(!NumberIsInteger$2(Bt)||Bt<0){const Nt=kt?`options.${At}`:"options.highWaterMark";throw new ERR_INVALID_ARG_VALUE$6(Nt,Bt)}return MathFloor$3(Bt)}return getDefaultHighWaterMark$1(xt.objectMode)}var state$1={getHighWaterMark:getHighWaterMark$3,getDefaultHighWaterMark:getDefaultHighWaterMark$1,setDefaultHighWaterMark};const process$5=browserExports$3,{PromisePrototypeThen:PromisePrototypeThen$4,SymbolAsyncIterator:SymbolAsyncIterator$4,SymbolIterator:SymbolIterator$3}=primordials$1,{Buffer:Buffer$4}=buffer$2,{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$8,ERR_STREAM_NULL_VALUES:ERR_STREAM_NULL_VALUES$1}=errors$2.codes;function from$4(xt,e,At){let kt;if(typeof e=="string"||e instanceof Buffer$4)return new xt({objectMode:!0,...At,read(){this.push(e),this.push(null)}});let Bt;if(e&&e[SymbolAsyncIterator$4])Bt=!0,kt=e[SymbolAsyncIterator$4]();else if(e&&e[SymbolIterator$3])Bt=!1,kt=e[SymbolIterator$3]();else throw new ERR_INVALID_ARG_TYPE$8("iterable",["Iterable"],e);const Nt=new xt({objectMode:!0,highWaterMark:1,...At});let jt=!1;Nt._read=function(){jt||(jt=!0,er())},Nt._destroy=function(tr,zt){PromisePrototypeThen$4(Lt(tr),()=>process$5.nextTick(zt,tr),rr=>process$5.nextTick(zt,rr||tr))};async function Lt(tr){const zt=tr!=null,rr=typeof kt.throw=="function";if(zt&&rr){const{value:nr,done:ir}=await kt.throw(tr);if(await nr,ir)return}if(typeof kt.return=="function"){const{value:nr}=await kt.return();await nr}}async function er(){for(;;){try{const{value:tr,done:zt}=Bt?await kt.next():kt.next();if(zt)Nt.push(null);else{const rr=tr&&typeof tr.then=="function"?await tr:tr;if(rr===null)throw jt=!1,new ERR_STREAM_NULL_VALUES$1;if(Nt.push(rr))continue;jt=!1}}catch(tr){Nt.destroy(tr)}break}}return Nt}var from_1$1=from$4,readable$1,hasRequiredReadable$1;function requireReadable$1(){if(hasRequiredReadable$1)return readable$1;hasRequiredReadable$1=1;const xt=browserExports$3,{ArrayPrototypeIndexOf:e,NumberIsInteger:At,NumberIsNaN:kt,NumberParseInt:Bt,ObjectDefineProperties:Nt,ObjectKeys:jt,ObjectSetPrototypeOf:Lt,Promise:er,SafeSet:tr,SymbolAsyncDispose:zt,SymbolAsyncIterator:rr,Symbol:nr}=primordials$1;readable$1=dn,dn.ReadableState=un;const{EventEmitter:ir}=eventsExports,{Stream:ar,prependListener:dr}=legacy$1,{Buffer:ur}=buffer$2,{addAbortSignal:fr}=addAbortSignalExports$1,pr=endOfStreamExports$1;let lr=utilExports$1.debuglog("stream",nn=>{lr=nn});const yr=buffer_list$1,br=destroy_1$1,{getHighWaterMark:Ar,getDefaultHighWaterMark:Pr}=state$1,{aggregateTwoErrors:kr,codes:{ERR_INVALID_ARG_TYPE:Ur,ERR_METHOD_NOT_IMPLEMENTED:Hr,ERR_OUT_OF_RANGE:Lr,ERR_STREAM_PUSH_AFTER_EOF:Sr,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:_r},AbortError:gr}=errors$2,{validateObject:wr}=validators$1,Dr=nr("kPaused"),{StringDecoder:xr}=string_decoder,Ir=from_1$1;Lt(dn.prototype,ar.prototype),Lt(dn,ar);const $r=()=>{},{errorOrDestroy:vr}=br,Er=1,Tr=2,Rr=4,Mr=8,Gr=16,Br=32,Cr=64,jr=128,Yr=256,Qr=512,Jr=1024,Wr=2048,Nr=4096,Vr=8192,Xr=16384,qr=32768,Or=65536,Fr=1<<17,Zr=1<<18;function rn(nn){return{enumerable:!1,get(){return(this.state&nn)!==0},set(sn){sn?this.state|=nn:this.state&=~nn}}}Nt(un.prototype,{objectMode:rn(Er),ended:rn(Tr),endEmitted:rn(Rr),reading:rn(Mr),constructed:rn(Gr),sync:rn(Br),needReadable:rn(Cr),emittedReadable:rn(jr),readableListening:rn(Yr),resumeScheduled:rn(Qr),errorEmitted:rn(Jr),emitClose:rn(Wr),autoDestroy:rn(Nr),destroyed:rn(Vr),closed:rn(Xr),closeEmitted:rn(qr),multiAwaitDrain:rn(Or),readingMore:rn(Fr),dataEmitted:rn(Zr)});function un(nn,sn,_n){typeof _n!="boolean"&&(_n=sn instanceof requireDuplex$1()),this.state=Wr|Nr|Gr|Br,nn&&nn.objectMode&&(this.state|=Er),_n&&nn&&nn.readableObjectMode&&(this.state|=Er),this.highWaterMark=nn?Ar(this,nn,"readableHighWaterMark",_n):Pr(!1),this.buffer=new yr,this.length=0,this.pipes=[],this.flowing=null,this[Dr]=null,nn&&nn.emitClose===!1&&(this.state&=~Wr),nn&&nn.autoDestroy===!1&&(this.state&=~Nr),this.errored=null,this.defaultEncoding=nn&&nn.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.decoder=null,this.encoding=null,nn&&nn.encoding&&(this.decoder=new xr(nn.encoding),this.encoding=nn.encoding)}function dn(nn){if(!(this instanceof dn))return new dn(nn);const sn=this instanceof requireDuplex$1();this._readableState=new un(nn,this,sn),nn&&(typeof nn.read=="function"&&(this._read=nn.read),typeof nn.destroy=="function"&&(this._destroy=nn.destroy),typeof nn.construct=="function"&&(this._construct=nn.construct),nn.signal&&!sn&&fr(nn.signal,this)),ar.call(this,nn),br.construct(this,()=>{this._readableState.needReadable&&In(this,this._readableState)})}dn.prototype.destroy=br.destroy,dn.prototype._undestroy=br.undestroy,dn.prototype._destroy=function(nn,sn){sn(nn)},dn.prototype[ir.captureRejectionSymbol]=function(nn){this.destroy(nn)},dn.prototype[zt]=function(){let nn;return this.destroyed||(nn=this.readableEnded?null:new gr,this.destroy(nn)),new er((sn,_n)=>pr(this,En=>En&&En!==nn?_n(En):sn(null)))},dn.prototype.push=function(nn,sn){return vn(this,nn,sn,!1)},dn.prototype.unshift=function(nn,sn){return vn(this,nn,sn,!0)};function vn(nn,sn,_n,En){lr("readableAddChunk",sn);const Sn=nn._readableState;let Qn;if(Sn.state&Er||(typeof sn=="string"?(_n=_n||Sn.defaultEncoding,Sn.encoding!==_n&&(En&&Sn.encoding?sn=ur.from(sn,_n).toString(Sn.encoding):(sn=ur.from(sn,_n),_n=""))):sn instanceof ur?_n="":ar._isUint8Array(sn)?(sn=ar._uint8ArrayToBuffer(sn),_n=""):sn!=null&&(Qn=new Ur("chunk",["string","Buffer","Uint8Array"],sn))),Qn)vr(nn,Qn);else if(sn===null)Sn.state&=~Mr,mn(nn,Sn);else if(Sn.state&Er||sn&&sn.length>0)if(En)if(Sn.state&Rr)vr(nn,new _r);else{if(Sn.destroyed||Sn.errored)return!1;$n(nn,Sn,sn,!0)}else if(Sn.ended)vr(nn,new Sr);else{if(Sn.destroyed||Sn.errored)return!1;Sn.state&=~Mr,Sn.decoder&&!_n?(sn=Sn.decoder.write(sn),Sn.objectMode||sn.length!==0?$n(nn,Sn,sn,!1):In(nn,Sn)):$n(nn,Sn,sn,!1)}else En||(Sn.state&=~Mr,In(nn,Sn));return!Sn.ended&&(Sn.length<Sn.highWaterMark||Sn.length===0)}function $n(nn,sn,_n,En){sn.flowing&&sn.length===0&&!sn.sync&&nn.listenerCount("data")>0?(sn.state&Or?sn.awaitDrainWriters.clear():sn.awaitDrainWriters=null,sn.dataEmitted=!0,nn.emit("data",_n)):(sn.length+=sn.objectMode?1:_n.length,En?sn.buffer.unshift(_n):sn.buffer.push(_n),sn.state&Cr&&yn(nn)),In(nn,sn)}dn.prototype.isPaused=function(){const nn=this._readableState;return nn[Dr]===!0||nn.flowing===!1},dn.prototype.setEncoding=function(nn){const sn=new xr(nn);this._readableState.decoder=sn,this._readableState.encoding=this._readableState.decoder.encoding;const _n=this._readableState.buffer;let En="";for(const Sn of _n)En+=sn.write(Sn);return _n.clear(),En!==""&&_n.push(En),this._readableState.length=En.length,this};const en=1073741824;function tn(nn){if(nn>en)throw new Lr("size","<= 1GiB",nn);return nn--,nn|=nn>>>1,nn|=nn>>>2,nn|=nn>>>4,nn|=nn>>>8,nn|=nn>>>16,nn++,nn}function hn(nn,sn){return nn<=0||sn.length===0&&sn.ended?0:sn.state&Er?1:kt(nn)?sn.flowing&&sn.length?sn.buffer.first().length:sn.length:nn<=sn.length?nn:sn.ended?sn.length:0}dn.prototype.read=function(nn){lr("read",nn),nn===void 0?nn=NaN:At(nn)||(nn=Bt(nn,10));const sn=this._readableState,_n=nn;if(nn>sn.highWaterMark&&(sn.highWaterMark=tn(nn)),nn!==0&&(sn.state&=~jr),nn===0&&sn.needReadable&&((sn.highWaterMark!==0?sn.length>=sn.highWaterMark:sn.length>0)||sn.ended))return lr("read: emitReadable",sn.length,sn.ended),sn.length===0&&sn.ended?kn(this):yn(this),null;if(nn=hn(nn,sn),nn===0&&sn.ended)return sn.length===0&&kn(this),null;let En=(sn.state&Cr)!==0;if(lr("need readable",En),(sn.length===0||sn.length-nn<sn.highWaterMark)&&(En=!0,lr("length less than watermark",En)),sn.ended||sn.reading||sn.destroyed||sn.errored||!sn.constructed)En=!1,lr("reading, ended or constructing",En);else if(En){lr("do read"),sn.state|=Mr|Br,sn.length===0&&(sn.state|=Cr);try{this._read(sn.highWaterMark)}catch(Qn){vr(this,Qn)}sn.state&=~Br,sn.reading||(nn=hn(_n,sn))}let Sn;return nn>0?Sn=Wn(nn,sn):Sn=null,Sn===null?(sn.needReadable=sn.length<=sn.highWaterMark,nn=0):(sn.length-=nn,sn.multiAwaitDrain?sn.awaitDrainWriters.clear():sn.awaitDrainWriters=null),sn.length===0&&(sn.ended||(sn.needReadable=!0),_n!==nn&&sn.ended&&kn(this)),Sn!==null&&!sn.errorEmitted&&!sn.closeEmitted&&(sn.dataEmitted=!0,this.emit("data",Sn)),Sn};function mn(nn,sn){if(lr("onEofChunk"),!sn.ended){if(sn.decoder){const _n=sn.decoder.end();_n&&_n.length&&(sn.buffer.push(_n),sn.length+=sn.objectMode?1:_n.length)}sn.ended=!0,sn.sync?yn(nn):(sn.needReadable=!1,sn.emittedReadable=!0,xn(nn))}}function yn(nn){const sn=nn._readableState;lr("emitReadable",sn.needReadable,sn.emittedReadable),sn.needReadable=!1,sn.emittedReadable||(lr("emitReadable",sn.flowing),sn.emittedReadable=!0,xt.nextTick(xn,nn))}function xn(nn){const sn=nn._readableState;lr("emitReadable_",sn.destroyed,sn.length,sn.ended),!sn.destroyed&&!sn.errored&&(sn.length||sn.ended)&&(nn.emit("readable"),sn.emittedReadable=!1),sn.needReadable=!sn.flowing&&!sn.ended&&sn.length<=sn.highWaterMark,Pn(nn)}function In(nn,sn){!sn.readingMore&&sn.constructed&&(sn.readingMore=!0,xt.nextTick(On,nn,sn))}function On(nn,sn){for(;!sn.reading&&!sn.ended&&(sn.length<sn.highWaterMark||sn.flowing&&sn.length===0);){const _n=sn.length;if(lr("maybeReadMore read 0"),nn.read(0),_n===sn.length)break}sn.readingMore=!1}dn.prototype._read=function(nn){throw new Hr("_read()")},dn.prototype.pipe=function(nn,sn){const _n=this,En=this._readableState;En.pipes.length===1&&(En.multiAwaitDrain||(En.multiAwaitDrain=!0,En.awaitDrainWriters=new tr(En.awaitDrainWriters?[En.awaitDrainWriters]:[]))),En.pipes.push(nn),lr("pipe count=%d opts=%j",En.pipes.length,sn);const Qn=(!sn||sn.end!==!1)&&nn!==xt.stdout&&nn!==xt.stderr?an:Ln;En.endEmitted?xt.nextTick(Qn):_n.once("end",Qn),nn.on("unpipe",Xn);function Xn(Kn,Vn){lr("onunpipe"),Kn===_n&&Vn&&Vn.hasUnpiped===!1&&(Vn.hasUnpiped=!0,pn())}function an(){lr("onend"),nn.end()}let on,fn=!1;function pn(){lr("cleanup"),nn.removeListener("close",Bn),nn.removeListener("finish",Un),on&&nn.removeListener("drain",on),nn.removeListener("error",Tn),nn.removeListener("unpipe",Xn),_n.removeListener("end",an),_n.removeListener("end",Ln),_n.removeListener("data",An),fn=!0,on&&En.awaitDrainWriters&&(!nn._writableState||nn._writableState.needDrain)&&on()}function gn(){fn||(En.pipes.length===1&&En.pipes[0]===nn?(lr("false write response, pause",0),En.awaitDrainWriters=nn,En.multiAwaitDrain=!1):En.pipes.length>1&&En.pipes.includes(nn)&&(lr("false write response, pause",En.awaitDrainWriters.size),En.awaitDrainWriters.add(nn)),_n.pause()),on||(on=Dn(_n,nn),nn.on("drain",on))}_n.on("data",An);function An(Kn){lr("ondata");const Vn=nn.write(Kn);lr("dest.write",Vn),Vn===!1&&gn()}function Tn(Kn){if(lr("onerror",Kn),Ln(),nn.removeListener("error",Tn),nn.listenerCount("error")===0){const Vn=nn._writableState||nn._readableState;Vn&&!Vn.errorEmitted?vr(nn,Kn):nn.emit("error",Kn)}}dr(nn,"error",Tn);function Bn(){nn.removeListener("finish",Un),Ln()}nn.once("close",Bn);function Un(){lr("onfinish"),nn.removeListener("close",Bn),Ln()}nn.once("finish",Un);function Ln(){lr("unpipe"),_n.unpipe(nn)}return nn.emit("pipe",_n),nn.writableNeedDrain===!0?gn():En.flowing||(lr("pipe resume"),_n.resume()),nn};function Dn(nn,sn){return function(){const En=nn._readableState;En.awaitDrainWriters===sn?(lr("pipeOnDrain",1),En.awaitDrainWriters=null):En.multiAwaitDrain&&(lr("pipeOnDrain",En.awaitDrainWriters.size),En.awaitDrainWriters.delete(sn)),(!En.awaitDrainWriters||En.awaitDrainWriters.size===0)&&nn.listenerCount("data")&&nn.resume()}}dn.prototype.unpipe=function(nn){const sn=this._readableState,_n={hasUnpiped:!1};if(sn.pipes.length===0)return this;if(!nn){const Sn=sn.pipes;sn.pipes=[],this.pause();for(let Qn=0;Qn<Sn.length;Qn++)Sn[Qn].emit("unpipe",this,{hasUnpiped:!1});return this}const En=e(sn.pipes,nn);return En===-1?this:(sn.pipes.splice(En,1),sn.pipes.length===0&&this.pause(),nn.emit("unpipe",this,_n),this)},dn.prototype.on=function(nn,sn){const _n=ar.prototype.on.call(this,nn,sn),En=this._readableState;return nn==="data"?(En.readableListening=this.listenerCount("readable")>0,En.flowing!==!1&&this.resume()):nn==="readable"&&!En.endEmitted&&!En.readableListening&&(En.readableListening=En.needReadable=!0,En.flowing=!1,En.emittedReadable=!1,lr("on readable",En.length,En.reading),En.length?yn(this):En.reading||xt.nextTick(Hn,this)),_n},dn.prototype.addListener=dn.prototype.on,dn.prototype.removeListener=function(nn,sn){const _n=ar.prototype.removeListener.call(this,nn,sn);return nn==="readable"&&xt.nextTick(Yn,this),_n},dn.prototype.off=dn.prototype.removeListener,dn.prototype.removeAllListeners=function(nn){const sn=ar.prototype.removeAllListeners.apply(this,arguments);return(nn==="readable"||nn===void 0)&&xt.nextTick(Yn,this),sn};function Yn(nn){const sn=nn._readableState;sn.readableListening=nn.listenerCount("readable")>0,sn.resumeScheduled&&sn[Dr]===!1?sn.flowing=!0:nn.listenerCount("data")>0?nn.resume():sn.readableListening||(sn.flowing=null)}function Hn(nn){lr("readable nexttick read 0"),nn.read(0)}dn.prototype.resume=function(){const nn=this._readableState;return nn.flowing||(lr("resume"),nn.flowing=!nn.readableListening,Mn(this,nn)),nn[Dr]=!1,this};function Mn(nn,sn){sn.resumeScheduled||(sn.resumeScheduled=!0,xt.nextTick(zn,nn,sn))}function zn(nn,sn){lr("resume",sn.reading),sn.reading||nn.read(0),sn.resumeScheduled=!1,nn.emit("resume"),Pn(nn),sn.flowing&&!sn.reading&&nn.read(0)}dn.prototype.pause=function(){return lr("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(lr("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[Dr]=!0,this};function Pn(nn){const sn=nn._readableState;for(lr("flow",sn.flowing);sn.flowing&&nn.read()!==null;);}dn.prototype.wrap=function(nn){let sn=!1;nn.on("data",En=>{!this.push(En)&&nn.pause&&(sn=!0,nn.pause())}),nn.on("end",()=>{this.push(null)}),nn.on("error",En=>{vr(this,En)}),nn.on("close",()=>{this.destroy()}),nn.on("destroy",()=>{this.destroy()}),this._read=()=>{sn&&nn.resume&&(sn=!1,nn.resume())};const _n=jt(nn);for(let En=1;En<_n.length;En++){const Sn=_n[En];this[Sn]===void 0&&typeof nn[Sn]=="function"&&(this[Sn]=nn[Sn].bind(nn))}return this},dn.prototype[rr]=function(){return Rn(this)},dn.prototype.iterator=function(nn){return nn!==void 0&&wr(nn,"options"),Rn(this,nn)};function Rn(nn,sn){typeof nn.read!="function"&&(nn=dn.wrap(nn,{objectMode:!0}));const _n=Nn(nn,sn);return _n.stream=nn,_n}async function*Nn(nn,sn){let _n=$r;function En(Xn){this===nn?(_n(),_n=$r):_n=Xn}nn.on("readable",En);let Sn;const Qn=pr(nn,{writable:!1},Xn=>{Sn=Xn?kr(Sn,Xn):null,_n(),_n=$r});try{for(;;){const Xn=nn.destroyed?null:nn.read();if(Xn!==null)yield Xn;else{if(Sn)throw Sn;if(Sn===null)return;await new er(En)}}}catch(Xn){throw Sn=kr(Sn,Xn),Sn}finally{(Sn||(sn==null?void 0:sn.destroyOnReturn)!==!1)&&(Sn===void 0||nn._readableState.autoDestroy)?br.destroyer(nn,null):(nn.off("readable",En),Qn())}}Nt(dn.prototype,{readable:{__proto__:null,get(){const nn=this._readableState;return!!nn&&nn.readable!==!1&&!nn.destroyed&&!nn.errorEmitted&&!nn.endEmitted},set(nn){this._readableState&&(this._readableState.readable=!!nn)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(nn){this._readableState&&(this._readableState.flowing=nn)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(nn){this._readableState&&(this._readableState.destroyed=nn)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),Nt(un.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[Dr]!==!1},set(nn){this[Dr]=!!nn}}}),dn._fromList=Wn;function Wn(nn,sn){if(sn.length===0)return null;let _n;return sn.objectMode?_n=sn.buffer.shift():!nn||nn>=sn.length?(sn.decoder?_n=sn.buffer.join(""):sn.buffer.length===1?_n=sn.buffer.first():_n=sn.buffer.concat(sn.length),sn.buffer.clear()):_n=sn.buffer.consume(nn,sn.decoder),_n}function kn(nn){const sn=nn._readableState;lr("endReadable",sn.endEmitted),sn.endEmitted||(sn.ended=!0,xt.nextTick(Zn,sn,nn))}function Zn(nn,sn){if(lr("endReadableNT",nn.endEmitted,nn.length),!nn.errored&&!nn.closeEmitted&&!nn.endEmitted&&nn.length===0){if(nn.endEmitted=!0,sn.emit("end"),sn.writable&&sn.allowHalfOpen===!1)xt.nextTick(eo,sn);else if(nn.autoDestroy){const _n=sn._writableState;(!_n||_n.autoDestroy&&(_n.finished||_n.writable===!1))&&sn.destroy()}}}function eo(nn){nn.writable&&!nn.writableEnded&&!nn.destroyed&&nn.end()}dn.from=function(nn,sn){return Ir(dn,nn,sn)};let qn;function io(){return qn===void 0&&(qn={}),qn}return dn.fromWeb=function(nn,sn){return io().newStreamReadableFromReadableStream(nn,sn)},dn.toWeb=function(nn,sn){return io().newReadableStreamFromStreamReadable(nn,sn)},dn.wrap=function(nn,sn){var _n,En;return new dn({objectMode:(_n=(En=nn.readableObjectMode)!==null&&En!==void 0?En:nn.objectMode)!==null&&_n!==void 0?_n:!0,...sn,destroy(Sn,Qn){br.destroyer(nn,Sn),Qn(Sn)}}).wrap(nn)},readable$1}var writable$1,hasRequiredWritable$1;function requireWritable$1(){if(hasRequiredWritable$1)return writable$1;hasRequiredWritable$1=1;const xt=browserExports$3,{ArrayPrototypeSlice:e,Error:At,FunctionPrototypeSymbolHasInstance:kt,ObjectDefineProperty:Bt,ObjectDefineProperties:Nt,ObjectSetPrototypeOf:jt,StringPrototypeToLowerCase:Lt,Symbol:er,SymbolHasInstance:tr}=primordials$1;writable$1=wr,wr.WritableState=_r;const{EventEmitter:zt}=eventsExports,rr=legacy$1.Stream,{Buffer:nr}=buffer$2,ir=destroy_1$1,{addAbortSignal:ar}=addAbortSignalExports$1,{getHighWaterMark:dr,getDefaultHighWaterMark:ur}=state$1,{ERR_INVALID_ARG_TYPE:fr,ERR_METHOD_NOT_IMPLEMENTED:pr,ERR_MULTIPLE_CALLBACK:lr,ERR_STREAM_CANNOT_PIPE:yr,ERR_STREAM_DESTROYED:br,ERR_STREAM_ALREADY_FINISHED:Ar,ERR_STREAM_NULL_VALUES:Pr,ERR_STREAM_WRITE_AFTER_END:kr,ERR_UNKNOWN_ENCODING:Ur}=errors$2.codes,{errorOrDestroy:Hr}=ir;jt(wr.prototype,rr.prototype),jt(wr,rr);function Lr(){}const Sr=er("kOnFinished");function _r(Nr,Vr,Xr){typeof Xr!="boolean"&&(Xr=Vr instanceof requireDuplex$1()),this.objectMode=!!(Nr&&Nr.objectMode),Xr&&(this.objectMode=this.objectMode||!!(Nr&&Nr.writableObjectMode)),this.highWaterMark=Nr?dr(this,Nr,"writableHighWaterMark",Xr):ur(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const qr=!!(Nr&&Nr.decodeStrings===!1);this.decodeStrings=!qr,this.defaultEncoding=Nr&&Nr.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=vr.bind(void 0,Vr),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,gr(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!Nr||Nr.emitClose!==!1,this.autoDestroy=!Nr||Nr.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[Sr]=[]}function gr(Nr){Nr.buffered=[],Nr.bufferedIndex=0,Nr.allBuffers=!0,Nr.allNoop=!0}_r.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},Bt(_r.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function wr(Nr){const Vr=this instanceof requireDuplex$1();if(!Vr&&!kt(wr,this))return new wr(Nr);this._writableState=new _r(Nr,this,Vr),Nr&&(typeof Nr.write=="function"&&(this._write=Nr.write),typeof Nr.writev=="function"&&(this._writev=Nr.writev),typeof Nr.destroy=="function"&&(this._destroy=Nr.destroy),typeof Nr.final=="function"&&(this._final=Nr.final),typeof Nr.construct=="function"&&(this._construct=Nr.construct),Nr.signal&&ar(Nr.signal,this)),rr.call(this,Nr),ir.construct(this,()=>{const Xr=this._writableState;Xr.writing||Mr(this,Xr),jr(this,Xr)})}Bt(wr,tr,{__proto__:null,value:function(Nr){return kt(this,Nr)?!0:this!==wr?!1:Nr&&Nr._writableState instanceof _r}}),wr.prototype.pipe=function(){Hr(this,new yr)};function Dr(Nr,Vr,Xr,qr){const Or=Nr._writableState;if(typeof Xr=="function")qr=Xr,Xr=Or.defaultEncoding;else{if(!Xr)Xr=Or.defaultEncoding;else if(Xr!=="buffer"&&!nr.isEncoding(Xr))throw new Ur(Xr);typeof qr!="function"&&(qr=Lr)}if(Vr===null)throw new Pr;if(!Or.objectMode)if(typeof Vr=="string")Or.decodeStrings!==!1&&(Vr=nr.from(Vr,Xr),Xr="buffer");else if(Vr instanceof nr)Xr="buffer";else if(rr._isUint8Array(Vr))Vr=rr._uint8ArrayToBuffer(Vr),Xr="buffer";else throw new fr("chunk",["string","Buffer","Uint8Array"],Vr);let Fr;return Or.ending?Fr=new kr:Or.destroyed&&(Fr=new br("write")),Fr?(xt.nextTick(qr,Fr),Hr(Nr,Fr,!0),Fr):(Or.pendingcb++,xr(Nr,Or,Vr,Xr,qr))}wr.prototype.write=function(Nr,Vr,Xr){return Dr(this,Nr,Vr,Xr)===!0},wr.prototype.cork=function(){this._writableState.corked++},wr.prototype.uncork=function(){const Nr=this._writableState;Nr.corked&&(Nr.corked--,Nr.writing||Mr(this,Nr))},wr.prototype.setDefaultEncoding=function(Vr){if(typeof Vr=="string"&&(Vr=Lt(Vr)),!nr.isEncoding(Vr))throw new Ur(Vr);return this._writableState.defaultEncoding=Vr,this};function xr(Nr,Vr,Xr,qr,Or){const Fr=Vr.objectMode?1:Xr.length;Vr.length+=Fr;const Zr=Vr.length<Vr.highWaterMark;return Zr||(Vr.needDrain=!0),Vr.writing||Vr.corked||Vr.errored||!Vr.constructed?(Vr.buffered.push({chunk:Xr,encoding:qr,callback:Or}),Vr.allBuffers&&qr!=="buffer"&&(Vr.allBuffers=!1),Vr.allNoop&&Or!==Lr&&(Vr.allNoop=!1)):(Vr.writelen=Fr,Vr.writecb=Or,Vr.writing=!0,Vr.sync=!0,Nr._write(Xr,qr,Vr.onwrite),Vr.sync=!1),Zr&&!Vr.errored&&!Vr.destroyed}function Ir(Nr,Vr,Xr,qr,Or,Fr,Zr){Vr.writelen=qr,Vr.writecb=Zr,Vr.writing=!0,Vr.sync=!0,Vr.destroyed?Vr.onwrite(new br("write")):Xr?Nr._writev(Or,Vr.onwrite):Nr._write(Or,Fr,Vr.onwrite),Vr.sync=!1}function $r(Nr,Vr,Xr,qr){--Vr.pendingcb,qr(Xr),Rr(Vr),Hr(Nr,Xr)}function vr(Nr,Vr){const Xr=Nr._writableState,qr=Xr.sync,Or=Xr.writecb;if(typeof Or!="function"){Hr(Nr,new lr);return}Xr.writing=!1,Xr.writecb=null,Xr.length-=Xr.writelen,Xr.writelen=0,Vr?(Vr.stack,Xr.errored||(Xr.errored=Vr),Nr._readableState&&!Nr._readableState.errored&&(Nr._readableState.errored=Vr),qr?xt.nextTick($r,Nr,Xr,Vr,Or):$r(Nr,Xr,Vr,Or)):(Xr.buffered.length>Xr.bufferedIndex&&Mr(Nr,Xr),qr?Xr.afterWriteTickInfo!==null&&Xr.afterWriteTickInfo.cb===Or?Xr.afterWriteTickInfo.count++:(Xr.afterWriteTickInfo={count:1,cb:Or,stream:Nr,state:Xr},xt.nextTick(Er,Xr.afterWriteTickInfo)):Tr(Nr,Xr,1,Or))}function Er({stream:Nr,state:Vr,count:Xr,cb:qr}){return Vr.afterWriteTickInfo=null,Tr(Nr,Vr,Xr,qr)}function Tr(Nr,Vr,Xr,qr){for(!Vr.ending&&!Nr.destroyed&&Vr.length===0&&Vr.needDrain&&(Vr.needDrain=!1,Nr.emit("drain"));Xr-- >0;)Vr.pendingcb--,qr();Vr.destroyed&&Rr(Vr),jr(Nr,Vr)}function Rr(Nr){if(Nr.writing)return;for(let Or=Nr.bufferedIndex;Or<Nr.buffered.length;++Or){var Vr;const{chunk:Fr,callback:Zr}=Nr.buffered[Or],rn=Nr.objectMode?1:Fr.length;Nr.length-=rn,Zr((Vr=Nr.errored)!==null&&Vr!==void 0?Vr:new br("write"))}const Xr=Nr[Sr].splice(0);for(let Or=0;Or<Xr.length;Or++){var qr;Xr[Or]((qr=Nr.errored)!==null&&qr!==void 0?qr:new br("end"))}gr(Nr)}function Mr(Nr,Vr){if(Vr.corked||Vr.bufferProcessing||Vr.destroyed||!Vr.constructed)return;const{buffered:Xr,bufferedIndex:qr,objectMode:Or}=Vr,Fr=Xr.length-qr;if(!Fr)return;let Zr=qr;if(Vr.bufferProcessing=!0,Fr>1&&Nr._writev){Vr.pendingcb-=Fr-1;const rn=Vr.allNoop?Lr:dn=>{for(let vn=Zr;vn<Xr.length;++vn)Xr[vn].callback(dn)},un=Vr.allNoop&&Zr===0?Xr:e(Xr,Zr);un.allBuffers=Vr.allBuffers,Ir(Nr,Vr,!0,Vr.length,un,"",rn),gr(Vr)}else{do{const{chunk:rn,encoding:un,callback:dn}=Xr[Zr];Xr[Zr++]=null;const vn=Or?1:rn.length;Ir(Nr,Vr,!1,vn,rn,un,dn)}while(Zr<Xr.length&&!Vr.writing);Zr===Xr.length?gr(Vr):Zr>256?(Xr.splice(0,Zr),Vr.bufferedIndex=0):Vr.bufferedIndex=Zr}Vr.bufferProcessing=!1}wr.prototype._write=function(Nr,Vr,Xr){if(this._writev)this._writev([{chunk:Nr,encoding:Vr}],Xr);else throw new pr("_write()")},wr.prototype._writev=null,wr.prototype.end=function(Nr,Vr,Xr){const qr=this._writableState;typeof Nr=="function"?(Xr=Nr,Nr=null,Vr=null):typeof Vr=="function"&&(Xr=Vr,Vr=null);let Or;if(Nr!=null){const Fr=Dr(this,Nr,Vr);Fr instanceof At&&(Or=Fr)}return qr.corked&&(qr.corked=1,this.uncork()),Or||(!qr.errored&&!qr.ending?(qr.ending=!0,jr(this,qr,!0),qr.ended=!0):qr.finished?Or=new Ar("end"):qr.destroyed&&(Or=new br("end"))),typeof Xr=="function"&&(Or||qr.finished?xt.nextTick(Xr,Or):qr[Sr].push(Xr)),this};function Gr(Nr){return Nr.ending&&!Nr.destroyed&&Nr.constructed&&Nr.length===0&&!Nr.errored&&Nr.buffered.length===0&&!Nr.finished&&!Nr.writing&&!Nr.errorEmitted&&!Nr.closeEmitted}function Br(Nr,Vr){let Xr=!1;function qr(Or){if(Xr){Hr(Nr,Or??lr());return}if(Xr=!0,Vr.pendingcb--,Or){const Fr=Vr[Sr].splice(0);for(let Zr=0;Zr<Fr.length;Zr++)Fr[Zr](Or);Hr(Nr,Or,Vr.sync)}else Gr(Vr)&&(Vr.prefinished=!0,Nr.emit("prefinish"),Vr.pendingcb++,xt.nextTick(Yr,Nr,Vr))}Vr.sync=!0,Vr.pendingcb++;try{Nr._final(qr)}catch(Or){qr(Or)}Vr.sync=!1}function Cr(Nr,Vr){!Vr.prefinished&&!Vr.finalCalled&&(typeof Nr._final=="function"&&!Vr.destroyed?(Vr.finalCalled=!0,Br(Nr,Vr)):(Vr.prefinished=!0,Nr.emit("prefinish")))}function jr(Nr,Vr,Xr){Gr(Vr)&&(Cr(Nr,Vr),Vr.pendingcb===0&&(Xr?(Vr.pendingcb++,xt.nextTick((qr,Or)=>{Gr(Or)?Yr(qr,Or):Or.pendingcb--},Nr,Vr)):Gr(Vr)&&(Vr.pendingcb++,Yr(Nr,Vr))))}function Yr(Nr,Vr){Vr.pendingcb--,Vr.finished=!0;const Xr=Vr[Sr].splice(0);for(let qr=0;qr<Xr.length;qr++)Xr[qr]();if(Nr.emit("finish"),Vr.autoDestroy){const qr=Nr._readableState;(!qr||qr.autoDestroy&&(qr.endEmitted||qr.readable===!1))&&Nr.destroy()}}Nt(wr.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(Nr){this._writableState&&(this._writableState.destroyed=Nr)}},writable:{__proto__:null,get(){const Nr=this._writableState;return!!Nr&&Nr.writable!==!1&&!Nr.destroyed&&!Nr.errored&&!Nr.ending&&!Nr.ended},set(Nr){this._writableState&&(this._writableState.writable=!!Nr)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const Nr=this._writableState;return Nr?!Nr.destroyed&&!Nr.ending&&Nr.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Qr=ir.destroy;wr.prototype.destroy=function(Nr,Vr){const Xr=this._writableState;return!Xr.destroyed&&(Xr.bufferedIndex<Xr.buffered.length||Xr[Sr].length)&&xt.nextTick(Rr,Xr),Qr.call(this,Nr,Vr),this},wr.prototype._undestroy=ir.undestroy,wr.prototype._destroy=function(Nr,Vr){Vr(Nr)},wr.prototype[zt.captureRejectionSymbol]=function(Nr){this.destroy(Nr)};let Jr;function Wr(){return Jr===void 0&&(Jr={}),Jr}return wr.fromWeb=function(Nr,Vr){return Wr().newStreamWritableFromWritableStream(Nr,Vr)},wr.toWeb=function(Nr){return Wr().newWritableStreamFromStreamWritable(Nr)},writable$1}var duplexify$1,hasRequiredDuplexify$1;function requireDuplexify$1(){if(hasRequiredDuplexify$1)return duplexify$1;hasRequiredDuplexify$1=1;const xt=browserExports$3,e=buffer$2,{isReadable:At,isWritable:kt,isIterable:Bt,isNodeStream:Nt,isReadableNodeStream:jt,isWritableNodeStream:Lt,isDuplexNodeStream:er,isReadableStream:tr,isWritableStream:zt}=utils$2,rr=endOfStreamExports$1,{AbortError:nr,codes:{ERR_INVALID_ARG_TYPE:ir,ERR_INVALID_RETURN_VALUE:ar}}=errors$2,{destroyer:dr}=destroy_1$1,ur=requireDuplex$1(),fr=requireReadable$1(),pr=requireWritable$1(),{createDeferredPromise:lr}=utilExports$1,yr=from_1$1,br=globalThis.Blob||e.Blob,Ar=typeof br<"u"?function(_r){return _r instanceof br}:function(_r){return!1},Pr=globalThis.AbortController||requireBrowser().AbortController,{FunctionPrototypeCall:kr}=primordials$1;class Ur extends ur{constructor(_r){super(_r),(_r==null?void 0:_r.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(_r==null?void 0:_r.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}duplexify$1=function Sr(_r,gr){if(er(_r))return _r;if(jt(_r))return Lr({readable:_r});if(Lt(_r))return Lr({writable:_r});if(Nt(_r))return Lr({writable:!1,readable:!1});if(tr(_r))return Lr({readable:fr.fromWeb(_r)});if(zt(_r))return Lr({writable:pr.fromWeb(_r)});if(typeof _r=="function"){const{value:Dr,write:xr,final:Ir,destroy:$r}=Hr(_r);if(Bt(Dr))return yr(Ur,Dr,{objectMode:!0,write:xr,final:Ir,destroy:$r});const vr=Dr==null?void 0:Dr.then;if(typeof vr=="function"){let Er;const Tr=kr(vr,Dr,Rr=>{if(Rr!=null)throw new ar("nully","body",Rr)},Rr=>{dr(Er,Rr)});return Er=new Ur({objectMode:!0,readable:!1,write:xr,final(Rr){Ir(async()=>{try{await Tr,xt.nextTick(Rr,null)}catch(Mr){xt.nextTick(Rr,Mr)}})},destroy:$r})}throw new ar("Iterable, AsyncIterable or AsyncFunction",gr,Dr)}if(Ar(_r))return Sr(_r.arrayBuffer());if(Bt(_r))return yr(Ur,_r,{objectMode:!0,writable:!1});if(tr(_r==null?void 0:_r.readable)&&zt(_r==null?void 0:_r.writable))return Ur.fromWeb(_r);if(typeof(_r==null?void 0:_r.writable)=="object"||typeof(_r==null?void 0:_r.readable)=="object"){const Dr=_r!=null&&_r.readable?jt(_r==null?void 0:_r.readable)?_r==null?void 0:_r.readable:Sr(_r.readable):void 0,xr=_r!=null&&_r.writable?Lt(_r==null?void 0:_r.writable)?_r==null?void 0:_r.writable:Sr(_r.writable):void 0;return Lr({readable:Dr,writable:xr})}const wr=_r==null?void 0:_r.then;if(typeof wr=="function"){let Dr;return kr(wr,_r,xr=>{xr!=null&&Dr.push(xr),Dr.push(null)},xr=>{dr(Dr,xr)}),Dr=new Ur({objectMode:!0,writable:!1,read(){}})}throw new ir(gr,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],_r)};function Hr(Sr){let{promise:_r,resolve:gr}=lr();const wr=new Pr,Dr=wr.signal;return{value:Sr(async function*(){for(;;){const Ir=_r;_r=null;const{chunk:$r,done:vr,cb:Er}=await Ir;if(xt.nextTick(Er),vr)return;if(Dr.aborted)throw new nr(void 0,{cause:Dr.reason});({promise:_r,resolve:gr}=lr()),yield $r}}(),{signal:Dr}),write(Ir,$r,vr){const Er=gr;gr=null,Er({chunk:Ir,done:!1,cb:vr})},final(Ir){const $r=gr;gr=null,$r({done:!0,cb:Ir})},destroy(Ir,$r){wr.abort(),$r(Ir)}}}function Lr(Sr){const _r=Sr.readable&&typeof Sr.readable.read!="function"?fr.wrap(Sr.readable):Sr.readable,gr=Sr.writable;let wr=!!At(_r),Dr=!!kt(gr),xr,Ir,$r,vr,Er;function Tr(Rr){const Mr=vr;vr=null,Mr?Mr(Rr):Rr&&Er.destroy(Rr)}return Er=new Ur({readableObjectMode:!!(_r!=null&&_r.readableObjectMode),writableObjectMode:!!(gr!=null&&gr.writableObjectMode),readable:wr,writable:Dr}),Dr&&(rr(gr,Rr=>{Dr=!1,Rr&&dr(_r,Rr),Tr(Rr)}),Er._write=function(Rr,Mr,Gr){gr.write(Rr,Mr)?Gr():xr=Gr},Er._final=function(Rr){gr.end(),Ir=Rr},gr.on("drain",function(){if(xr){const Rr=xr;xr=null,Rr()}}),gr.on("finish",function(){if(Ir){const Rr=Ir;Ir=null,Rr()}})),wr&&(rr(_r,Rr=>{wr=!1,Rr&&dr(_r,Rr),Tr(Rr)}),_r.on("readable",function(){if($r){const Rr=$r;$r=null,Rr()}}),_r.on("end",function(){Er.push(null)}),Er._read=function(){for(;;){const Rr=_r.read();if(Rr===null){$r=Er._read;return}if(!Er.push(Rr))return}}),Er._destroy=function(Rr,Mr){!Rr&&vr!==null&&(Rr=new nr),$r=null,xr=null,Ir=null,vr===null?Mr(Rr):(vr=Mr,dr(gr,Rr),dr(_r,Rr))},Er}return duplexify$1}var duplex$1,hasRequiredDuplex$1;function requireDuplex$1(){if(hasRequiredDuplex$1)return duplex$1;hasRequiredDuplex$1=1;const{ObjectDefineProperties:xt,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:At,ObjectSetPrototypeOf:kt}=primordials$1;duplex$1=jt;const Bt=requireReadable$1(),Nt=requireWritable$1();kt(jt.prototype,Bt.prototype),kt(jt,Bt);{const zt=At(Nt.prototype);for(let rr=0;rr<zt.length;rr++){const nr=zt[rr];jt.prototype[nr]||(jt.prototype[nr]=Nt.prototype[nr])}}function jt(zt){if(!(this instanceof jt))return new jt(zt);Bt.call(this,zt),Nt.call(this,zt),zt?(this.allowHalfOpen=zt.allowHalfOpen!==!1,zt.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),zt.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}xt(jt.prototype,{writable:{__proto__:null,...e(Nt.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(Nt.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(Nt.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(Nt.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(Nt.prototype,"writableLength")},writableFinished:{__proto__:null,...e(Nt.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(Nt.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(Nt.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(Nt.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(zt){this._readableState&&this._writableState&&(this._readableState.destroyed=zt,this._writableState.destroyed=zt)}}});let Lt;function er(){return Lt===void 0&&(Lt={}),Lt}jt.fromWeb=function(zt,rr){return er().newStreamDuplexFromReadableWritablePair(zt,rr)},jt.toWeb=function(zt){return er().newReadableWritablePairFromDuplex(zt)};let tr;return jt.from=function(zt){return tr||(tr=requireDuplexify$1()),tr(zt,"body")},duplex$1}const{ObjectSetPrototypeOf:ObjectSetPrototypeOf$4,Symbol:Symbol$6}=primordials$1;var transform$1=Transform$3;const{ERR_METHOD_NOT_IMPLEMENTED:ERR_METHOD_NOT_IMPLEMENTED$1}=errors$2.codes,Duplex$5=requireDuplex$1(),{getHighWaterMark:getHighWaterMark$2}=state$1;ObjectSetPrototypeOf$4(Transform$3.prototype,Duplex$5.prototype);ObjectSetPrototypeOf$4(Transform$3,Duplex$5);const kCallback$3=Symbol$6("kCallback");function Transform$3(xt){if(!(this instanceof Transform$3))return new Transform$3(xt);const e=xt?getHighWaterMark$2(this,xt,"readableHighWaterMark",!0):null;e===0&&(xt={...xt,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:xt.writableHighWaterMark||0}),Duplex$5.call(this,xt),this._readableState.sync=!1,this[kCallback$3]=null,xt&&(typeof xt.transform=="function"&&(this._transform=xt.transform),typeof xt.flush=="function"&&(this._flush=xt.flush)),this.on("prefinish",prefinish$1)}function final$1(xt){typeof this._flush=="function"&&!this.destroyed?this._flush((e,At)=>{if(e){xt?xt(e):this.destroy(e);return}At!=null&&this.push(At),this.push(null),xt&&xt()}):(this.push(null),xt&&xt())}function prefinish$1(){this._final!==final$1&&final$1.call(this)}Transform$3.prototype._final=final$1;Transform$3.prototype._transform=function(xt,e,At){throw new ERR_METHOD_NOT_IMPLEMENTED$1("_transform()")};Transform$3.prototype._write=function(xt,e,At){const kt=this._readableState,Bt=this._writableState,Nt=kt.length;this._transform(xt,e,(jt,Lt)=>{if(jt){At(jt);return}Lt!=null&&this.push(Lt),Bt.ended||Nt===kt.length||kt.length<kt.highWaterMark?At():this[kCallback$3]=At})};Transform$3.prototype._read=function(){if(this[kCallback$3]){const xt=this[kCallback$3];this[kCallback$3]=null,xt()}};const{ObjectSetPrototypeOf:ObjectSetPrototypeOf$3}=primordials$1;var passthrough$1=PassThrough$3;const Transform$2=transform$1;ObjectSetPrototypeOf$3(PassThrough$3.prototype,Transform$2.prototype);ObjectSetPrototypeOf$3(PassThrough$3,Transform$2);function PassThrough$3(xt){if(!(this instanceof PassThrough$3))return new PassThrough$3(xt);Transform$2.call(this,xt)}PassThrough$3.prototype._transform=function(xt,e,At){At(null,xt)};const process$4=browserExports$3,{ArrayIsArray:ArrayIsArray$3,Promise:Promise$5,SymbolAsyncIterator:SymbolAsyncIterator$3,SymbolDispose}=primordials$1,eos$4=endOfStreamExports$1,{once:once$2}=utilExports$1,destroyImpl$1=destroy_1$1,Duplex$4=requireDuplex$1(),{aggregateTwoErrors:aggregateTwoErrors$3,codes:{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$7,ERR_INVALID_RETURN_VALUE:ERR_INVALID_RETURN_VALUE$1,ERR_MISSING_ARGS:ERR_MISSING_ARGS$5,ERR_STREAM_DESTROYED:ERR_STREAM_DESTROYED$1,ERR_STREAM_PREMATURE_CLOSE:ERR_STREAM_PREMATURE_CLOSE$2},AbortError:AbortError$b}=errors$2,{validateFunction:validateFunction$4,validateAbortSignal:validateAbortSignal$5}=validators$1,{isIterable:isIterable$3,isReadable:isReadable$5,isReadableNodeStream:isReadableNodeStream$3,isNodeStream:isNodeStream$7,isTransformStream:isTransformStream$4,isWebStream:isWebStream$4,isReadableStream:isReadableStream$5,isReadableFinished:isReadableFinished$2}=utils$2,AbortController$3=globalThis.AbortController||requireBrowser().AbortController;let PassThrough$2,Readable$1,addAbortListener;function destroyer$4(xt,e,At){let kt=!1;xt.on("close",()=>{kt=!0});const Bt=eos$4(xt,{readable:e,writable:At},Nt=>{kt=!Nt});return{destroy:Nt=>{kt||(kt=!0,destroyImpl$1.destroyer(xt,Nt||new ERR_STREAM_DESTROYED$1("pipe")))},cleanup:Bt}}function popCallback$1(xt){return validateFunction$4(xt[xt.length-1],"streams[stream.length - 1]"),xt.pop()}function makeAsyncIterable$1(xt){if(isIterable$3(xt))return xt;if(isReadableNodeStream$3(xt))return fromReadable$1(xt);throw new ERR_INVALID_ARG_TYPE$7("val",["Readable","Iterable","AsyncIterable"],xt)}async function*fromReadable$1(xt){Readable$1||(Readable$1=requireReadable$1()),yield*Readable$1.prototype[SymbolAsyncIterator$3].call(xt)}async function pumpToNode$1(xt,e,At,{end:kt}){let Bt,Nt=null;const jt=tr=>{if(tr&&(Bt=tr),Nt){const zt=Nt;Nt=null,zt()}},Lt=()=>new Promise$5((tr,zt)=>{Bt?zt(Bt):Nt=()=>{Bt?zt(Bt):tr()}});e.on("drain",jt);const er=eos$4(e,{readable:!1},jt);try{e.writableNeedDrain&&await Lt();for await(const tr of xt)e.write(tr)||await Lt();kt&&(e.end(),await Lt()),At()}catch(tr){At(Bt!==tr?aggregateTwoErrors$3(Bt,tr):tr)}finally{er(),e.off("drain",jt)}}async function pumpToWeb$1(xt,e,At,{end:kt}){isTransformStream$4(e)&&(e=e.writable);const Bt=e.getWriter();try{for await(const Nt of xt)await Bt.ready,Bt.write(Nt).catch(()=>{});await Bt.ready,kt&&await Bt.close(),At()}catch(Nt){try{await Bt.abort(Nt),At(Nt)}catch(jt){At(jt)}}}function pipeline$3(...xt){return pipelineImpl$1(xt,once$2(popCallback$1(xt)))}function pipelineImpl$1(xt,e,At){if(xt.length===1&&ArrayIsArray$3(xt[0])&&(xt=xt[0]),xt.length<2)throw new ERR_MISSING_ARGS$5("streams");const kt=new AbortController$3,Bt=kt.signal,Nt=At==null?void 0:At.signal,jt=[];validateAbortSignal$5(Nt,"options.signal");function Lt(){ar(new AbortError$b)}addAbortListener=addAbortListener||utilExports$1.addAbortListener;let er;Nt&&(er=addAbortListener(Nt,Lt));let tr,zt;const rr=[];let nr=0;function ir(pr){ar(pr,--nr===0)}function ar(pr,lr){var yr;if(pr&&(!tr||tr.code==="ERR_STREAM_PREMATURE_CLOSE")&&(tr=pr),!(!tr&&!lr)){for(;rr.length;)rr.shift()(tr);(yr=er)===null||yr===void 0||yr[SymbolDispose](),kt.abort(),lr&&(tr||jt.forEach(br=>br()),process$4.nextTick(e,tr,zt))}}let dr;for(let pr=0;pr<xt.length;pr++){const lr=xt[pr],yr=pr<xt.length-1,br=pr>0,Ar=yr||(At==null?void 0:At.end)!==!1,Pr=pr===xt.length-1;if(isNodeStream$7(lr)){let kr=function(Ur){Ur&&Ur.name!=="AbortError"&&Ur.code!=="ERR_STREAM_PREMATURE_CLOSE"&&ir(Ur)};if(Ar){const{destroy:Ur,cleanup:Hr}=destroyer$4(lr,yr,br);rr.push(Ur),isReadable$5(lr)&&Pr&&jt.push(Hr)}lr.on("error",kr),isReadable$5(lr)&&Pr&&jt.push(()=>{lr.removeListener("error",kr)})}if(pr===0)if(typeof lr=="function"){if(dr=lr({signal:Bt}),!isIterable$3(dr))throw new ERR_INVALID_RETURN_VALUE$1("Iterable, AsyncIterable or Stream","source",dr)}else isIterable$3(lr)||isReadableNodeStream$3(lr)||isTransformStream$4(lr)?dr=lr:dr=Duplex$4.from(lr);else if(typeof lr=="function"){if(isTransformStream$4(dr)){var ur;dr=makeAsyncIterable$1((ur=dr)===null||ur===void 0?void 0:ur.readable)}else dr=makeAsyncIterable$1(dr);if(dr=lr(dr,{signal:Bt}),yr){if(!isIterable$3(dr,!0))throw new ERR_INVALID_RETURN_VALUE$1("AsyncIterable",`transform[${pr-1}]`,dr)}else{var fr;PassThrough$2||(PassThrough$2=passthrough$1);const kr=new PassThrough$2({objectMode:!0}),Ur=(fr=dr)===null||fr===void 0?void 0:fr.then;if(typeof Ur=="function")nr++,Ur.call(dr,Sr=>{zt=Sr,Sr!=null&&kr.write(Sr),Ar&&kr.end(),process$4.nextTick(ir)},Sr=>{kr.destroy(Sr),process$4.nextTick(ir,Sr)});else if(isIterable$3(dr,!0))nr++,pumpToNode$1(dr,kr,ir,{end:Ar});else if(isReadableStream$5(dr)||isTransformStream$4(dr)){const Sr=dr.readable||dr;nr++,pumpToNode$1(Sr,kr,ir,{end:Ar})}else throw new ERR_INVALID_RETURN_VALUE$1("AsyncIterable or Promise","destination",dr);dr=kr;const{destroy:Hr,cleanup:Lr}=destroyer$4(dr,!1,!0);rr.push(Hr),Pr&&jt.push(Lr)}}else if(isNodeStream$7(lr)){if(isReadableNodeStream$3(dr)){nr+=2;const kr=pipe$2(dr,lr,ir,{end:Ar});isReadable$5(lr)&&Pr&&jt.push(kr)}else if(isTransformStream$4(dr)||isReadableStream$5(dr)){const kr=dr.readable||dr;nr++,pumpToNode$1(kr,lr,ir,{end:Ar})}else if(isIterable$3(dr))nr++,pumpToNode$1(dr,lr,ir,{end:Ar});else throw new ERR_INVALID_ARG_TYPE$7("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],dr);dr=lr}else if(isWebStream$4(lr)){if(isReadableNodeStream$3(dr))nr++,pumpToWeb$1(makeAsyncIterable$1(dr),lr,ir,{end:Ar});else if(isReadableStream$5(dr)||isIterable$3(dr))nr++,pumpToWeb$1(dr,lr,ir,{end:Ar});else if(isTransformStream$4(dr))nr++,pumpToWeb$1(dr.readable,lr,ir,{end:Ar});else throw new ERR_INVALID_ARG_TYPE$7("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],dr);dr=lr}else dr=Duplex$4.from(lr)}return(Bt!=null&&Bt.aborted||Nt!=null&&Nt.aborted)&&process$4.nextTick(Lt),dr}function pipe$2(xt,e,At,{end:kt}){let Bt=!1;if(e.on("close",()=>{Bt||At(new ERR_STREAM_PREMATURE_CLOSE$2)}),xt.pipe(e,{end:!1}),kt){let Nt=function(){Bt=!0,e.end()};isReadableFinished$2(xt)?process$4.nextTick(Nt):xt.once("end",Nt)}else At();return eos$4(xt,{readable:!0,writable:!1},Nt=>{const jt=xt._readableState;Nt&&Nt.code==="ERR_STREAM_PREMATURE_CLOSE"&&jt&&jt.ended&&!jt.errored&&!jt.errorEmitted?xt.once("end",At).once("error",At):At(Nt)}),eos$4(e,{readable:!1,writable:!0},At)}var pipeline_1$1={pipelineImpl:pipelineImpl$1,pipeline:pipeline$3};const{pipeline:pipeline$2}=pipeline_1$1,Duplex$3=requireDuplex$1(),{destroyer:destroyer$3}=destroy_1$1,{isNodeStream:isNodeStream$6,isReadable:isReadable$4,isWritable:isWritable$5,isWebStream:isWebStream$3,isTransformStream:isTransformStream$3,isWritableStream:isWritableStream$3,isReadableStream:isReadableStream$4}=utils$2,{AbortError:AbortError$a,codes:{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$5,ERR_MISSING_ARGS:ERR_MISSING_ARGS$4}}=errors$2,eos$3=endOfStreamExports$1;var compose$3=function xt(...e){if(e.length===0)throw new ERR_MISSING_ARGS$4("streams");if(e.length===1)return Duplex$3.from(e[0]);const At=[...e];if(typeof e[0]=="function"&&(e[0]=Duplex$3.from(e[0])),typeof e[e.length-1]=="function"){const ir=e.length-1;e[ir]=Duplex$3.from(e[ir])}for(let ir=0;ir<e.length;++ir)if(!(!isNodeStream$6(e[ir])&&!isWebStream$3(e[ir]))){if(ir<e.length-1&&!(isReadable$4(e[ir])||isReadableStream$4(e[ir])||isTransformStream$3(e[ir])))throw new ERR_INVALID_ARG_VALUE$5(`streams[${ir}]`,At[ir],"must be readable");if(ir>0&&!(isWritable$5(e[ir])||isWritableStream$3(e[ir])||isTransformStream$3(e[ir])))throw new ERR_INVALID_ARG_VALUE$5(`streams[${ir}]`,At[ir],"must be writable")}let kt,Bt,Nt,jt,Lt;function er(ir){const ar=jt;jt=null,ar?ar(ir):ir?Lt.destroy(ir):!nr&&!rr&&Lt.destroy()}const tr=e[0],zt=pipeline$2(e,er),rr=!!(isWritable$5(tr)||isWritableStream$3(tr)||isTransformStream$3(tr)),nr=!!(isReadable$4(zt)||isReadableStream$4(zt)||isTransformStream$3(zt));if(Lt=new Duplex$3({writableObjectMode:!!(tr!=null&&tr.writableObjectMode),readableObjectMode:!!(zt!=null&&zt.readableObjectMode),writable:rr,readable:nr}),rr){if(isNodeStream$6(tr))Lt._write=function(ar,dr,ur){tr.write(ar,dr)?ur():kt=ur},Lt._final=function(ar){tr.end(),Bt=ar},tr.on("drain",function(){if(kt){const ar=kt;kt=null,ar()}});else if(isWebStream$3(tr)){const dr=(isTransformStream$3(tr)?tr.writable:tr).getWriter();Lt._write=async function(ur,fr,pr){try{await dr.ready,dr.write(ur).catch(()=>{}),pr()}catch(lr){pr(lr)}},Lt._final=async function(ur){try{await dr.ready,dr.close().catch(()=>{}),Bt=ur}catch(fr){ur(fr)}}}const ir=isTransformStream$3(zt)?zt.readable:zt;eos$3(ir,()=>{if(Bt){const ar=Bt;Bt=null,ar()}})}if(nr){if(isNodeStream$6(zt))zt.on("readable",function(){if(Nt){const ir=Nt;Nt=null,ir()}}),zt.on("end",function(){Lt.push(null)}),Lt._read=function(){for(;;){const ir=zt.read();if(ir===null){Nt=Lt._read;return}if(!Lt.push(ir))return}};else if(isWebStream$3(zt)){const ar=(isTransformStream$3(zt)?zt.readable:zt).getReader();Lt._read=async function(){for(;;)try{const{value:dr,done:ur}=await ar.read();if(!Lt.push(dr))return;if(ur){Lt.push(null);return}}catch{return}}}}return Lt._destroy=function(ir,ar){!ir&&jt!==null&&(ir=new AbortError$a),Nt=null,kt=null,Bt=null,jt===null?ar(ir):(jt=ar,isNodeStream$6(zt)&&destroyer$3(zt,ir))},Lt};const AbortController$2=globalThis.AbortController||requireBrowser().AbortController,{codes:{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$4,ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$6,ERR_MISSING_ARGS:ERR_MISSING_ARGS$3,ERR_OUT_OF_RANGE:ERR_OUT_OF_RANGE$2},AbortError:AbortError$9}=errors$2,{validateAbortSignal:validateAbortSignal$4,validateInteger:validateInteger$2,validateObject:validateObject$4}=validators$1,kWeakHandler$1=primordials$1.Symbol("kWeak"),kResistStopPropagation=primordials$1.Symbol("kResistStopPropagation"),{finished:finished$2}=endOfStreamExports$1,staticCompose$1=compose$3,{addAbortSignalNoValidate:addAbortSignalNoValidate$1}=addAbortSignalExports$1,{isWritable:isWritable$4,isNodeStream:isNodeStream$5}=utils$2,{deprecate}=utilExports$1,{ArrayPrototypePush:ArrayPrototypePush$1,Boolean:Boolean$1,MathFloor:MathFloor$2,Number:Number$2,NumberIsNaN:NumberIsNaN$2,Promise:Promise$4,PromiseReject:PromiseReject$1,PromiseResolve,PromisePrototypeThen:PromisePrototypeThen$3,Symbol:Symbol$5}=primordials$1,kEmpty$1=Symbol$5("kEmpty"),kEof$1=Symbol$5("kEof");function compose$2(xt,e){if(e!=null&&validateObject$4(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal$4(e.signal,"options.signal"),isNodeStream$5(xt)&&!isWritable$4(xt))throw new ERR_INVALID_ARG_VALUE$4("stream",xt,"must be writable");const At=staticCompose$1(this,xt);return e!=null&&e.signal&&addAbortSignalNoValidate$1(e.signal,At),At}function map$2(xt,e){if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$6("fn",["Function","AsyncFunction"],xt);e!=null&&validateObject$4(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal$4(e.signal,"options.signal");let At=1;(e==null?void 0:e.concurrency)!=null&&(At=MathFloor$2(e.concurrency));let kt=At-1;return(e==null?void 0:e.highWaterMark)!=null&&(kt=MathFloor$2(e.highWaterMark)),validateInteger$2(At,"options.concurrency",1),validateInteger$2(kt,"options.highWaterMark",0),kt+=At,(async function*(){const Nt=utilExports$1.AbortSignalAny([e==null?void 0:e.signal].filter(Boolean$1)),jt=this,Lt=[],er={signal:Nt};let tr,zt,rr=!1,nr=0;function ir(){rr=!0,ar()}function ar(){nr-=1,dr()}function dr(){zt&&!rr&&nr<At&&Lt.length<kt&&(zt(),zt=null)}async function ur(){try{for await(let fr of jt){if(rr)return;if(Nt.aborted)throw new AbortError$9;try{if(fr=xt(fr,er),fr===kEmpty$1)continue;fr=PromiseResolve(fr)}catch(pr){fr=PromiseReject$1(pr)}nr+=1,PromisePrototypeThen$3(fr,ar,ir),Lt.push(fr),tr&&(tr(),tr=null),!rr&&(Lt.length>=kt||nr>=At)&&await new Promise$4(pr=>{zt=pr})}Lt.push(kEof$1)}catch(fr){const pr=PromiseReject$1(fr);PromisePrototypeThen$3(pr,ar,ir),Lt.push(pr)}finally{rr=!0,tr&&(tr(),tr=null)}}ur();try{for(;;){for(;Lt.length>0;){const fr=await Lt[0];if(fr===kEof$1)return;if(Nt.aborted)throw new AbortError$9;fr!==kEmpty$1&&(yield fr),Lt.shift(),dr()}await new Promise$4(fr=>{tr=fr})}}finally{rr=!0,zt&&(zt(),zt=null)}}).call(this)}function asIndexedPairs$1(xt=void 0){return xt!=null&&validateObject$4(xt,"options"),(xt==null?void 0:xt.signal)!=null&&validateAbortSignal$4(xt.signal,"options.signal"),(async function*(){let At=0;for await(const Bt of this){var kt;if(xt!=null&&(kt=xt.signal)!==null&&kt!==void 0&&kt.aborted)throw new AbortError$9({cause:xt.signal.reason});yield[At++,Bt]}}).call(this)}async function some$1(xt,e=void 0){for await(const At of filter$2.call(this,xt,e))return!0;return!1}async function every$1(xt,e=void 0){if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$6("fn",["Function","AsyncFunction"],xt);return!await some$1.call(this,async(...At)=>!await xt(...At),e)}async function find$1(xt,e){for await(const At of filter$2.call(this,xt,e))return At}async function forEach$1(xt,e){if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$6("fn",["Function","AsyncFunction"],xt);async function At(kt,Bt){return await xt(kt,Bt),kEmpty$1}for await(const kt of map$2.call(this,At,e));}function filter$2(xt,e){if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$6("fn",["Function","AsyncFunction"],xt);async function At(kt,Bt){return await xt(kt,Bt)?kt:kEmpty$1}return map$2.call(this,At,e)}let ReduceAwareErrMissingArgs$1=class extends ERR_MISSING_ARGS$3{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function reduce$1(xt,e,At){var kt;if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$6("reducer",["Function","AsyncFunction"],xt);At!=null&&validateObject$4(At,"options"),(At==null?void 0:At.signal)!=null&&validateAbortSignal$4(At.signal,"options.signal");let Bt=arguments.length>1;if(At!=null&&(kt=At.signal)!==null&&kt!==void 0&&kt.aborted){const tr=new AbortError$9(void 0,{cause:At.signal.reason});throw this.once("error",()=>{}),await finished$2(this.destroy(tr)),tr}const Nt=new AbortController$2,jt=Nt.signal;if(At!=null&&At.signal){const tr={once:!0,[kWeakHandler$1]:this,[kResistStopPropagation]:!0};At.signal.addEventListener("abort",()=>Nt.abort(),tr)}let Lt=!1;try{for await(const tr of this){var er;if(Lt=!0,At!=null&&(er=At.signal)!==null&&er!==void 0&&er.aborted)throw new AbortError$9;Bt?e=await xt(e,tr,{signal:jt}):(e=tr,Bt=!0)}if(!Lt&&!Bt)throw new ReduceAwareErrMissingArgs$1}finally{Nt.abort()}return e}async function toArray$1(xt){xt!=null&&validateObject$4(xt,"options"),(xt==null?void 0:xt.signal)!=null&&validateAbortSignal$4(xt.signal,"options.signal");const e=[];for await(const kt of this){var At;if(xt!=null&&(At=xt.signal)!==null&&At!==void 0&&At.aborted)throw new AbortError$9(void 0,{cause:xt.signal.reason});ArrayPrototypePush$1(e,kt)}return e}function flatMap$1(xt,e){const At=map$2.call(this,xt,e);return(async function*(){for await(const Bt of At)yield*Bt}).call(this)}function toIntegerOrInfinity$1(xt){if(xt=Number$2(xt),NumberIsNaN$2(xt))return 0;if(xt<0)throw new ERR_OUT_OF_RANGE$2("number",">= 0",xt);return xt}function drop$1(xt,e=void 0){return e!=null&&validateObject$4(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal$4(e.signal,"options.signal"),xt=toIntegerOrInfinity$1(xt),(async function*(){var kt;if(e!=null&&(kt=e.signal)!==null&&kt!==void 0&&kt.aborted)throw new AbortError$9;for await(const Nt of this){var Bt;if(e!=null&&(Bt=e.signal)!==null&&Bt!==void 0&&Bt.aborted)throw new AbortError$9;xt--<=0&&(yield Nt)}}).call(this)}function take$1(xt,e=void 0){return e!=null&&validateObject$4(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal$4(e.signal,"options.signal"),xt=toIntegerOrInfinity$1(xt),(async function*(){var kt;if(e!=null&&(kt=e.signal)!==null&&kt!==void 0&&kt.aborted)throw new AbortError$9;for await(const Nt of this){var Bt;if(e!=null&&(Bt=e.signal)!==null&&Bt!==void 0&&Bt.aborted)throw new AbortError$9;if(xt-- >0&&(yield Nt),xt<=0)return}}).call(this)}operators$1.streamReturningOperators={asIndexedPairs:deprecate(asIndexedPairs$1,"readable.asIndexedPairs will be removed in a future version."),drop:drop$1,filter:filter$2,flatMap:flatMap$1,map:map$2,take:take$1,compose:compose$2};operators$1.promiseReturningOperators={every:every$1,forEach:forEach$1,reduce:reduce$1,toArray:toArray$1,some:some$1,find:find$1};var promises$1,hasRequiredPromises$1;function requirePromises$1(){if(hasRequiredPromises$1)return promises$1;hasRequiredPromises$1=1;const{ArrayPrototypePop:xt,Promise:e}=primordials$1,{isIterable:At,isNodeStream:kt,isWebStream:Bt}=utils$2,{pipelineImpl:Nt}=pipeline_1$1,{finished:jt}=endOfStreamExports$1;requireStream$1();function Lt(...er){return new e((tr,zt)=>{let rr,nr;const ir=er[er.length-1];if(ir&&typeof ir=="object"&&!kt(ir)&&!At(ir)&&!Bt(ir)){const ar=xt(er);rr=ar.signal,nr=ar.end}Nt(er,(ar,dr)=>{ar?zt(ar):tr(dr)},{signal:rr,end:nr})})}return promises$1={finished:jt,pipeline:Lt},promises$1}var hasRequiredStream$1;function requireStream$1(){if(hasRequiredStream$1)return stream$1.exports;hasRequiredStream$1=1;const{Buffer:xt}=buffer$2,{ObjectDefineProperty:e,ObjectKeys:At,ReflectApply:kt}=primordials$1,{promisify:{custom:Bt}}=utilExports$1,{streamReturningOperators:Nt,promiseReturningOperators:jt}=operators$1,{codes:{ERR_ILLEGAL_CONSTRUCTOR:Lt}}=errors$2,er=compose$3,{setDefaultHighWaterMark:tr,getDefaultHighWaterMark:zt}=state$1,{pipeline:rr}=pipeline_1$1,{destroyer:nr}=destroy_1$1,ir=endOfStreamExports$1,ar=requirePromises$1(),dr=utils$2,ur=stream$1.exports=legacy$1.Stream;ur.isDestroyed=dr.isDestroyed,ur.isDisturbed=dr.isDisturbed,ur.isErrored=dr.isErrored,ur.isReadable=dr.isReadable,ur.isWritable=dr.isWritable,ur.Readable=requireReadable$1();for(const lr of At(Nt)){let br=function(...Ar){if(new.target)throw Lt();return ur.Readable.from(kt(yr,this,Ar))};var pr=br;const yr=Nt[lr];e(br,"name",{__proto__:null,value:yr.name}),e(br,"length",{__proto__:null,value:yr.length}),e(ur.Readable.prototype,lr,{__proto__:null,value:br,enumerable:!1,configurable:!0,writable:!0})}for(const lr of At(jt)){let br=function(...Pr){if(new.target)throw Lt();return kt(yr,this,Pr)};var pr=br;const yr=jt[lr];e(br,"name",{__proto__:null,value:yr.name}),e(br,"length",{__proto__:null,value:yr.length}),e(ur.Readable.prototype,lr,{__proto__:null,value:br,enumerable:!1,configurable:!0,writable:!0})}ur.Writable=requireWritable$1(),ur.Duplex=requireDuplex$1(),ur.Transform=transform$1,ur.PassThrough=passthrough$1,ur.pipeline=rr;const{addAbortSignal:fr}=addAbortSignalExports$1;return ur.addAbortSignal=fr,ur.finished=ir,ur.destroy=nr,ur.compose=er,ur.setDefaultHighWaterMark=tr,ur.getDefaultHighWaterMark=zt,e(ur,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return ar}}),e(rr,Bt,{__proto__:null,enumerable:!0,get(){return ar.pipeline}}),e(ir,Bt,{__proto__:null,enumerable:!0,get(){return ar.finished}}),ur.Stream=ur,ur._isUint8Array=function(yr){return yr instanceof Uint8Array},ur._uint8ArrayToBuffer=function(yr){return xt.from(yr.buffer,yr.byteOffset,yr.byteLength)},stream$1.exports}(function(xt){const e=requireStream$1(),At=requirePromises$1(),kt=e.Readable.destroy;xt.exports=e.Readable,xt.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,xt.exports._isUint8Array=e._isUint8Array,xt.exports.isDisturbed=e.isDisturbed,xt.exports.isErrored=e.isErrored,xt.exports.isReadable=e.isReadable,xt.exports.Readable=e.Readable,xt.exports.Writable=e.Writable,xt.exports.Duplex=e.Duplex,xt.exports.Transform=e.Transform,xt.exports.PassThrough=e.PassThrough,xt.exports.addAbortSignal=e.addAbortSignal,xt.exports.finished=e.finished,xt.exports.destroy=e.destroy,xt.exports.destroy=kt,xt.exports.pipeline=e.pipeline,xt.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return At}}),xt.exports.Stream=e.Stream,xt.exports.default=xt.exports})(browser$2);var browserExports$1=browser$2.exports,__awaiter$3c=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};dist.ECIES_CONFIG.isEphemeralKeyCompressed=!0;class Encryption{static aes256CtrEncrypt(e,At,kt){return __awaiter$3c(this,void 0,void 0,function*(){const Bt=cryptoBrowserifyExports.createCipheriv("aes-256-ctr",e,At),Nt=new browserExports$1.Readable({read(){}});return kt.on("data",jt=>{const Lt=Bt.update(jt);Nt.push(Lt)}),kt.on("end",()=>{const jt=Bt.final();Nt.push(jt),Nt.push(null)}),kt.on("error",jt=>{Nt.emit("error",jt)}),Nt})}static aes256CtrDecrypt(e,At,kt){return __awaiter$3c(this,void 0,void 0,function*(){const Bt=cryptoBrowserifyExports.createDecipheriv("aes-256-ctr",e,At),Nt=new browserExports$1.Readable({read(){}});return kt.on("data",jt=>{const Lt=Bt.update(jt);Nt.push(Lt)}),kt.on("end",()=>{const jt=Bt.final();Nt.push(jt),Nt.push(null)}),kt.on("error",jt=>{Nt.emit("error",jt)}),Nt})}static eciesSecp256k1Encrypt(e,At){return __awaiter$3c(this,void 0,void 0,function*(){const kt=buffer$2.Buffer.from(e),Bt=buffer$2.Buffer.from(At),Nt=dist.encrypt(kt,Bt);let jt=0,Lt=Encryption.isEphemeralKeyCompressed?33:65;const er=Nt.subarray(jt,Lt);jt=Lt,Lt+=dist.ECIES_CONFIG.symmetricNonceLength;const tr=Nt.subarray(jt,Lt);jt=Lt,Lt+=16;const zt=Nt.subarray(jt,Lt);return{ciphertext:Nt.subarray(Lt),ephemeralPublicKey:er,initializationVector:tr,messageAuthenticationCode:zt}})}static eciesSecp256k1Decrypt(e){return __awaiter$3c(this,void 0,void 0,function*(){const At=buffer$2.Buffer.from(e.privateKey),kt=buffer$2.Buffer.concat([e.ephemeralPublicKey,e.initializationVector,e.messageAuthenticationCode,e.ciphertext]);return dist.decrypt(At,kt)})}static get isEphemeralKeyCompressed(){return dist.ECIES_CONFIG.isEphemeralKeyCompressed}}var EncryptionAlgorithm;(function(xt){xt.Aes256Ctr="A256CTR",xt.EciesSecp256k1="ECIES-ES256K"})(EncryptionAlgorithm||(EncryptionAlgorithm={}));var __awaiter$3b=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class GeneralJwsBuilder{constructor(e){this.jws=e}static create(e,At=[]){return __awaiter$3b(this,void 0,void 0,function*(){const kt={payload:Encoder$4.bytesToBase64Url(e),signatures:[]},Bt=new GeneralJwsBuilder(kt);for(const Nt of At)yield Bt.addSignature(Nt);return Bt})}addSignature(e){return __awaiter$3b(this,void 0,void 0,function*(){const At={kid:e.keyId,alg:e.algorithm},kt=JSON.stringify(At),Bt=Encoder$4.stringToBase64Url(kt),Nt=`${Bt}.${this.jws.payload}`,jt=Encoder$4.stringToBytes(Nt),Lt=yield e.sign(jt),er=Encoder$4.bytesToBase64Url(Lt);this.jws.signatures.push({protected:Bt,signature:er})})}getJws(){return this.jws}}const cr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function getWebcryptoSubtle(){if(cr&&typeof cr.subtle=="object"&&cr.subtle!=null)return cr.subtle;throw new Error("crypto.subtle must be defined")}function number$1(xt){if(!Number.isSafeInteger(xt)||xt<0)throw new Error(`positive integer expected, not ${xt}`)}function bool(xt){if(typeof xt!="boolean")throw new Error(`boolean expected, not ${xt}`)}function isBytes$6(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}function bytes$2(xt,...e){if(!isBytes$6(xt))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(xt.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${xt.length}`)}function exists$2(xt,e=!0){if(xt.destroyed)throw new Error("Hash instance has been destroyed");if(e&&xt.finished)throw new Error("Hash#digest() has already been called")}function output$2(xt,e){bytes$2(xt);const At=e.outputLen;if(xt.length<At)throw new Error(`digestInto() expects output buffer of length at least ${At}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32$1=xt=>new Uint32Array(xt.buffer,xt.byteOffset,Math.floor(xt.byteLength/4)),createView$1=xt=>new DataView(xt.buffer,xt.byteOffset,xt.byteLength),isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$3(xt){if(typeof xt!="string")throw new Error(`string expected, got ${typeof xt}`);return new Uint8Array(new TextEncoder().encode(xt))}function toBytes$2(xt){if(typeof xt=="string")xt=utf8ToBytes$3(xt);else if(isBytes$6(xt))xt=xt.slice();else throw new Error(`Uint8Array expected, got ${typeof xt}`);return xt}function checkOpts$1(xt,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(xt,e)}function equalBytes$1(xt,e){if(xt.length!==e.length)return!1;let At=0;for(let kt=0;kt<xt.length;kt++)At|=xt[kt]^e[kt];return At===0}const wrapCipher=(xt,e)=>(Object.assign(e,xt),e);function setBigUint64$1(xt,e,At,kt){if(typeof xt.setBigUint64=="function")return xt.setBigUint64(e,At,kt);const Bt=BigInt(32),Nt=BigInt(4294967295),jt=Number(At>>Bt&Nt),Lt=Number(At&Nt),er=4,tr=0;xt.setUint32(e+er,jt,kt),xt.setUint32(e+tr,Lt,kt)}var __awaiter$3a=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},KeyDerivationScheme;(function(xt){xt.DataFormats="dataFormats",xt.ProtocolContext="protocolContext",xt.ProtocolPath="protocolPath",xt.Schemas="schemas"})(KeyDerivationScheme||(KeyDerivationScheme={}));class HdKey{static derivePrivateKey(e,At){var kt;return __awaiter$3a(this,void 0,void 0,function*(){const Bt=Secp256k1$3.privateJwkToBytes(e.derivedPrivateKey),Nt=(kt=e.derivationPath)!==null&&kt!==void 0?kt:[],jt=yield HdKey.derivePrivateKeyBytes(Bt,At),Lt=yield Secp256k1$3.privateKeyToJwk(jt);return{rootKeyId:e.rootKeyId,derivationScheme:e.derivationScheme,derivationPath:[...Nt,...At],derivedPrivateKey:Lt}})}static derivePublicKey(e,At){return __awaiter$3a(this,void 0,void 0,function*(){const kt=yield HdKey.derivePrivateKey(e,At);return yield Secp256k1$3.getPublicJwk(kt.derivedPrivateKey)})}static derivePrivateKeyBytes(e,At){return __awaiter$3a(this,void 0,void 0,function*(){HdKey.validateKeyDerivationPath(At);let kt=e;for(const Bt of At){const Nt=Encoder$4.stringToBytes(Bt);kt=yield HdKey.deriveKeyUsingHkdf({hashAlgorithm:"SHA-256",initialKeyMaterial:kt,info:Nt,keyLengthInBytes:32})}return kt})}static deriveKeyUsingHkdf(e){return __awaiter$3a(this,void 0,void 0,function*(){const{hashAlgorithm:At,initialKeyMaterial:kt,info:Bt,keyLengthInBytes:Nt}=e,Lt=yield getWebcryptoSubtle().importKey("raw",kt,{name:"HKDF"},!1,["deriveBits"]),er=yield crypto.subtle.deriveBits({name:"HKDF",hash:At,salt:new Uint8Array(0),info:Bt},Lt,Nt*8);return new Uint8Array(er)})}static validateKeyDerivationPath(e){if(e.includes(""))throw new DwnError(DwnErrorCode.HdKeyDerivationPathInvalid,`Invalid key derivation path: ${e}`)}}function lexicographicalCompare(xt,e){return xt>e?1:xt<e?-1:0}function isEmptyObject$1(xt){if(typeof xt!="object")return!1;for(const e in xt)return!1;return!0}function removeUndefinedProperties$3(xt){Object.keys(xt).forEach(e=>{xt[e]===void 0?delete xt[e]:typeof xt[e]=="object"&&removeUndefinedProperties$3(xt[e])})}var __awaiter$39=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Message{static getAuthor(e){if(e.authorization===void 0)return;let At;return e.authorization.authorDelegatedGrant!==void 0?At=Message.getSigner(e.authorization.authorDelegatedGrant):At=Message.getSigner(e),At}static validateJsonSchema(e){const At=e.descriptor.interface,kt=e.descriptor.method,Bt=At+kt;validateJsonSchema(Bt,e)}static getSigner(e){return e.authorization===void 0?void 0:Jws.getSignerDid(e.authorization.signature.signatures[0])}static getCid(e){return __awaiter$39(this,void 0,void 0,function*(){const At=Object.assign({},e);return At.encodedData&&delete At.encodedData,yield Cid.computeCid(At)})}static compareCid(e,At){return __awaiter$39(this,void 0,void 0,function*(){const kt=yield Message.getCid(e),Bt=yield Message.getCid(At);return lexicographicalCompare(kt,Bt)})}static createAuthorization(e){return __awaiter$39(this,void 0,void 0,function*(){const{descriptor:At,signer:kt,delegatedGrant:Bt,permissionGrantId:Nt,protocolRole:jt}=e;let Lt;Bt!==void 0&&(Lt=yield Message.getCid(Bt));const tr={signature:yield Message.createSignature(At,kt,{delegatedGrantId:Lt,permissionGrantId:Nt,protocolRole:jt})};return Bt!==void 0&&(tr.authorDelegatedGrant=Bt),tr})}static createSignature(e,At,kt){return __awaiter$39(this,void 0,void 0,function*(){const Bt=yield Cid.computeCid(e),Nt=Object.assign({descriptorCid:Bt},kt);removeUndefinedProperties$3(Nt);const jt=Encoder$4.objectToBytes(Nt);return(yield GeneralJwsBuilder.create(jt,[At])).getJws()})}static getNewestMessage(e){return __awaiter$39(this,void 0,void 0,function*(){let At;for(const kt of e)(At===void 0||(yield Message.isNewer(kt,At)))&&(At=kt);return At})}static getOldestMessage(e){return __awaiter$39(this,void 0,void 0,function*(){let At;for(const kt of e)(At===void 0||(yield Message.isOlder(kt,At)))&&(At=kt);return At})}static isNewer(e,At){return __awaiter$39(this,void 0,void 0,function*(){return(yield Message.compareMessageTimestamp(e,At))>0})}static isOlder(e,At){return __awaiter$39(this,void 0,void 0,function*(){return(yield Message.compareMessageTimestamp(e,At))<0})}static isSignedByAuthorDelegate(e){var At;return((At=e.authorization)===null||At===void 0?void 0:At.authorDelegatedGrant)!==void 0}static isSignedByOwnerDelegate(e){var At;return((At=e.authorization)===null||At===void 0?void 0:At.ownerDelegatedGrant)!==void 0}static compareMessageTimestamp(e,At){return __awaiter$39(this,void 0,void 0,function*(){return e.descriptor.messageTimestamp>At.descriptor.messageTimestamp?1:e.descriptor.messageTimestamp<At.descriptor.messageTimestamp?-1:Message.compareCid(e,At)})}static validateSignatureStructure(e,At,kt="GenericSignaturePayload"){return __awaiter$39(this,void 0,void 0,function*(){if(e.signatures.length!==1)throw new DwnError(DwnErrorCode.AuthenticationMoreThanOneSignatureNotSupported,"expected no more than 1 signature for authorization purpose");const Bt=Jws.decodePlainObjectPayload(e);validateJsonSchema(kt,Bt);const{descriptorCid:Nt}=Bt,jt=yield Cid.computeCid(At);if(Nt!==jt)throw new DwnError(DwnErrorCode.AuthenticateDescriptorCidMismatch,`provided descriptorCid ${Nt} does not match expected CID ${jt}`);return Bt})}}var __awaiter$38=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let PermissionGrant$1=class wl{static parse(e){return __awaiter$38(this,void 0,void 0,function*(){return new wl(e)})}constructor(e){this.id=e.recordId,this.grantor=Message.getSigner(e),this.grantee=e.descriptor.recipient,this.dateGranted=e.descriptor.dateCreated;const At=e.encodedData,kt=Encoder$4.base64UrlToObject(At);this.dateExpires=kt.dateExpires,this.delegated=kt.delegated,this.description=kt.description,this.requestId=kt.requestId,this.scope=kt.scope,this.conditions=kt.conditions}};var DateSort;(function(xt){xt.CreatedAscending="createdAscending",xt.CreatedDescending="createdDescending",xt.PublishedAscending="publishedAscending",xt.PublishedDescending="publishedDescending"})(DateSort||(DateSort={}));var __rest$I=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class FilterUtility{static matchAnyFilter(e,At){if(At.length===0)return!0;for(const kt of At)if(this.matchFilter(e,kt))return!0;return!1}static matchFilter(e,At){for(const kt in At){const Bt=At[kt],Nt=e[kt];if(Nt===void 0||!(Array.isArray(Nt)?this.matchAnyIndexValue(Bt,Nt):this.matchIndexValue(Bt,Nt)))return!1}return!0}static matchAnyIndexValue(e,At){for(const kt of At)if(this.matchIndexValue(e,kt))return!0;return!1}static matchIndexValue(e,At){if(typeof e=="object"){if(Array.isArray(e)){if(this.matchOneOf(e,At))return!0}else if(this.matchRange(e,At))return!0}else if(At===e)return!0;return!1}static matchOneOf(e,At){for(const kt of e)if(At===kt)return!0;return!1}static matchRange(e,At){return!(e.lt!==void 0&&At>=e.lt||e.lte!==void 0&&At>e.lte||e.gt!==void 0&&At<=e.gt||e.gte!==void 0&&At<e.gte)}static isEqualFilter(e){return typeof e!="object"}static isRangeFilter(e){return typeof e=="object"&&!Array.isArray(e)?"gt"in e||"lt"in e||"lte"in e||"gte"in e:!1}static isOneOfFilter(e){return!!(typeof e=="object"&&Array.isArray(e))}static convertRangeCriterion(e){let At;return e.to!==void 0&&e.from!==void 0?At={gte:e.from,lt:e.to}:e.to!==void 0?At={lt:e.to}:e.from!==void 0&&(At={gte:e.from}),At}static constructPrefixFilterAsRangeFilter(e){return{gte:e,lt:e+"￿"}}}class FilterSelector{static reduceFilter(e){if(Object.keys(e).length<=1)return e;const{recordId:kt,attester:Bt,parentId:Nt,recipient:jt,contextId:Lt,author:er,protocolPath:tr,schema:zt,protocol:rr}=e,nr=__rest$I(e,["recordId","attester","parentId","recipient","contextId","author","protocolPath","schema","protocol"]);if(kt!==void 0)return{recordId:kt};if(Bt!==void 0)return{attester:Bt};if(Nt!==void 0)return{parentId:Nt};if(jt!==void 0)return{recipient:jt};if(Lt!==void 0)return{contextId:Lt};if(tr!==void 0)return{protocolPath:tr};if(zt!==void 0)return{schema:zt};if(rr!==void 0)return{protocol:rr};const ar=Object.keys(nr)[0],dr={};return dr[ar]=e[ar],dr}}var DwnInterfaceName;(function(xt){xt.Messages="Messages",xt.Protocols="Protocols",xt.Records="Records"})(DwnInterfaceName||(DwnInterfaceName={}));var DwnMethodName;(function(xt){xt.Configure="Configure",xt.Query="Query",xt.Read="Read",xt.Write="Write",xt.Delete="Delete",xt.Subscribe="Subscribe"})(DwnMethodName||(DwnMethodName={}));function validateProtocolUrlNormalized(xt){let e;try{e=normalizeProtocolUrl(xt)}catch{e=void 0}if(xt!==e)throw new DwnError(DwnErrorCode.UrlProtocolNotNormalized,`Protocol URI ${xt} must be normalized.`)}function normalizeProtocolUrl(xt){return normalizeUrl(xt)}function validateSchemaUrlNormalized(xt){let e;try{e=normalizeSchemaUrl(xt)}catch{e=void 0}if(xt!==e)throw new DwnError(DwnErrorCode.UrlSchemaNotNormalized,`Schema URI ${xt} must be normalized.`)}function normalizeSchemaUrl(xt){return normalizeUrl(xt)}function normalizeUrl(xt){let e;/^[^:]+:(\/{2})?[^\/].*/.test(xt)?e=xt:e=`http://${xt}`;try{const At=new URL(e);return At.search="",At.hash="",removeTrailingSlash(At.href)}catch{throw new DwnError(DwnErrorCode.UrlProtocolNotNormalizable,"Could not normalize protocol URI")}}function removeTrailingSlash(xt){return xt.endsWith("/")?xt.slice(0,-1):xt}var __awaiter$37=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$H=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class Records{static isRecordsWrite(e){return e.descriptor.interface===DwnInterfaceName.Records&&e.descriptor.method===DwnMethodName.Write}static decrypt(e,At,kt){return __awaiter$37(this,void 0,void 0,function*(){const{encryption:Bt}=e,Nt=Bt.keyEncryption.find(dr=>dr.rootKeyId===At.rootKeyId&&dr.derivationScheme===At.derivationScheme);if(Nt===void 0)throw new DwnError(DwnErrorCode.RecordsDecryptNoMatchingKeyEncryptedFound,`Unable to find a symmetric key encrypted using key         with ID '${At.rootKeyId}' and '${At.derivationScheme}' derivation scheme.`);const jt=Records.constructKeyDerivationPath(Nt.derivationScheme,e),Lt=yield Records.derivePrivateKey(At,jt),er=Encoder$4.base64UrlToBytes(Nt.encryptedKey),tr=Secp256k1$3.publicJwkToBytes(Nt.ephemeralPublicKey),zt=Encoder$4.base64UrlToBytes(Nt.initializationVector),rr=Encoder$4.base64UrlToBytes(Nt.messageAuthenticationCode),nr=yield Encryption.eciesSecp256k1Decrypt({ciphertext:er,ephemeralPublicKey:tr,initializationVector:zt,messageAuthenticationCode:rr,privateKey:Lt}),ir=Encoder$4.base64UrlToBytes(Bt.initializationVector);return yield Encryption.aes256CtrDecrypt(nr,ir,kt)})}static constructKeyDerivationPath(e,At){const kt=At.descriptor,Bt=At.contextId;let Nt;return e===KeyDerivationScheme.DataFormats?Nt=Records.constructKeyDerivationPathUsingDataFormatsScheme(kt.schema,kt.dataFormat):e===KeyDerivationScheme.ProtocolPath?Nt=Records.constructKeyDerivationPathUsingProtocolPathScheme(kt):e===KeyDerivationScheme.ProtocolContext?Nt=Records.constructKeyDerivationPathUsingProtocolContextScheme(Bt):Nt=Records.constructKeyDerivationPathUsingSchemasScheme(kt.schema),Nt}static constructKeyDerivationPathUsingDataFormatsScheme(e,At){return e!==void 0?[KeyDerivationScheme.DataFormats,e,At]:[KeyDerivationScheme.DataFormats,At]}static constructKeyDerivationPathUsingProtocolPathScheme(e){if(e.protocol===void 0)throw new DwnError(DwnErrorCode.RecordsProtocolPathDerivationSchemeMissingProtocol,"Unable to construct key derivation path using `protocols` scheme because `protocol` is missing.");const At=e.protocolPath.split("/");return[KeyDerivationScheme.ProtocolPath,e.protocol,...At]}static constructKeyDerivationPathUsingProtocolContextScheme(e){if(e===void 0)throw new DwnError(DwnErrorCode.RecordsProtocolContextDerivationSchemeMissingContextId,"Unable to construct key derivation path using `protocolContext` scheme because `contextId` is missing.");const At=e.split("/")[0];return[KeyDerivationScheme.ProtocolContext,At]}static constructKeyDerivationPathUsingSchemasScheme(e){if(e===void 0)throw new DwnError(DwnErrorCode.RecordsSchemasDerivationSchemeMissingSchema,"Unable to construct key derivation path using `schemas` scheme because `schema` is missing.");return[KeyDerivationScheme.Schemas,e]}static derivePrivateKey(e,At){var kt;return __awaiter$37(this,void 0,void 0,function*(){if(e.derivedPrivateKey.crv!=="secp256k1")throw new DwnError(DwnErrorCode.RecordsDerivePrivateKeyUnSupportedCurve,`Curve ${e.derivedPrivateKey.crv} is not supported.`);const Bt=(kt=e.derivationPath)!==null&&kt!==void 0?kt:[];Records.validateAncestorKeyAndDescentKeyDerivationPathsMatch(Bt,At);const Nt=At.slice(Bt.length),jt=Secp256k1$3.privateJwkToBytes(e.derivedPrivateKey);return yield HdKey.derivePrivateKeyBytes(jt,Nt)})}static validateAncestorKeyAndDescentKeyDerivationPathsMatch(e,At){for(let kt=0;kt<e.length;kt++){const Bt=e[kt],Nt=At[kt];if(Bt!==Nt)throw new DwnError(DwnErrorCode.RecordsInvalidAncestorKeyDerivationSegment,`Ancestor key derivation segment '${Bt}' mismatches against the descendant key derivation segment '${Nt}'.`)}}static getParentContextFromOfContextId(e){if(e===void 0)return;const At=e.lastIndexOf("/");return At===-1?"":e.substring(0,At)}static normalizeFilter(e){let At;e.protocol===void 0?At=void 0:At=normalizeProtocolUrl(e.protocol);let kt;e.schema===void 0?kt=void 0:kt=normalizeSchemaUrl(e.schema);const Bt=Object.assign(Object.assign({},e),{protocol:At,schema:kt});return removeUndefinedProperties$3(Bt),Bt}static isStartsWithFilter(e){return typeof e=="object"&&"startsWith"in e&&typeof e.startsWith=="string"}static buildTagIndexes(e){const At={};for(const kt in e){const Bt=e[kt];At[`tag.${kt}`]=Bt}return At}static convertTagsFilter(e){const At={};for(const kt in e){const Bt=e[kt];At[`tag.${kt}`]=this.isStartsWithFilter(Bt)?FilterUtility.constructPrefixFilterAsRangeFilter(Bt.startsWith):Bt}return At}static convertFilter(e,At){const{tags:kt}=e,Bt=__rest$H(e,["tags"]);let Nt={};kt!==void 0&&(Nt=Object.assign({},this.convertTagsFilter(kt)));const jt=Object.assign(Object.assign({},Bt),Nt),{dateCreated:Lt,datePublished:er,dateUpdated:tr,contextId:zt}=e,rr=Lt?FilterUtility.convertRangeCriterion(Lt):void 0;rr&&(jt.dateCreated=rr);const nr=er?FilterUtility.convertRangeCriterion(er):void 0;nr&&(jt.published=!0,jt.datePublished=nr),jt.published!==!0&&(At===DateSort.PublishedAscending||At===DateSort.PublishedDescending)&&(jt.published=!0);const ir=tr?FilterUtility.convertRangeCriterion(tr):void 0;ir&&(jt.messageTimestamp=ir,delete jt.dateUpdated);const ar=zt?FilterUtility.constructPrefixFilterAsRangeFilter(zt):void 0;return ar&&(jt.contextId=ar),Array.isArray(jt.author)&&jt.author.length===0&&delete jt.author,Array.isArray(jt.recipient)&&jt.recipient.length===0&&delete jt.recipient,jt}static validateDelegatedGrantReferentialIntegrity(e,At,kt){var Bt,Nt;return __awaiter$37(this,void 0,void 0,function*(){const jt=(At==null?void 0:At.delegatedGrantId)!==void 0,Lt=((Bt=e.authorization)===null||Bt===void 0?void 0:Bt.authorDelegatedGrant)!==void 0;if(jt!==Lt)throw new DwnError(DwnErrorCode.RecordsAuthorDelegatedGrantAndIdExistenceMismatch,`delegatedGrantId in message (author) signature and authorDelegatedGrant must both exist or be undefined.          delegatedGrantId in message (author) signature defined: ${jt},          authorDelegatedGrant defined: ${Lt}`);if(Lt){const zt=e.authorization.authorDelegatedGrant;if((yield PermissionGrant$1.parse(zt)).delegated!==!0)throw new DwnError(DwnErrorCode.RecordsAuthorDelegatedGrantNotADelegatedGrant,"The owner delegated grant given is not a delegated grant.");const nr=zt.descriptor.recipient,ir=Message.getSigner(e);if(nr!==ir)throw new DwnError(DwnErrorCode.RecordsAuthorDelegatedGrantGrantedToAndOwnerSignatureMismatch,`grantedTo ${nr} in author delegated grant must be the same as the signer ${ir} of the message signature.`);const ar=yield Message.getCid(zt);if(ar!==At.delegatedGrantId)throw new DwnError(DwnErrorCode.RecordsAuthorDelegatedGrantCidMismatch,`CID of the author delegated grant ${ar} must be the same as           the delegatedGrantId ${At.delegatedGrantId} in the message signature.`)}const er=(kt==null?void 0:kt.delegatedGrantId)!==void 0,tr=((Nt=e.authorization)===null||Nt===void 0?void 0:Nt.ownerDelegatedGrant)!==void 0;if(er!==tr)throw new DwnError(DwnErrorCode.RecordsOwnerDelegatedGrantAndIdExistenceMismatch,`delegatedGrantId in owner signature and ownerDelegatedGrant must both exist or be undefined.          delegatedGrantId in owner signature defined: ${er},          ownerDelegatedGrant defined: ${tr}`);if(tr){const zt=e.authorization.ownerDelegatedGrant;if((yield PermissionGrant$1.parse(zt)).delegated!==!0)throw new DwnError(DwnErrorCode.RecordsOwnerDelegatedGrantNotADelegatedGrant,"The owner delegated grant given is not a delegated grant.");const nr=zt.descriptor.recipient,ir=Jws.getSignerDid(e.authorization.ownerSignature.signatures[0]);if(nr!==ir)throw new DwnError(DwnErrorCode.RecordsOwnerDelegatedGrantGrantedToAndOwnerSignatureMismatch,`grantedTo ${nr} in owner delegated grant must be the same as the signer ${ir} of the owner signature.`);const ar=yield Message.getCid(zt);if(ar!==kt.delegatedGrantId)throw new DwnError(DwnErrorCode.RecordsOwnerDelegatedGrantCidMismatch,`CID of the owner delegated grant ${ar} must be the same as           the delegatedGrantId ${kt.delegatedGrantId} in the owner signature.`)}})}static shouldProtocolAuthorize(e){return e.protocolRole!==void 0}static filterIncludesPublishedRecords(e){return e.datePublished!==void 0||e.published!==!1}static filterIncludesUnpublishedRecords(e){return e.datePublished===void 0&&e.published===void 0?!0:e.published===!1}static canPerformDeleteAgainstRecord(e,At){if(At===void 0)return!1;if(At.descriptor.method===DwnMethodName.Delete){if(e.descriptor.prune!==!0)return!1;if(At.descriptor.prune===!0)return!1}return!0}static shouldBuildUnpublishedRecipientFilter(e,At){const{recipient:kt}=e;return Array.isArray(kt)?kt.length===0||kt.includes(At):kt===void 0||kt===At}static shouldBuildUnpublishedAuthorFilter(e,At){const{author:kt}=e;return Array.isArray(kt)?kt.length===0||kt.includes(At):kt===void 0||kt===At}}var __awaiter$36=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class GrantAuthorization{static performBaseValidation(e){return __awaiter$36(this,void 0,void 0,function*(){const{incomingMessage:At,expectedGrantor:kt,expectedGrantee:Bt,permissionGrant:Nt,messageStore:jt}=e,Lt=At.descriptor;GrantAuthorization.verifyExpectedGrantorAndGrantee(kt,Bt,Nt);const er=kt;yield GrantAuthorization.verifyGrantActive(er,Lt.messageTimestamp,Nt,jt),yield GrantAuthorization.verifyGrantScopeInterfaceAndMethod(Lt.interface,Lt.method,Nt)})}static verifyExpectedGrantorAndGrantee(e,At,kt){const Bt=kt.grantee;if(At!==Bt)throw new DwnError(DwnErrorCode.GrantAuthorizationNotGrantedToAuthor,`Permission grant is granted to ${Bt}, but need to be granted to ${At}`);const Nt=kt.grantor;if(e!==Nt)throw new DwnError(DwnErrorCode.GrantAuthorizationNotGrantedForTenant,`Permission grant is granted by ${Nt}, but need to be granted by ${e}`)}static verifyGrantActive(e,At,kt,Bt){return __awaiter$36(this,void 0,void 0,function*(){if(At<kt.dateGranted)throw new DwnError(DwnErrorCode.GrantAuthorizationGrantNotYetActive,"The message has a timestamp before the associated permission grant becomes active");if(At>=kt.dateExpires)throw new DwnError(DwnErrorCode.GrantAuthorizationGrantExpired,"The message has timestamp after the expiry of the associated permission grant");const Nt={parentId:kt.id,protocolPath:"grant/revocation",isLatestBaseState:!0},{messages:jt}=yield Bt.query(e,[Nt]),Lt=yield Message.getOldestMessage(jt);if(Lt!==void 0&&Lt.descriptor.messageTimestamp<=At)throw new DwnError(DwnErrorCode.GrantAuthorizationGrantRevoked,`Permission grant with CID ${kt.id} has been revoked`)})}static verifyGrantScopeInterfaceAndMethod(e,At,kt){return __awaiter$36(this,void 0,void 0,function*(){if(e!==kt.scope.interface)throw new DwnError(DwnErrorCode.GrantAuthorizationInterfaceMismatch,`DWN Interface of incoming message is outside the scope of permission grant with ID ${kt.id}`);if(At!==kt.scope.method)throw new DwnError(DwnErrorCode.GrantAuthorizationMethodMismatch,`DWN Method of incoming message is outside the scope of permission grant with ID ${kt.id}`)})}}var PermissionConditionPublication;(function(xt){xt.Required="Required",xt.Prohibited="Prohibited"})(PermissionConditionPublication||(PermissionConditionPublication={}));var __awaiter$35=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class RecordsGrantAuthorization{static authorizeWrite(e){return __awaiter$35(this,void 0,void 0,function*(){const{recordsWriteMessage:At,expectedGrantor:kt,expectedGrantee:Bt,permissionGrant:Nt,messageStore:jt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:At,expectedGrantor:kt,expectedGrantee:Bt,permissionGrant:Nt,messageStore:jt}),RecordsGrantAuthorization.verifyScope(At,Nt.scope),RecordsGrantAuthorization.verifyConditions(At,Nt.conditions)})}static authorizeRead(e){return __awaiter$35(this,void 0,void 0,function*(){const{recordsReadMessage:At,recordsWriteMessageToBeRead:kt,expectedGrantor:Bt,expectedGrantee:Nt,permissionGrant:jt,messageStore:Lt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:At,expectedGrantor:Bt,expectedGrantee:Nt,permissionGrant:jt,messageStore:Lt}),RecordsGrantAuthorization.verifyScope(kt,jt.scope)})}static authorizeQueryOrSubscribe(e){return __awaiter$35(this,void 0,void 0,function*(){const{incomingMessage:At,expectedGrantor:kt,expectedGrantee:Bt,permissionGrant:Nt,messageStore:jt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:At,expectedGrantor:kt,expectedGrantee:Bt,permissionGrant:Nt,messageStore:jt});const er=Nt.scope.protocol,tr=At.descriptor.filter.protocol;if(er!==void 0&&tr!==er)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationQueryOrSubscribeProtocolScopeMismatch,`Grant protocol scope ${er} does not match protocol in message ${tr}`)})}static authorizeDelete(e){return __awaiter$35(this,void 0,void 0,function*(){const{recordsDeleteMessage:At,recordsWriteToDelete:kt,expectedGrantor:Bt,expectedGrantee:Nt,permissionGrant:jt,messageStore:Lt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:At,expectedGrantor:Bt,expectedGrantee:Nt,permissionGrant:jt,messageStore:Lt});const tr=jt.scope.protocol,zt=kt.descriptor.protocol;if(tr!==void 0&&zt!==tr)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationDeleteProtocolScopeMismatch,`Grant protocol scope ${tr} does not match protocol in record to delete ${zt}`)})}static verifyScope(e,At){if(At.protocol!==e.descriptor.protocol)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationScopeProtocolMismatch,"Grant scope specifies different protocol than what appears in the record");if(At.contextId!==void 0&&(e.contextId===void 0||!e.contextId.startsWith(At.contextId)))throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationScopeContextIdMismatch,"Grant scope specifies different contextId than what appears in the record");if(At.protocolPath!==void 0&&At.protocolPath!==e.descriptor.protocolPath)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationScopeProtocolPathMismatch,"Grant scope specifies different protocolPath than what appears in the record")}static verifyConditions(e,At){if((At==null?void 0:At.publication)===PermissionConditionPublication.Required&&!e.descriptor.published)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationConditionPublicationRequired,"Permission grant requires message to be published");if((At==null?void 0:At.publication)===PermissionConditionPublication.Prohibited&&e.descriptor.published)throw new DwnError(DwnErrorCode.RecordsGrantAuthorizationConditionPublicationProhibited,"Permission grant prohibits message from being published")}}class JSBI extends Array{constructor(e,At){if(super(e),this.sign=At,Object.setPrototypeOf(this,JSBI.prototype),e>JSBI.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded")}static BigInt(e){var At=Math.floor,kt=Number.isFinite;if(typeof e=="number"){if(e===0)return JSBI.__zero();if(JSBI.__isOneDigitInt(e))return 0>e?JSBI.__oneDigit(-e,!0):JSBI.__oneDigit(e,!1);if(!kt(e)||At(e)!==e)throw new RangeError("The number "+e+" cannot be converted to BigInt because it is not an integer");return JSBI.__fromDouble(e)}if(typeof e=="string"){const Bt=JSBI.__fromString(e);if(Bt===null)throw new SyntaxError("Cannot convert "+e+" to a BigInt");return Bt}if(typeof e=="boolean")return e===!0?JSBI.__oneDigit(1,!1):JSBI.__zero();if(typeof e=="object"){if(e.constructor===JSBI)return e;const Bt=JSBI.__toPrimitive(e);return JSBI.BigInt(Bt)}throw new TypeError("Cannot convert "+e+" to a BigInt")}toDebugString(){const e=["BigInt["];for(const At of this)e.push((At&&(At>>>0).toString(16))+", ");return e.push("]"),e.join("")}toString(e=10){if(2>e||36<e)throw new RangeError("toString() radix argument must be between 2 and 36");return this.length===0?"0":e&e-1?JSBI.__toStringGeneric(this,e,!1):JSBI.__toStringBasePowerOfTwo(this,e)}valueOf(){throw new Error("Convert JSBI instances to native numbers using `toNumber`.")}static toNumber(e){const At=e.length;if(At===0)return 0;if(At===1){const ur=e.__unsignedDigit(0);return e.sign?-ur:ur}const kt=e.__digit(At-1),Bt=JSBI.__clz30(kt),Nt=30*At-Bt;if(1024<Nt)return e.sign?-1/0:1/0;let jt=Nt-1,Lt=kt,er=At-1;const tr=Bt+3;let zt=tr===32?0:Lt<<tr;zt>>>=12;const rr=tr-12;let nr=12<=tr?0:Lt<<20+tr,ir=20+tr;for(0<rr&&0<er&&(er--,Lt=e.__digit(er),zt|=Lt>>>30-rr,nr=Lt<<rr+2,ir=rr+2);0<ir&&0<er;)er--,Lt=e.__digit(er),nr|=30<=ir?Lt<<ir-30:Lt>>>30-ir,ir-=30;const ar=JSBI.__decideRounding(e,ir,er,Lt);if((ar===1||ar===0&&(1&nr)==1)&&(nr=nr+1>>>0,nr===0&&(zt++,zt>>>20!=0&&(zt=0,jt++,1023<jt))))return e.sign?-1/0:1/0;const dr=e.sign?-2147483648:0;return jt=jt+1023<<20,JSBI.__kBitConversionInts[1]=dr|jt|zt,JSBI.__kBitConversionInts[0]=nr,JSBI.__kBitConversionDouble[0]}static unaryMinus(e){if(e.length===0)return e;const At=e.__copy();return At.sign=!e.sign,At}static bitwiseNot(e){return e.sign?JSBI.__absoluteSubOne(e).__trim():JSBI.__absoluteAddOne(e,!0)}static exponentiate(e,At){if(At.sign)throw new RangeError("Exponent must be positive");if(At.length===0)return JSBI.__oneDigit(1,!1);if(e.length===0)return e;if(e.length===1&&e.__digit(0)===1)return e.sign&&!(1&At.__digit(0))?JSBI.unaryMinus(e):e;if(1<At.length)throw new RangeError("BigInt too big");let kt=At.__unsignedDigit(0);if(kt===1)return e;if(kt>=JSBI.__kMaxLengthBits)throw new RangeError("BigInt too big");if(e.length===1&&e.__digit(0)===2){const jt=1+(0|kt/30),Lt=e.sign&&(1&kt)!=0,er=new JSBI(jt,Lt);er.__initializeDigits();const tr=1<<kt%30;return er.__setDigit(jt-1,tr),er}let Bt=null,Nt=e;for(1&kt&&(Bt=e),kt>>=1;kt!==0;kt>>=1)Nt=JSBI.multiply(Nt,Nt),1&kt&&(Bt===null?Bt=Nt:Bt=JSBI.multiply(Bt,Nt));return Bt}static multiply(e,At){if(e.length===0)return e;if(At.length===0)return At;let kt=e.length+At.length;30<=e.__clzmsd()+At.__clzmsd()&&kt--;const Bt=new JSBI(kt,e.sign!==At.sign);Bt.__initializeDigits();for(let Nt=0;Nt<e.length;Nt++)JSBI.__multiplyAccumulate(At,e.__digit(Nt),Bt,Nt);return Bt.__trim()}static divide(e,At){if(At.length===0)throw new RangeError("Division by zero");if(0>JSBI.__absoluteCompare(e,At))return JSBI.__zero();const kt=e.sign!==At.sign,Bt=At.__unsignedDigit(0);let Nt;if(At.length===1&&32767>=Bt){if(Bt===1)return kt===e.sign?e:JSBI.unaryMinus(e);Nt=JSBI.__absoluteDivSmall(e,Bt,null)}else Nt=JSBI.__absoluteDivLarge(e,At,!0,!1);return Nt.sign=kt,Nt.__trim()}static remainder(e,At){if(At.length===0)throw new RangeError("Division by zero");if(0>JSBI.__absoluteCompare(e,At))return e;const kt=At.__unsignedDigit(0);if(At.length===1&&32767>=kt){if(kt===1)return JSBI.__zero();const Nt=JSBI.__absoluteModSmall(e,kt);return Nt===0?JSBI.__zero():JSBI.__oneDigit(Nt,e.sign)}const Bt=JSBI.__absoluteDivLarge(e,At,!1,!0);return Bt.sign=e.sign,Bt.__trim()}static add(e,At){const kt=e.sign;return kt===At.sign?JSBI.__absoluteAdd(e,At,kt):0<=JSBI.__absoluteCompare(e,At)?JSBI.__absoluteSub(e,At,kt):JSBI.__absoluteSub(At,e,!kt)}static subtract(e,At){const kt=e.sign;return kt===At.sign?0<=JSBI.__absoluteCompare(e,At)?JSBI.__absoluteSub(e,At,kt):JSBI.__absoluteSub(At,e,!kt):JSBI.__absoluteAdd(e,At,kt)}static leftShift(e,At){return At.length===0||e.length===0?e:At.sign?JSBI.__rightShiftByAbsolute(e,At):JSBI.__leftShiftByAbsolute(e,At)}static signedRightShift(e,At){return At.length===0||e.length===0?e:At.sign?JSBI.__leftShiftByAbsolute(e,At):JSBI.__rightShiftByAbsolute(e,At)}static unsignedRightShift(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}static lessThan(e,At){return 0>JSBI.__compareToBigInt(e,At)}static lessThanOrEqual(e,At){return 0>=JSBI.__compareToBigInt(e,At)}static greaterThan(e,At){return 0<JSBI.__compareToBigInt(e,At)}static greaterThanOrEqual(e,At){return 0<=JSBI.__compareToBigInt(e,At)}static equal(e,At){if(e.sign!==At.sign||e.length!==At.length)return!1;for(let kt=0;kt<e.length;kt++)if(e.__digit(kt)!==At.__digit(kt))return!1;return!0}static notEqual(e,At){return!JSBI.equal(e,At)}static bitwiseAnd(e,At){var kt=Math.max;if(!e.sign&&!At.sign)return JSBI.__absoluteAnd(e,At).__trim();if(e.sign&&At.sign){const Bt=kt(e.length,At.length)+1;let Nt=JSBI.__absoluteSubOne(e,Bt);const jt=JSBI.__absoluteSubOne(At);return Nt=JSBI.__absoluteOr(Nt,jt,Nt),JSBI.__absoluteAddOne(Nt,!0,Nt).__trim()}return e.sign&&([e,At]=[At,e]),JSBI.__absoluteAndNot(e,JSBI.__absoluteSubOne(At)).__trim()}static bitwiseXor(e,At){var kt=Math.max;if(!e.sign&&!At.sign)return JSBI.__absoluteXor(e,At).__trim();if(e.sign&&At.sign){const jt=kt(e.length,At.length),Lt=JSBI.__absoluteSubOne(e,jt),er=JSBI.__absoluteSubOne(At);return JSBI.__absoluteXor(Lt,er,Lt).__trim()}const Bt=kt(e.length,At.length)+1;e.sign&&([e,At]=[At,e]);let Nt=JSBI.__absoluteSubOne(At,Bt);return Nt=JSBI.__absoluteXor(Nt,e,Nt),JSBI.__absoluteAddOne(Nt,!0,Nt).__trim()}static bitwiseOr(e,At){var kt=Math.max;const Bt=kt(e.length,At.length);if(!e.sign&&!At.sign)return JSBI.__absoluteOr(e,At).__trim();if(e.sign&&At.sign){let jt=JSBI.__absoluteSubOne(e,Bt);const Lt=JSBI.__absoluteSubOne(At);return jt=JSBI.__absoluteAnd(jt,Lt,jt),JSBI.__absoluteAddOne(jt,!0,jt).__trim()}e.sign&&([e,At]=[At,e]);let Nt=JSBI.__absoluteSubOne(At,Bt);return Nt=JSBI.__absoluteAndNot(Nt,e,Nt),JSBI.__absoluteAddOne(Nt,!0,Nt).__trim()}static asIntN(e,At){var kt=Math.floor;if(At.length===0)return At;if(e=kt(e),0>e)throw new RangeError("Invalid value: not (convertible to) a safe integer");if(e===0)return JSBI.__zero();if(e>=JSBI.__kMaxLengthBits)return At;const Bt=0|(e+29)/30;if(At.length<Bt)return At;const Nt=At.__unsignedDigit(Bt-1),jt=1<<(e-1)%30;if(At.length===Bt&&Nt<jt)return At;if((Nt&jt)!==jt)return JSBI.__truncateToNBits(e,At);if(!At.sign)return JSBI.__truncateAndSubFromPowerOfTwo(e,At,!0);if(!(Nt&jt-1)){for(let Lt=Bt-2;0<=Lt;Lt--)if(At.__digit(Lt)!==0)return JSBI.__truncateAndSubFromPowerOfTwo(e,At,!1);return At.length===Bt&&Nt===jt?At:JSBI.__truncateToNBits(e,At)}return JSBI.__truncateAndSubFromPowerOfTwo(e,At,!1)}static asUintN(e,At){var kt=Math.floor;if(At.length===0)return At;if(e=kt(e),0>e)throw new RangeError("Invalid value: not (convertible to) a safe integer");if(e===0)return JSBI.__zero();if(At.sign){if(e>JSBI.__kMaxLengthBits)throw new RangeError("BigInt too big");return JSBI.__truncateAndSubFromPowerOfTwo(e,At,!1)}if(e>=JSBI.__kMaxLengthBits)return At;const Bt=0|(e+29)/30;if(At.length<Bt)return At;const Nt=e%30;return At.length==Bt&&(Nt===0||!(At.__digit(Bt-1)>>>Nt))?At:JSBI.__truncateToNBits(e,At)}static ADD(e,At){if(e=JSBI.__toPrimitive(e),At=JSBI.__toPrimitive(At),typeof e=="string")return typeof At!="string"&&(At=At.toString()),e+At;if(typeof At=="string")return e.toString()+At;if(e=JSBI.__toNumeric(e),At=JSBI.__toNumeric(At),JSBI.__isBigInt(e)&&JSBI.__isBigInt(At))return JSBI.add(e,At);if(typeof e=="number"&&typeof At=="number")return e+At;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}static LT(e,At){return JSBI.__compare(e,At,0)}static LE(e,At){return JSBI.__compare(e,At,1)}static GT(e,At){return JSBI.__compare(e,At,2)}static GE(e,At){return JSBI.__compare(e,At,3)}static EQ(e,At){for(;;){if(JSBI.__isBigInt(e))return JSBI.__isBigInt(At)?JSBI.equal(e,At):JSBI.EQ(At,e);if(typeof e=="number"){if(JSBI.__isBigInt(At))return JSBI.__equalToNumber(At,e);if(typeof At!="object")return e==At;At=JSBI.__toPrimitive(At)}else if(typeof e=="string"){if(JSBI.__isBigInt(At))return e=JSBI.__fromString(e),e!==null&&JSBI.equal(e,At);if(typeof At!="object")return e==At;At=JSBI.__toPrimitive(At)}else if(typeof e=="boolean"){if(JSBI.__isBigInt(At))return JSBI.__equalToNumber(At,+e);if(typeof At!="object")return e==At;At=JSBI.__toPrimitive(At)}else if(typeof e=="symbol"){if(JSBI.__isBigInt(At))return!1;if(typeof At!="object")return e==At;At=JSBI.__toPrimitive(At)}else if(typeof e=="object"){if(typeof At=="object"&&At.constructor!==JSBI)return e==At;e=JSBI.__toPrimitive(e)}else return e==At}}static NE(e,At){return!JSBI.EQ(e,At)}static DataViewGetBigInt64(e,At,kt=!1){return JSBI.asIntN(64,JSBI.DataViewGetBigUint64(e,At,kt))}static DataViewGetBigUint64(e,At,kt=!1){const[Bt,Nt]=kt?[4,0]:[0,4],jt=e.getUint32(At+Bt,kt),Lt=e.getUint32(At+Nt,kt),er=new JSBI(3,!1);return er.__setDigit(0,1073741823&Lt),er.__setDigit(1,(268435455&jt)<<2|Lt>>>30),er.__setDigit(2,jt>>>28),er.__trim()}static DataViewSetBigInt64(e,At,kt,Bt=!1){JSBI.DataViewSetBigUint64(e,At,kt,Bt)}static DataViewSetBigUint64(e,At,kt,Bt=!1){kt=JSBI.asUintN(64,kt);let Nt=0,jt=0;if(0<kt.length&&(jt=kt.__digit(0),1<kt.length)){const tr=kt.__digit(1);jt|=tr<<30,Nt=tr>>>2,2<kt.length&&(Nt|=kt.__digit(2)<<28)}const[Lt,er]=Bt?[4,0]:[0,4];e.setUint32(At+Lt,Nt,Bt),e.setUint32(At+er,jt,Bt)}static __zero(){return new JSBI(0,!1)}static __oneDigit(e,At){const kt=new JSBI(1,At);return kt.__setDigit(0,e),kt}__copy(){const e=new JSBI(this.length,this.sign);for(let At=0;At<this.length;At++)e[At]=this[At];return e}__trim(){let e=this.length,At=this[e-1];for(;At===0;)e--,At=this[e-1],this.pop();return e===0&&(this.sign=!1),this}__initializeDigits(){for(let e=0;e<this.length;e++)this[e]=0}static __decideRounding(e,At,kt,Bt){if(0<At)return-1;let Nt;if(0>At)Nt=-At-1;else{if(kt===0)return-1;kt--,Bt=e.__digit(kt),Nt=29}let jt=1<<Nt;if(!(Bt&jt))return-1;if(jt-=1,(Bt&jt)!=0)return 1;for(;0<kt;)if(kt--,e.__digit(kt)!==0)return 1;return 0}static __fromDouble(e){JSBI.__kBitConversionDouble[0]=e;const At=2047&JSBI.__kBitConversionInts[1]>>>20,kt=At-1023,Bt=(0|kt/30)+1,Nt=new JSBI(Bt,0>e);let jt=1048575&JSBI.__kBitConversionInts[1]|1048576,Lt=JSBI.__kBitConversionInts[0];const er=20,tr=kt%30;let zt,rr=0;if(tr<20){const nr=er-tr;rr=nr+32,zt=jt>>>nr,jt=jt<<32-nr|Lt>>>nr,Lt<<=32-nr}else if(tr===20)rr=32,zt=jt,jt=Lt,Lt=0;else{const nr=tr-er;rr=32-nr,zt=jt<<nr|Lt>>>32-nr,jt=Lt<<nr,Lt=0}Nt.__setDigit(Bt-1,zt);for(let nr=Bt-2;0<=nr;nr--)0<rr?(rr-=30,zt=jt>>>2,jt=jt<<30|Lt>>>2,Lt<<=30):zt=0,Nt.__setDigit(nr,zt);return Nt.__trim()}static __isWhitespace(e){return 13>=e&&9<=e||(159>=e?e==32:131071>=e?e==160||e==5760:196607>=e?(e&=131071,10>=e||e==40||e==41||e==47||e==95||e==4096):e==65279)}static __fromString(e,At=0){let kt=0;const Bt=e.length;let Nt=0;if(Nt===Bt)return JSBI.__zero();let jt=e.charCodeAt(Nt);for(;JSBI.__isWhitespace(jt);){if(++Nt===Bt)return JSBI.__zero();jt=e.charCodeAt(Nt)}if(jt===43){if(++Nt===Bt)return null;jt=e.charCodeAt(Nt),kt=1}else if(jt===45){if(++Nt===Bt)return null;jt=e.charCodeAt(Nt),kt=-1}if(At===0){if(At=10,jt===48){if(++Nt===Bt)return JSBI.__zero();if(jt=e.charCodeAt(Nt),jt===88||jt===120){if(At=16,++Nt===Bt)return null;jt=e.charCodeAt(Nt)}else if(jt===79||jt===111){if(At=8,++Nt===Bt)return null;jt=e.charCodeAt(Nt)}else if(jt===66||jt===98){if(At=2,++Nt===Bt)return null;jt=e.charCodeAt(Nt)}}}else if(At===16&&jt===48){if(++Nt===Bt)return JSBI.__zero();if(jt=e.charCodeAt(Nt),jt===88||jt===120){if(++Nt===Bt)return null;jt=e.charCodeAt(Nt)}}if(kt!=0&&At!==10)return null;for(;jt===48;){if(++Nt===Bt)return JSBI.__zero();jt=e.charCodeAt(Nt)}const Lt=Bt-Nt;let er=JSBI.__kMaxBitsPerChar[At],tr=JSBI.__kBitsPerCharTableMultiplier-1;if(Lt>1073741824/er)return null;const zt=er*Lt+tr>>>JSBI.__kBitsPerCharTableShift,rr=new JSBI(0|(zt+29)/30,!1),nr=10>At?At:10,ir=10<At?At-10:0;if(At&At-1){rr.__initializeDigits();let ar=!1,dr=0;do{let ur=0,fr=1;for(;;){let lr;if(jt-48>>>0<nr)lr=jt-48;else if((32|jt)-97>>>0<ir)lr=(32|jt)-87;else{ar=!0;break}const yr=fr*At;if(1073741823<yr)break;if(fr=yr,ur=ur*At+lr,dr++,++Nt===Bt){ar=!0;break}jt=e.charCodeAt(Nt)}tr=30*JSBI.__kBitsPerCharTableMultiplier-1;const pr=0|(er*dr+tr>>>JSBI.__kBitsPerCharTableShift)/30;rr.__inplaceMultiplyAdd(fr,ur,pr)}while(!ar)}else{er>>=JSBI.__kBitsPerCharTableShift;const ar=[],dr=[];let ur=!1;do{let fr=0,pr=0;for(;;){let lr;if(jt-48>>>0<nr)lr=jt-48;else if((32|jt)-97>>>0<ir)lr=(32|jt)-87;else{ur=!0;break}if(pr+=er,fr=fr<<er|lr,++Nt===Bt){ur=!0;break}if(jt=e.charCodeAt(Nt),30<pr+er)break}ar.push(fr),dr.push(pr)}while(!ur);JSBI.__fillFromParts(rr,ar,dr)}if(Nt!==Bt){if(!JSBI.__isWhitespace(jt))return null;for(Nt++;Nt<Bt;Nt++)if(jt=e.charCodeAt(Nt),!JSBI.__isWhitespace(jt))return null}return rr.sign=kt==-1,rr.__trim()}static __fillFromParts(e,At,kt){let Bt=0,Nt=0,jt=0;for(let Lt=At.length-1;0<=Lt;Lt--){const er=At[Lt],tr=kt[Lt];Nt|=er<<jt,jt+=tr,jt===30?(e.__setDigit(Bt++,Nt),jt=0,Nt=0):30<jt&&(e.__setDigit(Bt++,1073741823&Nt),jt-=30,Nt=er>>>tr-jt)}if(Nt!==0){if(Bt>=e.length)throw new Error("implementation bug");e.__setDigit(Bt++,Nt)}for(;Bt<e.length;Bt++)e.__setDigit(Bt,0)}static __toStringBasePowerOfTwo(e,At){const kt=e.length;let Bt=At-1;Bt=(85&Bt>>>1)+(85&Bt),Bt=(51&Bt>>>2)+(51&Bt),Bt=(15&Bt>>>4)+(15&Bt);const Nt=Bt,jt=At-1,Lt=e.__digit(kt-1),er=JSBI.__clz30(Lt);let tr=0|(30*kt-er+Nt-1)/Nt;if(e.sign&&tr++,268435456<tr)throw new Error("string too long");const zt=Array(tr);let rr=tr-1,nr=0,ir=0;for(let dr=0;dr<kt-1;dr++){const ur=e.__digit(dr),fr=(nr|ur<<ir)&jt;zt[rr--]=JSBI.__kConversionChars[fr];const pr=Nt-ir;for(nr=ur>>>pr,ir=30-pr;ir>=Nt;)zt[rr--]=JSBI.__kConversionChars[nr&jt],nr>>>=Nt,ir-=Nt}const ar=(nr|Lt<<ir)&jt;for(zt[rr--]=JSBI.__kConversionChars[ar],nr=Lt>>>Nt-ir;nr!==0;)zt[rr--]=JSBI.__kConversionChars[nr&jt],nr>>>=Nt;if(e.sign&&(zt[rr--]="-"),rr!=-1)throw new Error("implementation bug");return zt.join("")}static __toStringGeneric(e,At,kt){const Bt=e.length;if(Bt===0)return"";if(Bt===1){let dr=e.__unsignedDigit(0).toString(At);return kt===!1&&e.sign&&(dr="-"+dr),dr}const Nt=30*Bt-JSBI.__clz30(e.__digit(Bt-1)),jt=JSBI.__kMaxBitsPerChar[At],Lt=jt-1;let er=Nt*JSBI.__kBitsPerCharTableMultiplier;er+=Lt-1,er=0|er/Lt;const tr=er+1>>1,zt=JSBI.exponentiate(JSBI.__oneDigit(At,!1),JSBI.__oneDigit(tr,!1));let rr,nr;const ir=zt.__unsignedDigit(0);if(zt.length===1&&32767>=ir){rr=new JSBI(e.length,!1),rr.__initializeDigits();let dr=0;for(let ur=2*e.length-1;0<=ur;ur--){const fr=dr<<15|e.__halfDigit(ur);rr.__setHalfDigit(ur,0|fr/ir),dr=0|fr%ir}nr=dr.toString(At)}else{const dr=JSBI.__absoluteDivLarge(e,zt,!0,!0);rr=dr.quotient;const ur=dr.remainder.__trim();nr=JSBI.__toStringGeneric(ur,At,!0)}rr.__trim();let ar=JSBI.__toStringGeneric(rr,At,!0);for(;nr.length<tr;)nr="0"+nr;return kt===!1&&e.sign&&(ar="-"+ar),ar+nr}static __unequalSign(e){return e?-1:1}static __absoluteGreater(e){return e?-1:1}static __absoluteLess(e){return e?1:-1}static __compareToBigInt(e,At){const kt=e.sign;if(kt!==At.sign)return JSBI.__unequalSign(kt);const Bt=JSBI.__absoluteCompare(e,At);return 0<Bt?JSBI.__absoluteGreater(kt):0>Bt?JSBI.__absoluteLess(kt):0}static __compareToNumber(e,At){if(JSBI.__isOneDigitInt(At)){const kt=e.sign,Bt=0>At;if(kt!==Bt)return JSBI.__unequalSign(kt);if(e.length===0){if(Bt)throw new Error("implementation bug");return At===0?0:-1}if(1<e.length)return JSBI.__absoluteGreater(kt);const Nt=Math.abs(At),jt=e.__unsignedDigit(0);return jt>Nt?JSBI.__absoluteGreater(kt):jt<Nt?JSBI.__absoluteLess(kt):0}return JSBI.__compareToDouble(e,At)}static __compareToDouble(e,At){if(At!==At)return At;if(At===1/0)return-1;if(At===-1/0)return 1;const kt=e.sign;if(kt!==0>At)return JSBI.__unequalSign(kt);if(At===0)throw new Error("implementation bug: should be handled elsewhere");if(e.length===0)return-1;JSBI.__kBitConversionDouble[0]=At;const Bt=2047&JSBI.__kBitConversionInts[1]>>>20;if(Bt==2047)throw new Error("implementation bug: handled elsewhere");const Nt=Bt-1023;if(0>Nt)return JSBI.__absoluteGreater(kt);const jt=e.length;let Lt=e.__digit(jt-1);const er=JSBI.__clz30(Lt),tr=30*jt-er,zt=Nt+1;if(tr<zt)return JSBI.__absoluteLess(kt);if(tr>zt)return JSBI.__absoluteGreater(kt);let rr=1048576|1048575&JSBI.__kBitConversionInts[1],nr=JSBI.__kBitConversionInts[0];const ir=20,ar=29-er;if(ar!==(0|(tr-1)%30))throw new Error("implementation bug");let dr,ur=0;if(20>ar){const fr=ir-ar;ur=fr+32,dr=rr>>>fr,rr=rr<<32-fr|nr>>>fr,nr<<=32-fr}else if(ar===20)ur=32,dr=rr,rr=nr,nr=0;else{const fr=ar-ir;ur=32-fr,dr=rr<<fr|nr>>>32-fr,rr=nr<<fr,nr=0}if(Lt>>>=0,dr>>>=0,Lt>dr)return JSBI.__absoluteGreater(kt);if(Lt<dr)return JSBI.__absoluteLess(kt);for(let fr=jt-2;0<=fr;fr--){0<ur?(ur-=30,dr=rr>>>2,rr=rr<<30|nr>>>2,nr<<=30):dr=0;const pr=e.__unsignedDigit(fr);if(pr>dr)return JSBI.__absoluteGreater(kt);if(pr<dr)return JSBI.__absoluteLess(kt)}if(rr!==0||nr!==0){if(ur===0)throw new Error("implementation bug");return JSBI.__absoluteLess(kt)}return 0}static __equalToNumber(e,At){var kt=Math.abs;return JSBI.__isOneDigitInt(At)?At===0?e.length===0:e.length===1&&e.sign===0>At&&e.__unsignedDigit(0)===kt(At):JSBI.__compareToDouble(e,At)===0}static __comparisonResultToBool(e,At){return At===0?0>e:At===1?0>=e:At===2?0<e:At===3?0<=e:void 0}static __compare(e,At,kt){if(e=JSBI.__toPrimitive(e),At=JSBI.__toPrimitive(At),typeof e=="string"&&typeof At=="string")switch(kt){case 0:return e<At;case 1:return e<=At;case 2:return e>At;case 3:return e>=At}if(JSBI.__isBigInt(e)&&typeof At=="string")return At=JSBI.__fromString(At),At!==null&&JSBI.__comparisonResultToBool(JSBI.__compareToBigInt(e,At),kt);if(typeof e=="string"&&JSBI.__isBigInt(At))return e=JSBI.__fromString(e),e!==null&&JSBI.__comparisonResultToBool(JSBI.__compareToBigInt(e,At),kt);if(e=JSBI.__toNumeric(e),At=JSBI.__toNumeric(At),JSBI.__isBigInt(e)){if(JSBI.__isBigInt(At))return JSBI.__comparisonResultToBool(JSBI.__compareToBigInt(e,At),kt);if(typeof At!="number")throw new Error("implementation bug");return JSBI.__comparisonResultToBool(JSBI.__compareToNumber(e,At),kt)}if(typeof e!="number")throw new Error("implementation bug");if(JSBI.__isBigInt(At))return JSBI.__comparisonResultToBool(JSBI.__compareToNumber(At,e),2^kt);if(typeof At!="number")throw new Error("implementation bug");return kt===0?e<At:kt===1?e<=At:kt===2?e>At:kt===3?e>=At:void 0}__clzmsd(){return JSBI.__clz30(this.__digit(this.length-1))}static __absoluteAdd(e,At,kt){if(e.length<At.length)return JSBI.__absoluteAdd(At,e,kt);if(e.length===0)return e;if(At.length===0)return e.sign===kt?e:JSBI.unaryMinus(e);let Bt=e.length;(e.__clzmsd()===0||At.length===e.length&&At.__clzmsd()===0)&&Bt++;const Nt=new JSBI(Bt,kt);let jt=0,Lt=0;for(;Lt<At.length;Lt++){const er=e.__digit(Lt)+At.__digit(Lt)+jt;jt=er>>>30,Nt.__setDigit(Lt,1073741823&er)}for(;Lt<e.length;Lt++){const er=e.__digit(Lt)+jt;jt=er>>>30,Nt.__setDigit(Lt,1073741823&er)}return Lt<Nt.length&&Nt.__setDigit(Lt,jt),Nt.__trim()}static __absoluteSub(e,At,kt){if(e.length===0)return e;if(At.length===0)return e.sign===kt?e:JSBI.unaryMinus(e);const Bt=new JSBI(e.length,kt);let Nt=0,jt=0;for(;jt<At.length;jt++){const Lt=e.__digit(jt)-At.__digit(jt)-Nt;Nt=1&Lt>>>30,Bt.__setDigit(jt,1073741823&Lt)}for(;jt<e.length;jt++){const Lt=e.__digit(jt)-Nt;Nt=1&Lt>>>30,Bt.__setDigit(jt,1073741823&Lt)}return Bt.__trim()}static __absoluteAddOne(e,At,kt=null){const Bt=e.length;kt===null?kt=new JSBI(Bt,At):kt.sign=At;let Nt=1;for(let jt=0;jt<Bt;jt++){const Lt=e.__digit(jt)+Nt;Nt=Lt>>>30,kt.__setDigit(jt,1073741823&Lt)}return Nt!=0&&kt.__setDigitGrow(Bt,1),kt}static __absoluteSubOne(e,At){const kt=e.length;At=At||kt;const Bt=new JSBI(At,!1);let Nt=1;for(let jt=0;jt<kt;jt++){const Lt=e.__digit(jt)-Nt;Nt=1&Lt>>>30,Bt.__setDigit(jt,1073741823&Lt)}if(Nt!=0)throw new Error("implementation bug");for(let jt=kt;jt<At;jt++)Bt.__setDigit(jt,0);return Bt}static __absoluteAnd(e,At,kt=null){let Bt=e.length,Nt=At.length,jt=Nt;if(Bt<Nt){jt=Bt;const tr=e,zt=Bt;e=At,Bt=Nt,At=tr,Nt=zt}let Lt=jt;kt===null?kt=new JSBI(Lt,!1):Lt=kt.length;let er=0;for(;er<jt;er++)kt.__setDigit(er,e.__digit(er)&At.__digit(er));for(;er<Lt;er++)kt.__setDigit(er,0);return kt}static __absoluteAndNot(e,At,kt=null){const Bt=e.length,Nt=At.length;let jt=Nt;Bt<Nt&&(jt=Bt);let Lt=Bt;kt===null?kt=new JSBI(Lt,!1):Lt=kt.length;let er=0;for(;er<jt;er++)kt.__setDigit(er,e.__digit(er)&~At.__digit(er));for(;er<Bt;er++)kt.__setDigit(er,e.__digit(er));for(;er<Lt;er++)kt.__setDigit(er,0);return kt}static __absoluteOr(e,At,kt=null){let Bt=e.length,Nt=At.length,jt=Nt;if(Bt<Nt){jt=Bt;const tr=e,zt=Bt;e=At,Bt=Nt,At=tr,Nt=zt}let Lt=Bt;kt===null?kt=new JSBI(Lt,!1):Lt=kt.length;let er=0;for(;er<jt;er++)kt.__setDigit(er,e.__digit(er)|At.__digit(er));for(;er<Bt;er++)kt.__setDigit(er,e.__digit(er));for(;er<Lt;er++)kt.__setDigit(er,0);return kt}static __absoluteXor(e,At,kt=null){let Bt=e.length,Nt=At.length,jt=Nt;if(Bt<Nt){jt=Bt;const tr=e,zt=Bt;e=At,Bt=Nt,At=tr,Nt=zt}let Lt=Bt;kt===null?kt=new JSBI(Lt,!1):Lt=kt.length;let er=0;for(;er<jt;er++)kt.__setDigit(er,e.__digit(er)^At.__digit(er));for(;er<Bt;er++)kt.__setDigit(er,e.__digit(er));for(;er<Lt;er++)kt.__setDigit(er,0);return kt}static __absoluteCompare(e,At){const kt=e.length-At.length;if(kt!=0)return kt;let Bt=e.length-1;for(;0<=Bt&&e.__digit(Bt)===At.__digit(Bt);)Bt--;return 0>Bt?0:e.__unsignedDigit(Bt)>At.__unsignedDigit(Bt)?1:-1}static __multiplyAccumulate(e,At,kt,Bt){if(At===0)return;const Nt=32767&At,jt=At>>>15;let Lt=0,er=0;for(let tr,zt=0;zt<e.length;zt++,Bt++){tr=kt.__digit(Bt);const rr=e.__digit(zt),nr=32767&rr,ir=rr>>>15,ar=JSBI.__imul(nr,Nt),dr=JSBI.__imul(nr,jt),ur=JSBI.__imul(ir,Nt),fr=JSBI.__imul(ir,jt);tr+=er+ar+Lt,Lt=tr>>>30,tr&=1073741823,tr+=((32767&dr)<<15)+((32767&ur)<<15),Lt+=tr>>>30,er=fr+(dr>>>15)+(ur>>>15),kt.__setDigit(Bt,1073741823&tr)}for(;Lt!=0||er!==0;Bt++){let tr=kt.__digit(Bt);tr+=Lt+er,er=0,Lt=tr>>>30,kt.__setDigit(Bt,1073741823&tr)}}static __internalMultiplyAdd(e,At,kt,Bt,Nt){let jt=kt,Lt=0;for(let er=0;er<Bt;er++){const tr=e.__digit(er),zt=JSBI.__imul(32767&tr,At),rr=JSBI.__imul(tr>>>15,At),nr=zt+((32767&rr)<<15)+Lt+jt;jt=nr>>>30,Lt=rr>>>15,Nt.__setDigit(er,1073741823&nr)}if(Nt.length>Bt)for(Nt.__setDigit(Bt++,jt+Lt);Bt<Nt.length;)Nt.__setDigit(Bt++,0);else if(jt+Lt!==0)throw new Error("implementation bug")}__inplaceMultiplyAdd(e,At,kt){kt>this.length&&(kt=this.length);const Bt=32767&e,Nt=e>>>15;let jt=0,Lt=At;for(let er=0;er<kt;er++){const tr=this.__digit(er),zt=32767&tr,rr=tr>>>15,nr=JSBI.__imul(zt,Bt),ir=JSBI.__imul(zt,Nt),ar=JSBI.__imul(rr,Bt),dr=JSBI.__imul(rr,Nt);let ur=Lt+nr+jt;jt=ur>>>30,ur&=1073741823,ur+=((32767&ir)<<15)+((32767&ar)<<15),jt+=ur>>>30,Lt=dr+(ir>>>15)+(ar>>>15),this.__setDigit(er,1073741823&ur)}if(jt!=0||Lt!==0)throw new Error("implementation bug")}static __absoluteDivSmall(e,At,kt=null){kt===null&&(kt=new JSBI(e.length,!1));let Bt=0;for(let Nt,jt=2*e.length-1;0<=jt;jt-=2){Nt=(Bt<<15|e.__halfDigit(jt))>>>0;const Lt=0|Nt/At;Bt=0|Nt%At,Nt=(Bt<<15|e.__halfDigit(jt-1))>>>0;const er=0|Nt/At;Bt=0|Nt%At,kt.__setDigit(jt>>>1,Lt<<15|er)}return kt}static __absoluteModSmall(e,At){let kt=0;for(let Bt=2*e.length-1;0<=Bt;Bt--)kt=0|((kt<<15|e.__halfDigit(Bt))>>>0)%At;return kt}static __absoluteDivLarge(e,At,kt,Bt){const Nt=At.__halfDigitLength(),jt=At.length,Lt=e.__halfDigitLength()-Nt;let er=null;kt&&(er=new JSBI(Lt+2>>>1,!1),er.__initializeDigits());const tr=new JSBI(Nt+2>>>1,!1);tr.__initializeDigits();const zt=JSBI.__clz15(At.__halfDigit(Nt-1));0<zt&&(At=JSBI.__specialLeftShift(At,zt,0));const rr=JSBI.__specialLeftShift(e,zt,1),nr=At.__halfDigit(Nt-1);let ir=0;for(let ar,dr=Lt;0<=dr;dr--){ar=32767;const ur=rr.__halfDigit(dr+Nt);if(ur!==nr){const pr=(ur<<15|rr.__halfDigit(dr+Nt-1))>>>0;ar=0|pr/nr;let lr=0|pr%nr;const yr=At.__halfDigit(Nt-2),br=rr.__halfDigit(dr+Nt-2);for(;JSBI.__imul(ar,yr)>>>0>(lr<<16|br)>>>0&&(ar--,lr+=nr,!(32767<lr)););}JSBI.__internalMultiplyAdd(At,ar,0,jt,tr);let fr=rr.__inplaceSub(tr,dr,Nt+1);fr!==0&&(fr=rr.__inplaceAdd(At,dr,Nt),rr.__setHalfDigit(dr+Nt,32767&rr.__halfDigit(dr+Nt)+fr),ar--),kt&&(1&dr?ir=ar<<15:er.__setDigit(dr>>>1,ir|ar))}if(Bt)return rr.__inplaceRightShift(zt),kt?{quotient:er,remainder:rr}:rr;if(kt)return er;throw new Error("unreachable")}static __clz15(e){return JSBI.__clz30(e)-15}__inplaceAdd(e,At,kt){let Bt=0;for(let Nt=0;Nt<kt;Nt++){const jt=this.__halfDigit(At+Nt)+e.__halfDigit(Nt)+Bt;Bt=jt>>>15,this.__setHalfDigit(At+Nt,32767&jt)}return Bt}__inplaceSub(e,At,kt){let Bt=0;if(1&At){At>>=1;let Nt=this.__digit(At),jt=32767&Nt,Lt=0;for(;Lt<kt-1>>>1;Lt++){const zt=e.__digit(Lt),rr=(Nt>>>15)-(32767&zt)-Bt;Bt=1&rr>>>15,this.__setDigit(At+Lt,(32767&rr)<<15|32767&jt),Nt=this.__digit(At+Lt+1),jt=(32767&Nt)-(zt>>>15)-Bt,Bt=1&jt>>>15}const er=e.__digit(Lt),tr=(Nt>>>15)-(32767&er)-Bt;if(Bt=1&tr>>>15,this.__setDigit(At+Lt,(32767&tr)<<15|32767&jt),At+Lt+1>=this.length)throw new RangeError("out of bounds");!(1&kt)&&(Nt=this.__digit(At+Lt+1),jt=(32767&Nt)-(er>>>15)-Bt,Bt=1&jt>>>15,this.__setDigit(At+e.length,1073709056&Nt|32767&jt))}else{At>>=1;let Nt=0;for(;Nt<e.length-1;Nt++){const zt=this.__digit(At+Nt),rr=e.__digit(Nt),nr=(32767&zt)-(32767&rr)-Bt;Bt=1&nr>>>15;const ir=(zt>>>15)-(rr>>>15)-Bt;Bt=1&ir>>>15,this.__setDigit(At+Nt,(32767&ir)<<15|32767&nr)}const jt=this.__digit(At+Nt),Lt=e.__digit(Nt),er=(32767&jt)-(32767&Lt)-Bt;Bt=1&er>>>15;let tr=0;!(1&kt)&&(tr=(jt>>>15)-(Lt>>>15)-Bt,Bt=1&tr>>>15),this.__setDigit(At+Nt,(32767&tr)<<15|32767&er)}return Bt}__inplaceRightShift(e){if(e===0)return;let At=this.__digit(0)>>>e;const kt=this.length-1;for(let Bt=0;Bt<kt;Bt++){const Nt=this.__digit(Bt+1);this.__setDigit(Bt,1073741823&Nt<<30-e|At),At=Nt>>>e}this.__setDigit(kt,At)}static __specialLeftShift(e,At,kt){const Bt=e.length,Nt=new JSBI(Bt+kt,!1);if(At===0){for(let Lt=0;Lt<Bt;Lt++)Nt.__setDigit(Lt,e.__digit(Lt));return 0<kt&&Nt.__setDigit(Bt,0),Nt}let jt=0;for(let Lt=0;Lt<Bt;Lt++){const er=e.__digit(Lt);Nt.__setDigit(Lt,1073741823&er<<At|jt),jt=er>>>30-At}return 0<kt&&Nt.__setDigit(Bt,jt),Nt}static __leftShiftByAbsolute(e,At){const kt=JSBI.__toShiftAmount(At);if(0>kt)throw new RangeError("BigInt too big");const Bt=0|kt/30,Nt=kt%30,jt=e.length,Lt=Nt!==0&&e.__digit(jt-1)>>>30-Nt!=0,er=jt+Bt+(Lt?1:0),tr=new JSBI(er,e.sign);if(Nt===0){let zt=0;for(;zt<Bt;zt++)tr.__setDigit(zt,0);for(;zt<er;zt++)tr.__setDigit(zt,e.__digit(zt-Bt))}else{let zt=0;for(let rr=0;rr<Bt;rr++)tr.__setDigit(rr,0);for(let rr=0;rr<jt;rr++){const nr=e.__digit(rr);tr.__setDigit(rr+Bt,1073741823&nr<<Nt|zt),zt=nr>>>30-Nt}if(Lt)tr.__setDigit(jt+Bt,zt);else if(zt!==0)throw new Error("implementation bug")}return tr.__trim()}static __rightShiftByAbsolute(e,At){const kt=e.length,Bt=e.sign,Nt=JSBI.__toShiftAmount(At);if(0>Nt)return JSBI.__rightShiftByMaximum(Bt);const jt=0|Nt/30,Lt=Nt%30;let er=kt-jt;if(0>=er)return JSBI.__rightShiftByMaximum(Bt);let tr=!1;if(Bt){if(e.__digit(jt)&(1<<Lt)-1)tr=!0;else for(let rr=0;rr<jt;rr++)if(e.__digit(rr)!==0){tr=!0;break}}tr&&Lt===0&&!~e.__digit(kt-1)&&er++;let zt=new JSBI(er,Bt);if(Lt===0){zt.__setDigit(er-1,0);for(let rr=jt;rr<kt;rr++)zt.__setDigit(rr-jt,e.__digit(rr))}else{let rr=e.__digit(jt)>>>Lt;const nr=kt-jt-1;for(let ir=0;ir<nr;ir++){const ar=e.__digit(ir+jt+1);zt.__setDigit(ir,1073741823&ar<<30-Lt|rr),rr=ar>>>Lt}zt.__setDigit(nr,rr)}return tr&&(zt=JSBI.__absoluteAddOne(zt,!0,zt)),zt.__trim()}static __rightShiftByMaximum(e){return e?JSBI.__oneDigit(1,!0):JSBI.__zero()}static __toShiftAmount(e){if(1<e.length)return-1;const At=e.__unsignedDigit(0);return At>JSBI.__kMaxLengthBits?-1:At}static __toPrimitive(e,At="default"){if(typeof e!="object"||e.constructor===JSBI)return e;if(typeof Symbol<"u"&&typeof Symbol.toPrimitive=="symbol"){const Nt=e[Symbol.toPrimitive];if(Nt){const jt=Nt(At);if(typeof jt!="object")return jt;throw new TypeError("Cannot convert object to primitive value")}}const kt=e.valueOf;if(kt){const Nt=kt.call(e);if(typeof Nt!="object")return Nt}const Bt=e.toString;if(Bt){const Nt=Bt.call(e);if(typeof Nt!="object")return Nt}throw new TypeError("Cannot convert object to primitive value")}static __toNumeric(e){return JSBI.__isBigInt(e)?e:+e}static __isBigInt(e){return typeof e=="object"&&e!==null&&e.constructor===JSBI}static __truncateToNBits(e,At){const kt=0|(e+29)/30,Bt=new JSBI(kt,At.sign),Nt=kt-1;for(let Lt=0;Lt<Nt;Lt++)Bt.__setDigit(Lt,At.__digit(Lt));let jt=At.__digit(Nt);if(e%30!=0){const Lt=32-e%30;jt=jt<<Lt>>>Lt}return Bt.__setDigit(Nt,jt),Bt.__trim()}static __truncateAndSubFromPowerOfTwo(e,At,kt){var Bt=Math.min;const Nt=0|(e+29)/30,jt=new JSBI(Nt,kt);let Lt=0;const er=Nt-1;let tr=0;for(const ir=Bt(er,At.length);Lt<ir;Lt++){const ar=0-At.__digit(Lt)-tr;tr=1&ar>>>30,jt.__setDigit(Lt,1073741823&ar)}for(;Lt<er;Lt++)jt.__setDigit(Lt,0|1073741823&-tr);let zt=er<At.length?At.__digit(er):0;const rr=e%30;let nr;if(rr==0)nr=0-zt-tr,nr&=1073741823;else{const ir=32-rr;zt=zt<<ir>>>ir;const ar=1<<32-ir;nr=ar-zt-tr,nr&=ar-1}return jt.__setDigit(er,nr),jt.__trim()}__digit(e){return this[e]}__unsignedDigit(e){return this[e]>>>0}__setDigit(e,At){this[e]=0|At}__setDigitGrow(e,At){this[e]=0|At}__halfDigitLength(){const e=this.length;return 32767>=this.__unsignedDigit(e-1)?2*e-1:2*e}__halfDigit(e){return 32767&this[e>>>1]>>>15*(1&e)}__setHalfDigit(e,At){const kt=e>>>1,Bt=this.__digit(kt),Nt=1&e?32767&Bt|At<<15:1073709056&Bt|32767&At;this.__setDigit(kt,Nt)}static __digitPow(e,At){let kt=1;for(;0<At;)1&At&&(kt*=e),At>>>=1,e*=e;return kt}static __isOneDigitInt(e){return(1073741823&e)===e}}JSBI.__kMaxLength=33554432,JSBI.__kMaxLengthBits=JSBI.__kMaxLength<<5,JSBI.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],JSBI.__kBitsPerCharTableShift=5,JSBI.__kBitsPerCharTableMultiplier=1<<JSBI.__kBitsPerCharTableShift,JSBI.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],JSBI.__kBitConversionBuffer=new ArrayBuffer(8),JSBI.__kBitConversionDouble=new Float64Array(JSBI.__kBitConversionBuffer),JSBI.__kBitConversionInts=new Int32Array(JSBI.__kBitConversionBuffer),JSBI.__clz30=Math.clz32?function(xt){return Math.clz32(xt)-2}:function(xt){return xt===0?30:0|29-(0|Math.log(xt>>>0)/Math.LN2)},JSBI.__imul=Math.imul||function(xt,e){return 0|xt*e};const t={};function MakeIntrinsicClass(xt,e){Object.defineProperty(xt.prototype,Symbol.toStringTag,{value:e,writable:!1,enumerable:!1,configurable:!0});for(const At of Object.getOwnPropertyNames(xt)){const kt=Object.getOwnPropertyDescriptor(xt,At);kt.configurable&&kt.enumerable&&(kt.enumerable=!1,Object.defineProperty(xt,At,kt))}for(const At of Object.getOwnPropertyNames(xt.prototype)){const kt=Object.getOwnPropertyDescriptor(xt.prototype,At);kt.configurable&&kt.enumerable&&(kt.enumerable=!1,Object.defineProperty(xt.prototype,At,kt))}DefineIntrinsic(e,xt),DefineIntrinsic(`${e}.prototype`,xt.prototype)}function DefineIntrinsic(xt,e){const At=`%${xt}%`;if(t[At]!==void 0)throw new Error(`intrinsic ${xt} already exists`);t[At]=e}function GetIntrinsic(xt){return t[xt]}var r,o;const n="slot-epochNanoSeconds",a="slot-timezone-identifier",i$1="slot-year",s$1="slot-month",l="slot-day",d$1="slot-hour",m$1="slot-minute",c="slot-second",h$1="slot-millisecond",u="slot-microsecond",T="slot-nanosecond",p="slot-calendar",f$1="slot-date-brand",y$1="slot-year-month-brand",I="slot-month-day-brand",S="slot-cached-instant",g="slot-time-zone",w$1="slot-years",D$1="slot-months",G="slot-weeks",v="slot-days",C="slot-hours",O="slot-minutes",b="slot-seconds",E$2="slot-milliseconds",M="slot-microseconds",R="slot-nanoseconds",F="slot-calendar-identifier",Y=new WeakMap,P$1=Symbol.for("@@Temporal__GetSlots");(r=globalThis)[P$1]||(r[P$1]=function xt(e){return Y.get(e)});const Z=globalThis[P$1],B=Symbol.for("@@Temporal__CreateSlots");(o=globalThis)[B]||(o[B]=function xt(e){Y.set(e,Object.create(null))});const N=globalThis[B];function HasSlot(xt,...e){if(!xt||typeof xt!="object")return!1;const At=Z(xt);return!!At&&e.every(kt=>kt in At)}function GetSlot(xt,e){var kt;const At=(kt=Z(xt))==null?void 0:kt[e];if(At===void 0)throw new TypeError(`Missing internal slot ${e}`);return At}function SetSlot(xt,e,At){const kt=Z(xt);if(kt===void 0)throw new TypeError("Missing slots for the given container");if(kt[e])throw new TypeError(`${e} already has set`);kt[e]=At}const j$1=/\.[-A-Za-z_]|\.\.[-A-Za-z._]{1,12}|\.[-A-Za-z_][-A-Za-z._]{0,12}|[A-Za-z_][-A-Za-z._]{0,13}/,$=new RegExp("(?:"+[`(?:${j$1.source})(?:\\/(?:${j$1.source}))*`,"Etc/GMT(?:0|[-+]\\d{1,2})","GMT[-+]?0","EST5EDT","CST6CDT","MST7MDT","PST8PDT",/(?:[+\u2212-][0-2][0-9](?::?[0-5][0-9](?::?[0-5][0-9](?:[.,]\d{1,9})?)?)?)/.source].join("|")+")"),k=/(?:[+\u2212-]\d{6}|\d{4})/,U=/(?:0[1-9]|1[0-2])/,A=/(?:0[1-9]|[12]\d|3[01])/,L$1=new RegExp(`(${k.source})(?:-(${U.source})-(${A.source})|(${U.source})(${A.source}))`),x=/(\d{2})(?::(\d{2})(?::(\d{2})(?:[.,](\d{1,9}))?)?|(\d{2})(?:(\d{2})(?:[.,](\d{1,9}))?)?)?/,W=/([+\u2212-])([01][0-9]|2[0-3])(?::?([0-5][0-9])(?::?([0-5][0-9])(?:[.,](\d{1,9}))?)?)?/,q=new RegExp(`([zZ])|${W.source}?`),H=/\[(!)?([a-z_][a-z0-9_-]*)=([A-Za-z0-9]+(?:-[A-Za-z0-9]+)*)\]/g,V=new RegExp([`^${L$1.source}`,`(?:(?:T|\\s+)${x.source}(?:${q.source})?)?`,`(?:\\[!?(${$.source})\\])?`,`((?:${H.source})*)$`].join(""),"i"),z=new RegExp([`^T?${x.source}`,`(?:${q.source})?`,`(?:\\[!?${$.source}\\])?`,`((?:${H.source})*)$`].join(""),"i"),_=new RegExp(`^(${k.source})-?(${U.source})(?:\\[!?${$.source}\\])?((?:${H.source})*)$`),J=new RegExp(`^(?:--)?(${U.source})-?(${A.source})(?:\\[!?${$.source}\\])?((?:${H.source})*)$`),K=/(\d+)(?:[.,](\d{1,9}))?/,X=new RegExp(`(?:${K.source}H)?(?:${K.source}M)?(?:${K.source}S)?`),Q=new RegExp(`^([+−-])?P${/(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)W)?(?:(\d+)D)?/.source}(?:T(?!$)${X.source})?$`,"i"),ee=Array.prototype.includes,te=Array.prototype.push,re=globalThis.Intl.DateTimeFormat,oe=Math.min,ne=Math.max,ae=Math.abs,ie=Math.floor,se=Math.sign,le=Math.trunc,de=Number.isNaN,me=Number.isFinite,ce=Number,he=String,ue=Number.MAX_SAFE_INTEGER,Te=Object.create,pe=Object.getOwnPropertyDescriptor,fe=Reflect.apply,ye=Reflect.ownKeys,Ie=JSBI.BigInt(0),Se=JSBI.BigInt(1),ge=JSBI.BigInt(60),we=JSBI.BigInt(24),De=JSBI.BigInt(1e3),Ge=JSBI.BigInt(1e6),ve=JSBI.BigInt(1e9),Ce=JSBI.BigInt(-1),Oe=JSBI.multiply(JSBI.BigInt(3600),ve),be=JSBI.multiply(ge,ve),Ee=JSBI.multiply(Oe,we),Me=JSBI.multiply(JSBI.BigInt(-86400),JSBI.BigInt(1e17)),Re=JSBI.multiply(JSBI.BigInt(86400),JSBI.BigInt(1e17)),Fe=-271821,Ye=275760,Pe=JSBI.multiply(JSBI.BigInt(-388152),JSBI.BigInt(1e13)),Ze=JSBI.multiply(Ee,JSBI.BigInt(3660)),Be=JSBI.multiply(Ee,JSBI.BigInt(366)),Ne=JSBI.multiply(Ee,JSBI.BigInt(14)),je=["iso8601","hebrew","islamic","islamic-umalqura","islamic-tbla","islamic-civil","islamic-rgsa","islamicc","persian","ethiopic","ethioaa","coptic","chinese","dangi","roc","indian","buddhist","japanese","gregory"];function isZero(xt){return JSBI.equal(xt,Ie)}function GetMethod(xt,e){const At=xt[e];if(At!==void 0)return At}function Call(xt,e,At){const kt=arguments.length>2?At:[];return fe(xt,e,kt)}function IsObject(xt){return typeof xt=="object"&&xt!==null||typeof xt=="function"}function ToNumber(xt){if(typeof xt=="bigint")throw new TypeError("Cannot convert BigInt to number");return ce(xt)}function ToIntegerOrInfinity(xt){const e=ToNumber(xt);if(de(e)||e===0)return 0;if(!me(e))return e;const At=ie(ae(e));return At===0?0:se(e)*At}function IsIntegralNumber(xt){if(typeof xt!="number"||de(xt)||!me(xt))return!1;const e=ae(xt);return ie(e)===e}function ToString(xt){if(typeof xt=="symbol")throw new TypeError("Cannot convert a Symbol value to a String");return he(xt)}function ToIntegerWithTruncation(xt){const e=ToNumber(xt);if(e===0)return 0;if(de(e)||!me(e))throw new RangeError("invalid number value");const At=le(e);return At===0?0:At}function ToPositiveIntegerWithTruncation(xt,e){const At=ToIntegerWithTruncation(xt);if(At<=0)throw e!==void 0?new RangeError(`property '${e}' cannot be a a number less than one`):new RangeError("Cannot convert a number less than one to a positive integer");return At}function ToIntegerIfIntegral(xt){const e=ToNumber(xt);if(!me(e))throw new RangeError("infinity is out of range");if(!IsIntegralNumber(e))throw new RangeError(`unsupported fractional value ${xt}`);return e===0?0:e}function divmod(xt,e){return{quotient:JSBI.divide(xt,e),remainder:JSBI.remainder(xt,e)}}function isNegativeJSBI(xt){return JSBI.lessThan(xt,Ie)}function signJSBI(xt){return isZero(xt)?0:isNegativeJSBI(xt)?-1:1}function abs(xt){return JSBI.lessThan(xt,Ie)?JSBI.multiply(xt,Ce):xt}const $e=new Map([["year",ToIntegerWithTruncation],["month",ToPositiveIntegerWithTruncation],["monthCode",ToString],["day",ToPositiveIntegerWithTruncation],["hour",ToIntegerWithTruncation],["minute",ToIntegerWithTruncation],["second",ToIntegerWithTruncation],["millisecond",ToIntegerWithTruncation],["microsecond",ToIntegerWithTruncation],["nanosecond",ToIntegerWithTruncation],["years",ToIntegerIfIntegral],["months",ToIntegerIfIntegral],["weeks",ToIntegerIfIntegral],["days",ToIntegerIfIntegral],["hours",ToIntegerIfIntegral],["minutes",ToIntegerIfIntegral],["seconds",ToIntegerIfIntegral],["milliseconds",ToIntegerIfIntegral],["microseconds",ToIntegerIfIntegral],["nanoseconds",ToIntegerIfIntegral],["era",ToString],["eraYear",ToIntegerOrInfinity],["offset",ToString]]),ke=new Map([["hour",0],["minute",0],["second",0],["millisecond",0],["microsecond",0],["nanosecond",0]]),Ue=[["years","year","date"],["months","month","date"],["weeks","week","date"],["days","day","date"],["hours","hour","time"],["minutes","minute","time"],["seconds","second","time"],["milliseconds","millisecond","time"],["microseconds","microsecond","time"],["nanoseconds","nanosecond","time"]],Ae=new Map(Ue.map(xt=>[xt[0],xt[1]])),Le=new Map(Ue.map(([xt,e])=>[e,xt])),xe=Ue.map(([,xt])=>xt),We=Array.from(Ae.keys()).sort(),qe=new Map;function getIntlDateTimeFormatEnUsForTimeZone(xt){let e=qe.get(xt);return e===void 0&&(e=new re("en-us",{timeZone:he(xt),hour12:!1,era:"short",year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}),qe.set(xt,e)),e}function ToObject(xt){if(xt==null)throw new TypeError(`Expected object not ${xt}`);return Object(xt)}function CopyDataProperties(xt,e,At,kt){if(e==null)return;const Bt=ye(e);for(const Nt of Bt)if(!At.some(jt=>Object.is(jt,Nt))&&Object.prototype.propertyIsEnumerable.call(e,Nt)){const jt=e[Nt];if(kt&&kt.some(Lt=>Object.is(Lt,jt)))continue;xt[Nt]=jt}}function IsTemporalInstant(xt){return HasSlot(xt,n)&&!HasSlot(xt,g,p)}function IsTemporalTimeZone(xt){return HasSlot(xt,a)}function IsTemporalCalendar(xt){return HasSlot(xt,F)}function IsTemporalDuration(xt){return HasSlot(xt,w$1,D$1,v,C,O,b,E$2,M,R)}function IsTemporalDate(xt){return HasSlot(xt,f$1)}function IsTemporalTime(xt){return HasSlot(xt,d$1,m$1,c,h$1,u,T)&&!HasSlot(xt,i$1,s$1,l)}function IsTemporalDateTime(xt){return HasSlot(xt,i$1,s$1,l,d$1,m$1,c,h$1,u,T)}function IsTemporalYearMonth(xt){return HasSlot(xt,y$1)}function IsTemporalMonthDay(xt){return HasSlot(xt,I)}function IsTemporalZonedDateTime(xt){return HasSlot(xt,n,g,p)}function RejectTemporalLikeObject(xt){if(HasSlot(xt,p)||HasSlot(xt,g))throw new TypeError("with() does not support a calendar or timeZone property");if(IsTemporalTime(xt))throw new TypeError("with() does not accept Temporal.PlainTime, use withPlainTime() instead");if(xt.calendar!==void 0)throw new TypeError("with() does not support a calendar property");if(xt.timeZone!==void 0)throw new TypeError("with() does not support a timeZone property")}function ParseTemporalTimeZone(xt){const{ianaName:e,offset:At,z:kt}=function(Nt){if(new RegExp(`^${$.source}$`,"i").test(Nt))return{ianaName:Nt};try{const jt=ParseISODateTime(Nt);if(jt.z||jt.offset||jt.ianaName)return jt}catch{}throw new RangeError(`Invalid time zone: ${Nt}`)}(xt);return e?GetCanonicalTimeZoneIdentifier(e):kt?"UTC":FormatTimeZoneOffsetString(ParseTimeZoneOffsetString(At))}function MaybeFormatCalendarAnnotation(xt,e){return e==="never"?"":FormatCalendarAnnotation(ToTemporalCalendarIdentifier(xt),e)}function FormatCalendarAnnotation(xt,e){return e==="never"||e==="auto"&&xt==="iso8601"?"":`[${e==="critical"?"!":""}u-ca=${xt}]`}function ParseISODateTime(xt){const e=V.exec(xt);if(!e)throw new RangeError(`invalid ISO 8601 string: ${xt}`);let At=e[1];if(At[0]==="−"&&(At=`-${At.slice(1)}`),At==="-000000")throw new RangeError(`invalid ISO 8601 string: ${xt}`);const kt=ToIntegerOrInfinity(At),Bt=ToIntegerOrInfinity(e[2]||e[4]),Nt=ToIntegerOrInfinity(e[3]||e[5]),jt=ToIntegerOrInfinity(e[6]),Lt=e[6]!==void 0,er=ToIntegerOrInfinity(e[7]||e[10]);let tr=ToIntegerOrInfinity(e[8]||e[11]);tr===60&&(tr=59);const zt=(e[9]||e[12])+"000000000",rr=ToIntegerOrInfinity(zt.slice(0,3)),nr=ToIntegerOrInfinity(zt.slice(3,6)),ir=ToIntegerOrInfinity(zt.slice(6,9));let ar,dr=!1;if(e[13])ar=void 0,dr=!0;else if(e[14]&&e[15]){const lr=e[14]==="-"||e[14]==="−"?"-":"+",yr=e[15]||"00",br=e[16]||"00",Ar=e[17]||"00";let Pr=e[18]||"0";if(ar=`${lr}${yr}:${br}`,+Pr){for(;Pr.endsWith("0");)Pr=Pr.slice(0,-1);ar+=`:${Ar}.${Pr}`}else+Ar&&(ar+=`:${Ar}`);ar==="-00:00"&&(ar="+00:00")}const ur=e[19],fr=e[20];let pr;for(const[,lr,yr,br]of fr.matchAll(H))if(yr==="u-ca")pr===void 0&&(pr=br);else if(lr==="!")throw new RangeError(`Unrecognized annotation: !${yr}=${br}`);return RejectDateTime(kt,Bt,Nt,jt,er,tr,rr,nr,ir),{year:kt,month:Bt,day:Nt,hasTime:Lt,hour:jt,minute:er,second:tr,millisecond:rr,microsecond:nr,nanosecond:ir,ianaName:ur,offset:ar,z:dr,calendar:pr}}function ParseTemporalYearMonthString(xt){const e=_.exec(xt);let At,kt,Bt,Nt;if(e){let jt=e[1];if(jt[0]==="−"&&(jt=`-${jt.slice(1)}`),jt==="-000000")throw new RangeError(`invalid ISO 8601 string: ${xt}`);At=ToIntegerOrInfinity(jt),kt=ToIntegerOrInfinity(e[2]);const Lt=e[3];for(const[,er,tr,zt]of Lt.matchAll(H))if(tr==="u-ca")Bt===void 0&&(Bt=zt);else if(er==="!")throw new RangeError(`Unrecognized annotation: !${tr}=${zt}`);if(Bt!==void 0&&Bt!=="iso8601")throw new RangeError("YYYY-MM format is only valid with iso8601 calendar")}else{let jt;if({year:At,month:kt,calendar:Bt,day:Nt,z:jt}=ParseISODateTime(xt),jt)throw new RangeError("Z designator not supported for PlainYearMonth")}return{year:At,month:kt,calendar:Bt,referenceISODay:Nt}}function ParseTemporalMonthDayString(xt){const e=J.exec(xt);let At,kt,Bt,Nt;if(e){At=ToIntegerOrInfinity(e[1]),kt=ToIntegerOrInfinity(e[2]);const jt=e[3];for(const[,Lt,er,tr]of jt.matchAll(H))if(er==="u-ca")Bt===void 0&&(Bt=tr);else if(Lt==="!")throw new RangeError(`Unrecognized annotation: !${er}=${tr}`);if(Bt!==void 0&&Bt!=="iso8601")throw new RangeError("MM-DD format is only valid with iso8601 calendar")}else{let jt;if({month:At,day:kt,calendar:Bt,year:Nt,z:jt}=ParseISODateTime(xt),jt)throw new RangeError("Z designator not supported for PlainMonthDay")}return{month:At,day:kt,calendar:Bt,referenceISOYear:Nt}}function ParseTemporalInstant(xt){let{year:e,month:At,day:kt,hour:Bt,minute:Nt,second:jt,millisecond:Lt,microsecond:er,nanosecond:tr,offset:zt,z:rr}=function(dr){const ur=ParseISODateTime(dr);if(!ur.z&&!ur.offset)throw new RangeError("Temporal.Instant requires a time zone offset");return ur}(xt);if(!rr&&!zt)throw new RangeError("Temporal.Instant requires a time zone offset");const nr=rr?0:ParseTimeZoneOffsetString(zt);({year:e,month:At,day:kt,hour:Bt,minute:Nt,second:jt,millisecond:Lt,microsecond:er,nanosecond:tr}=BalanceISODateTime(e,At,kt,Bt,Nt,jt,Lt,er,tr-nr));const ir=GetUTCEpochNanoseconds(e,At,kt,Bt,Nt,jt,Lt,er,tr);if(ir===null)throw new RangeError("DateTime outside of supported range");return ir}function RegulateISODate(xt,e,At,kt){let Bt=xt,Nt=e,jt=At;switch(kt){case"reject":RejectISODate(Bt,Nt,jt);break;case"constrain":({year:Bt,month:Nt,day:jt}=ConstrainISODate(Bt,Nt,jt))}return{year:Bt,month:Nt,day:jt}}function RegulateTime(xt,e,At,kt,Bt,Nt,jt){let Lt=xt,er=e,tr=At,zt=kt,rr=Bt,nr=Nt;switch(jt){case"reject":RejectTime(Lt,er,tr,zt,rr,nr);break;case"constrain":({hour:Lt,minute:er,second:tr,millisecond:zt,microsecond:rr,nanosecond:nr}=function(ar,dr,ur,fr,pr,lr){const yr=ConstrainToRange(ar,0,23),br=ConstrainToRange(dr,0,59),Ar=ConstrainToRange(ur,0,59),Pr=ConstrainToRange(fr,0,999),kr=ConstrainToRange(pr,0,999),Ur=ConstrainToRange(lr,0,999);return{hour:yr,minute:br,second:Ar,millisecond:Pr,microsecond:kr,nanosecond:Ur}}(Lt,er,tr,zt,rr,nr))}return{hour:Lt,minute:er,second:tr,millisecond:zt,microsecond:rr,nanosecond:nr}}function ToTemporalDurationRecord(xt){if(!IsObject(xt))return function(ar){const dr=Q.exec(ar);if(!dr)throw new RangeError(`invalid duration: ${ar}`);if(dr.slice(2).every(xr=>xr===void 0))throw new RangeError(`invalid duration: ${ar}`);const ur=dr[1]==="-"||dr[1]==="−"?-1:1,fr=dr[2]===void 0?0:ToIntegerWithTruncation(dr[2])*ur,pr=dr[3]===void 0?0:ToIntegerWithTruncation(dr[3])*ur,lr=dr[4]===void 0?0:ToIntegerWithTruncation(dr[4])*ur,yr=dr[5]===void 0?0:ToIntegerWithTruncation(dr[5])*ur,br=dr[6]===void 0?0:ToIntegerWithTruncation(dr[6])*ur,Ar=dr[7],Pr=dr[8],kr=dr[9],Ur=dr[10],Hr=dr[11];let Lr=0,Sr=0,_r=0;if(Ar!==void 0){if(Pr??kr??Ur??Hr)throw new RangeError("only the smallest unit can be fractional");_r=3600*ToIntegerOrInfinity((Ar+"000000000").slice(0,9))*ur}else if(Lr=Pr===void 0?0:ToIntegerWithTruncation(Pr)*ur,kr!==void 0){if(Ur??Hr)throw new RangeError("only the smallest unit can be fractional");_r=60*ToIntegerOrInfinity((kr+"000000000").slice(0,9))*ur}else Sr=Ur===void 0?0:ToIntegerWithTruncation(Ur)*ur,Hr!==void 0&&(_r=ToIntegerOrInfinity((Hr+"000000000").slice(0,9))*ur);const gr=_r%1e3,wr=le(_r/1e3)%1e3,Dr=le(_r/1e6)%1e3;return Sr+=le(_r/1e9)%60,Lr+=le(_r/6e10),RejectDuration(fr,pr,lr,yr,br,Lr,Sr,Dr,wr,gr),{years:fr,months:pr,weeks:lr,days:yr,hours:br,minutes:Lr,seconds:Sr,milliseconds:Dr,microseconds:wr,nanoseconds:gr}}(ToString(xt));if(IsTemporalDuration(xt))return{years:GetSlot(xt,w$1),months:GetSlot(xt,D$1),weeks:GetSlot(xt,G),days:GetSlot(xt,v),hours:GetSlot(xt,C),minutes:GetSlot(xt,O),seconds:GetSlot(xt,b),milliseconds:GetSlot(xt,E$2),microseconds:GetSlot(xt,M),nanoseconds:GetSlot(xt,R)};const e={years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0,milliseconds:0,microseconds:0,nanoseconds:0};let At=function(ar){if(!IsObject(ar))throw new TypeError("invalid duration-like");const dr={years:void 0,months:void 0,weeks:void 0,days:void 0,hours:void 0,minutes:void 0,seconds:void 0,milliseconds:void 0,microseconds:void 0,nanoseconds:void 0};let ur=!1;for(const fr of We){const pr=ar[fr];pr!==void 0&&(ur=!0,dr[fr]=ToIntegerIfIntegral(pr))}if(!ur)throw new TypeError("invalid duration-like");return dr}(xt);for(const ir of We){const ar=At[ir];ar!==void 0&&(e[ir]=ar)}let{years:kt,months:Bt,weeks:Nt,days:jt,hours:Lt,minutes:er,seconds:tr,milliseconds:zt,microseconds:rr,nanoseconds:nr}=e;return RejectDuration(kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr),{years:kt,months:Bt,weeks:Nt,days:jt,hours:Lt,minutes:er,seconds:tr,milliseconds:zt,microseconds:rr,nanoseconds:nr}}function ToTemporalOverflow(xt){return xt===void 0?"constrain":GetOption(xt,"overflow",["constrain","reject"],"constrain")}function ToTemporalDisambiguation(xt){return xt===void 0?"compatible":GetOption(xt,"disambiguation",["compatible","earlier","later","reject"],"compatible")}function ToTemporalRoundingMode(xt,e){return GetOption(xt,"roundingMode",["ceil","floor","expand","trunc","halfCeil","halfFloor","halfExpand","halfTrunc","halfEven"],e)}function ToTemporalOffset(xt,e){return xt===void 0?e:GetOption(xt,"offset",["prefer","use","ignore","reject"],e)}function ToCalendarNameOption(xt){return GetOption(xt,"calendarName",["auto","always","never","critical"],"auto")}function ToTemporalRoundingIncrement(xt){let e=xt.roundingIncrement;if(e===void 0)return 1;if(e=ToNumber(e),!me(e))throw new RangeError("roundingIncrement must be finite");const At=le(e);if(At<1||At>1e9)throw new RangeError(`roundingIncrement must be at least 1 and at most 1e9, not ${e}`);return At}function ValidateTemporalRoundingIncrement(xt,e,At){const kt=At?e:e-1;if(xt>kt)throw new RangeError(`roundingIncrement must be at least 1 and less than ${kt}, not ${xt}`);if(e%xt!=0)throw new RangeError(`Rounding increment must divide evenly into ${e}`)}function ToFractionalSecondDigits(xt){const e=xt.fractionalSecondDigits;if(e===void 0)return"auto";if(typeof e!="number"){if(ToString(e)!=="auto")throw new RangeError(`fractionalSecondDigits must be 'auto' or 0 through 9, not ${e}`);return"auto"}const At=ie(e);if(!me(At)||At<0||At>9)throw new RangeError(`fractionalSecondDigits must be 'auto' or 0 through 9, not ${e}`);return At}function ToSecondsStringPrecisionRecord(xt,e){switch(xt){case"minute":return{precision:"minute",unit:"minute",increment:1};case"second":return{precision:0,unit:"second",increment:1};case"millisecond":return{precision:3,unit:"millisecond",increment:1};case"microsecond":return{precision:6,unit:"microsecond",increment:1};case"nanosecond":return{precision:9,unit:"nanosecond",increment:1}}switch(e){case"auto":return{precision:e,unit:"nanosecond",increment:1};case 0:return{precision:e,unit:"second",increment:1};case 1:case 2:case 3:return{precision:e,unit:"millisecond",increment:10**(3-e)};case 4:case 5:case 6:return{precision:e,unit:"microsecond",increment:10**(6-e)};case 7:case 8:case 9:return{precision:e,unit:"nanosecond",increment:10**(9-e)};default:throw new RangeError(`fractionalSecondDigits must be 'auto' or 0 through 9, not ${e}`)}}const He=Symbol("~required~");function GetTemporalUnit(xt,e,At,kt,Bt=[]){const Nt=[];for(const[,tr,zt]of Ue)At!=="datetime"&&At!==zt||Nt.push(tr);Nt.push(...Bt);let jt=kt;jt===He?jt=void 0:jt!==void 0&&Nt.push(jt);const Lt=[...Nt];for(const tr of Nt){const zt=Le.get(tr);zt!==void 0&&Lt.push(zt)}let er=GetOption(xt,e,Lt,jt);if(er===void 0&&kt===He)throw new RangeError(`${e} is required`);return Ae.has(er)?Ae.get(er):er}function ToRelativeTemporalObject(xt){const e=xt.relativeTo;if(e===void 0)return e;let At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar="option",dr=!1;if(IsObject(e)){if(IsTemporalZonedDateTime(e)||IsTemporalDate(e))return e;if(IsTemporalDateTime(e))return TemporalDateTimeToDate(e);rr=GetTemporalCalendarSlotValueWithISODefault(e);const ur=CalendarFields(rr,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);ur.push("timeZone","offset");const fr=PrepareTemporalFields(e,ur,[]),pr=Te(null);pr.overflow="constrain",{year:At,month:kt,day:Bt,hour:Nt,minute:jt,second:Lt,millisecond:er,microsecond:tr,nanosecond:zt}=InterpretTemporalDateTimeFields(rr,fr,pr),ir=fr.offset,ir===void 0&&(ar="wall"),nr=fr.timeZone,nr!==void 0&&(nr=ToTemporalTimeZoneSlotValue(nr))}else{let ur,fr;if({year:At,month:kt,day:Bt,hour:Nt,minute:jt,second:Lt,millisecond:er,microsecond:tr,nanosecond:zt,calendar:rr,ianaName:ur,offset:ir,z:fr}=ParseISODateTime(ToString(e)),ur)nr=ToTemporalTimeZoneSlotValue(ur),fr?ar="exact":ir||(ar="wall"),dr=!0;else if(fr)throw new RangeError("Z designator not supported for PlainDate relativeTo; either remove the Z or add a bracketed time zone");if(rr||(rr="iso8601"),!IsBuiltinCalendar(rr))throw new RangeError(`invalid calendar identifier ${rr}`);rr=ASCIILowercase(rr)}return nr===void 0?CreateTemporalDate(At,kt,Bt,rr):CreateTemporalZonedDateTime(InterpretISODateTimeOffset(At,kt,Bt,Nt,jt,Lt,er,tr,zt,ar,ar==="option"?ParseTimeZoneOffsetString(ir):0,nr,"compatible","reject",dr),nr,rr)}function DefaultTemporalLargestUnit(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr){for(const[zt,rr]of[["years",xt],["months",e],["weeks",At],["days",kt],["hours",Bt],["minutes",Nt],["seconds",jt],["milliseconds",Lt],["microseconds",er],["nanoseconds",tr]])if(rr!==0)return Ae.get(zt);return"nanosecond"}function LargerOfTwoTemporalUnits(xt,e){return xe.indexOf(xt)>xe.indexOf(e)?e:xt}function PrepareTemporalFields(xt,e,At,{emptySourceErrorMessage:kt}={emptySourceErrorMessage:"no supported properties found"}){const Bt=Te(null);let Nt=!1;e.sort();for(const jt of e){let Lt=xt[jt];if(Lt!==void 0)Nt=!0,$e.has(jt)&&(Lt=$e.get(jt)(Lt)),Bt[jt]=Lt;else if(At!=="partial"){if(ee.call(At,jt))throw new TypeError(`required property '${jt}' missing or undefined`);Lt=ke.get(jt),Bt[jt]=Lt}}if(At==="partial"&&!Nt)throw new TypeError(kt);return Bt}function ToTemporalTimeRecord(xt,e="complete"){const At=["hour","microsecond","millisecond","minute","nanosecond","second"],kt=PrepareTemporalFields(xt,At,"partial",{emptySourceErrorMessage:"invalid time-like"}),Bt={};for(const Nt of At){const jt=pe(kt,Nt);jt!==void 0?Bt[Nt]=jt.value:e==="complete"&&(Bt[Nt]=0)}return Bt}function ToTemporalDate(xt,e){let At=xt;if(IsObject(At)){if(IsTemporalDate(At))return At;if(IsTemporalZonedDateTime(At)&&(ToTemporalOverflow(e),At=GetPlainDateTimeFor(GetSlot(At,g),GetSlot(At,S),GetSlot(At,p))),IsTemporalDateTime(At))return ToTemporalOverflow(e),CreateTemporalDate(GetSlot(At,i$1),GetSlot(At,s$1),GetSlot(At,l),GetSlot(At,p));const er=GetTemporalCalendarSlotValueWithISODefault(At);return CalendarDateFromFields(er,PrepareTemporalFields(At,CalendarFields(er,["day","month","monthCode","year"]),[]),e)}ToTemporalOverflow(e);let{year:kt,month:Bt,day:Nt,calendar:jt,z:Lt}=function(tr){return ParseISODateTime(tr)}(ToString(At));if(Lt)throw new RangeError("Z designator not supported for PlainDate");if(jt||(jt="iso8601"),!IsBuiltinCalendar(jt))throw new RangeError(`invalid calendar identifier ${jt}`);return jt=ASCIILowercase(jt),CreateTemporalDate(kt,Bt,Nt,jt)}function InterpretTemporalDateTimeFields(xt,e,At){let{hour:kt,minute:Bt,second:Nt,millisecond:jt,microsecond:Lt,nanosecond:er}=ToTemporalTimeRecord(e);const tr=ToTemporalOverflow(At),zt=CalendarDateFromFields(xt,e,At),rr=GetSlot(zt,i$1),nr=GetSlot(zt,s$1),ir=GetSlot(zt,l);return{hour:kt,minute:Bt,second:Nt,millisecond:jt,microsecond:Lt,nanosecond:er}=RegulateTime(kt,Bt,Nt,jt,Lt,er,tr),{year:rr,month:nr,day:ir,hour:kt,minute:Bt,second:Nt,millisecond:jt,microsecond:Lt,nanosecond:er}}function ToTemporalDateTime(xt,e){let At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr;if(IsObject(xt)){if(IsTemporalDateTime(xt))return xt;if(IsTemporalZonedDateTime(xt))return ToTemporalOverflow(e),GetPlainDateTimeFor(GetSlot(xt,g),GetSlot(xt,S),GetSlot(xt,p));if(IsTemporalDate(xt))return ToTemporalOverflow(e),CreateTemporalDateTime(GetSlot(xt,i$1),GetSlot(xt,s$1),GetSlot(xt,l),0,0,0,0,0,0,GetSlot(xt,p));rr=GetTemporalCalendarSlotValueWithISODefault(xt);const nr=PrepareTemporalFields(xt,CalendarFields(rr,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]),[]);({year:At,month:kt,day:Bt,hour:Nt,minute:jt,second:Lt,millisecond:er,microsecond:tr,nanosecond:zt}=InterpretTemporalDateTimeFields(rr,nr,e))}else{let nr;if(ToTemporalOverflow(e),{year:At,month:kt,day:Bt,hour:Nt,minute:jt,second:Lt,millisecond:er,microsecond:tr,nanosecond:zt,calendar:rr,z:nr}=function(ar){return ParseISODateTime(ar)}(ToString(xt)),nr)throw new RangeError("Z designator not supported for PlainDateTime");if(RejectDateTime(At,kt,Bt,Nt,jt,Lt,er,tr,zt),rr||(rr="iso8601"),!IsBuiltinCalendar(rr))throw new RangeError(`invalid calendar identifier ${rr}`);rr=ASCIILowercase(rr)}return CreateTemporalDateTime(At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr)}function ToTemporalDuration(xt){if(IsTemporalDuration(xt))return xt;let{years:e,months:At,weeks:kt,days:Bt,hours:Nt,minutes:jt,seconds:Lt,milliseconds:er,microseconds:tr,nanoseconds:zt}=ToTemporalDurationRecord(xt);return new(GetIntrinsic("%Temporal.Duration%"))(e,At,kt,Bt,Nt,jt,Lt,er,tr,zt)}function ToTemporalInstant(xt){if(IsTemporalInstant(xt))return xt;if(IsTemporalZonedDateTime(xt))return new(GetIntrinsic("%Temporal.Instant%"))(GetSlot(xt,n));const e=ParseTemporalInstant(ToString(xt));return new(GetIntrinsic("%Temporal.Instant%"))(e)}function ToTemporalMonthDay(xt,e){let At=xt;if(IsObject(At)){if(IsTemporalMonthDay(At))return At;let Lt,er;if(HasSlot(At,p))Lt=GetSlot(At,p),er=!1;else{let zt=At.calendar;er=zt===void 0,zt===void 0&&(zt="iso8601"),Lt=ToTemporalCalendarSlotValue(zt)}const tr=PrepareTemporalFields(At,CalendarFields(Lt,["day","month","monthCode","year"]),[]);return er&&tr.month!==void 0&&tr.monthCode===void 0&&tr.year===void 0&&(tr.year=1972),CalendarMonthDayFromFields(Lt,tr,e)}ToTemporalOverflow(e);let{month:kt,day:Bt,referenceISOYear:Nt,calendar:jt}=ParseTemporalMonthDayString(ToString(At));if(jt===void 0&&(jt="iso8601"),!IsBuiltinCalendar(jt))throw new RangeError(`invalid calendar identifier ${jt}`);return jt=ASCIILowercase(jt),Nt===void 0?(RejectISODate(1972,kt,Bt),CreateTemporalMonthDay(kt,Bt,jt)):CalendarMonthDayFromFields(jt,CreateTemporalMonthDay(kt,Bt,jt,Nt))}function ToTemporalTime(xt,e="constrain"){let At,kt,Bt,Nt,jt,Lt,er=xt;if(IsObject(er)){if(IsTemporalTime(er))return er;if(IsTemporalZonedDateTime(er)&&(er=GetPlainDateTimeFor(GetSlot(er,g),GetSlot(er,S),GetSlot(er,p))),IsTemporalDateTime(er))return new(GetIntrinsic("%Temporal.PlainTime%"))(GetSlot(er,d$1),GetSlot(er,m$1),GetSlot(er,c),GetSlot(er,h$1),GetSlot(er,u),GetSlot(er,T));({hour:At,minute:kt,second:Bt,millisecond:Nt,microsecond:jt,nanosecond:Lt}=ToTemporalTimeRecord(er)),{hour:At,minute:kt,second:Bt,millisecond:Nt,microsecond:jt,nanosecond:Lt}=RegulateTime(At,kt,Bt,Nt,jt,Lt,e)}else({hour:At,minute:kt,second:Bt,millisecond:Nt,microsecond:jt,nanosecond:Lt}=function(zt){const rr=z.exec(zt);let nr,ir,ar,dr,ur,fr,pr;if(rr){nr=ToIntegerOrInfinity(rr[1]),ir=ToIntegerOrInfinity(rr[2]||rr[5]),ar=ToIntegerOrInfinity(rr[3]||rr[6]),ar===60&&(ar=59);const lr=(rr[4]||rr[7])+"000000000";dr=ToIntegerOrInfinity(lr.slice(0,3)),ur=ToIntegerOrInfinity(lr.slice(3,6)),fr=ToIntegerOrInfinity(lr.slice(6,9)),pr=rr[14];for(const[,yr,br,Ar]of pr.matchAll(H))if(br!=="u-ca"&&yr==="!")throw new RangeError(`Unrecognized annotation: !${br}=${Ar}`);if(rr[8])throw new RangeError("Z designator not supported for PlainTime")}else{let lr,yr;if({hasTime:yr,hour:nr,minute:ir,second:ar,millisecond:dr,microsecond:ur,nanosecond:fr,z:lr}=ParseISODateTime(zt),!yr)throw new RangeError(`time is missing in string: ${zt}`);if(lr)throw new RangeError("Z designator not supported for PlainTime")}if(/[tT ][0-9][0-9]/.test(zt))return{hour:nr,minute:ir,second:ar,millisecond:dr,microsecond:ur,nanosecond:fr};try{const{month:lr,day:yr}=ParseTemporalMonthDayString(zt);RejectISODate(1972,lr,yr)}catch{try{const{year:lr,month:yr}=ParseTemporalYearMonthString(zt);RejectISODate(lr,yr,1)}catch{return{hour:nr,minute:ir,second:ar,millisecond:dr,microsecond:ur,nanosecond:fr}}}throw new RangeError(`invalid ISO 8601 time-only string ${zt}; may need a T prefix`)}(ToString(er))),RejectTime(At,kt,Bt,Nt,jt,Lt);return new(GetIntrinsic("%Temporal.PlainTime%"))(At,kt,Bt,Nt,jt,Lt)}function ToTemporalYearMonth(xt,e){if(IsObject(xt)){if(IsTemporalYearMonth(xt))return xt;const jt=GetTemporalCalendarSlotValueWithISODefault(xt);return CalendarYearMonthFromFields(jt,PrepareTemporalFields(xt,CalendarFields(jt,["month","monthCode","year"]),[]),e)}ToTemporalOverflow(e);let{year:At,month:kt,referenceISODay:Bt,calendar:Nt}=ParseTemporalYearMonthString(ToString(xt));if(Nt===void 0&&(Nt="iso8601"),!IsBuiltinCalendar(Nt))throw new RangeError(`invalid calendar identifier ${Nt}`);return Nt=ASCIILowercase(Nt),Bt===void 0?(RejectISODate(At,kt,1),CreateTemporalYearMonth(At,kt,Nt)):CalendarYearMonthFromFields(Nt,CreateTemporalYearMonth(At,kt,Nt,Bt))}function InterpretISODateTimeOffset(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar){const dr=new(GetIntrinsic("%Temporal.PlainDateTime%"))(xt,e,At,kt,Bt,Nt,jt,Lt,er);if(tr==="wall"||ir==="ignore")return GetSlot(GetInstantFor(rr,dr,nr),n);if(tr==="exact"||ir==="use"){const fr=GetUTCEpochNanoseconds(xt,e,At,kt,Bt,Nt,jt,Lt,er);if(fr===null)throw new RangeError("ZonedDateTime outside of supported range");return JSBI.subtract(fr,JSBI.BigInt(zt))}const ur=GetPossibleInstantsFor(rr,dr);for(const fr of ur){const pr=GetOffsetNanosecondsFor(rr,fr),lr=JSBI.toNumber(RoundNumberToIncrement(JSBI.BigInt(pr),be,"halfExpand"));if(pr===zt||ar&&lr===zt)return GetSlot(fr,n)}if(ir==="reject"){const fr=FormatTimeZoneOffsetString(zt),pr=IsTemporalTimeZone(rr)?GetSlot(rr,a):"time zone";throw new RangeError(`Offset ${fr} is invalid for ${dr.toString()} in ${pr}`)}return GetSlot(DisambiguatePossibleInstants(ur,rr,dr,nr),n)}function ToTemporalZonedDateTime(xt,e){let At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar,dr,ur=!1,fr="option";if(IsObject(xt)){if(IsTemporalZonedDateTime(xt))return xt;ir=GetTemporalCalendarSlotValueWithISODefault(xt);const lr=CalendarFields(ir,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);lr.push("timeZone","offset");const yr=PrepareTemporalFields(xt,lr,["timeZone"]);rr=ToTemporalTimeZoneSlotValue(yr.timeZone),nr=yr.offset,nr===void 0&&(fr="wall"),ar=ToTemporalDisambiguation(e),dr=ToTemporalOffset(e,"reject"),{year:At,month:kt,day:Bt,hour:Nt,minute:jt,second:Lt,millisecond:er,microsecond:tr,nanosecond:zt}=InterpretTemporalDateTimeFields(ir,yr,e)}else{let lr,yr;if({year:At,month:kt,day:Bt,hour:Nt,minute:jt,second:Lt,millisecond:er,microsecond:tr,nanosecond:zt,ianaName:lr,offset:nr,z:yr,calendar:ir}=function(Ar){const Pr=ParseISODateTime(Ar);if(!Pr.ianaName)throw new RangeError("Temporal.ZonedDateTime requires a time zone ID in brackets");return Pr}(ToString(xt)),rr=ToTemporalTimeZoneSlotValue(lr),yr?fr="exact":nr||(fr="wall"),ir||(ir="iso8601"),!IsBuiltinCalendar(ir))throw new RangeError(`invalid calendar identifier ${ir}`);ir=ASCIILowercase(ir),ur=!0,ar=ToTemporalDisambiguation(e),dr=ToTemporalOffset(e,"reject"),ToTemporalOverflow(e)}let pr=0;return fr==="option"&&(pr=ParseTimeZoneOffsetString(nr)),CreateTemporalZonedDateTime(InterpretISODateTimeOffset(At,kt,Bt,Nt,jt,Lt,er,tr,zt,fr,pr,rr,ar,dr,ur),rr,ir)}function CreateTemporalDateSlots(xt,e,At,kt,Bt){RejectISODate(e,At,kt),RejectDateRange(e,At,kt),N(xt),SetSlot(xt,i$1,e),SetSlot(xt,s$1,At),SetSlot(xt,l,kt),SetSlot(xt,p,Bt),SetSlot(xt,f$1,!0)}function CreateTemporalDate(xt,e,At,kt="iso8601"){const Bt=GetIntrinsic("%Temporal.PlainDate%"),Nt=Te(Bt.prototype);return CreateTemporalDateSlots(Nt,xt,e,At,kt),Nt}function CreateTemporalDateTimeSlots(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt){RejectDateTime(e,At,kt,Bt,Nt,jt,Lt,er,tr),RejectDateTimeRange(e,At,kt,Bt,Nt,jt,Lt,er,tr),N(xt),SetSlot(xt,i$1,e),SetSlot(xt,s$1,At),SetSlot(xt,l,kt),SetSlot(xt,d$1,Bt),SetSlot(xt,m$1,Nt),SetSlot(xt,c,jt),SetSlot(xt,h$1,Lt),SetSlot(xt,u,er),SetSlot(xt,T,tr),SetSlot(xt,p,zt)}function CreateTemporalDateTime(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr="iso8601"){const zt=GetIntrinsic("%Temporal.PlainDateTime%"),rr=Te(zt.prototype);return CreateTemporalDateTimeSlots(rr,xt,e,At,kt,Bt,Nt,jt,Lt,er,tr),rr}function CreateTemporalMonthDaySlots(xt,e,At,kt,Bt){RejectISODate(Bt,e,At),RejectDateRange(Bt,e,At),N(xt),SetSlot(xt,s$1,e),SetSlot(xt,l,At),SetSlot(xt,i$1,Bt),SetSlot(xt,p,kt),SetSlot(xt,I,!0)}function CreateTemporalMonthDay(xt,e,At="iso8601",kt=1972){const Bt=GetIntrinsic("%Temporal.PlainMonthDay%"),Nt=Te(Bt.prototype);return CreateTemporalMonthDaySlots(Nt,xt,e,At,kt),Nt}function CreateTemporalYearMonthSlots(xt,e,At,kt,Bt){RejectISODate(e,At,Bt),function(jt,Lt){RejectToRange(jt,Fe,Ye),jt===Fe?RejectToRange(Lt,4,12):jt===Ye&&RejectToRange(Lt,1,9)}(e,At),N(xt),SetSlot(xt,i$1,e),SetSlot(xt,s$1,At),SetSlot(xt,l,Bt),SetSlot(xt,p,kt),SetSlot(xt,y$1,!0)}function CreateTemporalYearMonth(xt,e,At="iso8601",kt=1){const Bt=GetIntrinsic("%Temporal.PlainYearMonth%"),Nt=Te(Bt.prototype);return CreateTemporalYearMonthSlots(Nt,xt,e,At,kt),Nt}function CreateTemporalZonedDateTimeSlots(xt,e,At,kt){ValidateEpochNanoseconds(e),N(xt),SetSlot(xt,n,e),SetSlot(xt,g,At),SetSlot(xt,p,kt);const Bt=new(GetIntrinsic("%Temporal.Instant%"))(GetSlot(xt,n));SetSlot(xt,S,Bt)}function CreateTemporalZonedDateTime(xt,e,At="iso8601"){const kt=GetIntrinsic("%Temporal.ZonedDateTime%"),Bt=Te(kt.prototype);return CreateTemporalZonedDateTimeSlots(Bt,xt,e,At),Bt}function CalendarFields(xt,e){if(typeof xt=="string"){const Bt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.fields%"),Bt,[e])}const At=Call(GetMethod(xt,"fields"),xt,[e]),kt=[];for(const Bt of At){if(typeof Bt!="string")throw new TypeError("bad return from calendar.fields()");te.call(kt,Bt)}return kt}function CalendarMergeFields(xt,e,At){if(typeof xt=="string"){const Bt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.mergeFields%"),Bt,[e,At])}const kt=Call(GetMethod(xt,"mergeFields"),xt,[e,At]);if(!IsObject(kt))throw new TypeError("bad return from calendar.mergeFields()");return kt}function CalendarDateAdd(xt,e,At,kt,Bt){let Nt=Bt;if(typeof xt=="string"){const Lt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.dateAdd%"),Lt,[e,At,kt])}Nt===void 0&&(Nt=GetMethod(xt,"dateAdd"));const jt=fe(Nt,xt,[e,At,kt]);if(!IsTemporalDate(jt))throw new TypeError("invalid result");return jt}function CalendarDateUntil(xt,e,At,kt,Bt){let Nt=Bt;if(typeof xt=="string"){const Lt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.dateUntil%"),Lt,[e,At,kt])}Nt===void 0&&(Nt=GetMethod(xt,"dateUntil"));const jt=fe(Nt,xt,[e,At,kt]);if(!IsTemporalDuration(jt))throw new TypeError("invalid result");return jt}function CalendarYear(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.year%"),kt,[e])}let At=Call(GetMethod(xt,"year"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar year result must be an integer");if(!IsIntegralNumber(At))throw new RangeError("calendar year result must be an integer");return At}function CalendarMonth(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.month%"),kt,[e])}let At=Call(GetMethod(xt,"month"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar month result must be a positive integer");if(!IsIntegralNumber(At)||At<1)throw new RangeError("calendar month result must be a positive integer");return At}function CalendarMonthCode(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.monthCode%"),kt,[e])}let At=Call(GetMethod(xt,"monthCode"),xt,[e]);if(typeof At!="string")throw new TypeError("calendar monthCode result must be a string");return At}function CalendarDay(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.day%"),kt,[e])}const At=Call(GetMethod(xt,"day"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar day result must be a positive integer");if(!IsIntegralNumber(At)||At<1)throw new RangeError("calendar day result must be a positive integer");return At}function CalendarEra(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.era%"),kt,[e])}let At=Call(GetMethod(xt,"era"),xt,[e]);if(At===void 0)return At;if(typeof At!="string")throw new TypeError("calendar era result must be a string or undefined");return At}function CalendarEraYear(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.eraYear%"),kt,[e])}let At=Call(GetMethod(xt,"eraYear"),xt,[e]);if(At===void 0)return At;if(typeof At!="number")throw new TypeError("calendar eraYear result must be an integer or undefined");if(!IsIntegralNumber(At))throw new RangeError("calendar eraYear result must be an integer or undefined");return At}function CalendarDayOfWeek(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.dayOfWeek%"),kt,[e])}const At=Call(GetMethod(xt,"dayOfWeek"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar dayOfWeek result must be a positive integer");if(!IsIntegralNumber(At)||At<1)throw new RangeError("calendar dayOfWeek result must be a positive integer");return At}function CalendarDayOfYear(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.dayOfYear%"),kt,[e])}const At=Call(GetMethod(xt,"dayOfYear"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar dayOfYear result must be a positive integer");if(!IsIntegralNumber(At)||At<1)throw new RangeError("calendar dayOfYear result must be a positive integer");return At}function CalendarWeekOfYear(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.weekOfYear%"),kt,[e])}const At=Call(GetMethod(xt,"weekOfYear"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar weekOfYear result must be a positive integer");if(!IsIntegralNumber(At)||At<1)throw new RangeError("calendar weekOfYear result must be a positive integer");return At}function CalendarYearOfWeek(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.yearOfWeek%"),kt,[e])}const At=Call(GetMethod(xt,"yearOfWeek"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar yearOfWeek result must be an integer");if(!IsIntegralNumber(At))throw new RangeError("calendar yearOfWeek result must be an integer");return At}function CalendarDaysInWeek(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.daysInWeek%"),kt,[e])}const At=Call(GetMethod(xt,"daysInWeek"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar daysInWeek result must be a positive integer");if(!IsIntegralNumber(At)||At<1)throw new RangeError("calendar daysInWeek result must be a positive integer");return At}function CalendarDaysInMonth(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.daysInMonth%"),kt,[e])}const At=Call(GetMethod(xt,"daysInMonth"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar daysInMonth result must be a positive integer");if(!IsIntegralNumber(At)||At<1)throw new RangeError("calendar daysInMonth result must be a positive integer");return At}function CalendarDaysInYear(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.daysInYear%"),kt,[e])}const At=Call(GetMethod(xt,"daysInYear"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar daysInYear result must be a positive integer");if(!IsIntegralNumber(At)||At<1)throw new RangeError("calendar daysInYear result must be a positive integer");return At}function CalendarMonthsInYear(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.monthsInYear%"),kt,[e])}const At=Call(GetMethod(xt,"monthsInYear"),xt,[e]);if(typeof At!="number")throw new TypeError("calendar monthsInYear result must be a positive integer");if(!IsIntegralNumber(At)||At<1)throw new RangeError("calendar monthsInYear result must be a positive integer");return At}function CalendarInLeapYear(xt,e){if(typeof xt=="string"){const kt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.inLeapYear%"),kt,[e])}const At=Call(GetMethod(xt,"inLeapYear"),xt,[e]);if(typeof At!="boolean")throw new TypeError("calendar inLeapYear result must be a boolean");return At}function ToTemporalCalendarSlotValue(xt){if(IsObject(xt)){if(HasSlot(xt,p))return GetSlot(xt,p);if(!function(Bt){return!!IsTemporalCalendar(Bt)||"dateAdd"in Bt&&"dateFromFields"in Bt&&"dateUntil"in Bt&&"day"in Bt&&"dayOfWeek"in Bt&&"dayOfYear"in Bt&&"daysInMonth"in Bt&&"daysInWeek"in Bt&&"daysInYear"in Bt&&"fields"in Bt&&"id"in Bt&&"inLeapYear"in Bt&&"mergeFields"in Bt&&"month"in Bt&&"monthCode"in Bt&&"monthDayFromFields"in Bt&&"monthsInYear"in Bt&&"weekOfYear"in Bt&&"year"in Bt&&"yearMonthFromFields"in Bt&&"yearOfWeek"in Bt}(xt))throw new TypeError("expected a Temporal.Calendar or object implementing the Temporal.Calendar protocol");return xt}const e=ToString(xt);if(IsBuiltinCalendar(e))return ASCIILowercase(e);let At;try{({calendar:At}=ParseISODateTime(e))}catch{try{({calendar:At}=ParseTemporalYearMonthString(e))}catch{({calendar:At}=ParseTemporalMonthDayString(e))}}if(At||(At="iso8601"),!IsBuiltinCalendar(At))throw new RangeError(`invalid calendar identifier ${At}`);return ASCIILowercase(At)}function GetTemporalCalendarSlotValueWithISODefault(xt){if(HasSlot(xt,p))return GetSlot(xt,p);const{calendar:e}=xt;return e===void 0?"iso8601":ToTemporalCalendarSlotValue(e)}function ToTemporalCalendarIdentifier(xt){if(typeof xt=="string")return xt;const e=xt.id;if(typeof e!="string")throw new TypeError("calendar.id should be a string");return e}function ToTemporalCalendarObject(xt){return IsObject(xt)?xt:new(GetIntrinsic("%Temporal.Calendar%"))(xt)}function CalendarEquals(xt,e){return xt===e?!0:ToTemporalCalendarIdentifier(xt)===ToTemporalCalendarIdentifier(e)}function ThrowIfCalendarsNotEqual(xt,e,At){if(xt===e)return;const kt=ToTemporalCalendarIdentifier(xt),Bt=ToTemporalCalendarIdentifier(e);if(kt!==Bt)throw new RangeError(`cannot ${At} of ${kt} and ${Bt} calendars`)}function ConsolidateCalendars(xt,e){if(xt===e)return e;const At=ToTemporalCalendarIdentifier(xt),kt=ToTemporalCalendarIdentifier(e);if(At===kt||At==="iso8601")return e;if(kt==="iso8601")return xt;throw new RangeError("irreconcilable calendars")}function CalendarDateFromFields(xt,e,At,kt){if(typeof xt=="string"){const Nt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.dateFromFields%"),Nt,[e,At])}const Bt=Call(GetMethod(xt,"dateFromFields"),xt,[e,At]);if(!IsTemporalDate(Bt))throw new TypeError("invalid result");return Bt}function CalendarYearMonthFromFields(xt,e,At){if(typeof xt=="string"){const Bt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.yearMonthFromFields%"),Bt,[e,At])}let kt=Call(GetMethod(xt,"yearMonthFromFields"),xt,[e,At]);if(!IsTemporalYearMonth(kt))throw new TypeError("invalid result");return kt}function CalendarMonthDayFromFields(xt,e,At){if(typeof xt=="string"){const Bt=new(GetIntrinsic("%Temporal.Calendar%"))(xt);return Call(GetIntrinsic("%Temporal.Calendar.prototype.monthDayFromFields%"),Bt,[e,At])}let kt=Call(GetMethod(xt,"monthDayFromFields"),xt,[e,At]);if(!IsTemporalMonthDay(kt))throw new TypeError("invalid result");return kt}function ToTemporalTimeZoneSlotValue(xt){if(IsObject(xt)){if(IsTemporalZonedDateTime(xt))return GetSlot(xt,g);if(!function(At){return!!IsTemporalTimeZone(At)||"getOffsetNanosecondsFor"in At&&"getPossibleInstantsFor"in At&&"id"in At}(xt))throw new TypeError("expected a Temporal.TimeZone or object implementing the Temporal.TimeZone protocol");return xt}return ParseTemporalTimeZone(ToString(xt))}function ToTemporalTimeZoneIdentifier(xt){if(typeof xt=="string")return xt;const e=xt.id;if(typeof e!="string")throw new TypeError("timeZone.id should be a string");return e}function ToTemporalTimeZoneObject(xt){return IsObject(xt)?xt:new(GetIntrinsic("%Temporal.TimeZone%"))(xt)}function TimeZoneEquals(xt,e){return xt===e?!0:ToTemporalTimeZoneIdentifier(xt)===ToTemporalTimeZoneIdentifier(e)}function TemporalDateTimeToDate(xt){return CreateTemporalDate(GetSlot(xt,i$1),GetSlot(xt,s$1),GetSlot(xt,l),GetSlot(xt,p))}function TemporalDateTimeToTime(xt){return new(GetIntrinsic("%Temporal.PlainTime%"))(GetSlot(xt,d$1),GetSlot(xt,m$1),GetSlot(xt,c),GetSlot(xt,h$1),GetSlot(xt,u),GetSlot(xt,T))}function GetOffsetNanosecondsFor(xt,e,At){if(typeof xt=="string"){const Bt=new(GetIntrinsic("%Temporal.TimeZone%"))(xt);return Call(GetIntrinsic("%Temporal.TimeZone.prototype.getOffsetNanosecondsFor%"),Bt,[e])}const kt=Call(GetMethod(xt,"getOffsetNanosecondsFor"),xt,[e]);if(typeof kt!="number")throw new TypeError("bad return from getOffsetNanosecondsFor");if(!IsIntegralNumber(kt)||ae(kt)>=864e11)throw new RangeError("out-of-range return from getOffsetNanosecondsFor");return kt}function GetOffsetStringFor(xt,e){return FormatTimeZoneOffsetString(GetOffsetNanosecondsFor(xt,e))}function GetPlainDateTimeFor(xt,e,At){const kt=GetSlot(e,n),Bt=GetOffsetNanosecondsFor(xt,e);let{year:Nt,month:jt,day:Lt,hour:er,minute:tr,second:zt,millisecond:rr,microsecond:nr,nanosecond:ir}=GetISOPartsFromEpoch(kt);return{year:Nt,month:jt,day:Lt,hour:er,minute:tr,second:zt,millisecond:rr,microsecond:nr,nanosecond:ir}=BalanceISODateTime(Nt,jt,Lt,er,tr,zt,rr,nr,ir+Bt),CreateTemporalDateTime(Nt,jt,Lt,er,tr,zt,rr,nr,ir,At)}function GetInstantFor(xt,e,At){return DisambiguatePossibleInstants(GetPossibleInstantsFor(xt,e),xt,e,At)}function DisambiguatePossibleInstants(xt,e,At,kt){const Bt=GetIntrinsic("%Temporal.Instant%"),Nt=xt.length;if(Nt===1)return xt[0];if(Nt)switch(kt){case"compatible":case"earlier":return xt[0];case"later":return xt[Nt-1];case"reject":throw new RangeError("multiple instants found")}const jt=GetSlot(At,i$1),Lt=GetSlot(At,s$1),er=GetSlot(At,l),tr=GetSlot(At,d$1),zt=GetSlot(At,m$1),rr=GetSlot(At,c),nr=GetSlot(At,h$1),ir=GetSlot(At,u),ar=GetSlot(At,T),dr=GetUTCEpochNanoseconds(jt,Lt,er,tr,zt,rr,nr,ir,ar);if(dr===null)throw new RangeError("DateTime outside of supported range");const ur=new Bt(JSBI.subtract(dr,Ee)),fr=new Bt(JSBI.add(dr,Ee)),pr=GetOffsetNanosecondsFor(e,ur),lr=GetOffsetNanosecondsFor(e,fr)-pr;switch(kt){case"earlier":{const yr=GetSlot(At,p),br=GetIntrinsic("%Temporal.PlainDateTime%"),Ar=AddDateTime(jt,Lt,er,tr,zt,rr,nr,ir,ar,yr,0,0,0,0,0,0,0,0,0,-lr,void 0);return GetPossibleInstantsFor(e,new br(Ar.year,Ar.month,Ar.day,Ar.hour,Ar.minute,Ar.second,Ar.millisecond,Ar.microsecond,Ar.nanosecond,yr))[0]}case"compatible":case"later":{const yr=GetSlot(At,p),br=GetIntrinsic("%Temporal.PlainDateTime%"),Ar=AddDateTime(jt,Lt,er,tr,zt,rr,nr,ir,ar,yr,0,0,0,0,0,0,0,0,0,lr,void 0),Pr=GetPossibleInstantsFor(e,new br(Ar.year,Ar.month,Ar.day,Ar.hour,Ar.minute,Ar.second,Ar.millisecond,Ar.microsecond,Ar.nanosecond,yr));return Pr[Pr.length-1]}case"reject":throw new RangeError("no such instant found")}}function GetPossibleInstantsFor(xt,e,At){if(typeof xt=="string"){const Nt=new(GetIntrinsic("%Temporal.TimeZone%"))(xt);return Call(GetIntrinsic("%Temporal.TimeZone.prototype.getPossibleInstantsFor%"),Nt,[e])}const kt=Call(GetMethod(xt,"getPossibleInstantsFor"),xt,[e]),Bt=[];for(const Nt of kt){if(!IsTemporalInstant(Nt))throw new TypeError("bad return from getPossibleInstantsFor");te.call(Bt,Nt)}return Bt}function ISOYearString(xt){let e;return xt<0||xt>9999?e=(xt<0?"-":"+")+`000000${ae(xt)}`.slice(-6):e=`0000${xt}`.slice(-4),e}function ISODateTimePartString(xt){return`00${xt}`.slice(-2)}function FormatSecondsStringPart(xt,e,At,kt,Bt){if(Bt==="minute")return"";const Nt=`:${ISODateTimePartString(xt)}`;let jt,Lt=1e6*e+1e3*At+kt;if(Bt==="auto"){if(Lt===0)return Nt;for(jt=`${Lt}`.padStart(9,"0");jt[jt.length-1]==="0";)jt=jt.slice(0,-1)}else{if(Bt===0)return Nt;jt=`${Lt}`.padStart(9,"0").slice(0,Bt)}return`${Nt}.${jt}`}function TemporalInstantToString(xt,e,At){let kt=e;kt===void 0&&(kt="UTC");const Bt=GetPlainDateTimeFor(kt,xt,"iso8601"),Nt=ISOYearString(GetSlot(Bt,i$1)),jt=ISODateTimePartString(GetSlot(Bt,s$1)),Lt=ISODateTimePartString(GetSlot(Bt,l)),er=ISODateTimePartString(GetSlot(Bt,d$1)),tr=ISODateTimePartString(GetSlot(Bt,m$1)),zt=FormatSecondsStringPart(GetSlot(Bt,c),GetSlot(Bt,h$1),GetSlot(Bt,u),GetSlot(Bt,T),At);let rr="Z";return e!==void 0&&(rr=FormatISOTimeZoneOffsetString(GetOffsetNanosecondsFor(kt,xt))),`${Nt}-${jt}-${Lt}T${er}:${tr}${zt}${rr}`}function TemporalDurationToString(xt,e="auto",At){function kt(Ur){return Ur<=ue?Ur.toString(10):JSBI.BigInt(Ur).toString(10)}const Bt=GetSlot(xt,w$1),Nt=GetSlot(xt,D$1),jt=GetSlot(xt,G),Lt=GetSlot(xt,v),er=GetSlot(xt,C),tr=GetSlot(xt,O);let zt=GetSlot(xt,b),rr=GetSlot(xt,E$2),nr=GetSlot(xt,M),ir=GetSlot(xt,R);const ar=DurationSign(Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir);if(At){const{unit:Ur,increment:Hr,roundingMode:Lr}=At;({seconds:zt,milliseconds:rr,microseconds:nr,nanoseconds:ir}=RoundDuration(0,0,0,0,0,0,zt,rr,nr,ir,Hr,Ur,Lr))}const dr=[];Bt&&dr.push(`${kt(ae(Bt))}Y`),Nt&&dr.push(`${kt(ae(Nt))}M`),jt&&dr.push(`${kt(ae(jt))}W`),Lt&&dr.push(`${kt(ae(Lt))}D`);const ur=[];er&&ur.push(`${kt(ae(er))}H`),tr&&ur.push(`${kt(ae(tr))}M`);const fr=[];let pr,lr,yr,br,Ar=TotalDurationNanoseconds(0,0,0,zt,rr,nr,ir,0);({quotient:Ar,remainder:pr}=divmod(Ar,De)),{quotient:Ar,remainder:lr}=divmod(Ar,De),{quotient:br,remainder:yr}=divmod(Ar,De);const Pr=1e6*ae(JSBI.toNumber(yr))+1e3*ae(JSBI.toNumber(lr))+ae(JSBI.toNumber(pr));let kr;if(e==="auto"){if(Pr!==0)for(kr=`${Pr}`.padStart(9,"0");kr[kr.length-1]==="0";)kr=kr.slice(0,-1)}else e!==0&&(kr=`${Pr}`.padStart(9,"0").slice(0,e));return kr&&fr.unshift(".",kr),JSBI.equal(br,Ie)&&!fr.length&&e==="auto"||fr.unshift(abs(br).toString()),fr.length&&ur.push(`${fr.join("")}S`),ur.length&&ur.unshift("T"),dr.length||ur.length?`${ar<0?"-":""}P${dr.join("")}${ur.join("")}`:"PT0S"}function TemporalDateToString(xt,e="auto"){return`${ISOYearString(GetSlot(xt,i$1))}-${ISODateTimePartString(GetSlot(xt,s$1))}-${ISODateTimePartString(GetSlot(xt,l))}${MaybeFormatCalendarAnnotation(GetSlot(xt,p),e)}`}function TemporalDateTimeToString(xt,e,At="auto",kt){let Bt=GetSlot(xt,i$1),Nt=GetSlot(xt,s$1),jt=GetSlot(xt,l),Lt=GetSlot(xt,d$1),er=GetSlot(xt,m$1),tr=GetSlot(xt,c),zt=GetSlot(xt,h$1),rr=GetSlot(xt,u),nr=GetSlot(xt,T);if(kt){const{unit:ir,increment:ar,roundingMode:dr}=kt;({year:Bt,month:Nt,day:jt,hour:Lt,minute:er,second:tr,millisecond:zt,microsecond:rr,nanosecond:nr}=RoundISODateTime(Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ar,ir,dr))}return`${ISOYearString(Bt)}-${ISODateTimePartString(Nt)}-${ISODateTimePartString(jt)}T${ISODateTimePartString(Lt)}:${ISODateTimePartString(er)}${FormatSecondsStringPart(tr,zt,rr,nr,e)}${MaybeFormatCalendarAnnotation(GetSlot(xt,p),At)}`}function TemporalMonthDayToString(xt,e="auto"){let At=`${ISODateTimePartString(GetSlot(xt,s$1))}-${ISODateTimePartString(GetSlot(xt,l))}`;const kt=ToTemporalCalendarIdentifier(GetSlot(xt,p));(e==="always"||e==="critical"||kt!=="iso8601")&&(At=`${ISOYearString(GetSlot(xt,i$1))}-${At}`);const Bt=FormatCalendarAnnotation(kt,e);return Bt&&(At+=Bt),At}function TemporalYearMonthToString(xt,e="auto"){let At=`${ISOYearString(GetSlot(xt,i$1))}-${ISODateTimePartString(GetSlot(xt,s$1))}`;const kt=ToTemporalCalendarIdentifier(GetSlot(xt,p));(e==="always"||e==="critical"||kt!=="iso8601")&&(At+=`-${ISODateTimePartString(GetSlot(xt,l))}`);const Bt=FormatCalendarAnnotation(kt,e);return Bt&&(At+=Bt),At}function TemporalZonedDateTimeToString(xt,e,At="auto",kt="auto",Bt="auto",Nt){let jt=GetSlot(xt,S);if(Nt){const{unit:zt,increment:rr,roundingMode:nr}=Nt,ir=RoundInstant(GetSlot(xt,n),rr,zt,nr);jt=new(GetIntrinsic("%Temporal.Instant%"))(ir)}const Lt=GetSlot(xt,g),er=GetPlainDateTimeFor(Lt,jt,"iso8601");let tr=`${ISOYearString(GetSlot(er,i$1))}-${ISODateTimePartString(GetSlot(er,s$1))}-${ISODateTimePartString(GetSlot(er,l))}T${ISODateTimePartString(GetSlot(er,d$1))}:${ISODateTimePartString(GetSlot(er,m$1))}${FormatSecondsStringPart(GetSlot(er,c),GetSlot(er,h$1),GetSlot(er,u),GetSlot(er,T),e)}`;return Bt!=="never"&&(tr+=FormatISOTimeZoneOffsetString(GetOffsetNanosecondsFor(Lt,jt))),kt!=="never"&&(tr+=`[${kt==="critical"?"!":""}${ToTemporalTimeZoneIdentifier(Lt)}]`),tr+=MaybeFormatCalendarAnnotation(GetSlot(xt,p),At),tr}function IsTimeZoneOffsetString(xt){return ze.test(he(xt))}function ParseTimeZoneOffsetString(xt){const e=ze.exec(he(xt));if(!e)throw new RangeError(`invalid time zone offset: ${xt}`);return(e[1]==="-"||e[1]==="−"?-1:1)*(1e9*(60*(60*+e[2]+ +(e[3]||0))+ +(e[4]||0))+ +((e[5]||0)+"000000000").slice(0,9))}function GetCanonicalTimeZoneIdentifier(xt){return IsTimeZoneOffsetString(xt)?FormatTimeZoneOffsetString(ParseTimeZoneOffsetString(xt)):getIntlDateTimeFormatEnUsForTimeZone(he(xt)).resolvedOptions().timeZone}function GetNamedTimeZoneOffsetNanoseconds(xt,e){const{year:At,month:kt,day:Bt,hour:Nt,minute:jt,second:Lt,millisecond:er,microsecond:tr,nanosecond:zt}=GetNamedTimeZoneDateTimeParts(xt,e),rr=At%400,nr=(At-rr)/400,ir=JSBI.multiply(JSBI.BigInt(146097),Ee),ar=GetUTCEpochNanoseconds(rr,kt,Bt,Nt,jt,Lt,er,tr,zt),dr=JSBI.add(ar,JSBI.multiply(ir,JSBI.BigInt(nr)));return JSBI.toNumber(JSBI.subtract(dr,e))}function FormatTimeZoneOffsetString(xt){const e=xt<0?"-":"+",At=ae(xt),kt=At%1e9,Bt=ie(At/1e9)%60,Nt=ie(At/6e10)%60,jt=ISODateTimePartString(ie(At/36e11)),Lt=ISODateTimePartString(Nt),er=ISODateTimePartString(Bt);let tr="";if(kt){let zt=`${kt}`.padStart(9,"0");for(;zt[zt.length-1]==="0";)zt=zt.slice(0,-1);tr=`:${er}.${zt}`}else Bt&&(tr=`:${er}`);return`${e}${jt}:${Lt}${tr}`}function FormatISOTimeZoneOffsetString(xt){let e=JSBI.toNumber(RoundNumberToIncrement(JSBI.BigInt(xt),be,"halfExpand"));const At=e<0?"-":"+";e=ae(e);const kt=e/6e10%60;return`${At}${ISODateTimePartString(ie(e/36e11))}:${ISODateTimePartString(kt)}`}function GetUTCEpochNanoseconds(xt,e,At,kt,Bt,Nt,jt,Lt,er){const tr=new Date;tr.setUTCHours(kt,Bt,Nt,jt),tr.setUTCFullYear(xt,e-1,At);const zt=tr.getTime();if(de(zt))return null;let rr=JSBI.multiply(JSBI.BigInt(zt),Ge);return rr=JSBI.add(rr,JSBI.multiply(JSBI.BigInt(Lt),De)),rr=JSBI.add(rr,JSBI.BigInt(er)),JSBI.lessThan(rr,Me)||JSBI.greaterThan(rr,Re)?null:rr}function GetISOPartsFromEpoch(xt){const{quotient:e,remainder:At}=divmod(xt,Ge);let kt=JSBI.toNumber(e),Bt=JSBI.toNumber(At);Bt<0&&(Bt+=1e6,kt-=1);const Nt=ie(Bt/1e3)%1e3,jt=Bt%1e3,Lt=new Date(kt);return{epochMilliseconds:kt,year:Lt.getUTCFullYear(),month:Lt.getUTCMonth()+1,day:Lt.getUTCDate(),hour:Lt.getUTCHours(),minute:Lt.getUTCMinutes(),second:Lt.getUTCSeconds(),millisecond:Lt.getUTCMilliseconds(),microsecond:Nt,nanosecond:jt}}function GetNamedTimeZoneDateTimeParts(xt,e){const{epochMilliseconds:At,millisecond:kt,microsecond:Bt,nanosecond:Nt}=GetISOPartsFromEpoch(e),{year:jt,month:Lt,day:er,hour:tr,minute:zt,second:rr}=function(ir,ar){const dr=getIntlDateTimeFormatEnUsForTimeZone(ir).format(new Date(ar));return function(fr){const pr=fr.split(/[^\w]+/);if(pr.length!==7)throw new RangeError(`expected 7 parts in "${fr}`);const lr=+pr[0],yr=+pr[1];let br=+pr[2];const Ar=pr[3].toUpperCase();if(Ar==="B"||Ar==="BC")br=1-br;else if(Ar!=="A"&&Ar!=="AD")throw new RangeError(`Unknown era ${Ar} in "${fr}`);let Pr=+pr[4];Pr===24&&(Pr=0);const kr=+pr[5],Ur=+pr[6];if(!(me(br)&&me(lr)&&me(yr)&&me(Pr)&&me(kr)&&me(Ur)))throw new RangeError(`Invalid number in "${fr}`);return{year:br,month:lr,day:yr,hour:Pr,minute:kr,second:Ur}}(dr)}(xt,At);return BalanceISODateTime(jt,Lt,er,tr,zt,rr,kt,Bt,Nt)}function maxJSBI(xt,e){return JSBI.lessThan(xt,e)?e:xt}function afterLatestPossibleTzdbRuleChange(){return JSBI.add(Ve(),Ze)}function GetNamedTimeZoneNextTransition(xt,e){if(JSBI.lessThan(e,Pe))return GetNamedTimeZoneNextTransition(xt,Pe);const At=JSBI.add(e,Be),kt=maxJSBI(afterLatestPossibleTzdbRuleChange(),At);let Bt=maxJSBI(Pe,e);const Nt=GetNamedTimeZoneOffsetNanoseconds(xt,Bt);let jt=Bt,Lt=Nt;for(;Nt===Lt&&JSBI.lessThan(JSBI.BigInt(Bt),kt);){if(jt=JSBI.add(Bt,Ne),JSBI.greaterThan(jt,Re))return null;Lt=GetNamedTimeZoneOffsetNanoseconds(xt,jt),Nt===Lt&&(Bt=jt)}return Nt===Lt?null:bisect(er=>GetNamedTimeZoneOffsetNanoseconds(xt,er),Bt,jt,Nt,Lt)}function GetNamedTimeZonePreviousTransition(xt,e){const At=afterLatestPossibleTzdbRuleChange(),kt=JSBI.greaterThan(e,At),Bt=kt?JSBI.subtract(e,Be):Pe;if(xt==="Africa/Casablanca"||xt==="Africa/El_Aaiun"){const tr=GetSlot(ToTemporalInstant("2088-01-01T00Z"),n);if(JSBI.lessThan(tr,e))return GetNamedTimeZonePreviousTransition(xt,tr)}let Nt=JSBI.subtract(e,Se);if(JSBI.lessThan(Nt,Pe))return null;const jt=GetNamedTimeZoneOffsetNanoseconds(xt,Nt);let Lt=Nt,er=jt;for(;jt===er&&JSBI.greaterThan(Nt,Bt);){if(Lt=JSBI.subtract(Nt,Ne),JSBI.lessThan(Lt,Pe))return null;er=GetNamedTimeZoneOffsetNanoseconds(xt,Lt),jt===er&&(Nt=Lt)}if(jt===er){if(kt){const tr=JSBI.subtract(At,Ee);return GetNamedTimeZonePreviousTransition(xt,tr)}return null}return bisect(tr=>GetNamedTimeZoneOffsetNanoseconds(xt,tr),Lt,Nt,er,jt)}function LeapYear(xt){return xt===void 0?!1:xt%4==0&&(xt%100!=0||xt%400==0)}function ISODaysInMonth(xt,e){return{standard:[31,28,31,30,31,30,31,31,30,31,30,31],leapyear:[31,29,31,30,31,30,31,31,30,31,30,31]}[LeapYear(xt)?"leapyear":"standard"][e-1]}function DayOfWeek(xt,e,At){const kt=e+(e<3?10:-2),Bt=xt-(e<3?1:0),Nt=ie(Bt/100),jt=Bt-100*Nt,Lt=(At+ie(2.6*kt-.2)+(jt+ie(jt/4))+(ie(Nt/4)-2*Nt))%7;return Lt+(Lt<=0?7:0)}function DayOfYear(xt,e,At){let kt=At;for(let Bt=e-1;Bt>0;Bt--)kt+=ISODaysInMonth(xt,Bt);return kt}function WeekOfYear(xt,e,At){const kt=DayOfYear(xt,e,At),Bt=DayOfWeek(xt,e,At)||7,Nt=DayOfWeek(xt,1,1),jt=ie((kt-Bt+10)/7);return jt<1?Nt===5||Nt===6&&LeapYear(xt-1)?{week:53,year:xt-1}:{week:52,year:xt-1}:jt===53&&(LeapYear(xt)?366:365)-kt<4-Bt?{week:1,year:xt+1}:{week:jt,year:xt}}function DurationSign(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr){for(const zt of[xt,e,At,kt,Bt,Nt,jt,Lt,er,tr])if(zt!==0)return zt<0?-1:1;return 0}function BalanceISOYearMonth(xt,e){let At=xt,kt=e;if(!me(At)||!me(kt))throw new RangeError("infinity is out of range");return kt-=1,At+=ie(kt/12),kt%=12,kt<0&&(kt+=12),kt+=1,{year:At,month:kt}}function BalanceISODate(xt,e,At){let kt=xt,Bt=e,Nt=At;if(!me(Nt))throw new RangeError("infinity is out of range");({year:kt,month:Bt}=BalanceISOYearMonth(kt,Bt));const jt=146097;if(ae(Nt)>jt){const tr=le(Nt/jt);kt+=400*tr,Nt-=tr*jt}let Lt=0,er=Bt>2?kt:kt-1;for(;Lt=LeapYear(er)?366:365,Nt<-Lt;)kt-=1,er-=1,Nt+=Lt;for(er+=1;Lt=LeapYear(er)?366:365,Nt>Lt;)kt+=1,er+=1,Nt-=Lt;for(;Nt<1;)({year:kt,month:Bt}=BalanceISOYearMonth(kt,Bt-1)),Nt+=ISODaysInMonth(kt,Bt);for(;Nt>ISODaysInMonth(kt,Bt);)Nt-=ISODaysInMonth(kt,Bt),{year:kt,month:Bt}=BalanceISOYearMonth(kt,Bt+1);return{year:kt,month:Bt,day:Nt}}function BalanceISODateTime(xt,e,At,kt,Bt,Nt,jt,Lt,er){const{deltaDays:tr,hour:zt,minute:rr,second:nr,millisecond:ir,microsecond:ar,nanosecond:dr}=BalanceTime(kt,Bt,Nt,jt,Lt,er),{year:ur,month:fr,day:pr}=BalanceISODate(xt,e,At+tr);return{year:ur,month:fr,day:pr,hour:zt,minute:rr,second:nr,millisecond:ir,microsecond:ar,nanosecond:dr}}function BalanceTime(xt,e,At,kt,Bt,Nt){let jt,Lt=JSBI.BigInt(xt),er=JSBI.BigInt(e),tr=JSBI.BigInt(At),zt=JSBI.BigInt(kt),rr=JSBI.BigInt(Bt),nr=JSBI.BigInt(Nt);return{quotient:jt,remainder:nr}=NonNegativeBigIntDivmod(nr,De),rr=JSBI.add(rr,jt),{quotient:jt,remainder:rr}=NonNegativeBigIntDivmod(rr,De),zt=JSBI.add(zt,jt),{quotient:jt,remainder:zt}=NonNegativeBigIntDivmod(zt,De),tr=JSBI.add(tr,jt),{quotient:jt,remainder:tr}=NonNegativeBigIntDivmod(tr,ge),er=JSBI.add(er,jt),{quotient:jt,remainder:er}=NonNegativeBigIntDivmod(er,ge),Lt=JSBI.add(Lt,jt),{quotient:jt,remainder:Lt}=NonNegativeBigIntDivmod(Lt,we),{deltaDays:JSBI.toNumber(jt),hour:JSBI.toNumber(Lt),minute:JSBI.toNumber(er),second:JSBI.toNumber(tr),millisecond:JSBI.toNumber(zt),microsecond:JSBI.toNumber(rr),nanosecond:JSBI.toNumber(nr)}}function TotalDurationNanoseconds(xt,e,At,kt,Bt,Nt,jt,Lt){const er=JSBI.BigInt(xt);let tr=JSBI.BigInt(jt);xt!==0&&(tr=JSBI.subtract(JSBI.BigInt(jt),JSBI.BigInt(Lt)));const zt=JSBI.add(JSBI.BigInt(e),JSBI.multiply(er,JSBI.BigInt(24))),rr=JSBI.add(JSBI.BigInt(At),JSBI.multiply(zt,ge)),nr=JSBI.add(JSBI.BigInt(kt),JSBI.multiply(rr,ge)),ir=JSBI.add(JSBI.BigInt(Bt),JSBI.multiply(nr,De)),ar=JSBI.add(JSBI.BigInt(Nt),JSBI.multiply(ir,De));return JSBI.add(JSBI.BigInt(tr),JSBI.multiply(ar,De))}function NanosecondsToDays(xt,e){const At=GetIntrinsic("%Temporal.Instant%"),kt=se(JSBI.toNumber(xt));let Bt=JSBI.BigInt(xt),Nt=864e11;if(kt===0)return{days:0,nanoseconds:Ie,dayLengthNs:Nt};if(!IsTemporalZonedDateTime(e)){let lr;return{quotient:lr,remainder:Bt}=divmod(Bt,JSBI.BigInt(Nt)),{days:JSBI.toNumber(lr),nanoseconds:Bt,dayLengthNs:Nt}}const jt=GetSlot(e,n),Lt=GetSlot(e,S),er=JSBI.add(jt,Bt),tr=new At(er),zt=GetSlot(e,g),rr=GetSlot(e,p),nr=GetPlainDateTimeFor(zt,Lt,rr),ir=GetPlainDateTimeFor(zt,tr,rr);let{days:ar}=DifferenceISODateTime(GetSlot(nr,i$1),GetSlot(nr,s$1),GetSlot(nr,l),GetSlot(nr,d$1),GetSlot(nr,m$1),GetSlot(nr,c),GetSlot(nr,h$1),GetSlot(nr,u),GetSlot(nr,T),GetSlot(ir,i$1),GetSlot(ir,s$1),GetSlot(ir,l),GetSlot(ir,d$1),GetSlot(ir,m$1),GetSlot(ir,c),GetSlot(ir,h$1),GetSlot(ir,u),GetSlot(ir,T),rr,"day",Te(null)),dr=AddZonedDateTime(Lt,zt,rr,0,0,0,ar,0,0,0,0,0,0),ur=JSBI.BigInt(ar);if(kt===1)for(;JSBI.greaterThan(ur,Ie)&&JSBI.greaterThan(dr,er);)ur=JSBI.subtract(ur,Se),dr=AddZonedDateTime(Lt,zt,rr,0,0,0,JSBI.toNumber(ur),0,0,0,0,0,0);Bt=JSBI.subtract(er,dr);let fr=!1,pr=new At(dr);do{const lr=AddZonedDateTime(pr,zt,rr,0,0,0,kt,0,0,0,0,0,0),yr=GetSlot(pr,n);Nt=JSBI.toNumber(JSBI.subtract(lr,yr)),fr=JSBI.greaterThanOrEqual(JSBI.multiply(JSBI.subtract(Bt,JSBI.BigInt(Nt)),JSBI.BigInt(kt)),Ie),fr&&(Bt=JSBI.subtract(Bt,JSBI.BigInt(Nt)),pr=new At(lr),ur=JSBI.add(ur,JSBI.BigInt(kt)))}while(fr);if(!isZero(ur)&&signJSBI(ur)!==kt)throw new RangeError("Time zone or calendar converted nanoseconds into a number of days with the opposite sign");if(!isZero(Bt)&&signJSBI(Bt)!==kt)throw isNegativeJSBI(Bt)&&kt===1?new Error("assert not reached"):new RangeError("Time zone or calendar ended up with a remainder of nanoseconds with the opposite sign");if(JSBI.greaterThanOrEqual(abs(Bt),abs(JSBI.BigInt(Nt))))throw new Error("assert not reached");return{days:JSBI.toNumber(ur),nanoseconds:Bt,dayLengthNs:ae(Nt)}}function BalanceDuration(xt,e,At,kt,Bt,Nt,jt,Lt,er){let tr=BalancePossiblyInfiniteDuration(xt,e,At,kt,Bt,Nt,jt,Lt,er);if(tr==="positive overflow"||tr==="negative overflow")throw new RangeError("Duration out of range");return tr}function BalancePossiblyInfiniteDuration(xt,e,At,kt,Bt,Nt,jt,Lt,er){let tr,zt,rr,nr,ir,ar,dr=xt;if(IsTemporalZonedDateTime(er)){const Pr=AddZonedDateTime(GetSlot(er,S),GetSlot(er,g),GetSlot(er,p),0,0,0,dr,e,At,kt,Bt,Nt,jt),kr=GetSlot(er,n);tr=JSBI.subtract(Pr,kr)}else tr=TotalDurationNanoseconds(dr,e,At,kt,Bt,Nt,jt,0);Lt==="year"||Lt==="month"||Lt==="week"||Lt==="day"?{days:dr,nanoseconds:tr}=NanosecondsToDays(tr,er):dr=0;const ur=JSBI.lessThan(tr,Ie)?-1:1;switch(tr=abs(tr),zt=rr=nr=ir=ar=Ie,Lt){case"year":case"month":case"week":case"day":case"hour":({quotient:zt,remainder:tr}=divmod(tr,De)),{quotient:rr,remainder:zt}=divmod(zt,De),{quotient:nr,remainder:rr}=divmod(rr,De),{quotient:ir,remainder:nr}=divmod(nr,ge),{quotient:ar,remainder:ir}=divmod(ir,ge);break;case"minute":({quotient:zt,remainder:tr}=divmod(tr,De)),{quotient:rr,remainder:zt}=divmod(zt,De),{quotient:nr,remainder:rr}=divmod(rr,De),{quotient:ir,remainder:nr}=divmod(nr,ge);break;case"second":({quotient:zt,remainder:tr}=divmod(tr,De)),{quotient:rr,remainder:zt}=divmod(zt,De),{quotient:nr,remainder:rr}=divmod(rr,De);break;case"millisecond":({quotient:zt,remainder:tr}=divmod(tr,De)),{quotient:rr,remainder:zt}=divmod(zt,De);break;case"microsecond":({quotient:zt,remainder:tr}=divmod(tr,De));break;case"nanosecond":break;default:throw new Error("assert not reached")}const fr=JSBI.toNumber(ar)*ur,pr=JSBI.toNumber(ir)*ur,lr=JSBI.toNumber(nr)*ur,yr=JSBI.toNumber(rr)*ur,br=JSBI.toNumber(zt)*ur,Ar=JSBI.toNumber(tr)*ur;for(const Pr of[dr,fr,pr,lr,yr,br,Ar])if(!me(Pr))return ur===1?"positive overflow":"negative overflow";return{days:dr,hours:fr,minutes:pr,seconds:lr,milliseconds:yr,microseconds:br,nanoseconds:Ar}}function UnbalanceDurationRelative(xt,e,At,kt,Bt,Nt){const jt=GetIntrinsic("%Temporal.Duration%"),Lt=DurationSign(xt,e,At,kt,0,0,0,0,0,0);if(Lt===0)return{years:xt,months:e,weeks:At,days:kt};const er=JSBI.BigInt(Lt);let tr,zt,rr=JSBI.BigInt(xt),nr=JSBI.BigInt(e),ir=JSBI.BigInt(At),ar=JSBI.BigInt(kt);Nt&&(zt=ToTemporalDate(Nt),tr=GetSlot(zt,p));const dr=new jt(Lt),ur=new jt(0,Lt),fr=new jt(0,0,Lt);switch(Bt){case"year":break;case"month":{if(!tr)throw new RangeError("a starting point is required for months balancing");let pr,lr;for(typeof tr!="string"&&(pr=GetMethod(tr,"dateAdd"),lr=GetMethod(tr,"dateUntil"));!isZero(rr);){const yr=CalendarDateAdd(tr,zt,dr,void 0,pr),br=Te(null);br.largestUnit="month";const Ar=CalendarDateUntil(tr,zt,yr,br,lr),Pr=JSBI.BigInt(GetSlot(Ar,D$1));zt=yr,nr=JSBI.add(nr,Pr),rr=JSBI.subtract(rr,er)}}break;case"week":{if(!tr)throw new RangeError("a starting point is required for weeks balancing");const pr=typeof tr!="string"?GetMethod(tr,"dateAdd"):void 0;for(;!isZero(rr);){let lr;({relativeTo:zt,days:lr}=MoveRelativeDate(tr,zt,dr,pr)),ar=JSBI.add(ar,JSBI.BigInt(lr)),rr=JSBI.subtract(rr,er)}for(;!isZero(nr);){let lr;({relativeTo:zt,days:lr}=MoveRelativeDate(tr,zt,ur,pr)),ar=JSBI.add(ar,JSBI.BigInt(lr)),nr=JSBI.subtract(nr,er)}break}default:{if(isZero(rr)&&isZero(nr)&&isZero(ir))break;if(!tr)throw new RangeError("a starting point is required for balancing calendar units");const pr=typeof tr!="string"?GetMethod(tr,"dateAdd"):void 0;for(;!isZero(rr);){let lr;({relativeTo:zt,days:lr}=MoveRelativeDate(tr,zt,dr,pr)),ar=JSBI.add(ar,JSBI.BigInt(lr)),rr=JSBI.subtract(rr,er)}for(;!isZero(nr);){let lr;({relativeTo:zt,days:lr}=MoveRelativeDate(tr,zt,ur,pr)),ar=JSBI.add(ar,JSBI.BigInt(lr)),nr=JSBI.subtract(nr,er)}for(;!isZero(ir);){let lr;({relativeTo:zt,days:lr}=MoveRelativeDate(tr,zt,fr,pr)),ar=JSBI.add(ar,JSBI.BigInt(lr)),ir=JSBI.subtract(ir,er)}break}}return{years:JSBI.toNumber(rr),months:JSBI.toNumber(nr),weeks:JSBI.toNumber(ir),days:JSBI.toNumber(ar)}}function CalculateOffsetShift(xt,e,At,kt,Bt){if(IsTemporalZonedDateTime(xt)){const Nt=GetSlot(xt,S),jt=GetSlot(xt,g),Lt=GetSlot(xt,p),er=GetOffsetNanosecondsFor(jt,Nt),tr=AddZonedDateTime(Nt,jt,Lt,e,At,kt,Bt,0,0,0,0,0,0);return GetOffsetNanosecondsFor(jt,new(GetIntrinsic("%Temporal.Instant%"))(tr))-er}return 0}function CreateNegatedTemporalDuration(xt){return new(GetIntrinsic("%Temporal.Duration%"))(-GetSlot(xt,w$1),-GetSlot(xt,D$1),-GetSlot(xt,G),-GetSlot(xt,v),-GetSlot(xt,C),-GetSlot(xt,O),-GetSlot(xt,b),-GetSlot(xt,E$2),-GetSlot(xt,M),-GetSlot(xt,R))}function ConstrainToRange(xt,e,At){return oe(At,ne(e,xt))}function ConstrainISODate(xt,e,At){const kt=ConstrainToRange(e,1,12);return{year:xt,month:kt,day:ConstrainToRange(At,1,ISODaysInMonth(xt,kt))}}function RejectToRange(xt,e,At){if(xt<e||xt>At)throw new RangeError(`value out of range: ${e} <= ${xt} <= ${At}`)}function RejectISODate(xt,e,At){RejectToRange(e,1,12),RejectToRange(At,1,ISODaysInMonth(xt,e))}function RejectDateRange(xt,e,At){RejectDateTimeRange(xt,e,At,12,0,0,0,0,0)}function RejectTime(xt,e,At,kt,Bt,Nt){RejectToRange(xt,0,23),RejectToRange(e,0,59),RejectToRange(At,0,59),RejectToRange(kt,0,999),RejectToRange(Bt,0,999),RejectToRange(Nt,0,999)}function RejectDateTime(xt,e,At,kt,Bt,Nt,jt,Lt,er){RejectISODate(xt,e,At),RejectTime(kt,Bt,Nt,jt,Lt,er)}function RejectDateTimeRange(xt,e,At,kt,Bt,Nt,jt,Lt,er){if(RejectToRange(xt,Fe,Ye),xt===Fe&&GetUTCEpochNanoseconds(xt,e,At+1,kt,Bt,Nt,jt,Lt,er-1)==null||xt===Ye&&GetUTCEpochNanoseconds(xt,e,At-1,kt,Bt,Nt,jt,Lt,er+1)==null)throw new RangeError("DateTime outside of supported range")}function ValidateEpochNanoseconds(xt){if(JSBI.lessThan(xt,Me)||JSBI.greaterThan(xt,Re))throw new RangeError("Instant outside of supported range")}function RejectDuration(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr){const zt=DurationSign(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr);for(const rr of[xt,e,At,kt,Bt,Nt,jt,Lt,er,tr]){if(!me(rr))throw new RangeError("infinite values not allowed as duration fields");const nr=se(rr);if(nr!==0&&nr!==zt)throw new RangeError("mixed-sign values not allowed as duration fields")}}function DifferenceISODate(xt,e,At,kt,Bt,Nt,jt){switch(jt){case"year":case"month":{const Lt=-CompareISODate(xt,e,At,kt,Bt,Nt);if(Lt===0)return{years:0,months:0,weeks:0,days:0};const er={year:xt,month:e,day:At},tr={year:kt,month:Bt,day:Nt};let zt=tr.year-er.year,rr=AddISODate(xt,e,At,zt,0,0,0,"constrain"),nr=-CompareISODate(rr.year,rr.month,rr.day,kt,Bt,Nt);if(nr===0)return jt==="year"?{years:zt,months:0,weeks:0,days:0}:{years:0,months:12*zt,weeks:0,days:0};let ir=tr.month-er.month;if(nr!==Lt&&(zt-=Lt,ir+=12*Lt),rr=AddISODate(xt,e,At,zt,ir,0,0,"constrain"),nr=-CompareISODate(rr.year,rr.month,rr.day,kt,Bt,Nt),nr===0)return jt==="year"?{years:zt,months:ir,weeks:0,days:0}:{years:0,months:ir+12*zt,weeks:0,days:0};nr!==Lt&&(ir-=Lt,ir===-Lt&&(zt-=Lt,ir=11*Lt),rr=AddISODate(xt,e,At,zt,ir,0,0,"constrain"));let ar=0;return ar=rr.month===tr.month?tr.day-rr.day:Lt<0?-rr.day-(ISODaysInMonth(tr.year,tr.month)-tr.day):tr.day+(ISODaysInMonth(rr.year,rr.month)-rr.day),jt==="month"&&(ir+=12*zt,zt=0),{years:zt,months:ir,weeks:0,days:ar}}case"week":case"day":{let Lt,er,tr;CompareISODate(xt,e,At,kt,Bt,Nt)<0?(er={year:xt,month:e,day:At},Lt={year:kt,month:Bt,day:Nt},tr=1):(er={year:kt,month:Bt,day:Nt},Lt={year:xt,month:e,day:At},tr=-1);let zt=DayOfYear(Lt.year,Lt.month,Lt.day)-DayOfYear(er.year,er.month,er.day);for(let nr=er.year;nr<Lt.year;++nr)zt+=LeapYear(nr)?366:365;let rr=0;return jt==="week"&&(rr=ie(zt/7),zt%=7),rr*=tr,zt*=tr,{years:0,months:0,weeks:rr,days:zt}}default:throw new Error("assert not reached")}}function DifferenceTime(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr){let nr=jt-xt,ir=Lt-e,ar=er-At,dr=tr-kt,ur=zt-Bt,fr=rr-Nt;const pr=DurationSign(0,0,0,0,nr,ir,ar,dr,ur,fr);nr*=pr,ir*=pr,ar*=pr,dr*=pr,ur*=pr,fr*=pr;let lr=0;if({deltaDays:lr,hour:nr,minute:ir,second:ar,millisecond:dr,microsecond:ur,nanosecond:fr}=BalanceTime(nr,ir,ar,dr,ur,fr),lr!=0)throw new Error("assertion failure in DifferenceTime: _bt_.[[Days]] should be 0");return nr*=pr,ir*=pr,ar*=pr,dr*=pr,ur*=pr,fr*=pr,{hours:nr,minutes:ir,seconds:ar,milliseconds:dr,microseconds:ur,nanoseconds:fr}}function DifferenceInstant(xt,e,At,kt,Bt,Nt){const jt=JSBI.subtract(e,xt);let Lt=0,er=0,tr=JSBI.toNumber(JSBI.remainder(jt,De)),zt=JSBI.toNumber(JSBI.remainder(JSBI.divide(jt,De),De)),rr=JSBI.toNumber(JSBI.remainder(JSBI.divide(jt,Ge),De)),nr=JSBI.toNumber(JSBI.divide(jt,ve));return{hours:Lt,minutes:er,seconds:nr,milliseconds:rr,microseconds:zt,nanoseconds:tr}=RoundDuration(0,0,0,0,0,0,nr,rr,zt,tr,At,kt,Nt),BalanceDuration(0,Lt,er,nr,rr,zt,tr,Bt)}function DifferenceISODateTime(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar,dr,ur,fr,pr,lr,yr){let br=xt,Ar=e,Pr=At,{hours:kr,minutes:Ur,seconds:Hr,milliseconds:Lr,microseconds:Sr,nanoseconds:_r}=DifferenceTime(kt,Bt,Nt,jt,Lt,er,nr,ir,ar,dr,ur,fr);const gr=DurationSign(0,0,0,0,kr,Ur,Hr,Lr,Sr,_r);CompareISODate(tr,zt,rr,br,Ar,Pr)===-gr&&({year:br,month:Ar,day:Pr}=BalanceISODate(br,Ar,Pr-gr),{hours:kr,minutes:Ur,seconds:Hr,milliseconds:Lr,microseconds:Sr,nanoseconds:_r}=BalanceDuration(-gr,kr,Ur,Hr,Lr,Sr,_r,lr));const wr=CreateTemporalDate(br,Ar,Pr,pr),Dr=CreateTemporalDate(tr,zt,rr,pr),xr=LargerOfTwoTemporalUnits("day",lr),Ir=CopyOptions(yr);Ir.largestUnit=xr;let{years:$r,months:vr,weeks:Er,days:Tr}=CalendarDateUntil(pr,wr,Dr,Ir);return{days:Tr,hours:kr,minutes:Ur,seconds:Hr,milliseconds:Lr,microseconds:Sr,nanoseconds:_r}=BalanceDuration(Tr,kr,Ur,Hr,Lr,Sr,_r,lr),{years:$r,months:vr,weeks:Er,days:Tr,hours:kr,minutes:Ur,seconds:Hr,milliseconds:Lr,microseconds:Sr,nanoseconds:_r}}function DifferenceZonedDateTime(xt,e,At,kt,Bt,Nt){const jt=JSBI.subtract(e,xt);if(JSBI.equal(jt,Ie))return{years:0,months:0,weeks:0,days:0,hours:0,minutes:0,seconds:0,milliseconds:0,microseconds:0,nanoseconds:0};const Lt=GetIntrinsic("%Temporal.Instant%"),er=new Lt(xt),tr=new Lt(e),zt=GetPlainDateTimeFor(At,er,kt),rr=GetPlainDateTimeFor(At,tr,kt);let{years:nr,months:ir,weeks:ar,days:dr}=DifferenceISODateTime(GetSlot(zt,i$1),GetSlot(zt,s$1),GetSlot(zt,l),GetSlot(zt,d$1),GetSlot(zt,m$1),GetSlot(zt,c),GetSlot(zt,h$1),GetSlot(zt,u),GetSlot(zt,T),GetSlot(rr,i$1),GetSlot(rr,s$1),GetSlot(rr,l),GetSlot(rr,d$1),GetSlot(rr,m$1),GetSlot(rr,c),GetSlot(rr,h$1),GetSlot(rr,u),GetSlot(rr,T),kt,Bt,Nt);const ur=AddZonedDateTime(er,At,kt,nr,ir,ar,0,0,0,0,0,0,0);let fr=JSBI.subtract(e,ur);const pr=CreateTemporalZonedDateTime(ur,At,kt);({nanoseconds:fr,days:dr}=NanosecondsToDays(fr,pr));const{hours:lr,minutes:yr,seconds:br,milliseconds:Ar,microseconds:Pr,nanoseconds:kr}=BalanceDuration(0,0,0,0,0,0,JSBI.toNumber(fr),"hour");return{years:nr,months:ir,weeks:ar,days:dr,hours:lr,minutes:yr,seconds:br,milliseconds:Ar,microseconds:Pr,nanoseconds:kr}}function GetDifferenceSettings(xt,e,At,kt,Bt,Nt){const jt=Ue.reduce((ir,ar)=>{const dr=ar[0],ur=ar[1],fr=ar[2];return At!=="datetime"&&fr!==At||kt.includes(ur)||ir.push(ur,dr),ir},[]);let Lt=GetTemporalUnit(e,"largestUnit",At,"auto");if(kt.includes(Lt))throw new RangeError(`largestUnit must be one of ${jt.join(", ")}, not ${Lt}`);const er=ToTemporalRoundingIncrement(e);let tr=ToTemporalRoundingMode(e,"trunc");xt==="since"&&(tr=function(ar){switch(ar){case"ceil":return"floor";case"floor":return"ceil";case"halfCeil":return"halfFloor";case"halfFloor":return"halfCeil";default:return ar}}(tr));const zt=GetTemporalUnit(e,"smallestUnit",At,Bt);if(kt.includes(zt))throw new RangeError(`smallestUnit must be one of ${jt.join(", ")}, not ${zt}`);const rr=LargerOfTwoTemporalUnits(Nt,zt);if(Lt==="auto"&&(Lt=rr),LargerOfTwoTemporalUnits(Lt,zt)!==Lt)throw new RangeError(`largestUnit ${Lt} cannot be smaller than smallestUnit ${zt}`);const nr={hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[zt];return nr!==void 0&&ValidateTemporalRoundingIncrement(er,nr,!1),{largestUnit:Lt,roundingIncrement:er,roundingMode:tr,smallestUnit:zt}}function DifferenceTemporalInstant(xt,e,At,kt){const Bt=xt==="since"?-1:1,Nt=ToTemporalInstant(At),jt=GetDifferenceSettings(xt,CopyOptions(kt),"time",[],"nanosecond","second"),Lt=GetSlot(e,n),er=GetSlot(Nt,n);let{hours:tr,minutes:zt,seconds:rr,milliseconds:nr,microseconds:ir,nanoseconds:ar}=DifferenceInstant(Lt,er,jt.roundingIncrement,jt.smallestUnit,jt.largestUnit,jt.roundingMode);return new(GetIntrinsic("%Temporal.Duration%"))(0,0,0,0,Bt*tr,Bt*zt,Bt*rr,Bt*nr,Bt*ir,Bt*ar)}function DifferenceTemporalPlainDate(xt,e,At,kt){const Bt=xt==="since"?-1:1,Nt=ToTemporalDate(At),jt=GetSlot(e,p);ThrowIfCalendarsNotEqual(jt,GetSlot(Nt,p),"compute difference between dates");const Lt=CopyOptions(kt),er=GetDifferenceSettings(xt,Lt,"date",[],"day","day");Lt.largestUnit=er.largestUnit;let{years:tr,months:zt,weeks:rr,days:nr}=CalendarDateUntil(jt,e,Nt,Lt);return er.smallestUnit==="day"&&er.roundingIncrement===1||({years:tr,months:zt,weeks:rr,days:nr}=RoundDuration(tr,zt,rr,nr,0,0,0,0,0,0,er.roundingIncrement,er.smallestUnit,er.roundingMode,e)),new(GetIntrinsic("%Temporal.Duration%"))(Bt*tr,Bt*zt,Bt*rr,Bt*nr,0,0,0,0,0,0)}function DifferenceTemporalPlainDateTime(xt,e,At,kt){const Bt=xt==="since"?-1:1,Nt=ToTemporalDateTime(At),jt=GetSlot(e,p);ThrowIfCalendarsNotEqual(jt,GetSlot(Nt,p),"compute difference between dates");const Lt=CopyOptions(kt),er=GetDifferenceSettings(xt,Lt,"datetime",[],"nanosecond","day");let{years:tr,months:zt,weeks:rr,days:nr,hours:ir,minutes:ar,seconds:dr,milliseconds:ur,microseconds:fr,nanoseconds:pr}=DifferenceISODateTime(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T),GetSlot(Nt,i$1),GetSlot(Nt,s$1),GetSlot(Nt,l),GetSlot(Nt,d$1),GetSlot(Nt,m$1),GetSlot(Nt,c),GetSlot(Nt,h$1),GetSlot(Nt,u),GetSlot(Nt,T),jt,er.largestUnit,Lt);const lr=TemporalDateTimeToDate(e);return{years:tr,months:zt,weeks:rr,days:nr,hours:ir,minutes:ar,seconds:dr,milliseconds:ur,microseconds:fr,nanoseconds:pr}=RoundDuration(tr,zt,rr,nr,ir,ar,dr,ur,fr,pr,er.roundingIncrement,er.smallestUnit,er.roundingMode,lr),{days:nr,hours:ir,minutes:ar,seconds:dr,milliseconds:ur,microseconds:fr,nanoseconds:pr}=BalanceDuration(nr,ir,ar,dr,ur,fr,pr,er.largestUnit),new(GetIntrinsic("%Temporal.Duration%"))(Bt*tr,Bt*zt,Bt*rr,Bt*nr,Bt*ir,Bt*ar,Bt*dr,Bt*ur,Bt*fr,Bt*pr)}function DifferenceTemporalPlainTime(xt,e,At,kt){const Bt=xt==="since"?-1:1,Nt=ToTemporalTime(At),jt=GetDifferenceSettings(xt,CopyOptions(kt),"time",[],"nanosecond","hour");let{hours:Lt,minutes:er,seconds:tr,milliseconds:zt,microseconds:rr,nanoseconds:nr}=DifferenceTime(GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T),GetSlot(Nt,d$1),GetSlot(Nt,m$1),GetSlot(Nt,c),GetSlot(Nt,h$1),GetSlot(Nt,u),GetSlot(Nt,T));return{hours:Lt,minutes:er,seconds:tr,milliseconds:zt,microseconds:rr,nanoseconds:nr}=RoundDuration(0,0,0,0,Lt,er,tr,zt,rr,nr,jt.roundingIncrement,jt.smallestUnit,jt.roundingMode),{hours:Lt,minutes:er,seconds:tr,milliseconds:zt,microseconds:rr,nanoseconds:nr}=BalanceDuration(0,Lt,er,tr,zt,rr,nr,jt.largestUnit),new(GetIntrinsic("%Temporal.Duration%"))(0,0,0,0,Bt*Lt,Bt*er,Bt*tr,Bt*zt,Bt*rr,Bt*nr)}function DifferenceTemporalPlainYearMonth(xt,e,At,kt){const Bt=xt==="since"?-1:1,Nt=ToTemporalYearMonth(At),jt=GetSlot(e,p);ThrowIfCalendarsNotEqual(jt,GetSlot(Nt,p),"compute difference between months");const Lt=CopyOptions(kt),er=GetDifferenceSettings(xt,Lt,"date",["week","day"],"month","year");Lt.largestUnit=er.largestUnit;const tr=CalendarFields(jt,["monthCode","year"]),zt=PrepareTemporalFields(e,tr,[]);zt.day=1;const rr=CalendarDateFromFields(jt,zt),nr=PrepareTemporalFields(Nt,tr,[]);nr.day=1;const ir=CalendarDateFromFields(jt,nr);let{years:ar,months:dr}=CalendarDateUntil(jt,rr,ir,Lt);return er.smallestUnit==="month"&&er.roundingIncrement===1||({years:ar,months:dr}=RoundDuration(ar,dr,0,0,0,0,0,0,0,0,er.roundingIncrement,er.smallestUnit,er.roundingMode,rr)),new(GetIntrinsic("%Temporal.Duration%"))(Bt*ar,Bt*dr,0,0,0,0,0,0,0,0)}function DifferenceTemporalZonedDateTime(xt,e,At,kt){const Bt=xt==="since"?-1:1,Nt=ToTemporalZonedDateTime(At),jt=GetSlot(e,p);ThrowIfCalendarsNotEqual(jt,GetSlot(Nt,p),"compute difference between dates");const Lt=CopyOptions(kt),er=GetDifferenceSettings(xt,Lt,"datetime",[],"nanosecond","hour");Lt.largestUnit=er.largestUnit;const tr=GetSlot(e,n),zt=GetSlot(Nt,n);let rr,nr,ir,ar,dr,ur,fr,pr,lr,yr;if(er.largestUnit!=="year"&&er.largestUnit!=="month"&&er.largestUnit!=="week"&&er.largestUnit!=="day")rr=0,nr=0,ir=0,ar=0,{hours:dr,minutes:ur,seconds:fr,milliseconds:pr,microseconds:lr,nanoseconds:yr}=DifferenceInstant(tr,zt,er.roundingIncrement,er.smallestUnit,er.largestUnit,er.roundingMode);else{const br=GetSlot(e,g);if(!TimeZoneEquals(br,GetSlot(Nt,g)))throw new RangeError("When calculating difference between time zones, largestUnit must be 'hours' or smaller because day lengths can vary between time zones due to DST or time zone offset changes.");({years:rr,months:nr,weeks:ir,days:ar,hours:dr,minutes:ur,seconds:fr,milliseconds:pr,microseconds:lr,nanoseconds:yr}=DifferenceZonedDateTime(tr,zt,br,jt,er.largestUnit,Lt)),{years:rr,months:nr,weeks:ir,days:ar,hours:dr,minutes:ur,seconds:fr,milliseconds:pr,microseconds:lr,nanoseconds:yr}=RoundDuration(rr,nr,ir,ar,dr,ur,fr,pr,lr,yr,er.roundingIncrement,er.smallestUnit,er.roundingMode,e),{years:rr,months:nr,weeks:ir,days:ar,hours:dr,minutes:ur,seconds:fr,milliseconds:pr,microseconds:lr,nanoseconds:yr}=AdjustRoundedDurationDays(rr,nr,ir,ar,dr,ur,fr,pr,lr,yr,er.roundingIncrement,er.smallestUnit,er.roundingMode,e)}return new(GetIntrinsic("%Temporal.Duration%"))(Bt*rr,Bt*nr,Bt*ir,Bt*ar,Bt*dr,Bt*ur,Bt*fr,Bt*pr,Bt*lr,Bt*yr)}function AddISODate(xt,e,At,kt,Bt,Nt,jt,Lt){let er=xt,tr=e,zt=At,rr=Nt,nr=jt;return er+=kt,tr+=Bt,{year:er,month:tr}=BalanceISOYearMonth(er,tr),{year:er,month:tr,day:zt}=RegulateISODate(er,tr,zt,Lt),nr+=7*rr,zt+=nr,{year:er,month:tr,day:zt}=BalanceISODate(er,tr,zt),{year:er,month:tr,day:zt}}function AddTime(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr){let nr=xt,ir=e,ar=At,dr=kt,ur=Bt,fr=Nt;nr+=jt,ir+=Lt,ar+=er,dr+=tr,ur+=zt,fr+=rr;let pr=0;return{deltaDays:pr,hour:nr,minute:ir,second:ar,millisecond:dr,microsecond:ur,nanosecond:fr}=BalanceTime(nr,ir,ar,dr,ur,fr),{deltaDays:pr,hour:nr,minute:ir,second:ar,millisecond:dr,microsecond:ur,nanosecond:fr}}function AddDuration(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar,dr,ur,fr,pr,lr,yr){const br=LargerOfTwoTemporalUnits(DefaultTemporalLargestUnit(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr),DefaultTemporalLargestUnit(zt,rr,nr,ir,ar,dr,ur,fr,pr,lr));let Ar,Pr,kr,Ur,Hr,Lr,Sr,_r,gr,wr;if(yr)if(IsTemporalDate(yr)){const Dr=GetIntrinsic("%Temporal.Duration%"),xr=GetSlot(yr,p),Ir=new Dr(xt,e,At,kt,0,0,0,0,0,0),$r=new Dr(zt,rr,nr,ir,0,0,0,0,0,0),vr=typeof xr!="string"?GetMethod(xr,"dateAdd"):void 0,Er=CalendarDateAdd(xr,yr,Ir,void 0,vr),Tr=CalendarDateAdd(xr,Er,$r,void 0,vr),Rr=LargerOfTwoTemporalUnits("day",br),Mr=Te(null);Mr.largestUnit=Rr,{years:Ar,months:Pr,weeks:kr,days:Ur}=CalendarDateUntil(xr,yr,Tr,Mr),{days:Ur,hours:Hr,minutes:Lr,seconds:Sr,milliseconds:_r,microseconds:gr,nanoseconds:wr}=BalanceDuration(Ur,JSBI.add(JSBI.BigInt(Bt),JSBI.BigInt(ar)),JSBI.add(JSBI.BigInt(Nt),JSBI.BigInt(dr)),JSBI.add(JSBI.BigInt(jt),JSBI.BigInt(ur)),JSBI.add(JSBI.BigInt(Lt),JSBI.BigInt(fr)),JSBI.add(JSBI.BigInt(er),JSBI.BigInt(pr)),JSBI.add(JSBI.BigInt(tr),JSBI.BigInt(lr)),br)}else{const Dr=GetIntrinsic("%Temporal.Instant%"),xr=GetSlot(yr,g),Ir=GetSlot(yr,p),$r=AddZonedDateTime(GetSlot(yr,S),xr,Ir,xt,e,At,kt,Bt,Nt,jt,Lt,er,tr),vr=AddZonedDateTime(new Dr($r),xr,Ir,zt,rr,nr,ir,ar,dr,ur,fr,pr,lr);br!=="year"&&br!=="month"&&br!=="week"&&br!=="day"?(Ar=0,Pr=0,kr=0,Ur=0,{hours:Hr,minutes:Lr,seconds:Sr,milliseconds:_r,microseconds:gr,nanoseconds:wr}=DifferenceInstant(GetSlot(yr,n),vr,1,"nanosecond",br,"halfExpand")):{years:Ar,months:Pr,weeks:kr,days:Ur,hours:Hr,minutes:Lr,seconds:Sr,milliseconds:_r,microseconds:gr,nanoseconds:wr}=DifferenceZonedDateTime(GetSlot(yr,n),vr,xr,Ir,br,Te(null))}else{if(br==="year"||br==="month"||br==="week")throw new RangeError("relativeTo is required for years, months, or weeks arithmetic");Ar=Pr=kr=0,{days:Ur,hours:Hr,minutes:Lr,seconds:Sr,milliseconds:_r,microseconds:gr,nanoseconds:wr}=BalanceDuration(kt+ir,JSBI.add(JSBI.BigInt(Bt),JSBI.BigInt(ar)),JSBI.add(JSBI.BigInt(Nt),JSBI.BigInt(dr)),JSBI.add(JSBI.BigInt(jt),JSBI.BigInt(ur)),JSBI.add(JSBI.BigInt(Lt),JSBI.BigInt(fr)),JSBI.add(JSBI.BigInt(er),JSBI.BigInt(pr)),JSBI.add(JSBI.BigInt(tr),JSBI.BigInt(lr)),br)}return RejectDuration(Ar,Pr,kr,Ur,Hr,Lr,Sr,_r,gr,wr),{years:Ar,months:Pr,weeks:kr,days:Ur,hours:Hr,minutes:Lr,seconds:Sr,milliseconds:_r,microseconds:gr,nanoseconds:wr}}function AddInstant(xt,e,At,kt,Bt,Nt,jt){let Lt=Ie;Lt=JSBI.add(Lt,JSBI.BigInt(jt)),Lt=JSBI.add(Lt,JSBI.multiply(JSBI.BigInt(Nt),De)),Lt=JSBI.add(Lt,JSBI.multiply(JSBI.BigInt(Bt),Ge)),Lt=JSBI.add(Lt,JSBI.multiply(JSBI.BigInt(kt),ve)),Lt=JSBI.add(Lt,JSBI.multiply(JSBI.BigInt(At),JSBI.BigInt(6e10))),Lt=JSBI.add(Lt,JSBI.multiply(JSBI.BigInt(e),JSBI.BigInt(36e11)));const er=JSBI.add(xt,Lt);return ValidateEpochNanoseconds(er),er}function AddDateTime(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar,dr,ur,fr,pr,lr,yr){let br=ir,{deltaDays:Ar,hour:Pr,minute:kr,second:Ur,millisecond:Hr,microsecond:Lr,nanosecond:Sr}=AddTime(kt,Bt,Nt,jt,Lt,er,ar,dr,ur,fr,pr,lr);br+=Ar;const _r=GetIntrinsic("%Temporal.Duration%"),gr=CalendarDateAdd(tr,CreateTemporalDate(xt,e,At,tr),new _r(zt,rr,nr,br,0,0,0,0,0,0),yr);return{year:GetSlot(gr,i$1),month:GetSlot(gr,s$1),day:GetSlot(gr,l),hour:Pr,minute:kr,second:Ur,millisecond:Hr,microsecond:Lr,nanosecond:Sr}}function AddZonedDateTime(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir){const ar=GetIntrinsic("%Temporal.Duration%");if(DurationSign(kt,Bt,Nt,jt,0,0,0,0,0,0)===0)return AddInstant(GetSlot(xt,n),Lt,er,tr,zt,rr,nr);const dr=GetPlainDateTimeFor(e,xt,At),ur=CalendarDateAdd(At,CreateTemporalDate(GetSlot(dr,i$1),GetSlot(dr,s$1),GetSlot(dr,l),At),new ar(kt,Bt,Nt,jt,0,0,0,0,0,0),ir),fr=CreateTemporalDateTime(GetSlot(ur,i$1),GetSlot(ur,s$1),GetSlot(ur,l),GetSlot(dr,d$1),GetSlot(dr,m$1),GetSlot(dr,c),GetSlot(dr,h$1),GetSlot(dr,u),GetSlot(dr,T),At);return AddInstant(GetSlot(GetInstantFor(e,fr,"compatible"),n),Lt,er,tr,zt,rr,nr)}function AddDurationToOrSubtractDurationFromDuration(xt,e,At,kt){const Bt=xt==="subtract"?-1:1;let{years:Nt,months:jt,weeks:Lt,days:er,hours:tr,minutes:zt,seconds:rr,milliseconds:nr,microseconds:ir,nanoseconds:ar}=ToTemporalDurationRecord(At);const dr=ToRelativeTemporalObject(GetOptionsObject(kt));return{years:Nt,months:jt,weeks:Lt,days:er,hours:tr,minutes:zt,seconds:rr,milliseconds:nr,microseconds:ir,nanoseconds:ar}=AddDuration(GetSlot(e,w$1),GetSlot(e,D$1),GetSlot(e,G),GetSlot(e,v),GetSlot(e,C),GetSlot(e,O),GetSlot(e,b),GetSlot(e,E$2),GetSlot(e,M),GetSlot(e,R),Bt*Nt,Bt*jt,Bt*Lt,Bt*er,Bt*tr,Bt*zt,Bt*rr,Bt*nr,Bt*ir,Bt*ar,dr),new(GetIntrinsic("%Temporal.Duration%"))(Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar)}function AddDurationToOrSubtractDurationFromInstant(xt,e,At){const kt=xt==="subtract"?-1:1,{hours:Bt,minutes:Nt,seconds:jt,milliseconds:Lt,microseconds:er,nanoseconds:tr}=function(nr,ir){let ar=ToTemporalDurationRecord(nr);for(const dr of ir)if(ar[dr]!==0)throw new RangeError(`Duration field ${dr} not supported by Temporal.Instant. Try Temporal.ZonedDateTime instead.`);return ar}(At,["years","months","weeks","days"]),zt=AddInstant(GetSlot(e,n),kt*Bt,kt*Nt,kt*jt,kt*Lt,kt*er,kt*tr);return new(GetIntrinsic("%Temporal.Instant%"))(zt)}function AddDurationToOrSubtractDurationFromPlainDateTime(xt,e,At,kt){const Bt=xt==="subtract"?-1:1,{years:Nt,months:jt,weeks:Lt,days:er,hours:tr,minutes:zt,seconds:rr,milliseconds:nr,microseconds:ir,nanoseconds:ar}=ToTemporalDurationRecord(At),dr=GetOptionsObject(kt),ur=GetSlot(e,p),{year:fr,month:pr,day:lr,hour:yr,minute:br,second:Ar,millisecond:Pr,microsecond:kr,nanosecond:Ur}=AddDateTime(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T),ur,Bt*Nt,Bt*jt,Bt*Lt,Bt*er,Bt*tr,Bt*zt,Bt*rr,Bt*nr,Bt*ir,Bt*ar,dr);return CreateTemporalDateTime(fr,pr,lr,yr,br,Ar,Pr,kr,Ur,ur)}function AddDurationToOrSubtractDurationFromPlainTime(xt,e,At){const kt=xt==="subtract"?-1:1,{hours:Bt,minutes:Nt,seconds:jt,milliseconds:Lt,microseconds:er,nanoseconds:tr}=ToTemporalDurationRecord(At);let{hour:zt,minute:rr,second:nr,millisecond:ir,microsecond:ar,nanosecond:dr}=AddTime(GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T),kt*Bt,kt*Nt,kt*jt,kt*Lt,kt*er,kt*tr);return{hour:zt,minute:rr,second:nr,millisecond:ir,microsecond:ar,nanosecond:dr}=RegulateTime(zt,rr,nr,ir,ar,dr,"reject"),new(GetIntrinsic("%Temporal.PlainTime%"))(zt,rr,nr,ir,ar,dr)}function AddDurationToOrSubtractDurationFromPlainYearMonth(xt,e,At,kt){let Bt=ToTemporalDurationRecord(At);xt==="subtract"&&(Bt={years:-Bt.years,months:-Bt.months,weeks:-Bt.weeks,days:-Bt.days,hours:-Bt.hours,minutes:-Bt.minutes,seconds:-Bt.seconds,milliseconds:-Bt.milliseconds,microseconds:-Bt.microseconds,nanoseconds:-Bt.nanoseconds});let{years:Nt,months:jt,weeks:Lt,days:er,hours:tr,minutes:zt,seconds:rr,milliseconds:nr,microseconds:ir,nanoseconds:ar}=Bt;({days:er}=BalanceDuration(er,tr,zt,rr,nr,ir,ar,"day"));const dr=GetOptionsObject(kt),ur=GetSlot(e,p),fr=CalendarFields(ur,["monthCode","year"]),pr=PrepareTemporalFields(e,fr,[]),lr=Te(null);CopyDataProperties(lr,pr,[]),pr.day=1;let yr=CalendarDateFromFields(ur,pr);const br=DurationSign(Nt,jt,Lt,er,0,0,0,0,0,0),Ar=GetMethod(ur,"dateAdd"),Pr=GetIntrinsic("%Temporal.Duration%");if(br<0){const Hr=CalendarDateAdd(ur,yr,new Pr(0,1,0,0,0,0,0,0,0,0),void 0,Ar),Lr=CalendarDateAdd(ur,Hr,new Pr(0,0,0,-1,0,0,0,0,0,0),void 0,Ar);lr.day=CalendarDay(ur,Lr),yr=CalendarDateFromFields(ur,lr)}const kr=new Pr(Nt,jt,Lt,er,0,0,0,0,0,0),Ur=CopyOptions(dr);return CalendarYearMonthFromFields(ur,PrepareTemporalFields(CalendarDateAdd(ur,yr,kr,dr,Ar),fr,[]),Ur)}function AddDurationToOrSubtractDurationFromZonedDateTime(xt,e,At,kt){const Bt=xt==="subtract"?-1:1,{years:Nt,months:jt,weeks:Lt,days:er,hours:tr,minutes:zt,seconds:rr,milliseconds:nr,microseconds:ir,nanoseconds:ar}=ToTemporalDurationRecord(At),dr=GetOptionsObject(kt),ur=GetSlot(e,g),fr=GetSlot(e,p);return CreateTemporalZonedDateTime(AddZonedDateTime(GetSlot(e,S),ur,fr,Bt*Nt,Bt*jt,Bt*Lt,Bt*er,Bt*tr,Bt*zt,Bt*rr,Bt*nr,Bt*ir,Bt*ar,dr),ur,fr)}function RoundNumberToIncrement(xt,e,At){if(JSBI.equal(e,Se))return xt;let{quotient:kt,remainder:Bt}=divmod(xt,e);if(JSBI.equal(Bt,Ie))return xt;const Nt=JSBI.lessThan(Bt,Ie)?-1:1,jt=abs(JSBI.multiply(Bt,JSBI.BigInt(2))),Lt=JSBI.equal(jt,e),er=JSBI.greaterThan(jt,e);switch(At){case"ceil":Nt>0&&(kt=JSBI.add(kt,JSBI.BigInt(Nt)));break;case"floor":Nt<0&&(kt=JSBI.add(kt,JSBI.BigInt(Nt)));break;case"expand":kt=JSBI.add(kt,JSBI.BigInt(Nt));break;case"trunc":break;case"halfCeil":(er||Lt&&Nt>0)&&(kt=JSBI.add(kt,JSBI.BigInt(Nt)));break;case"halfFloor":(er||Lt&&Nt<0)&&(kt=JSBI.add(kt,JSBI.BigInt(Nt)));break;case"halfExpand":(er||Lt)&&(kt=JSBI.add(kt,JSBI.BigInt(Nt)));break;case"halfTrunc":er&&(kt=JSBI.add(kt,JSBI.BigInt(Nt)));break;case"halfEven":(er||Lt&&JSBI.toNumber(JSBI.remainder(abs(kt),JSBI.BigInt(2)))===1)&&(kt=JSBI.add(kt,JSBI.BigInt(Nt)))}return JSBI.multiply(kt,e)}function RoundInstant(xt,e,At,kt){let{remainder:Bt}=NonNegativeBigIntDivmod(xt,Ee);const Nt=JSBI.subtract(xt,Bt),jt=RoundNumberToIncrement(Bt,JSBI.BigInt(_e[At]*e),kt);return JSBI.add(Nt,jt)}function RoundISODateTime(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr=864e11){const{deltaDays:ir,hour:ar,minute:dr,second:ur,millisecond:fr,microsecond:pr,nanosecond:lr}=RoundTime(kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr),{year:yr,month:br,day:Ar}=BalanceISODate(xt,e,At+ir);return{year:yr,month:br,day:Ar,hour:ar,minute:dr,second:ur,millisecond:fr,microsecond:pr,nanosecond:lr}}function RoundTime(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr=864e11){let zt=Ie;switch(Lt){case"day":case"hour":zt=JSBI.BigInt(xt);case"minute":zt=JSBI.add(JSBI.multiply(zt,ge),JSBI.BigInt(e));case"second":zt=JSBI.add(JSBI.multiply(zt,ge),JSBI.BigInt(At));case"millisecond":zt=JSBI.add(JSBI.multiply(zt,De),JSBI.BigInt(kt));case"microsecond":zt=JSBI.add(JSBI.multiply(zt,De),JSBI.BigInt(Bt));case"nanosecond":zt=JSBI.add(JSBI.multiply(zt,De),JSBI.BigInt(Nt))}const rr=Lt==="day"?tr:_e[Lt],nr=RoundNumberToIncrement(zt,JSBI.BigInt(rr*jt),er),ir=JSBI.toNumber(JSBI.divide(nr,JSBI.BigInt(rr)));switch(Lt){case"day":return{deltaDays:ir,hour:0,minute:0,second:0,millisecond:0,microsecond:0,nanosecond:0};case"hour":return BalanceTime(ir,0,0,0,0,0);case"minute":return BalanceTime(xt,ir,0,0,0,0);case"second":return BalanceTime(xt,e,ir,0,0,0);case"millisecond":return BalanceTime(xt,e,At,ir,0,0);case"microsecond":return BalanceTime(xt,e,At,kt,ir,0);case"nanosecond":return BalanceTime(xt,e,At,kt,Bt,ir);default:throw new Error(`Invalid unit ${Lt}`)}}function DaysUntil(xt,e){return DifferenceISODate(GetSlot(xt,i$1),GetSlot(xt,s$1),GetSlot(xt,l),GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),"day").days}function MoveRelativeDate(xt,e,At,kt){const Bt=CalendarDateAdd(xt,e,At,void 0,kt);return{relativeTo:Bt,days:DaysUntil(e,Bt)}}function MoveRelativeZonedDateTime(xt,e,At,kt,Bt){const Nt=GetSlot(xt,g),jt=GetSlot(xt,p);return CreateTemporalZonedDateTime(AddZonedDateTime(GetSlot(xt,S),Nt,jt,e,At,kt,Bt,0,0,0,0,0,0),Nt,jt)}function AdjustRoundedDurationDays(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir){let ar=xt,dr=e,ur=At,fr=kt,pr=Bt,lr=Nt,yr=jt,br=Lt,Ar=er,Pr=tr;if(!IsTemporalZonedDateTime(ir)||rr==="year"||rr==="month"||rr==="week"||rr==="day"||rr==="nanosecond"&&zt===1)return{years:ar,months:dr,weeks:ur,days:fr,hours:pr,minutes:lr,seconds:yr,milliseconds:br,microseconds:Ar,nanoseconds:Pr};let kr=TotalDurationNanoseconds(0,pr,lr,yr,br,Ar,Pr,0);const Ur=se(JSBI.toNumber(kr)),Hr=GetSlot(ir,g),Lr=GetSlot(ir,p),Sr=AddZonedDateTime(GetSlot(ir,S),Hr,Lr,ar,dr,ur,fr,0,0,0,0,0,0),_r=AddZonedDateTime(new(GetIntrinsic("%Temporal.Instant%"))(Sr),Hr,Lr,0,0,0,Ur,0,0,0,0,0,0),gr=JSBI.subtract(_r,Sr);return JSBI.greaterThanOrEqual(JSBI.multiply(JSBI.subtract(kr,gr),JSBI.BigInt(Ur)),Ie)&&({years:ar,months:dr,weeks:ur,days:fr}=AddDuration(ar,dr,ur,fr,0,0,0,0,0,0,0,0,0,Ur,0,0,0,0,0,0,ir),kr=RoundInstant(JSBI.subtract(kr,gr),zt,rr,nr),{hours:pr,minutes:lr,seconds:yr,milliseconds:br,microseconds:Ar,nanoseconds:Pr}=BalanceDuration(0,0,0,0,0,0,JSBI.toNumber(kr),"hour")),{years:ar,months:dr,weeks:ur,days:fr,hours:pr,minutes:lr,seconds:yr,milliseconds:br,microseconds:Ar,nanoseconds:Pr}}function RoundDuration(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir){let ar=xt,dr=e,ur=At,fr=kt,pr=Bt,lr=Nt,yr=jt,br=Lt,Ar=er,Pr=JSBI.BigInt(tr);const kr=GetIntrinsic("%Temporal.Duration%");let Ur,Hr,Lr,Sr,_r=ir;if(_r){if(IsTemporalZonedDateTime(_r))Hr=_r,_r=ToTemporalDate(_r);else if(!IsTemporalDate(_r))throw new TypeError("starting point must be PlainDate or ZonedDateTime");Ur=GetSlot(_r,p)}if(rr==="year"||rr==="month"||rr==="week"||rr==="day"){let gr,wr,Dr;Pr=TotalDurationNanoseconds(0,pr,lr,yr,br,Ar,tr,0),Hr&&(gr=MoveRelativeZonedDateTime(Hr,ar,dr,ur,fr)),{days:wr,nanoseconds:Pr,dayLengthNs:Dr}=NanosecondsToDays(Pr,gr),Lr=JSBI.BigInt(Dr),fr+=wr,pr=lr=yr=br=Ar=0}switch(rr){case"year":{if(!Ur)throw new RangeError("A starting point is required for years rounding");const gr=new kr(ar),wr=typeof Ur!="string"?GetMethod(Ur,"dateAdd"):void 0,Dr=CalendarDateAdd(Ur,_r,gr,void 0,wr),xr=CalendarDateAdd(Ur,_r,new kr(ar,dr,ur),void 0,wr);_r=Dr,fr+=DaysUntil(Dr,xr);const Ir=CalendarDateAdd(Ur,_r,new kr(0,0,0,fr),void 0,wr),$r=Te(null);$r.largestUnit="year";const vr=CalendarDateUntil(Ur,_r,Ir,$r).years;ar+=vr;const Er=_r;_r=CalendarDateAdd(Ur,_r,new kr(vr),void 0,wr),fr-=DaysUntil(Er,_r);const Tr=new kr(fr<0?-1:1);let{days:Rr}=MoveRelativeDate(Ur,_r,Tr,wr);Rr=ae(Rr);const Mr=JSBI.multiply(JSBI.BigInt(Rr),Lr);Pr=JSBI.add(JSBI.add(JSBI.multiply(Mr,JSBI.BigInt(ar)),JSBI.multiply(JSBI.BigInt(fr),Lr)),Pr);const Gr=RoundNumberToIncrement(Pr,JSBI.multiply(Mr,JSBI.BigInt(zt)),nr);Sr=BigIntDivideToNumber(Pr,Mr),ar=JSBI.toNumber(JSBI.divide(Gr,Mr)),Pr=Ie,dr=ur=fr=0;break}case"month":{if(!Ur)throw new RangeError("A starting point is required for months rounding");const gr=new kr(ar,dr),wr=typeof Ur!="string"?GetMethod(Ur,"dateAdd"):void 0,Dr=CalendarDateAdd(Ur,_r,gr,void 0,wr),xr=CalendarDateAdd(Ur,_r,new kr(ar,dr,ur),void 0,wr);_r=Dr,fr+=DaysUntil(Dr,xr);const Ir=se(fr),$r=new kr(0,fr<0?-1:1);let vr;for({relativeTo:_r,days:vr}=MoveRelativeDate(Ur,_r,$r,wr);ae(fr)>=ae(vr);)dr+=Ir,fr-=vr,{relativeTo:_r,days:vr}=MoveRelativeDate(Ur,_r,$r,wr);vr=ae(vr);const Er=JSBI.multiply(JSBI.BigInt(vr),Lr);Pr=JSBI.add(JSBI.add(JSBI.multiply(Er,JSBI.BigInt(dr)),JSBI.multiply(JSBI.BigInt(fr),Lr)),Pr);const Tr=RoundNumberToIncrement(Pr,JSBI.multiply(Er,JSBI.BigInt(zt)),nr);Sr=BigIntDivideToNumber(Pr,Er),dr=JSBI.toNumber(JSBI.divide(Tr,Er)),Pr=Ie,ur=fr=0;break}case"week":{if(!Ur)throw new RangeError("A starting point is required for weeks rounding");const gr=se(fr),wr=new kr(0,0,fr<0?-1:1),Dr=typeof Ur!="string"?GetMethod(Ur,"dateAdd"):void 0;let xr;for({relativeTo:_r,days:xr}=MoveRelativeDate(Ur,_r,wr,Dr);ae(fr)>=ae(xr);)ur+=gr,fr-=xr,{relativeTo:_r,days:xr}=MoveRelativeDate(Ur,_r,wr,Dr);xr=ae(xr);const Ir=JSBI.multiply(JSBI.BigInt(xr),Lr);Pr=JSBI.add(JSBI.add(JSBI.multiply(Ir,JSBI.BigInt(ur)),JSBI.multiply(JSBI.BigInt(fr),Lr)),Pr);const $r=RoundNumberToIncrement(Pr,JSBI.multiply(Ir,JSBI.BigInt(zt)),nr);Sr=BigIntDivideToNumber(Pr,Ir),ur=JSBI.toNumber(JSBI.divide($r,Ir)),Pr=Ie,fr=0;break}case"day":{const gr=Lr;Pr=JSBI.add(JSBI.multiply(gr,JSBI.BigInt(fr)),Pr);const wr=RoundNumberToIncrement(Pr,JSBI.multiply(gr,JSBI.BigInt(zt)),nr);Sr=BigIntDivideToNumber(Pr,gr),fr=JSBI.toNumber(JSBI.divide(wr,gr)),Pr=Ie;break}case"hour":{let wr=JSBI.multiply(JSBI.BigInt(pr),JSBI.BigInt(36e11));wr=JSBI.add(wr,JSBI.multiply(JSBI.BigInt(lr),JSBI.BigInt(6e10))),wr=JSBI.add(wr,JSBI.multiply(JSBI.BigInt(yr),ve)),wr=JSBI.add(wr,JSBI.multiply(JSBI.BigInt(br),Ge)),wr=JSBI.add(wr,JSBI.multiply(JSBI.BigInt(Ar),De)),wr=JSBI.add(wr,Pr),Sr=BigIntDivideToNumber(wr,JSBI.BigInt(36e11));const Dr=RoundNumberToIncrement(wr,JSBI.BigInt(36e11*zt),nr);pr=JSBI.toNumber(JSBI.divide(Dr,JSBI.BigInt(36e11))),Pr=Ie,lr=yr=br=Ar=0;break}case"minute":{let wr=JSBI.multiply(JSBI.BigInt(lr),JSBI.BigInt(6e10));wr=JSBI.add(wr,JSBI.multiply(JSBI.BigInt(yr),ve)),wr=JSBI.add(wr,JSBI.multiply(JSBI.BigInt(br),Ge)),wr=JSBI.add(wr,JSBI.multiply(JSBI.BigInt(Ar),De)),wr=JSBI.add(wr,Pr),Sr=BigIntDivideToNumber(wr,JSBI.BigInt(6e10));const Dr=RoundNumberToIncrement(wr,JSBI.BigInt(6e10*zt),nr);lr=JSBI.toNumber(JSBI.divide(Dr,JSBI.BigInt(6e10))),Pr=Ie,yr=br=Ar=0;break}case"second":{let wr=JSBI.multiply(JSBI.BigInt(yr),ve);wr=JSBI.add(wr,JSBI.multiply(JSBI.BigInt(br),Ge)),wr=JSBI.add(wr,JSBI.multiply(JSBI.BigInt(Ar),De)),wr=JSBI.add(wr,Pr),Sr=BigIntDivideToNumber(wr,JSBI.BigInt(1e9));const Dr=RoundNumberToIncrement(wr,JSBI.BigInt(1e9*zt),nr);yr=JSBI.toNumber(JSBI.divide(Dr,JSBI.BigInt(1e9))),Pr=Ie,br=Ar=0;break}case"millisecond":{let wr=JSBI.multiply(JSBI.BigInt(br),Ge);wr=JSBI.add(wr,JSBI.multiply(JSBI.BigInt(Ar),De)),wr=JSBI.add(wr,Pr),Sr=BigIntDivideToNumber(wr,JSBI.BigInt(1e6));const Dr=RoundNumberToIncrement(wr,JSBI.BigInt(1e6*zt),nr);br=JSBI.toNumber(JSBI.divide(Dr,JSBI.BigInt(1e6))),Pr=Ie,Ar=0;break}case"microsecond":{let wr=JSBI.multiply(JSBI.BigInt(Ar),De);wr=JSBI.add(wr,Pr),Sr=BigIntDivideToNumber(wr,JSBI.BigInt(1e3));const Dr=RoundNumberToIncrement(wr,JSBI.BigInt(1e3*zt),nr);Ar=JSBI.toNumber(JSBI.divide(Dr,JSBI.BigInt(1e3))),Pr=Ie;break}case"nanosecond":Sr=JSBI.toNumber(Pr),Pr=RoundNumberToIncrement(JSBI.BigInt(Pr),JSBI.BigInt(zt),nr)}return{years:ar,months:dr,weeks:ur,days:fr,hours:pr,minutes:lr,seconds:yr,milliseconds:br,microseconds:Ar,nanoseconds:JSBI.toNumber(Pr),total:Sr}}function CompareISODate(xt,e,At,kt,Bt,Nt){for(const[jt,Lt]of[[xt,kt],[e,Bt],[At,Nt]])if(jt!==Lt)return ComparisonResult(jt-Lt);return 0}function NonNegativeBigIntDivmod(xt,e){let{quotient:At,remainder:kt}=divmod(xt,e);return JSBI.lessThan(kt,Ie)&&(At=JSBI.subtract(At,Se),kt=JSBI.add(kt,e)),{quotient:At,remainder:kt}}function BigIntFloorDiv(xt,e){const{quotient:At,remainder:kt}=divmod(xt,e);return isZero(kt)||!isNegativeJSBI(xt)==!isNegativeJSBI(e)?At:JSBI.subtract(At,Se)}function BigIntDivideToNumber(xt,e){const{quotient:At,remainder:kt}=divmod(xt,e);return JSBI.toNumber(At)+JSBI.toNumber(kt)/JSBI.toNumber(e)}function ToBigIntExternal(xt){const e=ToBigInt(xt);return globalThis.BigInt!==void 0?globalThis.BigInt(e.toString(10)):e}function ToBigInt(xt){let e=xt;if(typeof xt=="object"){const At=xt[Symbol.toPrimitive];At&&typeof At=="function"&&(e=fe(At,xt,["number"]))}if(typeof e=="number")throw new TypeError("cannot convert number to bigint");return typeof e=="bigint"?JSBI.BigInt(e.toString(10)):JSBI.BigInt(e)}const Ve=(()=>{let xt=JSBI.BigInt(Date.now()%1e6);return()=>{const e=JSBI.BigInt(Date.now()),At=JSBI.add(JSBI.multiply(e,Ge),xt);return xt=JSBI.remainder(e,Ge),JSBI.greaterThan(At,Re)?Re:JSBI.lessThan(At,Me)?Me:At}})();function DefaultTimeZone(){return new re().resolvedOptions().timeZone}function ComparisonResult(xt){return xt<0?-1:xt>0?1:xt}function GetOptionsObject(xt){if(xt===void 0)return Te(null);if(IsObject(xt)&&xt!==null)return xt;throw new TypeError("Options parameter must be an object, not "+(xt===null?"null":typeof xt))}function CreateOnePropObject(xt,e){const At=Te(null);return At[xt]=e,At}function CopyOptions(xt){const e=Te(null);return CopyDataProperties(e,GetOptionsObject(xt),[]),e}function GetOption(xt,e,At,kt){let Bt=xt[e];if(Bt!==void 0){if(Bt=ToString(Bt),!At.includes(Bt))throw new RangeError(`${e} must be one of ${At.join(", ")}, not ${Bt}`);return Bt}return kt}function IsBuiltinCalendar(xt){return je.includes(ASCIILowercase(xt))}function ASCIILowercase(xt){return xt.replace(/[A-Z]/g,e=>{const At=e.charCodeAt(0);return String.fromCharCode(At+32)})}const ze=new RegExp(`^${W.source}$`);function bisect(xt,e,At,kt=xt(e),Bt=xt(At)){let Nt=JSBI.BigInt(e),jt=JSBI.BigInt(At),Lt=kt,er=Bt;for(;JSBI.greaterThan(JSBI.subtract(jt,Nt),Se);){const tr=JSBI.divide(JSBI.add(Nt,jt),JSBI.BigInt(2)),zt=xt(tr);if(zt===Lt)Nt=tr,Lt=zt;else{if(zt!==er)throw new Error(`invalid state in bisection ${Lt} - ${zt} - ${er}`);jt=tr,er=zt}}return jt}const _e={hour:36e11,minute:6e10,second:1e9,millisecond:1e6,microsecond:1e3,nanosecond:1},Je=Symbol("date"),Ke=Symbol("ym"),Xe=Symbol("md"),Qe=Symbol("time"),et=Symbol("datetime"),tt=Symbol("instant"),rt=Symbol("original"),ot=Symbol("timezone"),nt=Symbol("calendar-id"),at=Symbol("locale"),it=Symbol("options"),descriptor=xt=>({value:xt,enumerable:!0,writable:!1,configurable:!0}),st=globalThis.Intl.DateTimeFormat,lt=Object.assign,dt=Object.prototype.hasOwnProperty,mt=Reflect.apply;function getPropLazy(xt,e){let At=xt[e];return typeof At=="function"&&(At=new st(xt[at],At(xt[it])),xt[e]=At),At}function DateTimeFormatImpl(xt,e={}){if(!(this instanceof DateTimeFormatImpl))return new DateTimeFormatImpl(xt,e);const At=e!==void 0,kt=At?lt({},e):{},Bt=new st(xt,kt),Nt=Bt.resolvedOptions();if(At){const jt=lt({},Nt);for(const Lt in jt)mt(dt,kt,[Lt])||delete jt[Lt];this[it]=jt}else this[it]=kt;this[at]=Nt.locale,this[rt]=Bt,this[ot]=Nt.timeZone,this[nt]=Nt.calendar,this[Je]=dateAmend,this[Ke]=yearMonthAmend,this[Xe]=monthDayAmend,this[Qe]=timeAmend,this[et]=datetimeAmend,this[tt]=instantAmend}Object.defineProperty(DateTimeFormatImpl,"name",{writable:!0,value:"DateTimeFormat"}),DateTimeFormatImpl.supportedLocalesOf=function(xt,e){return st.supportedLocalesOf(xt,e)};const ct={resolvedOptions:descriptor(function xt(){return this[rt].resolvedOptions()}),format:descriptor(function xt(e,...At){let{instant:kt,formatter:Bt}=extractOverrides(e,this);return kt&&Bt?Bt.format(kt.epochMilliseconds):this[rt].format(e,...At)}),formatRange:descriptor(function xt(e,At){if(isTemporalObject(e)||isTemporalObject(At)){if(!sameTemporalType(e,At))throw new TypeError("Intl.DateTimeFormat.formatRange accepts two values of the same type");const{instant:kt,formatter:Bt}=extractOverrides(e,this),{instant:Nt,formatter:jt}=extractOverrides(At,this);if(kt&&Nt&&Bt&&jt&&Bt===jt)return Bt.formatRange(kt.epochMilliseconds,Nt.epochMilliseconds)}return this[rt].formatRange(e,At)})};"formatToParts"in st.prototype&&(ct.formatToParts=descriptor(function xt(e,...At){let{instant:kt,formatter:Bt}=extractOverrides(e,this);return kt&&Bt?Bt.formatToParts(kt.epochMilliseconds):this[rt].formatToParts(e,...At)})),"formatRangeToParts"in st.prototype&&(ct.formatRangeToParts=descriptor(function xt(e,At){if(isTemporalObject(e)||isTemporalObject(At)){if(!sameTemporalType(e,At))throw new TypeError("Intl.DateTimeFormat.formatRangeToParts accepts two values of the same type");const{instant:kt,formatter:Bt}=extractOverrides(e,this),{instant:Nt,formatter:jt}=extractOverrides(At,this);if(kt&&Nt&&Bt&&jt&&Bt===jt)return Bt.formatRangeToParts(kt.epochMilliseconds,Nt.epochMilliseconds)}return this[rt].formatRangeToParts(e,At)})),DateTimeFormatImpl.prototype=Object.create(st.prototype,ct),Object.defineProperty(DateTimeFormatImpl,"prototype",{writable:!1,enumerable:!1,configurable:!1});const ht=DateTimeFormatImpl;function amend(xt={},e={}){const At=lt({},xt);for(const kt of["year","month","day","hour","minute","second","weekday","dayPeriod","timeZoneName","dateStyle","timeStyle"])At[kt]=kt in e?e[kt]:At[kt],At[kt]!==!1&&At[kt]!==void 0||delete At[kt];return At}function timeAmend(xt){let e=amend(xt,{year:!1,month:!1,day:!1,weekday:!1,timeZoneName:!1,dateStyle:!1});return hasTimeOptions(e)||(e=lt({},e,{hour:"numeric",minute:"numeric",second:"numeric"})),e}function yearMonthAmend(xt){let e=amend(xt,{day:!1,hour:!1,minute:!1,second:!1,weekday:!1,dayPeriod:!1,timeZoneName:!1,dateStyle:!1,timeStyle:!1});return"year"in e||"month"in e||(e=lt(e,{year:"numeric",month:"numeric"})),e}function monthDayAmend(xt){let e=amend(xt,{year:!1,hour:!1,minute:!1,second:!1,weekday:!1,dayPeriod:!1,timeZoneName:!1,dateStyle:!1,timeStyle:!1});return"month"in e||"day"in e||(e=lt({},e,{month:"numeric",day:"numeric"})),e}function dateAmend(xt){let e=amend(xt,{hour:!1,minute:!1,second:!1,dayPeriod:!1,timeZoneName:!1,timeStyle:!1});return hasDateOptions(e)||(e=lt({},e,{year:"numeric",month:"numeric",day:"numeric"})),e}function datetimeAmend(xt){let e=amend(xt,{timeZoneName:!1});return hasTimeOptions(e)||hasDateOptions(e)||(e=lt({},e,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})),e}function instantAmend(xt){let e=xt;return hasTimeOptions(e)||hasDateOptions(e)||(e=lt({},e,{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"})),e}function hasDateOptions(xt){return"year"in xt||"month"in xt||"day"in xt||"weekday"in xt||"dateStyle"in xt}function hasTimeOptions(xt){return"hour"in xt||"minute"in xt||"second"in xt||"timeStyle"in xt||"dayPeriod"in xt}function isTemporalObject(xt){return IsTemporalDate(xt)||IsTemporalTime(xt)||IsTemporalDateTime(xt)||IsTemporalZonedDateTime(xt)||IsTemporalYearMonth(xt)||IsTemporalMonthDay(xt)||IsTemporalInstant(xt)}function sameTemporalType(xt,e){return!(!isTemporalObject(xt)||!isTemporalObject(e))&&!(IsTemporalTime(xt)&&!IsTemporalTime(e))&&!(IsTemporalDate(xt)&&!IsTemporalDate(e))&&!(IsTemporalDateTime(xt)&&!IsTemporalDateTime(e))&&!(IsTemporalZonedDateTime(xt)&&!IsTemporalZonedDateTime(e))&&!(IsTemporalYearMonth(xt)&&!IsTemporalYearMonth(e))&&!(IsTemporalMonthDay(xt)&&!IsTemporalMonthDay(e))&&!(IsTemporalInstant(xt)&&!IsTemporalInstant(e))}function extractOverrides(xt,e){const At=GetIntrinsic("%Temporal.PlainDateTime%");if(IsTemporalTime(xt)){const kt=new At(1970,1,1,GetSlot(xt,d$1),GetSlot(xt,m$1),GetSlot(xt,c),GetSlot(xt,h$1),GetSlot(xt,u),GetSlot(xt,T),e[nt]);return{instant:GetInstantFor(e[ot],kt,"compatible"),formatter:getPropLazy(e,Qe)}}if(IsTemporalYearMonth(xt)){const kt=GetSlot(xt,i$1),Bt=GetSlot(xt,s$1),Nt=GetSlot(xt,l),jt=ToTemporalCalendarIdentifier(GetSlot(xt,p));if(jt!==e[nt])throw new RangeError(`cannot format PlainYearMonth with calendar ${jt} in locale with calendar ${e[nt]}`);const Lt=new At(kt,Bt,Nt,12,0,0,0,0,0,jt);return{instant:GetInstantFor(e[ot],Lt,"compatible"),formatter:getPropLazy(e,Ke)}}if(IsTemporalMonthDay(xt)){const kt=GetSlot(xt,i$1),Bt=GetSlot(xt,s$1),Nt=GetSlot(xt,l),jt=ToTemporalCalendarIdentifier(GetSlot(xt,p));if(jt!==e[nt])throw new RangeError(`cannot format PlainMonthDay with calendar ${jt} in locale with calendar ${e[nt]}`);const Lt=new At(kt,Bt,Nt,12,0,0,0,0,0,jt);return{instant:GetInstantFor(e[ot],Lt,"compatible"),formatter:getPropLazy(e,Xe)}}if(IsTemporalDate(xt)){const kt=GetSlot(xt,i$1),Bt=GetSlot(xt,s$1),Nt=GetSlot(xt,l),jt=ToTemporalCalendarIdentifier(GetSlot(xt,p));if(jt!=="iso8601"&&jt!==e[nt])throw new RangeError(`cannot format PlainDate with calendar ${jt} in locale with calendar ${e[nt]}`);const Lt=new At(kt,Bt,Nt,12,0,0,0,0,0,e[nt]);return{instant:GetInstantFor(e[ot],Lt,"compatible"),formatter:getPropLazy(e,Je)}}if(IsTemporalDateTime(xt)){const kt=GetSlot(xt,i$1),Bt=GetSlot(xt,s$1),Nt=GetSlot(xt,l),jt=GetSlot(xt,d$1),Lt=GetSlot(xt,m$1),er=GetSlot(xt,c),tr=GetSlot(xt,h$1),zt=GetSlot(xt,u),rr=GetSlot(xt,T),nr=ToTemporalCalendarIdentifier(GetSlot(xt,p));if(nr!=="iso8601"&&nr!==e[nt])throw new RangeError(`cannot format PlainDateTime with calendar ${nr} in locale with calendar ${e[nt]}`);let ir=xt;return nr==="iso8601"&&(ir=new At(kt,Bt,Nt,jt,Lt,er,tr,zt,rr,e[nt])),{instant:GetInstantFor(e[ot],ir,"compatible"),formatter:getPropLazy(e,et)}}if(IsTemporalZonedDateTime(xt))throw new TypeError("Temporal.ZonedDateTime not supported in DateTimeFormat methods. Use toLocaleString() instead.");return IsTemporalInstant(xt)?{instant:xt,formatter:getPropLazy(e,tt)}:{}}class Instant{constructor(e){if(arguments.length<1)throw new TypeError("missing argument: epochNanoseconds is required");const At=ToBigInt(e);ValidateEpochNanoseconds(At),N(this),SetSlot(this,n,At)}get epochSeconds(){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");const e=GetSlot(this,n);return JSBI.toNumber(BigIntFloorDiv(e,ve))}get epochMilliseconds(){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");const e=JSBI.BigInt(GetSlot(this,n));return JSBI.toNumber(BigIntFloorDiv(e,Ge))}get epochMicroseconds(){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return ToBigIntExternal(BigIntFloorDiv(JSBI.BigInt(GetSlot(this,n)),De))}get epochNanoseconds(){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return ToBigIntExternal(JSBI.BigInt(GetSlot(this,n)))}add(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromInstant("add",this,e)}subtract(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromInstant("subtract",this,e)}until(e,At){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return DifferenceTemporalInstant("until",this,e,At)}since(e,At){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return DifferenceTemporalInstant("since",this,e,At)}round(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const At=typeof e=="string"?CreateOnePropObject("smallestUnit",e):GetOptionsObject(e),kt=ToTemporalRoundingIncrement(At),Bt=ToTemporalRoundingMode(At,"halfExpand"),Nt=GetTemporalUnit(At,"smallestUnit","time",He);ValidateTemporalRoundingIncrement(kt,{hour:24,minute:1440,second:86400,millisecond:864e5,microsecond:864e8,nanosecond:864e11}[Nt],!0);const jt=RoundInstant(GetSlot(this,n),kt,Nt,Bt);return new Instant(jt)}equals(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");const At=ToTemporalInstant(e),kt=GetSlot(this,n),Bt=GetSlot(At,n);return JSBI.equal(JSBI.BigInt(kt),JSBI.BigInt(Bt))}toString(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");const At=GetOptionsObject(e),kt=ToFractionalSecondDigits(At),Bt=ToTemporalRoundingMode(At,"trunc"),Nt=GetTemporalUnit(At,"smallestUnit","time",void 0);if(Nt==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');let jt=At.timeZone;jt!==void 0&&(jt=ToTemporalTimeZoneSlotValue(jt));const{precision:Lt,unit:er,increment:tr}=ToSecondsStringPrecisionRecord(Nt,kt),zt=RoundInstant(GetSlot(this,n),tr,er,Bt);return TemporalInstantToString(new Instant(zt),jt,Lt)}toJSON(){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return TemporalInstantToString(this,void 0,"auto")}toLocaleString(e,At){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");return new ht(e,At).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.Instant")}toZonedDateTime(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument in toZonedDateTime");const At=e.calendar;if(At===void 0)throw new TypeError("missing calendar property in toZonedDateTime");const kt=ToTemporalCalendarSlotValue(At),Bt=e.timeZone;if(Bt===void 0)throw new TypeError("missing timeZone property in toZonedDateTime");const Nt=ToTemporalTimeZoneSlotValue(Bt);return CreateTemporalZonedDateTime(GetSlot(this,n),Nt,kt)}toZonedDateTimeISO(e){if(!IsTemporalInstant(this))throw new TypeError("invalid receiver");const At=ToTemporalTimeZoneSlotValue(e);return CreateTemporalZonedDateTime(GetSlot(this,n),At,"iso8601")}static fromEpochSeconds(e){const At=ToNumber(e),kt=JSBI.multiply(JSBI.BigInt(At),ve);return ValidateEpochNanoseconds(kt),new Instant(kt)}static fromEpochMilliseconds(e){const At=ToNumber(e),kt=JSBI.multiply(JSBI.BigInt(At),Ge);return ValidateEpochNanoseconds(kt),new Instant(kt)}static fromEpochMicroseconds(e){const At=ToBigInt(e),kt=JSBI.multiply(At,De);return ValidateEpochNanoseconds(kt),new Instant(kt)}static fromEpochNanoseconds(e){const At=ToBigInt(e);return ValidateEpochNanoseconds(At),new Instant(At)}static from(e){return IsTemporalInstant(e)?new Instant(GetSlot(e,n)):ToTemporalInstant(e)}static compare(e,At){const kt=ToTemporalInstant(e),Bt=ToTemporalInstant(At),Nt=GetSlot(kt,n),jt=GetSlot(Bt,n);return JSBI.lessThan(Nt,jt)?-1:JSBI.greaterThan(Nt,jt)?1:0}}MakeIntrinsicClass(Instant,"Temporal.Instant");const Tt=Array.prototype.includes,pt=Array.prototype.push,ft=globalThis.Intl.DateTimeFormat,yt=Array.prototype.sort,It=Math.abs,St=Math.floor,gt=Object.create,wt=Object.entries,Dt=Set,Gt=Reflect.ownKeys,vt=Set.prototype.add,Ct=Set.prototype.values,Ot={};class Calendar{constructor(e){if(arguments.length<1)throw new RangeError("missing argument: id is required");const At=ToString(e);if(!IsBuiltinCalendar(At))throw new RangeError(`invalid calendar identifier ${At}`);N(this),SetSlot(this,F,ASCIILowercase(At))}get id(){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return GetSlot(this,F)}dateFromFields(e,At){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid fields");const kt=GetOptionsObject(At),Bt=GetSlot(this,F);return Ot[Bt].dateFromFields(e,kt,Bt)}yearMonthFromFields(e,At){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid fields");const kt=GetOptionsObject(At),Bt=GetSlot(this,F);return Ot[Bt].yearMonthFromFields(e,kt,Bt)}monthDayFromFields(e,At){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid fields");const kt=GetOptionsObject(At),Bt=GetSlot(this,F);return Ot[Bt].monthDayFromFields(e,kt,Bt)}fields(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const At=[],kt=new Set(["year","month","monthCode","day","hour","minute","second","millisecond","microsecond","nanosecond"]);for(const Bt of e){if(typeof Bt!="string")throw new TypeError("invalid fields");if(!kt.has(Bt))throw new RangeError(`invalid field name ${Bt}`);kt.delete(Bt),pt.call(At,Bt)}return Ot[GetSlot(this,F)].fields(At)}mergeFields(e,At){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const kt=ToObject(e),Bt=gt(null);CopyDataProperties(Bt,kt,[],[void 0]);const Nt=ToObject(At),jt=gt(null);CopyDataProperties(jt,Nt,[],[void 0]);const Lt=Gt(jt),er=Ot[GetSlot(this,F)].fieldKeysToIgnore(Lt),tr=gt(null),zt=Gt(Bt);for(const rr of zt){let nr;nr=Call(Tt,er,[rr])?jt[rr]:Bt[rr],nr!==void 0&&(tr[rr]=nr)}return CopyDataProperties(tr,jt,[]),tr}dateAdd(e,At,kt){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const Bt=ToTemporalDate(e),Nt=ToTemporalDuration(At),jt=ToTemporalOverflow(GetOptionsObject(kt)),{days:Lt}=BalanceDuration(GetSlot(Nt,v),GetSlot(Nt,C),GetSlot(Nt,O),GetSlot(Nt,b),GetSlot(Nt,E$2),GetSlot(Nt,M),GetSlot(Nt,R),"day"),er=GetSlot(this,F);return Ot[er].dateAdd(Bt,GetSlot(Nt,w$1),GetSlot(Nt,D$1),GetSlot(Nt,G),Lt,jt,er)}dateUntil(e,At,kt){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const Bt=ToTemporalDate(e),Nt=ToTemporalDate(At);let jt=GetTemporalUnit(GetOptionsObject(kt),"largestUnit","date","auto");jt==="auto"&&(jt="day");const{years:Lt,months:er,weeks:tr,days:zt}=Ot[GetSlot(this,F)].dateUntil(Bt,Nt,jt);return new(GetIntrinsic("%Temporal.Duration%"))(Lt,er,tr,zt,0,0,0,0,0,0)}year(e){let At=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(At)||(At=ToTemporalDate(At)),Ot[GetSlot(this,F)].year(At)}month(e){let At=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");if(IsTemporalMonthDay(At))throw new TypeError("use monthCode on PlainMonthDay instead");return IsTemporalYearMonth(At)||(At=ToTemporalDate(At)),Ot[GetSlot(this,F)].month(At)}monthCode(e){let At=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(At)||IsTemporalMonthDay(At)||(At=ToTemporalDate(At)),Ot[GetSlot(this,F)].monthCode(At)}day(e){let At=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalMonthDay(At)||(At=ToTemporalDate(At)),Ot[GetSlot(this,F)].day(At)}era(e){let At=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(At)||(At=ToTemporalDate(At)),Ot[GetSlot(this,F)].era(At)}eraYear(e){let At=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(At)||(At=ToTemporalDate(At)),Ot[GetSlot(this,F)].eraYear(At)}dayOfWeek(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const At=ToTemporalDate(e);return Ot[GetSlot(this,F)].dayOfWeek(At)}dayOfYear(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const At=ToTemporalDate(e);return Ot[GetSlot(this,F)].dayOfYear(At)}weekOfYear(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const At=ToTemporalDate(e);return Ot[GetSlot(this,F)].weekOfYear(At)}yearOfWeek(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const At=ToTemporalDate(e);return Ot[GetSlot(this,F)].yearOfWeek(At)}daysInWeek(e){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");const At=ToTemporalDate(e);return Ot[GetSlot(this,F)].daysInWeek(At)}daysInMonth(e){let At=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(At)||(At=ToTemporalDate(At)),Ot[GetSlot(this,F)].daysInMonth(At)}daysInYear(e){let At=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(At)||(At=ToTemporalDate(At)),Ot[GetSlot(this,F)].daysInYear(At)}monthsInYear(e){let At=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(At)||(At=ToTemporalDate(At)),Ot[GetSlot(this,F)].monthsInYear(At)}inLeapYear(e){let At=e;if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return IsTemporalYearMonth(At)||(At=ToTemporalDate(At)),Ot[GetSlot(this,F)].inLeapYear(At)}toString(){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return GetSlot(this,F)}toJSON(){if(!IsTemporalCalendar(this))throw new TypeError("invalid receiver");return GetSlot(this,F)}static from(e){return ToTemporalCalendarObject(ToTemporalCalendarSlotValue(e))}}function monthCodeNumberPart(xt){if(!xt.startsWith("M"))throw new RangeError(`Invalid month code: ${xt}.  Month codes must start with M.`);const e=+xt.slice(1);if(isNaN(e))throw new RangeError(`Invalid month code: ${xt}`);return e}function buildMonthCode(xt,e=!1){return`M${xt.toString().padStart(2,"0")}${e?"L":""}`}function resolveNonLunisolarMonth(xt,e,At=12){let{month:kt,monthCode:Bt}=xt;if(Bt===void 0){if(kt===void 0)throw new TypeError("Either month or monthCode are required");e==="reject"&&RejectToRange(kt,1,At),e==="constrain"&&(kt=ConstrainToRange(kt,1,At)),Bt=buildMonthCode(kt)}else{const Nt=monthCodeNumberPart(Bt);if(kt!==void 0&&kt!==Nt)throw new RangeError(`monthCode ${Bt} and month ${kt} must match if both are present`);if(Bt!==buildMonthCode(Nt))throw new RangeError(`Invalid month code: ${Bt}`);if(kt=Nt,kt<1||kt>At)throw new RangeError(`Invalid monthCode: ${Bt}`)}return{...xt,month:kt,monthCode:Bt}}MakeIntrinsicClass(Calendar,"Temporal.Calendar"),DefineIntrinsic("Temporal.Calendar.from",Calendar.from),DefineIntrinsic("Temporal.Calendar.prototype.dateAdd",Calendar.prototype.dateAdd),DefineIntrinsic("Temporal.Calendar.prototype.dateFromFields",Calendar.prototype.dateFromFields),DefineIntrinsic("Temporal.Calendar.prototype.dateUntil",Calendar.prototype.dateUntil),DefineIntrinsic("Temporal.Calendar.prototype.day",Calendar.prototype.day),DefineIntrinsic("Temporal.Calendar.prototype.dayOfWeek",Calendar.prototype.dayOfWeek),DefineIntrinsic("Temporal.Calendar.prototype.dayOfYear",Calendar.prototype.dayOfYear),DefineIntrinsic("Temporal.Calendar.prototype.daysInMonth",Calendar.prototype.daysInMonth),DefineIntrinsic("Temporal.Calendar.prototype.daysInWeek",Calendar.prototype.daysInWeek),DefineIntrinsic("Temporal.Calendar.prototype.daysInYear",Calendar.prototype.daysInYear),DefineIntrinsic("Temporal.Calendar.prototype.era",Calendar.prototype.era),DefineIntrinsic("Temporal.Calendar.prototype.eraYear",Calendar.prototype.eraYear),DefineIntrinsic("Temporal.Calendar.prototype.fields",Calendar.prototype.fields),DefineIntrinsic("Temporal.Calendar.prototype.inLeapYear",Calendar.prototype.inLeapYear),DefineIntrinsic("Temporal.Calendar.prototype.mergeFields",Calendar.prototype.mergeFields),DefineIntrinsic("Temporal.Calendar.prototype.month",Calendar.prototype.month),DefineIntrinsic("Temporal.Calendar.prototype.monthCode",Calendar.prototype.monthCode),DefineIntrinsic("Temporal.Calendar.prototype.monthDayFromFields",Calendar.prototype.monthDayFromFields),DefineIntrinsic("Temporal.Calendar.prototype.monthsInYear",Calendar.prototype.monthsInYear),DefineIntrinsic("Temporal.Calendar.prototype.weekOfYear",Calendar.prototype.weekOfYear),DefineIntrinsic("Temporal.Calendar.prototype.year",Calendar.prototype.year),DefineIntrinsic("Temporal.Calendar.prototype.yearMonthFromFields",Calendar.prototype.yearMonthFromFields),DefineIntrinsic("Temporal.Calendar.prototype.yearOfWeek",Calendar.prototype.yearOfWeek),Ot.iso8601={dateFromFields(xt,e,At){let kt=PrepareTemporalFields(xt,["day","month","monthCode","year"],["year","day"]);const Bt=ToTemporalOverflow(e);kt=resolveNonLunisolarMonth(kt);let{year:Nt,month:jt,day:Lt}=kt;return{year:Nt,month:jt,day:Lt}=RegulateISODate(Nt,jt,Lt,Bt),CreateTemporalDate(Nt,jt,Lt,At)},yearMonthFromFields(xt,e,At){let kt=PrepareTemporalFields(xt,["month","monthCode","year"],["year"]);const Bt=ToTemporalOverflow(e);kt=resolveNonLunisolarMonth(kt);let{year:Nt,month:jt}=kt;return{year:Nt,month:jt}=function(er,tr,zt){let rr=er,nr=tr;switch(zt){case"reject":RejectISODate(rr,nr,1);break;case"constrain":({year:rr,month:nr}=ConstrainISODate(rr,nr))}return{year:rr,month:nr}}(Nt,jt,Bt),CreateTemporalYearMonth(Nt,jt,At,1)},monthDayFromFields(xt,e,At){let kt=PrepareTemporalFields(xt,["day","month","monthCode","year"],["day"]);const Bt=ToTemporalOverflow(e);if(kt.month!==void 0&&kt.year===void 0&&kt.monthCode===void 0)throw new TypeError("either year or monthCode required with month");const Nt=kt.monthCode===void 0;kt=resolveNonLunisolarMonth(kt);let{month:jt,day:Lt,year:er}=kt;return{month:jt,day:Lt}=RegulateISODate(Nt?er:1972,jt,Lt,Bt),CreateTemporalMonthDay(jt,Lt,At,1972)},fields:xt=>xt,fieldKeysToIgnore(xt){const e=new Dt;for(let At=0;At<xt.length;At++){const kt=xt[At];Call(vt,e,[kt]),kt==="month"?Call(vt,e,["monthCode"]):kt==="monthCode"&&Call(vt,e,["month"])}return[...Call(Ct,e,[])]},dateAdd(xt,e,At,kt,Bt,Nt,jt){let Lt=GetSlot(xt,i$1),er=GetSlot(xt,s$1),tr=GetSlot(xt,l);return{year:Lt,month:er,day:tr}=AddISODate(Lt,er,tr,e,At,kt,Bt,Nt),CreateTemporalDate(Lt,er,tr,jt)},dateUntil:(xt,e,At)=>DifferenceISODate(GetSlot(xt,i$1),GetSlot(xt,s$1),GetSlot(xt,l),GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),At),year:xt=>GetSlot(xt,i$1),era(){},eraYear(){},month:xt=>GetSlot(xt,s$1),monthCode:xt=>buildMonthCode(GetSlot(xt,s$1)),day:xt=>GetSlot(xt,l),dayOfWeek:xt=>DayOfWeek(GetSlot(xt,i$1),GetSlot(xt,s$1),GetSlot(xt,l)),dayOfYear:xt=>DayOfYear(GetSlot(xt,i$1),GetSlot(xt,s$1),GetSlot(xt,l)),weekOfYear:xt=>WeekOfYear(GetSlot(xt,i$1),GetSlot(xt,s$1),GetSlot(xt,l)).week,yearOfWeek:xt=>WeekOfYear(GetSlot(xt,i$1),GetSlot(xt,s$1),GetSlot(xt,l)).year,daysInWeek:()=>7,daysInMonth:xt=>ISODaysInMonth(GetSlot(xt,i$1),GetSlot(xt,s$1)),daysInYear(xt){let e=xt;return HasSlot(e,i$1)||(e=ToTemporalDate(e)),LeapYear(GetSlot(e,i$1))?366:365},monthsInYear:()=>12,inLeapYear(xt){let e=xt;return HasSlot(e,i$1)||(e=ToTemporalDate(e)),LeapYear(GetSlot(e,i$1))}};class OneObjectCache{constructor(e){if(this.map=new Map,this.calls=0,this.hits=0,this.misses=0,this.now=globalThis.performance?globalThis.performance.now():Date.now(),e!==void 0){let At=0;for(const kt of e.map.entries()){if(++At>OneObjectCache.MAX_CACHE_ENTRIES)break;this.map.set(...kt)}}}get(e){const At=this.map.get(e);return At&&(this.hits++,this.report()),this.calls++,At}set(e,At){this.map.set(e,At),this.misses++,this.report()}report(){}setObject(e){if(OneObjectCache.objectMap.get(e))throw new RangeError("object already cached");OneObjectCache.objectMap.set(e,this),this.report()}static getCacheForObject(e){let At=OneObjectCache.objectMap.get(e);return At||(At=new OneObjectCache,OneObjectCache.objectMap.set(e,At)),At}}function toUtcIsoDateString({isoYear:xt,isoMonth:e,isoDay:At}){return`${ISOYearString(xt)}-${ISODateTimePartString(e)}-${ISODateTimePartString(At)}T00:00Z`}function simpleDateDiff(xt,e){return{years:xt.year-e.year,months:xt.month-e.month,days:xt.day-e.day}}OneObjectCache.objectMap=new WeakMap,OneObjectCache.MAX_CACHE_ENTRIES=1e3;class HelperBase{constructor(){this.eraLength="short",this.hasEra=!0,this.erasBeginMidYear=!1}getFormatter(){return this.formatter===void 0&&(this.formatter=new ft(`en-US-u-ca-${this.id}`,{day:"numeric",month:"numeric",year:"numeric",era:this.eraLength,timeZone:"UTC"})),this.formatter}isoToCalendarDate(e,At){const{year:kt,month:Bt,day:Nt}=e,jt=JSON.stringify({func:"isoToCalendarDate",isoYear:kt,isoMonth:Bt,isoDay:Nt,id:this.id}),Lt=At.get(jt);if(Lt)return Lt;const er=this.getFormatter();let tr,zt;try{zt=toUtcIsoDateString({isoYear:kt,isoMonth:Bt,isoDay:Nt}),tr=er.formatToParts(new Date(zt))}catch{throw new RangeError(`Invalid ISO date: ${JSON.stringify({isoYear:kt,isoMonth:Bt,isoDay:Nt})}`)}const rr={};for(let{type:ir,value:ar}of tr){if(ir==="year"&&(rr.eraYear=+ar),ir==="relatedYear"&&(rr.eraYear=+ar),ir==="month"){const dr=/^([0-9]*)(.*?)$/.exec(ar);if(!dr||dr.length!=3||!dr[1]&&!dr[2])throw new RangeError(`Unexpected month: ${ar}`);if(rr.month=dr[1]?+dr[1]:1,rr.month<1)throw new RangeError(`Invalid month ${ar} from ${zt}[u-ca-${this.id}] (probably due to https://bugs.chromium.org/p/v8/issues/detail?id=10527)`);if(rr.month>13)throw new RangeError(`Invalid month ${ar} from ${zt}[u-ca-${this.id}] (probably due to https://bugs.chromium.org/p/v8/issues/detail?id=10529)`);dr[2]&&(rr.monthExtra=dr[2])}ir==="day"&&(rr.day=+ar),this.hasEra&&ir==="era"&&ar!=null&&ar!==""&&(ar=ar.split(" (")[0],rr.era=ar.normalize("NFD").replace(/[^-0-9 \p{L}]/gu,"").replace(" ","-").toLowerCase())}if(rr.eraYear===void 0)throw new RangeError(`Intl.DateTimeFormat.formatToParts lacks relatedYear in ${this.id} calendar. Try Node 14+ or modern browsers.`);if(this.reviseIntlEra){const{era:ir,eraYear:ar}=this.reviseIntlEra(rr,e);rr.era=ir,rr.eraYear=ar}this.checkIcuBugs&&this.checkIcuBugs(e);const nr=this.adjustCalendarDate(rr,At,"constrain",!0);if(nr.year===void 0)throw new RangeError(`Missing year converting ${JSON.stringify(e)}`);if(nr.month===void 0)throw new RangeError(`Missing month converting ${JSON.stringify(e)}`);if(nr.day===void 0)throw new RangeError(`Missing day converting ${JSON.stringify(e)}`);return At.set(jt,nr),["constrain","reject"].forEach(ir=>{const ar=JSON.stringify({func:"calendarToIsoDate",year:nr.year,month:nr.month,day:nr.day,overflow:ir,id:this.id});At.set(ar,e)}),nr}validateCalendarDate(e){const{era:At,month:kt,year:Bt,day:Nt,eraYear:jt,monthCode:Lt,monthExtra:er}=e;if(er!==void 0)throw new RangeError("Unexpected `monthExtra` value");if(Bt===void 0&&jt===void 0)throw new TypeError("year or eraYear is required");if(kt===void 0&&Lt===void 0)throw new TypeError("month or monthCode is required");if(Nt===void 0)throw new RangeError("Missing day");if(Lt!==void 0){if(typeof Lt!="string")throw new RangeError("monthCode must be a string, not "+typeof Lt);if(!/^M([01]?\d)(L?)$/.test(Lt))throw new RangeError(`Invalid monthCode: ${Lt}`)}if(this.constantEra){if(At!==void 0&&At!==this.constantEra)throw new RangeError(`era must be ${this.constantEra}, not ${At}`);if(jt!==void 0&&Bt!==void 0&&jt!==Bt)throw new RangeError(`eraYear ${jt} does not match year ${Bt}`)}if(this.hasEra&&e.era===void 0!=(e.eraYear===void 0))throw new RangeError("properties 'era' and 'eraYear' must be provided together")}adjustCalendarDate(e,At,kt="constrain",Bt=!1){if(this.calendarType==="lunisolar")throw new RangeError("Override required for lunisolar calendars");let Nt=e;if(this.validateCalendarDate(Nt),this.constantEra){const{year:tr,eraYear:zt}=Nt;Nt={...Nt,era:this.constantEra,year:tr!==void 0?tr:zt,eraYear:zt!==void 0?zt:tr}}const jt=this.monthsInYear(Nt,At);let{month:Lt,monthCode:er}=Nt;return{month:Lt,monthCode:er}=resolveNonLunisolarMonth(Nt,kt,jt),{...Nt,month:Lt,monthCode:er}}regulateMonthDayNaive(e,At,kt){const Bt=this.monthsInYear(e,kt);let{month:Nt,day:jt}=e;return At==="reject"?(RejectToRange(Nt,1,Bt),RejectToRange(jt,1,this.maximumMonthLength(e))):(Nt=ConstrainToRange(Nt,1,Bt),jt=ConstrainToRange(jt,1,this.maximumMonthLength({...e,month:Nt}))),{...e,month:Nt,day:jt}}calendarToIsoDate(e,At="constrain",kt){const Bt=e;let Nt=this.adjustCalendarDate(e,kt,At,!1);Nt=this.regulateMonthDayNaive(Nt,At,kt);const{year:jt,month:Lt,day:er}=Nt,tr=JSON.stringify({func:"calendarToIsoDate",year:jt,month:Lt,day:er,overflow:At,id:this.id});let zt,rr=kt.get(tr);if(rr||Bt.year!==void 0&&Bt.month!==void 0&&Bt.day!==void 0&&(Bt.year!==Nt.year||Bt.month!==Nt.month||Bt.day!==Nt.day)&&(zt=JSON.stringify({func:"calendarToIsoDate",year:Bt.year,month:Bt.month,day:Bt.day,overflow:At,id:this.id}),rr=kt.get(zt),rr))return rr;let nr=this.estimateIsoDate({year:jt,month:Lt,day:er});const ir=pr=>{let lr=this.addDaysIso(nr,pr);if(Nt.day>this.minimumMonthLength(Nt)){let yr=this.isoToCalendarDate(lr,kt);for(;yr.month!==Lt||yr.year!==jt;){if(At==="reject")throw new RangeError(`day ${er} does not exist in month ${Lt} of year ${jt}`);lr=this.addDaysIso(lr,-1),yr=this.isoToCalendarDate(lr,kt)}}return lr};let ar=0,dr=this.isoToCalendarDate(nr,kt),ur=simpleDateDiff(Nt,dr);if(ur.years!==0||ur.months!==0||ur.days!==0){const pr=365*ur.years+30*ur.months+ur.days;nr=this.addDaysIso(nr,pr),dr=this.isoToCalendarDate(nr,kt),ur=simpleDateDiff(Nt,dr),ur.years===0&&ur.months===0?nr=ir(ur.days):ar=this.compareCalendarDates(Nt,dr)}let fr=8;for(;ar;){nr=this.addDaysIso(nr,ar*fr);const pr=dr;dr=this.isoToCalendarDate(nr,kt);const lr=ar;if(ar=this.compareCalendarDates(Nt,dr),ar){if(ur=simpleDateDiff(Nt,dr),ur.years===0&&ur.months===0)nr=ir(ur.days),ar=0;else if(lr&&ar!==lr)if(fr>1)fr/=2;else{if(At==="reject")throw new RangeError(`Can't find ISO date from calendar date: ${JSON.stringify({...Bt})}`);this.compareCalendarDates(dr,pr)>0&&(nr=this.addDaysIso(nr,-1)),ar=0}}}if(kt.set(tr,nr),zt&&kt.set(zt,nr),Nt.year===void 0||Nt.month===void 0||Nt.day===void 0||Nt.monthCode===void 0||this.hasEra&&(Nt.era===void 0||Nt.eraYear===void 0))throw new RangeError("Unexpected missing property");return nr}temporalToCalendarDate(e,At){const kt={year:GetSlot(e,i$1),month:GetSlot(e,s$1),day:GetSlot(e,l)};return this.isoToCalendarDate(kt,At)}compareCalendarDates(e,At){const kt=PrepareTemporalFields(e,["day","month","year"],["day","month","year"]),Bt=PrepareTemporalFields(At,["day","month","year"],["day","month","year"]);return kt.year!==Bt.year?ComparisonResult(kt.year-Bt.year):kt.month!==Bt.month?ComparisonResult(kt.month-Bt.month):kt.day!==Bt.day?ComparisonResult(kt.day-Bt.day):0}regulateDate(e,At="constrain",kt){const Bt=this.calendarToIsoDate(e,At,kt);return this.isoToCalendarDate(Bt,kt)}addDaysIso(e,At){return AddISODate(e.year,e.month,e.day,0,0,0,At,"constrain")}addDaysCalendar(e,At,kt){const Bt=this.calendarToIsoDate(e,"constrain",kt),Nt=this.addDaysIso(Bt,At);return this.isoToCalendarDate(Nt,kt)}addMonthsCalendar(e,At,kt,Bt){let Nt=e;const{day:jt}=Nt;for(let Lt=0,er=It(At);Lt<er;Lt++){const{month:tr}=Nt,zt=Nt,rr=At<0?-Math.max(jt,this.daysInPreviousMonth(Nt,Bt)):this.daysInMonth(Nt,Bt),nr=this.calendarToIsoDate(Nt,"constrain",Bt);let ir=this.addDaysIso(nr,rr);if(Nt=this.isoToCalendarDate(ir,Bt),At>0){const ar=this.monthsInYear(zt,Bt);for(;Nt.month-1!=tr%ar;)ir=this.addDaysIso(ir,-1),Nt=this.isoToCalendarDate(ir,Bt)}Nt.day!==jt&&(Nt=this.regulateDate({...Nt,day:jt},"constrain",Bt))}if(kt==="reject"&&Nt.day!==jt)throw new RangeError(`Day ${jt} does not exist in resulting calendar month`);return Nt}addCalendar(e,{years:At=0,months:kt=0,weeks:Bt=0,days:Nt=0},jt,Lt){const{year:er,day:tr,monthCode:zt}=e,rr=this.adjustCalendarDate({year:er+At,monthCode:zt,day:tr},Lt),nr=this.addMonthsCalendar(rr,kt,jt,Lt),ir=Nt+7*Bt;return this.addDaysCalendar(nr,ir,Lt)}untilCalendar(e,At,kt,Bt){let Nt=0,jt=0,Lt=0,er=0;switch(kt){case"day":Nt=this.calendarDaysUntil(e,At,Bt);break;case"week":{const tr=this.calendarDaysUntil(e,At,Bt);Nt=tr%7,jt=(tr-Nt)/7;break}case"month":case"year":{const tr=this.compareCalendarDates(At,e);if(!tr)return{years:0,months:0,weeks:0,days:0};const zt=At.year-e.year,rr=At.day-e.day;if(kt==="year"&&zt){let ar=0;At.monthCode>e.monthCode&&(ar=1),At.monthCode<e.monthCode&&(ar=-1),ar||(ar=Math.sign(rr)),er=ar*tr<0?zt-tr:zt}let nr,ir=er?this.addCalendar(e,{years:er},"constrain",Bt):e;do Lt+=tr,nr=ir,ir=this.addMonthsCalendar(nr,tr,"constrain",Bt),ir.day!==e.day&&(ir=this.regulateDate({...ir,day:e.day},"constrain",Bt));while(this.compareCalendarDates(At,ir)*tr>=0);Lt-=tr,Nt=this.calendarDaysUntil(nr,At,Bt);break}}return{years:er,months:Lt,weeks:jt,days:Nt}}daysInMonth(e,At){const{day:kt}=e,Bt=this.maximumMonthLength(e),Nt=this.minimumMonthLength(e);if(Nt===Bt)return Nt;const jt=kt<=Bt-Nt?Bt:Nt,Lt=this.calendarToIsoDate(e,"constrain",At),er=this.addDaysIso(Lt,jt),tr=this.isoToCalendarDate(er,At),zt=this.addDaysIso(er,-tr.day);return this.isoToCalendarDate(zt,At).day}daysInPreviousMonth(e,At){const{day:kt,month:Bt,year:Nt}=e;let jt={year:Bt>1?Nt:Nt-1,month:Bt,day:1};const Lt=Bt>1?Bt-1:this.monthsInYear(jt,At);jt={...jt,month:Lt};const er=this.minimumMonthLength(jt),tr=this.maximumMonthLength(jt);if(er===tr)return tr;const zt=this.calendarToIsoDate(e,"constrain",At),rr=this.addDaysIso(zt,-kt);return this.isoToCalendarDate(rr,At).day}startOfCalendarYear(e){return{year:e.year,month:1,monthCode:"M01",day:1}}startOfCalendarMonth(e){return{year:e.year,month:e.month,day:1}}calendarDaysUntil(e,At,kt){const Bt=this.calendarToIsoDate(e,"constrain",kt),Nt=this.calendarToIsoDate(At,"constrain",kt);return this.isoDaysUntil(Bt,Nt)}isoDaysUntil(e,At){return DifferenceISODate(e.year,e.month,e.day,At.year,At.month,At.day,"day").days}monthDayFromFields(e,At,kt){let Bt,Nt,jt,Lt,er,{monthCode:tr,day:zt}=e;if(tr===void 0){let{year:ir,era:ar,eraYear:dr}=e;if(ir===void 0&&(ar===void 0||dr===void 0))throw new TypeError("when `monthCode` is omitted, `year` (or `era` and `eraYear`) and `month` are required");({monthCode:tr,day:zt}=this.isoToCalendarDate(this.calendarToIsoDate(e,At,kt),kt))}const rr=this.isoToCalendarDate({year:1972,month:12,day:31},kt),nr=rr.monthCode>tr||rr.monthCode===tr&&rr.day>=zt?rr.year:rr.year-1;for(let ir=0;ir<100;ir++){const ar=this.adjustCalendarDate({day:zt,monthCode:tr,year:nr-ir},kt),dr=this.calendarToIsoDate(ar,"constrain",kt),ur=this.isoToCalendarDate(dr,kt);if({year:Bt,month:Nt,day:jt}=dr,ur.monthCode===tr&&ur.day===zt)return{month:Nt,day:jt,year:Bt};At==="constrain"&&(Lt===void 0||ur.monthCode===Lt.monthCode&&ur.day>Lt.day)&&(Lt=ur,er=dr)}if(At==="constrain"&&er!==void 0)return er;throw new RangeError(`No recent ${this.id} year with monthCode ${tr} and day ${zt}`)}}class HebrewHelper extends HelperBase{constructor(){super(...arguments),this.id="hebrew",this.calendarType="lunisolar",this.months={Tishri:{leap:1,regular:1,monthCode:"M01",days:30},Heshvan:{leap:2,regular:2,monthCode:"M02",days:{min:29,max:30}},Kislev:{leap:3,regular:3,monthCode:"M03",days:{min:29,max:30}},Tevet:{leap:4,regular:4,monthCode:"M04",days:29},Shevat:{leap:5,regular:5,monthCode:"M05",days:30},Adar:{leap:void 0,regular:6,monthCode:"M06",days:29},"Adar I":{leap:6,regular:void 0,monthCode:"M05L",days:30},"Adar II":{leap:7,regular:void 0,monthCode:"M06",days:29},Nisan:{leap:8,regular:7,monthCode:"M07",days:30},Iyar:{leap:9,regular:8,monthCode:"M08",days:29},Sivan:{leap:10,regular:9,monthCode:"M09",days:30},Tamuz:{leap:11,regular:10,monthCode:"M10",days:29},Av:{leap:12,regular:11,monthCode:"M11",days:30},Elul:{leap:13,regular:12,monthCode:"M12",days:29}},this.hasEra=!1}inLeapYear(e){const{year:At}=e;return(7*At+1)%19<7}monthsInYear(e){return this.inLeapYear(e)?13:12}minimumMonthLength(e){return this.minMaxMonthLength(e,"min")}maximumMonthLength(e){return this.minMaxMonthLength(e,"max")}minMaxMonthLength(e,At){const{month:kt,year:Bt}=e,Nt=this.getMonthCode(Bt,kt),jt=wt(this.months).find(er=>er[1].monthCode===Nt);if(jt===void 0)throw new RangeError(`unmatched Hebrew month: ${kt}`);const Lt=jt[1].days;return typeof Lt=="number"?Lt:Lt[At]}estimateIsoDate(e){const{year:At}=e;return{year:At-3760,month:1,day:1}}getMonthCode(e,At){return this.inLeapYear({year:e})?At===6?buildMonthCode(5,!0):buildMonthCode(At<6?At:At-1):buildMonthCode(At)}adjustCalendarDate(e,At,kt="constrain",Bt=!1){let{year:Nt,eraYear:jt,month:Lt,monthCode:er,day:tr,monthExtra:zt}=e;if(Nt===void 0&&jt!==void 0&&(Nt=jt),jt===void 0&&Nt!==void 0&&(jt=Nt),Bt){if(zt){const rr=this.months[zt];if(!rr)throw new RangeError(`Unrecognized month from formatToParts: ${zt}`);Lt=this.inLeapYear({year:Nt})?rr.leap:rr.regular}return er=this.getMonthCode(Nt,Lt),{year:Nt,month:Lt,day:tr,era:void 0,eraYear:jt,monthCode:er}}if(this.validateCalendarDate(e),Lt===void 0)if(er.endsWith("L")){if(er!=="M05L")throw new RangeError(`Hebrew leap month must have monthCode M05L, not ${er}`);if(Lt=6,!this.inLeapYear({year:Nt})){if(kt==="reject")throw new RangeError(`Hebrew monthCode M05L is invalid in year ${Nt} which is not a leap year`);Lt=6,er="M06"}}else{Lt=monthCodeNumberPart(er),this.inLeapYear({year:Nt})&&Lt>=6&&Lt++;const rr=this.monthsInYear({year:Nt});if(Lt<1||Lt>rr)throw new RangeError(`Invalid monthCode: ${er}`)}else if(kt==="reject"?(RejectToRange(Lt,1,this.monthsInYear({year:Nt})),RejectToRange(tr,1,this.maximumMonthLength({year:Nt,month:Lt}))):(Lt=ConstrainToRange(Lt,1,this.monthsInYear({year:Nt})),tr=ConstrainToRange(tr,1,this.maximumMonthLength({year:Nt,month:Lt}))),er===void 0)er=this.getMonthCode(Nt,Lt);else if(this.getMonthCode(Nt,Lt)!==er)throw new RangeError(`monthCode ${er} doesn't correspond to month ${Lt} in Hebrew year ${Nt}`);return{...e,day:tr,month:Lt,monthCode:er,year:Nt,eraYear:jt}}}class IslamicBaseHelper extends HelperBase{constructor(){super(...arguments),this.calendarType="lunar",this.DAYS_PER_ISLAMIC_YEAR=354+11/30,this.DAYS_PER_ISO_YEAR=365.2425,this.constantEra="ah"}inLeapYear(e,At){return this.daysInMonth({year:e.year,month:12,day:1},At)===30}monthsInYear(){return 12}minimumMonthLength(){return 29}maximumMonthLength(){return 30}estimateIsoDate(e){const{year:At}=this.adjustCalendarDate(e);return{year:St(At*this.DAYS_PER_ISLAMIC_YEAR/this.DAYS_PER_ISO_YEAR)+622,month:1,day:1}}}class IslamicHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamic"}}class IslamicUmalquraHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamic-umalqura"}}class IslamicTblaHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamic-tbla"}}class IslamicCivilHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamic-civil"}}class IslamicRgsaHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamic-rgsa"}}class IslamicCcHelper extends IslamicBaseHelper{constructor(){super(...arguments),this.id="islamicc"}}class PersianHelper extends HelperBase{constructor(){super(...arguments),this.id="persian",this.calendarType="solar",this.constantEra="ap"}inLeapYear(e,At){return IslamicHelper.prototype.inLeapYear.call(this,e,At)}monthsInYear(){return 12}minimumMonthLength(e){const{month:At}=e;return At===12?29:At<=6?31:30}maximumMonthLength(e){const{month:At}=e;return At===12?30:At<=6?31:30}estimateIsoDate(e){const{year:At}=this.adjustCalendarDate(e);return{year:At+621,month:1,day:1}}}class IndianHelper extends HelperBase{constructor(){super(...arguments),this.id="indian",this.calendarType="solar",this.constantEra="saka",this.months={1:{length:30,month:3,day:22,leap:{length:31,month:3,day:21}},2:{length:31,month:4,day:21},3:{length:31,month:5,day:22},4:{length:31,month:6,day:22},5:{length:31,month:7,day:23},6:{length:31,month:8,day:23},7:{length:30,month:9,day:23},8:{length:30,month:10,day:23},9:{length:30,month:11,day:22},10:{length:30,month:12,day:22},11:{length:30,month:1,nextYear:!0,day:21},12:{length:30,month:2,nextYear:!0,day:20}},this.vulnerableToBceBug=new Date("0000-01-01T00:00Z").toLocaleDateString("en-US-u-ca-indian",{timeZone:"UTC"})!=="10/11/-79 Saka"}inLeapYear(e){return isGregorianLeapYear(e.year+78)}monthsInYear(){return 12}minimumMonthLength(e){return this.getMonthInfo(e).length}maximumMonthLength(e){return this.getMonthInfo(e).length}getMonthInfo(e){const{month:At}=e;let kt=this.months[At];if(kt===void 0)throw new RangeError(`Invalid month: ${At}`);return this.inLeapYear(e)&&kt.leap&&(kt=kt.leap),kt}estimateIsoDate(e){const At=this.adjustCalendarDate(e),kt=this.getMonthInfo(At);return AddISODate(At.year+78+(kt.nextYear?1:0),kt.month,kt.day,0,0,0,At.day-1,"constrain")}checkIcuBugs(e){if(this.vulnerableToBceBug&&e.year<1)throw new RangeError(`calendar '${this.id}' is broken for ISO dates before 0001-01-01 (see https://bugs.chromium.org/p/v8/issues/detail?id=10529)`)}}function isGregorianLeapYear(xt){return xt%4==0&&(xt%100!=0||xt%400==0)}class GregorianBaseHelper extends HelperBase{constructor(e,At){super(),this.calendarType="solar",this.v8IsVulnerableToJulianBug=new Date("+001001-01-01T00:00Z").toLocaleDateString("en-US-u-ca-japanese",{timeZone:"UTC"}).startsWith("12"),this.calendarIsVulnerableToJulianBug=!1,this.id=e;const{eras:kt,anchorEra:Bt}=function(jt){let Lt,er=jt;if(er.length===0)throw new RangeError("Invalid era data: eras are required");if(er.length===1&&er[0].reverseOf)throw new RangeError("Invalid era data: anchor era cannot count years backwards");if(er.length===1&&!er[0].name)throw new RangeError("Invalid era data: at least one named era is required");if(er.filter(zt=>zt.reverseOf!=null).length>1)throw new RangeError("Invalid era data: only one era can count years backwards");er.forEach(zt=>{if(zt.isAnchor||!zt.anchorEpoch&&!zt.reverseOf){if(Lt)throw new RangeError("Invalid era data: cannot have multiple anchor eras");Lt=zt,zt.anchorEpoch={year:zt.hasYearZero?0:1}}else if(!zt.name)throw new RangeError("If era name is blank, it must be the anchor era")}),er=er.filter(zt=>zt.name),er.forEach(zt=>{const{reverseOf:rr}=zt;if(rr){const nr=er.find(ir=>ir.name===rr);if(nr===void 0)throw new RangeError(`Invalid era data: unmatched reverseOf era: ${rr}`);zt.reverseOf=nr,zt.anchorEpoch=nr.anchorEpoch,zt.isoEpoch=nr.isoEpoch}zt.anchorEpoch.month===void 0&&(zt.anchorEpoch.month=1),zt.anchorEpoch.day===void 0&&(zt.anchorEpoch.day=1)}),yt.call(er,(zt,rr)=>{if(zt.reverseOf)return 1;if(rr.reverseOf)return-1;if(!zt.isoEpoch||!rr.isoEpoch)throw new RangeError("Invalid era data: missing ISO epoch");return rr.isoEpoch.year-zt.isoEpoch.year});const tr=er[er.length-1].reverseOf;if(tr&&tr!==er[er.length-2])throw new RangeError("Invalid era data: invalid reverse-sign era");return er.forEach((zt,rr)=>{zt.genericName="era"+(er.length-1-rr)}),{eras:er,anchorEra:Lt||er[0]}}(At);this.anchorEra=Bt,this.eras=kt}inLeapYear(e){const{year:At}=this.estimateIsoDate({month:1,day:1,year:e.year});return isGregorianLeapYear(At)}monthsInYear(){return 12}minimumMonthLength(e){const{month:At}=e;return At===2?this.inLeapYear(e)?29:28:[4,6,9,11].indexOf(At)>=0?30:31}maximumMonthLength(e){return this.minimumMonthLength(e)}completeEraYear(e){const At=(Lt,er)=>{const tr=e[Lt];if(tr!=null&&tr!=er)throw new RangeError(`Input ${Lt} ${tr} doesn't match calculated value ${er}`)},kt=Lt=>{let er;const tr={...e,year:Lt},zt=this.eras.find((rr,nr)=>{if(nr===this.eras.length-1){if(rr.reverseOf){if(Lt>0)throw new RangeError(`Signed year ${Lt} is invalid for era ${rr.name}`);return er=rr.anchorEpoch.year-Lt,!0}return er=Lt-rr.anchorEpoch.year+(rr.hasYearZero?0:1),!0}return this.compareCalendarDates(tr,rr.anchorEpoch)>=0&&(er=Lt-rr.anchorEpoch.year+(rr.hasYearZero?0:1),!0)});if(!zt)throw new RangeError(`Year ${Lt} was not matched by any era`);return{eraYear:er,era:zt.name}};let{year:Bt,eraYear:Nt,era:jt}=e;if(Bt!=null)({eraYear:Nt,era:jt}=kt(Bt)),At("era",jt),At("eraYear",Nt);else{if(Nt==null)throw new RangeError("Either `year` or `eraYear` and `era` are required");{const Lt=jt===void 0?void 0:this.eras.find(er=>er.name===jt||er.genericName===jt);if(!Lt)throw new RangeError(`Era ${jt} (ISO year ${Nt}) was not matched by any era`);if(Nt<1&&Lt.reverseOf)throw new RangeError(`Years in ${jt} era must be positive, not ${Bt}`);Bt=Lt.reverseOf?Lt.anchorEpoch.year-Nt:Nt+Lt.anchorEpoch.year-(Lt.hasYearZero?0:1),At("year",Bt),{eraYear:Nt,era:jt}=kt(Bt)}}return{...e,year:Bt,eraYear:Nt,era:jt}}adjustCalendarDate(e,At,kt="constrain"){let Bt=e;const{month:Nt,monthCode:jt}=Bt;return Nt===void 0&&(Bt={...Bt,month:monthCodeNumberPart(jt)}),this.validateCalendarDate(Bt),Bt=this.completeEraYear(Bt),super.adjustCalendarDate(Bt,At,kt)}estimateIsoDate(e){const At=this.adjustCalendarDate(e),{year:kt,month:Bt,day:Nt}=At,{anchorEra:jt}=this;return RegulateISODate(kt+jt.isoEpoch.year-(jt.hasYearZero?0:1),Bt,Nt,"constrain")}checkIcuBugs(e){if(this.calendarIsVulnerableToJulianBug&&this.v8IsVulnerableToJulianBug&&CompareISODate(e.year,e.month,e.day,1582,10,15)<0)throw new RangeError(`calendar '${this.id}' is broken for ISO dates before 1582-10-15 (see https://bugs.chromium.org/p/chromium/issues/detail?id=1173158)`)}}class OrthodoxBaseHelper extends GregorianBaseHelper{constructor(e,At){super(e,At)}inLeapYear(e){const{year:At}=e;return(At+1)%4==0}monthsInYear(){return 13}minimumMonthLength(e){const{month:At}=e;return At===13?this.inLeapYear(e)?6:5:30}maximumMonthLength(e){return this.minimumMonthLength(e)}}class EthioaaHelper extends OrthodoxBaseHelper{constructor(){super("ethioaa",[{name:"era0",isoEpoch:{year:-5492,month:7,day:17}}])}}class CopticHelper extends OrthodoxBaseHelper{constructor(){super("coptic",[{name:"era1",isoEpoch:{year:284,month:8,day:29}},{name:"era0",reverseOf:"era1"}])}}class EthiopicHelper extends OrthodoxBaseHelper{constructor(){super("ethiopic",[{name:"era0",isoEpoch:{year:-5492,month:7,day:17}},{name:"era1",isoEpoch:{year:8,month:8,day:27},anchorEpoch:{year:5501}}])}}class RocHelper extends GregorianBaseHelper{constructor(){super("roc",[{name:"minguo",isoEpoch:{year:1912,month:1,day:1}},{name:"before-roc",reverseOf:"minguo"}]),this.calendarIsVulnerableToJulianBug=!0}}class BuddhistHelper extends GregorianBaseHelper{constructor(){super("buddhist",[{name:"be",hasYearZero:!0,isoEpoch:{year:-543,month:1,day:1}}]),this.calendarIsVulnerableToJulianBug=!0}}class GregoryHelper extends GregorianBaseHelper{constructor(){super("gregory",[{name:"ce",isoEpoch:{year:1,month:1,day:1}},{name:"bce",reverseOf:"ce"}])}reviseIntlEra(e){let{era:At,eraYear:kt}=e;return At!=="bc"&&At!=="b"||(At="bce"),At!=="ad"&&At!=="a"||(At="ce"),{era:At,eraYear:kt}}}class JapaneseHelper extends GregorianBaseHelper{constructor(){super("japanese",[{name:"reiwa",isoEpoch:{year:2019,month:5,day:1},anchorEpoch:{year:2019,month:5,day:1}},{name:"heisei",isoEpoch:{year:1989,month:1,day:8},anchorEpoch:{year:1989,month:1,day:8}},{name:"showa",isoEpoch:{year:1926,month:12,day:25},anchorEpoch:{year:1926,month:12,day:25}},{name:"taisho",isoEpoch:{year:1912,month:7,day:30},anchorEpoch:{year:1912,month:7,day:30}},{name:"meiji",isoEpoch:{year:1868,month:9,day:8},anchorEpoch:{year:1868,month:9,day:8}},{name:"ce",isoEpoch:{year:1,month:1,day:1}},{name:"bce",reverseOf:"ce"}]),this.calendarIsVulnerableToJulianBug=!0,this.eraLength="long",this.erasBeginMidYear=!0}reviseIntlEra(e,At){const{era:kt,eraYear:Bt}=e,{year:Nt}=At;return this.eras.find(jt=>jt.name===kt)?{era:kt,eraYear:Bt}:Nt<1?{era:"bce",eraYear:1-Nt}:{era:"ce",eraYear:Nt}}}class ChineseBaseHelper extends HelperBase{constructor(){super(...arguments),this.calendarType="lunisolar",this.hasEra=!1}inLeapYear(e,At){const kt=this.getMonthList(e.year,At);return wt(kt).length===13}monthsInYear(e,At){return this.inLeapYear(e,At)?13:12}minimumMonthLength(){return 29}maximumMonthLength(){return 30}getMonthList(e,At){if(e===void 0)throw new TypeError("Missing year");const kt=JSON.stringify({func:"getMonthList",calendarYear:e,id:this.id}),Bt=At.get(kt);if(Bt)return Bt;const Nt=this.getFormatter(),jt=(ur,fr)=>{const pr=toUtcIsoDateString({isoYear:ur,isoMonth:2,isoDay:1}),lr=new Date(pr);lr.setUTCDate(fr+1);const yr=Nt.formatToParts(lr),br=yr.find(kr=>kr.type==="month").value,Ar=+yr.find(kr=>kr.type==="day").value;let Pr=yr.find(kr=>kr.type==="relatedYear");if(Pr===void 0)throw new RangeError(`Intl.DateTimeFormat.formatToParts lacks relatedYear in ${this.id} calendar. Try Node 14+ or modern browsers.`);return Pr=+Pr.value,{calendarMonthString:br,calendarDay:Ar,calendarYearToVerify:Pr}};let Lt=17,{calendarMonthString:er,calendarDay:tr,calendarYearToVerify:zt}=jt(e,Lt);er!=="1"&&(Lt+=29,{calendarMonthString:er,calendarDay:tr}=jt(e,Lt)),Lt-=tr-5;const rr={};let nr,ir,ar=1,dr=!1;do({calendarMonthString:er,calendarDay:tr,calendarYearToVerify:zt}=jt(e,Lt)),nr&&(rr[ir].daysInMonth=nr+30-tr),zt!==e?dr=!0:(rr[er]={monthIndex:ar++},Lt+=30),nr=tr,ir=er;while(!dr);return rr[ir].daysInMonth=nr+30-tr,At.set(kt,rr),rr}estimateIsoDate(e){const{year:At,month:kt}=e;return{year:At,month:kt>=12?12:kt+1,day:1}}adjustCalendarDate(e,At,kt="constrain",Bt=!1){let{year:Nt,month:jt,monthExtra:Lt,day:er,monthCode:tr,eraYear:zt}=e;if(Bt){if(Nt=zt,Lt&&Lt!=="bis")throw new RangeError(`Unexpected leap month suffix: ${Lt}`);const rr=buildMonthCode(jt,Lt!==void 0),nr=`${jt}${Lt||""}`,ir=this.getMonthList(Nt,At)[nr];if(ir===void 0)throw new RangeError(`Unmatched month ${nr} in Chinese year ${Nt}`);return jt=ir.monthIndex,{year:Nt,month:jt,day:er,era:void 0,eraYear:zt,monthCode:rr}}if(this.validateCalendarDate(e),Nt===void 0&&(Nt=zt),zt===void 0&&(zt=Nt),jt===void 0){const rr=this.getMonthList(Nt,At);let nr=tr.replace("L","bis").slice(1);nr[0]==="0"&&(nr=nr.slice(1));let ir=rr[nr];if(jt=ir&&ir.monthIndex,jt===void 0&&tr.endsWith("L")&&tr!="M13L"&&kt==="constrain"){let ar=tr.slice(1,-1);ar[0]==="0"&&(ar=ar.slice(1)),ir=rr[ar],ir&&(jt=ir.monthIndex,tr=buildMonthCode(ar))}if(jt===void 0)throw new RangeError(`Unmatched month ${tr} in Chinese year ${Nt}`)}else if(tr===void 0){const rr=this.getMonthList(Nt,At),nr=wt(rr),ir=nr.length;kt==="reject"?(RejectToRange(jt,1,ir),RejectToRange(er,1,this.maximumMonthLength())):(jt=ConstrainToRange(jt,1,ir),er=ConstrainToRange(er,1,this.maximumMonthLength()));const ar=nr.find(([,dr])=>dr.monthIndex===jt);if(ar===void 0)throw new RangeError(`Invalid month ${jt} in Chinese year ${Nt}`);tr=buildMonthCode(ar[0].replace("bis",""),ar[0].indexOf("bis")!==-1)}else{const rr=this.getMonthList(Nt,At);let nr=tr.replace("L","bis").slice(1);nr[0]==="0"&&(nr=nr.slice(1));const ir=rr[nr];if(!ir)throw new RangeError(`Unmatched monthCode ${tr} in Chinese year ${Nt}`);if(jt!==ir.monthIndex)throw new RangeError(`monthCode ${tr} doesn't correspond to month ${jt} in Chinese year ${Nt}`)}return{...e,year:Nt,eraYear:zt,month:jt,monthCode:tr,day:er}}}class ChineseHelper extends ChineseBaseHelper{constructor(){super(...arguments),this.id="chinese"}}class DangiHelper extends ChineseBaseHelper{constructor(){super(...arguments),this.id="dangi"}}class NonIsoCalendar{constructor(e){this.helper=e}dateFromFields(e,At,kt){const Bt=new OneObjectCache,Nt=PrepareTemporalFields(e,this.fields(["day","month","monthCode","year"]),[]),jt=ToTemporalOverflow(At),{year:Lt,month:er,day:tr}=this.helper.calendarToIsoDate(Nt,jt,Bt),zt=CreateTemporalDate(Lt,er,tr,kt);return Bt.setObject(zt),zt}yearMonthFromFields(e,At,kt){const Bt=new OneObjectCache,Nt=PrepareTemporalFields(e,this.fields(["month","monthCode","year"]),[]),jt=ToTemporalOverflow(At),{year:Lt,month:er,day:tr}=this.helper.calendarToIsoDate({...Nt,day:1},jt,Bt),zt=CreateTemporalYearMonth(Lt,er,kt,tr);return Bt.setObject(zt),zt}monthDayFromFields(e,At,kt){const Bt=new OneObjectCache,Nt=PrepareTemporalFields(e,this.fields(["day","month","monthCode","year"]),[]),jt=ToTemporalOverflow(At),{year:Lt,month:er,day:tr}=this.helper.monthDayFromFields(Nt,jt,Bt),zt=CreateTemporalMonthDay(er,tr,kt,Lt);return Bt.setObject(zt),zt}fields(e){let At=e;return Tt.call(At,"year")&&(At=[...At,"era","eraYear"]),At}fieldKeysToIgnore(e){const At=new Dt;for(let kt=0;kt<e.length;kt++){const Bt=e[kt];switch(Call(vt,At,[Bt]),Bt){case"era":Call(vt,At,["eraYear"]),Call(vt,At,["year"]);break;case"eraYear":Call(vt,At,["era"]),Call(vt,At,["year"]);break;case"year":Call(vt,At,["era"]),Call(vt,At,["eraYear"]);break;case"month":Call(vt,At,["monthCode"]),this.helper.erasBeginMidYear&&(Call(vt,At,["era"]),Call(vt,At,["eraYear"]));break;case"monthCode":Call(vt,At,["month"]),this.helper.erasBeginMidYear&&(Call(vt,At,["era"]),Call(vt,At,["eraYear"]));break;case"day":this.helper.erasBeginMidYear&&(Call(vt,At,["era"]),Call(vt,At,["eraYear"]))}}return[...Call(Ct,At,[])]}dateAdd(e,At,kt,Bt,Nt,jt,Lt){const er=OneObjectCache.getCacheForObject(e),tr=this.helper.temporalToCalendarDate(e,er),zt=this.helper.addCalendar(tr,{years:At,months:kt,weeks:Bt,days:Nt},jt,er),rr=this.helper.calendarToIsoDate(zt,"constrain",er),{year:nr,month:ir,day:ar}=rr,dr=CreateTemporalDate(nr,ir,ar,Lt);return new OneObjectCache(er).setObject(dr),dr}dateUntil(e,At,kt){const Bt=OneObjectCache.getCacheForObject(e),Nt=OneObjectCache.getCacheForObject(At),jt=this.helper.temporalToCalendarDate(e,Bt),Lt=this.helper.temporalToCalendarDate(At,Nt);return this.helper.untilCalendar(jt,Lt,kt,Bt)}year(e){const At=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,At).year}month(e){const At=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,At).month}day(e){const At=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,At).day}era(e){if(!this.helper.hasEra)return;const At=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,At).era}eraYear(e){if(!this.helper.hasEra)return;const At=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,At).eraYear}monthCode(e){const At=OneObjectCache.getCacheForObject(e);return this.helper.temporalToCalendarDate(e,At).monthCode}dayOfWeek(e){return Ot.iso8601.dayOfWeek(e)}dayOfYear(e){const At=OneObjectCache.getCacheForObject(e),kt=this.helper.isoToCalendarDate(e,At),Bt=this.helper.startOfCalendarYear(kt);return this.helper.calendarDaysUntil(Bt,kt,At)+1}weekOfYear(e){return Ot.iso8601.weekOfYear(e)}yearOfWeek(e){return Ot.iso8601.yearOfWeek(e)}daysInWeek(e){return Ot.iso8601.daysInWeek(e)}daysInMonth(e){const At=OneObjectCache.getCacheForObject(e),kt=this.helper.temporalToCalendarDate(e,At),Bt=this.helper.maximumMonthLength(kt);if(Bt===this.helper.minimumMonthLength(kt))return Bt;const Nt=this.helper.startOfCalendarMonth(kt),jt=this.helper.addMonthsCalendar(Nt,1,"constrain",At);return this.helper.calendarDaysUntil(Nt,jt,At)}daysInYear(e){let At=e;HasSlot(At,i$1)||(At=ToTemporalDate(At));const kt=OneObjectCache.getCacheForObject(At),Bt=this.helper.temporalToCalendarDate(At,kt),Nt=this.helper.startOfCalendarYear(Bt),jt=this.helper.addCalendar(Nt,{years:1},"constrain",kt);return this.helper.calendarDaysUntil(Nt,jt,kt)}monthsInYear(e){const At=OneObjectCache.getCacheForObject(e),kt=this.helper.temporalToCalendarDate(e,At);return this.helper.monthsInYear(kt,At)}inLeapYear(e){let At=e;HasSlot(At,i$1)||(At=ToTemporalDate(At));const kt=OneObjectCache.getCacheForObject(At),Bt=this.helper.temporalToCalendarDate(At,kt);return this.helper.inLeapYear(Bt,kt)}}for(const xt of[HebrewHelper,PersianHelper,EthiopicHelper,EthioaaHelper,CopticHelper,ChineseHelper,DangiHelper,RocHelper,IndianHelper,BuddhistHelper,GregoryHelper,JapaneseHelper,IslamicHelper,IslamicUmalquraHelper,IslamicTblaHelper,IslamicCivilHelper,IslamicRgsaHelper,IslamicCcHelper]){const e=new xt;Ot[e.id]=new NonIsoCalendar(e)}class PlainDate{constructor(e,At,kt,Bt="iso8601"){CreateTemporalDateSlots(this,ToIntegerWithTruncation(e),ToIntegerWithTruncation(At),ToIntegerWithTruncation(kt),ToTemporalCalendarSlotValue(Bt))}get calendarId(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return ToTemporalCalendarIdentifier(GetSlot(this,p))}get era(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarEra(GetSlot(this,p),this)}get eraYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarEraYear(GetSlot(this,p),this)}get year(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarYear(GetSlot(this,p),this)}get month(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarMonth(GetSlot(this,p),this)}get monthCode(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarMonthCode(GetSlot(this,p),this)}get day(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDay(GetSlot(this,p),this)}get dayOfWeek(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDayOfWeek(GetSlot(this,p),this)}get dayOfYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDayOfYear(GetSlot(this,p),this)}get weekOfYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarWeekOfYear(GetSlot(this,p),this)}get yearOfWeek(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarYearOfWeek(GetSlot(this,p),this)}get daysInWeek(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDaysInWeek(GetSlot(this,p),this)}get daysInMonth(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDaysInMonth(GetSlot(this,p),this)}get daysInYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarDaysInYear(GetSlot(this,p),this)}get monthsInYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarMonthsInYear(GetSlot(this,p),this)}get inLeapYear(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return CalendarInLeapYear(GetSlot(this,p),this)}with(e,At){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");RejectTemporalLikeObject(e);const kt=GetOptionsObject(At),Bt=GetSlot(this,p),Nt=CalendarFields(Bt,["day","month","monthCode","year"]);let jt=PrepareTemporalFields(this,Nt,[]);return jt=CalendarMergeFields(Bt,jt,PrepareTemporalFields(e,Nt,"partial")),jt=PrepareTemporalFields(jt,Nt,[]),CalendarDateFromFields(Bt,jt,kt)}withCalendar(e){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const At=ToTemporalCalendarSlotValue(e);return new PlainDate(GetSlot(this,i$1),GetSlot(this,s$1),GetSlot(this,l),At)}add(e,At){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const kt=ToTemporalDuration(e),Bt=GetOptionsObject(At);return CalendarDateAdd(GetSlot(this,p),this,kt,Bt)}subtract(e,At){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const kt=CreateNegatedTemporalDuration(ToTemporalDuration(e)),Bt=GetOptionsObject(At);return CalendarDateAdd(GetSlot(this,p),this,kt,Bt)}until(e,At){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainDate("until",this,e,At)}since(e,At){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainDate("since",this,e,At)}equals(e){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const At=ToTemporalDate(e);for(const kt of[i$1,s$1,l])if(GetSlot(this,kt)!==GetSlot(At,kt))return!1;return CalendarEquals(GetSlot(this,p),GetSlot(At,p))}toString(e){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return TemporalDateToString(this,ToCalendarNameOption(GetOptionsObject(e)))}toJSON(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return TemporalDateToString(this)}toLocaleString(e,At){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return new ht(e,At).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainDate")}toPlainDateTime(e){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const At=GetSlot(this,i$1),kt=GetSlot(this,s$1),Bt=GetSlot(this,l),Nt=GetSlot(this,p);if(e===void 0)return CreateTemporalDateTime(At,kt,Bt,0,0,0,0,0,0,Nt);const jt=ToTemporalTime(e);return CreateTemporalDateTime(At,kt,Bt,GetSlot(jt,d$1),GetSlot(jt,m$1),GetSlot(jt,c),GetSlot(jt,h$1),GetSlot(jt,u),GetSlot(jt,T),Nt)}toZonedDateTime(e){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");let At,kt;if(IsObject(e))if(IsTemporalTimeZone(e))At=e;else{const ar=e.timeZone;ar===void 0?At=ToTemporalTimeZoneSlotValue(e):(At=ToTemporalTimeZoneSlotValue(ar),kt=e.plainTime)}else At=ToTemporalTimeZoneSlotValue(e);const Bt=GetSlot(this,i$1),Nt=GetSlot(this,s$1),jt=GetSlot(this,l),Lt=GetSlot(this,p);let er=0,tr=0,zt=0,rr=0,nr=0,ir=0;return kt!==void 0&&(kt=ToTemporalTime(kt),er=GetSlot(kt,d$1),tr=GetSlot(kt,m$1),zt=GetSlot(kt,c),rr=GetSlot(kt,h$1),nr=GetSlot(kt,u),ir=GetSlot(kt,T)),CreateTemporalZonedDateTime(GetSlot(GetInstantFor(At,CreateTemporalDateTime(Bt,Nt,jt,er,tr,zt,rr,nr,ir,Lt),"compatible"),n),At,Lt)}toPlainYearMonth(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarYearMonthFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["monthCode","year"]),[]))}toPlainMonthDay(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarMonthDayFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["day","monthCode"]),[]))}getISOFields(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return{calendar:GetSlot(this,p),isoDay:GetSlot(this,l),isoMonth:GetSlot(this,s$1),isoYear:GetSlot(this,i$1)}}getCalendar(){if(!IsTemporalDate(this))throw new TypeError("invalid receiver");return ToTemporalCalendarObject(GetSlot(this,p))}static from(e,At){const kt=GetOptionsObject(At);return IsTemporalDate(e)?(ToTemporalOverflow(kt),CreateTemporalDate(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),GetSlot(e,p))):ToTemporalDate(e,kt)}static compare(e,At){const kt=ToTemporalDate(e),Bt=ToTemporalDate(At);return CompareISODate(GetSlot(kt,i$1),GetSlot(kt,s$1),GetSlot(kt,l),GetSlot(Bt,i$1),GetSlot(Bt,s$1),GetSlot(Bt,l))}}MakeIntrinsicClass(PlainDate,"Temporal.PlainDate");class PlainDateTime{constructor(e,At,kt,Bt=0,Nt=0,jt=0,Lt=0,er=0,tr=0,zt="iso8601"){CreateTemporalDateTimeSlots(this,ToIntegerWithTruncation(e),ToIntegerWithTruncation(At),ToIntegerWithTruncation(kt),Bt===void 0?0:ToIntegerWithTruncation(Bt),Nt===void 0?0:ToIntegerWithTruncation(Nt),jt===void 0?0:ToIntegerWithTruncation(jt),Lt===void 0?0:ToIntegerWithTruncation(Lt),er===void 0?0:ToIntegerWithTruncation(er),tr===void 0?0:ToIntegerWithTruncation(tr),ToTemporalCalendarSlotValue(zt))}get calendarId(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return ToTemporalCalendarIdentifier(GetSlot(this,p))}get year(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarYear(GetSlot(this,p),this)}get month(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarMonth(GetSlot(this,p),this)}get monthCode(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarMonthCode(GetSlot(this,p),this)}get day(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDay(GetSlot(this,p),this)}get hour(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,d$1)}get minute(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,m$1)}get second(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,c)}get millisecond(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,h$1)}get microsecond(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,u)}get nanosecond(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return GetSlot(this,T)}get era(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarEra(GetSlot(this,p),this)}get eraYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarEraYear(GetSlot(this,p),this)}get dayOfWeek(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDayOfWeek(GetSlot(this,p),this)}get dayOfYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDayOfYear(GetSlot(this,p),this)}get weekOfYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarWeekOfYear(GetSlot(this,p),this)}get yearOfWeek(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarYearOfWeek(GetSlot(this,p),this)}get daysInWeek(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInWeek(GetSlot(this,p),this)}get daysInYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInYear(GetSlot(this,p),this)}get daysInMonth(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInMonth(GetSlot(this,p),this)}get monthsInYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarMonthsInYear(GetSlot(this,p),this)}get inLeapYear(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return CalendarInLeapYear(GetSlot(this,p),this)}with(e,At){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");RejectTemporalLikeObject(e);const kt=GetOptionsObject(At),Bt=GetSlot(this,p),Nt=CalendarFields(Bt,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);let jt=PrepareTemporalFields(this,Nt,[]);jt=CalendarMergeFields(Bt,jt,PrepareTemporalFields(e,Nt,"partial")),jt=PrepareTemporalFields(jt,Nt,[]);const{year:Lt,month:er,day:tr,hour:zt,minute:rr,second:nr,millisecond:ir,microsecond:ar,nanosecond:dr}=InterpretTemporalDateTimeFields(Bt,jt,kt);return CreateTemporalDateTime(Lt,er,tr,zt,rr,nr,ir,ar,dr,Bt)}withPlainTime(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const At=GetSlot(this,i$1),kt=GetSlot(this,s$1),Bt=GetSlot(this,l),Nt=GetSlot(this,p);if(e===void 0)return CreateTemporalDateTime(At,kt,Bt,0,0,0,0,0,0,Nt);const jt=ToTemporalTime(e);return CreateTemporalDateTime(At,kt,Bt,GetSlot(jt,d$1),GetSlot(jt,m$1),GetSlot(jt,c),GetSlot(jt,h$1),GetSlot(jt,u),GetSlot(jt,T),Nt)}withPlainDate(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const At=ToTemporalDate(e),kt=GetSlot(At,i$1),Bt=GetSlot(At,s$1),Nt=GetSlot(At,l);let jt=GetSlot(At,p);const Lt=GetSlot(this,d$1),er=GetSlot(this,m$1),tr=GetSlot(this,c),zt=GetSlot(this,h$1),rr=GetSlot(this,u),nr=GetSlot(this,T);return jt=ConsolidateCalendars(GetSlot(this,p),jt),CreateTemporalDateTime(kt,Bt,Nt,Lt,er,tr,zt,rr,nr,jt)}withCalendar(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const At=ToTemporalCalendarSlotValue(e);return new PlainDateTime(GetSlot(this,i$1),GetSlot(this,s$1),GetSlot(this,l),GetSlot(this,d$1),GetSlot(this,m$1),GetSlot(this,c),GetSlot(this,h$1),GetSlot(this,u),GetSlot(this,T),At)}add(e,At){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainDateTime("add",this,e,At)}subtract(e,At){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainDateTime("subtract",this,e,At)}until(e,At){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainDateTime("until",this,e,At)}since(e,At){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainDateTime("since",this,e,At)}round(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const At=typeof e=="string"?CreateOnePropObject("smallestUnit",e):GetOptionsObject(e),kt=ToTemporalRoundingIncrement(At),Bt=ToTemporalRoundingMode(At,"halfExpand"),Nt=GetTemporalUnit(At,"smallestUnit","time",He,["day"]),jt={day:1,hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[Nt];ValidateTemporalRoundingIncrement(kt,jt,jt===1);let Lt=GetSlot(this,i$1),er=GetSlot(this,s$1),tr=GetSlot(this,l),zt=GetSlot(this,d$1),rr=GetSlot(this,m$1),nr=GetSlot(this,c),ir=GetSlot(this,h$1),ar=GetSlot(this,u),dr=GetSlot(this,T);return{year:Lt,month:er,day:tr,hour:zt,minute:rr,second:nr,millisecond:ir,microsecond:ar,nanosecond:dr}=RoundISODateTime(Lt,er,tr,zt,rr,nr,ir,ar,dr,kt,Nt,Bt),CreateTemporalDateTime(Lt,er,tr,zt,rr,nr,ir,ar,dr,GetSlot(this,p))}equals(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const At=ToTemporalDateTime(e);for(const kt of[i$1,s$1,l,d$1,m$1,c,h$1,u,T])if(GetSlot(this,kt)!==GetSlot(At,kt))return!1;return CalendarEquals(GetSlot(this,p),GetSlot(At,p))}toString(e){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const At=GetOptionsObject(e),kt=ToCalendarNameOption(At),Bt=ToFractionalSecondDigits(At),Nt=ToTemporalRoundingMode(At,"trunc"),jt=GetTemporalUnit(At,"smallestUnit","time",void 0);if(jt==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');const{precision:Lt,unit:er,increment:tr}=ToSecondsStringPrecisionRecord(jt,Bt);return TemporalDateTimeToString(this,Lt,kt,{unit:er,increment:tr,roundingMode:Nt})}toJSON(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return TemporalDateTimeToString(this,"auto")}toLocaleString(e,At){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return new ht(e,At).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainDateTime")}toZonedDateTime(e,At){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const kt=ToTemporalTimeZoneSlotValue(e);return CreateTemporalZonedDateTime(GetSlot(GetInstantFor(kt,this,ToTemporalDisambiguation(GetOptionsObject(At))),n),kt,GetSlot(this,p))}toPlainDate(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return TemporalDateTimeToDate(this)}toPlainYearMonth(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarYearMonthFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["monthCode","year"]),[]))}toPlainMonthDay(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarMonthDayFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["day","monthCode"]),[]))}toPlainTime(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return TemporalDateTimeToTime(this)}getISOFields(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return{calendar:GetSlot(this,p),isoDay:GetSlot(this,l),isoHour:GetSlot(this,d$1),isoMicrosecond:GetSlot(this,u),isoMillisecond:GetSlot(this,h$1),isoMinute:GetSlot(this,m$1),isoMonth:GetSlot(this,s$1),isoNanosecond:GetSlot(this,T),isoSecond:GetSlot(this,c),isoYear:GetSlot(this,i$1)}}getCalendar(){if(!IsTemporalDateTime(this))throw new TypeError("invalid receiver");return ToTemporalCalendarObject(GetSlot(this,p))}static from(e,At){const kt=GetOptionsObject(At);return IsTemporalDateTime(e)?(ToTemporalOverflow(kt),CreateTemporalDateTime(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T),GetSlot(e,p))):ToTemporalDateTime(e,kt)}static compare(e,At){const kt=ToTemporalDateTime(e),Bt=ToTemporalDateTime(At);for(const Nt of[i$1,s$1,l,d$1,m$1,c,h$1,u,T]){const jt=GetSlot(kt,Nt),Lt=GetSlot(Bt,Nt);if(jt!==Lt)return ComparisonResult(jt-Lt)}return 0}}MakeIntrinsicClass(PlainDateTime,"Temporal.PlainDateTime");class Duration{constructor(e=0,At=0,kt=0,Bt=0,Nt=0,jt=0,Lt=0,er=0,tr=0,zt=0){const rr=e===void 0?0:ToIntegerIfIntegral(e),nr=At===void 0?0:ToIntegerIfIntegral(At),ir=kt===void 0?0:ToIntegerIfIntegral(kt),ar=Bt===void 0?0:ToIntegerIfIntegral(Bt),dr=Nt===void 0?0:ToIntegerIfIntegral(Nt),ur=jt===void 0?0:ToIntegerIfIntegral(jt),fr=Lt===void 0?0:ToIntegerIfIntegral(Lt),pr=er===void 0?0:ToIntegerIfIntegral(er),lr=tr===void 0?0:ToIntegerIfIntegral(tr),yr=zt===void 0?0:ToIntegerIfIntegral(zt);RejectDuration(rr,nr,ir,ar,dr,ur,fr,pr,lr,yr),N(this),SetSlot(this,w$1,rr),SetSlot(this,D$1,nr),SetSlot(this,G,ir),SetSlot(this,v,ar),SetSlot(this,C,dr),SetSlot(this,O,ur),SetSlot(this,b,fr),SetSlot(this,E$2,pr),SetSlot(this,M,lr),SetSlot(this,R,yr)}get years(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,w$1)}get months(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,D$1)}get weeks(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,G)}get days(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,v)}get hours(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,C)}get minutes(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,O)}get seconds(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,b)}get milliseconds(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,E$2)}get microseconds(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,M)}get nanoseconds(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return GetSlot(this,R)}get sign(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return DurationSign(GetSlot(this,w$1),GetSlot(this,D$1),GetSlot(this,G),GetSlot(this,v),GetSlot(this,C),GetSlot(this,O),GetSlot(this,b),GetSlot(this,E$2),GetSlot(this,M),GetSlot(this,R))}get blank(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return DurationSign(GetSlot(this,w$1),GetSlot(this,D$1),GetSlot(this,G),GetSlot(this,v),GetSlot(this,C),GetSlot(this,O),GetSlot(this,b),GetSlot(this,E$2),GetSlot(this,M),GetSlot(this,R))===0}with(e){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");const At=PrepareTemporalFields(e,["days","hours","microseconds","milliseconds","minutes","months","nanoseconds","seconds","weeks","years"],"partial"),{years:kt=GetSlot(this,w$1),months:Bt=GetSlot(this,D$1),weeks:Nt=GetSlot(this,G),days:jt=GetSlot(this,v),hours:Lt=GetSlot(this,C),minutes:er=GetSlot(this,O),seconds:tr=GetSlot(this,b),milliseconds:zt=GetSlot(this,E$2),microseconds:rr=GetSlot(this,M),nanoseconds:nr=GetSlot(this,R)}=At;return new Duration(kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr)}negated(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return CreateNegatedTemporalDuration(this)}abs(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return new Duration(Math.abs(GetSlot(this,w$1)),Math.abs(GetSlot(this,D$1)),Math.abs(GetSlot(this,G)),Math.abs(GetSlot(this,v)),Math.abs(GetSlot(this,C)),Math.abs(GetSlot(this,O)),Math.abs(GetSlot(this,b)),Math.abs(GetSlot(this,E$2)),Math.abs(GetSlot(this,M)),Math.abs(GetSlot(this,R)))}add(e,At){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromDuration("add",this,e,At)}subtract(e,At){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromDuration("subtract",this,e,At)}round(e){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");let At=GetSlot(this,w$1),kt=GetSlot(this,D$1),Bt=GetSlot(this,G),Nt=GetSlot(this,v),jt=GetSlot(this,C),Lt=GetSlot(this,O),er=GetSlot(this,b),tr=GetSlot(this,E$2),zt=GetSlot(this,M),rr=GetSlot(this,R),nr=DefaultTemporalLargestUnit(At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr);const ir=typeof e=="string"?CreateOnePropObject("smallestUnit",e):GetOptionsObject(e);let ar=GetTemporalUnit(ir,"largestUnit","datetime",void 0,["auto"]),dr=ToRelativeTemporalObject(ir);const ur=ToTemporalRoundingIncrement(ir),fr=ToTemporalRoundingMode(ir,"halfExpand");let pr=GetTemporalUnit(ir,"smallestUnit","datetime",void 0),lr=!0;pr||(lr=!1,pr="nanosecond"),nr=LargerOfTwoTemporalUnits(nr,pr);let yr=!0;if(ar||(yr=!1,ar=nr),ar==="auto"&&(ar=nr),!lr&&!yr)throw new RangeError("at least one of smallestUnit or largestUnit is required");if(LargerOfTwoTemporalUnits(ar,pr)!==ar)throw new RangeError(`largestUnit ${ar} cannot be smaller than smallestUnit ${pr}`);const br={hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[pr];return br!==void 0&&ValidateTemporalRoundingIncrement(ur,br,!1),{years:At,months:kt,weeks:Bt,days:Nt}=UnbalanceDurationRelative(At,kt,Bt,Nt,ar,dr),{years:At,months:kt,weeks:Bt,days:Nt,hours:jt,minutes:Lt,seconds:er,milliseconds:tr,microseconds:zt,nanoseconds:rr}=RoundDuration(At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,ur,pr,fr,dr),{years:At,months:kt,weeks:Bt,days:Nt,hours:jt,minutes:Lt,seconds:er,milliseconds:tr,microseconds:zt,nanoseconds:rr}=AdjustRoundedDurationDays(At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,ur,pr,fr,dr),{days:Nt,hours:jt,minutes:Lt,seconds:er,milliseconds:tr,microseconds:zt,nanoseconds:rr}=BalanceDuration(Nt,jt,Lt,er,tr,zt,rr,ar,dr),{years:At,months:kt,weeks:Bt,days:Nt}=function(Pr,kr,Ur,Hr,Lr,Sr){const _r=GetIntrinsic("%Temporal.Duration%"),gr=DurationSign(Pr,kr,Ur,Hr,0,0,0,0,0,0);if(gr===0)return{years:Pr,months:kr,weeks:Ur,days:Hr};const wr=JSBI.BigInt(gr);let Dr,xr,Ir=JSBI.BigInt(Pr),$r=JSBI.BigInt(kr),vr=JSBI.BigInt(Ur),Er=JSBI.BigInt(Hr);Sr&&(xr=ToTemporalDate(Sr),Dr=GetSlot(xr,p));const Tr=new _r(gr),Rr=new _r(0,gr),Mr=new _r(0,0,gr);switch(Lr){case"year":{if(!Dr)throw new RangeError("a starting point is required for years balancing");const Gr=typeof Dr!="string"?GetMethod(Dr,"dateAdd"):void 0;let Br,Cr,jr;for({relativeTo:Br,days:Cr}=MoveRelativeDate(Dr,xr,Tr,Gr);JSBI.greaterThanOrEqual(abs(Er),JSBI.BigInt(ae(Cr)));)Er=JSBI.subtract(Er,JSBI.BigInt(Cr)),Ir=JSBI.add(Ir,wr),xr=Br,{relativeTo:Br,days:Cr}=MoveRelativeDate(Dr,xr,Tr,Gr);for({relativeTo:Br,days:jr}=MoveRelativeDate(Dr,xr,Rr,Gr);JSBI.greaterThanOrEqual(abs(Er),JSBI.BigInt(ae(jr)));)Er=JSBI.subtract(Er,JSBI.BigInt(jr)),$r=JSBI.add($r,wr),xr=Br,{relativeTo:Br,days:jr}=MoveRelativeDate(Dr,xr,Rr,Gr);Br=CalendarDateAdd(Dr,xr,Tr,void 0,Gr);const Yr=typeof Dr!="string"?GetMethod(Dr,"dateUntil"):void 0,Qr=Te(null);Qr.largestUnit="month";let Jr=CalendarDateUntil(Dr,xr,Br,Qr,Yr),Wr=GetSlot(Jr,D$1);for(;JSBI.greaterThanOrEqual(abs($r),JSBI.BigInt(ae(Wr)));){$r=JSBI.subtract($r,JSBI.BigInt(Wr)),Ir=JSBI.add(Ir,wr),xr=Br,Br=CalendarDateAdd(Dr,xr,Tr,void 0,Gr);const Nr=Te(null);Nr.largestUnit="month",Jr=CalendarDateUntil(Dr,xr,Br,Nr,Yr),Wr=GetSlot(Jr,D$1)}break}case"month":{if(!Dr)throw new RangeError("a starting point is required for months balancing");const Gr=typeof Dr!="string"?GetMethod(Dr,"dateAdd"):void 0;let Br,Cr;for({relativeTo:Br,days:Cr}=MoveRelativeDate(Dr,xr,Rr,Gr);JSBI.greaterThanOrEqual(abs(Er),JSBI.BigInt(ae(Cr)));)Er=JSBI.subtract(Er,JSBI.BigInt(Cr)),$r=JSBI.add($r,wr),xr=Br,{relativeTo:Br,days:Cr}=MoveRelativeDate(Dr,xr,Rr,Gr);break}case"week":{if(!Dr)throw new RangeError("a starting point is required for weeks balancing");const Gr=typeof Dr!="string"?GetMethod(Dr,"dateAdd"):void 0;let Br,Cr;for({relativeTo:Br,days:Cr}=MoveRelativeDate(Dr,xr,Mr,Gr);JSBI.greaterThanOrEqual(abs(Er),JSBI.BigInt(ae(Cr)));)Er=JSBI.subtract(Er,JSBI.BigInt(Cr)),vr=JSBI.add(vr,wr),xr=Br,{relativeTo:Br,days:Cr}=MoveRelativeDate(Dr,xr,Mr,Gr);break}}return{years:JSBI.toNumber(Ir),months:JSBI.toNumber($r),weeks:JSBI.toNumber(vr),days:JSBI.toNumber(Er)}}(At,kt,Bt,Nt,ar,dr),new Duration(At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr)}total(e){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");let At=GetSlot(this,w$1),kt=GetSlot(this,D$1),Bt=GetSlot(this,G),Nt=GetSlot(this,v),jt=GetSlot(this,C),Lt=GetSlot(this,O),er=GetSlot(this,b),tr=GetSlot(this,E$2),zt=GetSlot(this,M),rr=GetSlot(this,R);if(e===void 0)throw new TypeError("options argument is required");const nr=typeof e=="string"?CreateOnePropObject("unit",e):GetOptionsObject(e),ir=ToRelativeTemporalObject(nr),ar=GetTemporalUnit(nr,"unit","datetime",He);let dr;({years:At,months:kt,weeks:Bt,days:Nt}=UnbalanceDurationRelative(At,kt,Bt,Nt,ar,ir)),IsTemporalZonedDateTime(ir)&&(dr=MoveRelativeZonedDateTime(ir,At,kt,Bt,0));let ur=BalancePossiblyInfiniteDuration(Nt,jt,Lt,er,tr,zt,rr,ar,dr);if(ur==="positive overflow")return 1/0;if(ur==="negative overflow")return-1/0;({days:Nt,hours:jt,minutes:Lt,seconds:er,milliseconds:tr,microseconds:zt,nanoseconds:rr}=ur);const{total:fr}=RoundDuration(At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,1,ar,"trunc",ir);return fr}toString(e){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");const At=GetOptionsObject(e),kt=ToFractionalSecondDigits(At),Bt=ToTemporalRoundingMode(At,"trunc"),Nt=GetTemporalUnit(At,"smallestUnit","time",void 0);if(Nt==="hour"||Nt==="minute")throw new RangeError('smallestUnit must be a time unit other than "hours" or "minutes"');const{precision:jt,unit:Lt,increment:er}=ToSecondsStringPrecisionRecord(Nt,kt);return TemporalDurationToString(this,jt,{unit:Lt,increment:er,roundingMode:Bt})}toJSON(){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return TemporalDurationToString(this)}toLocaleString(e,At){if(!IsTemporalDuration(this))throw new TypeError("invalid receiver");return typeof Intl<"u"&&Intl.DurationFormat!==void 0?new Intl.DurationFormat(e,At).format(this):(console.warn("Temporal.Duration.prototype.toLocaleString() requires Intl.DurationFormat."),TemporalDurationToString(this))}valueOf(){throw new TypeError("use compare() to compare Temporal.Duration")}static from(e){return IsTemporalDuration(e)?new Duration(GetSlot(e,w$1),GetSlot(e,D$1),GetSlot(e,G),GetSlot(e,v),GetSlot(e,C),GetSlot(e,O),GetSlot(e,b),GetSlot(e,E$2),GetSlot(e,M),GetSlot(e,R)):ToTemporalDuration(e)}static compare(e,At,kt){const Bt=ToTemporalDuration(e),Nt=ToTemporalDuration(At),jt=ToRelativeTemporalObject(GetOptionsObject(kt)),Lt=GetSlot(Bt,w$1),er=GetSlot(Bt,D$1),tr=GetSlot(Bt,G);let zt=GetSlot(Bt,v);const rr=GetSlot(Bt,C),nr=GetSlot(Bt,O),ir=GetSlot(Bt,b),ar=GetSlot(Bt,E$2),dr=GetSlot(Bt,M);let ur=GetSlot(Bt,R);const fr=GetSlot(Nt,w$1),pr=GetSlot(Nt,D$1),lr=GetSlot(Nt,G);let yr=GetSlot(Nt,v);const br=GetSlot(Nt,C),Ar=GetSlot(Nt,O),Pr=GetSlot(Nt,b),kr=GetSlot(Nt,E$2),Ur=GetSlot(Nt,M);let Hr=GetSlot(Nt,R);const Lr=CalculateOffsetShift(jt,Lt,er,tr,zt),Sr=CalculateOffsetShift(jt,fr,pr,lr,yr);Lt===0&&fr===0&&er===0&&pr===0&&tr===0&&lr===0||({days:zt}=UnbalanceDurationRelative(Lt,er,tr,zt,"day",jt),{days:yr}=UnbalanceDurationRelative(fr,pr,lr,yr,"day",jt));const _r=TotalDurationNanoseconds(zt,rr,nr,ir,ar,dr,ur,Lr),gr=TotalDurationNanoseconds(yr,br,Ar,Pr,kr,Ur,Hr,Sr);return ComparisonResult(JSBI.toNumber(JSBI.subtract(_r,gr)))}}MakeIntrinsicClass(Duration,"Temporal.Duration");const bt=Object.create;class PlainMonthDay{constructor(e,At,kt="iso8601",Bt=1972){CreateTemporalMonthDaySlots(this,ToIntegerWithTruncation(e),ToIntegerWithTruncation(At),ToTemporalCalendarSlotValue(kt),ToIntegerWithTruncation(Bt))}get monthCode(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return CalendarMonthCode(GetSlot(this,p),this)}get day(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return CalendarDay(GetSlot(this,p),this)}get calendarId(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return ToTemporalCalendarIdentifier(GetSlot(this,p))}with(e,At){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");RejectTemporalLikeObject(e);const kt=GetOptionsObject(At),Bt=GetSlot(this,p),Nt=CalendarFields(Bt,["day","month","monthCode","year"]);let jt=PrepareTemporalFields(this,Nt,[]);return jt=CalendarMergeFields(Bt,jt,PrepareTemporalFields(e,Nt,"partial")),jt=PrepareTemporalFields(jt,Nt,[]),CalendarMonthDayFromFields(Bt,jt,kt)}equals(e){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");const At=ToTemporalMonthDay(e);for(const kt of[s$1,l,i$1])if(GetSlot(this,kt)!==GetSlot(At,kt))return!1;return CalendarEquals(GetSlot(this,p),GetSlot(At,p))}toString(e){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return TemporalMonthDayToString(this,ToCalendarNameOption(GetOptionsObject(e)))}toJSON(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return TemporalMonthDayToString(this)}toLocaleString(e,At){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return new ht(e,At).format(this)}valueOf(){throw new TypeError("use equals() to compare Temporal.PlainMonthDay")}toPlainDate(e){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("argument should be an object");const At=GetSlot(this,p),kt=CalendarFields(At,["day","monthCode"]),Bt=PrepareTemporalFields(this,kt,[]),Nt=CalendarFields(At,["year"]);let jt=CalendarMergeFields(At,Bt,PrepareTemporalFields(e,Nt,[]));jt=PrepareTemporalFields(jt,[...new Set([...kt,...Nt])],[]);const Lt=bt(null);return Lt.overflow="reject",CalendarDateFromFields(At,jt,Lt)}getISOFields(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return{calendar:GetSlot(this,p),isoDay:GetSlot(this,l),isoMonth:GetSlot(this,s$1),isoYear:GetSlot(this,i$1)}}getCalendar(){if(!IsTemporalMonthDay(this))throw new TypeError("invalid receiver");return ToTemporalCalendarObject(GetSlot(this,p))}static from(e,At){const kt=GetOptionsObject(At);return IsTemporalMonthDay(e)?(ToTemporalOverflow(kt),CreateTemporalMonthDay(GetSlot(e,s$1),GetSlot(e,l),GetSlot(e,p),GetSlot(e,i$1))):ToTemporalMonthDay(e,kt)}}MakeIntrinsicClass(PlainMonthDay,"Temporal.PlainMonthDay");const instant=()=>new(GetIntrinsic("%Temporal.Instant%"))(Ve()),plainDateTime=(xt,e=DefaultTimeZone())=>{const At=ToTemporalTimeZoneSlotValue(e),kt=ToTemporalCalendarSlotValue(xt);return GetPlainDateTimeFor(At,instant(),kt)},plainDateTimeISO=(xt=DefaultTimeZone())=>GetPlainDateTimeFor(ToTemporalTimeZoneSlotValue(xt),instant(),"iso8601"),zonedDateTime=(xt,e=DefaultTimeZone())=>{const At=ToTemporalTimeZoneSlotValue(e),kt=ToTemporalCalendarSlotValue(xt);return CreateTemporalZonedDateTime(Ve(),At,kt)},Et={instant,plainDateTime,plainDateTimeISO,plainDate:(xt,e=DefaultTimeZone())=>TemporalDateTimeToDate(plainDateTime(xt,e)),plainDateISO:(xt=DefaultTimeZone())=>TemporalDateTimeToDate(plainDateTimeISO(xt)),plainTimeISO:(xt=DefaultTimeZone())=>TemporalDateTimeToTime(plainDateTimeISO(xt)),timeZoneId:()=>DefaultTimeZone(),zonedDateTime,zonedDateTimeISO:(xt=DefaultTimeZone())=>zonedDateTime("iso8601",xt),[Symbol.toStringTag]:"Temporal.Now"};Object.defineProperty(Et,Symbol.toStringTag,{value:"Temporal.Now",writable:!1,enumerable:!1,configurable:!0});const Mt=Object.assign;function TemporalTimeToString(xt,e,At){let kt=GetSlot(xt,d$1),Bt=GetSlot(xt,m$1),Nt=GetSlot(xt,c),jt=GetSlot(xt,h$1),Lt=GetSlot(xt,u),er=GetSlot(xt,T);if(At){const{unit:tr,increment:zt,roundingMode:rr}=At;({hour:kt,minute:Bt,second:Nt,millisecond:jt,microsecond:Lt,nanosecond:er}=RoundTime(kt,Bt,Nt,jt,Lt,er,zt,tr,rr))}return`${ISODateTimePartString(kt)}:${ISODateTimePartString(Bt)}${FormatSecondsStringPart(Nt,jt,Lt,er,e)}`}class PlainTime{constructor(e=0,At=0,kt=0,Bt=0,Nt=0,jt=0){const Lt=e===void 0?0:ToIntegerWithTruncation(e),er=At===void 0?0:ToIntegerWithTruncation(At),tr=kt===void 0?0:ToIntegerWithTruncation(kt),zt=Bt===void 0?0:ToIntegerWithTruncation(Bt),rr=Nt===void 0?0:ToIntegerWithTruncation(Nt),nr=jt===void 0?0:ToIntegerWithTruncation(jt);RejectTime(Lt,er,tr,zt,rr,nr),N(this),SetSlot(this,d$1,Lt),SetSlot(this,m$1,er),SetSlot(this,c,tr),SetSlot(this,h$1,zt),SetSlot(this,u,rr),SetSlot(this,T,nr)}get hour(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,d$1)}get minute(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,m$1)}get second(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,c)}get millisecond(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,h$1)}get microsecond(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,u)}get nanosecond(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return GetSlot(this,T)}with(e,At){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");RejectTemporalLikeObject(e);const kt=ToTemporalOverflow(GetOptionsObject(At)),Bt=ToTemporalTimeRecord(e,"partial"),Nt=ToTemporalTimeRecord(this);let{hour:jt,minute:Lt,second:er,millisecond:tr,microsecond:zt,nanosecond:rr}=Mt(Nt,Bt);return{hour:jt,minute:Lt,second:er,millisecond:tr,microsecond:zt,nanosecond:rr}=RegulateTime(jt,Lt,er,tr,zt,rr,kt),new PlainTime(jt,Lt,er,tr,zt,rr)}add(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainTime("add",this,e)}subtract(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainTime("subtract",this,e)}until(e,At){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainTime("until",this,e,At)}since(e,At){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainTime("since",this,e,At)}round(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const At=typeof e=="string"?CreateOnePropObject("smallestUnit",e):GetOptionsObject(e),kt=ToTemporalRoundingIncrement(At),Bt=ToTemporalRoundingMode(At,"halfExpand"),Nt=GetTemporalUnit(At,"smallestUnit","time",He);ValidateTemporalRoundingIncrement(kt,{hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[Nt],!1);let jt=GetSlot(this,d$1),Lt=GetSlot(this,m$1),er=GetSlot(this,c),tr=GetSlot(this,h$1),zt=GetSlot(this,u),rr=GetSlot(this,T);return{hour:jt,minute:Lt,second:er,millisecond:tr,microsecond:zt,nanosecond:rr}=RoundTime(jt,Lt,er,tr,zt,rr,kt,Nt,Bt),new PlainTime(jt,Lt,er,tr,zt,rr)}equals(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");const At=ToTemporalTime(e);for(const kt of[d$1,m$1,c,h$1,u,T])if(GetSlot(this,kt)!==GetSlot(At,kt))return!1;return!0}toString(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");const At=GetOptionsObject(e),kt=ToFractionalSecondDigits(At),Bt=ToTemporalRoundingMode(At,"trunc"),Nt=GetTemporalUnit(At,"smallestUnit","time",void 0);if(Nt==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');const{precision:jt,unit:Lt,increment:er}=ToSecondsStringPrecisionRecord(Nt,kt);return TemporalTimeToString(this,jt,{unit:Lt,increment:er,roundingMode:Bt})}toJSON(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return TemporalTimeToString(this,"auto")}toLocaleString(e,At){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return new ht(e,At).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainTime")}toPlainDateTime(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");const At=ToTemporalDate(e),kt=GetSlot(At,i$1),Bt=GetSlot(At,s$1),Nt=GetSlot(At,l),jt=GetSlot(At,p);return CreateTemporalDateTime(kt,Bt,Nt,GetSlot(this,d$1),GetSlot(this,m$1),GetSlot(this,c),GetSlot(this,h$1),GetSlot(this,u),GetSlot(this,T),jt)}toZonedDateTime(e){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");const At=e.plainDate;if(At===void 0)throw new TypeError("missing date property");const kt=ToTemporalDate(At),Bt=e.timeZone;if(Bt===void 0)throw new TypeError("missing timeZone property");const Nt=ToTemporalTimeZoneSlotValue(Bt),jt=GetSlot(kt,i$1),Lt=GetSlot(kt,s$1),er=GetSlot(kt,l),tr=GetSlot(kt,p),zt=GetSlot(this,d$1),rr=GetSlot(this,m$1),nr=GetSlot(this,c),ir=GetSlot(this,h$1),ar=GetSlot(this,u),dr=GetSlot(this,T);return CreateTemporalZonedDateTime(GetSlot(GetInstantFor(Nt,new(GetIntrinsic("%Temporal.PlainDateTime%"))(jt,Lt,er,zt,rr,nr,ir,ar,dr,tr),"compatible"),n),Nt,tr)}getISOFields(){if(!IsTemporalTime(this))throw new TypeError("invalid receiver");return{isoHour:GetSlot(this,d$1),isoMicrosecond:GetSlot(this,u),isoMillisecond:GetSlot(this,h$1),isoMinute:GetSlot(this,m$1),isoNanosecond:GetSlot(this,T),isoSecond:GetSlot(this,c)}}static from(e,At){const kt=ToTemporalOverflow(GetOptionsObject(At));return IsTemporalTime(e)?new PlainTime(GetSlot(e,d$1),GetSlot(e,m$1),GetSlot(e,c),GetSlot(e,h$1),GetSlot(e,u),GetSlot(e,T)):ToTemporalTime(e,kt)}static compare(e,At){const kt=ToTemporalTime(e),Bt=ToTemporalTime(At);for(const Nt of[d$1,m$1,c,h$1,u,T]){const jt=GetSlot(kt,Nt),Lt=GetSlot(Bt,Nt);if(jt!==Lt)return ComparisonResult(jt-Lt)}return 0}}MakeIntrinsicClass(PlainTime,"Temporal.PlainTime");class TimeZone{constructor(e){if(arguments.length<1)throw new RangeError("missing argument: identifier is required");const At=GetCanonicalTimeZoneIdentifier(e);N(this),SetSlot(this,a,At)}get id(){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetSlot(this,a)}getOffsetNanosecondsFor(e){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");const At=ToTemporalInstant(e),kt=GetSlot(this,a);return IsTimeZoneOffsetString(kt)?ParseTimeZoneOffsetString(kt):GetNamedTimeZoneOffsetNanoseconds(kt,GetSlot(At,n))}getOffsetStringFor(e){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetOffsetStringFor(this,ToTemporalInstant(e))}getPlainDateTimeFor(e,At="iso8601"){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetPlainDateTimeFor(this,ToTemporalInstant(e),ToTemporalCalendarSlotValue(At))}getInstantFor(e,At){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetInstantFor(this,ToTemporalDateTime(e),ToTemporalDisambiguation(GetOptionsObject(At)))}getPossibleInstantsFor(e){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");const At=ToTemporalDateTime(e),kt=GetIntrinsic("%Temporal.Instant%"),Bt=GetSlot(this,a);if(IsTimeZoneOffsetString(Bt)){const jt=GetUTCEpochNanoseconds(GetSlot(At,i$1),GetSlot(At,s$1),GetSlot(At,l),GetSlot(At,d$1),GetSlot(At,m$1),GetSlot(At,c),GetSlot(At,h$1),GetSlot(At,u),GetSlot(At,T));if(jt===null)throw new RangeError("DateTime outside of supported range");const Lt=ParseTimeZoneOffsetString(Bt);return[new kt(JSBI.subtract(jt,JSBI.BigInt(Lt)))]}return function(Lt,er,tr,zt,rr,nr,ir,ar,dr,ur){const fr=GetUTCEpochNanoseconds(er,tr,zt,rr,nr,ir,ar,dr,ur);if(fr===null)throw new RangeError("DateTime outside of supported range");let pr=JSBI.subtract(fr,Ee);JSBI.lessThan(pr,Me)&&(pr=fr);let lr=JSBI.add(fr,Ee);JSBI.greaterThan(lr,Re)&&(lr=fr);const yr=GetNamedTimeZoneOffsetNanoseconds(Lt,pr),br=GetNamedTimeZoneOffsetNanoseconds(Lt,lr);return(yr===br?[yr]:[yr,br]).map(Ar=>{const Pr=JSBI.subtract(fr,JSBI.BigInt(Ar)),kr=GetNamedTimeZoneDateTimeParts(Lt,Pr);if(er===kr.year&&tr===kr.month&&zt===kr.day&&rr===kr.hour&&nr===kr.minute&&ir===kr.second&&ar===kr.millisecond&&dr===kr.microsecond&&ur===kr.nanosecond)return Pr}).filter(Ar=>Ar!==void 0)}(Bt,GetSlot(At,i$1),GetSlot(At,s$1),GetSlot(At,l),GetSlot(At,d$1),GetSlot(At,m$1),GetSlot(At,c),GetSlot(At,h$1),GetSlot(At,u),GetSlot(At,T)).map(jt=>new kt(jt))}getNextTransition(e){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");const At=ToTemporalInstant(e),kt=GetSlot(this,a);if(IsTimeZoneOffsetString(kt)||kt==="UTC")return null;let Bt=GetSlot(At,n);const Nt=GetIntrinsic("%Temporal.Instant%");return Bt=GetNamedTimeZoneNextTransition(kt,Bt),Bt===null?null:new Nt(Bt)}getPreviousTransition(e){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");const At=ToTemporalInstant(e),kt=GetSlot(this,a);if(IsTimeZoneOffsetString(kt)||kt==="UTC")return null;let Bt=GetSlot(At,n);const Nt=GetIntrinsic("%Temporal.Instant%");return Bt=GetNamedTimeZonePreviousTransition(kt,Bt),Bt===null?null:new Nt(Bt)}toString(){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetSlot(this,a)}toJSON(){if(!IsTemporalTimeZone(this))throw new TypeError("invalid receiver");return GetSlot(this,a)}static from(e){return ToTemporalTimeZoneObject(ToTemporalTimeZoneSlotValue(e))}}MakeIntrinsicClass(TimeZone,"Temporal.TimeZone"),DefineIntrinsic("Temporal.TimeZone.prototype.getOffsetNanosecondsFor",TimeZone.prototype.getOffsetNanosecondsFor),DefineIntrinsic("Temporal.TimeZone.prototype.getPossibleInstantsFor",TimeZone.prototype.getPossibleInstantsFor);const Rt=Object.create;class PlainYearMonth{constructor(e,At,kt="iso8601",Bt=1){CreateTemporalYearMonthSlots(this,ToIntegerWithTruncation(e),ToIntegerWithTruncation(At),ToTemporalCalendarSlotValue(kt),ToIntegerWithTruncation(Bt))}get year(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarYear(GetSlot(this,p),this)}get month(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarMonth(GetSlot(this,p),this)}get monthCode(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarMonthCode(GetSlot(this,p),this)}get calendarId(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return ToTemporalCalendarIdentifier(GetSlot(this,p))}get era(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarEra(GetSlot(this,p),this)}get eraYear(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarEraYear(GetSlot(this,p),this)}get daysInMonth(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarDaysInMonth(GetSlot(this,p),this)}get daysInYear(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarDaysInYear(GetSlot(this,p),this)}get monthsInYear(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarMonthsInYear(GetSlot(this,p),this)}get inLeapYear(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return CalendarInLeapYear(GetSlot(this,p),this)}with(e,At){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid argument");RejectTemporalLikeObject(e);const kt=GetOptionsObject(At),Bt=GetSlot(this,p),Nt=CalendarFields(Bt,["month","monthCode","year"]);let jt=PrepareTemporalFields(this,Nt,[]);return jt=CalendarMergeFields(Bt,jt,PrepareTemporalFields(e,Nt,"partial")),jt=PrepareTemporalFields(jt,Nt,[]),CalendarYearMonthFromFields(Bt,jt,kt)}add(e,At){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainYearMonth("add",this,e,At)}subtract(e,At){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromPlainYearMonth("subtract",this,e,At)}until(e,At){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainYearMonth("until",this,e,At)}since(e,At){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return DifferenceTemporalPlainYearMonth("since",this,e,At)}equals(e){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");const At=ToTemporalYearMonth(e);for(const kt of[i$1,s$1,l])if(GetSlot(this,kt)!==GetSlot(At,kt))return!1;return CalendarEquals(GetSlot(this,p),GetSlot(At,p))}toString(e){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return TemporalYearMonthToString(this,ToCalendarNameOption(GetOptionsObject(e)))}toJSON(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return TemporalYearMonthToString(this)}toLocaleString(e,At){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return new ht(e,At).format(this)}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.PlainYearMonth")}toPlainDate(e){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("argument should be an object");const At=GetSlot(this,p),kt=CalendarFields(At,["monthCode","year"]),Bt=PrepareTemporalFields(this,kt,[]),Nt=CalendarFields(At,["day"]);let jt=CalendarMergeFields(At,Bt,PrepareTemporalFields(e,Nt,[]));jt=PrepareTemporalFields(jt,[...new Set([...kt,...Nt])],[]);const Lt=Rt(null);return Lt.overflow="reject",CalendarDateFromFields(At,jt,Lt)}getISOFields(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return{calendar:GetSlot(this,p),isoDay:GetSlot(this,l),isoMonth:GetSlot(this,s$1),isoYear:GetSlot(this,i$1)}}getCalendar(){if(!IsTemporalYearMonth(this))throw new TypeError("invalid receiver");return ToTemporalCalendarObject(GetSlot(this,p))}static from(e,At){const kt=GetOptionsObject(At);return IsTemporalYearMonth(e)?(ToTemporalOverflow(kt),CreateTemporalYearMonth(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,p),GetSlot(e,l))):ToTemporalYearMonth(e,kt)}static compare(e,At){const kt=ToTemporalYearMonth(e),Bt=ToTemporalYearMonth(At);return CompareISODate(GetSlot(kt,i$1),GetSlot(kt,s$1),GetSlot(kt,l),GetSlot(Bt,i$1),GetSlot(Bt,s$1),GetSlot(Bt,l))}}MakeIntrinsicClass(PlainYearMonth,"Temporal.PlainYearMonth");const Ft=ht.prototype.resolvedOptions,Yt=Object.create;class ZonedDateTime{constructor(e,At,kt="iso8601"){if(arguments.length<1)throw new TypeError("missing argument: epochNanoseconds is required");CreateTemporalZonedDateTimeSlots(this,ToBigInt(e),ToTemporalTimeZoneSlotValue(At),ToTemporalCalendarSlotValue(kt))}get calendarId(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToTemporalCalendarIdentifier(GetSlot(this,p))}get timeZoneId(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToTemporalTimeZoneIdentifier(GetSlot(this,g))}get year(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarYear(GetSlot(this,p),dateTime(this))}get month(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarMonth(GetSlot(this,p),dateTime(this))}get monthCode(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarMonthCode(GetSlot(this,p),dateTime(this))}get day(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDay(GetSlot(this,p),dateTime(this))}get hour(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),d$1)}get minute(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),m$1)}get second(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),c)}get millisecond(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),h$1)}get microsecond(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),u)}get nanosecond(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetSlot(dateTime(this),T)}get era(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarEra(GetSlot(this,p),dateTime(this))}get eraYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarEraYear(GetSlot(this,p),dateTime(this))}get epochSeconds(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,n);return JSBI.toNumber(BigIntFloorDiv(e,ve))}get epochMilliseconds(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,n);return JSBI.toNumber(BigIntFloorDiv(e,Ge))}get epochMicroseconds(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToBigIntExternal(BigIntFloorDiv(GetSlot(this,n),De))}get epochNanoseconds(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToBigIntExternal(GetSlot(this,n))}get dayOfWeek(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDayOfWeek(GetSlot(this,p),dateTime(this))}get dayOfYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDayOfYear(GetSlot(this,p),dateTime(this))}get weekOfYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarWeekOfYear(GetSlot(this,p),dateTime(this))}get yearOfWeek(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarYearOfWeek(GetSlot(this,p),dateTime(this))}get hoursInDay(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=dateTime(this),At=GetIntrinsic("%Temporal.PlainDateTime%"),kt=GetSlot(e,i$1),Bt=GetSlot(e,s$1),Nt=GetSlot(e,l),jt=new At(kt,Bt,Nt,0,0,0,0,0,0),Lt=AddISODate(kt,Bt,Nt,0,0,0,1,"reject"),er=new At(Lt.year,Lt.month,Lt.day,0,0,0,0,0,0),tr=GetSlot(this,g),zt=GetSlot(GetInstantFor(tr,jt,"compatible"),n),rr=GetSlot(GetInstantFor(tr,er,"compatible"),n);return BigIntDivideToNumber(JSBI.subtract(rr,zt),Oe)}get daysInWeek(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInWeek(GetSlot(this,p),dateTime(this))}get daysInMonth(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInMonth(GetSlot(this,p),dateTime(this))}get daysInYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarDaysInYear(GetSlot(this,p),dateTime(this))}get monthsInYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarMonthsInYear(GetSlot(this,p),dateTime(this))}get inLeapYear(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return CalendarInLeapYear(GetSlot(this,p),dateTime(this))}get offset(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetOffsetStringFor(GetSlot(this,g),GetSlot(this,S))}get offsetNanoseconds(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return GetOffsetNanosecondsFor(GetSlot(this,g),GetSlot(this,S))}with(e,At){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");if(!IsObject(e))throw new TypeError("invalid zoned-date-time-like");RejectTemporalLikeObject(e);const kt=GetOptionsObject(At),Bt=GetSlot(this,p);let Nt=CalendarFields(Bt,["day","hour","microsecond","millisecond","minute","month","monthCode","nanosecond","second","year"]);Nt.push("offset");let jt=PrepareTemporalFields(this,Nt,["offset"]);jt=CalendarMergeFields(Bt,jt,PrepareTemporalFields(e,Nt,"partial")),jt=PrepareTemporalFields(jt,Nt,["offset"]);const Lt=ToTemporalDisambiguation(kt),er=ToTemporalOffset(kt,"prefer");let{year:tr,month:zt,day:rr,hour:nr,minute:ir,second:ar,millisecond:dr,microsecond:ur,nanosecond:fr}=InterpretTemporalDateTimeFields(Bt,jt,kt);const pr=ParseTimeZoneOffsetString(jt.offset),lr=GetSlot(this,g);return CreateTemporalZonedDateTime(InterpretISODateTimeOffset(tr,zt,rr,nr,ir,ar,dr,ur,fr,"option",pr,lr,Lt,er,!1),lr,Bt)}withPlainDate(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const At=ToTemporalDate(e),kt=GetSlot(At,i$1),Bt=GetSlot(At,s$1),Nt=GetSlot(At,l);let jt=GetSlot(At,p);const Lt=dateTime(this),er=GetSlot(Lt,d$1),tr=GetSlot(Lt,m$1),zt=GetSlot(Lt,c),rr=GetSlot(Lt,h$1),nr=GetSlot(Lt,u),ir=GetSlot(Lt,T);jt=ConsolidateCalendars(GetSlot(this,p),jt);const ar=GetSlot(this,g);return CreateTemporalZonedDateTime(GetSlot(GetInstantFor(ar,new(GetIntrinsic("%Temporal.PlainDateTime%"))(kt,Bt,Nt,er,tr,zt,rr,nr,ir,jt),"compatible"),n),ar,jt)}withPlainTime(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const At=GetIntrinsic("%Temporal.PlainTime%"),kt=e===void 0?new At:ToTemporalTime(e),Bt=dateTime(this),Nt=GetSlot(Bt,i$1),jt=GetSlot(Bt,s$1),Lt=GetSlot(Bt,l),er=GetSlot(this,p),tr=GetSlot(kt,d$1),zt=GetSlot(kt,m$1),rr=GetSlot(kt,c),nr=GetSlot(kt,h$1),ir=GetSlot(kt,u),ar=GetSlot(kt,T),dr=GetSlot(this,g);return CreateTemporalZonedDateTime(GetSlot(GetInstantFor(dr,new(GetIntrinsic("%Temporal.PlainDateTime%"))(Nt,jt,Lt,tr,zt,rr,nr,ir,ar,er),"compatible"),n),dr,er)}withTimeZone(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const At=ToTemporalTimeZoneSlotValue(e);return CreateTemporalZonedDateTime(GetSlot(this,n),At,GetSlot(this,p))}withCalendar(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const At=ToTemporalCalendarSlotValue(e);return CreateTemporalZonedDateTime(GetSlot(this,n),GetSlot(this,g),At)}add(e,At){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromZonedDateTime("add",this,e,At)}subtract(e,At){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return AddDurationToOrSubtractDurationFromZonedDateTime("subtract",this,e,At)}until(e,At){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalZonedDateTime("until",this,e,At)}since(e,At){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return DifferenceTemporalZonedDateTime("since",this,e,At)}round(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");if(e===void 0)throw new TypeError("options parameter is required");const At=typeof e=="string"?CreateOnePropObject("smallestUnit",e):GetOptionsObject(e),kt=ToTemporalRoundingIncrement(At),Bt=ToTemporalRoundingMode(At,"halfExpand"),Nt=GetTemporalUnit(At,"smallestUnit","time",He,["day"]),jt={day:1,hour:24,minute:60,second:60,millisecond:1e3,microsecond:1e3,nanosecond:1e3}[Nt];ValidateTemporalRoundingIncrement(kt,jt,jt===1);const Lt=dateTime(this);let er=GetSlot(Lt,i$1),tr=GetSlot(Lt,s$1),zt=GetSlot(Lt,l),rr=GetSlot(Lt,d$1),nr=GetSlot(Lt,m$1),ir=GetSlot(Lt,c),ar=GetSlot(Lt,h$1),dr=GetSlot(Lt,u),ur=GetSlot(Lt,T);const fr=GetIntrinsic("%Temporal.PlainDateTime%"),pr=GetSlot(this,g),lr=GetSlot(this,p),yr=GetInstantFor(pr,new fr(GetSlot(Lt,i$1),GetSlot(Lt,s$1),GetSlot(Lt,l),0,0,0,0,0,0),"compatible"),br=AddZonedDateTime(yr,pr,lr,0,0,0,1,0,0,0,0,0,0),Ar=JSBI.subtract(br,JSBI.BigInt(GetSlot(yr,n)));if(JSBI.lessThanOrEqual(Ar,Ie))throw new RangeError("cannot round a ZonedDateTime in a calendar with zero or negative length days");return{year:er,month:tr,day:zt,hour:rr,minute:nr,second:ir,millisecond:ar,microsecond:dr,nanosecond:ur}=RoundISODateTime(er,tr,zt,rr,nr,ir,ar,dr,ur,kt,Nt,Bt,JSBI.toNumber(Ar)),CreateTemporalZonedDateTime(InterpretISODateTimeOffset(er,tr,zt,rr,nr,ir,ar,dr,ur,"option",GetOffsetNanosecondsFor(pr,GetSlot(this,S)),pr,"compatible","prefer",!1),pr,GetSlot(this,p))}equals(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const At=ToTemporalZonedDateTime(e),kt=GetSlot(this,n),Bt=GetSlot(At,n);return!!JSBI.equal(JSBI.BigInt(kt),JSBI.BigInt(Bt))&&!!TimeZoneEquals(GetSlot(this,g),GetSlot(At,g))&&CalendarEquals(GetSlot(this,p),GetSlot(At,p))}toString(e){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const At=GetOptionsObject(e),kt=ToCalendarNameOption(At),Bt=ToFractionalSecondDigits(At),Nt=function(ir){return GetOption(ir,"offset",["auto","never"],"auto")}(At),jt=ToTemporalRoundingMode(At,"trunc"),Lt=GetTemporalUnit(At,"smallestUnit","time",void 0);if(Lt==="hour")throw new RangeError('smallestUnit must be a time unit other than "hour"');const er=function(ir){return GetOption(ir,"timeZoneName",["auto","never","critical"],"auto")}(At),{precision:tr,unit:zt,increment:rr}=ToSecondsStringPrecisionRecord(Lt,Bt);return TemporalZonedDateTimeToString(this,tr,kt,er,Nt,{unit:zt,increment:rr,roundingMode:jt})}toLocaleString(e,At){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const kt=GetOptionsObject(At),Bt=Yt(null);if(CopyDataProperties(Bt,kt,["timeZone"]),kt.timeZone!==void 0)throw new TypeError("ZonedDateTime toLocaleString does not accept a timeZone option");Bt.year===void 0&&Bt.month===void 0&&Bt.day===void 0&&Bt.weekday===void 0&&Bt.dateStyle===void 0&&Bt.hour===void 0&&Bt.minute===void 0&&Bt.second===void 0&&Bt.timeStyle===void 0&&Bt.dayPeriod===void 0&&Bt.timeZoneName===void 0&&(Bt.timeZoneName="short");let Nt=ToTemporalTimeZoneIdentifier(GetSlot(this,g));if(IsTimeZoneOffsetString(Nt))throw new RangeError("toLocaleString does not support offset string time zones");Nt=GetCanonicalTimeZoneIdentifier(Nt),Bt.timeZone=Nt;const jt=new ht(e,Bt),Lt=Call(Ft,jt,[]).calendar,er=ToTemporalCalendarIdentifier(GetSlot(this,p));if(er!=="iso8601"&&Lt!=="iso8601"&&Lt!==er)throw new RangeError(`cannot format ZonedDateTime with calendar ${er} in locale with calendar ${Lt}`);return jt.format(GetSlot(this,S))}toJSON(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return TemporalZonedDateTimeToString(this,"auto")}valueOf(){throw new TypeError("use compare() or equals() to compare Temporal.ZonedDateTime")}startOfDay(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=dateTime(this),At=GetIntrinsic("%Temporal.PlainDateTime%"),kt=GetSlot(this,p),Bt=new At(GetSlot(e,i$1),GetSlot(e,s$1),GetSlot(e,l),0,0,0,0,0,0,kt),Nt=GetSlot(this,g);return CreateTemporalZonedDateTime(GetSlot(GetInstantFor(Nt,Bt,"compatible"),n),Nt,kt)}toInstant(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return new(GetIntrinsic("%Temporal.Instant%"))(GetSlot(this,n))}toPlainDate(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return TemporalDateTimeToDate(dateTime(this))}toPlainTime(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return TemporalDateTimeToTime(dateTime(this))}toPlainDateTime(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return dateTime(this)}toPlainYearMonth(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarYearMonthFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["monthCode","year"]),[]))}toPlainMonthDay(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=GetSlot(this,p);return CalendarMonthDayFromFields(e,PrepareTemporalFields(this,CalendarFields(e,["day","monthCode"]),[]))}getISOFields(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");const e=dateTime(this),At=GetSlot(this,g);return{calendar:GetSlot(this,p),isoDay:GetSlot(e,l),isoHour:GetSlot(e,d$1),isoMicrosecond:GetSlot(e,u),isoMillisecond:GetSlot(e,h$1),isoMinute:GetSlot(e,m$1),isoMonth:GetSlot(e,s$1),isoNanosecond:GetSlot(e,T),isoSecond:GetSlot(e,c),isoYear:GetSlot(e,i$1),offset:GetOffsetStringFor(At,GetSlot(this,S)),timeZone:At}}getCalendar(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToTemporalCalendarObject(GetSlot(this,p))}getTimeZone(){if(!IsTemporalZonedDateTime(this))throw new TypeError("invalid receiver");return ToTemporalTimeZoneObject(GetSlot(this,g))}static from(e,At){const kt=GetOptionsObject(At);return IsTemporalZonedDateTime(e)?(ToTemporalDisambiguation(kt),ToTemporalOffset(kt,"reject"),ToTemporalOverflow(kt),CreateTemporalZonedDateTime(GetSlot(e,n),GetSlot(e,g),GetSlot(e,p))):ToTemporalZonedDateTime(e,kt)}static compare(e,At){const kt=ToTemporalZonedDateTime(e),Bt=ToTemporalZonedDateTime(At),Nt=GetSlot(kt,n),jt=GetSlot(Bt,n);return JSBI.lessThan(JSBI.BigInt(Nt),JSBI.BigInt(jt))?-1:JSBI.greaterThan(JSBI.BigInt(Nt),JSBI.BigInt(jt))?1:0}}function dateTime(xt){return GetPlainDateTimeFor(GetSlot(xt,g),GetSlot(xt,S),GetSlot(xt,p))}MakeIntrinsicClass(ZonedDateTime,"Temporal.ZonedDateTime");var Pt=Object.freeze({__proto__:null,Calendar,Duration,Instant,Now:Et,PlainDate,PlainDateTime,PlainMonthDay,PlainTime,PlainYearMonth,TimeZone,ZonedDateTime});const Zt=[Instant,Calendar,PlainDate,PlainDateTime,Duration,PlainMonthDay,PlainTime,TimeZone,PlainYearMonth,ZonedDateTime];for(const xt of Zt){const e=Object.getOwnPropertyDescriptor(xt,"prototype");(e.configurable||e.enumerable||e.writable)&&(e.configurable=!1,e.enumerable=!1,e.writable=!1,Object.defineProperty(xt,"prototype",e))}var __awaiter$34=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Time{static sleep(e){return __awaiter$34(this,void 0,void 0,function*(){return new Promise(At=>setTimeout(At,e))})}static minimalSleep(){return __awaiter$34(this,void 0,void 0,function*(){yield Time.sleep(2)})}static getCurrentTimestamp(){return Pt.Now.instant().toString({smallestUnit:"microseconds"})}static createTimestamp(e){const{year:At,month:kt,day:Bt,hour:Nt,minute:jt,second:Lt,millisecond:er,microsecond:tr}=e;return Pt.ZonedDateTime.from({timeZone:"UTC",year:At,month:kt,day:Bt,hour:Nt,minute:jt,second:Lt,millisecond:er,microsecond:tr}).toInstant().toString({smallestUnit:"microseconds"})}static createOffsetTimestamp(e,At){const kt=At?Pt.Instant.from(At):Pt.Now.instant(),Bt=Pt.Duration.from(e);return kt.add(Bt).toString({smallestUnit:"microseconds"})}static validateTimestamp(e){try{Pt.Instant.from(e)}catch{throw new DwnError(DwnErrorCode.TimestampInvalid,`Invalid timestamp: ${e}`)}}}var __awaiter$33=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$G=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class RecordsWrite{get message(){if(this._message.authorization===void 0)throw new DwnError(DwnErrorCode.RecordsWriteMissingSigner,"This RecordsWrite is not yet signed, JSON message cannot be generated from an incomplete state.");return this._message}get author(){return this._author}get signaturePayload(){return this._signaturePayload}get owner(){return this._owner}get ownerSignaturePayload(){return this._ownerSignaturePayload}get isSignedByAuthorDelegate(){return Message.isSignedByAuthorDelegate(this._message)}get isSignedByOwnerDelegate(){return Message.isSignedByOwnerDelegate(this._message)}get signer(){return Message.getSigner(this._message)}get ownerSignatureSigner(){var e;return((e=this._message.authorization)===null||e===void 0?void 0:e.ownerSignature)===void 0?void 0:Jws.getSignerDid(this._message.authorization.ownerSignature.signatures[0])}constructor(e,At){this.parentContextId=At,this._message=e,e.authorization!==void 0&&(this._author=Message.getAuthor(e),this._signaturePayload=Jws.decodePlainObjectPayload(e.authorization.signature),e.authorization.ownerSignature!==void 0&&(e.authorization.ownerDelegatedGrant!==void 0?this._owner=Message.getSigner(e.authorization.ownerDelegatedGrant):this._owner=Jws.getSignerDid(e.authorization.ownerSignature.signatures[0]),this._ownerSignaturePayload=Jws.decodePlainObjectPayload(e.authorization.ownerSignature))),this.attesters=RecordsWrite.getAttesters(e)}static parse(e){return __awaiter$33(this,void 0,void 0,function*(){const At=JSON.parse(JSON.stringify(e));yield Message.validateSignatureStructure(At.authorization.signature,At.descriptor,"RecordsWriteSignaturePayload"),At.authorization.ownerSignature!==void 0&&(yield Message.validateSignatureStructure(At.authorization.ownerSignature,At.descriptor)),yield RecordsWrite.validateAttestationIntegrity(At);const kt=new RecordsWrite(At);return yield kt.validateIntegrity(),kt})}static create(e){var At,kt,Bt,Nt;return __awaiter$33(this,void 0,void 0,function*(){if(e.protocol===void 0&&e.protocolPath!==void 0||e.protocol!==void 0&&e.protocolPath===void 0)throw new DwnError(DwnErrorCode.RecordsWriteCreateProtocolAndProtocolPathMutuallyInclusive,"`protocol` and `protocolPath` must both be defined or undefined at the same time");if(e.data===void 0&&e.dataCid===void 0||e.data!==void 0&&e.dataCid!==void 0)throw new DwnError(DwnErrorCode.RecordsWriteCreateDataAndDataCidMutuallyExclusive,"one and only one parameter between `data` and `dataCid` is required");if(e.dataCid===void 0&&e.dataSize!==void 0||e.dataCid!==void 0&&e.dataSize===void 0)throw new DwnError(DwnErrorCode.RecordsWriteCreateDataCidAndDataSizeMutuallyInclusive,"`dataCid` and `dataSize` must both be defined or undefined at the same time");if(e.signer===void 0&&e.delegatedGrant!==void 0)throw new DwnError(DwnErrorCode.RecordsWriteCreateMissingSigner,"`signer` must be given when `delegatedGrant` is given");const jt=(At=e.dataCid)!==null&&At!==void 0?At:yield Cid.computeDagPbCidFromBytes(e.data),Lt=(kt=e.dataSize)!==null&&kt!==void 0?kt:e.data.length,er=Time.getCurrentTimestamp(),tr={interface:DwnInterfaceName.Records,method:DwnMethodName.Write,protocol:e.protocol!==void 0?normalizeProtocolUrl(e.protocol):void 0,protocolPath:e.protocolPath,recipient:e.recipient,schema:e.schema!==void 0?normalizeSchemaUrl(e.schema):void 0,tags:e.tags,parentId:RecordsWrite.getRecordIdFromContextId(e.parentContextId),dataCid:jt,dataSize:Lt,dateCreated:(Bt=e.dateCreated)!==null&&Bt!==void 0?Bt:er,messageTimestamp:(Nt=e.messageTimestamp)!==null&&Nt!==void 0?Nt:er,published:e.published,datePublished:e.datePublished,dataFormat:e.dataFormat};e.published===!0&&e.datePublished===void 0&&(tr.datePublished=er),removeUndefinedProperties$3(tr);const zt=e.recordId,rr=yield Cid.computeCid(tr),nr=yield RecordsWrite.createAttestation(rr,e.attestationSigners),ir=yield RecordsWrite.createEncryptionProperty(tr,e.encryptionInput),ar={recordId:zt,descriptor:tr};nr!==void 0&&(ar.attestation=nr),ir!==void 0&&(ar.encryption=ir);const dr=new RecordsWrite(ar,e.parentContextId);return e.signer!==void 0&&(yield dr.sign({signer:e.signer,delegatedGrant:e.delegatedGrant,permissionGrantId:e.permissionGrantId,protocolRole:e.protocolRole})),dr})}static getRecordIdFromContextId(e){return e==null?void 0:e.split("/").filter(At=>At!=="").pop()}static createFrom(e){var At,kt,Bt,Nt;return __awaiter$33(this,void 0,void 0,function*(){const jt=e.recordsWriteMessage,Lt=yield RecordsWrite.parse(jt),er=Time.getCurrentTimestamp(),tr=(At=e.published)!==null&&At!==void 0?At:e.datePublished?!0:jt.descriptor.published;let zt;e.datePublished?zt=e.datePublished:tr&&(jt.descriptor.published?zt=jt.descriptor.datePublished:zt=er);const rr={recipient:jt.descriptor.recipient,recordId:jt.recordId,dateCreated:jt.descriptor.dateCreated,protocol:jt.descriptor.protocol,protocolPath:jt.descriptor.protocolPath,schema:jt.descriptor.schema,parentContextId:Records.getParentContextFromOfContextId(jt.contextId),messageTimestamp:(kt=e.messageTimestamp)!==null&&kt!==void 0?kt:er,published:tr,datePublished:zt,tags:e.tags,data:e.data,dataCid:e.data?void 0:jt.descriptor.dataCid,dataSize:e.data?void 0:jt.descriptor.dataSize,dataFormat:(Bt=e.dataFormat)!==null&&Bt!==void 0?Bt:jt.descriptor.dataFormat,protocolRole:(Nt=e.protocolRole)!==null&&Nt!==void 0?Nt:Lt.signaturePayload.protocolRole,delegatedGrant:e.delegatedGrant,signer:e.signer,attestationSigners:e.attestationSigners};return yield RecordsWrite.create(rr)})}toJSON(){return this.message}encryptSymmetricEncryptionKey(e){return __awaiter$33(this,void 0,void 0,function*(){this._message.encryption=yield RecordsWrite.createEncryptionProperty(this._message.descriptor,e),delete this._message.authorization,this._signaturePayload=void 0,this._author=void 0})}sign(e){var At;return __awaiter$33(this,void 0,void 0,function*(){const{signer:kt,delegatedGrant:Bt,permissionGrantId:Nt,protocolRole:jt}=e;let Lt,er;Bt!==void 0?(Lt=yield Message.getCid(Bt),er=Jws.getSignerDid(Bt.authorization.signature.signatures[0])):er=Jws.extractDid(kt.keyId);const tr=this._message.descriptor,zt=yield Cid.computeCid(tr);this._message.recordId=(At=this._message.recordId)!==null&&At!==void 0?At:yield RecordsWrite.getEntryId(er,tr),this._message.descriptor.protocol!==void 0&&(this.parentContextId===void 0||this.parentContextId===""?this._message.contextId=this._message.recordId:this._message.contextId=this.parentContextId+"/"+this._message.recordId);const rr=yield RecordsWrite.createSignerSignature({recordId:this._message.recordId,contextId:this._message.contextId,descriptorCid:zt,attestation:this._message.attestation,encryption:this._message.encryption,signer:kt,delegatedGrantId:Lt,permissionGrantId:Nt,protocolRole:jt});this._message.authorization={signature:rr},Bt!==void 0&&(this._message.authorization.authorDelegatedGrant=Bt),this._signaturePayload=Jws.decodePlainObjectPayload(rr),this._author=er})}signAsOwner(e){return __awaiter$33(this,void 0,void 0,function*(){if(this._author===void 0)throw new DwnError(DwnErrorCode.RecordsWriteSignAsOwnerUnknownAuthor,"Unable to sign as owner without message signature because owner needs to sign over `recordId` which depends on author DID.");const At=this._message.descriptor,kt=yield Message.createSignature(At,e);this._message.authorization.ownerSignature=kt,this._ownerSignaturePayload=Jws.decodePlainObjectPayload(kt),this._owner=Jws.extractDid(e.keyId)})}signAsOwnerDelegate(e,At){return __awaiter$33(this,void 0,void 0,function*(){if(this._author===void 0)throw new DwnError(DwnErrorCode.RecordsWriteSignAsOwnerDelegateUnknownAuthor,"Unable to sign as owner delegate without message signature because owner delegate needs to sign over `recordId` which depends on author DID.");const kt=yield Message.getCid(At),Bt=this._message.descriptor,Nt=yield Message.createSignature(Bt,e,{delegatedGrantId:kt});this._message.authorization.ownerSignature=Nt,this._message.authorization.ownerDelegatedGrant=At,this._ownerSignaturePayload=Jws.decodePlainObjectPayload(Nt),this._owner=Jws.getSignerDid(At.authorization.signature.signatures[0])})}validateIntegrity(){return __awaiter$33(this,void 0,void 0,function*(){if(yield this.isInitialWrite()){const kt=this.message.descriptor.dateCreated,Bt=this.message.descriptor.messageTimestamp;if(Bt!==kt)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityDateCreatedMismatch,`messageTimestamp ${Bt} must match dateCreated ${kt} for the initial write`);if(this.message.descriptor.protocol!==void 0&&this.message.descriptor.parentId===void 0){const Nt=yield this.getEntryId();if(this.message.contextId!==Nt)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityContextIdMismatch,`contextId in message: ${this.message.contextId} does not match deterministic contextId: ${Nt}`)}}const At=this.signaturePayload;if(this.message.recordId!==At.recordId)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityRecordIdUnauthorized,`recordId in message ${this.message.recordId} does not match recordId in authorization: ${At.recordId}`);if(this.message.contextId!==At.contextId)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityContextIdNotInSignerSignaturePayload,`contextId in message ${this.message.contextId} does not match contextId in authorization: ${At.contextId}`);if(yield Records.validateDelegatedGrantReferentialIntegrity(this.message,At,this.ownerSignaturePayload),At.attestationCid!==void 0){const kt=yield Cid.computeCid(this.message.attestation),Bt=At.attestationCid;if(Bt!==kt)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityAttestationMismatch,`CID ${kt} of attestation property in message does not match attestationCid in authorization: ${Bt}`)}if(At.encryptionCid!==void 0){const kt=yield Cid.computeCid(this.message.encryption),Bt=At.encryptionCid;if(Bt!==kt)throw new DwnError(DwnErrorCode.RecordsWriteValidateIntegrityEncryptionCidMismatch,`CID ${kt} of encryption property in message does not match encryptionCid in authorization: ${Bt}`)}this.message.descriptor.protocol!==void 0&&validateProtocolUrlNormalized(this.message.descriptor.protocol),this.message.descriptor.schema!==void 0&&validateSchemaUrlNormalized(this.message.descriptor.schema),Time.validateTimestamp(this.message.descriptor.messageTimestamp),Time.validateTimestamp(this.message.descriptor.dateCreated),this.message.descriptor.datePublished&&Time.validateTimestamp(this.message.descriptor.datePublished)})}static validateAttestationIntegrity(e){return __awaiter$33(this,void 0,void 0,function*(){if(e.attestation===void 0)return;if(e.attestation.signatures.length!==1)throw new DwnError(DwnErrorCode.RecordsWriteAttestationIntegrityMoreThanOneSignature,`Currently implementation only supports 1 attester, but got ${e.attestation.signatures.length}`);const At=Jws.decodePlainObjectPayload(e.attestation),{descriptorCid:kt}=At,Bt=yield Cid.computeCid(e.descriptor);if(kt!==Bt)throw new DwnError(DwnErrorCode.RecordsWriteAttestationIntegrityDescriptorCidMismatch,`descriptorCid ${kt} does not match expected descriptorCid ${Bt}`);const Nt=Object.keys(At).length;if(Nt>1)throw new DwnError(DwnErrorCode.RecordsWriteAttestationIntegrityInvalidPayloadProperty,`Only 'descriptorCid' is allowed in attestation payload, but got ${Nt} properties.`)})}getEntryId(){return __awaiter$33(this,void 0,void 0,function*(){return yield RecordsWrite.getEntryId(this.author,this.message.descriptor)})}static getEntryId(e,At){return __awaiter$33(this,void 0,void 0,function*(){if(e===void 0)throw new DwnError(DwnErrorCode.RecordsWriteGetEntryIdUndefinedAuthor,"Property `author` is needed to compute entry ID.");const kt=Object.assign({},At);return kt.author=e,yield Cid.computeCid(kt)})}isInitialWrite(){return __awaiter$33(this,void 0,void 0,function*(){return(yield this.getEntryId())===this.message.recordId})}constructIndexes(e){return __awaiter$33(this,void 0,void 0,function*(){const At=this.message,kt=At.descriptor,{tags:Bt}=kt,Nt=__rest$G(kt,["tags"]);delete Nt.published;let jt=Object.assign(Object.assign({},Nt),{isLatestBaseState:e,published:!!At.descriptor.published,author:this.author,recordId:At.recordId,entryId:yield RecordsWrite.getEntryId(this.author,this.message.descriptor)});if(Bt!==void 0&&e===!0){const Lt=Records.buildTagIndexes(Object.assign({},Bt));jt=Object.assign(Object.assign({},jt),Lt)}return this.attesters.length>0&&(jt.attester=this.attesters[0]),At.contextId!==void 0&&(jt.contextId=At.contextId),jt})}authorizeAuthorDelegate(e){return __awaiter$33(this,void 0,void 0,function*(){const At=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield RecordsGrantAuthorization.authorizeWrite({recordsWriteMessage:this.message,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:At,messageStore:e})})}authorizeOwnerDelegate(e){return __awaiter$33(this,void 0,void 0,function*(){const At=yield PermissionGrant$1.parse(this.message.authorization.ownerDelegatedGrant);yield RecordsGrantAuthorization.authorizeWrite({recordsWriteMessage:this.message,expectedGrantor:this.owner,expectedGrantee:this.ownerSignatureSigner,permissionGrant:At,messageStore:e})})}static isInitialWrite(e){return __awaiter$33(this,void 0,void 0,function*(){if(e.descriptor.interface!==DwnInterfaceName.Records||e.descriptor.method!==DwnMethodName.Write)return!1;const At=e,kt=Message.getAuthor(At);return(yield RecordsWrite.getEntryId(kt,At.descriptor))===At.recordId})}static createEncryptionProperty(e,At){var kt,Bt;return __awaiter$33(this,void 0,void 0,function*(){if(At===void 0)return;const Nt=[];for(const Lt of At.keyEncryptionInputs){if(Lt.derivationScheme===KeyDerivationScheme.ProtocolPath&&e.protocol===void 0)throw new DwnError(DwnErrorCode.RecordsWriteMissingProtocol,"`protocols` encryption scheme cannot be applied to record without the `protocol` property.");if(Lt.derivationScheme===KeyDerivationScheme.Schemas&&e.schema===void 0)throw new DwnError(DwnErrorCode.RecordsWriteMissingSchema,"`schemas` encryption scheme cannot be applied to record without the `schema` property.");const er=Secp256k1$3.publicJwkToBytes(Lt.publicKey),tr=yield Encryption.eciesSecp256k1Encrypt(er,At.key),zt=Encoder$4.bytesToBase64Url(tr.ciphertext),rr=yield Secp256k1$3.publicKeyToJwk(tr.ephemeralPublicKey),nr=Encoder$4.bytesToBase64Url(tr.initializationVector),ir=Encoder$4.bytesToBase64Url(tr.messageAuthenticationCode),ar={rootKeyId:Lt.publicKeyId,algorithm:(kt=Lt.algorithm)!==null&&kt!==void 0?kt:EncryptionAlgorithm.EciesSecp256k1,derivationScheme:Lt.derivationScheme,ephemeralPublicKey:rr,initializationVector:nr,messageAuthenticationCode:ir,encryptedKey:zt};Lt.derivationScheme===KeyDerivationScheme.ProtocolContext&&(ar.derivedPublicKey=Lt.publicKey),Nt.push(ar)}return{algorithm:(Bt=At.algorithm)!==null&&Bt!==void 0?Bt:EncryptionAlgorithm.Aes256Ctr,initializationVector:Encoder$4.bytesToBase64Url(At.initializationVector),keyEncryption:Nt}})}static createAttestation(e,At){return __awaiter$33(this,void 0,void 0,function*(){if(At===void 0||At.length===0)return;const kt={descriptorCid:e},Bt=Encoder$4.objectToBytes(kt);return(yield GeneralJwsBuilder.create(Bt,At)).getJws()})}static createSignerSignature(e){return __awaiter$33(this,void 0,void 0,function*(){const{recordId:At,contextId:kt,descriptorCid:Bt,attestation:Nt,encryption:jt,signer:Lt,delegatedGrantId:er,permissionGrantId:tr,protocolRole:zt}=e,rr=Nt?yield Cid.computeCid(Nt):void 0,nr=jt?yield Cid.computeCid(jt):void 0,ir={recordId:At,descriptorCid:Bt,contextId:kt,attestationCid:rr,encryptionCid:nr,delegatedGrantId:er,permissionGrantId:tr,protocolRole:zt};removeUndefinedProperties$3(ir);const ar=Encoder$4.objectToBytes(ir);return(yield GeneralJwsBuilder.create(ar,[Lt])).getJws()})}static getInitialWrite(e){return __awaiter$33(this,void 0,void 0,function*(){for(const At of e)if(yield RecordsWrite.isInitialWrite(At))return At;throw new DwnError(DwnErrorCode.RecordsWriteGetInitialWriteNotFound,"Initial write is not found.")})}static verifyEqualityOfImmutableProperties(e,At){const kt=["dataCid","dataSize","dataFormat","datePublished","published","messageTimestamp","tags"];let Bt=[];Bt.push(...Object.keys(e.descriptor)),Bt.push(...Object.keys(At.descriptor)),Bt=[...new Set(Bt)];for(const Nt of Bt)if(kt.indexOf(Nt)===-1){const jt=e.descriptor[Nt],Lt=At.descriptor[Nt];if(Lt!==jt)throw new DwnError(DwnErrorCode.RecordsWriteImmutablePropertyChanged,`${Nt} is an immutable property: cannot change '${jt}' to '${Lt}'`)}return!0}static getAttesters(e){var At,kt;return((kt=(At=e.attestation)===null||At===void 0?void 0:At.signatures)!==null&&kt!==void 0?kt:[]).map(jt=>Jws.getSignerDid(jt))}static fetchNewestRecordsWrite(e,At,kt){return __awaiter$33(this,void 0,void 0,function*(){const Bt={interface:DwnInterfaceName.Records,method:DwnMethodName.Write,recordId:kt},{messages:Nt}=yield e.query(At,[Bt]),jt=yield Message.getNewestMessage(Nt);if(jt!==void 0)return jt;throw new DwnError(DwnErrorCode.RecordsWriteGetNewestWriteRecordNotFound,"record not found")})}static fetchInitialRecordsWrite(e,At,kt){return __awaiter$33(this,void 0,void 0,function*(){const Bt={entryId:kt},{messages:Nt}=yield e.query(At,[Bt]);return Nt.length===0?void 0:yield RecordsWrite.parse(Nt[0])})}}var __awaiter$32=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function authenticate(xt,e){return __awaiter$32(this,void 0,void 0,function*(){if(xt===void 0)throw new DwnError(DwnErrorCode.AuthenticateJwsMissing,"Missing JWS.");if(yield GeneralJwsVerifier.verifySignatures(xt.signature,e),xt.ownerSignature!==void 0&&(yield GeneralJwsVerifier.verifySignatures(xt.ownerSignature,e)),xt.authorDelegatedGrant!==void 0){const At=yield RecordsWrite.parse(xt.authorDelegatedGrant);yield GeneralJwsVerifier.verifySignatures(At.message.authorization.signature,e)}if(xt.ownerDelegatedGrant!==void 0){const At=yield RecordsWrite.parse(xt.ownerDelegatedGrant);yield GeneralJwsVerifier.verifySignatures(At.message.authorization.signature,e)}})}var __awaiter$31=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class AllowAllTenantGate{isActiveTenant(e){return __awaiter$31(this,void 0,void 0,function*(){return{isActiveTenant:!0}})}}class AbstractMessage{get message(){return this._message}get signer(){return this._signer}get author(){return this._author}get signaturePayload(){return this._signaturePayload}get isSignedByAuthorDelegate(){return Message.isSignedByAuthorDelegate(this._message)}constructor(e){this._message=e,e.authorization!==void 0&&(this._signer=Message.getSigner(e),e.authorization.authorDelegatedGrant!==void 0?this._author=Message.getSigner(e.authorization.authorDelegatedGrant):this._author=this._signer,this._signaturePayload=Jws.decodePlainObjectPayload(e.authorization.signature))}toJSON(){return this.message}}var __awaiter$30=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class RecordsQuery extends AbstractMessage{static parse(e){return __awaiter$30(this,void 0,void 0,function*(){if(e.descriptor.filter.published===!1&&(e.descriptor.dateSort===DateSort.PublishedAscending||e.descriptor.dateSort===DateSort.PublishedDescending))throw new DwnError(DwnErrorCode.RecordsQueryParseFilterPublishedSortInvalid,`queries must not filter for \`published:false\` and sort by ${e.descriptor.dateSort}`);let At;if(e.authorization!==void 0&&(At=yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield Records.validateDelegatedGrantReferentialIntegrity(e,At),(At==null?void 0:At.protocolRole)!==void 0&&e.descriptor.filter.protocolPath===void 0)throw new DwnError(DwnErrorCode.RecordsQueryFilterMissingRequiredProperties,"Role-authorized queries must include `protocolPath` in the filter");return e.descriptor.filter.protocol!==void 0&&validateProtocolUrlNormalized(e.descriptor.filter.protocol),e.descriptor.filter.schema!==void 0&&validateSchemaUrlNormalized(e.descriptor.filter.schema),Time.validateTimestamp(e.descriptor.messageTimestamp),new RecordsQuery(e)})}static create(e){var At;return __awaiter$30(this,void 0,void 0,function*(){const kt={interface:DwnInterfaceName.Records,method:DwnMethodName.Query,messageTimestamp:(At=e.messageTimestamp)!==null&&At!==void 0?At:Time.getCurrentTimestamp(),filter:Records.normalizeFilter(e.filter),dateSort:e.dateSort,pagination:e.pagination};if(e.filter.published===!1&&(e.dateSort===DateSort.PublishedAscending||e.dateSort===DateSort.PublishedDescending))throw new DwnError(DwnErrorCode.RecordsQueryCreateFilterPublishedSortInvalid,`queries must not filter for \`published:false\` and sort by ${e.dateSort}`);removeUndefinedProperties$3(kt);const Bt=e.signer;let Nt;Bt&&(Nt=yield Message.createAuthorization({descriptor:kt,signer:Bt,protocolRole:e.protocolRole,delegatedGrant:e.delegatedGrant}));const jt={descriptor:kt,authorization:Nt};return Message.validateJsonSchema(jt),new RecordsQuery(jt)})}authorizeDelegate(e){return __awaiter$30(this,void 0,void 0,function*(){const At=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield RecordsGrantAuthorization.authorizeQueryOrSubscribe({incomingMessage:this.message,expectedGrantee:this.signer,expectedGrantor:this.author,permissionGrant:At,messageStore:e})})}}var __awaiter$2$=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class DataStream{static toBytes(e){return __awaiter$2$(this,void 0,void 0,function*(){return new Promise((At,kt)=>{const Bt=[];e.on("data",Nt=>{Bt.push(Nt)}),e.on("end",()=>{const Nt=DataStream.concatenateArrayOfBytes(Bt);At(Nt)}),e.on("error",kt)})})}static toObject(e){return __awaiter$2$(this,void 0,void 0,function*(){const At=yield DataStream.toBytes(e);return Encoder$4.bytesToObject(At)})}static concatenateArrayOfBytes(e){const At=e.reduce((Nt,jt)=>Nt+jt.length,0),kt=new Uint8Array(At);let Bt=0;for(const Nt of e)kt.set(Nt,Bt),Bt+=Nt.length;return kt}static fromBytes(e){let kt=0;return new browserExports$1.Readable({read(Nt){kt+1e5>e.length?(this.push(e.subarray(kt)),this.push(null)):(this.push(e.subarray(kt,kt+1e5)),kt=kt+1e5)}})}static fromObject(e){const At=Encoder$4.objectToBytes(e);return DataStream.fromBytes(At)}static duplicateDataStream(e,At){const kt=[];for(let Bt=0;Bt<At;Bt++){const Nt=new browserExports$1.PassThrough;e.pipe(Nt),kt.push(Nt)}return kt}}function messageReplyFromError(xt,e){const At=xt instanceof Error?xt.message:"Error";return{status:{code:e,detail:At}}}var __awaiter$2_=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let PermissionRequest$1=class $l{static parse(e){return __awaiter$2_(this,void 0,void 0,function*(){return new $l(e)})}constructor(e){this.id=e.recordId,this.requester=Message.getSigner(e);const At=e.encodedData,kt=Encoder$4.base64UrlToObject(At);this.delegated=kt.delegated,this.description=kt.description,this.scope=kt.scope,this.conditions=kt.conditions}};var __awaiter$2Z=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class PermissionsProtocol{static parseRequest(e){return Encoder$4.base64UrlToObject(e)}static createRequest(e){return __awaiter$2Z(this,void 0,void 0,function*(){if(this.isRecordPermissionScope(e.scope)&&e.scope.protocol===void 0)throw new DwnError(DwnErrorCode.PermissionsProtocolCreateRequestRecordsScopeMissingProtocol,"Permission request for Records must have a scope with a `protocol` property");const At=PermissionsProtocol.normalizePermissionScope(e.scope),kt={description:e.description,delegated:e.delegated,scope:At,conditions:e.conditions};let Bt;this.hasProtocolScope(At)&&(Bt={protocol:At.protocol});const Nt=Encoder$4.objectToBytes(kt),jt=yield RecordsWrite.create({signer:e.signer,messageTimestamp:e.dateRequested,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.requestPath,dataFormat:"application/json",data:Nt,tags:Bt}),Lt=Object.assign(Object.assign({},jt.message),{encodedData:Encoder$4.bytesToBase64Url(Nt)});return{recordsWrite:jt,permissionRequestData:kt,permissionRequestBytes:Nt,dataEncodedMessage:Lt}})}static createGrant(e){return __awaiter$2Z(this,void 0,void 0,function*(){if(this.isRecordPermissionScope(e.scope)&&e.scope.protocol===void 0)throw new DwnError(DwnErrorCode.PermissionsProtocolCreateGrantRecordsScopeMissingProtocol,"Permission grants for Records must have a scope with a `protocol` property");const At=PermissionsProtocol.normalizePermissionScope(e.scope),kt={dateExpires:e.dateExpires,requestId:e.requestId,description:e.description,delegated:e.delegated,scope:At,conditions:e.conditions};let Bt;this.hasProtocolScope(At)&&(Bt={protocol:At.protocol});const Nt=Encoder$4.objectToBytes(kt),jt=yield RecordsWrite.create({signer:e.signer,messageTimestamp:e.dateGranted,dateCreated:e.dateGranted,recipient:e.grantedTo,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.grantPath,dataFormat:"application/json",data:Nt,tags:Bt}),Lt=Object.assign(Object.assign({},jt.message),{encodedData:Encoder$4.bytesToBase64Url(Nt)});return{recordsWrite:jt,permissionGrantData:kt,permissionGrantBytes:Nt,dataEncodedMessage:Lt}})}static createRevocation(e){return __awaiter$2Z(this,void 0,void 0,function*(){const At={description:e.description},kt=e.grant.id;let Bt;this.hasProtocolScope(e.grant.scope)&&(Bt={protocol:normalizeProtocolUrl(e.grant.scope.protocol)});const Nt=Encoder$4.objectToBytes(At),jt=yield RecordsWrite.create({signer:e.signer,parentContextId:kt,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.revocationPath,dataFormat:"application/json",data:Nt,tags:Bt}),Lt=Object.assign(Object.assign({},jt.message),{encodedData:Encoder$4.bytesToBase64Url(Nt)});return{recordsWrite:jt,permissionRevocationData:At,permissionRevocationBytes:Nt,dataEncodedMessage:Lt}})}static validateSchema(e,At){const kt=Encoder$4.bytesToString(At),Bt=JSON.parse(kt);if(e.descriptor.protocolPath===PermissionsProtocol.requestPath){const Nt=Bt;validateJsonSchema("PermissionRequestData",Nt),PermissionsProtocol.validateScopeAndTags(Nt.scope,e)}else if(e.descriptor.protocolPath===PermissionsProtocol.grantPath){validateJsonSchema("PermissionGrantData",Bt);const Nt=Bt;PermissionsProtocol.validateScopeAndTags(Nt.scope,e),Time.validateTimestamp(Nt.dateExpires)}else if(e.descriptor.protocolPath===PermissionsProtocol.revocationPath)validateJsonSchema("PermissionRevocationData",Bt);else throw new DwnError(DwnErrorCode.PermissionsProtocolValidateSchemaUnexpectedRecord,`Unexpected permission record: ${e.descriptor.protocolPath}`)}static fetchGrant(e,At,kt){return __awaiter$2Z(this,void 0,void 0,function*(){const Bt={recordId:kt,isLatestBaseState:!0},{messages:Nt}=yield At.query(e,[Bt]),jt=Nt[0],Lt=jt==null?void 0:jt.descriptor.interface,er=jt==null?void 0:jt.descriptor.method;if(Lt!==DwnInterfaceName.Records||er!==DwnMethodName.Write||jt.descriptor.protocolPath!==PermissionsProtocol.grantPath)throw new DwnError(DwnErrorCode.GrantAuthorizationGrantMissing,`Could not find permission grant with record ID ${kt}.`);const tr=jt;return yield PermissionGrant$1.parse(tr)})}static getScopeFromPermissionRecord(e,At,kt){return __awaiter$2Z(this,void 0,void 0,function*(){if(kt.descriptor.protocol!==PermissionsProtocol.uri)throw new DwnError(DwnErrorCode.PermissionsProtocolGetScopeInvalidProtocol,`Unexpected protocol for permission record: ${kt.descriptor.protocol}`);return kt.descriptor.protocolPath===PermissionsProtocol.revocationPath?(yield PermissionsProtocol.fetchGrant(e,At,kt.descriptor.parentId)).scope:kt.descriptor.protocolPath===PermissionsProtocol.grantPath?(yield PermissionGrant$1.parse(kt)).scope:(yield PermissionRequest$1.parse(kt)).scope})}static normalizePermissionScope(e){const At=Object.assign({},e);return PermissionsProtocol.hasProtocolScope(At)&&(At.protocol=normalizeProtocolUrl(At.protocol)),At}static isRecordPermissionScope(e){return e.interface==="Records"}static hasProtocolScope(e){return"protocol"in e&&e.protocol!==void 0}static validateTags(e,At){if(e.descriptor.tags===void 0||e.descriptor.tags.protocol===void 0)throw new DwnError(DwnErrorCode.PermissionsProtocolValidateScopeMissingProtocolTag,"Permission grants must have a `tags` property that contains a protocol tag");const kt=e.descriptor.tags.protocol;if(kt!==At)throw new DwnError(DwnErrorCode.PermissionsProtocolValidateScopeProtocolMismatch,`Permission grants must have a scope with a protocol that matches the tagged protocol: ${kt}`)}static validateScopeAndTags(e,At){if(this.hasProtocolScope(e)&&(validateProtocolUrlNormalized(e.protocol),this.validateTags(At,e.protocol)),!!this.isRecordPermissionScope(e)&&e.contextId!==void 0&&e.protocolPath!==void 0)throw new DwnError(DwnErrorCode.PermissionsProtocolValidateScopeContextIdProhibitedProperties,"Permission grants cannot have both `contextId` and `protocolPath` present")}}PermissionsProtocol.uri="https://tbd.website/dwn/permissions";PermissionsProtocol.requestPath="request";PermissionsProtocol.grantPath="grant";PermissionsProtocol.revocationPath="grant/revocation";PermissionsProtocol.definition={published:!0,protocol:PermissionsProtocol.uri,types:{request:{dataFormats:["application/json"]},grant:{dataFormats:["application/json"]},revocation:{dataFormats:["application/json"]}},structure:{request:{$size:{max:1e4},$actions:[{who:"anyone",can:["create"]}]},grant:{$size:{max:1e4},$actions:[{who:"recipient",of:"grant",can:["read","query"]}],revocation:{$size:{max:1e4},$actions:[{who:"anyone",can:["read"]}]}}}};class Messages{static normalizeFilters(e){const At=[];for(const kt of e){const Bt=kt.protocol!==void 0?normalizeProtocolUrl(kt.protocol):void 0,Nt=Object.assign(Object.assign({},kt),{protocol:Bt});removeUndefinedProperties$3(Nt),isEmptyObject$1(Nt)||At.push(Nt)}return At}static convertFilters(e){const At=[];for(const kt of e){const Bt=this.constructPermissionRecordsFilter(kt);Bt&&At.push(Bt),At.push(this.convertFilter(kt))}return At}static constructPermissionRecordsFilter(e){const{protocol:At,messageTimestamp:kt}=e;if(At!==void 0){const Bt=Object.assign({protocol:PermissionsProtocol.uri},Records.convertTagsFilter({protocol:At}));if(kt!=null){const Nt=FilterUtility.convertRangeCriterion(kt);Nt&&(Bt.messageTimestamp=Nt)}return Bt}}static convertFilter(e){const At=Object.assign({},e),{messageTimestamp:kt}=e,Bt=kt?FilterUtility.convertRangeCriterion(kt):void 0;return Bt&&(At.messageTimestamp=Bt,delete At.dateUpdated),At}}var __awaiter$2Y=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class MessagesGrantAuthorization{static authorizeMessagesRead(e){return __awaiter$2Y(this,void 0,void 0,function*(){const{messagesReadMessage:At,messageToRead:kt,expectedGrantor:Bt,expectedGrantee:Nt,permissionGrant:jt,messageStore:Lt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:At,expectedGrantor:Bt,expectedGrantee:Nt,permissionGrant:jt,messageStore:Lt});const er=jt.scope;yield MessagesGrantAuthorization.verifyScope(Bt,kt,er,Lt)})}static authorizeQueryOrSubscribe(e){return __awaiter$2Y(this,void 0,void 0,function*(){const{incomingMessage:At,expectedGrantor:kt,expectedGrantee:Bt,permissionGrant:Nt,messageStore:jt}=e;if(yield GrantAuthorization.performBaseValidation({incomingMessage:At,expectedGrantor:kt,expectedGrantee:Bt,permissionGrant:Nt,messageStore:jt}),PermissionsProtocol.hasProtocolScope(Nt.scope)){const Lt=Nt.scope.protocol;for(const er of At.descriptor.filters)if(er.protocol!==Lt)throw new DwnError(DwnErrorCode.MessagesGrantAuthorizationMismatchedProtocol,`The protocol ${er.protocol} does not match the scoped protocol ${Lt}`)}})}static verifyScope(e,At,kt,Bt){return __awaiter$2Y(this,void 0,void 0,function*(){if(kt.protocol!==void 0){if(At.descriptor.interface===DwnInterfaceName.Records){const Nt=At,jt=Records.isRecordsWrite(Nt)?Nt:yield RecordsWrite.fetchNewestRecordsWrite(Bt,e,Nt.descriptor.recordId);if(jt.descriptor.protocol===kt.protocol)return;if(jt.descriptor.protocol===PermissionsProtocol.uri){const Lt=yield PermissionsProtocol.getScopeFromPermissionRecord(e,Bt,jt);if(PermissionsProtocol.hasProtocolScope(Lt)&&Lt.protocol===kt.protocol)return}}else if(At.descriptor.interface===DwnInterfaceName.Protocols&&At.descriptor.definition.protocol===kt.protocol)return;throw new DwnError(DwnErrorCode.MessagesReadVerifyScopeFailed,"record message failed scope authorization")}})}}var __awaiter$2X=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class MessagesQuery extends AbstractMessage{static parse(e){return __awaiter$2X(this,void 0,void 0,function*(){Message.validateJsonSchema(e),yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor);for(const At of e.descriptor.filters)"protocol"in At&&At.protocol!==void 0&&validateProtocolUrlNormalized(At.protocol);return new MessagesQuery(e)})}static create(e){var At;return __awaiter$2X(this,void 0,void 0,function*(){const kt={interface:DwnInterfaceName.Messages,method:DwnMethodName.Query,filters:e.filters?Messages.normalizeFilters(e.filters):[],messageTimestamp:(At=e.messageTimestamp)!==null&&At!==void 0?At:Time.getCurrentTimestamp(),cursor:e.cursor};removeUndefinedProperties$3(kt);const{permissionGrantId:Bt,signer:Nt}=e,jt=yield Message.createAuthorization({descriptor:kt,signer:Nt,permissionGrantId:Bt}),Lt={descriptor:kt,authorization:jt};return Message.validateJsonSchema(Lt),new MessagesQuery(Lt)})}}var __awaiter$2W=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class MessagesQueryHandler{constructor(e,At,kt){this.didResolver=e,this.messageStore=At,this.eventLog=kt}handle({tenant:e,message:At}){return __awaiter$2W(this,void 0,void 0,function*(){let kt;try{kt=yield MessagesQuery.parse(At)}catch(Lt){return messageReplyFromError(Lt,400)}try{yield authenticate(At.authorization,this.didResolver),yield MessagesQueryHandler.authorizeMessagesQuery(e,kt,this.messageStore)}catch(Lt){return messageReplyFromError(Lt,401)}const Bt=Messages.convertFilters(At.descriptor.filters),{events:Nt,cursor:jt}=yield this.eventLog.queryEvents(e,Bt,At.descriptor.cursor);return{status:{code:200,detail:"OK"},entries:Nt,cursor:jt}})}static authorizeMessagesQuery(e,At,kt){return __awaiter$2W(this,void 0,void 0,function*(){if(At.author!==e)if(At.author!==void 0&&At.signaturePayload.permissionGrantId!==void 0){const Bt=yield PermissionsProtocol.fetchGrant(e,kt,At.signaturePayload.permissionGrantId);yield MessagesGrantAuthorization.authorizeQueryOrSubscribe({incomingMessage:At.message,expectedGrantor:e,expectedGrantee:At.author,permissionGrant:Bt,messageStore:kt})}else throw new DwnError(DwnErrorCode.MessagesQueryAuthorizationFailed,"message failed authorization")})}}var __awaiter$2V=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class MessagesRead extends AbstractMessage{static parse(e){return __awaiter$2V(this,void 0,void 0,function*(){return Message.validateJsonSchema(e),this.validateMessageCid(e.descriptor.messageCid),yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor),Time.validateTimestamp(e.descriptor.messageTimestamp),new MessagesRead(e)})}static create(e){var At;return __awaiter$2V(this,void 0,void 0,function*(){const kt={interface:DwnInterfaceName.Messages,method:DwnMethodName.Read,messageCid:e.messageCid,messageTimestamp:(At=e.messageTimestamp)!==null&&At!==void 0?At:Time.getCurrentTimestamp()},{signer:Bt,permissionGrantId:Nt}=e,jt=yield Message.createAuthorization({descriptor:kt,signer:Bt,permissionGrantId:Nt}),Lt={descriptor:kt,authorization:jt};return Message.validateJsonSchema(Lt),MessagesRead.validateMessageCid(e.messageCid),new MessagesRead(Lt)})}static validateMessageCid(e){try{Cid.parseCid(e)}catch{throw new DwnError(DwnErrorCode.MessagesReadInvalidCid,`${e} is not a valid CID`)}}}var __awaiter$2U=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class MessagesReadHandler{constructor(e,At,kt){this.didResolver=e,this.messageStore=At,this.dataStore=kt}handle({tenant:e,message:At}){return __awaiter$2U(this,void 0,void 0,function*(){let kt;try{kt=yield MessagesRead.parse(At)}catch(jt){return messageReplyFromError(jt,400)}try{yield authenticate(At.authorization,this.didResolver)}catch(jt){return messageReplyFromError(jt,401)}const Bt=yield this.messageStore.get(e,At.descriptor.messageCid);if(Bt===void 0)return{status:{code:404,detail:"Not Found"}};try{yield MessagesReadHandler.authorizeMessagesRead(e,kt,Bt,this.messageStore)}catch(jt){return messageReplyFromError(jt,401)}const Nt={message:Bt,messageCid:At.descriptor.messageCid};if(Records.isRecordsWrite(Bt)){const jt=Nt.message;if(jt.encodedData!==void 0){const Lt=Encoder$4.base64UrlToBytes(jt.encodedData);Nt.data=DataStream.fromBytes(Lt),delete jt.encodedData}else{const Lt=yield this.dataStore.get(e,jt.recordId,jt.descriptor.dataCid);(Lt==null?void 0:Lt.dataStream)!==void 0&&(Nt.data=Lt.dataStream)}}return{status:{code:200,detail:"OK"},entry:Nt}})}static authorizeMessagesRead(e,At,kt,Bt){return __awaiter$2U(this,void 0,void 0,function*(){if(At.author!==e)if(At.author!==void 0&&At.signaturePayload.permissionGrantId!==void 0){const Nt=yield PermissionsProtocol.fetchGrant(e,Bt,At.signaturePayload.permissionGrantId);yield MessagesGrantAuthorization.authorizeMessagesRead({messagesReadMessage:At.message,messageToRead:kt,expectedGrantor:e,expectedGrantee:At.author,permissionGrant:Nt,messageStore:Bt})}else throw new DwnError(DwnErrorCode.MessagesReadAuthorizationFailed,"protocol message failed authorization")})}}var __awaiter$2T=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class MessagesSubscribe extends AbstractMessage{static parse(e){return __awaiter$2T(this,void 0,void 0,function*(){Message.validateJsonSchema(e),yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor);for(const At of e.descriptor.filters)"protocol"in At&&At.protocol!==void 0&&validateProtocolUrlNormalized(At.protocol);return Time.validateTimestamp(e.descriptor.messageTimestamp),new MessagesSubscribe(e)})}static create(e){var At,kt;return __awaiter$2T(this,void 0,void 0,function*(){const Bt=Time.getCurrentTimestamp(),Nt={interface:DwnInterfaceName.Messages,method:DwnMethodName.Subscribe,filters:(At=e.filters)!==null&&At!==void 0?At:[],messageTimestamp:(kt=e.messageTimestamp)!==null&&kt!==void 0?kt:Bt};removeUndefinedProperties$3(Nt);const{permissionGrantId:jt,signer:Lt}=e,er=yield Message.createAuthorization({descriptor:Nt,signer:Lt,permissionGrantId:jt}),tr={descriptor:Nt,authorization:er};return Message.validateJsonSchema(tr),new MessagesSubscribe(tr)})}}var __awaiter$2S=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class MessagesSubscribeHandler{constructor(e,At,kt){this.didResolver=e,this.messageStore=At,this.eventStream=kt}handle({tenant:e,message:At,subscriptionHandler:kt}){return __awaiter$2S(this,void 0,void 0,function*(){if(this.eventStream===void 0)return messageReplyFromError(new DwnError(DwnErrorCode.MessagesSubscribeEventStreamUnimplemented,"Subscriptions are not supported"),501);let Bt;try{Bt=yield MessagesSubscribe.parse(At)}catch(zt){return messageReplyFromError(zt,400)}try{yield authenticate(At.authorization,this.didResolver),yield MessagesSubscribeHandler.authorizeMessagesSubscribe(e,Bt,this.messageStore)}catch(zt){return messageReplyFromError(zt,401)}const{filters:Nt}=At.descriptor,jt=Messages.convertFilters(Nt),Lt=yield Message.getCid(At),er=(zt,rr,nr)=>{e===zt&&FilterUtility.matchAnyFilter(nr,jt)&&kt(rr)},tr=yield this.eventStream.subscribe(e,Lt,er);return{status:{code:200,detail:"OK"},subscription:tr}})}static authorizeMessagesSubscribe(e,At,kt){return __awaiter$2S(this,void 0,void 0,function*(){if(At.author!==e)if(At.author!==void 0&&At.signaturePayload.permissionGrantId!==void 0){const Bt=yield PermissionsProtocol.fetchGrant(e,kt,At.signaturePayload.permissionGrantId);yield MessagesGrantAuthorization.authorizeQueryOrSubscribe({incomingMessage:At.message,expectedGrantor:e,expectedGrantee:At.author,permissionGrant:Bt,messageStore:kt})}else throw new DwnError(DwnErrorCode.MessagesSubscribeAuthorizationFailed,"message failed authorization")})}}var _2020={exports:{}},core$3={},validate={},boolSchema={},errors$1={},codegen={},code$2={};(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.regexpCode=xt.getEsmExportName=xt.getProperty=xt.safeStringify=xt.stringify=xt.strConcat=xt.addCodeArg=xt.str=xt._=xt.nil=xt._Code=xt.Name=xt.IDENTIFIER=xt._CodeOrName=void 0;class e{}xt._CodeOrName=e,xt.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class At extends e{constructor(pr){if(super(),!xt.IDENTIFIER.test(pr))throw new Error("CodeGen: name must be a valid identifier");this.str=pr}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}xt.Name=At;class kt extends e{constructor(pr){super(),this._items=typeof pr=="string"?[pr]:pr}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const pr=this._items[0];return pr===""||pr==='""'}get str(){var pr;return(pr=this._str)!==null&&pr!==void 0?pr:this._str=this._items.reduce((lr,yr)=>`${lr}${yr}`,"")}get names(){var pr;return(pr=this._names)!==null&&pr!==void 0?pr:this._names=this._items.reduce((lr,yr)=>(yr instanceof At&&(lr[yr.str]=(lr[yr.str]||0)+1),lr),{})}}xt._Code=kt,xt.nil=new kt("");function Bt(fr,...pr){const lr=[fr[0]];let yr=0;for(;yr<pr.length;)Lt(lr,pr[yr]),lr.push(fr[++yr]);return new kt(lr)}xt._=Bt;const Nt=new kt("+");function jt(fr,...pr){const lr=[ir(fr[0])];let yr=0;for(;yr<pr.length;)lr.push(Nt),Lt(lr,pr[yr]),lr.push(Nt,ir(fr[++yr]));return er(lr),new kt(lr)}xt.str=jt;function Lt(fr,pr){pr instanceof kt?fr.push(...pr._items):pr instanceof At?fr.push(pr):fr.push(rr(pr))}xt.addCodeArg=Lt;function er(fr){let pr=1;for(;pr<fr.length-1;){if(fr[pr]===Nt){const lr=tr(fr[pr-1],fr[pr+1]);if(lr!==void 0){fr.splice(pr-1,3,lr);continue}fr[pr++]="+"}pr++}}function tr(fr,pr){if(pr==='""')return fr;if(fr==='""')return pr;if(typeof fr=="string")return pr instanceof At||fr[fr.length-1]!=='"'?void 0:typeof pr!="string"?`${fr.slice(0,-1)}${pr}"`:pr[0]==='"'?fr.slice(0,-1)+pr.slice(1):void 0;if(typeof pr=="string"&&pr[0]==='"'&&!(fr instanceof At))return`"${fr}${pr.slice(1)}`}function zt(fr,pr){return pr.emptyStr()?fr:fr.emptyStr()?pr:jt`${fr}${pr}`}xt.strConcat=zt;function rr(fr){return typeof fr=="number"||typeof fr=="boolean"||fr===null?fr:ir(Array.isArray(fr)?fr.join(","):fr)}function nr(fr){return new kt(ir(fr))}xt.stringify=nr;function ir(fr){return JSON.stringify(fr).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}xt.safeStringify=ir;function ar(fr){return typeof fr=="string"&&xt.IDENTIFIER.test(fr)?new kt(`.${fr}`):Bt`[${fr}]`}xt.getProperty=ar;function dr(fr){if(typeof fr=="string"&&xt.IDENTIFIER.test(fr))return new kt(`${fr}`);throw new Error(`CodeGen: invalid export name: ${fr}, use explicit $id name mapping`)}xt.getEsmExportName=dr;function ur(fr){return new kt(fr.toString())}xt.regexpCode=ur})(code$2);var scope$1={};(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.ValueScope=xt.ValueScopeName=xt.Scope=xt.varKinds=xt.UsedValueState=void 0;const e=code$2;class At extends Error{constructor(tr){super(`CodeGen: "code" for ${tr} not defined`),this.value=tr.value}}var kt;(function(er){er[er.Started=0]="Started",er[er.Completed=1]="Completed"})(kt=xt.UsedValueState||(xt.UsedValueState={})),xt.varKinds={const:new e.Name("const"),let:new e.Name("let"),var:new e.Name("var")};class Bt{constructor({prefixes:tr,parent:zt}={}){this._names={},this._prefixes=tr,this._parent=zt}toName(tr){return tr instanceof e.Name?tr:this.name(tr)}name(tr){return new e.Name(this._newName(tr))}_newName(tr){const zt=this._names[tr]||this._nameGroup(tr);return`${tr}${zt.index++}`}_nameGroup(tr){var zt,rr;if(!((rr=(zt=this._parent)===null||zt===void 0?void 0:zt._prefixes)===null||rr===void 0)&&rr.has(tr)||this._prefixes&&!this._prefixes.has(tr))throw new Error(`CodeGen: prefix "${tr}" is not allowed in this scope`);return this._names[tr]={prefix:tr,index:0}}}xt.Scope=Bt;class Nt extends e.Name{constructor(tr,zt){super(zt),this.prefix=tr}setValue(tr,{property:zt,itemIndex:rr}){this.value=tr,this.scopePath=(0,e._)`.${new e.Name(zt)}[${rr}]`}}xt.ValueScopeName=Nt;const jt=(0,e._)`\n`;class Lt extends Bt{constructor(tr){super(tr),this._values={},this._scope=tr.scope,this.opts={...tr,_n:tr.lines?jt:e.nil}}get(){return this._scope}name(tr){return new Nt(tr,this._newName(tr))}value(tr,zt){var rr;if(zt.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const nr=this.toName(tr),{prefix:ir}=nr,ar=(rr=zt.key)!==null&&rr!==void 0?rr:zt.ref;let dr=this._values[ir];if(dr){const pr=dr.get(ar);if(pr)return pr}else dr=this._values[ir]=new Map;dr.set(ar,nr);const ur=this._scope[ir]||(this._scope[ir]=[]),fr=ur.length;return ur[fr]=zt.ref,nr.setValue(zt,{property:ir,itemIndex:fr}),nr}getValue(tr,zt){const rr=this._values[tr];if(rr)return rr.get(zt)}scopeRefs(tr,zt=this._values){return this._reduceValues(zt,rr=>{if(rr.scopePath===void 0)throw new Error(`CodeGen: name "${rr}" has no value`);return(0,e._)`${tr}${rr.scopePath}`})}scopeCode(tr=this._values,zt,rr){return this._reduceValues(tr,nr=>{if(nr.value===void 0)throw new Error(`CodeGen: name "${nr}" has no value`);return nr.value.code},zt,rr)}_reduceValues(tr,zt,rr={},nr){let ir=e.nil;for(const ar in tr){const dr=tr[ar];if(!dr)continue;const ur=rr[ar]=rr[ar]||new Map;dr.forEach(fr=>{if(ur.has(fr))return;ur.set(fr,kt.Started);let pr=zt(fr);if(pr){const lr=this.opts.es5?xt.varKinds.var:xt.varKinds.const;ir=(0,e._)`${ir}${lr} ${fr} = ${pr};${this.opts._n}`}else if(pr=nr==null?void 0:nr(fr))ir=(0,e._)`${ir}${pr}${this.opts._n}`;else throw new At(fr);ur.set(fr,kt.Completed)})}return ir}}xt.ValueScope=Lt})(scope$1);(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.or=xt.and=xt.not=xt.CodeGen=xt.operators=xt.varKinds=xt.ValueScopeName=xt.ValueScope=xt.Scope=xt.Name=xt.regexpCode=xt.stringify=xt.getProperty=xt.nil=xt.strConcat=xt.str=xt._=void 0;const e=code$2,At=scope$1;var kt=code$2;Object.defineProperty(xt,"_",{enumerable:!0,get:function(){return kt._}}),Object.defineProperty(xt,"str",{enumerable:!0,get:function(){return kt.str}}),Object.defineProperty(xt,"strConcat",{enumerable:!0,get:function(){return kt.strConcat}}),Object.defineProperty(xt,"nil",{enumerable:!0,get:function(){return kt.nil}}),Object.defineProperty(xt,"getProperty",{enumerable:!0,get:function(){return kt.getProperty}}),Object.defineProperty(xt,"stringify",{enumerable:!0,get:function(){return kt.stringify}}),Object.defineProperty(xt,"regexpCode",{enumerable:!0,get:function(){return kt.regexpCode}}),Object.defineProperty(xt,"Name",{enumerable:!0,get:function(){return kt.Name}});var Bt=scope$1;Object.defineProperty(xt,"Scope",{enumerable:!0,get:function(){return Bt.Scope}}),Object.defineProperty(xt,"ValueScope",{enumerable:!0,get:function(){return Bt.ValueScope}}),Object.defineProperty(xt,"ValueScopeName",{enumerable:!0,get:function(){return Bt.ValueScopeName}}),Object.defineProperty(xt,"varKinds",{enumerable:!0,get:function(){return Bt.varKinds}}),xt.operators={GT:new e._Code(">"),GTE:new e._Code(">="),LT:new e._Code("<"),LTE:new e._Code("<="),EQ:new e._Code("==="),NEQ:new e._Code("!=="),NOT:new e._Code("!"),OR:new e._Code("||"),AND:new e._Code("&&"),ADD:new e._Code("+")};class Nt{optimizeNodes(){return this}optimizeNames(Mr,Gr){return this}}class jt extends Nt{constructor(Mr,Gr,Br){super(),this.varKind=Mr,this.name=Gr,this.rhs=Br}render({es5:Mr,_n:Gr}){const Br=Mr?At.varKinds.var:this.varKind,Cr=this.rhs===void 0?"":` = ${this.rhs}`;return`${Br} ${this.name}${Cr};`+Gr}optimizeNames(Mr,Gr){if(Mr[this.name.str])return this.rhs&&(this.rhs=gr(this.rhs,Mr,Gr)),this}get names(){return this.rhs instanceof e._CodeOrName?this.rhs.names:{}}}class Lt extends Nt{constructor(Mr,Gr,Br){super(),this.lhs=Mr,this.rhs=Gr,this.sideEffects=Br}render({_n:Mr}){return`${this.lhs} = ${this.rhs};`+Mr}optimizeNames(Mr,Gr){if(!(this.lhs instanceof e.Name&&!Mr[this.lhs.str]&&!this.sideEffects))return this.rhs=gr(this.rhs,Mr,Gr),this}get names(){const Mr=this.lhs instanceof e.Name?{}:{...this.lhs.names};return _r(Mr,this.rhs)}}class er extends Lt{constructor(Mr,Gr,Br,Cr){super(Mr,Br,Cr),this.op=Gr}render({_n:Mr}){return`${this.lhs} ${this.op}= ${this.rhs};`+Mr}}class tr extends Nt{constructor(Mr){super(),this.label=Mr,this.names={}}render({_n:Mr}){return`${this.label}:`+Mr}}class zt extends Nt{constructor(Mr){super(),this.label=Mr,this.names={}}render({_n:Mr}){return`break${this.label?` ${this.label}`:""};`+Mr}}class rr extends Nt{constructor(Mr){super(),this.error=Mr}render({_n:Mr}){return`throw ${this.error};`+Mr}get names(){return this.error.names}}class nr extends Nt{constructor(Mr){super(),this.code=Mr}render({_n:Mr}){return`${this.code};`+Mr}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(Mr,Gr){return this.code=gr(this.code,Mr,Gr),this}get names(){return this.code instanceof e._CodeOrName?this.code.names:{}}}class ir extends Nt{constructor(Mr=[]){super(),this.nodes=Mr}render(Mr){return this.nodes.reduce((Gr,Br)=>Gr+Br.render(Mr),"")}optimizeNodes(){const{nodes:Mr}=this;let Gr=Mr.length;for(;Gr--;){const Br=Mr[Gr].optimizeNodes();Array.isArray(Br)?Mr.splice(Gr,1,...Br):Br?Mr[Gr]=Br:Mr.splice(Gr,1)}return Mr.length>0?this:void 0}optimizeNames(Mr,Gr){const{nodes:Br}=this;let Cr=Br.length;for(;Cr--;){const jr=Br[Cr];jr.optimizeNames(Mr,Gr)||(wr(Mr,jr.names),Br.splice(Cr,1))}return Br.length>0?this:void 0}get names(){return this.nodes.reduce((Mr,Gr)=>Sr(Mr,Gr.names),{})}}class ar extends ir{render(Mr){return"{"+Mr._n+super.render(Mr)+"}"+Mr._n}}class dr extends ir{}class ur extends ar{}ur.kind="else";class fr extends ar{constructor(Mr,Gr){super(Gr),this.condition=Mr}render(Mr){let Gr=`if(${this.condition})`+super.render(Mr);return this.else&&(Gr+="else "+this.else.render(Mr)),Gr}optimizeNodes(){super.optimizeNodes();const Mr=this.condition;if(Mr===!0)return this.nodes;let Gr=this.else;if(Gr){const Br=Gr.optimizeNodes();Gr=this.else=Array.isArray(Br)?new ur(Br):Br}if(Gr)return Mr===!1?Gr instanceof fr?Gr:Gr.nodes:this.nodes.length?this:new fr(Dr(Mr),Gr instanceof fr?[Gr]:Gr.nodes);if(!(Mr===!1||!this.nodes.length))return this}optimizeNames(Mr,Gr){var Br;if(this.else=(Br=this.else)===null||Br===void 0?void 0:Br.optimizeNames(Mr,Gr),!!(super.optimizeNames(Mr,Gr)||this.else))return this.condition=gr(this.condition,Mr,Gr),this}get names(){const Mr=super.names;return _r(Mr,this.condition),this.else&&Sr(Mr,this.else.names),Mr}}fr.kind="if";class pr extends ar{}pr.kind="for";class lr extends pr{constructor(Mr){super(),this.iteration=Mr}render(Mr){return`for(${this.iteration})`+super.render(Mr)}optimizeNames(Mr,Gr){if(super.optimizeNames(Mr,Gr))return this.iteration=gr(this.iteration,Mr,Gr),this}get names(){return Sr(super.names,this.iteration.names)}}class yr extends pr{constructor(Mr,Gr,Br,Cr){super(),this.varKind=Mr,this.name=Gr,this.from=Br,this.to=Cr}render(Mr){const Gr=Mr.es5?At.varKinds.var:this.varKind,{name:Br,from:Cr,to:jr}=this;return`for(${Gr} ${Br}=${Cr}; ${Br}<${jr}; ${Br}++)`+super.render(Mr)}get names(){const Mr=_r(super.names,this.from);return _r(Mr,this.to)}}class br extends pr{constructor(Mr,Gr,Br,Cr){super(),this.loop=Mr,this.varKind=Gr,this.name=Br,this.iterable=Cr}render(Mr){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(Mr)}optimizeNames(Mr,Gr){if(super.optimizeNames(Mr,Gr))return this.iterable=gr(this.iterable,Mr,Gr),this}get names(){return Sr(super.names,this.iterable.names)}}class Ar extends ar{constructor(Mr,Gr,Br){super(),this.name=Mr,this.args=Gr,this.async=Br}render(Mr){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(Mr)}}Ar.kind="func";class Pr extends ir{render(Mr){return"return "+super.render(Mr)}}Pr.kind="return";class kr extends ar{render(Mr){let Gr="try"+super.render(Mr);return this.catch&&(Gr+=this.catch.render(Mr)),this.finally&&(Gr+=this.finally.render(Mr)),Gr}optimizeNodes(){var Mr,Gr;return super.optimizeNodes(),(Mr=this.catch)===null||Mr===void 0||Mr.optimizeNodes(),(Gr=this.finally)===null||Gr===void 0||Gr.optimizeNodes(),this}optimizeNames(Mr,Gr){var Br,Cr;return super.optimizeNames(Mr,Gr),(Br=this.catch)===null||Br===void 0||Br.optimizeNames(Mr,Gr),(Cr=this.finally)===null||Cr===void 0||Cr.optimizeNames(Mr,Gr),this}get names(){const Mr=super.names;return this.catch&&Sr(Mr,this.catch.names),this.finally&&Sr(Mr,this.finally.names),Mr}}class Ur extends ar{constructor(Mr){super(),this.error=Mr}render(Mr){return`catch(${this.error})`+super.render(Mr)}}Ur.kind="catch";class Hr extends ar{render(Mr){return"finally"+super.render(Mr)}}Hr.kind="finally";class Lr{constructor(Mr,Gr={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...Gr,_n:Gr.lines?`
`:""},this._extScope=Mr,this._scope=new At.Scope({parent:Mr}),this._nodes=[new dr]}toString(){return this._root.render(this.opts)}name(Mr){return this._scope.name(Mr)}scopeName(Mr){return this._extScope.name(Mr)}scopeValue(Mr,Gr){const Br=this._extScope.value(Mr,Gr);return(this._values[Br.prefix]||(this._values[Br.prefix]=new Set)).add(Br),Br}getScopeValue(Mr,Gr){return this._extScope.getValue(Mr,Gr)}scopeRefs(Mr){return this._extScope.scopeRefs(Mr,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(Mr,Gr,Br,Cr){const jr=this._scope.toName(Gr);return Br!==void 0&&Cr&&(this._constants[jr.str]=Br),this._leafNode(new jt(Mr,jr,Br)),jr}const(Mr,Gr,Br){return this._def(At.varKinds.const,Mr,Gr,Br)}let(Mr,Gr,Br){return this._def(At.varKinds.let,Mr,Gr,Br)}var(Mr,Gr,Br){return this._def(At.varKinds.var,Mr,Gr,Br)}assign(Mr,Gr,Br){return this._leafNode(new Lt(Mr,Gr,Br))}add(Mr,Gr){return this._leafNode(new er(Mr,xt.operators.ADD,Gr))}code(Mr){return typeof Mr=="function"?Mr():Mr!==e.nil&&this._leafNode(new nr(Mr)),this}object(...Mr){const Gr=["{"];for(const[Br,Cr]of Mr)Gr.length>1&&Gr.push(","),Gr.push(Br),(Br!==Cr||this.opts.es5)&&(Gr.push(":"),(0,e.addCodeArg)(Gr,Cr));return Gr.push("}"),new e._Code(Gr)}if(Mr,Gr,Br){if(this._blockNode(new fr(Mr)),Gr&&Br)this.code(Gr).else().code(Br).endIf();else if(Gr)this.code(Gr).endIf();else if(Br)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(Mr){return this._elseNode(new fr(Mr))}else(){return this._elseNode(new ur)}endIf(){return this._endBlockNode(fr,ur)}_for(Mr,Gr){return this._blockNode(Mr),Gr&&this.code(Gr).endFor(),this}for(Mr,Gr){return this._for(new lr(Mr),Gr)}forRange(Mr,Gr,Br,Cr,jr=this.opts.es5?At.varKinds.var:At.varKinds.let){const Yr=this._scope.toName(Mr);return this._for(new yr(jr,Yr,Gr,Br),()=>Cr(Yr))}forOf(Mr,Gr,Br,Cr=At.varKinds.const){const jr=this._scope.toName(Mr);if(this.opts.es5){const Yr=Gr instanceof e.Name?Gr:this.var("_arr",Gr);return this.forRange("_i",0,(0,e._)`${Yr}.length`,Qr=>{this.var(jr,(0,e._)`${Yr}[${Qr}]`),Br(jr)})}return this._for(new br("of",Cr,jr,Gr),()=>Br(jr))}forIn(Mr,Gr,Br,Cr=this.opts.es5?At.varKinds.var:At.varKinds.const){if(this.opts.ownProperties)return this.forOf(Mr,(0,e._)`Object.keys(${Gr})`,Br);const jr=this._scope.toName(Mr);return this._for(new br("in",Cr,jr,Gr),()=>Br(jr))}endFor(){return this._endBlockNode(pr)}label(Mr){return this._leafNode(new tr(Mr))}break(Mr){return this._leafNode(new zt(Mr))}return(Mr){const Gr=new Pr;if(this._blockNode(Gr),this.code(Mr),Gr.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(Pr)}try(Mr,Gr,Br){if(!Gr&&!Br)throw new Error('CodeGen: "try" without "catch" and "finally"');const Cr=new kr;if(this._blockNode(Cr),this.code(Mr),Gr){const jr=this.name("e");this._currNode=Cr.catch=new Ur(jr),Gr(jr)}return Br&&(this._currNode=Cr.finally=new Hr,this.code(Br)),this._endBlockNode(Ur,Hr)}throw(Mr){return this._leafNode(new rr(Mr))}block(Mr,Gr){return this._blockStarts.push(this._nodes.length),Mr&&this.code(Mr).endBlock(Gr),this}endBlock(Mr){const Gr=this._blockStarts.pop();if(Gr===void 0)throw new Error("CodeGen: not in self-balancing block");const Br=this._nodes.length-Gr;if(Br<0||Mr!==void 0&&Br!==Mr)throw new Error(`CodeGen: wrong number of nodes: ${Br} vs ${Mr} expected`);return this._nodes.length=Gr,this}func(Mr,Gr=e.nil,Br,Cr){return this._blockNode(new Ar(Mr,Gr,Br)),Cr&&this.code(Cr).endFunc(),this}endFunc(){return this._endBlockNode(Ar)}optimize(Mr=1){for(;Mr-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(Mr){return this._currNode.nodes.push(Mr),this}_blockNode(Mr){this._currNode.nodes.push(Mr),this._nodes.push(Mr)}_endBlockNode(Mr,Gr){const Br=this._currNode;if(Br instanceof Mr||Gr&&Br instanceof Gr)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${Gr?`${Mr.kind}/${Gr.kind}`:Mr.kind}"`)}_elseNode(Mr){const Gr=this._currNode;if(!(Gr instanceof fr))throw new Error('CodeGen: "else" without "if"');return this._currNode=Gr.else=Mr,this}get _root(){return this._nodes[0]}get _currNode(){const Mr=this._nodes;return Mr[Mr.length-1]}set _currNode(Mr){const Gr=this._nodes;Gr[Gr.length-1]=Mr}}xt.CodeGen=Lr;function Sr(Rr,Mr){for(const Gr in Mr)Rr[Gr]=(Rr[Gr]||0)+(Mr[Gr]||0);return Rr}function _r(Rr,Mr){return Mr instanceof e._CodeOrName?Sr(Rr,Mr.names):Rr}function gr(Rr,Mr,Gr){if(Rr instanceof e.Name)return Br(Rr);if(!Cr(Rr))return Rr;return new e._Code(Rr._items.reduce((jr,Yr)=>(Yr instanceof e.Name&&(Yr=Br(Yr)),Yr instanceof e._Code?jr.push(...Yr._items):jr.push(Yr),jr),[]));function Br(jr){const Yr=Gr[jr.str];return Yr===void 0||Mr[jr.str]!==1?jr:(delete Mr[jr.str],Yr)}function Cr(jr){return jr instanceof e._Code&&jr._items.some(Yr=>Yr instanceof e.Name&&Mr[Yr.str]===1&&Gr[Yr.str]!==void 0)}}function wr(Rr,Mr){for(const Gr in Mr)Rr[Gr]=(Rr[Gr]||0)-(Mr[Gr]||0)}function Dr(Rr){return typeof Rr=="boolean"||typeof Rr=="number"||Rr===null?!Rr:(0,e._)`!${Tr(Rr)}`}xt.not=Dr;const xr=Er(xt.operators.AND);function Ir(...Rr){return Rr.reduce(xr)}xt.and=Ir;const $r=Er(xt.operators.OR);function vr(...Rr){return Rr.reduce($r)}xt.or=vr;function Er(Rr){return(Mr,Gr)=>Mr===e.nil?Gr:Gr===e.nil?Mr:(0,e._)`${Tr(Mr)} ${Rr} ${Tr(Gr)}`}function Tr(Rr){return Rr instanceof e.Name?Rr:(0,e._)`(${Rr})`}})(codegen);var util$1={};(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.checkStrictMode=xt.getErrorPath=xt.Type=xt.useFunc=xt.setEvaluated=xt.evaluatedPropsToName=xt.mergeEvaluated=xt.eachItem=xt.unescapeJsonPointer=xt.escapeJsonPointer=xt.escapeFragment=xt.unescapeFragment=xt.schemaRefOrVal=xt.schemaHasRulesButRef=xt.schemaHasRules=xt.checkUnknownRules=xt.alwaysValidSchema=xt.toHash=void 0;const e=codegen,At=code$2;function kt(Ar){const Pr={};for(const kr of Ar)Pr[kr]=!0;return Pr}xt.toHash=kt;function Bt(Ar,Pr){return typeof Pr=="boolean"?Pr:Object.keys(Pr).length===0?!0:(Nt(Ar,Pr),!jt(Pr,Ar.self.RULES.all))}xt.alwaysValidSchema=Bt;function Nt(Ar,Pr=Ar.schema){const{opts:kr,self:Ur}=Ar;if(!kr.strictSchema||typeof Pr=="boolean")return;const Hr=Ur.RULES.keywords;for(const Lr in Pr)Hr[Lr]||br(Ar,`unknown keyword: "${Lr}"`)}xt.checkUnknownRules=Nt;function jt(Ar,Pr){if(typeof Ar=="boolean")return!Ar;for(const kr in Ar)if(Pr[kr])return!0;return!1}xt.schemaHasRules=jt;function Lt(Ar,Pr){if(typeof Ar=="boolean")return!Ar;for(const kr in Ar)if(kr!=="$ref"&&Pr.all[kr])return!0;return!1}xt.schemaHasRulesButRef=Lt;function er({topSchemaRef:Ar,schemaPath:Pr},kr,Ur,Hr){if(!Hr){if(typeof kr=="number"||typeof kr=="boolean")return kr;if(typeof kr=="string")return(0,e._)`${kr}`}return(0,e._)`${Ar}${Pr}${(0,e.getProperty)(Ur)}`}xt.schemaRefOrVal=er;function tr(Ar){return nr(decodeURIComponent(Ar))}xt.unescapeFragment=tr;function zt(Ar){return encodeURIComponent(rr(Ar))}xt.escapeFragment=zt;function rr(Ar){return typeof Ar=="number"?`${Ar}`:Ar.replace(/~/g,"~0").replace(/\//g,"~1")}xt.escapeJsonPointer=rr;function nr(Ar){return Ar.replace(/~1/g,"/").replace(/~0/g,"~")}xt.unescapeJsonPointer=nr;function ir(Ar,Pr){if(Array.isArray(Ar))for(const kr of Ar)Pr(kr);else Pr(Ar)}xt.eachItem=ir;function ar({mergeNames:Ar,mergeToName:Pr,mergeValues:kr,resultToName:Ur}){return(Hr,Lr,Sr,_r)=>{const gr=Sr===void 0?Lr:Sr instanceof e.Name?(Lr instanceof e.Name?Ar(Hr,Lr,Sr):Pr(Hr,Lr,Sr),Sr):Lr instanceof e.Name?(Pr(Hr,Sr,Lr),Lr):kr(Lr,Sr);return _r===e.Name&&!(gr instanceof e.Name)?Ur(Hr,gr):gr}}xt.mergeEvaluated={props:ar({mergeNames:(Ar,Pr,kr)=>Ar.if((0,e._)`${kr} !== true && ${Pr} !== undefined`,()=>{Ar.if((0,e._)`${Pr} === true`,()=>Ar.assign(kr,!0),()=>Ar.assign(kr,(0,e._)`${kr} || {}`).code((0,e._)`Object.assign(${kr}, ${Pr})`))}),mergeToName:(Ar,Pr,kr)=>Ar.if((0,e._)`${kr} !== true`,()=>{Pr===!0?Ar.assign(kr,!0):(Ar.assign(kr,(0,e._)`${kr} || {}`),ur(Ar,kr,Pr))}),mergeValues:(Ar,Pr)=>Ar===!0?!0:{...Ar,...Pr},resultToName:dr}),items:ar({mergeNames:(Ar,Pr,kr)=>Ar.if((0,e._)`${kr} !== true && ${Pr} !== undefined`,()=>Ar.assign(kr,(0,e._)`${Pr} === true ? true : ${kr} > ${Pr} ? ${kr} : ${Pr}`)),mergeToName:(Ar,Pr,kr)=>Ar.if((0,e._)`${kr} !== true`,()=>Ar.assign(kr,Pr===!0?!0:(0,e._)`${kr} > ${Pr} ? ${kr} : ${Pr}`)),mergeValues:(Ar,Pr)=>Ar===!0?!0:Math.max(Ar,Pr),resultToName:(Ar,Pr)=>Ar.var("items",Pr)})};function dr(Ar,Pr){if(Pr===!0)return Ar.var("props",!0);const kr=Ar.var("props",(0,e._)`{}`);return Pr!==void 0&&ur(Ar,kr,Pr),kr}xt.evaluatedPropsToName=dr;function ur(Ar,Pr,kr){Object.keys(kr).forEach(Ur=>Ar.assign((0,e._)`${Pr}${(0,e.getProperty)(Ur)}`,!0))}xt.setEvaluated=ur;const fr={};function pr(Ar,Pr){return Ar.scopeValue("func",{ref:Pr,code:fr[Pr.code]||(fr[Pr.code]=new At._Code(Pr.code))})}xt.useFunc=pr;var lr;(function(Ar){Ar[Ar.Num=0]="Num",Ar[Ar.Str=1]="Str"})(lr=xt.Type||(xt.Type={}));function yr(Ar,Pr,kr){if(Ar instanceof e.Name){const Ur=Pr===lr.Num;return kr?Ur?(0,e._)`"[" + ${Ar} + "]"`:(0,e._)`"['" + ${Ar} + "']"`:Ur?(0,e._)`"/" + ${Ar}`:(0,e._)`"/" + ${Ar}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return kr?(0,e.getProperty)(Ar).toString():"/"+rr(Ar)}xt.getErrorPath=yr;function br(Ar,Pr,kr=Ar.opts.strictSchema){if(kr){if(Pr=`strict mode: ${Pr}`,kr===!0)throw new Error(Pr);Ar.self.logger.warn(Pr)}}xt.checkStrictMode=br})(util$1);var names$1={};Object.defineProperty(names$1,"__esModule",{value:!0});const codegen_1$x=codegen,names={data:new codegen_1$x.Name("data"),valCxt:new codegen_1$x.Name("valCxt"),instancePath:new codegen_1$x.Name("instancePath"),parentData:new codegen_1$x.Name("parentData"),parentDataProperty:new codegen_1$x.Name("parentDataProperty"),rootData:new codegen_1$x.Name("rootData"),dynamicAnchors:new codegen_1$x.Name("dynamicAnchors"),vErrors:new codegen_1$x.Name("vErrors"),errors:new codegen_1$x.Name("errors"),this:new codegen_1$x.Name("this"),self:new codegen_1$x.Name("self"),scope:new codegen_1$x.Name("scope"),json:new codegen_1$x.Name("json"),jsonPos:new codegen_1$x.Name("jsonPos"),jsonLen:new codegen_1$x.Name("jsonLen"),jsonPart:new codegen_1$x.Name("jsonPart")};names$1.default=names;(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.extendErrors=xt.resetErrorsCount=xt.reportExtraError=xt.reportError=xt.keyword$DataError=xt.keywordError=void 0;const e=codegen,At=util$1,kt=names$1;xt.keywordError={message:({keyword:ur})=>(0,e.str)`must pass "${ur}" keyword validation`},xt.keyword$DataError={message:({keyword:ur,schemaType:fr})=>fr?(0,e.str)`"${ur}" keyword must be ${fr} ($data)`:(0,e.str)`"${ur}" keyword is invalid ($data)`};function Bt(ur,fr=xt.keywordError,pr,lr){const{it:yr}=ur,{gen:br,compositeRule:Ar,allErrors:Pr}=yr,kr=rr(ur,fr,pr);lr??(Ar||Pr)?er(br,kr):tr(yr,(0,e._)`[${kr}]`)}xt.reportError=Bt;function Nt(ur,fr=xt.keywordError,pr){const{it:lr}=ur,{gen:yr,compositeRule:br,allErrors:Ar}=lr,Pr=rr(ur,fr,pr);er(yr,Pr),br||Ar||tr(lr,kt.default.vErrors)}xt.reportExtraError=Nt;function jt(ur,fr){ur.assign(kt.default.errors,fr),ur.if((0,e._)`${kt.default.vErrors} !== null`,()=>ur.if(fr,()=>ur.assign((0,e._)`${kt.default.vErrors}.length`,fr),()=>ur.assign(kt.default.vErrors,null)))}xt.resetErrorsCount=jt;function Lt({gen:ur,keyword:fr,schemaValue:pr,data:lr,errsCount:yr,it:br}){if(yr===void 0)throw new Error("ajv implementation error");const Ar=ur.name("err");ur.forRange("i",yr,kt.default.errors,Pr=>{ur.const(Ar,(0,e._)`${kt.default.vErrors}[${Pr}]`),ur.if((0,e._)`${Ar}.instancePath === undefined`,()=>ur.assign((0,e._)`${Ar}.instancePath`,(0,e.strConcat)(kt.default.instancePath,br.errorPath))),ur.assign((0,e._)`${Ar}.schemaPath`,(0,e.str)`${br.errSchemaPath}/${fr}`),br.opts.verbose&&(ur.assign((0,e._)`${Ar}.schema`,pr),ur.assign((0,e._)`${Ar}.data`,lr))})}xt.extendErrors=Lt;function er(ur,fr){const pr=ur.const("err",fr);ur.if((0,e._)`${kt.default.vErrors} === null`,()=>ur.assign(kt.default.vErrors,(0,e._)`[${pr}]`),(0,e._)`${kt.default.vErrors}.push(${pr})`),ur.code((0,e._)`${kt.default.errors}++`)}function tr(ur,fr){const{gen:pr,validateName:lr,schemaEnv:yr}=ur;yr.$async?pr.throw((0,e._)`new ${ur.ValidationError}(${fr})`):(pr.assign((0,e._)`${lr}.errors`,fr),pr.return(!1))}const zt={keyword:new e.Name("keyword"),schemaPath:new e.Name("schemaPath"),params:new e.Name("params"),propertyName:new e.Name("propertyName"),message:new e.Name("message"),schema:new e.Name("schema"),parentSchema:new e.Name("parentSchema")};function rr(ur,fr,pr){const{createErrors:lr}=ur.it;return lr===!1?(0,e._)`{}`:nr(ur,fr,pr)}function nr(ur,fr,pr={}){const{gen:lr,it:yr}=ur,br=[ir(yr,pr),ar(ur,pr)];return dr(ur,fr,br),lr.object(...br)}function ir({errorPath:ur},{instancePath:fr}){const pr=fr?(0,e.str)`${ur}${(0,At.getErrorPath)(fr,At.Type.Str)}`:ur;return[kt.default.instancePath,(0,e.strConcat)(kt.default.instancePath,pr)]}function ar({keyword:ur,it:{errSchemaPath:fr}},{schemaPath:pr,parentSchema:lr}){let yr=lr?fr:(0,e.str)`${fr}/${ur}`;return pr&&(yr=(0,e.str)`${yr}${(0,At.getErrorPath)(pr,At.Type.Str)}`),[zt.schemaPath,yr]}function dr(ur,{params:fr,message:pr},lr){const{keyword:yr,data:br,schemaValue:Ar,it:Pr}=ur,{opts:kr,propertyName:Ur,topSchemaRef:Hr,schemaPath:Lr}=Pr;lr.push([zt.keyword,yr],[zt.params,typeof fr=="function"?fr(ur):fr||(0,e._)`{}`]),kr.messages&&lr.push([zt.message,typeof pr=="function"?pr(ur):pr]),kr.verbose&&lr.push([zt.schema,Ar],[zt.parentSchema,(0,e._)`${Hr}${Lr}`],[kt.default.data,br]),Ur&&lr.push([zt.propertyName,Ur])}})(errors$1);Object.defineProperty(boolSchema,"__esModule",{value:!0});boolSchema.boolOrEmptySchema=boolSchema.topBoolOrEmptySchema=void 0;const errors_1$2=errors$1,codegen_1$w=codegen,names_1$9=names$1,boolError={message:"boolean schema is false"};function topBoolOrEmptySchema(xt){const{gen:e,schema:At,validateName:kt}=xt;At===!1?falseSchemaError(xt,!1):typeof At=="object"&&At.$async===!0?e.return(names_1$9.default.data):(e.assign((0,codegen_1$w._)`${kt}.errors`,null),e.return(!0))}boolSchema.topBoolOrEmptySchema=topBoolOrEmptySchema;function boolOrEmptySchema(xt,e){const{gen:At,schema:kt}=xt;kt===!1?(At.var(e,!1),falseSchemaError(xt)):At.var(e,!0)}boolSchema.boolOrEmptySchema=boolOrEmptySchema;function falseSchemaError(xt,e){const{gen:At,data:kt}=xt,Bt={gen:At,keyword:"false schema",data:kt,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:xt};(0,errors_1$2.reportError)(Bt,boolError,void 0,e)}var dataType={},rules={};Object.defineProperty(rules,"__esModule",{value:!0});rules.getRules=rules.isJSONType=void 0;const _jsonTypes=["string","number","integer","boolean","null","object","array"],jsonTypes=new Set(_jsonTypes);function isJSONType(xt){return typeof xt=="string"&&jsonTypes.has(xt)}rules.isJSONType=isJSONType;function getRules(){const xt={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...xt,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},xt.number,xt.string,xt.array,xt.object],post:{rules:[]},all:{},keywords:{}}}rules.getRules=getRules;var applicability={};Object.defineProperty(applicability,"__esModule",{value:!0});applicability.shouldUseRule=applicability.shouldUseGroup=applicability.schemaHasRulesForType=void 0;function schemaHasRulesForType({schema:xt,self:e},At){const kt=e.RULES.types[At];return kt&&kt!==!0&&shouldUseGroup(xt,kt)}applicability.schemaHasRulesForType=schemaHasRulesForType;function shouldUseGroup(xt,e){return e.rules.some(At=>shouldUseRule(xt,At))}applicability.shouldUseGroup=shouldUseGroup;function shouldUseRule(xt,e){var At;return xt[e.keyword]!==void 0||((At=e.definition.implements)===null||At===void 0?void 0:At.some(kt=>xt[kt]!==void 0))}applicability.shouldUseRule=shouldUseRule;(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.reportTypeError=xt.checkDataTypes=xt.checkDataType=xt.coerceAndCheckDataType=xt.getJSONTypes=xt.getSchemaTypes=xt.DataType=void 0;const e=rules,At=applicability,kt=errors$1,Bt=codegen,Nt=util$1;var jt;(function(lr){lr[lr.Correct=0]="Correct",lr[lr.Wrong=1]="Wrong"})(jt=xt.DataType||(xt.DataType={}));function Lt(lr){const yr=er(lr.type);if(yr.includes("null")){if(lr.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!yr.length&&lr.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');lr.nullable===!0&&yr.push("null")}return yr}xt.getSchemaTypes=Lt;function er(lr){const yr=Array.isArray(lr)?lr:lr?[lr]:[];if(yr.every(e.isJSONType))return yr;throw new Error("type must be JSONType or JSONType[]: "+yr.join(","))}xt.getJSONTypes=er;function tr(lr,yr){const{gen:br,data:Ar,opts:Pr}=lr,kr=rr(yr,Pr.coerceTypes),Ur=yr.length>0&&!(kr.length===0&&yr.length===1&&(0,At.schemaHasRulesForType)(lr,yr[0]));if(Ur){const Hr=dr(yr,Ar,Pr.strictNumbers,jt.Wrong);br.if(Hr,()=>{kr.length?nr(lr,yr,kr):fr(lr)})}return Ur}xt.coerceAndCheckDataType=tr;const zt=new Set(["string","number","integer","boolean","null"]);function rr(lr,yr){return yr?lr.filter(br=>zt.has(br)||yr==="array"&&br==="array"):[]}function nr(lr,yr,br){const{gen:Ar,data:Pr,opts:kr}=lr,Ur=Ar.let("dataType",(0,Bt._)`typeof ${Pr}`),Hr=Ar.let("coerced",(0,Bt._)`undefined`);kr.coerceTypes==="array"&&Ar.if((0,Bt._)`${Ur} == 'object' && Array.isArray(${Pr}) && ${Pr}.length == 1`,()=>Ar.assign(Pr,(0,Bt._)`${Pr}[0]`).assign(Ur,(0,Bt._)`typeof ${Pr}`).if(dr(yr,Pr,kr.strictNumbers),()=>Ar.assign(Hr,Pr))),Ar.if((0,Bt._)`${Hr} !== undefined`);for(const Sr of br)(zt.has(Sr)||Sr==="array"&&kr.coerceTypes==="array")&&Lr(Sr);Ar.else(),fr(lr),Ar.endIf(),Ar.if((0,Bt._)`${Hr} !== undefined`,()=>{Ar.assign(Pr,Hr),ir(lr,Hr)});function Lr(Sr){switch(Sr){case"string":Ar.elseIf((0,Bt._)`${Ur} == "number" || ${Ur} == "boolean"`).assign(Hr,(0,Bt._)`"" + ${Pr}`).elseIf((0,Bt._)`${Pr} === null`).assign(Hr,(0,Bt._)`""`);return;case"number":Ar.elseIf((0,Bt._)`${Ur} == "boolean" || ${Pr} === null
              || (${Ur} == "string" && ${Pr} && ${Pr} == +${Pr})`).assign(Hr,(0,Bt._)`+${Pr}`);return;case"integer":Ar.elseIf((0,Bt._)`${Ur} === "boolean" || ${Pr} === null
              || (${Ur} === "string" && ${Pr} && ${Pr} == +${Pr} && !(${Pr} % 1))`).assign(Hr,(0,Bt._)`+${Pr}`);return;case"boolean":Ar.elseIf((0,Bt._)`${Pr} === "false" || ${Pr} === 0 || ${Pr} === null`).assign(Hr,!1).elseIf((0,Bt._)`${Pr} === "true" || ${Pr} === 1`).assign(Hr,!0);return;case"null":Ar.elseIf((0,Bt._)`${Pr} === "" || ${Pr} === 0 || ${Pr} === false`),Ar.assign(Hr,null);return;case"array":Ar.elseIf((0,Bt._)`${Ur} === "string" || ${Ur} === "number"
              || ${Ur} === "boolean" || ${Pr} === null`).assign(Hr,(0,Bt._)`[${Pr}]`)}}}function ir({gen:lr,parentData:yr,parentDataProperty:br},Ar){lr.if((0,Bt._)`${yr} !== undefined`,()=>lr.assign((0,Bt._)`${yr}[${br}]`,Ar))}function ar(lr,yr,br,Ar=jt.Correct){const Pr=Ar===jt.Correct?Bt.operators.EQ:Bt.operators.NEQ;let kr;switch(lr){case"null":return(0,Bt._)`${yr} ${Pr} null`;case"array":kr=(0,Bt._)`Array.isArray(${yr})`;break;case"object":kr=(0,Bt._)`${yr} && typeof ${yr} == "object" && !Array.isArray(${yr})`;break;case"integer":kr=Ur((0,Bt._)`!(${yr} % 1) && !isNaN(${yr})`);break;case"number":kr=Ur();break;default:return(0,Bt._)`typeof ${yr} ${Pr} ${lr}`}return Ar===jt.Correct?kr:(0,Bt.not)(kr);function Ur(Hr=Bt.nil){return(0,Bt.and)((0,Bt._)`typeof ${yr} == "number"`,Hr,br?(0,Bt._)`isFinite(${yr})`:Bt.nil)}}xt.checkDataType=ar;function dr(lr,yr,br,Ar){if(lr.length===1)return ar(lr[0],yr,br,Ar);let Pr;const kr=(0,Nt.toHash)(lr);if(kr.array&&kr.object){const Ur=(0,Bt._)`typeof ${yr} != "object"`;Pr=kr.null?Ur:(0,Bt._)`!${yr} || ${Ur}`,delete kr.null,delete kr.array,delete kr.object}else Pr=Bt.nil;kr.number&&delete kr.integer;for(const Ur in kr)Pr=(0,Bt.and)(Pr,ar(Ur,yr,br,Ar));return Pr}xt.checkDataTypes=dr;const ur={message:({schema:lr})=>`must be ${lr}`,params:({schema:lr,schemaValue:yr})=>typeof lr=="string"?(0,Bt._)`{type: ${lr}}`:(0,Bt._)`{type: ${yr}}`};function fr(lr){const yr=pr(lr);(0,kt.reportError)(yr,ur)}xt.reportTypeError=fr;function pr(lr){const{gen:yr,data:br,schema:Ar}=lr,Pr=(0,Nt.schemaRefOrVal)(lr,Ar,"type");return{gen:yr,keyword:"type",data:br,schema:Ar.type,schemaCode:Pr,schemaValue:Pr,parentSchema:Ar,params:{},it:lr}}})(dataType);var defaults={};Object.defineProperty(defaults,"__esModule",{value:!0});defaults.assignDefaults=void 0;const codegen_1$v=codegen,util_1$t=util$1;function assignDefaults(xt,e){const{properties:At,items:kt}=xt.schema;if(e==="object"&&At)for(const Bt in At)assignDefault(xt,Bt,At[Bt].default);else e==="array"&&Array.isArray(kt)&&kt.forEach((Bt,Nt)=>assignDefault(xt,Nt,Bt.default))}defaults.assignDefaults=assignDefaults;function assignDefault(xt,e,At){const{gen:kt,compositeRule:Bt,data:Nt,opts:jt}=xt;if(At===void 0)return;const Lt=(0,codegen_1$v._)`${Nt}${(0,codegen_1$v.getProperty)(e)}`;if(Bt){(0,util_1$t.checkStrictMode)(xt,`default is ignored for: ${Lt}`);return}let er=(0,codegen_1$v._)`${Lt} === undefined`;jt.useDefaults==="empty"&&(er=(0,codegen_1$v._)`${er} || ${Lt} === null || ${Lt} === ""`),kt.if(er,(0,codegen_1$v._)`${Lt} = ${(0,codegen_1$v.stringify)(At)}`)}var keyword={},code$1={};Object.defineProperty(code$1,"__esModule",{value:!0});code$1.validateUnion=code$1.validateArray=code$1.usePattern=code$1.callValidateCode=code$1.schemaProperties=code$1.allSchemaProperties=code$1.noPropertyInData=code$1.propertyInData=code$1.isOwnProperty=code$1.hasPropFunc=code$1.reportMissingProp=code$1.checkMissingProp=code$1.checkReportMissingProp=void 0;const codegen_1$u=codegen,util_1$s=util$1,names_1$8=names$1,util_2$1=util$1;function checkReportMissingProp(xt,e){const{gen:At,data:kt,it:Bt}=xt;At.if(noPropertyInData(At,kt,e,Bt.opts.ownProperties),()=>{xt.setParams({missingProperty:(0,codegen_1$u._)`${e}`},!0),xt.error()})}code$1.checkReportMissingProp=checkReportMissingProp;function checkMissingProp({gen:xt,data:e,it:{opts:At}},kt,Bt){return(0,codegen_1$u.or)(...kt.map(Nt=>(0,codegen_1$u.and)(noPropertyInData(xt,e,Nt,At.ownProperties),(0,codegen_1$u._)`${Bt} = ${Nt}`)))}code$1.checkMissingProp=checkMissingProp;function reportMissingProp(xt,e){xt.setParams({missingProperty:e},!0),xt.error()}code$1.reportMissingProp=reportMissingProp;function hasPropFunc(xt){return xt.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,codegen_1$u._)`Object.prototype.hasOwnProperty`})}code$1.hasPropFunc=hasPropFunc;function isOwnProperty(xt,e,At){return(0,codegen_1$u._)`${hasPropFunc(xt)}.call(${e}, ${At})`}code$1.isOwnProperty=isOwnProperty;function propertyInData(xt,e,At,kt){const Bt=(0,codegen_1$u._)`${e}${(0,codegen_1$u.getProperty)(At)} !== undefined`;return kt?(0,codegen_1$u._)`${Bt} && ${isOwnProperty(xt,e,At)}`:Bt}code$1.propertyInData=propertyInData;function noPropertyInData(xt,e,At,kt){const Bt=(0,codegen_1$u._)`${e}${(0,codegen_1$u.getProperty)(At)} === undefined`;return kt?(0,codegen_1$u.or)(Bt,(0,codegen_1$u.not)(isOwnProperty(xt,e,At))):Bt}code$1.noPropertyInData=noPropertyInData;function allSchemaProperties(xt){return xt?Object.keys(xt).filter(e=>e!=="__proto__"):[]}code$1.allSchemaProperties=allSchemaProperties;function schemaProperties(xt,e){return allSchemaProperties(e).filter(At=>!(0,util_1$s.alwaysValidSchema)(xt,e[At]))}code$1.schemaProperties=schemaProperties;function callValidateCode({schemaCode:xt,data:e,it:{gen:At,topSchemaRef:kt,schemaPath:Bt,errorPath:Nt},it:jt},Lt,er,tr){const zt=tr?(0,codegen_1$u._)`${xt}, ${e}, ${kt}${Bt}`:e,rr=[[names_1$8.default.instancePath,(0,codegen_1$u.strConcat)(names_1$8.default.instancePath,Nt)],[names_1$8.default.parentData,jt.parentData],[names_1$8.default.parentDataProperty,jt.parentDataProperty],[names_1$8.default.rootData,names_1$8.default.rootData]];jt.opts.dynamicRef&&rr.push([names_1$8.default.dynamicAnchors,names_1$8.default.dynamicAnchors]);const nr=(0,codegen_1$u._)`${zt}, ${At.object(...rr)}`;return er!==codegen_1$u.nil?(0,codegen_1$u._)`${Lt}.call(${er}, ${nr})`:(0,codegen_1$u._)`${Lt}(${nr})`}code$1.callValidateCode=callValidateCode;const newRegExp=(0,codegen_1$u._)`new RegExp`;function usePattern({gen:xt,it:{opts:e}},At){const kt=e.unicodeRegExp?"u":"",{regExp:Bt}=e.code,Nt=Bt(At,kt);return xt.scopeValue("pattern",{key:Nt.toString(),ref:Nt,code:(0,codegen_1$u._)`${Bt.code==="new RegExp"?newRegExp:(0,util_2$1.useFunc)(xt,Bt)}(${At}, ${kt})`})}code$1.usePattern=usePattern;function validateArray$1(xt){const{gen:e,data:At,keyword:kt,it:Bt}=xt,Nt=e.name("valid");if(Bt.allErrors){const Lt=e.let("valid",!0);return jt(()=>e.assign(Lt,!1)),Lt}return e.var(Nt,!0),jt(()=>e.break()),Nt;function jt(Lt){const er=e.const("len",(0,codegen_1$u._)`${At}.length`);e.forRange("i",0,er,tr=>{xt.subschema({keyword:kt,dataProp:tr,dataPropType:util_1$s.Type.Num},Nt),e.if((0,codegen_1$u.not)(Nt),Lt)})}}code$1.validateArray=validateArray$1;function validateUnion$1(xt){const{gen:e,schema:At,keyword:kt,it:Bt}=xt;if(!Array.isArray(At))throw new Error("ajv implementation error");if(At.some(er=>(0,util_1$s.alwaysValidSchema)(Bt,er))&&!Bt.opts.unevaluated)return;const jt=e.let("valid",!1),Lt=e.name("_valid");e.block(()=>At.forEach((er,tr)=>{const zt=xt.subschema({keyword:kt,schemaProp:tr,compositeRule:!0},Lt);e.assign(jt,(0,codegen_1$u._)`${jt} || ${Lt}`),xt.mergeValidEvaluated(zt,Lt)||e.if((0,codegen_1$u.not)(jt))})),xt.result(jt,()=>xt.reset(),()=>xt.error(!0))}code$1.validateUnion=validateUnion$1;Object.defineProperty(keyword,"__esModule",{value:!0});keyword.validateKeywordUsage=keyword.validSchemaType=keyword.funcKeywordCode=keyword.macroKeywordCode=void 0;const codegen_1$t=codegen,names_1$7=names$1,code_1$9=code$1,errors_1$1=errors$1;function macroKeywordCode(xt,e){const{gen:At,keyword:kt,schema:Bt,parentSchema:Nt,it:jt}=xt,Lt=e.macro.call(jt.self,Bt,Nt,jt),er=useKeyword(At,kt,Lt);jt.opts.validateSchema!==!1&&jt.self.validateSchema(Lt,!0);const tr=At.name("valid");xt.subschema({schema:Lt,schemaPath:codegen_1$t.nil,errSchemaPath:`${jt.errSchemaPath}/${kt}`,topSchemaRef:er,compositeRule:!0},tr),xt.pass(tr,()=>xt.error(!0))}keyword.macroKeywordCode=macroKeywordCode;function funcKeywordCode(xt,e){var At;const{gen:kt,keyword:Bt,schema:Nt,parentSchema:jt,$data:Lt,it:er}=xt;checkAsyncKeyword(er,e);const tr=!Lt&&e.compile?e.compile.call(er.self,Nt,jt,er):e.validate,zt=useKeyword(kt,Bt,tr),rr=kt.let("valid");xt.block$data(rr,nr),xt.ok((At=e.valid)!==null&&At!==void 0?At:rr);function nr(){if(e.errors===!1)dr(),e.modifying&&modifyData(xt),ur(()=>xt.error());else{const fr=e.async?ir():ar();e.modifying&&modifyData(xt),ur(()=>addErrs(xt,fr))}}function ir(){const fr=kt.let("ruleErrs",null);return kt.try(()=>dr((0,codegen_1$t._)`await `),pr=>kt.assign(rr,!1).if((0,codegen_1$t._)`${pr} instanceof ${er.ValidationError}`,()=>kt.assign(fr,(0,codegen_1$t._)`${pr}.errors`),()=>kt.throw(pr))),fr}function ar(){const fr=(0,codegen_1$t._)`${zt}.errors`;return kt.assign(fr,null),dr(codegen_1$t.nil),fr}function dr(fr=e.async?(0,codegen_1$t._)`await `:codegen_1$t.nil){const pr=er.opts.passContext?names_1$7.default.this:names_1$7.default.self,lr=!("compile"in e&&!Lt||e.schema===!1);kt.assign(rr,(0,codegen_1$t._)`${fr}${(0,code_1$9.callValidateCode)(xt,zt,pr,lr)}`,e.modifying)}function ur(fr){var pr;kt.if((0,codegen_1$t.not)((pr=e.valid)!==null&&pr!==void 0?pr:rr),fr)}}keyword.funcKeywordCode=funcKeywordCode;function modifyData(xt){const{gen:e,data:At,it:kt}=xt;e.if(kt.parentData,()=>e.assign(At,(0,codegen_1$t._)`${kt.parentData}[${kt.parentDataProperty}]`))}function addErrs(xt,e){const{gen:At}=xt;At.if((0,codegen_1$t._)`Array.isArray(${e})`,()=>{At.assign(names_1$7.default.vErrors,(0,codegen_1$t._)`${names_1$7.default.vErrors} === null ? ${e} : ${names_1$7.default.vErrors}.concat(${e})`).assign(names_1$7.default.errors,(0,codegen_1$t._)`${names_1$7.default.vErrors}.length`),(0,errors_1$1.extendErrors)(xt)},()=>xt.error())}function checkAsyncKeyword({schemaEnv:xt},e){if(e.async&&!xt.$async)throw new Error("async keyword in sync schema")}function useKeyword(xt,e,At){if(At===void 0)throw new Error(`keyword "${e}" failed to compile`);return xt.scopeValue("keyword",typeof At=="function"?{ref:At}:{ref:At,code:(0,codegen_1$t.stringify)(At)})}function validSchemaType(xt,e,At=!1){return!e.length||e.some(kt=>kt==="array"?Array.isArray(xt):kt==="object"?xt&&typeof xt=="object"&&!Array.isArray(xt):typeof xt==kt||At&&typeof xt>"u")}keyword.validSchemaType=validSchemaType;function validateKeywordUsage({schema:xt,opts:e,self:At,errSchemaPath:kt},Bt,Nt){if(Array.isArray(Bt.keyword)?!Bt.keyword.includes(Nt):Bt.keyword!==Nt)throw new Error("ajv implementation error");const jt=Bt.dependencies;if(jt!=null&&jt.some(Lt=>!Object.prototype.hasOwnProperty.call(xt,Lt)))throw new Error(`parent schema must have dependencies of ${Nt}: ${jt.join(",")}`);if(Bt.validateSchema&&!Bt.validateSchema(xt[Nt])){const er=`keyword "${Nt}" value is invalid at path "${kt}": `+At.errorsText(Bt.validateSchema.errors);if(e.validateSchema==="log")At.logger.error(er);else throw new Error(er)}}keyword.validateKeywordUsage=validateKeywordUsage;var subschema={};Object.defineProperty(subschema,"__esModule",{value:!0});subschema.extendSubschemaMode=subschema.extendSubschemaData=subschema.getSubschema=void 0;const codegen_1$s=codegen,util_1$r=util$1;function getSubschema(xt,{keyword:e,schemaProp:At,schema:kt,schemaPath:Bt,errSchemaPath:Nt,topSchemaRef:jt}){if(e!==void 0&&kt!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(e!==void 0){const Lt=xt.schema[e];return At===void 0?{schema:Lt,schemaPath:(0,codegen_1$s._)`${xt.schemaPath}${(0,codegen_1$s.getProperty)(e)}`,errSchemaPath:`${xt.errSchemaPath}/${e}`}:{schema:Lt[At],schemaPath:(0,codegen_1$s._)`${xt.schemaPath}${(0,codegen_1$s.getProperty)(e)}${(0,codegen_1$s.getProperty)(At)}`,errSchemaPath:`${xt.errSchemaPath}/${e}/${(0,util_1$r.escapeFragment)(At)}`}}if(kt!==void 0){if(Bt===void 0||Nt===void 0||jt===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:kt,schemaPath:Bt,topSchemaRef:jt,errSchemaPath:Nt}}throw new Error('either "keyword" or "schema" must be passed')}subschema.getSubschema=getSubschema;function extendSubschemaData(xt,e,{dataProp:At,dataPropType:kt,data:Bt,dataTypes:Nt,propertyName:jt}){if(Bt!==void 0&&At!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:Lt}=e;if(At!==void 0){const{errorPath:tr,dataPathArr:zt,opts:rr}=e,nr=Lt.let("data",(0,codegen_1$s._)`${e.data}${(0,codegen_1$s.getProperty)(At)}`,!0);er(nr),xt.errorPath=(0,codegen_1$s.str)`${tr}${(0,util_1$r.getErrorPath)(At,kt,rr.jsPropertySyntax)}`,xt.parentDataProperty=(0,codegen_1$s._)`${At}`,xt.dataPathArr=[...zt,xt.parentDataProperty]}if(Bt!==void 0){const tr=Bt instanceof codegen_1$s.Name?Bt:Lt.let("data",Bt,!0);er(tr),jt!==void 0&&(xt.propertyName=jt)}Nt&&(xt.dataTypes=Nt);function er(tr){xt.data=tr,xt.dataLevel=e.dataLevel+1,xt.dataTypes=[],e.definedProperties=new Set,xt.parentData=e.data,xt.dataNames=[...e.dataNames,tr]}}subschema.extendSubschemaData=extendSubschemaData;function extendSubschemaMode(xt,{jtdDiscriminator:e,jtdMetadata:At,compositeRule:kt,createErrors:Bt,allErrors:Nt}){kt!==void 0&&(xt.compositeRule=kt),Bt!==void 0&&(xt.createErrors=Bt),Nt!==void 0&&(xt.allErrors=Nt),xt.jtdDiscriminator=e,xt.jtdMetadata=At}subschema.extendSubschemaMode=extendSubschemaMode;var resolve$5={},fastDeepEqual=function xt(e,At){if(e===At)return!0;if(e&&At&&typeof e=="object"&&typeof At=="object"){if(e.constructor!==At.constructor)return!1;var kt,Bt,Nt;if(Array.isArray(e)){if(kt=e.length,kt!=At.length)return!1;for(Bt=kt;Bt--!==0;)if(!xt(e[Bt],At[Bt]))return!1;return!0}if(e.constructor===RegExp)return e.source===At.source&&e.flags===At.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===At.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===At.toString();if(Nt=Object.keys(e),kt=Nt.length,kt!==Object.keys(At).length)return!1;for(Bt=kt;Bt--!==0;)if(!Object.prototype.hasOwnProperty.call(At,Nt[Bt]))return!1;for(Bt=kt;Bt--!==0;){var jt=Nt[Bt];if(!xt(e[jt],At[jt]))return!1}return!0}return e!==e&&At!==At},jsonSchemaTraverse={exports:{}},traverse$1=jsonSchemaTraverse.exports=function(xt,e,At){typeof e=="function"&&(At=e,e={}),At=e.cb||At;var kt=typeof At=="function"?At:At.pre||function(){},Bt=At.post||function(){};_traverse(e,kt,Bt,xt,"",xt)};traverse$1.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};traverse$1.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};traverse$1.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};traverse$1.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function _traverse(xt,e,At,kt,Bt,Nt,jt,Lt,er,tr){if(kt&&typeof kt=="object"&&!Array.isArray(kt)){e(kt,Bt,Nt,jt,Lt,er,tr);for(var zt in kt){var rr=kt[zt];if(Array.isArray(rr)){if(zt in traverse$1.arrayKeywords)for(var nr=0;nr<rr.length;nr++)_traverse(xt,e,At,rr[nr],Bt+"/"+zt+"/"+nr,Nt,Bt,zt,kt,nr)}else if(zt in traverse$1.propsKeywords){if(rr&&typeof rr=="object")for(var ir in rr)_traverse(xt,e,At,rr[ir],Bt+"/"+zt+"/"+escapeJsonPtr(ir),Nt,Bt,zt,kt,ir)}else(zt in traverse$1.keywords||xt.allKeys&&!(zt in traverse$1.skipKeywords))&&_traverse(xt,e,At,rr,Bt+"/"+zt,Nt,Bt,zt,kt)}At(kt,Bt,Nt,jt,Lt,er,tr)}}function escapeJsonPtr(xt){return xt.replace(/~/g,"~0").replace(/\//g,"~1")}var jsonSchemaTraverseExports=jsonSchemaTraverse.exports;Object.defineProperty(resolve$5,"__esModule",{value:!0});resolve$5.getSchemaRefs=resolve$5.resolveUrl=resolve$5.normalizeId=resolve$5._getFullPath=resolve$5.getFullPath=resolve$5.inlineRef=void 0;const util_1$q=util$1,equal$2=fastDeepEqual,traverse=jsonSchemaTraverseExports,SIMPLE_INLINED=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function inlineRef(xt,e=!0){return typeof xt=="boolean"?!0:e===!0?!hasRef(xt):e?countKeys(xt)<=e:!1}resolve$5.inlineRef=inlineRef;const REF_KEYWORDS=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function hasRef(xt){for(const e in xt){if(REF_KEYWORDS.has(e))return!0;const At=xt[e];if(Array.isArray(At)&&At.some(hasRef)||typeof At=="object"&&hasRef(At))return!0}return!1}function countKeys(xt){let e=0;for(const At in xt){if(At==="$ref")return 1/0;if(e++,!SIMPLE_INLINED.has(At)&&(typeof xt[At]=="object"&&(0,util_1$q.eachItem)(xt[At],kt=>e+=countKeys(kt)),e===1/0))return 1/0}return e}function getFullPath(xt,e="",At){At!==!1&&(e=normalizeId(e));const kt=xt.parse(e);return _getFullPath(xt,kt)}resolve$5.getFullPath=getFullPath;function _getFullPath(xt,e){return xt.serialize(e).split("#")[0]+"#"}resolve$5._getFullPath=_getFullPath;const TRAILING_SLASH_HASH=/#\/?$/;function normalizeId(xt){return xt?xt.replace(TRAILING_SLASH_HASH,""):""}resolve$5.normalizeId=normalizeId;function resolveUrl(xt,e,At){return At=normalizeId(At),xt.resolve(e,At)}resolve$5.resolveUrl=resolveUrl;const ANCHOR=/^[a-z_][-a-z0-9._]*$/i;function getSchemaRefs(xt,e){if(typeof xt=="boolean")return{};const{schemaId:At,uriResolver:kt}=this.opts,Bt=normalizeId(xt[At]||e),Nt={"":Bt},jt=getFullPath(kt,Bt,!1),Lt={},er=new Set;return traverse(xt,{allKeys:!0},(rr,nr,ir,ar)=>{if(ar===void 0)return;const dr=jt+nr;let ur=Nt[ar];typeof rr[At]=="string"&&(ur=fr.call(this,rr[At])),pr.call(this,rr.$anchor),pr.call(this,rr.$dynamicAnchor),Nt[nr]=ur;function fr(lr){const yr=this.opts.uriResolver.resolve;if(lr=normalizeId(ur?yr(ur,lr):lr),er.has(lr))throw zt(lr);er.add(lr);let br=this.refs[lr];return typeof br=="string"&&(br=this.refs[br]),typeof br=="object"?tr(rr,br.schema,lr):lr!==normalizeId(dr)&&(lr[0]==="#"?(tr(rr,Lt[lr],lr),Lt[lr]=rr):this.refs[lr]=dr),lr}function pr(lr){if(typeof lr=="string"){if(!ANCHOR.test(lr))throw new Error(`invalid anchor "${lr}"`);fr.call(this,`#${lr}`)}}}),Lt;function tr(rr,nr,ir){if(nr!==void 0&&!equal$2(rr,nr))throw zt(ir)}function zt(rr){return new Error(`reference "${rr}" resolves to more than one schema`)}}resolve$5.getSchemaRefs=getSchemaRefs;Object.defineProperty(validate,"__esModule",{value:!0});validate.getData=validate.KeywordCxt=validate.validateFunctionCode=void 0;const boolSchema_1=boolSchema,dataType_1$1=dataType,applicability_1=applicability,dataType_2=dataType,defaults_1=defaults,keyword_1=keyword,subschema_1=subschema,codegen_1$r=codegen,names_1$6=names$1,resolve_1$2=resolve$5,util_1$p=util$1,errors_1=errors$1;function validateFunctionCode(xt){if(isSchemaObj(xt)&&(checkKeywords(xt),schemaCxtHasRules(xt))){topSchemaObjCode(xt);return}validateFunction$3(xt,()=>(0,boolSchema_1.topBoolOrEmptySchema)(xt))}validate.validateFunctionCode=validateFunctionCode;function validateFunction$3({gen:xt,validateName:e,schema:At,schemaEnv:kt,opts:Bt},Nt){Bt.code.es5?xt.func(e,(0,codegen_1$r._)`${names_1$6.default.data}, ${names_1$6.default.valCxt}`,kt.$async,()=>{xt.code((0,codegen_1$r._)`"use strict"; ${funcSourceUrl(At,Bt)}`),destructureValCxtES5(xt,Bt),xt.code(Nt)}):xt.func(e,(0,codegen_1$r._)`${names_1$6.default.data}, ${destructureValCxt(Bt)}`,kt.$async,()=>xt.code(funcSourceUrl(At,Bt)).code(Nt))}function destructureValCxt(xt){return(0,codegen_1$r._)`{${names_1$6.default.instancePath}="", ${names_1$6.default.parentData}, ${names_1$6.default.parentDataProperty}, ${names_1$6.default.rootData}=${names_1$6.default.data}${xt.dynamicRef?(0,codegen_1$r._)`, ${names_1$6.default.dynamicAnchors}={}`:codegen_1$r.nil}}={}`}function destructureValCxtES5(xt,e){xt.if(names_1$6.default.valCxt,()=>{xt.var(names_1$6.default.instancePath,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.instancePath}`),xt.var(names_1$6.default.parentData,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.parentData}`),xt.var(names_1$6.default.parentDataProperty,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.parentDataProperty}`),xt.var(names_1$6.default.rootData,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.rootData}`),e.dynamicRef&&xt.var(names_1$6.default.dynamicAnchors,(0,codegen_1$r._)`${names_1$6.default.valCxt}.${names_1$6.default.dynamicAnchors}`)},()=>{xt.var(names_1$6.default.instancePath,(0,codegen_1$r._)`""`),xt.var(names_1$6.default.parentData,(0,codegen_1$r._)`undefined`),xt.var(names_1$6.default.parentDataProperty,(0,codegen_1$r._)`undefined`),xt.var(names_1$6.default.rootData,names_1$6.default.data),e.dynamicRef&&xt.var(names_1$6.default.dynamicAnchors,(0,codegen_1$r._)`{}`)})}function topSchemaObjCode(xt){const{schema:e,opts:At,gen:kt}=xt;validateFunction$3(xt,()=>{At.$comment&&e.$comment&&commentKeyword(xt),checkNoDefault(xt),kt.let(names_1$6.default.vErrors,null),kt.let(names_1$6.default.errors,0),At.unevaluated&&resetEvaluated(xt),typeAndKeywords(xt),returnResults(xt)})}function resetEvaluated(xt){const{gen:e,validateName:At}=xt;xt.evaluated=e.const("evaluated",(0,codegen_1$r._)`${At}.evaluated`),e.if((0,codegen_1$r._)`${xt.evaluated}.dynamicProps`,()=>e.assign((0,codegen_1$r._)`${xt.evaluated}.props`,(0,codegen_1$r._)`undefined`)),e.if((0,codegen_1$r._)`${xt.evaluated}.dynamicItems`,()=>e.assign((0,codegen_1$r._)`${xt.evaluated}.items`,(0,codegen_1$r._)`undefined`))}function funcSourceUrl(xt,e){const At=typeof xt=="object"&&xt[e.schemaId];return At&&(e.code.source||e.code.process)?(0,codegen_1$r._)`/*# sourceURL=${At} */`:codegen_1$r.nil}function subschemaCode(xt,e){if(isSchemaObj(xt)&&(checkKeywords(xt),schemaCxtHasRules(xt))){subSchemaObjCode(xt,e);return}(0,boolSchema_1.boolOrEmptySchema)(xt,e)}function schemaCxtHasRules({schema:xt,self:e}){if(typeof xt=="boolean")return!xt;for(const At in xt)if(e.RULES.all[At])return!0;return!1}function isSchemaObj(xt){return typeof xt.schema!="boolean"}function subSchemaObjCode(xt,e){const{schema:At,gen:kt,opts:Bt}=xt;Bt.$comment&&At.$comment&&commentKeyword(xt),updateContext(xt),checkAsyncSchema(xt);const Nt=kt.const("_errs",names_1$6.default.errors);typeAndKeywords(xt,Nt),kt.var(e,(0,codegen_1$r._)`${Nt} === ${names_1$6.default.errors}`)}function checkKeywords(xt){(0,util_1$p.checkUnknownRules)(xt),checkRefsAndKeywords(xt)}function typeAndKeywords(xt,e){if(xt.opts.jtd)return schemaKeywords(xt,[],!1,e);const At=(0,dataType_1$1.getSchemaTypes)(xt.schema),kt=(0,dataType_1$1.coerceAndCheckDataType)(xt,At);schemaKeywords(xt,At,!kt,e)}function checkRefsAndKeywords(xt){const{schema:e,errSchemaPath:At,opts:kt,self:Bt}=xt;e.$ref&&kt.ignoreKeywordsWithRef&&(0,util_1$p.schemaHasRulesButRef)(e,Bt.RULES)&&Bt.logger.warn(`$ref: keywords ignored in schema at path "${At}"`)}function checkNoDefault(xt){const{schema:e,opts:At}=xt;e.default!==void 0&&At.useDefaults&&At.strictSchema&&(0,util_1$p.checkStrictMode)(xt,"default is ignored in the schema root")}function updateContext(xt){const e=xt.schema[xt.opts.schemaId];e&&(xt.baseId=(0,resolve_1$2.resolveUrl)(xt.opts.uriResolver,xt.baseId,e))}function checkAsyncSchema(xt){if(xt.schema.$async&&!xt.schemaEnv.$async)throw new Error("async schema in sync schema")}function commentKeyword({gen:xt,schemaEnv:e,schema:At,errSchemaPath:kt,opts:Bt}){const Nt=At.$comment;if(Bt.$comment===!0)xt.code((0,codegen_1$r._)`${names_1$6.default.self}.logger.log(${Nt})`);else if(typeof Bt.$comment=="function"){const jt=(0,codegen_1$r.str)`${kt}/$comment`,Lt=xt.scopeValue("root",{ref:e.root});xt.code((0,codegen_1$r._)`${names_1$6.default.self}.opts.$comment(${Nt}, ${jt}, ${Lt}.schema)`)}}function returnResults(xt){const{gen:e,schemaEnv:At,validateName:kt,ValidationError:Bt,opts:Nt}=xt;At.$async?e.if((0,codegen_1$r._)`${names_1$6.default.errors} === 0`,()=>e.return(names_1$6.default.data),()=>e.throw((0,codegen_1$r._)`new ${Bt}(${names_1$6.default.vErrors})`)):(e.assign((0,codegen_1$r._)`${kt}.errors`,names_1$6.default.vErrors),Nt.unevaluated&&assignEvaluated(xt),e.return((0,codegen_1$r._)`${names_1$6.default.errors} === 0`))}function assignEvaluated({gen:xt,evaluated:e,props:At,items:kt}){At instanceof codegen_1$r.Name&&xt.assign((0,codegen_1$r._)`${e}.props`,At),kt instanceof codegen_1$r.Name&&xt.assign((0,codegen_1$r._)`${e}.items`,kt)}function schemaKeywords(xt,e,At,kt){const{gen:Bt,schema:Nt,data:jt,allErrors:Lt,opts:er,self:tr}=xt,{RULES:zt}=tr;if(Nt.$ref&&(er.ignoreKeywordsWithRef||!(0,util_1$p.schemaHasRulesButRef)(Nt,zt))){Bt.block(()=>keywordCode(xt,"$ref",zt.all.$ref.definition));return}er.jtd||checkStrictTypes(xt,e),Bt.block(()=>{for(const nr of zt.rules)rr(nr);rr(zt.post)});function rr(nr){(0,applicability_1.shouldUseGroup)(Nt,nr)&&(nr.type?(Bt.if((0,dataType_2.checkDataType)(nr.type,jt,er.strictNumbers)),iterateKeywords(xt,nr),e.length===1&&e[0]===nr.type&&At&&(Bt.else(),(0,dataType_2.reportTypeError)(xt)),Bt.endIf()):iterateKeywords(xt,nr),Lt||Bt.if((0,codegen_1$r._)`${names_1$6.default.errors} === ${kt||0}`))}}function iterateKeywords(xt,e){const{gen:At,schema:kt,opts:{useDefaults:Bt}}=xt;Bt&&(0,defaults_1.assignDefaults)(xt,e.type),At.block(()=>{for(const Nt of e.rules)(0,applicability_1.shouldUseRule)(kt,Nt)&&keywordCode(xt,Nt.keyword,Nt.definition,e.type)})}function checkStrictTypes(xt,e){xt.schemaEnv.meta||!xt.opts.strictTypes||(checkContextTypes(xt,e),xt.opts.allowUnionTypes||checkMultipleTypes(xt,e),checkKeywordTypes(xt,xt.dataTypes))}function checkContextTypes(xt,e){if(e.length){if(!xt.dataTypes.length){xt.dataTypes=e;return}e.forEach(At=>{includesType(xt.dataTypes,At)||strictTypesError(xt,`type "${At}" not allowed by context "${xt.dataTypes.join(",")}"`)}),narrowSchemaTypes(xt,e)}}function checkMultipleTypes(xt,e){e.length>1&&!(e.length===2&&e.includes("null"))&&strictTypesError(xt,"use allowUnionTypes to allow union type keyword")}function checkKeywordTypes(xt,e){const At=xt.self.RULES.all;for(const kt in At){const Bt=At[kt];if(typeof Bt=="object"&&(0,applicability_1.shouldUseRule)(xt.schema,Bt)){const{type:Nt}=Bt.definition;Nt.length&&!Nt.some(jt=>hasApplicableType(e,jt))&&strictTypesError(xt,`missing type "${Nt.join(",")}" for keyword "${kt}"`)}}}function hasApplicableType(xt,e){return xt.includes(e)||e==="number"&&xt.includes("integer")}function includesType(xt,e){return xt.includes(e)||e==="integer"&&xt.includes("number")}function narrowSchemaTypes(xt,e){const At=[];for(const kt of xt.dataTypes)includesType(e,kt)?At.push(kt):e.includes("integer")&&kt==="number"&&At.push("integer");xt.dataTypes=At}function strictTypesError(xt,e){const At=xt.schemaEnv.baseId+xt.errSchemaPath;e+=` at "${At}" (strictTypes)`,(0,util_1$p.checkStrictMode)(xt,e,xt.opts.strictTypes)}class KeywordCxt{constructor(e,At,kt){if((0,keyword_1.validateKeywordUsage)(e,At,kt),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=kt,this.data=e.data,this.schema=e.schema[kt],this.$data=At.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,util_1$p.schemaRefOrVal)(e,this.schema,kt,this.$data),this.schemaType=At.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=At,this.$data)this.schemaCode=e.gen.const("vSchema",getData(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,keyword_1.validSchemaType)(this.schema,At.schemaType,At.allowUndefined))throw new Error(`${kt} value must be ${JSON.stringify(At.schemaType)}`);("code"in At?At.trackErrors:At.errors!==!1)&&(this.errsCount=e.gen.const("_errs",names_1$6.default.errors))}result(e,At,kt){this.failResult((0,codegen_1$r.not)(e),At,kt)}failResult(e,At,kt){this.gen.if(e),kt?kt():this.error(),At?(this.gen.else(),At(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,At){this.failResult((0,codegen_1$r.not)(e),void 0,At)}fail(e){if(e===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:At}=this;this.fail((0,codegen_1$r._)`${At} !== undefined && (${(0,codegen_1$r.or)(this.invalid$data(),e)})`)}error(e,At,kt){if(At){this.setParams(At),this._error(e,kt),this.setParams({});return}this._error(e,kt)}_error(e,At){(e?errors_1.reportExtraError:errors_1.reportError)(this,this.def.error,At)}$dataError(){(0,errors_1.reportError)(this,this.def.$dataError||errors_1.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,errors_1.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,At){At?Object.assign(this.params,e):this.params=e}block$data(e,At,kt=codegen_1$r.nil){this.gen.block(()=>{this.check$data(e,kt),At()})}check$data(e=codegen_1$r.nil,At=codegen_1$r.nil){if(!this.$data)return;const{gen:kt,schemaCode:Bt,schemaType:Nt,def:jt}=this;kt.if((0,codegen_1$r.or)((0,codegen_1$r._)`${Bt} === undefined`,At)),e!==codegen_1$r.nil&&kt.assign(e,!0),(Nt.length||jt.validateSchema)&&(kt.elseIf(this.invalid$data()),this.$dataError(),e!==codegen_1$r.nil&&kt.assign(e,!1)),kt.else()}invalid$data(){const{gen:e,schemaCode:At,schemaType:kt,def:Bt,it:Nt}=this;return(0,codegen_1$r.or)(jt(),Lt());function jt(){if(kt.length){if(!(At instanceof codegen_1$r.Name))throw new Error("ajv implementation error");const er=Array.isArray(kt)?kt:[kt];return(0,codegen_1$r._)`${(0,dataType_2.checkDataTypes)(er,At,Nt.opts.strictNumbers,dataType_2.DataType.Wrong)}`}return codegen_1$r.nil}function Lt(){if(Bt.validateSchema){const er=e.scopeValue("validate$data",{ref:Bt.validateSchema});return(0,codegen_1$r._)`!${er}(${At})`}return codegen_1$r.nil}}subschema(e,At){const kt=(0,subschema_1.getSubschema)(this.it,e);(0,subschema_1.extendSubschemaData)(kt,this.it,e),(0,subschema_1.extendSubschemaMode)(kt,e);const Bt={...this.it,...kt,items:void 0,props:void 0};return subschemaCode(Bt,At),Bt}mergeEvaluated(e,At){const{it:kt,gen:Bt}=this;kt.opts.unevaluated&&(kt.props!==!0&&e.props!==void 0&&(kt.props=util_1$p.mergeEvaluated.props(Bt,e.props,kt.props,At)),kt.items!==!0&&e.items!==void 0&&(kt.items=util_1$p.mergeEvaluated.items(Bt,e.items,kt.items,At)))}mergeValidEvaluated(e,At){const{it:kt,gen:Bt}=this;if(kt.opts.unevaluated&&(kt.props!==!0||kt.items!==!0))return Bt.if(At,()=>this.mergeEvaluated(e,codegen_1$r.Name)),!0}}validate.KeywordCxt=KeywordCxt;function keywordCode(xt,e,At,kt){const Bt=new KeywordCxt(xt,At,e);"code"in At?At.code(Bt,kt):Bt.$data&&At.validate?(0,keyword_1.funcKeywordCode)(Bt,At):"macro"in At?(0,keyword_1.macroKeywordCode)(Bt,At):(At.compile||At.validate)&&(0,keyword_1.funcKeywordCode)(Bt,At)}const JSON_POINTER=/^\/(?:[^~]|~0|~1)*$/,RELATIVE_JSON_POINTER=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function getData(xt,{dataLevel:e,dataNames:At,dataPathArr:kt}){let Bt,Nt;if(xt==="")return names_1$6.default.rootData;if(xt[0]==="/"){if(!JSON_POINTER.test(xt))throw new Error(`Invalid JSON-pointer: ${xt}`);Bt=xt,Nt=names_1$6.default.rootData}else{const tr=RELATIVE_JSON_POINTER.exec(xt);if(!tr)throw new Error(`Invalid JSON-pointer: ${xt}`);const zt=+tr[1];if(Bt=tr[2],Bt==="#"){if(zt>=e)throw new Error(er("property/index",zt));return kt[e-zt]}if(zt>e)throw new Error(er("data",zt));if(Nt=At[e-zt],!Bt)return Nt}let jt=Nt;const Lt=Bt.split("/");for(const tr of Lt)tr&&(Nt=(0,codegen_1$r._)`${Nt}${(0,codegen_1$r.getProperty)((0,util_1$p.unescapeJsonPointer)(tr))}`,jt=(0,codegen_1$r._)`${jt} && ${Nt}`);return jt;function er(tr,zt){return`Cannot access ${tr} ${zt} levels up, current level is ${e}`}}validate.getData=getData;var validation_error={};Object.defineProperty(validation_error,"__esModule",{value:!0});class ValidationError extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}validation_error.default=ValidationError;var ref_error={};Object.defineProperty(ref_error,"__esModule",{value:!0});const resolve_1$1=resolve$5;class MissingRefError extends Error{constructor(e,At,kt,Bt){super(Bt||`can't resolve reference ${kt} from id ${At}`),this.missingRef=(0,resolve_1$1.resolveUrl)(e,At,kt),this.missingSchema=(0,resolve_1$1.normalizeId)((0,resolve_1$1.getFullPath)(e,this.missingRef))}}ref_error.default=MissingRefError;var compile={};Object.defineProperty(compile,"__esModule",{value:!0});compile.resolveSchema=compile.getCompilingSchema=compile.resolveRef=compile.compileSchema=compile.SchemaEnv=void 0;const codegen_1$q=codegen,validation_error_1=validation_error,names_1$5=names$1,resolve_1=resolve$5,util_1$o=util$1,validate_1$1=validate;class SchemaEnv{constructor(e){var At;this.refs={},this.dynamicAnchors={};let kt;typeof e.schema=="object"&&(kt=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=(At=e.baseId)!==null&&At!==void 0?At:(0,resolve_1.normalizeId)(kt==null?void 0:kt[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=kt==null?void 0:kt.$async,this.refs={}}}compile.SchemaEnv=SchemaEnv;function compileSchema(xt){const e=getCompilingSchema.call(this,xt);if(e)return e;const At=(0,resolve_1.getFullPath)(this.opts.uriResolver,xt.root.baseId),{es5:kt,lines:Bt}=this.opts.code,{ownProperties:Nt}=this.opts,jt=new codegen_1$q.CodeGen(this.scope,{es5:kt,lines:Bt,ownProperties:Nt});let Lt;xt.$async&&(Lt=jt.scopeValue("Error",{ref:validation_error_1.default,code:(0,codegen_1$q._)`require("ajv/dist/runtime/validation_error").default`}));const er=jt.scopeName("validate");xt.validateName=er;const tr={gen:jt,allErrors:this.opts.allErrors,data:names_1$5.default.data,parentData:names_1$5.default.parentData,parentDataProperty:names_1$5.default.parentDataProperty,dataNames:[names_1$5.default.data],dataPathArr:[codegen_1$q.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:jt.scopeValue("schema",this.opts.code.source===!0?{ref:xt.schema,code:(0,codegen_1$q.stringify)(xt.schema)}:{ref:xt.schema}),validateName:er,ValidationError:Lt,schema:xt.schema,schemaEnv:xt,rootId:At,baseId:xt.baseId||At,schemaPath:codegen_1$q.nil,errSchemaPath:xt.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,codegen_1$q._)`""`,opts:this.opts,self:this};let zt;try{this._compilations.add(xt),(0,validate_1$1.validateFunctionCode)(tr),jt.optimize(this.opts.code.optimize);const rr=jt.toString();zt=`${jt.scopeRefs(names_1$5.default.scope)}return ${rr}`,this.opts.code.process&&(zt=this.opts.code.process(zt,xt));const ir=new Function(`${names_1$5.default.self}`,`${names_1$5.default.scope}`,zt)(this,this.scope.get());if(this.scope.value(er,{ref:ir}),ir.errors=null,ir.schema=xt.schema,ir.schemaEnv=xt,xt.$async&&(ir.$async=!0),this.opts.code.source===!0&&(ir.source={validateName:er,validateCode:rr,scopeValues:jt._values}),this.opts.unevaluated){const{props:ar,items:dr}=tr;ir.evaluated={props:ar instanceof codegen_1$q.Name?void 0:ar,items:dr instanceof codegen_1$q.Name?void 0:dr,dynamicProps:ar instanceof codegen_1$q.Name,dynamicItems:dr instanceof codegen_1$q.Name},ir.source&&(ir.source.evaluated=(0,codegen_1$q.stringify)(ir.evaluated))}return xt.validate=ir,xt}catch(rr){throw delete xt.validate,delete xt.validateName,zt&&this.logger.error("Error compiling schema, function code:",zt),rr}finally{this._compilations.delete(xt)}}compile.compileSchema=compileSchema;function resolveRef(xt,e,At){var kt;At=(0,resolve_1.resolveUrl)(this.opts.uriResolver,e,At);const Bt=xt.refs[At];if(Bt)return Bt;let Nt=resolve$4.call(this,xt,At);if(Nt===void 0){const jt=(kt=xt.localRefs)===null||kt===void 0?void 0:kt[At],{schemaId:Lt}=this.opts;jt&&(Nt=new SchemaEnv({schema:jt,schemaId:Lt,root:xt,baseId:e}))}if(Nt!==void 0)return xt.refs[At]=inlineOrCompile.call(this,Nt)}compile.resolveRef=resolveRef;function inlineOrCompile(xt){return(0,resolve_1.inlineRef)(xt.schema,this.opts.inlineRefs)?xt.schema:xt.validate?xt:compileSchema.call(this,xt)}function getCompilingSchema(xt){for(const e of this._compilations)if(sameSchemaEnv(e,xt))return e}compile.getCompilingSchema=getCompilingSchema;function sameSchemaEnv(xt,e){return xt.schema===e.schema&&xt.root===e.root&&xt.baseId===e.baseId}function resolve$4(xt,e){let At;for(;typeof(At=this.refs[e])=="string";)e=At;return At||this.schemas[e]||resolveSchema.call(this,xt,e)}function resolveSchema(xt,e){const At=this.opts.uriResolver.parse(e),kt=(0,resolve_1._getFullPath)(this.opts.uriResolver,At);let Bt=(0,resolve_1.getFullPath)(this.opts.uriResolver,xt.baseId,void 0);if(Object.keys(xt.schema).length>0&&kt===Bt)return getJsonPointer.call(this,At,xt);const Nt=(0,resolve_1.normalizeId)(kt),jt=this.refs[Nt]||this.schemas[Nt];if(typeof jt=="string"){const Lt=resolveSchema.call(this,xt,jt);return typeof(Lt==null?void 0:Lt.schema)!="object"?void 0:getJsonPointer.call(this,At,Lt)}if(typeof(jt==null?void 0:jt.schema)=="object"){if(jt.validate||compileSchema.call(this,jt),Nt===(0,resolve_1.normalizeId)(e)){const{schema:Lt}=jt,{schemaId:er}=this.opts,tr=Lt[er];return tr&&(Bt=(0,resolve_1.resolveUrl)(this.opts.uriResolver,Bt,tr)),new SchemaEnv({schema:Lt,schemaId:er,root:xt,baseId:Bt})}return getJsonPointer.call(this,At,jt)}}compile.resolveSchema=resolveSchema;const PREVENT_SCOPE_CHANGE=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function getJsonPointer(xt,{baseId:e,schema:At,root:kt}){var Bt;if(((Bt=xt.fragment)===null||Bt===void 0?void 0:Bt[0])!=="/")return;for(const Lt of xt.fragment.slice(1).split("/")){if(typeof At=="boolean")return;const er=At[(0,util_1$o.unescapeFragment)(Lt)];if(er===void 0)return;At=er;const tr=typeof At=="object"&&At[this.opts.schemaId];!PREVENT_SCOPE_CHANGE.has(Lt)&&tr&&(e=(0,resolve_1.resolveUrl)(this.opts.uriResolver,e,tr))}let Nt;if(typeof At!="boolean"&&At.$ref&&!(0,util_1$o.schemaHasRulesButRef)(At,this.RULES)){const Lt=(0,resolve_1.resolveUrl)(this.opts.uriResolver,e,At.$ref);Nt=resolveSchema.call(this,kt,Lt)}const{schemaId:jt}=this.opts;if(Nt=Nt||new SchemaEnv({schema:At,schemaId:jt,root:kt,baseId:e}),Nt.schema!==Nt.root.schema)return Nt}const $id$8="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description="Meta-schema for $data reference (JSON AnySchema extension proposal)",type$8="object",required$1=["$data"],properties$9={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties$1=!1,require$$9={$id:$id$8,description,type:type$8,required:required$1,properties:properties$9,additionalProperties:additionalProperties$1};var uri$1={},uri_all={exports:{}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */(function(xt,e){(function(At,kt){kt(e)})(commonjsGlobal,function(At){function kt(){for(var an=arguments.length,on=Array(an),fn=0;fn<an;fn++)on[fn]=arguments[fn];if(on.length>1){on[0]=on[0].slice(0,-1);for(var pn=on.length-1,gn=1;gn<pn;++gn)on[gn]=on[gn].slice(1,-1);return on[pn]=on[pn].slice(1),on.join("")}else return on[0]}function Bt(an){return"(?:"+an+")"}function Nt(an){return an===void 0?"undefined":an===null?"null":Object.prototype.toString.call(an).split(" ").pop().split("]").shift().toLowerCase()}function jt(an){return an.toUpperCase()}function Lt(an){return an!=null?an instanceof Array?an:typeof an.length!="number"||an.split||an.setInterval||an.call?[an]:Array.prototype.slice.call(an):[]}function er(an,on){var fn=an;if(on)for(var pn in on)fn[pn]=on[pn];return fn}function tr(an){var on="[A-Za-z]",fn="[0-9]",pn=kt(fn,"[A-Fa-f]"),gn=Bt(Bt("%[EFef]"+pn+"%"+pn+pn+"%"+pn+pn)+"|"+Bt("%[89A-Fa-f]"+pn+"%"+pn+pn)+"|"+Bt("%"+pn+pn)),An="[\\:\\/\\?\\#\\[\\]\\@]",Tn="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",Bn=kt(An,Tn),Un=an?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",Ln=an?"[\\uE000-\\uF8FF]":"[]",Kn=kt(on,fn,"[\\-\\.\\_\\~]",Un);Bt(on+kt(on,fn,"[\\+\\-\\.]")+"*"),Bt(Bt(gn+"|"+kt(Kn,Tn,"[\\:]"))+"*");var Vn=Bt(Bt("25[0-5]")+"|"+Bt("2[0-4]"+fn)+"|"+Bt("1"+fn+fn)+"|"+Bt("0?[1-9]"+fn)+"|0?0?"+fn),oo=Bt(Vn+"\\."+Vn+"\\."+Vn+"\\."+Vn),Fn=Bt(pn+"{1,4}"),to=Bt(Bt(Fn+"\\:"+Fn)+"|"+oo),so=Bt(Bt(Fn+"\\:")+"{6}"+to),ro=Bt("\\:\\:"+Bt(Fn+"\\:")+"{5}"+to),bo=Bt(Bt(Fn)+"?\\:\\:"+Bt(Fn+"\\:")+"{4}"+to),po=Bt(Bt(Bt(Fn+"\\:")+"{0,1}"+Fn)+"?\\:\\:"+Bt(Fn+"\\:")+"{3}"+to),yo=Bt(Bt(Bt(Fn+"\\:")+"{0,2}"+Fn)+"?\\:\\:"+Bt(Fn+"\\:")+"{2}"+to),Io=Bt(Bt(Bt(Fn+"\\:")+"{0,3}"+Fn)+"?\\:\\:"+Fn+"\\:"+to),So=Bt(Bt(Bt(Fn+"\\:")+"{0,4}"+Fn)+"?\\:\\:"+to),uo=Bt(Bt(Bt(Fn+"\\:")+"{0,5}"+Fn)+"?\\:\\:"+Fn),mo=Bt(Bt(Bt(Fn+"\\:")+"{0,6}"+Fn)+"?\\:\\:"),To=Bt([so,ro,bo,po,yo,Io,So,uo,mo].join("|")),vo=Bt(Bt(Kn+"|"+gn)+"+");Bt("[vV]"+pn+"+\\."+kt(Kn,Tn,"[\\:]")+"+"),Bt(Bt(gn+"|"+kt(Kn,Tn))+"*");var Ro=Bt(gn+"|"+kt(Kn,Tn,"[\\:\\@]"));return Bt(Bt(gn+"|"+kt(Kn,Tn,"[\\@]"))+"+"),Bt(Bt(Ro+"|"+kt("[\\/\\?]",Ln))+"*"),{NOT_SCHEME:new RegExp(kt("[^]",on,fn,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(kt("[^\\%\\:]",Kn,Tn),"g"),NOT_HOST:new RegExp(kt("[^\\%\\[\\]\\:]",Kn,Tn),"g"),NOT_PATH:new RegExp(kt("[^\\%\\/\\:\\@]",Kn,Tn),"g"),NOT_PATH_NOSCHEME:new RegExp(kt("[^\\%\\/\\@]",Kn,Tn),"g"),NOT_QUERY:new RegExp(kt("[^\\%]",Kn,Tn,"[\\:\\@\\/\\?]",Ln),"g"),NOT_FRAGMENT:new RegExp(kt("[^\\%]",Kn,Tn,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(kt("[^]",Kn,Tn),"g"),UNRESERVED:new RegExp(Kn,"g"),OTHER_CHARS:new RegExp(kt("[^\\%]",Kn,Bn),"g"),PCT_ENCODED:new RegExp(gn,"g"),IPV4ADDRESS:new RegExp("^("+oo+")$"),IPV6ADDRESS:new RegExp("^\\[?("+To+")"+Bt(Bt("\\%25|\\%(?!"+pn+"{2})")+"("+vo+")")+"?\\]?$")}}var zt=tr(!1),rr=tr(!0),nr=function(){function an(on,fn){var pn=[],gn=!0,An=!1,Tn=void 0;try{for(var Bn=on[Symbol.iterator](),Un;!(gn=(Un=Bn.next()).done)&&(pn.push(Un.value),!(fn&&pn.length===fn));gn=!0);}catch(Ln){An=!0,Tn=Ln}finally{try{!gn&&Bn.return&&Bn.return()}finally{if(An)throw Tn}}return pn}return function(on,fn){if(Array.isArray(on))return on;if(Symbol.iterator in Object(on))return an(on,fn);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ir=function(an){if(Array.isArray(an)){for(var on=0,fn=Array(an.length);on<an.length;on++)fn[on]=an[on];return fn}else return Array.from(an)},ar=2147483647,dr=36,ur=1,fr=26,pr=38,lr=700,yr=72,br=128,Ar="-",Pr=/^xn--/,kr=/[^\0-\x7E]/,Ur=/[\x2E\u3002\uFF0E\uFF61]/g,Hr={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Lr=dr-ur,Sr=Math.floor,_r=String.fromCharCode;function gr(an){throw new RangeError(Hr[an])}function wr(an,on){for(var fn=[],pn=an.length;pn--;)fn[pn]=on(an[pn]);return fn}function Dr(an,on){var fn=an.split("@"),pn="";fn.length>1&&(pn=fn[0]+"@",an=fn[1]),an=an.replace(Ur,".");var gn=an.split("."),An=wr(gn,on).join(".");return pn+An}function xr(an){for(var on=[],fn=0,pn=an.length;fn<pn;){var gn=an.charCodeAt(fn++);if(gn>=55296&&gn<=56319&&fn<pn){var An=an.charCodeAt(fn++);(An&64512)==56320?on.push(((gn&1023)<<10)+(An&1023)+65536):(on.push(gn),fn--)}else on.push(gn)}return on}var Ir=function(on){return String.fromCodePoint.apply(String,ir(on))},$r=function(on){return on-48<10?on-22:on-65<26?on-65:on-97<26?on-97:dr},vr=function(on,fn){return on+22+75*(on<26)-((fn!=0)<<5)},Er=function(on,fn,pn){var gn=0;for(on=pn?Sr(on/lr):on>>1,on+=Sr(on/fn);on>Lr*fr>>1;gn+=dr)on=Sr(on/Lr);return Sr(gn+(Lr+1)*on/(on+pr))},Tr=function(on){var fn=[],pn=on.length,gn=0,An=br,Tn=yr,Bn=on.lastIndexOf(Ar);Bn<0&&(Bn=0);for(var Un=0;Un<Bn;++Un)on.charCodeAt(Un)>=128&&gr("not-basic"),fn.push(on.charCodeAt(Un));for(var Ln=Bn>0?Bn+1:0;Ln<pn;){for(var Kn=gn,Vn=1,oo=dr;;oo+=dr){Ln>=pn&&gr("invalid-input");var Fn=$r(on.charCodeAt(Ln++));(Fn>=dr||Fn>Sr((ar-gn)/Vn))&&gr("overflow"),gn+=Fn*Vn;var to=oo<=Tn?ur:oo>=Tn+fr?fr:oo-Tn;if(Fn<to)break;var so=dr-to;Vn>Sr(ar/so)&&gr("overflow"),Vn*=so}var ro=fn.length+1;Tn=Er(gn-Kn,ro,Kn==0),Sr(gn/ro)>ar-An&&gr("overflow"),An+=Sr(gn/ro),gn%=ro,fn.splice(gn++,0,An)}return String.fromCodePoint.apply(String,fn)},Rr=function(on){var fn=[];on=xr(on);var pn=on.length,gn=br,An=0,Tn=yr,Bn=!0,Un=!1,Ln=void 0;try{for(var Kn=on[Symbol.iterator](),Vn;!(Bn=(Vn=Kn.next()).done);Bn=!0){var oo=Vn.value;oo<128&&fn.push(_r(oo))}}catch(As){Un=!0,Ln=As}finally{try{!Bn&&Kn.return&&Kn.return()}finally{if(Un)throw Ln}}var Fn=fn.length,to=Fn;for(Fn&&fn.push(Ar);to<pn;){var so=ar,ro=!0,bo=!1,po=void 0;try{for(var yo=on[Symbol.iterator](),Io;!(ro=(Io=yo.next()).done);ro=!0){var So=Io.value;So>=gn&&So<so&&(so=So)}}catch(As){bo=!0,po=As}finally{try{!ro&&yo.return&&yo.return()}finally{if(bo)throw po}}var uo=to+1;so-gn>Sr((ar-An)/uo)&&gr("overflow"),An+=(so-gn)*uo,gn=so;var mo=!0,To=!1,vo=void 0;try{for(var Ro=on[Symbol.iterator](),ys;!(mo=(ys=Ro.next()).done);mo=!0){var gs=ys.value;if(gs<gn&&++An>ar&&gr("overflow"),gs==gn){for(var Us=An,Ls=dr;;Ls+=dr){var Ks=Ls<=Tn?ur:Ls>=Tn+fr?fr:Ls-Tn;if(Us<Ks)break;var ba=Us-Ks,$a=dr-Ks;fn.push(_r(vr(Ks+ba%$a,0))),Us=Sr(ba/$a)}fn.push(_r(vr(Us,0))),Tn=Er(An,uo,to==Fn),An=0,++to}}}catch(As){To=!0,vo=As}finally{try{!mo&&Ro.return&&Ro.return()}finally{if(To)throw vo}}++An,++gn}return fn.join("")},Mr=function(on){return Dr(on,function(fn){return Pr.test(fn)?Tr(fn.slice(4).toLowerCase()):fn})},Gr=function(on){return Dr(on,function(fn){return kr.test(fn)?"xn--"+Rr(fn):fn})},Br={version:"2.1.0",ucs2:{decode:xr,encode:Ir},decode:Tr,encode:Rr,toASCII:Gr,toUnicode:Mr},Cr={};function jr(an){var on=an.charCodeAt(0),fn=void 0;return on<16?fn="%0"+on.toString(16).toUpperCase():on<128?fn="%"+on.toString(16).toUpperCase():on<2048?fn="%"+(on>>6|192).toString(16).toUpperCase()+"%"+(on&63|128).toString(16).toUpperCase():fn="%"+(on>>12|224).toString(16).toUpperCase()+"%"+(on>>6&63|128).toString(16).toUpperCase()+"%"+(on&63|128).toString(16).toUpperCase(),fn}function Yr(an){for(var on="",fn=0,pn=an.length;fn<pn;){var gn=parseInt(an.substr(fn+1,2),16);if(gn<128)on+=String.fromCharCode(gn),fn+=3;else if(gn>=194&&gn<224){if(pn-fn>=6){var An=parseInt(an.substr(fn+4,2),16);on+=String.fromCharCode((gn&31)<<6|An&63)}else on+=an.substr(fn,6);fn+=6}else if(gn>=224){if(pn-fn>=9){var Tn=parseInt(an.substr(fn+4,2),16),Bn=parseInt(an.substr(fn+7,2),16);on+=String.fromCharCode((gn&15)<<12|(Tn&63)<<6|Bn&63)}else on+=an.substr(fn,9);fn+=9}else on+=an.substr(fn,3),fn+=3}return on}function Qr(an,on){function fn(pn){var gn=Yr(pn);return gn.match(on.UNRESERVED)?gn:pn}return an.scheme&&(an.scheme=String(an.scheme).replace(on.PCT_ENCODED,fn).toLowerCase().replace(on.NOT_SCHEME,"")),an.userinfo!==void 0&&(an.userinfo=String(an.userinfo).replace(on.PCT_ENCODED,fn).replace(on.NOT_USERINFO,jr).replace(on.PCT_ENCODED,jt)),an.host!==void 0&&(an.host=String(an.host).replace(on.PCT_ENCODED,fn).toLowerCase().replace(on.NOT_HOST,jr).replace(on.PCT_ENCODED,jt)),an.path!==void 0&&(an.path=String(an.path).replace(on.PCT_ENCODED,fn).replace(an.scheme?on.NOT_PATH:on.NOT_PATH_NOSCHEME,jr).replace(on.PCT_ENCODED,jt)),an.query!==void 0&&(an.query=String(an.query).replace(on.PCT_ENCODED,fn).replace(on.NOT_QUERY,jr).replace(on.PCT_ENCODED,jt)),an.fragment!==void 0&&(an.fragment=String(an.fragment).replace(on.PCT_ENCODED,fn).replace(on.NOT_FRAGMENT,jr).replace(on.PCT_ENCODED,jt)),an}function Jr(an){return an.replace(/^0*(.*)/,"$1")||"0"}function Wr(an,on){var fn=an.match(on.IPV4ADDRESS)||[],pn=nr(fn,2),gn=pn[1];return gn?gn.split(".").map(Jr).join("."):an}function Nr(an,on){var fn=an.match(on.IPV6ADDRESS)||[],pn=nr(fn,3),gn=pn[1],An=pn[2];if(gn){for(var Tn=gn.toLowerCase().split("::").reverse(),Bn=nr(Tn,2),Un=Bn[0],Ln=Bn[1],Kn=Ln?Ln.split(":").map(Jr):[],Vn=Un.split(":").map(Jr),oo=on.IPV4ADDRESS.test(Vn[Vn.length-1]),Fn=oo?7:8,to=Vn.length-Fn,so=Array(Fn),ro=0;ro<Fn;++ro)so[ro]=Kn[ro]||Vn[to+ro]||"";oo&&(so[Fn-1]=Wr(so[Fn-1],on));var bo=so.reduce(function(uo,mo,To){if(!mo||mo==="0"){var vo=uo[uo.length-1];vo&&vo.index+vo.length===To?vo.length++:uo.push({index:To,length:1})}return uo},[]),po=bo.sort(function(uo,mo){return mo.length-uo.length})[0],yo=void 0;if(po&&po.length>1){var Io=so.slice(0,po.index),So=so.slice(po.index+po.length);yo=Io.join(":")+"::"+So.join(":")}else yo=so.join(":");return An&&(yo+="%"+An),yo}else return an}var Vr=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,Xr="".match(/(){0}/)[1]===void 0;function qr(an){var on=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},fn={},pn=on.iri!==!1?rr:zt;on.reference==="suffix"&&(an=(on.scheme?on.scheme+":":"")+"//"+an);var gn=an.match(Vr);if(gn){Xr?(fn.scheme=gn[1],fn.userinfo=gn[3],fn.host=gn[4],fn.port=parseInt(gn[5],10),fn.path=gn[6]||"",fn.query=gn[7],fn.fragment=gn[8],isNaN(fn.port)&&(fn.port=gn[5])):(fn.scheme=gn[1]||void 0,fn.userinfo=an.indexOf("@")!==-1?gn[3]:void 0,fn.host=an.indexOf("//")!==-1?gn[4]:void 0,fn.port=parseInt(gn[5],10),fn.path=gn[6]||"",fn.query=an.indexOf("?")!==-1?gn[7]:void 0,fn.fragment=an.indexOf("#")!==-1?gn[8]:void 0,isNaN(fn.port)&&(fn.port=an.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?gn[4]:void 0)),fn.host&&(fn.host=Nr(Wr(fn.host,pn),pn)),fn.scheme===void 0&&fn.userinfo===void 0&&fn.host===void 0&&fn.port===void 0&&!fn.path&&fn.query===void 0?fn.reference="same-document":fn.scheme===void 0?fn.reference="relative":fn.fragment===void 0?fn.reference="absolute":fn.reference="uri",on.reference&&on.reference!=="suffix"&&on.reference!==fn.reference&&(fn.error=fn.error||"URI is not a "+on.reference+" reference.");var An=Cr[(on.scheme||fn.scheme||"").toLowerCase()];if(!on.unicodeSupport&&(!An||!An.unicodeSupport)){if(fn.host&&(on.domainHost||An&&An.domainHost))try{fn.host=Br.toASCII(fn.host.replace(pn.PCT_ENCODED,Yr).toLowerCase())}catch(Tn){fn.error=fn.error||"Host's domain name can not be converted to ASCII via punycode: "+Tn}Qr(fn,zt)}else Qr(fn,pn);An&&An.parse&&An.parse(fn,on)}else fn.error=fn.error||"URI can not be parsed.";return fn}function Or(an,on){var fn=on.iri!==!1?rr:zt,pn=[];return an.userinfo!==void 0&&(pn.push(an.userinfo),pn.push("@")),an.host!==void 0&&pn.push(Nr(Wr(String(an.host),fn),fn).replace(fn.IPV6ADDRESS,function(gn,An,Tn){return"["+An+(Tn?"%25"+Tn:"")+"]"})),(typeof an.port=="number"||typeof an.port=="string")&&(pn.push(":"),pn.push(String(an.port))),pn.length?pn.join(""):void 0}var Fr=/^\.\.?\//,Zr=/^\/\.(\/|$)/,rn=/^\/\.\.(\/|$)/,un=/^\/?(?:.|\n)*?(?=\/|$)/;function dn(an){for(var on=[];an.length;)if(an.match(Fr))an=an.replace(Fr,"");else if(an.match(Zr))an=an.replace(Zr,"/");else if(an.match(rn))an=an.replace(rn,"/"),on.pop();else if(an==="."||an==="..")an="";else{var fn=an.match(un);if(fn){var pn=fn[0];an=an.slice(pn.length),on.push(pn)}else throw new Error("Unexpected dot segment condition")}return on.join("")}function vn(an){var on=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},fn=on.iri?rr:zt,pn=[],gn=Cr[(on.scheme||an.scheme||"").toLowerCase()];if(gn&&gn.serialize&&gn.serialize(an,on),an.host&&!fn.IPV6ADDRESS.test(an.host)){if(on.domainHost||gn&&gn.domainHost)try{an.host=on.iri?Br.toUnicode(an.host):Br.toASCII(an.host.replace(fn.PCT_ENCODED,Yr).toLowerCase())}catch(Bn){an.error=an.error||"Host's domain name can not be converted to "+(on.iri?"Unicode":"ASCII")+" via punycode: "+Bn}}Qr(an,fn),on.reference!=="suffix"&&an.scheme&&(pn.push(an.scheme),pn.push(":"));var An=Or(an,on);if(An!==void 0&&(on.reference!=="suffix"&&pn.push("//"),pn.push(An),an.path&&an.path.charAt(0)!=="/"&&pn.push("/")),an.path!==void 0){var Tn=an.path;!on.absolutePath&&(!gn||!gn.absolutePath)&&(Tn=dn(Tn)),An===void 0&&(Tn=Tn.replace(/^\/\//,"/%2F")),pn.push(Tn)}return an.query!==void 0&&(pn.push("?"),pn.push(an.query)),an.fragment!==void 0&&(pn.push("#"),pn.push(an.fragment)),pn.join("")}function $n(an,on){var fn=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},pn=arguments[3],gn={};return pn||(an=qr(vn(an,fn),fn),on=qr(vn(on,fn),fn)),fn=fn||{},!fn.tolerant&&on.scheme?(gn.scheme=on.scheme,gn.userinfo=on.userinfo,gn.host=on.host,gn.port=on.port,gn.path=dn(on.path||""),gn.query=on.query):(on.userinfo!==void 0||on.host!==void 0||on.port!==void 0?(gn.userinfo=on.userinfo,gn.host=on.host,gn.port=on.port,gn.path=dn(on.path||""),gn.query=on.query):(on.path?(on.path.charAt(0)==="/"?gn.path=dn(on.path):((an.userinfo!==void 0||an.host!==void 0||an.port!==void 0)&&!an.path?gn.path="/"+on.path:an.path?gn.path=an.path.slice(0,an.path.lastIndexOf("/")+1)+on.path:gn.path=on.path,gn.path=dn(gn.path)),gn.query=on.query):(gn.path=an.path,on.query!==void 0?gn.query=on.query:gn.query=an.query),gn.userinfo=an.userinfo,gn.host=an.host,gn.port=an.port),gn.scheme=an.scheme),gn.fragment=on.fragment,gn}function en(an,on,fn){var pn=er({scheme:"null"},fn);return vn($n(qr(an,pn),qr(on,pn),pn,!0),pn)}function tn(an,on){return typeof an=="string"?an=vn(qr(an,on),on):Nt(an)==="object"&&(an=qr(vn(an,on),on)),an}function hn(an,on,fn){return typeof an=="string"?an=vn(qr(an,fn),fn):Nt(an)==="object"&&(an=vn(an,fn)),typeof on=="string"?on=vn(qr(on,fn),fn):Nt(on)==="object"&&(on=vn(on,fn)),an===on}function mn(an,on){return an&&an.toString().replace(!on||!on.iri?zt.ESCAPE:rr.ESCAPE,jr)}function yn(an,on){return an&&an.toString().replace(!on||!on.iri?zt.PCT_ENCODED:rr.PCT_ENCODED,Yr)}var xn={scheme:"http",domainHost:!0,parse:function(on,fn){return on.host||(on.error=on.error||"HTTP URIs must have a host."),on},serialize:function(on,fn){var pn=String(on.scheme).toLowerCase()==="https";return(on.port===(pn?443:80)||on.port==="")&&(on.port=void 0),on.path||(on.path="/"),on}},In={scheme:"https",domainHost:xn.domainHost,parse:xn.parse,serialize:xn.serialize};function On(an){return typeof an.secure=="boolean"?an.secure:String(an.scheme).toLowerCase()==="wss"}var Dn={scheme:"ws",domainHost:!0,parse:function(on,fn){var pn=on;return pn.secure=On(pn),pn.resourceName=(pn.path||"/")+(pn.query?"?"+pn.query:""),pn.path=void 0,pn.query=void 0,pn},serialize:function(on,fn){if((on.port===(On(on)?443:80)||on.port==="")&&(on.port=void 0),typeof on.secure=="boolean"&&(on.scheme=on.secure?"wss":"ws",on.secure=void 0),on.resourceName){var pn=on.resourceName.split("?"),gn=nr(pn,2),An=gn[0],Tn=gn[1];on.path=An&&An!=="/"?An:void 0,on.query=Tn,on.resourceName=void 0}return on.fragment=void 0,on}},Yn={scheme:"wss",domainHost:Dn.domainHost,parse:Dn.parse,serialize:Dn.serialize},Hn={},Mn="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",zn="[0-9A-Fa-f]",Pn=Bt(Bt("%[EFef]"+zn+"%"+zn+zn+"%"+zn+zn)+"|"+Bt("%[89A-Fa-f]"+zn+"%"+zn+zn)+"|"+Bt("%"+zn+zn)),Rn="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",Nn="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",Wn=kt(Nn,'[\\"\\\\]'),kn="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Zn=new RegExp(Mn,"g"),eo=new RegExp(Pn,"g"),qn=new RegExp(kt("[^]",Rn,"[\\.]",'[\\"]',Wn),"g"),io=new RegExp(kt("[^]",Mn,kn),"g"),nn=io;function sn(an){var on=Yr(an);return on.match(Zn)?on:an}var _n={scheme:"mailto",parse:function(on,fn){var pn=on,gn=pn.to=pn.path?pn.path.split(","):[];if(pn.path=void 0,pn.query){for(var An=!1,Tn={},Bn=pn.query.split("&"),Un=0,Ln=Bn.length;Un<Ln;++Un){var Kn=Bn[Un].split("=");switch(Kn[0]){case"to":for(var Vn=Kn[1].split(","),oo=0,Fn=Vn.length;oo<Fn;++oo)gn.push(Vn[oo]);break;case"subject":pn.subject=yn(Kn[1],fn);break;case"body":pn.body=yn(Kn[1],fn);break;default:An=!0,Tn[yn(Kn[0],fn)]=yn(Kn[1],fn);break}}An&&(pn.headers=Tn)}pn.query=void 0;for(var to=0,so=gn.length;to<so;++to){var ro=gn[to].split("@");if(ro[0]=yn(ro[0]),fn.unicodeSupport)ro[1]=yn(ro[1],fn).toLowerCase();else try{ro[1]=Br.toASCII(yn(ro[1],fn).toLowerCase())}catch(bo){pn.error=pn.error||"Email address's domain name can not be converted to ASCII via punycode: "+bo}gn[to]=ro.join("@")}return pn},serialize:function(on,fn){var pn=on,gn=Lt(on.to);if(gn){for(var An=0,Tn=gn.length;An<Tn;++An){var Bn=String(gn[An]),Un=Bn.lastIndexOf("@"),Ln=Bn.slice(0,Un).replace(eo,sn).replace(eo,jt).replace(qn,jr),Kn=Bn.slice(Un+1);try{Kn=fn.iri?Br.toUnicode(Kn):Br.toASCII(yn(Kn,fn).toLowerCase())}catch(to){pn.error=pn.error||"Email address's domain name can not be converted to "+(fn.iri?"Unicode":"ASCII")+" via punycode: "+to}gn[An]=Ln+"@"+Kn}pn.path=gn.join(",")}var Vn=on.headers=on.headers||{};on.subject&&(Vn.subject=on.subject),on.body&&(Vn.body=on.body);var oo=[];for(var Fn in Vn)Vn[Fn]!==Hn[Fn]&&oo.push(Fn.replace(eo,sn).replace(eo,jt).replace(io,jr)+"="+Vn[Fn].replace(eo,sn).replace(eo,jt).replace(nn,jr));return oo.length&&(pn.query=oo.join("&")),pn}},En=/^([^\:]+)\:(.*)/,Sn={scheme:"urn",parse:function(on,fn){var pn=on.path&&on.path.match(En),gn=on;if(pn){var An=fn.scheme||gn.scheme||"urn",Tn=pn[1].toLowerCase(),Bn=pn[2],Un=An+":"+(fn.nid||Tn),Ln=Cr[Un];gn.nid=Tn,gn.nss=Bn,gn.path=void 0,Ln&&(gn=Ln.parse(gn,fn))}else gn.error=gn.error||"URN can not be parsed.";return gn},serialize:function(on,fn){var pn=fn.scheme||on.scheme||"urn",gn=on.nid,An=pn+":"+(fn.nid||gn),Tn=Cr[An];Tn&&(on=Tn.serialize(on,fn));var Bn=on,Un=on.nss;return Bn.path=(gn||fn.nid)+":"+Un,Bn}},Qn=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Xn={scheme:"urn:uuid",parse:function(on,fn){var pn=on;return pn.uuid=pn.nss,pn.nss=void 0,!fn.tolerant&&(!pn.uuid||!pn.uuid.match(Qn))&&(pn.error=pn.error||"UUID is not valid."),pn},serialize:function(on,fn){var pn=on;return pn.nss=(on.uuid||"").toLowerCase(),pn}};Cr[xn.scheme]=xn,Cr[In.scheme]=In,Cr[Dn.scheme]=Dn,Cr[Yn.scheme]=Yn,Cr[_n.scheme]=_n,Cr[Sn.scheme]=Sn,Cr[Xn.scheme]=Xn,At.SCHEMES=Cr,At.pctEncChar=jr,At.pctDecChars=Yr,At.parse=qr,At.removeDotSegments=dn,At.serialize=vn,At.resolveComponents=$n,At.resolve=en,At.normalize=tn,At.equal=hn,At.escapeComponent=mn,At.unescapeComponent=yn,Object.defineProperty(At,"__esModule",{value:!0})})})(uri_all,uri_all.exports);var uri_allExports=uri_all.exports;Object.defineProperty(uri$1,"__esModule",{value:!0});const uri=uri_allExports;uri.code='require("ajv/dist/runtime/uri").default';uri$1.default=uri;(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.CodeGen=xt.Name=xt.nil=xt.stringify=xt.str=xt._=xt.KeywordCxt=void 0;var e=validate;Object.defineProperty(xt,"KeywordCxt",{enumerable:!0,get:function(){return e.KeywordCxt}});var At=codegen;Object.defineProperty(xt,"_",{enumerable:!0,get:function(){return At._}}),Object.defineProperty(xt,"str",{enumerable:!0,get:function(){return At.str}}),Object.defineProperty(xt,"stringify",{enumerable:!0,get:function(){return At.stringify}}),Object.defineProperty(xt,"nil",{enumerable:!0,get:function(){return At.nil}}),Object.defineProperty(xt,"Name",{enumerable:!0,get:function(){return At.Name}}),Object.defineProperty(xt,"CodeGen",{enumerable:!0,get:function(){return At.CodeGen}});const kt=validation_error,Bt=ref_error,Nt=rules,jt=compile,Lt=codegen,er=resolve$5,tr=dataType,zt=util$1,rr=require$$9,nr=uri$1,ir=(vr,Er)=>new RegExp(vr,Er);ir.code="new RegExp";const ar=["removeAdditional","useDefaults","coerceTypes"],dr=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),ur={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},fr={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'},pr=200;function lr(vr){var Er,Tr,Rr,Mr,Gr,Br,Cr,jr,Yr,Qr,Jr,Wr,Nr,Vr,Xr,qr,Or,Fr,Zr,rn,un,dn,vn,$n,en;const tn=vr.strict,hn=(Er=vr.code)===null||Er===void 0?void 0:Er.optimize,mn=hn===!0||hn===void 0?1:hn||0,yn=(Rr=(Tr=vr.code)===null||Tr===void 0?void 0:Tr.regExp)!==null&&Rr!==void 0?Rr:ir,xn=(Mr=vr.uriResolver)!==null&&Mr!==void 0?Mr:nr.default;return{strictSchema:(Br=(Gr=vr.strictSchema)!==null&&Gr!==void 0?Gr:tn)!==null&&Br!==void 0?Br:!0,strictNumbers:(jr=(Cr=vr.strictNumbers)!==null&&Cr!==void 0?Cr:tn)!==null&&jr!==void 0?jr:!0,strictTypes:(Qr=(Yr=vr.strictTypes)!==null&&Yr!==void 0?Yr:tn)!==null&&Qr!==void 0?Qr:"log",strictTuples:(Wr=(Jr=vr.strictTuples)!==null&&Jr!==void 0?Jr:tn)!==null&&Wr!==void 0?Wr:"log",strictRequired:(Vr=(Nr=vr.strictRequired)!==null&&Nr!==void 0?Nr:tn)!==null&&Vr!==void 0?Vr:!1,code:vr.code?{...vr.code,optimize:mn,regExp:yn}:{optimize:mn,regExp:yn},loopRequired:(Xr=vr.loopRequired)!==null&&Xr!==void 0?Xr:pr,loopEnum:(qr=vr.loopEnum)!==null&&qr!==void 0?qr:pr,meta:(Or=vr.meta)!==null&&Or!==void 0?Or:!0,messages:(Fr=vr.messages)!==null&&Fr!==void 0?Fr:!0,inlineRefs:(Zr=vr.inlineRefs)!==null&&Zr!==void 0?Zr:!0,schemaId:(rn=vr.schemaId)!==null&&rn!==void 0?rn:"$id",addUsedSchema:(un=vr.addUsedSchema)!==null&&un!==void 0?un:!0,validateSchema:(dn=vr.validateSchema)!==null&&dn!==void 0?dn:!0,validateFormats:(vn=vr.validateFormats)!==null&&vn!==void 0?vn:!0,unicodeRegExp:($n=vr.unicodeRegExp)!==null&&$n!==void 0?$n:!0,int32range:(en=vr.int32range)!==null&&en!==void 0?en:!0,uriResolver:xn}}class yr{constructor(Er={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,Er=this.opts={...Er,...lr(Er)};const{es5:Tr,lines:Rr}=this.opts.code;this.scope=new Lt.ValueScope({scope:{},prefixes:dr,es5:Tr,lines:Rr}),this.logger=Sr(Er.logger);const Mr=Er.validateFormats;Er.validateFormats=!1,this.RULES=(0,Nt.getRules)(),br.call(this,ur,Er,"NOT SUPPORTED"),br.call(this,fr,Er,"DEPRECATED","warn"),this._metaOpts=Hr.call(this),Er.formats&&kr.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),Er.keywords&&Ur.call(this,Er.keywords),typeof Er.meta=="object"&&this.addMetaSchema(Er.meta),Pr.call(this),Er.validateFormats=Mr}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:Er,meta:Tr,schemaId:Rr}=this.opts;let Mr=rr;Rr==="id"&&(Mr={...rr},Mr.id=Mr.$id,delete Mr.$id),Tr&&Er&&this.addMetaSchema(Mr,Mr[Rr],!1)}defaultMeta(){const{meta:Er,schemaId:Tr}=this.opts;return this.opts.defaultMeta=typeof Er=="object"?Er[Tr]||Er:void 0}validate(Er,Tr){let Rr;if(typeof Er=="string"){if(Rr=this.getSchema(Er),!Rr)throw new Error(`no schema with key or ref "${Er}"`)}else Rr=this.compile(Er);const Mr=Rr(Tr);return"$async"in Rr||(this.errors=Rr.errors),Mr}compile(Er,Tr){const Rr=this._addSchema(Er,Tr);return Rr.validate||this._compileSchemaEnv(Rr)}compileAsync(Er,Tr){if(typeof this.opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");const{loadSchema:Rr}=this.opts;return Mr.call(this,Er,Tr);async function Mr(Qr,Jr){await Gr.call(this,Qr.$schema);const Wr=this._addSchema(Qr,Jr);return Wr.validate||Br.call(this,Wr)}async function Gr(Qr){Qr&&!this.getSchema(Qr)&&await Mr.call(this,{$ref:Qr},!0)}async function Br(Qr){try{return this._compileSchemaEnv(Qr)}catch(Jr){if(!(Jr instanceof Bt.default))throw Jr;return Cr.call(this,Jr),await jr.call(this,Jr.missingSchema),Br.call(this,Qr)}}function Cr({missingSchema:Qr,missingRef:Jr}){if(this.refs[Qr])throw new Error(`AnySchema ${Qr} is loaded but ${Jr} cannot be resolved`)}async function jr(Qr){const Jr=await Yr.call(this,Qr);this.refs[Qr]||await Gr.call(this,Jr.$schema),this.refs[Qr]||this.addSchema(Jr,Qr,Tr)}async function Yr(Qr){const Jr=this._loading[Qr];if(Jr)return Jr;try{return await(this._loading[Qr]=Rr(Qr))}finally{delete this._loading[Qr]}}}addSchema(Er,Tr,Rr,Mr=this.opts.validateSchema){if(Array.isArray(Er)){for(const Br of Er)this.addSchema(Br,void 0,Rr,Mr);return this}let Gr;if(typeof Er=="object"){const{schemaId:Br}=this.opts;if(Gr=Er[Br],Gr!==void 0&&typeof Gr!="string")throw new Error(`schema ${Br} must be string`)}return Tr=(0,er.normalizeId)(Tr||Gr),this._checkUnique(Tr),this.schemas[Tr]=this._addSchema(Er,Rr,Tr,Mr,!0),this}addMetaSchema(Er,Tr,Rr=this.opts.validateSchema){return this.addSchema(Er,Tr,!0,Rr),this}validateSchema(Er,Tr){if(typeof Er=="boolean")return!0;let Rr;if(Rr=Er.$schema,Rr!==void 0&&typeof Rr!="string")throw new Error("$schema must be a string");if(Rr=Rr||this.opts.defaultMeta||this.defaultMeta(),!Rr)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const Mr=this.validate(Rr,Er);if(!Mr&&Tr){const Gr="schema is invalid: "+this.errorsText();if(this.opts.validateSchema==="log")this.logger.error(Gr);else throw new Error(Gr)}return Mr}getSchema(Er){let Tr;for(;typeof(Tr=Ar.call(this,Er))=="string";)Er=Tr;if(Tr===void 0){const{schemaId:Rr}=this.opts,Mr=new jt.SchemaEnv({schema:{},schemaId:Rr});if(Tr=jt.resolveSchema.call(this,Mr,Er),!Tr)return;this.refs[Er]=Tr}return Tr.validate||this._compileSchemaEnv(Tr)}removeSchema(Er){if(Er instanceof RegExp)return this._removeAllSchemas(this.schemas,Er),this._removeAllSchemas(this.refs,Er),this;switch(typeof Er){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const Tr=Ar.call(this,Er);return typeof Tr=="object"&&this._cache.delete(Tr.schema),delete this.schemas[Er],delete this.refs[Er],this}case"object":{const Tr=Er;this._cache.delete(Tr);let Rr=Er[this.opts.schemaId];return Rr&&(Rr=(0,er.normalizeId)(Rr),delete this.schemas[Rr],delete this.refs[Rr]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(Er){for(const Tr of Er)this.addKeyword(Tr);return this}addKeyword(Er,Tr){let Rr;if(typeof Er=="string")Rr=Er,typeof Tr=="object"&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),Tr.keyword=Rr);else if(typeof Er=="object"&&Tr===void 0){if(Tr=Er,Rr=Tr.keyword,Array.isArray(Rr)&&!Rr.length)throw new Error("addKeywords: keyword must be string or non-empty array")}else throw new Error("invalid addKeywords parameters");if(gr.call(this,Rr,Tr),!Tr)return(0,zt.eachItem)(Rr,Gr=>wr.call(this,Gr)),this;xr.call(this,Tr);const Mr={...Tr,type:(0,tr.getJSONTypes)(Tr.type),schemaType:(0,tr.getJSONTypes)(Tr.schemaType)};return(0,zt.eachItem)(Rr,Mr.type.length===0?Gr=>wr.call(this,Gr,Mr):Gr=>Mr.type.forEach(Br=>wr.call(this,Gr,Mr,Br))),this}getKeyword(Er){const Tr=this.RULES.all[Er];return typeof Tr=="object"?Tr.definition:!!Tr}removeKeyword(Er){const{RULES:Tr}=this;delete Tr.keywords[Er],delete Tr.all[Er];for(const Rr of Tr.rules){const Mr=Rr.rules.findIndex(Gr=>Gr.keyword===Er);Mr>=0&&Rr.rules.splice(Mr,1)}return this}addFormat(Er,Tr){return typeof Tr=="string"&&(Tr=new RegExp(Tr)),this.formats[Er]=Tr,this}errorsText(Er=this.errors,{separator:Tr=", ",dataVar:Rr="data"}={}){return!Er||Er.length===0?"No errors":Er.map(Mr=>`${Rr}${Mr.instancePath} ${Mr.message}`).reduce((Mr,Gr)=>Mr+Tr+Gr)}$dataMetaSchema(Er,Tr){const Rr=this.RULES.all;Er=JSON.parse(JSON.stringify(Er));for(const Mr of Tr){const Gr=Mr.split("/").slice(1);let Br=Er;for(const Cr of Gr)Br=Br[Cr];for(const Cr in Rr){const jr=Rr[Cr];if(typeof jr!="object")continue;const{$data:Yr}=jr.definition,Qr=Br[Cr];Yr&&Qr&&(Br[Cr]=$r(Qr))}}return Er}_removeAllSchemas(Er,Tr){for(const Rr in Er){const Mr=Er[Rr];(!Tr||Tr.test(Rr))&&(typeof Mr=="string"?delete Er[Rr]:Mr&&!Mr.meta&&(this._cache.delete(Mr.schema),delete Er[Rr]))}}_addSchema(Er,Tr,Rr,Mr=this.opts.validateSchema,Gr=this.opts.addUsedSchema){let Br;const{schemaId:Cr}=this.opts;if(typeof Er=="object")Br=Er[Cr];else{if(this.opts.jtd)throw new Error("schema must be object");if(typeof Er!="boolean")throw new Error("schema must be object or boolean")}let jr=this._cache.get(Er);if(jr!==void 0)return jr;Rr=(0,er.normalizeId)(Br||Rr);const Yr=er.getSchemaRefs.call(this,Er,Rr);return jr=new jt.SchemaEnv({schema:Er,schemaId:Cr,meta:Tr,baseId:Rr,localRefs:Yr}),this._cache.set(jr.schema,jr),Gr&&!Rr.startsWith("#")&&(Rr&&this._checkUnique(Rr),this.refs[Rr]=jr),Mr&&this.validateSchema(Er,!0),jr}_checkUnique(Er){if(this.schemas[Er]||this.refs[Er])throw new Error(`schema with key or id "${Er}" already exists`)}_compileSchemaEnv(Er){if(Er.meta?this._compileMetaSchema(Er):jt.compileSchema.call(this,Er),!Er.validate)throw new Error("ajv implementation error");return Er.validate}_compileMetaSchema(Er){const Tr=this.opts;this.opts=this._metaOpts;try{jt.compileSchema.call(this,Er)}finally{this.opts=Tr}}}xt.default=yr,yr.ValidationError=kt.default,yr.MissingRefError=Bt.default;function br(vr,Er,Tr,Rr="error"){for(const Mr in vr){const Gr=Mr;Gr in Er&&this.logger[Rr](`${Tr}: option ${Mr}. ${vr[Gr]}`)}}function Ar(vr){return vr=(0,er.normalizeId)(vr),this.schemas[vr]||this.refs[vr]}function Pr(){const vr=this.opts.schemas;if(vr)if(Array.isArray(vr))this.addSchema(vr);else for(const Er in vr)this.addSchema(vr[Er],Er)}function kr(){for(const vr in this.opts.formats){const Er=this.opts.formats[vr];Er&&this.addFormat(vr,Er)}}function Ur(vr){if(Array.isArray(vr)){this.addVocabulary(vr);return}this.logger.warn("keywords option as map is deprecated, pass array");for(const Er in vr){const Tr=vr[Er];Tr.keyword||(Tr.keyword=Er),this.addKeyword(Tr)}}function Hr(){const vr={...this.opts};for(const Er of ar)delete vr[Er];return vr}const Lr={log(){},warn(){},error(){}};function Sr(vr){if(vr===!1)return Lr;if(vr===void 0)return console;if(vr.log&&vr.warn&&vr.error)return vr;throw new Error("logger must implement log, warn and error methods")}const _r=/^[a-z_$][a-z0-9_$:-]*$/i;function gr(vr,Er){const{RULES:Tr}=this;if((0,zt.eachItem)(vr,Rr=>{if(Tr.keywords[Rr])throw new Error(`Keyword ${Rr} is already defined`);if(!_r.test(Rr))throw new Error(`Keyword ${Rr} has invalid name`)}),!!Er&&Er.$data&&!("code"in Er||"validate"in Er))throw new Error('$data keyword must have "code" or "validate" function')}function wr(vr,Er,Tr){var Rr;const Mr=Er==null?void 0:Er.post;if(Tr&&Mr)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:Gr}=this;let Br=Mr?Gr.post:Gr.rules.find(({type:jr})=>jr===Tr);if(Br||(Br={type:Tr,rules:[]},Gr.rules.push(Br)),Gr.keywords[vr]=!0,!Er)return;const Cr={keyword:vr,definition:{...Er,type:(0,tr.getJSONTypes)(Er.type),schemaType:(0,tr.getJSONTypes)(Er.schemaType)}};Er.before?Dr.call(this,Br,Cr,Er.before):Br.rules.push(Cr),Gr.all[vr]=Cr,(Rr=Er.implements)===null||Rr===void 0||Rr.forEach(jr=>this.addKeyword(jr))}function Dr(vr,Er,Tr){const Rr=vr.rules.findIndex(Mr=>Mr.keyword===Tr);Rr>=0?vr.rules.splice(Rr,0,Er):(vr.rules.push(Er),this.logger.warn(`rule ${Tr} is not defined`))}function xr(vr){let{metaSchema:Er}=vr;Er!==void 0&&(vr.$data&&this.opts.$data&&(Er=$r(Er)),vr.validateSchema=this.compile(Er,!0))}const Ir={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function $r(vr){return{anyOf:[vr,Ir]}}})(core$3);var draft2020={},core$2={},id={};Object.defineProperty(id,"__esModule",{value:!0});const def$B={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};id.default=def$B;var ref={};Object.defineProperty(ref,"__esModule",{value:!0});ref.callRef=ref.getValidate=void 0;const ref_error_1=ref_error,code_1$8=code$1,codegen_1$p=codegen,names_1$4=names$1,compile_1$2=compile,util_1$n=util$1,def$A={keyword:"$ref",schemaType:"string",code(xt){const{gen:e,schema:At,it:kt}=xt,{baseId:Bt,schemaEnv:Nt,validateName:jt,opts:Lt,self:er}=kt,{root:tr}=Nt;if((At==="#"||At==="#/")&&Bt===tr.baseId)return rr();const zt=compile_1$2.resolveRef.call(er,tr,Bt,At);if(zt===void 0)throw new ref_error_1.default(kt.opts.uriResolver,Bt,At);if(zt instanceof compile_1$2.SchemaEnv)return nr(zt);return ir(zt);function rr(){if(Nt===tr)return callRef(xt,jt,Nt,Nt.$async);const ar=e.scopeValue("root",{ref:tr});return callRef(xt,(0,codegen_1$p._)`${ar}.validate`,tr,tr.$async)}function nr(ar){const dr=getValidate(xt,ar);callRef(xt,dr,ar,ar.$async)}function ir(ar){const dr=e.scopeValue("schema",Lt.code.source===!0?{ref:ar,code:(0,codegen_1$p.stringify)(ar)}:{ref:ar}),ur=e.name("valid"),fr=xt.subschema({schema:ar,dataTypes:[],schemaPath:codegen_1$p.nil,topSchemaRef:dr,errSchemaPath:At},ur);xt.mergeEvaluated(fr),xt.ok(ur)}}};function getValidate(xt,e){const{gen:At}=xt;return e.validate?At.scopeValue("validate",{ref:e.validate}):(0,codegen_1$p._)`${At.scopeValue("wrapper",{ref:e})}.validate`}ref.getValidate=getValidate;function callRef(xt,e,At,kt){const{gen:Bt,it:Nt}=xt,{allErrors:jt,schemaEnv:Lt,opts:er}=Nt,tr=er.passContext?names_1$4.default.this:codegen_1$p.nil;kt?zt():rr();function zt(){if(!Lt.$async)throw new Error("async schema referenced by sync schema");const ar=Bt.let("valid");Bt.try(()=>{Bt.code((0,codegen_1$p._)`await ${(0,code_1$8.callValidateCode)(xt,e,tr)}`),ir(e),jt||Bt.assign(ar,!0)},dr=>{Bt.if((0,codegen_1$p._)`!(${dr} instanceof ${Nt.ValidationError})`,()=>Bt.throw(dr)),nr(dr),jt||Bt.assign(ar,!1)}),xt.ok(ar)}function rr(){xt.result((0,code_1$8.callValidateCode)(xt,e,tr),()=>ir(e),()=>nr(e))}function nr(ar){const dr=(0,codegen_1$p._)`${ar}.errors`;Bt.assign(names_1$4.default.vErrors,(0,codegen_1$p._)`${names_1$4.default.vErrors} === null ? ${dr} : ${names_1$4.default.vErrors}.concat(${dr})`),Bt.assign(names_1$4.default.errors,(0,codegen_1$p._)`${names_1$4.default.vErrors}.length`)}function ir(ar){var dr;if(!Nt.opts.unevaluated)return;const ur=(dr=At==null?void 0:At.validate)===null||dr===void 0?void 0:dr.evaluated;if(Nt.props!==!0)if(ur&&!ur.dynamicProps)ur.props!==void 0&&(Nt.props=util_1$n.mergeEvaluated.props(Bt,ur.props,Nt.props));else{const fr=Bt.var("props",(0,codegen_1$p._)`${ar}.evaluated.props`);Nt.props=util_1$n.mergeEvaluated.props(Bt,fr,Nt.props,codegen_1$p.Name)}if(Nt.items!==!0)if(ur&&!ur.dynamicItems)ur.items!==void 0&&(Nt.items=util_1$n.mergeEvaluated.items(Bt,ur.items,Nt.items));else{const fr=Bt.var("items",(0,codegen_1$p._)`${ar}.evaluated.items`);Nt.items=util_1$n.mergeEvaluated.items(Bt,fr,Nt.items,codegen_1$p.Name)}}}ref.callRef=callRef;ref.default=def$A;Object.defineProperty(core$2,"__esModule",{value:!0});const id_1=id,ref_1$2=ref,core$1=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",id_1.default,ref_1$2.default];core$2.default=core$1;var validation$2={},limitNumber={};Object.defineProperty(limitNumber,"__esModule",{value:!0});const codegen_1$o=codegen,ops=codegen_1$o.operators,KWDs={maximum:{okStr:"<=",ok:ops.LTE,fail:ops.GT},minimum:{okStr:">=",ok:ops.GTE,fail:ops.LT},exclusiveMaximum:{okStr:"<",ok:ops.LT,fail:ops.GTE},exclusiveMinimum:{okStr:">",ok:ops.GT,fail:ops.LTE}},error$k={message:({keyword:xt,schemaCode:e})=>(0,codegen_1$o.str)`must be ${KWDs[xt].okStr} ${e}`,params:({keyword:xt,schemaCode:e})=>(0,codegen_1$o._)`{comparison: ${KWDs[xt].okStr}, limit: ${e}}`},def$z={keyword:Object.keys(KWDs),type:"number",schemaType:"number",$data:!0,error:error$k,code(xt){const{keyword:e,data:At,schemaCode:kt}=xt;xt.fail$data((0,codegen_1$o._)`${At} ${KWDs[e].fail} ${kt} || isNaN(${At})`)}};limitNumber.default=def$z;var multipleOf={};Object.defineProperty(multipleOf,"__esModule",{value:!0});const codegen_1$n=codegen,error$j={message:({schemaCode:xt})=>(0,codegen_1$n.str)`must be multiple of ${xt}`,params:({schemaCode:xt})=>(0,codegen_1$n._)`{multipleOf: ${xt}}`},def$y={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:error$j,code(xt){const{gen:e,data:At,schemaCode:kt,it:Bt}=xt,Nt=Bt.opts.multipleOfPrecision,jt=e.let("res"),Lt=Nt?(0,codegen_1$n._)`Math.abs(Math.round(${jt}) - ${jt}) > 1e-${Nt}`:(0,codegen_1$n._)`${jt} !== parseInt(${jt})`;xt.fail$data((0,codegen_1$n._)`(${kt} === 0 || (${jt} = ${At}/${kt}, ${Lt}))`)}};multipleOf.default=def$y;var limitLength={},ucs2length$1={};Object.defineProperty(ucs2length$1,"__esModule",{value:!0});function ucs2length(xt){const e=xt.length;let At=0,kt=0,Bt;for(;kt<e;)At++,Bt=xt.charCodeAt(kt++),Bt>=55296&&Bt<=56319&&kt<e&&(Bt=xt.charCodeAt(kt),(Bt&64512)===56320&&kt++);return At}ucs2length$1.default=ucs2length;ucs2length.code='require("ajv/dist/runtime/ucs2length").default';Object.defineProperty(limitLength,"__esModule",{value:!0});const codegen_1$m=codegen,util_1$m=util$1,ucs2length_1=ucs2length$1,error$i={message({keyword:xt,schemaCode:e}){const At=xt==="maxLength"?"more":"fewer";return(0,codegen_1$m.str)`must NOT have ${At} than ${e} characters`},params:({schemaCode:xt})=>(0,codegen_1$m._)`{limit: ${xt}}`},def$x={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:error$i,code(xt){const{keyword:e,data:At,schemaCode:kt,it:Bt}=xt,Nt=e==="maxLength"?codegen_1$m.operators.GT:codegen_1$m.operators.LT,jt=Bt.opts.unicode===!1?(0,codegen_1$m._)`${At}.length`:(0,codegen_1$m._)`${(0,util_1$m.useFunc)(xt.gen,ucs2length_1.default)}(${At})`;xt.fail$data((0,codegen_1$m._)`${jt} ${Nt} ${kt}`)}};limitLength.default=def$x;var pattern={};Object.defineProperty(pattern,"__esModule",{value:!0});const code_1$7=code$1,codegen_1$l=codegen,error$h={message:({schemaCode:xt})=>(0,codegen_1$l.str)`must match pattern "${xt}"`,params:({schemaCode:xt})=>(0,codegen_1$l._)`{pattern: ${xt}}`},def$w={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:error$h,code(xt){const{data:e,$data:At,schema:kt,schemaCode:Bt,it:Nt}=xt,jt=Nt.opts.unicodeRegExp?"u":"",Lt=At?(0,codegen_1$l._)`(new RegExp(${Bt}, ${jt}))`:(0,code_1$7.usePattern)(xt,kt);xt.fail$data((0,codegen_1$l._)`!${Lt}.test(${e})`)}};pattern.default=def$w;var limitProperties={};Object.defineProperty(limitProperties,"__esModule",{value:!0});const codegen_1$k=codegen,error$g={message({keyword:xt,schemaCode:e}){const At=xt==="maxProperties"?"more":"fewer";return(0,codegen_1$k.str)`must NOT have ${At} than ${e} properties`},params:({schemaCode:xt})=>(0,codegen_1$k._)`{limit: ${xt}}`},def$v={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:error$g,code(xt){const{keyword:e,data:At,schemaCode:kt}=xt,Bt=e==="maxProperties"?codegen_1$k.operators.GT:codegen_1$k.operators.LT;xt.fail$data((0,codegen_1$k._)`Object.keys(${At}).length ${Bt} ${kt}`)}};limitProperties.default=def$v;var required={};Object.defineProperty(required,"__esModule",{value:!0});const code_1$6=code$1,codegen_1$j=codegen,util_1$l=util$1,error$f={message:({params:{missingProperty:xt}})=>(0,codegen_1$j.str)`must have required property '${xt}'`,params:({params:{missingProperty:xt}})=>(0,codegen_1$j._)`{missingProperty: ${xt}}`},def$u={keyword:"required",type:"object",schemaType:"array",$data:!0,error:error$f,code(xt){const{gen:e,schema:At,schemaCode:kt,data:Bt,$data:Nt,it:jt}=xt,{opts:Lt}=jt;if(!Nt&&At.length===0)return;const er=At.length>=Lt.loopRequired;if(jt.allErrors?tr():zt(),Lt.strictRequired){const ir=xt.parentSchema.properties,{definedProperties:ar}=xt.it;for(const dr of At)if((ir==null?void 0:ir[dr])===void 0&&!ar.has(dr)){const ur=jt.schemaEnv.baseId+jt.errSchemaPath,fr=`required property "${dr}" is not defined at "${ur}" (strictRequired)`;(0,util_1$l.checkStrictMode)(jt,fr,jt.opts.strictRequired)}}function tr(){if(er||Nt)xt.block$data(codegen_1$j.nil,rr);else for(const ir of At)(0,code_1$6.checkReportMissingProp)(xt,ir)}function zt(){const ir=e.let("missing");if(er||Nt){const ar=e.let("valid",!0);xt.block$data(ar,()=>nr(ir,ar)),xt.ok(ar)}else e.if((0,code_1$6.checkMissingProp)(xt,At,ir)),(0,code_1$6.reportMissingProp)(xt,ir),e.else()}function rr(){e.forOf("prop",kt,ir=>{xt.setParams({missingProperty:ir}),e.if((0,code_1$6.noPropertyInData)(e,Bt,ir,Lt.ownProperties),()=>xt.error())})}function nr(ir,ar){xt.setParams({missingProperty:ir}),e.forOf(ir,kt,()=>{e.assign(ar,(0,code_1$6.propertyInData)(e,Bt,ir,Lt.ownProperties)),e.if((0,codegen_1$j.not)(ar),()=>{xt.error(),e.break()})},codegen_1$j.nil)}}};required.default=def$u;var limitItems={};Object.defineProperty(limitItems,"__esModule",{value:!0});const codegen_1$i=codegen,error$e={message({keyword:xt,schemaCode:e}){const At=xt==="maxItems"?"more":"fewer";return(0,codegen_1$i.str)`must NOT have ${At} than ${e} items`},params:({schemaCode:xt})=>(0,codegen_1$i._)`{limit: ${xt}}`},def$t={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:error$e,code(xt){const{keyword:e,data:At,schemaCode:kt}=xt,Bt=e==="maxItems"?codegen_1$i.operators.GT:codegen_1$i.operators.LT;xt.fail$data((0,codegen_1$i._)`${At}.length ${Bt} ${kt}`)}};limitItems.default=def$t;var uniqueItems={},equal$1={};Object.defineProperty(equal$1,"__esModule",{value:!0});const equal=fastDeepEqual;equal.code='require("ajv/dist/runtime/equal").default';equal$1.default=equal;Object.defineProperty(uniqueItems,"__esModule",{value:!0});const dataType_1=dataType,codegen_1$h=codegen,util_1$k=util$1,equal_1$2=equal$1,error$d={message:({params:{i:xt,j:e}})=>(0,codegen_1$h.str)`must NOT have duplicate items (items ## ${e} and ${xt} are identical)`,params:({params:{i:xt,j:e}})=>(0,codegen_1$h._)`{i: ${xt}, j: ${e}}`},def$s={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:error$d,code(xt){const{gen:e,data:At,$data:kt,schema:Bt,parentSchema:Nt,schemaCode:jt,it:Lt}=xt;if(!kt&&!Bt)return;const er=e.let("valid"),tr=Nt.items?(0,dataType_1.getSchemaTypes)(Nt.items):[];xt.block$data(er,zt,(0,codegen_1$h._)`${jt} === false`),xt.ok(er);function zt(){const ar=e.let("i",(0,codegen_1$h._)`${At}.length`),dr=e.let("j");xt.setParams({i:ar,j:dr}),e.assign(er,!0),e.if((0,codegen_1$h._)`${ar} > 1`,()=>(rr()?nr:ir)(ar,dr))}function rr(){return tr.length>0&&!tr.some(ar=>ar==="object"||ar==="array")}function nr(ar,dr){const ur=e.name("item"),fr=(0,dataType_1.checkDataTypes)(tr,ur,Lt.opts.strictNumbers,dataType_1.DataType.Wrong),pr=e.const("indices",(0,codegen_1$h._)`{}`);e.for((0,codegen_1$h._)`;${ar}--;`,()=>{e.let(ur,(0,codegen_1$h._)`${At}[${ar}]`),e.if(fr,(0,codegen_1$h._)`continue`),tr.length>1&&e.if((0,codegen_1$h._)`typeof ${ur} == "string"`,(0,codegen_1$h._)`${ur} += "_"`),e.if((0,codegen_1$h._)`typeof ${pr}[${ur}] == "number"`,()=>{e.assign(dr,(0,codegen_1$h._)`${pr}[${ur}]`),xt.error(),e.assign(er,!1).break()}).code((0,codegen_1$h._)`${pr}[${ur}] = ${ar}`)})}function ir(ar,dr){const ur=(0,util_1$k.useFunc)(e,equal_1$2.default),fr=e.name("outer");e.label(fr).for((0,codegen_1$h._)`;${ar}--;`,()=>e.for((0,codegen_1$h._)`${dr} = ${ar}; ${dr}--;`,()=>e.if((0,codegen_1$h._)`${ur}(${At}[${ar}], ${At}[${dr}])`,()=>{xt.error(),e.assign(er,!1).break(fr)})))}}};uniqueItems.default=def$s;var _const={};Object.defineProperty(_const,"__esModule",{value:!0});const codegen_1$g=codegen,util_1$j=util$1,equal_1$1=equal$1,error$c={message:"must be equal to constant",params:({schemaCode:xt})=>(0,codegen_1$g._)`{allowedValue: ${xt}}`},def$r={keyword:"const",$data:!0,error:error$c,code(xt){const{gen:e,data:At,$data:kt,schemaCode:Bt,schema:Nt}=xt;kt||Nt&&typeof Nt=="object"?xt.fail$data((0,codegen_1$g._)`!${(0,util_1$j.useFunc)(e,equal_1$1.default)}(${At}, ${Bt})`):xt.fail((0,codegen_1$g._)`${Nt} !== ${At}`)}};_const.default=def$r;var _enum={};Object.defineProperty(_enum,"__esModule",{value:!0});const codegen_1$f=codegen,util_1$i=util$1,equal_1=equal$1,error$b={message:"must be equal to one of the allowed values",params:({schemaCode:xt})=>(0,codegen_1$f._)`{allowedValues: ${xt}}`},def$q={keyword:"enum",schemaType:"array",$data:!0,error:error$b,code(xt){const{gen:e,data:At,$data:kt,schema:Bt,schemaCode:Nt,it:jt}=xt;if(!kt&&Bt.length===0)throw new Error("enum must have non-empty array");const Lt=Bt.length>=jt.opts.loopEnum;let er;const tr=()=>er??(er=(0,util_1$i.useFunc)(e,equal_1.default));let zt;if(Lt||kt)zt=e.let("valid"),xt.block$data(zt,rr);else{if(!Array.isArray(Bt))throw new Error("ajv implementation error");const ir=e.const("vSchema",Nt);zt=(0,codegen_1$f.or)(...Bt.map((ar,dr)=>nr(ir,dr)))}xt.pass(zt);function rr(){e.assign(zt,!1),e.forOf("v",Nt,ir=>e.if((0,codegen_1$f._)`${tr()}(${At}, ${ir})`,()=>e.assign(zt,!0).break()))}function nr(ir,ar){const dr=Bt[ar];return typeof dr=="object"&&dr!==null?(0,codegen_1$f._)`${tr()}(${At}, ${ir}[${ar}])`:(0,codegen_1$f._)`${At} === ${dr}`}}};_enum.default=def$q;Object.defineProperty(validation$2,"__esModule",{value:!0});const limitNumber_1=limitNumber,multipleOf_1=multipleOf,limitLength_1=limitLength,pattern_1=pattern,limitProperties_1=limitProperties,required_1=required,limitItems_1=limitItems,uniqueItems_1=uniqueItems,const_1=_const,enum_1=_enum,validation$1=[limitNumber_1.default,multipleOf_1.default,limitLength_1.default,pattern_1.default,limitProperties_1.default,required_1.default,limitItems_1.default,uniqueItems_1.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},const_1.default,enum_1.default];validation$2.default=validation$1;var applicator$1={},additionalItems={};Object.defineProperty(additionalItems,"__esModule",{value:!0});additionalItems.validateAdditionalItems=void 0;const codegen_1$e=codegen,util_1$h=util$1,error$a={message:({params:{len:xt}})=>(0,codegen_1$e.str)`must NOT have more than ${xt} items`,params:({params:{len:xt}})=>(0,codegen_1$e._)`{limit: ${xt}}`},def$p={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:error$a,code(xt){const{parentSchema:e,it:At}=xt,{items:kt}=e;if(!Array.isArray(kt)){(0,util_1$h.checkStrictMode)(At,'"additionalItems" is ignored when "items" is not an array of schemas');return}validateAdditionalItems(xt,kt)}};function validateAdditionalItems(xt,e){const{gen:At,schema:kt,data:Bt,keyword:Nt,it:jt}=xt;jt.items=!0;const Lt=At.const("len",(0,codegen_1$e._)`${Bt}.length`);if(kt===!1)xt.setParams({len:e.length}),xt.pass((0,codegen_1$e._)`${Lt} <= ${e.length}`);else if(typeof kt=="object"&&!(0,util_1$h.alwaysValidSchema)(jt,kt)){const tr=At.var("valid",(0,codegen_1$e._)`${Lt} <= ${e.length}`);At.if((0,codegen_1$e.not)(tr),()=>er(tr)),xt.ok(tr)}function er(tr){At.forRange("i",e.length,Lt,zt=>{xt.subschema({keyword:Nt,dataProp:zt,dataPropType:util_1$h.Type.Num},tr),jt.allErrors||At.if((0,codegen_1$e.not)(tr),()=>At.break())})}}additionalItems.validateAdditionalItems=validateAdditionalItems;additionalItems.default=def$p;var prefixItems={},items={};Object.defineProperty(items,"__esModule",{value:!0});items.validateTuple=void 0;const codegen_1$d=codegen,util_1$g=util$1,code_1$5=code$1,def$o={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(xt){const{schema:e,it:At}=xt;if(Array.isArray(e))return validateTuple(xt,"additionalItems",e);At.items=!0,!(0,util_1$g.alwaysValidSchema)(At,e)&&xt.ok((0,code_1$5.validateArray)(xt))}};function validateTuple(xt,e,At=xt.schema){const{gen:kt,parentSchema:Bt,data:Nt,keyword:jt,it:Lt}=xt;zt(Bt),Lt.opts.unevaluated&&At.length&&Lt.items!==!0&&(Lt.items=util_1$g.mergeEvaluated.items(kt,At.length,Lt.items));const er=kt.name("valid"),tr=kt.const("len",(0,codegen_1$d._)`${Nt}.length`);At.forEach((rr,nr)=>{(0,util_1$g.alwaysValidSchema)(Lt,rr)||(kt.if((0,codegen_1$d._)`${tr} > ${nr}`,()=>xt.subschema({keyword:jt,schemaProp:nr,dataProp:nr},er)),xt.ok(er))});function zt(rr){const{opts:nr,errSchemaPath:ir}=Lt,ar=At.length,dr=ar===rr.minItems&&(ar===rr.maxItems||rr[e]===!1);if(nr.strictTuples&&!dr){const ur=`"${jt}" is ${ar}-tuple, but minItems or maxItems/${e} are not specified or different at path "${ir}"`;(0,util_1$g.checkStrictMode)(Lt,ur,nr.strictTuples)}}}items.validateTuple=validateTuple;items.default=def$o;Object.defineProperty(prefixItems,"__esModule",{value:!0});const items_1$1=items,def$n={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:xt=>(0,items_1$1.validateTuple)(xt,"items")};prefixItems.default=def$n;var items2020={};Object.defineProperty(items2020,"__esModule",{value:!0});const codegen_1$c=codegen,util_1$f=util$1,code_1$4=code$1,additionalItems_1$1=additionalItems,error$9={message:({params:{len:xt}})=>(0,codegen_1$c.str)`must NOT have more than ${xt} items`,params:({params:{len:xt}})=>(0,codegen_1$c._)`{limit: ${xt}}`},def$m={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:error$9,code(xt){const{schema:e,parentSchema:At,it:kt}=xt,{prefixItems:Bt}=At;kt.items=!0,!(0,util_1$f.alwaysValidSchema)(kt,e)&&(Bt?(0,additionalItems_1$1.validateAdditionalItems)(xt,Bt):xt.ok((0,code_1$4.validateArray)(xt)))}};items2020.default=def$m;var contains={};Object.defineProperty(contains,"__esModule",{value:!0});const codegen_1$b=codegen,util_1$e=util$1,error$8={message:({params:{min:xt,max:e}})=>e===void 0?(0,codegen_1$b.str)`must contain at least ${xt} valid item(s)`:(0,codegen_1$b.str)`must contain at least ${xt} and no more than ${e} valid item(s)`,params:({params:{min:xt,max:e}})=>e===void 0?(0,codegen_1$b._)`{minContains: ${xt}}`:(0,codegen_1$b._)`{minContains: ${xt}, maxContains: ${e}}`},def$l={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:error$8,code(xt){const{gen:e,schema:At,parentSchema:kt,data:Bt,it:Nt}=xt;let jt,Lt;const{minContains:er,maxContains:tr}=kt;Nt.opts.next?(jt=er===void 0?1:er,Lt=tr):jt=1;const zt=e.const("len",(0,codegen_1$b._)`${Bt}.length`);if(xt.setParams({min:jt,max:Lt}),Lt===void 0&&jt===0){(0,util_1$e.checkStrictMode)(Nt,'"minContains" == 0 without "maxContains": "contains" keyword ignored');return}if(Lt!==void 0&&jt>Lt){(0,util_1$e.checkStrictMode)(Nt,'"minContains" > "maxContains" is always invalid'),xt.fail();return}if((0,util_1$e.alwaysValidSchema)(Nt,At)){let dr=(0,codegen_1$b._)`${zt} >= ${jt}`;Lt!==void 0&&(dr=(0,codegen_1$b._)`${dr} && ${zt} <= ${Lt}`),xt.pass(dr);return}Nt.items=!0;const rr=e.name("valid");Lt===void 0&&jt===1?ir(rr,()=>e.if(rr,()=>e.break())):jt===0?(e.let(rr,!0),Lt!==void 0&&e.if((0,codegen_1$b._)`${Bt}.length > 0`,nr)):(e.let(rr,!1),nr()),xt.result(rr,()=>xt.reset());function nr(){const dr=e.name("_valid"),ur=e.let("count",0);ir(dr,()=>e.if(dr,()=>ar(ur)))}function ir(dr,ur){e.forRange("i",0,zt,fr=>{xt.subschema({keyword:"contains",dataProp:fr,dataPropType:util_1$e.Type.Num,compositeRule:!0},dr),ur()})}function ar(dr){e.code((0,codegen_1$b._)`${dr}++`),Lt===void 0?e.if((0,codegen_1$b._)`${dr} >= ${jt}`,()=>e.assign(rr,!0).break()):(e.if((0,codegen_1$b._)`${dr} > ${Lt}`,()=>e.assign(rr,!1).break()),jt===1?e.assign(rr,!0):e.if((0,codegen_1$b._)`${dr} >= ${jt}`,()=>e.assign(rr,!0)))}}};contains.default=def$l;var dependencies={};(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.validateSchemaDeps=xt.validatePropertyDeps=xt.error=void 0;const e=codegen,At=util$1,kt=code$1;xt.error={message:({params:{property:er,depsCount:tr,deps:zt}})=>{const rr=tr===1?"property":"properties";return(0,e.str)`must have ${rr} ${zt} when property ${er} is present`},params:({params:{property:er,depsCount:tr,deps:zt,missingProperty:rr}})=>(0,e._)`{property: ${er},
    missingProperty: ${rr},
    depsCount: ${tr},
    deps: ${zt}}`};const Bt={keyword:"dependencies",type:"object",schemaType:"object",error:xt.error,code(er){const[tr,zt]=Nt(er);jt(er,tr),Lt(er,zt)}};function Nt({schema:er}){const tr={},zt={};for(const rr in er){if(rr==="__proto__")continue;const nr=Array.isArray(er[rr])?tr:zt;nr[rr]=er[rr]}return[tr,zt]}function jt(er,tr=er.schema){const{gen:zt,data:rr,it:nr}=er;if(Object.keys(tr).length===0)return;const ir=zt.let("missing");for(const ar in tr){const dr=tr[ar];if(dr.length===0)continue;const ur=(0,kt.propertyInData)(zt,rr,ar,nr.opts.ownProperties);er.setParams({property:ar,depsCount:dr.length,deps:dr.join(", ")}),nr.allErrors?zt.if(ur,()=>{for(const fr of dr)(0,kt.checkReportMissingProp)(er,fr)}):(zt.if((0,e._)`${ur} && (${(0,kt.checkMissingProp)(er,dr,ir)})`),(0,kt.reportMissingProp)(er,ir),zt.else())}}xt.validatePropertyDeps=jt;function Lt(er,tr=er.schema){const{gen:zt,data:rr,keyword:nr,it:ir}=er,ar=zt.name("valid");for(const dr in tr)(0,At.alwaysValidSchema)(ir,tr[dr])||(zt.if((0,kt.propertyInData)(zt,rr,dr,ir.opts.ownProperties),()=>{const ur=er.subschema({keyword:nr,schemaProp:dr},ar);er.mergeValidEvaluated(ur,ar)},()=>zt.var(ar,!0)),er.ok(ar))}xt.validateSchemaDeps=Lt,xt.default=Bt})(dependencies);var propertyNames={};Object.defineProperty(propertyNames,"__esModule",{value:!0});const codegen_1$a=codegen,util_1$d=util$1,error$7={message:"property name must be valid",params:({params:xt})=>(0,codegen_1$a._)`{propertyName: ${xt.propertyName}}`},def$k={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:error$7,code(xt){const{gen:e,schema:At,data:kt,it:Bt}=xt;if((0,util_1$d.alwaysValidSchema)(Bt,At))return;const Nt=e.name("valid");e.forIn("key",kt,jt=>{xt.setParams({propertyName:jt}),xt.subschema({keyword:"propertyNames",data:jt,dataTypes:["string"],propertyName:jt,compositeRule:!0},Nt),e.if((0,codegen_1$a.not)(Nt),()=>{xt.error(!0),Bt.allErrors||e.break()})}),xt.ok(Nt)}};propertyNames.default=def$k;var additionalProperties={};Object.defineProperty(additionalProperties,"__esModule",{value:!0});const code_1$3=code$1,codegen_1$9=codegen,names_1$3=names$1,util_1$c=util$1,error$6={message:"must NOT have additional properties",params:({params:xt})=>(0,codegen_1$9._)`{additionalProperty: ${xt.additionalProperty}}`},def$j={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:error$6,code(xt){const{gen:e,schema:At,parentSchema:kt,data:Bt,errsCount:Nt,it:jt}=xt;if(!Nt)throw new Error("ajv implementation error");const{allErrors:Lt,opts:er}=jt;if(jt.props=!0,er.removeAdditional!=="all"&&(0,util_1$c.alwaysValidSchema)(jt,At))return;const tr=(0,code_1$3.allSchemaProperties)(kt.properties),zt=(0,code_1$3.allSchemaProperties)(kt.patternProperties);rr(),xt.ok((0,codegen_1$9._)`${Nt} === ${names_1$3.default.errors}`);function rr(){e.forIn("key",Bt,ur=>{!tr.length&&!zt.length?ar(ur):e.if(nr(ur),()=>ar(ur))})}function nr(ur){let fr;if(tr.length>8){const pr=(0,util_1$c.schemaRefOrVal)(jt,kt.properties,"properties");fr=(0,code_1$3.isOwnProperty)(e,pr,ur)}else tr.length?fr=(0,codegen_1$9.or)(...tr.map(pr=>(0,codegen_1$9._)`${ur} === ${pr}`)):fr=codegen_1$9.nil;return zt.length&&(fr=(0,codegen_1$9.or)(fr,...zt.map(pr=>(0,codegen_1$9._)`${(0,code_1$3.usePattern)(xt,pr)}.test(${ur})`))),(0,codegen_1$9.not)(fr)}function ir(ur){e.code((0,codegen_1$9._)`delete ${Bt}[${ur}]`)}function ar(ur){if(er.removeAdditional==="all"||er.removeAdditional&&At===!1){ir(ur);return}if(At===!1){xt.setParams({additionalProperty:ur}),xt.error(),Lt||e.break();return}if(typeof At=="object"&&!(0,util_1$c.alwaysValidSchema)(jt,At)){const fr=e.name("valid");er.removeAdditional==="failing"?(dr(ur,fr,!1),e.if((0,codegen_1$9.not)(fr),()=>{xt.reset(),ir(ur)})):(dr(ur,fr),Lt||e.if((0,codegen_1$9.not)(fr),()=>e.break()))}}function dr(ur,fr,pr){const lr={keyword:"additionalProperties",dataProp:ur,dataPropType:util_1$c.Type.Str};pr===!1&&Object.assign(lr,{compositeRule:!0,createErrors:!1,allErrors:!1}),xt.subschema(lr,fr)}}};additionalProperties.default=def$j;var properties$8={};Object.defineProperty(properties$8,"__esModule",{value:!0});const validate_1=validate,code_1$2=code$1,util_1$b=util$1,additionalProperties_1$1=additionalProperties,def$i={keyword:"properties",type:"object",schemaType:"object",code(xt){const{gen:e,schema:At,parentSchema:kt,data:Bt,it:Nt}=xt;Nt.opts.removeAdditional==="all"&&kt.additionalProperties===void 0&&additionalProperties_1$1.default.code(new validate_1.KeywordCxt(Nt,additionalProperties_1$1.default,"additionalProperties"));const jt=(0,code_1$2.allSchemaProperties)(At);for(const rr of jt)Nt.definedProperties.add(rr);Nt.opts.unevaluated&&jt.length&&Nt.props!==!0&&(Nt.props=util_1$b.mergeEvaluated.props(e,(0,util_1$b.toHash)(jt),Nt.props));const Lt=jt.filter(rr=>!(0,util_1$b.alwaysValidSchema)(Nt,At[rr]));if(Lt.length===0)return;const er=e.name("valid");for(const rr of Lt)tr(rr)?zt(rr):(e.if((0,code_1$2.propertyInData)(e,Bt,rr,Nt.opts.ownProperties)),zt(rr),Nt.allErrors||e.else().var(er,!0),e.endIf()),xt.it.definedProperties.add(rr),xt.ok(er);function tr(rr){return Nt.opts.useDefaults&&!Nt.compositeRule&&At[rr].default!==void 0}function zt(rr){xt.subschema({keyword:"properties",schemaProp:rr,dataProp:rr},er)}}};properties$8.default=def$i;var patternProperties={};Object.defineProperty(patternProperties,"__esModule",{value:!0});const code_1$1=code$1,codegen_1$8=codegen,util_1$a=util$1,util_2=util$1,def$h={keyword:"patternProperties",type:"object",schemaType:"object",code(xt){const{gen:e,schema:At,data:kt,parentSchema:Bt,it:Nt}=xt,{opts:jt}=Nt,Lt=(0,code_1$1.allSchemaProperties)(At),er=Lt.filter(dr=>(0,util_1$a.alwaysValidSchema)(Nt,At[dr]));if(Lt.length===0||er.length===Lt.length&&(!Nt.opts.unevaluated||Nt.props===!0))return;const tr=jt.strictSchema&&!jt.allowMatchingProperties&&Bt.properties,zt=e.name("valid");Nt.props!==!0&&!(Nt.props instanceof codegen_1$8.Name)&&(Nt.props=(0,util_2.evaluatedPropsToName)(e,Nt.props));const{props:rr}=Nt;nr();function nr(){for(const dr of Lt)tr&&ir(dr),Nt.allErrors?ar(dr):(e.var(zt,!0),ar(dr),e.if(zt))}function ir(dr){for(const ur in tr)new RegExp(dr).test(ur)&&(0,util_1$a.checkStrictMode)(Nt,`property ${ur} matches pattern ${dr} (use allowMatchingProperties)`)}function ar(dr){e.forIn("key",kt,ur=>{e.if((0,codegen_1$8._)`${(0,code_1$1.usePattern)(xt,dr)}.test(${ur})`,()=>{const fr=er.includes(dr);fr||xt.subschema({keyword:"patternProperties",schemaProp:dr,dataProp:ur,dataPropType:util_2.Type.Str},zt),Nt.opts.unevaluated&&rr!==!0?e.assign((0,codegen_1$8._)`${rr}[${ur}]`,!0):!fr&&!Nt.allErrors&&e.if((0,codegen_1$8.not)(zt),()=>e.break())})})}}};patternProperties.default=def$h;var not={};Object.defineProperty(not,"__esModule",{value:!0});const util_1$9=util$1,def$g={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(xt){const{gen:e,schema:At,it:kt}=xt;if((0,util_1$9.alwaysValidSchema)(kt,At)){xt.fail();return}const Bt=e.name("valid");xt.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},Bt),xt.failResult(Bt,()=>xt.reset(),()=>xt.error())},error:{message:"must NOT be valid"}};not.default=def$g;var anyOf={};Object.defineProperty(anyOf,"__esModule",{value:!0});const code_1=code$1,def$f={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:code_1.validateUnion,error:{message:"must match a schema in anyOf"}};anyOf.default=def$f;var oneOf={};Object.defineProperty(oneOf,"__esModule",{value:!0});const codegen_1$7=codegen,util_1$8=util$1,error$5={message:"must match exactly one schema in oneOf",params:({params:xt})=>(0,codegen_1$7._)`{passingSchemas: ${xt.passing}}`},def$e={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:error$5,code(xt){const{gen:e,schema:At,parentSchema:kt,it:Bt}=xt;if(!Array.isArray(At))throw new Error("ajv implementation error");if(Bt.opts.discriminator&&kt.discriminator)return;const Nt=At,jt=e.let("valid",!1),Lt=e.let("passing",null),er=e.name("_valid");xt.setParams({passing:Lt}),e.block(tr),xt.result(jt,()=>xt.reset(),()=>xt.error(!0));function tr(){Nt.forEach((zt,rr)=>{let nr;(0,util_1$8.alwaysValidSchema)(Bt,zt)?e.var(er,!0):nr=xt.subschema({keyword:"oneOf",schemaProp:rr,compositeRule:!0},er),rr>0&&e.if((0,codegen_1$7._)`${er} && ${jt}`).assign(jt,!1).assign(Lt,(0,codegen_1$7._)`[${Lt}, ${rr}]`).else(),e.if(er,()=>{e.assign(jt,!0),e.assign(Lt,rr),nr&&xt.mergeEvaluated(nr,codegen_1$7.Name)})})}}};oneOf.default=def$e;var allOf$1={};Object.defineProperty(allOf$1,"__esModule",{value:!0});const util_1$7=util$1,def$d={keyword:"allOf",schemaType:"array",code(xt){const{gen:e,schema:At,it:kt}=xt;if(!Array.isArray(At))throw new Error("ajv implementation error");const Bt=e.name("valid");At.forEach((Nt,jt)=>{if((0,util_1$7.alwaysValidSchema)(kt,Nt))return;const Lt=xt.subschema({keyword:"allOf",schemaProp:jt},Bt);xt.ok(Bt),xt.mergeEvaluated(Lt)})}};allOf$1.default=def$d;var _if={};Object.defineProperty(_if,"__esModule",{value:!0});const codegen_1$6=codegen,util_1$6=util$1,error$4={message:({params:xt})=>(0,codegen_1$6.str)`must match "${xt.ifClause}" schema`,params:({params:xt})=>(0,codegen_1$6._)`{failingKeyword: ${xt.ifClause}}`},def$c={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:error$4,code(xt){const{gen:e,parentSchema:At,it:kt}=xt;At.then===void 0&&At.else===void 0&&(0,util_1$6.checkStrictMode)(kt,'"if" without "then" and "else" is ignored');const Bt=hasSchema(kt,"then"),Nt=hasSchema(kt,"else");if(!Bt&&!Nt)return;const jt=e.let("valid",!0),Lt=e.name("_valid");if(er(),xt.reset(),Bt&&Nt){const zt=e.let("ifClause");xt.setParams({ifClause:zt}),e.if(Lt,tr("then",zt),tr("else",zt))}else Bt?e.if(Lt,tr("then")):e.if((0,codegen_1$6.not)(Lt),tr("else"));xt.pass(jt,()=>xt.error(!0));function er(){const zt=xt.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},Lt);xt.mergeEvaluated(zt)}function tr(zt,rr){return()=>{const nr=xt.subschema({keyword:zt},Lt);e.assign(jt,Lt),xt.mergeValidEvaluated(nr,jt),rr?e.assign(rr,(0,codegen_1$6._)`${zt}`):xt.setParams({ifClause:zt})}}}};function hasSchema(xt,e){const At=xt.schema[e];return At!==void 0&&!(0,util_1$6.alwaysValidSchema)(xt,At)}_if.default=def$c;var thenElse={};Object.defineProperty(thenElse,"__esModule",{value:!0});const util_1$5=util$1,def$b={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:xt,parentSchema:e,it:At}){e.if===void 0&&(0,util_1$5.checkStrictMode)(At,`"${xt}" without "if" is ignored`)}};thenElse.default=def$b;Object.defineProperty(applicator$1,"__esModule",{value:!0});const additionalItems_1=additionalItems,prefixItems_1=prefixItems,items_1=items,items2020_1=items2020,contains_1=contains,dependencies_1$2=dependencies,propertyNames_1=propertyNames,additionalProperties_1=additionalProperties,properties_1=properties$8,patternProperties_1=patternProperties,not_1=not,anyOf_1=anyOf,oneOf_1=oneOf,allOf_1=allOf$1,if_1=_if,thenElse_1=thenElse;function getApplicator(xt=!1){const e=[not_1.default,anyOf_1.default,oneOf_1.default,allOf_1.default,if_1.default,thenElse_1.default,propertyNames_1.default,additionalProperties_1.default,dependencies_1$2.default,properties_1.default,patternProperties_1.default];return xt?e.push(prefixItems_1.default,items2020_1.default):e.push(additionalItems_1.default,items_1.default),e.push(contains_1.default),e}applicator$1.default=getApplicator;var dynamic$1={},dynamicAnchor$1={};Object.defineProperty(dynamicAnchor$1,"__esModule",{value:!0});dynamicAnchor$1.dynamicAnchor=void 0;const codegen_1$5=codegen,names_1$2=names$1,compile_1$1=compile,ref_1$1=ref,def$a={keyword:"$dynamicAnchor",schemaType:"string",code:xt=>dynamicAnchor(xt,xt.schema)};function dynamicAnchor(xt,e){const{gen:At,it:kt}=xt;kt.schemaEnv.root.dynamicAnchors[e]=!0;const Bt=(0,codegen_1$5._)`${names_1$2.default.dynamicAnchors}${(0,codegen_1$5.getProperty)(e)}`,Nt=kt.errSchemaPath==="#"?kt.validateName:_getValidate(xt);At.if((0,codegen_1$5._)`!${Bt}`,()=>At.assign(Bt,Nt))}dynamicAnchor$1.dynamicAnchor=dynamicAnchor;function _getValidate(xt){const{schemaEnv:e,schema:At,self:kt}=xt.it,{root:Bt,baseId:Nt,localRefs:jt,meta:Lt}=e.root,{schemaId:er}=kt.opts,tr=new compile_1$1.SchemaEnv({schema:At,schemaId:er,root:Bt,baseId:Nt,localRefs:jt,meta:Lt});return compile_1$1.compileSchema.call(kt,tr),(0,ref_1$1.getValidate)(xt,tr)}dynamicAnchor$1.default=def$a;var dynamicRef$1={};Object.defineProperty(dynamicRef$1,"__esModule",{value:!0});dynamicRef$1.dynamicRef=void 0;const codegen_1$4=codegen,names_1$1=names$1,ref_1=ref,def$9={keyword:"$dynamicRef",schemaType:"string",code:xt=>dynamicRef(xt,xt.schema)};function dynamicRef(xt,e){const{gen:At,keyword:kt,it:Bt}=xt;if(e[0]!=="#")throw new Error(`"${kt}" only supports hash fragment reference`);const Nt=e.slice(1);if(Bt.allErrors)jt();else{const er=At.let("valid",!1);jt(er),xt.ok(er)}function jt(er){if(Bt.schemaEnv.root.dynamicAnchors[Nt]){const tr=At.let("_v",(0,codegen_1$4._)`${names_1$1.default.dynamicAnchors}${(0,codegen_1$4.getProperty)(Nt)}`);At.if(tr,Lt(tr,er),Lt(Bt.validateName,er))}else Lt(Bt.validateName,er)()}function Lt(er,tr){return tr?()=>At.block(()=>{(0,ref_1.callRef)(xt,er),At.let(tr,!0)}):()=>(0,ref_1.callRef)(xt,er)}}dynamicRef$1.dynamicRef=dynamicRef;dynamicRef$1.default=def$9;var recursiveAnchor={};Object.defineProperty(recursiveAnchor,"__esModule",{value:!0});const dynamicAnchor_1$1=dynamicAnchor$1,util_1$4=util$1,def$8={keyword:"$recursiveAnchor",schemaType:"boolean",code(xt){xt.schema?(0,dynamicAnchor_1$1.dynamicAnchor)(xt,""):(0,util_1$4.checkStrictMode)(xt.it,"$recursiveAnchor: false is ignored")}};recursiveAnchor.default=def$8;var recursiveRef={};Object.defineProperty(recursiveRef,"__esModule",{value:!0});const dynamicRef_1$1=dynamicRef$1,def$7={keyword:"$recursiveRef",schemaType:"string",code:xt=>(0,dynamicRef_1$1.dynamicRef)(xt,xt.schema)};recursiveRef.default=def$7;Object.defineProperty(dynamic$1,"__esModule",{value:!0});const dynamicAnchor_1=dynamicAnchor$1,dynamicRef_1=dynamicRef$1,recursiveAnchor_1=recursiveAnchor,recursiveRef_1=recursiveRef,dynamic=[dynamicAnchor_1.default,dynamicRef_1.default,recursiveAnchor_1.default,recursiveRef_1.default];dynamic$1.default=dynamic;var next$1={},dependentRequired={};Object.defineProperty(dependentRequired,"__esModule",{value:!0});const dependencies_1$1=dependencies,def$6={keyword:"dependentRequired",type:"object",schemaType:"object",error:dependencies_1$1.error,code:xt=>(0,dependencies_1$1.validatePropertyDeps)(xt)};dependentRequired.default=def$6;var dependentSchemas={};Object.defineProperty(dependentSchemas,"__esModule",{value:!0});const dependencies_1=dependencies,def$5={keyword:"dependentSchemas",type:"object",schemaType:"object",code:xt=>(0,dependencies_1.validateSchemaDeps)(xt)};dependentSchemas.default=def$5;var limitContains={};Object.defineProperty(limitContains,"__esModule",{value:!0});const util_1$3=util$1,def$4={keyword:["maxContains","minContains"],type:"array",schemaType:"number",code({keyword:xt,parentSchema:e,it:At}){e.contains===void 0&&(0,util_1$3.checkStrictMode)(At,`"${xt}" without "contains" is ignored`)}};limitContains.default=def$4;Object.defineProperty(next$1,"__esModule",{value:!0});const dependentRequired_1=dependentRequired,dependentSchemas_1=dependentSchemas,limitContains_1=limitContains,next=[dependentRequired_1.default,dependentSchemas_1.default,limitContains_1.default];next$1.default=next;var unevaluated$2={},unevaluatedProperties={};Object.defineProperty(unevaluatedProperties,"__esModule",{value:!0});const codegen_1$3=codegen,util_1$2=util$1,names_1=names$1,error$3={message:"must NOT have unevaluated properties",params:({params:xt})=>(0,codegen_1$3._)`{unevaluatedProperty: ${xt.unevaluatedProperty}}`},def$3={keyword:"unevaluatedProperties",type:"object",schemaType:["boolean","object"],trackErrors:!0,error:error$3,code(xt){const{gen:e,schema:At,data:kt,errsCount:Bt,it:Nt}=xt;if(!Bt)throw new Error("ajv implementation error");const{allErrors:jt,props:Lt}=Nt;Lt instanceof codegen_1$3.Name?e.if((0,codegen_1$3._)`${Lt} !== true`,()=>e.forIn("key",kt,rr=>e.if(tr(Lt,rr),()=>er(rr)))):Lt!==!0&&e.forIn("key",kt,rr=>Lt===void 0?er(rr):e.if(zt(Lt,rr),()=>er(rr))),Nt.props=!0,xt.ok((0,codegen_1$3._)`${Bt} === ${names_1.default.errors}`);function er(rr){if(At===!1){xt.setParams({unevaluatedProperty:rr}),xt.error(),jt||e.break();return}if(!(0,util_1$2.alwaysValidSchema)(Nt,At)){const nr=e.name("valid");xt.subschema({keyword:"unevaluatedProperties",dataProp:rr,dataPropType:util_1$2.Type.Str},nr),jt||e.if((0,codegen_1$3.not)(nr),()=>e.break())}}function tr(rr,nr){return(0,codegen_1$3._)`!${rr} || !${rr}[${nr}]`}function zt(rr,nr){const ir=[];for(const ar in rr)rr[ar]===!0&&ir.push((0,codegen_1$3._)`${nr} !== ${ar}`);return(0,codegen_1$3.and)(...ir)}}};unevaluatedProperties.default=def$3;var unevaluatedItems={};Object.defineProperty(unevaluatedItems,"__esModule",{value:!0});const codegen_1$2=codegen,util_1$1=util$1,error$2={message:({params:{len:xt}})=>(0,codegen_1$2.str)`must NOT have more than ${xt} items`,params:({params:{len:xt}})=>(0,codegen_1$2._)`{limit: ${xt}}`},def$2={keyword:"unevaluatedItems",type:"array",schemaType:["boolean","object"],error:error$2,code(xt){const{gen:e,schema:At,data:kt,it:Bt}=xt,Nt=Bt.items||0;if(Nt===!0)return;const jt=e.const("len",(0,codegen_1$2._)`${kt}.length`);if(At===!1)xt.setParams({len:Nt}),xt.fail((0,codegen_1$2._)`${jt} > ${Nt}`);else if(typeof At=="object"&&!(0,util_1$1.alwaysValidSchema)(Bt,At)){const er=e.var("valid",(0,codegen_1$2._)`${jt} <= ${Nt}`);e.if((0,codegen_1$2.not)(er),()=>Lt(er,Nt)),xt.ok(er)}Bt.items=!0;function Lt(er,tr){e.forRange("i",tr,jt,zt=>{xt.subschema({keyword:"unevaluatedItems",dataProp:zt,dataPropType:util_1$1.Type.Num},er),Bt.allErrors||e.if((0,codegen_1$2.not)(er),()=>e.break())})}}};unevaluatedItems.default=def$2;Object.defineProperty(unevaluated$2,"__esModule",{value:!0});const unevaluatedProperties_1=unevaluatedProperties,unevaluatedItems_1=unevaluatedItems,unevaluated$1=[unevaluatedProperties_1.default,unevaluatedItems_1.default];unevaluated$2.default=unevaluated$1;var format$4={},format$3={};Object.defineProperty(format$3,"__esModule",{value:!0});const codegen_1$1=codegen,error$1={message:({schemaCode:xt})=>(0,codegen_1$1.str)`must match format "${xt}"`,params:({schemaCode:xt})=>(0,codegen_1$1._)`{format: ${xt}}`},def$1={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:error$1,code(xt,e){const{gen:At,data:kt,$data:Bt,schema:Nt,schemaCode:jt,it:Lt}=xt,{opts:er,errSchemaPath:tr,schemaEnv:zt,self:rr}=Lt;if(!er.validateFormats)return;Bt?nr():ir();function nr(){const ar=At.scopeValue("formats",{ref:rr.formats,code:er.code.formats}),dr=At.const("fDef",(0,codegen_1$1._)`${ar}[${jt}]`),ur=At.let("fType"),fr=At.let("format");At.if((0,codegen_1$1._)`typeof ${dr} == "object" && !(${dr} instanceof RegExp)`,()=>At.assign(ur,(0,codegen_1$1._)`${dr}.type || "string"`).assign(fr,(0,codegen_1$1._)`${dr}.validate`),()=>At.assign(ur,(0,codegen_1$1._)`"string"`).assign(fr,dr)),xt.fail$data((0,codegen_1$1.or)(pr(),lr()));function pr(){return er.strictSchema===!1?codegen_1$1.nil:(0,codegen_1$1._)`${jt} && !${fr}`}function lr(){const yr=zt.$async?(0,codegen_1$1._)`(${dr}.async ? await ${fr}(${kt}) : ${fr}(${kt}))`:(0,codegen_1$1._)`${fr}(${kt})`,br=(0,codegen_1$1._)`(typeof ${fr} == "function" ? ${yr} : ${fr}.test(${kt}))`;return(0,codegen_1$1._)`${fr} && ${fr} !== true && ${ur} === ${e} && !${br}`}}function ir(){const ar=rr.formats[Nt];if(!ar){pr();return}if(ar===!0)return;const[dr,ur,fr]=lr(ar);dr===e&&xt.pass(yr());function pr(){if(er.strictSchema===!1){rr.logger.warn(br());return}throw new Error(br());function br(){return`unknown format "${Nt}" ignored in schema at path "${tr}"`}}function lr(br){const Ar=br instanceof RegExp?(0,codegen_1$1.regexpCode)(br):er.code.formats?(0,codegen_1$1._)`${er.code.formats}${(0,codegen_1$1.getProperty)(Nt)}`:void 0,Pr=At.scopeValue("formats",{key:Nt,ref:br,code:Ar});return typeof br=="object"&&!(br instanceof RegExp)?[br.type||"string",br.validate,(0,codegen_1$1._)`${Pr}.validate`]:["string",br,Pr]}function yr(){if(typeof ar=="object"&&!(ar instanceof RegExp)&&ar.async){if(!zt.$async)throw new Error("async format in sync schema");return(0,codegen_1$1._)`await ${fr}(${kt})`}return typeof ur=="function"?(0,codegen_1$1._)`${fr}(${kt})`:(0,codegen_1$1._)`${fr}.test(${kt})`}}}};format$3.default=def$1;Object.defineProperty(format$4,"__esModule",{value:!0});const format_1$1=format$3,format$2=[format_1$1.default];format$4.default=format$2;var metadata$1={};Object.defineProperty(metadata$1,"__esModule",{value:!0});metadata$1.contentVocabulary=metadata$1.metadataVocabulary=void 0;metadata$1.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"];metadata$1.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"];Object.defineProperty(draft2020,"__esModule",{value:!0});const core_1=core$2,validation_1=validation$2,applicator_1=applicator$1,dynamic_1=dynamic$1,next_1=next$1,unevaluated_1=unevaluated$2,format_1=format$4,metadata_1=metadata$1,draft2020Vocabularies=[dynamic_1.default,core_1.default,validation_1.default,(0,applicator_1.default)(!0),format_1.default,metadata_1.metadataVocabulary,metadata_1.contentVocabulary,next_1.default,unevaluated_1.default];draft2020.default=draft2020Vocabularies;var discriminator={},types={};(function(xt){Object.defineProperty(xt,"__esModule",{value:!0}),xt.DiscrError=void 0,function(e){e.Tag="tag",e.Mapping="mapping"}(xt.DiscrError||(xt.DiscrError={}))})(types);Object.defineProperty(discriminator,"__esModule",{value:!0});const codegen_1=codegen,types_1=types,compile_1=compile,util_1=util$1,error={message:({params:{discrError:xt,tagName:e}})=>xt===types_1.DiscrError.Tag?`tag "${e}" must be string`:`value of tag "${e}" must be in oneOf`,params:({params:{discrError:xt,tag:e,tagName:At}})=>(0,codegen_1._)`{error: ${xt}, tag: ${At}, tagValue: ${e}}`},def={keyword:"discriminator",type:"object",schemaType:"object",error,code(xt){const{gen:e,data:At,schema:kt,parentSchema:Bt,it:Nt}=xt,{oneOf:jt}=Bt;if(!Nt.opts.discriminator)throw new Error("discriminator: requires discriminator option");const Lt=kt.propertyName;if(typeof Lt!="string")throw new Error("discriminator: requires propertyName");if(kt.mapping)throw new Error("discriminator: mapping is not supported");if(!jt)throw new Error("discriminator: requires oneOf keyword");const er=e.let("valid",!1),tr=e.const("tag",(0,codegen_1._)`${At}${(0,codegen_1.getProperty)(Lt)}`);e.if((0,codegen_1._)`typeof ${tr} == "string"`,()=>zt(),()=>xt.error(!1,{discrError:types_1.DiscrError.Tag,tag:tr,tagName:Lt})),xt.ok(er);function zt(){const ir=nr();e.if(!1);for(const ar in ir)e.elseIf((0,codegen_1._)`${tr} === ${ar}`),e.assign(er,rr(ir[ar]));e.else(),xt.error(!1,{discrError:types_1.DiscrError.Mapping,tag:tr,tagName:Lt}),e.endIf()}function rr(ir){const ar=e.name("valid"),dr=xt.subschema({keyword:"oneOf",schemaProp:ir},ar);return xt.mergeEvaluated(dr,codegen_1.Name),ar}function nr(){var ir;const ar={},dr=fr(Bt);let ur=!0;for(let yr=0;yr<jt.length;yr++){let br=jt[yr];br!=null&&br.$ref&&!(0,util_1.schemaHasRulesButRef)(br,Nt.self.RULES)&&(br=compile_1.resolveRef.call(Nt.self,Nt.schemaEnv.root,Nt.baseId,br==null?void 0:br.$ref),br instanceof compile_1.SchemaEnv&&(br=br.schema));const Ar=(ir=br==null?void 0:br.properties)===null||ir===void 0?void 0:ir[Lt];if(typeof Ar!="object")throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${Lt}"`);ur=ur&&(dr||fr(br)),pr(Ar,yr)}if(!ur)throw new Error(`discriminator: "${Lt}" must be required`);return ar;function fr({required:yr}){return Array.isArray(yr)&&yr.includes(Lt)}function pr(yr,br){if(yr.const)lr(yr.const,br);else if(yr.enum)for(const Ar of yr.enum)lr(Ar,br);else throw new Error(`discriminator: "properties/${Lt}" must have "const" or "enum"`)}function lr(yr,br){if(typeof yr!="string"||yr in ar)throw new Error(`discriminator: "${Lt}" values must be unique strings`);ar[yr]=br}}}};discriminator.default=def;var jsonSchema202012={};const $schema$7="https://json-schema.org/draft/2020-12/schema",$id$7="https://json-schema.org/draft/2020-12/schema",$vocabulary$7={"https://json-schema.org/draft/2020-12/vocab/core":!0,"https://json-schema.org/draft/2020-12/vocab/applicator":!0,"https://json-schema.org/draft/2020-12/vocab/unevaluated":!0,"https://json-schema.org/draft/2020-12/vocab/validation":!0,"https://json-schema.org/draft/2020-12/vocab/meta-data":!0,"https://json-schema.org/draft/2020-12/vocab/format-annotation":!0,"https://json-schema.org/draft/2020-12/vocab/content":!0},$dynamicAnchor$7="meta",title$7="Core and Validation specifications meta-schema",allOf=[{$ref:"meta/core"},{$ref:"meta/applicator"},{$ref:"meta/unevaluated"},{$ref:"meta/validation"},{$ref:"meta/meta-data"},{$ref:"meta/format-annotation"},{$ref:"meta/content"}],type$7=["object","boolean"],$comment="This meta-schema also defines keywords that have appeared in previous drafts in order to prevent incompatible extensions as they remain in common use.",properties$7={definitions:{$comment:'"definitions" has been replaced by "$defs".',type:"object",additionalProperties:{$dynamicRef:"#meta"},deprecated:!0,default:{}},dependencies:{$comment:'"dependencies" has been split and replaced by "dependentSchemas" and "dependentRequired" in order to serve their differing semantics.',type:"object",additionalProperties:{anyOf:[{$dynamicRef:"#meta"},{$ref:"meta/validation#/$defs/stringArray"}]},deprecated:!0,default:{}},$recursiveAnchor:{$comment:'"$recursiveAnchor" has been replaced by "$dynamicAnchor".',$ref:"meta/core#/$defs/anchorString",deprecated:!0},$recursiveRef:{$comment:'"$recursiveRef" has been replaced by "$dynamicRef".',$ref:"meta/core#/$defs/uriReferenceString",deprecated:!0}},require$$0={$schema:$schema$7,$id:$id$7,$vocabulary:$vocabulary$7,$dynamicAnchor:$dynamicAnchor$7,title:title$7,allOf,type:type$7,$comment,properties:properties$7},$schema$6="https://json-schema.org/draft/2020-12/schema",$id$6="https://json-schema.org/draft/2020-12/meta/applicator",$vocabulary$6={"https://json-schema.org/draft/2020-12/vocab/applicator":!0},$dynamicAnchor$6="meta",title$6="Applicator vocabulary meta-schema",type$6=["object","boolean"],properties$6={prefixItems:{$ref:"#/$defs/schemaArray"},items:{$dynamicRef:"#meta"},contains:{$dynamicRef:"#meta"},additionalProperties:{$dynamicRef:"#meta"},properties:{type:"object",additionalProperties:{$dynamicRef:"#meta"},default:{}},patternProperties:{type:"object",additionalProperties:{$dynamicRef:"#meta"},propertyNames:{format:"regex"},default:{}},dependentSchemas:{type:"object",additionalProperties:{$dynamicRef:"#meta"},default:{}},propertyNames:{$dynamicRef:"#meta"},if:{$dynamicRef:"#meta"},then:{$dynamicRef:"#meta"},else:{$dynamicRef:"#meta"},allOf:{$ref:"#/$defs/schemaArray"},anyOf:{$ref:"#/$defs/schemaArray"},oneOf:{$ref:"#/$defs/schemaArray"},not:{$dynamicRef:"#meta"}},$defs$2={schemaArray:{type:"array",minItems:1,items:{$dynamicRef:"#meta"}}},require$$1={$schema:$schema$6,$id:$id$6,$vocabulary:$vocabulary$6,$dynamicAnchor:$dynamicAnchor$6,title:title$6,type:type$6,properties:properties$6,$defs:$defs$2},$schema$5="https://json-schema.org/draft/2020-12/schema",$id$5="https://json-schema.org/draft/2020-12/meta/unevaluated",$vocabulary$5={"https://json-schema.org/draft/2020-12/vocab/unevaluated":!0},$dynamicAnchor$5="meta",title$5="Unevaluated applicator vocabulary meta-schema",type$5=["object","boolean"],properties$5={unevaluatedItems:{$dynamicRef:"#meta"},unevaluatedProperties:{$dynamicRef:"#meta"}},require$$2={$schema:$schema$5,$id:$id$5,$vocabulary:$vocabulary$5,$dynamicAnchor:$dynamicAnchor$5,title:title$5,type:type$5,properties:properties$5},$schema$4="https://json-schema.org/draft/2020-12/schema",$id$4="https://json-schema.org/draft/2020-12/meta/content",$vocabulary$4={"https://json-schema.org/draft/2020-12/vocab/content":!0},$dynamicAnchor$4="meta",title$4="Content vocabulary meta-schema",type$4=["object","boolean"],properties$4={contentEncoding:{type:"string"},contentMediaType:{type:"string"},contentSchema:{$dynamicRef:"#meta"}},require$$3={$schema:$schema$4,$id:$id$4,$vocabulary:$vocabulary$4,$dynamicAnchor:$dynamicAnchor$4,title:title$4,type:type$4,properties:properties$4},$schema$3="https://json-schema.org/draft/2020-12/schema",$id$3="https://json-schema.org/draft/2020-12/meta/core",$vocabulary$3={"https://json-schema.org/draft/2020-12/vocab/core":!0},$dynamicAnchor$3="meta",title$3="Core vocabulary meta-schema",type$3=["object","boolean"],properties$3={$id:{$ref:"#/$defs/uriReferenceString",$comment:"Non-empty fragments not allowed.",pattern:"^[^#]*#?$"},$schema:{$ref:"#/$defs/uriString"},$ref:{$ref:"#/$defs/uriReferenceString"},$anchor:{$ref:"#/$defs/anchorString"},$dynamicRef:{$ref:"#/$defs/uriReferenceString"},$dynamicAnchor:{$ref:"#/$defs/anchorString"},$vocabulary:{type:"object",propertyNames:{$ref:"#/$defs/uriString"},additionalProperties:{type:"boolean"}},$comment:{type:"string"},$defs:{type:"object",additionalProperties:{$dynamicRef:"#meta"}}},$defs$1={anchorString:{type:"string",pattern:"^[A-Za-z_][-A-Za-z0-9._]*$"},uriString:{type:"string",format:"uri"},uriReferenceString:{type:"string",format:"uri-reference"}},require$$4={$schema:$schema$3,$id:$id$3,$vocabulary:$vocabulary$3,$dynamicAnchor:$dynamicAnchor$3,title:title$3,type:type$3,properties:properties$3,$defs:$defs$1},$schema$2="https://json-schema.org/draft/2020-12/schema",$id$2="https://json-schema.org/draft/2020-12/meta/format-annotation",$vocabulary$2={"https://json-schema.org/draft/2020-12/vocab/format-annotation":!0},$dynamicAnchor$2="meta",title$2="Format vocabulary meta-schema for annotation results",type$2=["object","boolean"],properties$2={format:{type:"string"}},require$$5={$schema:$schema$2,$id:$id$2,$vocabulary:$vocabulary$2,$dynamicAnchor:$dynamicAnchor$2,title:title$2,type:type$2,properties:properties$2},$schema$1="https://json-schema.org/draft/2020-12/schema",$id$1="https://json-schema.org/draft/2020-12/meta/meta-data",$vocabulary$1={"https://json-schema.org/draft/2020-12/vocab/meta-data":!0},$dynamicAnchor$1="meta",title$1="Meta-data vocabulary meta-schema",type$1=["object","boolean"],properties$1={title:{type:"string"},description:{type:"string"},default:!0,deprecated:{type:"boolean",default:!1},readOnly:{type:"boolean",default:!1},writeOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0}},require$$6={$schema:$schema$1,$id:$id$1,$vocabulary:$vocabulary$1,$dynamicAnchor:$dynamicAnchor$1,title:title$1,type:type$1,properties:properties$1},$schema="https://json-schema.org/draft/2020-12/schema",$id="https://json-schema.org/draft/2020-12/meta/validation",$vocabulary={"https://json-schema.org/draft/2020-12/vocab/validation":!0},$dynamicAnchor="meta",title="Validation vocabulary meta-schema",type=["object","boolean"],properties={type:{anyOf:[{$ref:"#/$defs/simpleTypes"},{type:"array",items:{$ref:"#/$defs/simpleTypes"},minItems:1,uniqueItems:!0}]},const:!0,enum:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/$defs/nonNegativeInteger"},minLength:{$ref:"#/$defs/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},maxItems:{$ref:"#/$defs/nonNegativeInteger"},minItems:{$ref:"#/$defs/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},maxContains:{$ref:"#/$defs/nonNegativeInteger"},minContains:{$ref:"#/$defs/nonNegativeInteger",default:1},maxProperties:{$ref:"#/$defs/nonNegativeInteger"},minProperties:{$ref:"#/$defs/nonNegativeIntegerDefault0"},required:{$ref:"#/$defs/stringArray"},dependentRequired:{type:"object",additionalProperties:{$ref:"#/$defs/stringArray"}}},$defs={nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{$ref:"#/$defs/nonNegativeInteger",default:0},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},require$$7={$schema,$id,$vocabulary,$dynamicAnchor,title,type,properties,$defs};Object.defineProperty(jsonSchema202012,"__esModule",{value:!0});const metaSchema=require$$0,applicator=require$$1,unevaluated=require$$2,content=require$$3,core=require$$4,format$1=require$$5,metadata=require$$6,validation=require$$7,META_SUPPORT_DATA=["/properties"];function addMetaSchema2020(xt){return[metaSchema,applicator,unevaluated,content,core,e(this,format$1),metadata,e(this,validation)].forEach(At=>this.addMetaSchema(At,void 0,!1)),this;function e(At,kt){return xt?At.$dataMetaSchema(kt,META_SUPPORT_DATA):kt}}jsonSchema202012.default=addMetaSchema2020;(function(xt,e){Object.defineProperty(e,"__esModule",{value:!0}),e.MissingRefError=e.ValidationError=e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;const At=core$3,kt=draft2020,Bt=discriminator,Nt=jsonSchema202012,jt="https://json-schema.org/draft/2020-12/schema";class Lt extends At.default{constructor(ir={}){super({...ir,dynamicRef:!0,next:!0,unevaluated:!0})}_addVocabularies(){super._addVocabularies(),kt.default.forEach(ir=>this.addVocabulary(ir)),this.opts.discriminator&&this.addKeyword(Bt.default)}_addDefaultMetaSchema(){super._addDefaultMetaSchema();const{$data:ir,meta:ar}=this.opts;ar&&(Nt.default.call(this,ir),this.refs["http://json-schema.org/schema"]=jt)}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(jt)?jt:void 0)}}xt.exports=e=Lt,Object.defineProperty(e,"__esModule",{value:!0}),e.default=Lt;var er=validate;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return er.KeywordCxt}});var tr=codegen;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return tr._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return tr.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return tr.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return tr.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return tr.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return tr.CodeGen}});var zt=validation_error;Object.defineProperty(e,"ValidationError",{enumerable:!0,get:function(){return zt.default}});var rr=ref_error;Object.defineProperty(e,"MissingRefError",{enumerable:!0,get:function(){return rr.default}})})(_2020,_2020.exports);var _2020Exports=_2020.exports;const Ajv=getDefaultExportFromCjs(_2020Exports);var __awaiter$2R=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class ProtocolsGrantAuthorization{static authorizeConfigure(e){return __awaiter$2R(this,void 0,void 0,function*(){const{protocolsConfigureMessage:At,expectedGrantor:kt,expectedGrantee:Bt,permissionGrant:Nt,messageStore:jt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:At,expectedGrantor:kt,expectedGrantee:Bt,permissionGrant:Nt,messageStore:jt}),ProtocolsGrantAuthorization.verifyScope(At,Nt.scope)})}static authorizeQuery(e){var At;return __awaiter$2R(this,void 0,void 0,function*(){const{expectedGrantee:kt,expectedGrantor:Bt,incomingMessage:Nt,permissionGrant:jt,messageStore:Lt}=e;yield GrantAuthorization.performBaseValidation({incomingMessage:Nt,expectedGrantor:Bt,expectedGrantee:kt,permissionGrant:jt,messageStore:Lt});const tr=jt.scope.protocol,zt=(At=Nt.descriptor.filter)===null||At===void 0?void 0:At.protocol;if(tr!==void 0&&zt!==tr)throw new DwnError(DwnErrorCode.ProtocolsGrantAuthorizationQueryProtocolScopeMismatch,`Grant protocol scope ${tr} does not match protocol in message ${zt}`)})}static verifyScope(e,At){if(At.protocol!==void 0&&At.protocol!==e.descriptor.definition.protocol)throw new DwnError(DwnErrorCode.ProtocolsGrantAuthorizationScopeProtocolMismatch,"Grant scope specifies different protocol than what appears in the configure message.")}}var ProtocolActor;(function(xt){xt.Anyone="anyone",xt.Author="author",xt.Recipient="recipient"})(ProtocolActor||(ProtocolActor={}));var ProtocolAction;(function(xt){xt.CoDelete="co-delete",xt.CoPrune="co-prune",xt.CoUpdate="co-update",xt.Create="create",xt.Delete="delete",xt.Prune="prune",xt.Query="query",xt.Read="read",xt.Subscribe="subscribe",xt.Update="update"})(ProtocolAction||(ProtocolAction={}));var __awaiter$2Q=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$F=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class ProtocolsConfigure extends AbstractMessage{static parse(e){return __awaiter$2Q(this,void 0,void 0,function*(){return Message.validateJsonSchema(e),ProtocolsConfigure.validateProtocolDefinition(e.descriptor.definition),yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor),Time.validateTimestamp(e.descriptor.messageTimestamp),new ProtocolsConfigure(e)})}static create(e){var At;return __awaiter$2Q(this,void 0,void 0,function*(){const kt={interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure,messageTimestamp:(At=e.messageTimestamp)!==null&&At!==void 0?At:Time.getCurrentTimestamp(),definition:ProtocolsConfigure.normalizeDefinition(e.definition)},Bt=yield Message.createAuthorization({descriptor:kt,signer:e.signer,delegatedGrant:e.delegatedGrant,permissionGrantId:e.permissionGrantId}),Nt={descriptor:kt,authorization:Bt};return Message.validateJsonSchema(Nt),ProtocolsConfigure.validateProtocolDefinition(Nt.descriptor.definition),new ProtocolsConfigure(Nt)})}authorizeAuthorDelegate(e){return __awaiter$2Q(this,void 0,void 0,function*(){const At=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield ProtocolsGrantAuthorization.authorizeConfigure({protocolsConfigureMessage:this.message,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:At,messageStore:e})})}static validateProtocolDefinition(e){const{protocol:At,types:kt}=e;validateProtocolUrlNormalized(At);for(const Bt in kt){const Nt=kt[Bt].schema;Nt!==void 0&&validateSchemaUrlNormalized(Nt)}ProtocolsConfigure.validateStructure(e)}static validateStructure(e){const At=Object.keys(e.types),kt=ProtocolsConfigure.fetchAllRolePathsRecursively("",e.structure,[]);ProtocolsConfigure.validateRuleSetRecursively({ruleSet:e.structure,ruleSetProtocolPath:"",recordTypes:At,roles:kt})}static fetchAllRolePathsRecursively(e,At,kt){if(e.split("/").length>10)throw new DwnError(DwnErrorCode.ProtocolsConfigureRecordNestingDepthExceeded,"Record nesting depth exceeded 10 levels.");for(const Bt in At){if(Bt.startsWith("$"))continue;const Nt=At[Bt];let jt;e===""?jt=Bt:jt=`${e}/${Bt}`,Nt.$role?kt.push(jt):ProtocolsConfigure.fetchAllRolePathsRecursively(jt,Nt,kt)}return kt}static validateRuleSetRecursively(e){var At;const{ruleSet:kt,ruleSetProtocolPath:Bt,recordTypes:Nt,roles:jt}=e;if(kt.$size!==void 0){const{min:er=0,max:tr}=kt.$size;if(tr!==void 0&&tr<er)throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidSize,`Invalid size range found: max limit ${tr} less than min limit ${er} at protocol path '${Bt}'`)}if(kt.$tags){const er=new Ajv.default,tr=kt.$tags,zt=__rest$F(tr,["$allowUndefinedTags","$requiredTags"]);for(const rr in zt){const nr=zt[rr];if(!er.validateSchema(nr)){const ir=er.errorsText(er.errors,{dataVar:`${Bt}/$tags/${rr}`});throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidTagSchema,`tags schema validation error: ${ir}`)}}}const Lt=(At=kt.$actions)!==null&&At!==void 0?At:[];for(let er=0;er<Lt.length;er++){const tr=Lt[er];if(tr.role!==void 0&&!jt.includes(tr.role))throw new DwnError(DwnErrorCode.ProtocolsConfigureRoleDoesNotExistAtGivenPath,`Role in action ${JSON.stringify(tr)} for rule set ${Bt} does not exist.`);if(tr.who==="anyone"&&tr.of)throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidActionOfNotAllowed,`'of' is not allowed at rule set protocol path (${Bt})`);if(tr.who===ProtocolActor.Recipient&&tr.of===void 0&&tr.can.some(rr=>![ProtocolAction.CoUpdate,ProtocolAction.CoDelete,ProtocolAction.CoPrune].includes(rr)))throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidRecipientOfAction,"Rules for `recipient` without `of` property must have `can` containing only `co-update`, `co-delete`, and `co-prune`.");if(tr.who===ProtocolActor.Author&&!tr.of)throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidActionMissingOf,"'of' is required when 'author' is specified as 'who'");if(tr.can!==void 0){if(tr.can.includes(ProtocolAction.Update)&&!tr.can.includes(ProtocolAction.Create))throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidActionUpdateWithoutCreate,`Action rule ${JSON.stringify(tr)} contains 'update' action but missing the required 'create' action.`);if(tr.can.includes(ProtocolAction.Delete)&&!tr.can.includes(ProtocolAction.Create))throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidActionDeleteWithoutCreate,`Action rule ${JSON.stringify(tr)} contains 'delete' action but missing the required 'create' action.`)}for(let zt=er+1;zt<Lt.length;zt++){const rr=Lt[zt];if(tr.who!==void 0){if(tr.who===rr.who&&tr.of===rr.of)throw new DwnError(DwnErrorCode.ProtocolsConfigureDuplicateActorInRuleSet,`More than one action rule per actor ${tr.who} of ${tr.of} not allowed within a rule set: ${JSON.stringify(tr)}`)}else if(tr.role===rr.role)throw new DwnError(DwnErrorCode.ProtocolsConfigureDuplicateRoleInRuleSet,`More than one action rule per role ${tr.role} not allowed within a rule set: ${JSON.stringify(tr)}`)}}for(const er in kt){if(er.startsWith("$"))continue;if(!Nt.includes(er))throw new DwnError(DwnErrorCode.ProtocolsConfigureInvalidRuleSetRecordType,`Rule set ${er} is not declared as an allowed type in the protocol definition.`);const tr=kt[er];let zt;Bt===""?zt=er:zt=`${Bt}/${er}`,ProtocolsConfigure.validateRuleSetRecursively({ruleSet:tr,ruleSetProtocolPath:zt,recordTypes:Nt,roles:jt})}}static normalizeDefinition(e){const At=Object.assign({},e.types);for(const kt in At){const Bt=At[kt].schema;Bt!==void 0&&(At[kt].schema=normalizeSchemaUrl(Bt))}return Object.assign(Object.assign({},e),{protocol:normalizeProtocolUrl(e.protocol),types:At})}}var __awaiter$2P=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$E=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class ProtocolsConfigureHandler{constructor(e,At,kt,Bt){this.didResolver=e,this.messageStore=At,this.eventLog=kt,this.eventStream=Bt}handle({tenant:e,message:At}){return __awaiter$2P(this,void 0,void 0,function*(){let kt;try{kt=yield ProtocolsConfigure.parse(At)}catch(zt){return messageReplyFromError(zt,400)}try{yield authenticate(At.authorization,this.didResolver),yield ProtocolsConfigureHandler.authorizeProtocolsConfigure(e,kt,this.messageStore)}catch(zt){return messageReplyFromError(zt,401)}const Bt={interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure,protocol:At.descriptor.definition.protocol},{messages:Nt}=yield this.messageStore.query(e,[Bt]);let jt=yield Message.getNewestMessage(Nt),Lt=!1;(jt===void 0||(yield Message.isNewer(At,jt)))&&(Lt=!0,jt=At);let er;if(Lt){const zt=ProtocolsConfigureHandler.constructIndexes(kt);yield this.messageStore.put(e,At,zt);const rr=yield Message.getCid(At);yield this.eventLog.append(e,rr,zt),this.eventStream!==void 0&&this.eventStream.emit(e,{message:At},zt),er={status:{code:202,detail:"Accepted"}}}else er={status:{code:409,detail:"Conflict"}};const tr=[];for(const zt of Nt)if(yield Message.isNewer(jt,zt)){const rr=yield Message.getCid(zt);tr.push(rr),yield this.messageStore.delete(e,rr)}return yield this.eventLog.deleteEventsByCid(e,tr),er})}static constructIndexes(e){const At=e.message.descriptor,{definition:kt}=At,Bt=__rest$E(At,["definition"]),{author:Nt}=e;return Object.assign(Object.assign({},Bt),{author:Nt,protocol:kt.protocol,published:kt.published})}static authorizeProtocolsConfigure(e,At,kt){return __awaiter$2P(this,void 0,void 0,function*(){if(At.isSignedByAuthorDelegate&&(yield At.authorizeAuthorDelegate(kt)),At.author!==e)if(At.author!==void 0&&At.signaturePayload.permissionGrantId!==void 0){const Bt=yield PermissionsProtocol.fetchGrant(e,kt,At.signaturePayload.permissionGrantId);yield ProtocolsGrantAuthorization.authorizeConfigure({protocolsConfigureMessage:At.message,expectedGrantor:e,expectedGrantee:At.author,permissionGrant:Bt,messageStore:kt})}else throw new DwnError(DwnErrorCode.ProtocolsConfigureAuthorizationFailed,"message failed authorization")})}}var __awaiter$2O=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class ProtocolsQuery extends AbstractMessage{static parse(e){return __awaiter$2O(this,void 0,void 0,function*(){return e.authorization!==void 0&&(yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor)),e.descriptor.filter!==void 0&&validateProtocolUrlNormalized(e.descriptor.filter.protocol),Time.validateTimestamp(e.descriptor.messageTimestamp),new ProtocolsQuery(e)})}static create(e){var At;return __awaiter$2O(this,void 0,void 0,function*(){const kt={interface:DwnInterfaceName.Protocols,method:DwnMethodName.Query,messageTimestamp:(At=e.messageTimestamp)!==null&&At!==void 0?At:Time.getCurrentTimestamp(),filter:e.filter?ProtocolsQuery.normalizeFilter(e.filter):void 0};removeUndefinedProperties$3(kt);let Bt;e.signer!==void 0&&(Bt=yield Message.createAuthorization({descriptor:kt,signer:e.signer,permissionGrantId:e.permissionGrantId}));const Nt={descriptor:kt,authorization:Bt};return Message.validateJsonSchema(Nt),new ProtocolsQuery(Nt)})}static normalizeFilter(e){return Object.assign(Object.assign({},e),{protocol:normalizeProtocolUrl(e.protocol)})}authorize(e,At){return __awaiter$2O(this,void 0,void 0,function*(){if(this.author!==e)if(this.author!==void 0&&this.signaturePayload.permissionGrantId){const kt=yield PermissionsProtocol.fetchGrant(e,At,this.signaturePayload.permissionGrantId);yield ProtocolsGrantAuthorization.authorizeQuery({expectedGrantor:e,expectedGrantee:this.author,incomingMessage:this.message,permissionGrant:kt,messageStore:At})}else throw new DwnError(DwnErrorCode.ProtocolsQueryUnauthorized,"The ProtocolsQuery failed authorization")})}}var __awaiter$2N=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class ProtocolsQueryHandler{constructor(e,At,kt){this.didResolver=e,this.messageStore=At,this.dataStore=kt}handle({tenant:e,message:At}){return __awaiter$2N(this,void 0,void 0,function*(){let kt;try{kt=yield ProtocolsQuery.parse(At)}catch(jt){return messageReplyFromError(jt,400)}try{yield authenticate(At.authorization,this.didResolver),yield kt.authorize(e,this.messageStore)}catch(jt){if(jt.code===DwnErrorCode.AuthenticateJwsMissing||jt.code===DwnErrorCode.ProtocolsQueryUnauthorized||jt.code===DwnErrorCode.ProtocolsGrantAuthorizationQueryProtocolScopeMismatch){const Lt=yield this.fetchPublishedProtocolsConfigure(e,kt);return{status:{code:200,detail:"OK"},entries:Lt}}else return messageReplyFromError(jt,401)}const Bt=Object.assign(Object.assign({},At.descriptor.filter),{interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure});removeUndefinedProperties$3(Bt);const{messages:Nt}=yield this.messageStore.query(e,[Bt]);return{status:{code:200,detail:"OK"},entries:Nt}})}fetchPublishedProtocolsConfigure(e,At){return __awaiter$2N(this,void 0,void 0,function*(){const kt=Object.assign(Object.assign({},At.message.descriptor.filter),{interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure,published:!0}),{messages:Bt}=yield this.messageStore.query(e,[kt]);return Bt})}}var __awaiter$2M=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$D=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class ProtocolAuthorization{static validateReferentialIntegrity(e,At,kt){return __awaiter$2M(this,void 0,void 0,function*(){const Bt=yield ProtocolAuthorization.fetchProtocolDefinition(e,At.message.descriptor.protocol,kt);ProtocolAuthorization.verifyType(At.message,Bt.types),yield ProtocolAuthorization.verifyProtocolPathAndContextId(e,At,kt);const Nt=ProtocolAuthorization.getRuleSet(At.message.descriptor.protocolPath,Bt);yield ProtocolAuthorization.verifyAsRoleRecordIfNeeded(e,At,Nt,kt),ProtocolAuthorization.verifySizeLimit(At,Nt),ProtocolAuthorization.verifyTagsIfNeeded(At,Nt)})}static authorizeWrite(e,At,kt){return __awaiter$2M(this,void 0,void 0,function*(){const Bt=yield ProtocolAuthorization.fetchInitialWrite(e,At.message.recordId,kt);let Nt;Bt===void 0?Nt=yield ProtocolAuthorization.constructRecordChain(e,At.message.descriptor.parentId,kt):Nt=yield ProtocolAuthorization.constructRecordChain(e,At.message.recordId,kt);const jt=yield ProtocolAuthorization.fetchProtocolDefinition(e,At.message.descriptor.protocol,kt),Lt=ProtocolAuthorization.getRuleSet(At.message.descriptor.protocolPath,jt);yield ProtocolAuthorization.verifyInvokedRole(e,At,At.message.descriptor.protocol,At.message.contextId,jt,kt),yield ProtocolAuthorization.authorizeAgainstAllowedActions(e,At,Lt,Nt,kt)})}static authorizeRead(e,At,kt,Bt){return __awaiter$2M(this,void 0,void 0,function*(){const Nt=yield ProtocolAuthorization.constructRecordChain(e,kt.message.recordId,Bt),jt=yield ProtocolAuthorization.fetchProtocolDefinition(e,kt.message.descriptor.protocol,Bt),Lt=ProtocolAuthorization.getRuleSet(kt.message.descriptor.protocolPath,jt);yield ProtocolAuthorization.verifyInvokedRole(e,At,kt.message.descriptor.protocol,kt.message.contextId,jt,Bt),yield ProtocolAuthorization.authorizeAgainstAllowedActions(e,At,Lt,Nt,Bt)})}static authorizeQueryOrSubscribe(e,At,kt){return __awaiter$2M(this,void 0,void 0,function*(){const{protocol:Bt,protocolPath:Nt,contextId:jt}=At.message.descriptor.filter,Lt=yield ProtocolAuthorization.fetchProtocolDefinition(e,Bt,kt),er=ProtocolAuthorization.getRuleSet(Nt,Lt);yield ProtocolAuthorization.verifyInvokedRole(e,At,Bt,jt,Lt,kt),yield ProtocolAuthorization.authorizeAgainstAllowedActions(e,At,er,[],kt)})}static authorizeDelete(e,At,kt,Bt){return __awaiter$2M(this,void 0,void 0,function*(){const Nt=yield ProtocolAuthorization.constructRecordChain(e,At.message.descriptor.recordId,Bt),jt=yield ProtocolAuthorization.fetchProtocolDefinition(e,kt.message.descriptor.protocol,Bt),Lt=ProtocolAuthorization.getRuleSet(kt.message.descriptor.protocolPath,jt);yield ProtocolAuthorization.verifyInvokedRole(e,At,kt.message.descriptor.protocol,kt.message.contextId,jt,Bt),yield ProtocolAuthorization.authorizeAgainstAllowedActions(e,At,Lt,Nt,Bt)})}static fetchProtocolDefinition(e,At,kt){return __awaiter$2M(this,void 0,void 0,function*(){if(At===PermissionsProtocol.uri)return PermissionsProtocol.definition;const Bt={interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure,protocol:At},{messages:Nt}=yield kt.query(e,[Bt]);if(Nt.length===0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationProtocolNotFound,`unable to find protocol definition for ${At}`);return Nt[0].descriptor.definition})}static constructRecordChain(e,At,kt){return __awaiter$2M(this,void 0,void 0,function*(){if(At===void 0)return[];const Bt=[];let Nt=At;for(;Nt!==void 0;){const jt=yield ProtocolAuthorization.fetchInitialWrite(e,Nt,kt);if(jt===void 0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationParentNotFoundConstructingRecordChain,`Unexpected error that should never trigger: no parent found with ID ${Nt} when constructing record chain.`);Bt.push(jt),Nt=jt.descriptor.parentId}return Bt.reverse()})}static fetchInitialWrite(e,At,kt){return __awaiter$2M(this,void 0,void 0,function*(){const Bt={interface:DwnInterfaceName.Records,method:DwnMethodName.Write,recordId:At},{messages:Nt}=yield kt.query(e,[Bt]);return Nt.length===0?void 0:yield RecordsWrite.getInitialWrite(Nt)})}static getRuleSet(e,At){const kt=ProtocolAuthorization.getRuleSetAtProtocolPath(e,At);if(kt===void 0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationMissingRuleSet,`No rule set defined for protocolPath ${e}`);return kt}static verifyProtocolPathAndContextId(e,At,kt){var Bt;return __awaiter$2M(this,void 0,void 0,function*(){const Nt=At.message.descriptor.protocolPath,jt=ProtocolAuthorization.getTypeName(Nt),Lt=At.message.descriptor.parentId;if(Lt===void 0){if(Nt!==jt)throw new DwnError(DwnErrorCode.ProtocolAuthorizationParentlessIncorrectProtocolPath,`Declared protocol path '${Nt}' is not valid for records with no parent'.`);return}const er=At.message.descriptor.protocol,tr={isLatestBaseState:!0,interface:DwnInterfaceName.Records,method:DwnMethodName.Write,protocol:er,recordId:Lt},{messages:zt}=yield kt.query(e,[tr]),rr=zt[0];if(`${(Bt=rr==null?void 0:rr.descriptor)===null||Bt===void 0?void 0:Bt.protocolPath}/${jt}`!==Nt)throw new DwnError(DwnErrorCode.ProtocolAuthorizationIncorrectProtocolPath,`Could not find matching parent record to verify declared protocol path '${Nt}'.`);const ar=`${rr.contextId}/${At.message.recordId}`,dr=At.message.contextId;if(dr!==ar)throw new DwnError(DwnErrorCode.ProtocolAuthorizationIncorrectContextId,`Declared contextId '${dr}' is not the same as expected: '${ar}'.`)})}static verifyType(e,At){const kt=Object.keys(At),Bt=e.descriptor.protocolPath,Nt=ProtocolAuthorization.getTypeName(Bt);if(!kt.includes(Nt))throw new DwnError(DwnErrorCode.ProtocolAuthorizationInvalidType,`record with type ${Nt} not allowed in protocol`);const jt=e.descriptor.protocolPath,Lt=ProtocolAuthorization.getTypeName(jt),er=At[Lt],{schema:tr}=e.descriptor;if(er.schema!==void 0&&er.schema!==tr)throw new DwnError(DwnErrorCode.ProtocolAuthorizationInvalidSchema,`type '${Lt}' must have schema '${er.schema}',         instead has '${tr}'`);const{dataFormat:zt}=e.descriptor;if(er.dataFormats!==void 0&&!er.dataFormats.includes(zt))throw new DwnError(DwnErrorCode.ProtocolAuthorizationIncorrectDataFormat,`type '${Lt}' must have data format in (${er.dataFormats}),         instead has '${zt}'`)}static verifyInvokedRole(e,At,kt,Bt,Nt,jt){var Lt;return __awaiter$2M(this,void 0,void 0,function*(){const er=(Lt=At.signaturePayload)===null||Lt===void 0?void 0:Lt.protocolRole;if(er===void 0)return;const tr=ProtocolAuthorization.getRuleSetAtProtocolPath(er,Nt);if(tr===void 0||!tr.$role)throw new DwnError(DwnErrorCode.ProtocolAuthorizationNotARole,`Protocol path ${er} does not match role record type.`);const zt={interface:DwnInterfaceName.Records,method:DwnMethodName.Write,protocol:kt,protocolPath:er,recipient:At.author,isLatestBaseState:!0},rr=er.split("/").length-1;if(Bt===void 0&&rr>0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationMissingContextId,"Could not verify role because contextId is missing.");if(rr>0){const ar=Bt.split("/").slice(0,rr).join("/"),dr=FilterUtility.constructPrefixFilterAsRangeFilter(ar);zt.contextId=dr}const{messages:nr}=yield jt.query(e,[zt]);if(nr.length===0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationMatchingRoleRecordNotFound,`No matching role record found for protocol path ${er}`)})}static getActionsSeekingARuleMatch(e,At,kt){return __awaiter$2M(this,void 0,void 0,function*(){switch(At.message.descriptor.method){case DwnMethodName.Delete:const Bt=At,Nt=Bt.message.descriptor.recordId,jt=yield RecordsWrite.fetchInitialRecordsWrite(kt,e,Nt);if(jt===void 0)return[];const Lt=[];return Bt.message.descriptor.prune?(Lt.push(ProtocolAction.CoPrune),At.author===jt.author&&Lt.push(ProtocolAction.Prune)):(Lt.push(ProtocolAction.CoDelete),At.author===jt.author&&Lt.push(ProtocolAction.Delete)),Lt;case DwnMethodName.Query:return[ProtocolAction.Query];case DwnMethodName.Read:return[ProtocolAction.Read];case DwnMethodName.Subscribe:return[ProtocolAction.Subscribe];case DwnMethodName.Write:if(yield At.isInitialWrite())return[ProtocolAction.Create];{const zt=At.message.recordId,rr=yield RecordsWrite.fetchInitialRecordsWrite(kt,e,zt);return rr===void 0?[]:At.author===rr.author?[ProtocolAction.CoUpdate,ProtocolAction.Update]:[ProtocolAction.CoUpdate]}}return[]})}static authorizeAgainstAllowedActions(e,At,kt,Bt,Nt){var jt;return __awaiter$2M(this,void 0,void 0,function*(){const Lt=At.message.descriptor.method,er=yield ProtocolAuthorization.getActionsSeekingARuleMatch(e,At,Nt),tr=At.author,zt=kt.$actions;if(zt===void 0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationActionRulesNotFound,`no action rule defined for Records${Lt}, ${tr} is unauthorized`);const rr=(jt=At.signaturePayload)===null||jt===void 0?void 0:jt.protocolRole;for(const nr of zt){if(!nr.can.some(dr=>er.includes(dr)))continue;if(nr.who===ProtocolActor.Anyone)return;if(tr===void 0)continue;if(rr!==void 0){if(nr.role===rr)return;continue}if(nr.who===ProtocolActor.Recipient&&nr.of===void 0){let dr;if(At.message.descriptor.method===DwnMethodName.Write?dr=At.message:dr=Bt[Bt.length-1],dr.descriptor.recipient===tr)return;continue}if(yield ProtocolAuthorization.checkActor(tr,nr,Bt))return}throw new DwnError(DwnErrorCode.ProtocolAuthorizationActionNotAllowed,`Inbound message action Records${Lt} by author ${At.author} not allowed.`)})}static verifySizeLimit(e,At){const{min:kt=0,max:Bt}=At.$size||{},Nt=e.message.descriptor.dataSize;if(Nt<kt)throw new DwnError(DwnErrorCode.ProtocolAuthorizationMinSizeInvalid,`data size ${Nt} is less than allowed ${kt}`);if(Bt!==void 0&&Nt>Bt)throw new DwnError(DwnErrorCode.ProtocolAuthorizationMaxSizeInvalid,`data size ${Nt} is more than allowed ${Bt}`)}static verifyTagsIfNeeded(e,At){if(At.$tags!==void 0){const{tags:kt={},protocol:Bt,protocolPath:Nt}=e.message.descriptor,jt=At.$tags,{$allowUndefinedTags:Lt,$requiredTags:er}=jt,tr=__rest$D(jt,["$allowUndefinedTags","$requiredTags"]),zt=Lt||!1,rr=er||[],nr=new Ajv.default,ir=nr.compile({type:"object",properties:tr,required:rr,additionalProperties:zt});if(!ir(kt)){const dr=nr.errorsText(ir.errors,{dataVar:`${Bt}/${Nt}/$tags`});throw new DwnError(DwnErrorCode.ProtocolAuthorizationTagsInvalidSchema,`tags schema validation error: ${dr}`)}}}static verifyAsRoleRecordIfNeeded(e,At,kt,Bt){return __awaiter$2M(this,void 0,void 0,function*(){if(!kt.$role)return;const Nt=At,jt=Nt.message.descriptor.recipient;if(jt===void 0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationRoleMissingRecipient,"Role records must have a recipient");const Lt=Nt.message.descriptor.protocolPath,er={interface:DwnInterfaceName.Records,method:DwnMethodName.Write,isLatestBaseState:!0,protocol:Nt.message.descriptor.protocol,protocolPath:Lt,recipient:jt},tr=Records.getParentContextFromOfContextId(Nt.message.contextId);if(tr!==""){const ir=FilterUtility.constructPrefixFilterAsRangeFilter(tr);er.contextId=ir}const{messages:zt}=yield Bt.query(e,[er]);if(zt.filter(ir=>ir.recordId!==Nt.message.recordId).length>0)throw new DwnError(DwnErrorCode.ProtocolAuthorizationDuplicateRoleRecipient,`DID '${jt}' is already recipient of a role record at protocol path '${Lt} under the parent context ${tr}.`)})}static getRuleSetAtProtocolPath(e,At){const kt=e.split("/");let Bt=At.structure,Nt=0;for(;Nt<kt.length;){const jt=kt[Nt],Lt=Bt[jt];if(Lt===void 0)return;Bt=Lt,Nt++}return Bt}static checkActor(e,At,kt){return __awaiter$2M(this,void 0,void 0,function*(){const Bt=kt.find(Nt=>Nt.descriptor.protocolPath===At.of);if(Bt===void 0)return!1;if(At.who===ProtocolActor.Recipient)return e===Bt.descriptor.recipient;{const Nt=(yield RecordsWrite.parse(Bt)).author;return e===Nt}})}static getTypeName(e){return e.split("/").slice(-1)[0]}}var __awaiter$2L=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class RecordsDelete extends AbstractMessage{static parse(e){return __awaiter$2L(this,void 0,void 0,function*(){let At;return e.authorization!==void 0&&(At=yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield Records.validateDelegatedGrantReferentialIntegrity(e,At),Time.validateTimestamp(e.descriptor.messageTimestamp),new RecordsDelete(e)})}static create(e){var At,kt;return __awaiter$2L(this,void 0,void 0,function*(){const Bt=e.recordId,Nt=Time.getCurrentTimestamp(),jt={interface:DwnInterfaceName.Records,method:DwnMethodName.Delete,messageTimestamp:(At=e.messageTimestamp)!==null&&At!==void 0?At:Nt,recordId:Bt,prune:(kt=e.prune)!==null&&kt!==void 0?kt:!1},Lt=yield Message.createAuthorization({descriptor:jt,signer:e.signer,protocolRole:e.protocolRole,delegatedGrant:e.delegatedGrant}),er={descriptor:jt,authorization:Lt};return Message.validateJsonSchema(er),new RecordsDelete(er)})}constructIndexes(e){const At=this.message,kt=Object.assign({},At.descriptor),{protocol:Bt,protocolPath:Nt,recipient:jt,schema:Lt,parentId:er,dateCreated:tr}=e.descriptor,zt=Object.assign({protocol:Bt,protocolPath:Nt,recipient:jt,schema:Lt,parentId:er,dateCreated:tr,contextId:e.contextId,author:this.author},kt);return removeUndefinedProperties$3(zt),zt}authorizeDelegate(e,At){return __awaiter$2L(this,void 0,void 0,function*(){const kt=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield RecordsGrantAuthorization.authorizeDelete({recordsDeleteMessage:this.message,recordsWriteToDelete:e,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:kt,messageStore:At})})}}var __awaiter$2K=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},ResumableTaskName;(function(xt){xt.RecordsDelete="RecordsDelete"})(ResumableTaskName||(ResumableTaskName={}));class ResumableTaskManager{constructor(e,At){this.resumableTaskStore=e,this.resumableTaskBatchSize=100,this.resumableTaskHandlers={[ResumableTaskName.RecordsDelete]:kt=>__awaiter$2K(this,void 0,void 0,function*(){return yield At.performRecordsDelete(kt)})}}run(e){return __awaiter$2K(this,void 0,void 0,function*(){const At=ResumableTaskManager.timeoutExtensionFrequencyInSeconds*2,kt=yield this.resumableTaskStore.register(e,At);yield this.runWithAutomaticTimeoutExtension(kt)})}runWithAutomaticTimeoutExtension(e){return __awaiter$2K(this,void 0,void 0,function*(){const At=ResumableTaskManager.timeoutExtensionFrequencyInSeconds*2;let kt;try{kt=setInterval(()=>{this.resumableTaskStore.extend(e.id,At)},ResumableTaskManager.timeoutExtensionFrequencyInSeconds*1e3);const Bt=this.resumableTaskHandlers[e.task.name];yield Bt(e.task.data),yield this.resumableTaskStore.delete(e.id)}finally{ResumableTaskManager.clearTimeoutExtensionTimer(kt)}})}static clearTimeoutExtensionTimer(e){clearInterval(e)}resumeTasksAndWaitForCompletion(){return __awaiter$2K(this,void 0,void 0,function*(){for(;;){const e=yield this.resumableTaskStore.grab(this.resumableTaskBatchSize);if(e===void 0||e.length===0)break;yield this.retryTasksUntilCompletion(e)}})}retryTasksUntilCompletion(e){return __awaiter$2K(this,void 0,void 0,function*(){let At=e;for(;At.length>0;){const kt=At;At=[];const Bt=kt.map(Nt=>__awaiter$2K(this,void 0,void 0,function*(){try{yield this.runWithAutomaticTimeoutExtension(Nt)}catch(jt){console.error("Error while running resumable task:",jt),console.error("Resumable task:",e),At.push(Nt)}}));yield Promise.all(Bt)}})}}ResumableTaskManager.timeoutExtensionFrequencyInSeconds=30;var __awaiter$2J=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class RecordsDeleteHandler{constructor(e,At,kt){this.didResolver=e,this.messageStore=At,this.resumableTaskManager=kt}handle({tenant:e,message:At}){return __awaiter$2J(this,void 0,void 0,function*(){let kt;try{kt=yield RecordsDelete.parse(At)}catch(tr){return messageReplyFromError(tr,400)}try{yield authenticate(At.authorization,this.didResolver)}catch(tr){return messageReplyFromError(tr,401)}const Bt={interface:DwnInterfaceName.Records,recordId:At.descriptor.recordId},{messages:Nt}=yield this.messageStore.query(e,[Bt]),jt=yield Message.getNewestMessage(Nt);if(!Records.canPerformDeleteAgainstRecord(At,jt))return{status:{code:404,detail:"Not Found"}};if(!(yield Message.isNewer(At,jt)))return{status:{code:409,detail:"Conflict"}};try{const tr=yield RecordsWrite.fetchInitialRecordsWrite(this.messageStore,e,At.descriptor.recordId);yield RecordsDeleteHandler.authorizeRecordsDelete(e,kt,tr,this.messageStore)}catch(tr){return messageReplyFromError(tr,401)}return yield this.resumableTaskManager.run({name:ResumableTaskName.RecordsDelete,data:{tenant:e,message:At}}),{status:{code:202,detail:"Accepted"}}})}static authorizeRecordsDelete(e,At,kt,Bt){return __awaiter$2J(this,void 0,void 0,function*(){if(Message.isSignedByAuthorDelegate(At.message)&&(yield At.authorizeDelegate(kt.message,Bt)),At.author!==e)if(kt.message.descriptor.protocol!==void 0)yield ProtocolAuthorization.authorizeDelete(e,At,kt,Bt);else throw new DwnError(DwnErrorCode.RecordsDeleteAuthorizationFailed,"RecordsDelete message failed authorization")})}}var SortDirection;(function(xt){xt[xt.Descending=-1]="Descending",xt[xt.Ascending=1]="Ascending"})(SortDirection||(SortDirection={}));var __awaiter$2I=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class RecordsQueryHandler{constructor(e,At,kt){this.didResolver=e,this.messageStore=At,this.dataStore=kt}handle({tenant:e,message:At}){return __awaiter$2I(this,void 0,void 0,function*(){let kt;try{kt=yield RecordsQuery.parse(At)}catch(jt){return messageReplyFromError(jt,400)}let Bt,Nt;if(Records.filterIncludesPublishedRecords(kt.message.descriptor.filter)&&kt.author===void 0){const jt=yield this.fetchPublishedRecords(e,kt);Bt=jt.messages,Nt=jt.cursor}else{try{yield authenticate(At.authorization,this.didResolver),yield RecordsQueryHandler.authorizeRecordsQuery(e,kt,this.messageStore)}catch(jt){return messageReplyFromError(jt,401)}if(kt.author===e){const jt=yield this.fetchRecordsAsOwner(e,kt);Bt=jt.messages,Nt=jt.cursor}else{const jt=yield this.fetchRecordsAsNonOwner(e,kt);Bt=jt.messages,Nt=jt.cursor}}for(const jt of Bt)if(!(yield RecordsWrite.isInitialWrite(jt))){const er=(yield this.messageStore.query(e,[{recordId:jt.recordId,isLatestBaseState:!1,method:DwnMethodName.Write}])).messages[0];delete er.encodedData,jt.initialWrite=er}return{status:{code:200,detail:"OK"},entries:Bt,cursor:Nt}})}convertDateSort(e){switch(e){case DateSort.CreatedAscending:return{dateCreated:SortDirection.Ascending};case DateSort.CreatedDescending:return{dateCreated:SortDirection.Descending};case DateSort.PublishedAscending:return{datePublished:SortDirection.Ascending};case DateSort.PublishedDescending:return{datePublished:SortDirection.Descending};default:return{dateCreated:SortDirection.Ascending}}}fetchRecordsAsOwner(e,At){return __awaiter$2I(this,void 0,void 0,function*(){const{dateSort:kt,filter:Bt,pagination:Nt}=At.message.descriptor,jt=Object.assign(Object.assign({},Records.convertFilter(Bt,kt)),{interface:DwnInterfaceName.Records,method:DwnMethodName.Write,isLatestBaseState:!0}),Lt=this.convertDateSort(kt);return this.messageStore.query(e,[jt],Lt,Nt)})}fetchRecordsAsNonOwner(e,At){return __awaiter$2I(this,void 0,void 0,function*(){const{dateSort:kt,pagination:Bt,filter:Nt}=At.message.descriptor,jt=[];Records.filterIncludesPublishedRecords(Nt)&&jt.push(RecordsQueryHandler.buildPublishedRecordsFilter(At)),Records.filterIncludesUnpublishedRecords(Nt)&&(Records.shouldBuildUnpublishedAuthorFilter(Nt,At.author)&&jt.push(RecordsQueryHandler.buildUnpublishedRecordsByQueryAuthorFilter(At)),Records.shouldProtocolAuthorize(At.signaturePayload)&&jt.push(RecordsQueryHandler.buildUnpublishedProtocolAuthorizedRecordsFilter(At)),Records.shouldBuildUnpublishedRecipientFilter(Nt,At.author)&&jt.push(RecordsQueryHandler.buildUnpublishedRecordsForQueryAuthorFilter(At)));const Lt=this.convertDateSort(kt);return this.messageStore.query(e,jt,Lt,Bt)})}fetchPublishedRecords(e,At){return __awaiter$2I(this,void 0,void 0,function*(){const{dateSort:kt,pagination:Bt}=At.message.descriptor,Nt=RecordsQueryHandler.buildPublishedRecordsFilter(At),jt=this.convertDateSort(kt);return this.messageStore.query(e,[Nt],jt,Bt)})}static buildPublishedRecordsFilter(e){const{dateSort:At,filter:kt}=e.message.descriptor;return Object.assign(Object.assign({},Records.convertFilter(kt,At)),{interface:DwnInterfaceName.Records,method:DwnMethodName.Write,published:!0,isLatestBaseState:!0})}static buildUnpublishedRecordsForQueryAuthorFilter(e){const{dateSort:At,filter:kt}=e.message.descriptor;return Object.assign(Object.assign({},Records.convertFilter(kt,At)),{interface:DwnInterfaceName.Records,method:DwnMethodName.Write,recipient:e.author,isLatestBaseState:!0,published:!1})}static buildUnpublishedProtocolAuthorizedRecordsFilter(e){const{dateSort:At,filter:kt}=e.message.descriptor;return Object.assign(Object.assign({},Records.convertFilter(kt,At)),{interface:DwnInterfaceName.Records,method:DwnMethodName.Write,isLatestBaseState:!0,published:!1})}static buildUnpublishedRecordsByQueryAuthorFilter(e){const{dateSort:At,filter:kt}=e.message.descriptor;return Object.assign(Object.assign({},Records.convertFilter(kt,At)),{author:e.author,interface:DwnInterfaceName.Records,method:DwnMethodName.Write,isLatestBaseState:!0,published:!1})}static authorizeRecordsQuery(e,At,kt){return __awaiter$2I(this,void 0,void 0,function*(){Message.isSignedByAuthorDelegate(At.message)&&(yield At.authorizeDelegate(kt)),Records.shouldProtocolAuthorize(At.signaturePayload)&&(yield ProtocolAuthorization.authorizeQueryOrSubscribe(e,At,kt))})}}var __awaiter$2H=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class RecordsRead extends AbstractMessage{static parse(e){return __awaiter$2H(this,void 0,void 0,function*(){let At;return e.authorization!==void 0&&(At=yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield Records.validateDelegatedGrantReferentialIntegrity(e,At),Time.validateTimestamp(e.descriptor.messageTimestamp),new RecordsRead(e)})}static create(e){var At;return __awaiter$2H(this,void 0,void 0,function*(){const{filter:kt,signer:Bt,permissionGrantId:Nt,protocolRole:jt}=e,Lt=Time.getCurrentTimestamp(),er={interface:DwnInterfaceName.Records,method:DwnMethodName.Read,filter:Records.normalizeFilter(kt),messageTimestamp:(At=e.messageTimestamp)!==null&&At!==void 0?At:Lt};removeUndefinedProperties$3(er);let tr;Bt!==void 0&&(tr=yield Message.createAuthorization({descriptor:er,signer:Bt,permissionGrantId:Nt,protocolRole:jt,delegatedGrant:e.delegatedGrant}));const zt={descriptor:er,authorization:tr};return Message.validateJsonSchema(zt),new RecordsRead(zt)})}authorizeDelegate(e,At){return __awaiter$2H(this,void 0,void 0,function*(){const kt=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield RecordsGrantAuthorization.authorizeRead({recordsReadMessage:this.message,recordsWriteMessageToBeRead:e,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:kt,messageStore:At})})}}var __awaiter$2G=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class RecordsReadHandler{constructor(e,At,kt){this.didResolver=e,this.messageStore=At,this.dataStore=kt}handle({tenant:e,message:At}){return __awaiter$2G(this,void 0,void 0,function*(){let kt;try{kt=yield RecordsRead.parse(At)}catch(zt){return messageReplyFromError(zt,400)}try{kt.author!==void 0&&(yield authenticate(At.authorization,this.didResolver))}catch(zt){return messageReplyFromError(zt,401)}const Bt=Object.assign({interface:DwnInterfaceName.Records,isLatestBaseState:!0},Records.convertFilter(At.descriptor.filter)),{messages:Nt}=yield this.messageStore.query(e,[Bt]);if(Nt.length===0)return{status:{code:404,detail:"Not Found"}};if(Nt.length>1)return messageReplyFromError(new DwnError(DwnErrorCode.RecordsReadReturnedMultiple,"Multiple records exist for the RecordsRead filter"),400);const jt=Nt[0];try{yield RecordsReadHandler.authorizeRecordsRead(e,kt,yield RecordsWrite.parse(jt),this.messageStore)}catch(zt){return messageReplyFromError(zt,401)}let Lt;if(jt.encodedData!==void 0){const zt=Encoder$4.base64UrlToBytes(jt.encodedData);Lt=DataStream.fromBytes(zt),delete jt.encodedData}else{const zt=yield this.dataStore.get(e,jt.recordId,jt.descriptor.dataCid);if((zt==null?void 0:zt.dataStream)===void 0)return{status:{code:404,detail:"Not Found"}};Lt=zt.dataStream}const er=Object.assign(Object.assign({},jt),{data:Lt});if(!(yield RecordsWrite.isInitialWrite(er))){const rr=(yield this.messageStore.query(e,[{recordId:er.recordId,isLatestBaseState:!1,method:DwnMethodName.Write}])).messages[0];delete rr.encodedData,er.initialWrite=rr}return{status:{code:200,detail:"OK"},record:er}})}static authorizeRecordsRead(e,At,kt,Bt){return __awaiter$2G(this,void 0,void 0,function*(){Message.isSignedByAuthorDelegate(At.message)&&(yield At.authorizeDelegate(kt.message,Bt));const{descriptor:Nt}=kt.message;if(At.author!==e){if(Nt.published===!0)return;if(At.author!==void 0&&At.author===Nt.recipient)return;if(At.author!==void 0&&At.signaturePayload.permissionGrantId!==void 0){const jt=yield PermissionsProtocol.fetchGrant(e,Bt,At.signaturePayload.permissionGrantId);yield RecordsGrantAuthorization.authorizeRead({recordsReadMessage:At.message,recordsWriteMessageToBeRead:kt.message,expectedGrantor:e,expectedGrantee:At.author,permissionGrant:jt,messageStore:Bt})}else if(Nt.protocol!==void 0)yield ProtocolAuthorization.authorizeRead(e,At,kt,Bt);else throw new DwnError(DwnErrorCode.RecordsReadAuthorizationFailed,"message failed authorization")}})}}var __awaiter$2F=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class RecordsSubscribe extends AbstractMessage{static parse(e){return __awaiter$2F(this,void 0,void 0,function*(){let At;if(e.authorization!==void 0&&(At=yield Message.validateSignatureStructure(e.authorization.signature,e.descriptor)),yield Records.validateDelegatedGrantReferentialIntegrity(e,At),(At==null?void 0:At.protocolRole)!==void 0&&e.descriptor.filter.protocolPath===void 0)throw new DwnError(DwnErrorCode.RecordsSubscribeFilterMissingRequiredProperties,"Role-authorized subscriptions must include `protocolPath` in the filter");return e.descriptor.filter.protocol!==void 0&&validateProtocolUrlNormalized(e.descriptor.filter.protocol),e.descriptor.filter.schema!==void 0&&validateSchemaUrlNormalized(e.descriptor.filter.schema),Time.validateTimestamp(e.descriptor.messageTimestamp),new RecordsSubscribe(e)})}static create(e){var At;return __awaiter$2F(this,void 0,void 0,function*(){const kt={interface:DwnInterfaceName.Records,method:DwnMethodName.Subscribe,messageTimestamp:(At=e.messageTimestamp)!==null&&At!==void 0?At:Time.getCurrentTimestamp(),filter:Records.normalizeFilter(e.filter)};removeUndefinedProperties$3(kt);const Bt=e.signer;let Nt;Bt&&(Nt=yield Message.createAuthorization({descriptor:kt,signer:Bt,protocolRole:e.protocolRole,delegatedGrant:e.delegatedGrant}));const jt={descriptor:kt,authorization:Nt};return Message.validateJsonSchema(jt),new RecordsSubscribe(jt)})}authorizeDelegate(e){return __awaiter$2F(this,void 0,void 0,function*(){const At=yield PermissionGrant$1.parse(this.message.authorization.authorDelegatedGrant);yield RecordsGrantAuthorization.authorizeQueryOrSubscribe({incomingMessage:this.message,expectedGrantor:this.author,expectedGrantee:this.signer,permissionGrant:At,messageStore:e})})}}var __awaiter$2E=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class RecordsSubscribeHandler{constructor(e,At,kt){this.didResolver=e,this.messageStore=At,this.eventStream=kt}handle({tenant:e,message:At,subscriptionHandler:kt}){return __awaiter$2E(this,void 0,void 0,function*(){if(this.eventStream===void 0)return messageReplyFromError(new DwnError(DwnErrorCode.RecordsSubscribeEventStreamUnimplemented,"Subscriptions are not supported"),501);let Bt;try{Bt=yield RecordsSubscribe.parse(At)}catch(tr){return messageReplyFromError(tr,400)}let Nt=[];if(Records.filterIncludesPublishedRecords(Bt.message.descriptor.filter)&&Bt.author===void 0)Nt=[RecordsSubscribeHandler.buildPublishedRecordsFilter(Bt)],delete At.authorization;else{try{yield authenticate(At.authorization,this.didResolver),yield RecordsSubscribeHandler.authorizeRecordsSubscribe(e,Bt,this.messageStore)}catch(tr){return messageReplyFromError(tr,401)}Bt.author===e?Nt=yield RecordsSubscribeHandler.filterAsOwner(Bt):Nt=yield RecordsSubscribeHandler.filterAsNonOwner(Bt)}const jt=(tr,zt,rr)=>{e===tr&&FilterUtility.matchAnyFilter(rr,Nt)&&kt(zt)},Lt=yield Message.getCid(At),er=yield this.eventStream.subscribe(e,Lt,jt);return{status:{code:200,detail:"OK"},subscription:er}})}static filterAsOwner(e){return __awaiter$2E(this,void 0,void 0,function*(){const{filter:At}=e.message.descriptor;return[Object.assign(Object.assign({},Records.convertFilter(At)),{interface:DwnInterfaceName.Records,method:[DwnMethodName.Write,DwnMethodName.Delete]})]})}static filterAsNonOwner(e){return __awaiter$2E(this,void 0,void 0,function*(){const At=[],{filter:kt}=e.message.descriptor;return Records.filterIncludesPublishedRecords(kt)&&At.push(RecordsSubscribeHandler.buildPublishedRecordsFilter(e)),Records.filterIncludesUnpublishedRecords(kt)&&(Records.shouldBuildUnpublishedAuthorFilter(kt,e.author)&&At.push(RecordsSubscribeHandler.buildUnpublishedRecordsBySubscribeAuthorFilter(e)),Records.shouldProtocolAuthorize(e.signaturePayload)&&At.push(RecordsSubscribeHandler.buildUnpublishedProtocolAuthorizedRecordsFilter(e)),Records.shouldBuildUnpublishedRecipientFilter(kt,e.author)&&At.push(RecordsSubscribeHandler.buildUnpublishedRecordsForSubscribeAuthorFilter(e))),At})}static buildPublishedRecordsFilter(e){return Object.assign(Object.assign({},Records.convertFilter(e.message.descriptor.filter)),{interface:DwnInterfaceName.Records,method:[DwnMethodName.Write,DwnMethodName.Delete],published:!0})}static buildUnpublishedRecordsForSubscribeAuthorFilter(e){return Object.assign(Object.assign({},Records.convertFilter(e.message.descriptor.filter)),{interface:DwnInterfaceName.Records,method:[DwnMethodName.Write,DwnMethodName.Delete],recipient:e.author,published:!1})}static buildUnpublishedProtocolAuthorizedRecordsFilter(e){return Object.assign(Object.assign({},Records.convertFilter(e.message.descriptor.filter)),{interface:DwnInterfaceName.Records,method:[DwnMethodName.Write,DwnMethodName.Delete],published:!1})}static buildUnpublishedRecordsBySubscribeAuthorFilter(e){return Object.assign(Object.assign({},Records.convertFilter(e.message.descriptor.filter)),{author:e.author,interface:DwnInterfaceName.Records,method:[DwnMethodName.Write,DwnMethodName.Delete],published:!1})}static authorizeRecordsSubscribe(e,At,kt){return __awaiter$2E(this,void 0,void 0,function*(){Message.isSignedByAuthorDelegate(At.message)&&(yield At.authorizeDelegate(kt)),Records.shouldProtocolAuthorize(At.signaturePayload)&&(yield ProtocolAuthorization.authorizeQueryOrSubscribe(e,At,kt))})}}class DwnConstant{}DwnConstant.maxDataSizeAllowedToBeEncoded=3e4;var __awaiter$2D=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class StorageController{constructor({messageStore:e,dataStore:At,eventLog:kt,eventStream:Bt}){this.messageStore=e,this.dataStore=At,this.eventLog=kt,this.eventStream=Bt}performRecordsDelete({tenant:e,message:At}){return __awaiter$2D(this,void 0,void 0,function*(){const kt={interface:DwnInterfaceName.Records,recordId:At.descriptor.recordId},{messages:Bt}=yield this.messageStore.query(e,[kt]),Nt=yield Message.getNewestMessage(Bt);if(!Records.canPerformDeleteAgainstRecord(At,Nt))return;const jt=yield RecordsDelete.parse(At),Lt=yield RecordsWrite.getInitialWrite(Bt),er=jt.constructIndexes(Lt),tr=yield Message.getCid(At);yield this.messageStore.put(e,At,er),yield this.eventLog.append(e,tr,er),this.eventStream!==void 0&&this.eventStream.emit(e,{message:At,initialWrite:Lt},er),At.descriptor.prune&&(yield StorageController.purgeRecordDescendants(e,At.descriptor.recordId,this.messageStore,this.dataStore,this.eventLog)),yield StorageController.deleteAllOlderMessagesButKeepInitialWrite(e,Bt,At,this.messageStore,this.dataStore,this.eventLog)})}static deleteFromDataStoreIfNeeded(e,At,kt,Bt){return __awaiter$2D(this,void 0,void 0,function*(){if(kt.descriptor.method!==DwnMethodName.Write)return;const Nt=kt;Nt.descriptor.dataSize<=DwnConstant.maxDataSizeAllowedToBeEncoded||Nt.descriptor.dataCid!==Bt.descriptor.dataCid&&(yield e.delete(At,Nt.recordId,Nt.descriptor.dataCid))})}static purgeRecordDescendants(e,At,kt,Bt,Nt){return __awaiter$2D(this,void 0,void 0,function*(){const jt={interface:DwnInterfaceName.Records,parentId:At},{messages:Lt}=yield kt.query(e,[jt]),er=new Map;for(const tr of Lt){let zt;Records.isRecordsWrite(tr)?zt=tr.recordId:zt=tr.descriptor.recordId,er.has(zt)||er.set(zt,[]),er.get(zt).push(tr)}for(const tr of er.keys())yield StorageController.purgeRecordDescendants(e,tr,kt,Bt,Nt);for(const tr of er.keys())yield StorageController.purgeRecordMessages(e,er.get(tr),kt,Bt,Nt)})}static purgeRecordMessages(e,At,kt,Bt,Nt){return __awaiter$2D(this,void 0,void 0,function*(){const jt=At.filter(tr=>tr.descriptor.method===DwnMethodName.Write),Lt=yield Message.getNewestMessage(jt);yield Bt.delete(e,Lt.recordId,Lt.descriptor.dataCid);const er=yield Promise.all(At.map(tr=>Message.getCid(tr)));yield Nt.deleteEventsByCid(e,er),yield Promise.all(er.map(tr=>kt.delete(e,tr)))})}static deleteAllOlderMessagesButKeepInitialWrite(e,At,kt,Bt,Nt,jt){return __awaiter$2D(this,void 0,void 0,function*(){const Lt=[];for(const er of At){if(yield Message.isOlder(er,kt)){yield StorageController.deleteFromDataStoreIfNeeded(Nt,e,er,kt);const zt=yield Message.getCid(er);if(yield Bt.delete(e,zt),yield RecordsWrite.isInitialWrite(er)){const ar=yield(yield RecordsWrite.parse(er)).constructIndexes(!1),dr=er;delete dr.encodedData,yield Bt.put(e,dr,ar)}else{const nr=yield Message.getCid(er);Lt.push(nr)}}yield jt.deleteEventsByCid(e,Lt)}})}}var __awaiter$2C=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class RecordsWriteHandler{constructor(e,At,kt,Bt,Nt){this.didResolver=e,this.messageStore=At,this.dataStore=kt,this.eventLog=Bt,this.eventStream=Nt}handle({tenant:e,message:At,dataStream:kt}){return __awaiter$2C(this,void 0,void 0,function*(){let Bt;try{Bt=yield RecordsWrite.parse(At),At.descriptor.protocol!==void 0&&(yield ProtocolAuthorization.validateReferentialIntegrity(e,Bt,this.messageStore))}catch(ir){return messageReplyFromError(ir,400)}try{yield authenticate(At.authorization,this.didResolver),yield RecordsWriteHandler.authorizeRecordsWrite(e,Bt,this.messageStore)}catch(ir){return messageReplyFromError(ir,401)}const Nt={interface:DwnInterfaceName.Records,recordId:At.recordId},{messages:jt}=yield this.messageStore.query(e,[Nt]),Lt=yield Bt.isInitialWrite();let er;if(!Lt)try{er=yield RecordsWrite.getInitialWrite(jt),RecordsWrite.verifyEqualityOfImmutableProperties(er,At)}catch(ir){return messageReplyFromError(ir,400)}const tr=yield Message.getNewestMessage(jt);let zt=!1,rr;if(tr===void 0||(yield Message.isNewer(At,tr))?(zt=!0,rr=At):rr=tr,!zt)return{status:{code:409,detail:"Conflict"}};try{if((tr==null?void 0:tr.descriptor.method)===DwnMethodName.Delete)throw new DwnError(DwnErrorCode.RecordsWriteNotAllowedAfterDelete,"RecordsWrite is not allowed after a RecordsDelete.");yield this.preProcessingForCoreRecordsWrite(e,At);let ir=!1,ar=At;if(kt!==void 0)ar=yield this.processMessageWithDataStream(e,At,kt),ir=!0;else if(!Lt){const ur=tr;ar=yield this.processMessageWithoutDataStream(e,At,ur),ir=!0}const dr=yield Bt.constructIndexes(ir);yield this.messageStore.put(e,ar,dr),yield this.eventLog.append(e,yield Message.getCid(At),dr),this.eventStream!==void 0&&ir&&this.eventStream.emit(e,{message:At,initialWrite:er},dr)}catch(ir){const ar=ir;if(ar.code!==void 0&&(ar.code===DwnErrorCode.RecordsWriteMissingEncodedDataInPrevious||ar.code===DwnErrorCode.RecordsWriteMissingDataInPrevious||ar.code===DwnErrorCode.RecordsWriteNotAllowedAfterDelete||ar.code===DwnErrorCode.RecordsWriteDataCidMismatch||ar.code===DwnErrorCode.RecordsWriteDataSizeMismatch||ar.code.startsWith("PermissionsProtocolValidate")||ar.code.startsWith("SchemaValidator")))return messageReplyFromError(ir,400);throw ir}const nr={status:Lt&&kt===void 0?{code:204,detail:"No Content"}:{code:202,detail:"Accepted"}};return yield StorageController.deleteAllOlderMessagesButKeepInitialWrite(e,jt,rr,this.messageStore,this.dataStore,this.eventLog),yield this.postProcessingForCoreRecordsWrite(e,Bt),nr})}preProcessingForCoreRecordsWrite(e,At){var kt;return __awaiter$2C(this,void 0,void 0,function*(){if(At.descriptor.protocol===PermissionsProtocol.uri&&At.descriptor.protocolPath===PermissionsProtocol.revocationPath){const Bt=At.descriptor.parentId,Nt=yield PermissionsProtocol.fetchGrant(e,this.messageStore,Bt),jt=(kt=At.descriptor.tags)===null||kt===void 0?void 0:kt.protocol,Lt="protocol"in Nt.scope?Nt.scope.protocol:void 0;if(Lt!==jt)throw new DwnError(DwnErrorCode.PermissionsProtocolValidateRevocationProtocolTagMismatch,`Revocation protocol ${jt} does not match grant protocol ${Lt}`)}})}static validateSchemaForCoreRecordsWrite(e,At){e.descriptor.protocol===PermissionsProtocol.uri&&PermissionsProtocol.validateSchema(e,At)}postProcessingForCoreRecordsWrite(e,At){return __awaiter$2C(this,void 0,void 0,function*(){if(At.message.descriptor.protocol===PermissionsProtocol.uri&&At.message.descriptor.protocolPath===PermissionsProtocol.revocationPath){const Bt={permissionGrantId:At.message.descriptor.parentId,dateCreated:{gte:At.message.descriptor.messageTimestamp}},{messages:Nt}=yield this.messageStore.query(e,[Bt]),jt=[];for(const Lt of Nt){const er=yield Message.getCid(Lt);yield this.messageStore.delete(e,er)}this.eventLog.deleteEventsByCid(e,jt)}})}cloneAndAddEncodedData(e,At){return __awaiter$2C(this,void 0,void 0,function*(){const kt=Object.assign({},e);return kt.encodedData=Encoder$4.bytesToBase64Url(At),kt})}processMessageWithDataStream(e,At,kt){return __awaiter$2C(this,void 0,void 0,function*(){let Bt=At;if(At.descriptor.dataSize<=DwnConstant.maxDataSizeAllowedToBeEncoded){const Nt=yield DataStream.toBytes(kt),jt=yield Cid.computeDagPbCidFromBytes(Nt);RecordsWriteHandler.validateDataIntegrity(At.descriptor.dataCid,At.descriptor.dataSize,jt,Nt.length),RecordsWriteHandler.validateSchemaForCoreRecordsWrite(At,Nt),Bt=yield this.cloneAndAddEncodedData(At,Nt)}else{const[Nt,jt]=DataStream.duplicateDataStream(kt,2);try{const[Lt,er]=yield Promise.all([Cid.computeDagPbCidFromStream(Nt),this.dataStore.put(e,At.recordId,At.descriptor.dataCid,jt)]);RecordsWriteHandler.validateDataIntegrity(At.descriptor.dataCid,At.descriptor.dataSize,Lt,er.dataSize)}catch(Lt){throw yield this.dataStore.delete(e,At.recordId,At.descriptor.dataCid),Lt}}return Bt})}processMessageWithoutDataStream(e,At,kt){return __awaiter$2C(this,void 0,void 0,function*(){const Bt=Object.assign({},At),{dataCid:Nt,dataSize:jt}=At.descriptor;if(RecordsWriteHandler.validateDataIntegrity(Nt,jt,kt.descriptor.dataCid,kt.descriptor.dataSize),jt<=DwnConstant.maxDataSizeAllowedToBeEncoded)if(kt.encodedData!==void 0)Bt.encodedData=kt.encodedData;else throw new DwnError(DwnErrorCode.RecordsWriteMissingEncodedDataInPrevious,"No dataStream was provided and unable to get data from previous message");else if((yield this.dataStore.get(e,kt.recordId,At.descriptor.dataCid))===void 0)throw new DwnError(DwnErrorCode.RecordsWriteMissingDataInPrevious,"No dataStream was provided and unable to get data from previous message");return Bt})}static validateDataIntegrity(e,At,kt,Bt){if(e!==kt)throw new DwnError(DwnErrorCode.RecordsWriteDataCidMismatch,`actual data CID ${kt} does not match dataCid in descriptor: ${e}`);if(At!==Bt)throw new DwnError(DwnErrorCode.RecordsWriteDataSizeMismatch,`actual data size ${Bt} bytes does not match dataSize in descriptor: ${At}`)}static authorizeRecordsWrite(e,At,kt){return __awaiter$2C(this,void 0,void 0,function*(){if(At.owner!==void 0&&At.owner!==e)throw new DwnError(DwnErrorCode.RecordsWriteOwnerAndTenantMismatch,`Owner ${At.owner} must be the same as tenant ${e} when specified.`);if(At.isSignedByAuthorDelegate&&(yield At.authorizeAuthorDelegate(kt)),At.isSignedByOwnerDelegate&&(yield At.authorizeOwnerDelegate(kt)),At.owner===void 0){if(At.author===e)return;if(At.author!==void 0&&At.signaturePayload.permissionGrantId!==void 0){const Bt=yield PermissionsProtocol.fetchGrant(e,kt,At.signaturePayload.permissionGrantId);yield RecordsGrantAuthorization.authorizeWrite({recordsWriteMessage:At.message,expectedGrantor:e,expectedGrantee:At.author,permissionGrant:Bt,messageStore:kt})}else if(At.message.descriptor.protocol!==void 0)yield ProtocolAuthorization.authorizeWrite(e,At,kt);else throw new DwnError(DwnErrorCode.RecordsWriteAuthorizationFailed,"message failed authorization")}})}}var DidVerificationRelationship$2;(function(xt){xt.authentication="authentication",xt.assertionMethod="assertionMethod",xt.keyAgreement="keyAgreement",xt.capabilityInvocation="capabilityInvocation",xt.capabilityDelegation="capabilityDelegation"})(DidVerificationRelationship$2||(DidVerificationRelationship$2={}));const EMPTY_DID_RESOLUTION_RESULT$2={"@context":"https://w3id.org/did-resolution/v1",didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};let Did$2=class _l{constructor({method:e,id:At,path:kt,query:Bt,fragment:Nt,params:jt}){this.uri=`did:${e}:${At}`,this.method=e,this.id=At,this.path=kt,this.query=Bt,this.fragment=Nt,this.params=jt}static parse(e){if(!e)return null;const At=_l.DID_URI_PATTERN.exec(e);if(!At||!At.groups)return null;const{method:kt,id:Bt,path:Nt,query:jt,fragment:Lt}=At.groups,er={uri:`did:${kt}:${Bt}`,method:kt,id:Bt};if(Nt&&(er.path=Nt),jt&&(er.query=jt.slice(1)),Lt&&(er.fragment=Lt.slice(1)),jt){const tr={},zt=jt.slice(1).split("&");for(const rr of zt){const[nr,ir]=rr.split("=");tr[nr]=ir}er.params=tr}return er}};Did$2.METHOD_PATTERN="([a-z0-9]+)";Did$2.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})";Did$2.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${Did$2.PCT_ENCODED_PATTERN})`;Did$2.METHOD_ID_PATTERN=`((?:${Did$2.ID_CHAR_PATTERN}*:)*(${Did$2.ID_CHAR_PATTERN}+))`;Did$2.PATH_PATTERN="(/[^#?]*)?";Did$2.QUERY_PATTERN="([?][^#]*)?";Did$2.FRAGMENT_PATTERN="(#.*)?";Did$2.DID_URI_PATTERN=new RegExp(`^did:(?<method>${Did$2.METHOD_PATTERN}):(?<id>${Did$2.METHOD_ID_PATTERN})(?<path>${Did$2.PATH_PATTERN})(?<query>${Did$2.QUERY_PATTERN})(?<fragment>${Did$2.FRAGMENT_PATTERN})$`);let DidError$2=class El extends Error{constructor(e,At){super(`${e}: ${At}`),this.code=e,this.name="DidError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,El)}};var DidErrorCode$2;(function(xt){xt.InvalidDid="invalidDid",xt.MethodNotSupported="methodNotSupported",xt.InternalError="internalError",xt.InvalidDidDocument="invalidDidDocument",xt.InvalidDidDocumentLength="invalidDidDocumentLength",xt.InvalidDidUrl="invalidDidUrl",xt.InvalidPreviousDidProof="invalidPreviousDidProof",xt.InvalidPublicKey="invalidPublicKey",xt.InvalidPublicKeyLength="invalidPublicKeyLength",xt.InvalidPublicKeyType="invalidPublicKeyType",xt.InvalidSignature="invalidSignature",xt.NotFound="notFound",xt.RepresentationNotSupported="representationNotSupported",xt.UnsupportedPublicKeyType="unsupportedPublicKeyType"})(DidErrorCode$2||(DidErrorCode$2={}));const perf=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,now=()=>perf.now(),isPosInt=xt=>xt&&xt===Math.floor(xt)&&xt>0&&isFinite(xt),isPosIntOrInf=xt=>xt===1/0||isPosInt(xt);class TTLCache{constructor({max:e=1/0,ttl:At,updateAgeOnGet:kt=!1,checkAgeOnGet:Bt=!1,noUpdateTTL:Nt=!1,dispose:jt,noDisposeOnSet:Lt=!1}={}){if(this.expirations=Object.create(null),this.data=new Map,this.expirationMap=new Map,At!==void 0&&!isPosIntOrInf(At))throw new TypeError("ttl must be positive integer or Infinity if set");if(!isPosIntOrInf(e))throw new TypeError("max must be positive integer or Infinity");if(this.ttl=At,this.max=e,this.updateAgeOnGet=!!kt,this.checkAgeOnGet=!!Bt,this.noUpdateTTL=!!Nt,this.noDisposeOnSet=!!Lt,jt!==void 0){if(typeof jt!="function")throw new TypeError("dispose must be function if set");this.dispose=jt}this.timer=void 0,this.timerExpiration=void 0}setTimer(e,At){if(this.timerExpiration<e)return;this.timer&&clearTimeout(this.timer);const kt=setTimeout(()=>{this.timer=void 0,this.timerExpiration=void 0,this.purgeStale();for(const Bt in this.expirations){this.setTimer(Bt,Bt-now());break}},At);kt.unref&&kt.unref(),this.timerExpiration=e,this.timer=kt}cancelTimer(){this.timer&&(clearTimeout(this.timer),this.timerExpiration=void 0,this.timer=void 0)}cancelTimers(){return process$9.emitWarning('TTLCache.cancelTimers has been renamed to TTLCache.cancelTimer (no "s"), and will be removed in the next major version update'),this.cancelTimer()}clear(){const e=this.dispose!==TTLCache.prototype.dispose?[...this]:[];this.data.clear(),this.expirationMap.clear(),this.cancelTimer(),this.expirations=Object.create(null);for(const[At,kt]of e)this.dispose(kt,At,"delete")}setTTL(e,At=this.ttl){const kt=this.expirationMap.get(e);if(kt!==void 0){const Bt=this.expirations[kt];!Bt||Bt.length<=1?delete this.expirations[kt]:this.expirations[kt]=Bt.filter(Nt=>Nt!==e)}if(At!==1/0){const Bt=Math.floor(now()+At);this.expirationMap.set(e,Bt),this.expirations[Bt]||(this.expirations[Bt]=[],this.setTimer(Bt,At)),this.expirations[Bt].push(e)}else this.expirationMap.set(e,1/0)}set(e,At,{ttl:kt=this.ttl,noUpdateTTL:Bt=this.noUpdateTTL,noDisposeOnSet:Nt=this.noDisposeOnSet}={}){if(!isPosIntOrInf(kt))throw new TypeError("ttl must be positive integer or Infinity");if(this.expirationMap.has(e)){Bt||this.setTTL(e,kt);const jt=this.data.get(e);jt!==At&&(this.data.set(e,At),Nt||this.dispose(jt,e,"set"))}else this.setTTL(e,kt),this.data.set(e,At);for(;this.size>this.max;)this.purgeToCapacity();return this}has(e){return this.data.has(e)}getRemainingTTL(e){const At=this.expirationMap.get(e);return At===1/0?At:At!==void 0?Math.max(0,Math.ceil(At-now())):0}get(e,{updateAgeOnGet:At=this.updateAgeOnGet,ttl:kt=this.ttl,checkAgeOnGet:Bt=this.checkAgeOnGet}={}){const Nt=this.data.get(e);if(Bt&&this.getRemainingTTL(e)===0){this.delete(e);return}return At&&this.setTTL(e,kt),Nt}dispose(e,At){}delete(e){const At=this.expirationMap.get(e);if(At!==void 0){const kt=this.data.get(e);this.data.delete(e),this.expirationMap.delete(e);const Bt=this.expirations[At];return Bt&&(Bt.length<=1?delete this.expirations[At]:this.expirations[At]=Bt.filter(Nt=>Nt!==e)),this.dispose(kt,e,"delete"),this.size===0&&this.cancelTimer(),!0}return!1}purgeToCapacity(){for(const e in this.expirations){const At=this.expirations[e];if(this.size-At.length>=this.max){delete this.expirations[e];const kt=[];for(const Bt of At)kt.push([Bt,this.data.get(Bt)]),this.data.delete(Bt),this.expirationMap.delete(Bt);for(const[Bt,Nt]of kt)this.dispose(Nt,Bt,"evict")}else{const kt=this.size-this.max,Bt=[];for(const Nt of At.splice(0,kt))Bt.push([Nt,this.data.get(Nt)]),this.data.delete(Nt),this.expirationMap.delete(Nt);for(const[Nt,jt]of Bt)this.dispose(jt,Nt,"evict");return}}}get size(){return this.data.size}purgeStale(){const e=Math.ceil(now());for(const At in this.expirations){if(At==="Infinity"||At>e)return;const kt=[...this.expirations[At]||[]],Bt=[];delete this.expirations[At];for(const Nt of kt)Bt.push([Nt,this.data.get(Nt)]),this.data.delete(Nt),this.expirationMap.delete(Nt);for(const[Nt,jt]of Bt)this.dispose(jt,Nt,"stale")}this.size===0&&this.cancelTimer()}*entries(){for(const e in this.expirations)for(const At of this.expirations[e])yield[At,this.data.get(At)]}*keys(){for(const e in this.expirations)for(const At of this.expirations[e])yield At}*values(){for(const e in this.expirations)for(const At of this.expirations[e])yield this.data.get(At)}[Symbol.iterator](){return this.entries()}}var ttlcache=TTLCache;const TtlCache=getDefaultExportFromCjs(ttlcache);function coerce(xt){if(xt instanceof Uint8Array&&xt.constructor.name==="Uint8Array")return xt;if(xt instanceof ArrayBuffer)return new Uint8Array(xt);if(ArrayBuffer.isView(xt))return new Uint8Array(xt.buffer,xt.byteOffset,xt.byteLength);throw new Error("Unknown type, must be binary type")}function base(xt,e){if(xt.length>=255)throw new TypeError("Alphabet too long");for(var At=new Uint8Array(256),kt=0;kt<At.length;kt++)At[kt]=255;for(var Bt=0;Bt<xt.length;Bt++){var Nt=xt.charAt(Bt),jt=Nt.charCodeAt(0);if(At[jt]!==255)throw new TypeError(Nt+" is ambiguous");At[jt]=Bt}var Lt=xt.length,er=xt.charAt(0),tr=Math.log(Lt)/Math.log(256),zt=Math.log(256)/Math.log(Lt);function rr(ar){if(ar instanceof Uint8Array||(ArrayBuffer.isView(ar)?ar=new Uint8Array(ar.buffer,ar.byteOffset,ar.byteLength):Array.isArray(ar)&&(ar=Uint8Array.from(ar))),!(ar instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(ar.length===0)return"";for(var dr=0,ur=0,fr=0,pr=ar.length;fr!==pr&&ar[fr]===0;)fr++,dr++;for(var lr=(pr-fr)*zt+1>>>0,yr=new Uint8Array(lr);fr!==pr;){for(var br=ar[fr],Ar=0,Pr=lr-1;(br!==0||Ar<ur)&&Pr!==-1;Pr--,Ar++)br+=256*yr[Pr]>>>0,yr[Pr]=br%Lt>>>0,br=br/Lt>>>0;if(br!==0)throw new Error("Non-zero carry");ur=Ar,fr++}for(var kr=lr-ur;kr!==lr&&yr[kr]===0;)kr++;for(var Ur=er.repeat(dr);kr<lr;++kr)Ur+=xt.charAt(yr[kr]);return Ur}function nr(ar){if(typeof ar!="string")throw new TypeError("Expected String");if(ar.length===0)return new Uint8Array;var dr=0;if(ar[dr]!==" "){for(var ur=0,fr=0;ar[dr]===er;)ur++,dr++;for(var pr=(ar.length-dr)*tr+1>>>0,lr=new Uint8Array(pr);ar[dr];){var yr=At[ar.charCodeAt(dr)];if(yr===255)return;for(var br=0,Ar=pr-1;(yr!==0||br<fr)&&Ar!==-1;Ar--,br++)yr+=Lt*lr[Ar]>>>0,lr[Ar]=yr%256>>>0,yr=yr/256>>>0;if(yr!==0)throw new Error("Non-zero carry");fr=br,dr++}if(ar[dr]!==" "){for(var Pr=pr-fr;Pr!==pr&&lr[Pr]===0;)Pr++;for(var kr=new Uint8Array(ur+(pr-Pr)),Ur=ur;Pr!==pr;)kr[Ur++]=lr[Pr++];return kr}}}function ir(ar){var dr=nr(ar);if(dr)return dr;throw new Error(`Non-${e} character`)}return{encode:rr,decodeUnsafe:nr,decode:ir}}var src=base,_brrp__multiformats_scope_baseX=src;let Encoder$1=class{constructor(e,At,kt){wn(this,"name");wn(this,"prefix");wn(this,"baseEncode");this.name=e,this.prefix=At,this.baseEncode=kt}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}};class Decoder{constructor(e,At,kt){wn(this,"name");wn(this,"prefix");wn(this,"baseDecode");wn(this,"prefixCodePoint");if(this.name=e,this.prefix=At,At.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=At.codePointAt(0),this.baseDecode=kt}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return or(this,e)}}class ComposedDecoder{constructor(e){wn(this,"decoders");this.decoders=e}or(e){return or(this,e)}decode(e){const At=e[0],kt=this.decoders[At];if(kt!=null)return kt.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function or(xt,e){return new ComposedDecoder({...xt.decoders??{[xt.prefix]:xt},...e.decoders??{[e.prefix]:e}})}class Codec{constructor(e,At,kt,Bt){wn(this,"name");wn(this,"prefix");wn(this,"baseEncode");wn(this,"baseDecode");wn(this,"encoder");wn(this,"decoder");this.name=e,this.prefix=At,this.baseEncode=kt,this.baseDecode=Bt,this.encoder=new Encoder$1(e,At,kt),this.decoder=new Decoder(e,At,Bt)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function from$3({name:xt,prefix:e,encode:At,decode:kt}){return new Codec(xt,e,At,kt)}function baseX({name:xt,prefix:e,alphabet:At}){const{encode:kt,decode:Bt}=_brrp__multiformats_scope_baseX(At,xt);return from$3({prefix:e,name:xt,encode:kt,decode:Nt=>coerce(Bt(Nt))})}function decode$7(xt,e,At,kt){const Bt={};for(let zt=0;zt<e.length;++zt)Bt[e[zt]]=zt;let Nt=xt.length;for(;xt[Nt-1]==="=";)--Nt;const jt=new Uint8Array(Nt*At/8|0);let Lt=0,er=0,tr=0;for(let zt=0;zt<Nt;++zt){const rr=Bt[xt[zt]];if(rr===void 0)throw new SyntaxError(`Non-${kt} character`);er=er<<At|rr,Lt+=At,Lt>=8&&(Lt-=8,jt[tr++]=255&er>>Lt)}if(Lt>=At||255&er<<8-Lt)throw new SyntaxError("Unexpected end of data");return jt}function encode$7(xt,e,At){const kt=e[e.length-1]==="=",Bt=(1<<At)-1;let Nt="",jt=0,Lt=0;for(let er=0;er<xt.length;++er)for(Lt=Lt<<8|xt[er],jt+=8;jt>At;)jt-=At,Nt+=e[Bt&Lt>>jt];if(jt!==0&&(Nt+=e[Bt&Lt<<At-jt]),kt)for(;Nt.length*At&7;)Nt+="=";return Nt}function rfc4648({name:xt,prefix:e,bitsPerChar:At,alphabet:kt}){return from$3({prefix:e,name:xt,encode(Bt){return encode$7(Bt,kt,At)},decode(Bt){return decode$7(Bt,kt,At,xt)}})}rfc4648({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});rfc4648({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5});rfc4648({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5});rfc4648({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5});rfc4648({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5});rfc4648({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5});rfc4648({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5});rfc4648({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5});const base32z=rfc4648({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),base58btc=baseX({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});baseX({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});rfc4648({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6});rfc4648({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6});const base64url=rfc4648({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6});rfc4648({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function isArrayBufferSlice$2(xt){return xt.byteOffset!==0||xt.byteLength!==xt.buffer.byteLength}function isAsyncIterable$7(xt){return typeof xt!="object"||xt===null?!1:typeof xt[Symbol.asyncIterator]=="function"}function universalTypeOf$2(xt){const At=Object.prototype.toString.call(xt).match(/\s([a-zA-Z0-9]+)/),[kt,Bt]=At;return Bt}var __awaiter$2B=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues$9=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}};const textEncoder$4=new TextEncoder,textDecoder$3=new TextDecoder;let Convert$2=class Ao{constructor(e,At){this.data=e,this.format=At}static arrayBuffer(e){return new Ao(e,"ArrayBuffer")}static asyncIterable(e){if(!isAsyncIterable$7(e))throw new TypeError("Input must be of type AsyncIterable.");return new Ao(e,"AsyncIterable")}static base32Z(e){return new Ao(e,"Base32Z")}static base58Btc(e){return new Ao(e,"Base58Btc")}static base64Url(e){return new Ao(e,"Base64Url")}static bufferSource(e){return new Ao(e,"BufferSource")}static hex(e){if(typeof e!="string")throw new TypeError("Hex input must be a string.");if(e.length%2!==0)throw new TypeError("Hex input must have an even number of characters.");return new Ao(e,"Hex")}static multibase(e){return new Ao(e,"Multibase")}static object(e){return new Ao(e,"Object")}static string(e){return new Ao(e,"String")}static uint8Array(e){return new Ao(e,"Uint8Array")}toArrayBuffer(){switch(this.format){case"Base58Btc":return base58btc.baseDecode(this.data).buffer;case"Base64Url":return base64url.baseDecode(this.data).buffer;case"BufferSource":{if(universalTypeOf$2(this.data)==="ArrayBuffer")return this.data;if(ArrayBuffer.isView(this.data))return isArrayBufferSlice$2(this.data)?this.data.buffer.slice(this.data.byteOffset,this.data.byteOffset+this.data.byteLength):this.data.buffer;throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":return this.toUint8Array().buffer;case"String":return this.toUint8Array().buffer;case"Uint8Array":return this.data.buffer;default:throw new TypeError(`Conversion from ${this.format} to ArrayBuffer is not supported.`)}}toArrayBufferAsync(){return __awaiter$2B(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":return yield(yield this.toBlobAsync()).arrayBuffer();default:throw new TypeError(`Asynchronous conversion from ${this.format} to ArrayBuffer is not supported.`)}})}toBase32Z(){switch(this.format){case"Uint8Array":return base32z.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Z is not supported.`)}}toBase58Btc(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return base58btc.baseEncode(e)}case"Multibase":return this.data.substring(1);case"Uint8Array":return base58btc.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base58Btc is not supported.`)}}toBase64Url(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return base64url.baseEncode(e)}case"BufferSource":{const e=this.toUint8Array();return base64url.baseEncode(e)}case"Object":{const e=JSON.stringify(this.data),At=textEncoder$4.encode(e);return base64url.baseEncode(At)}case"String":{const e=textEncoder$4.encode(this.data);return base64url.baseEncode(e)}case"Uint8Array":return base64url.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Url is not supported.`)}}toBlobAsync(){return __awaiter$2B(this,void 0,void 0,function*(){var e,At,kt,Bt;switch(this.format){case"AsyncIterable":{const er=[];try{for(var Nt=!0,jt=__asyncValues$9(this.data),Lt;Lt=yield jt.next(),e=Lt.done,!e;Nt=!0){Bt=Lt.value,Nt=!1;const zt=Bt;er.push(zt)}}catch(zt){At={error:zt}}finally{try{!Nt&&!e&&(kt=jt.return)&&(yield kt.call(jt))}finally{if(At)throw At.error}}return new Blob(er)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Blob is not supported.`)}})}toHex(){const e=Array.from({length:256},(At,kt)=>kt.toString(16).padStart(2,"0"));switch(this.format){case"ArrayBuffer":{const At=this.toUint8Array();return Ao.uint8Array(At).toHex()}case"Base64Url":{const At=this.toUint8Array();return Ao.uint8Array(At).toHex()}case"Uint8Array":{let At="";for(let kt=0;kt<this.data.length;kt++)At+=e[this.data[kt]];return At}default:throw new TypeError(`Conversion from ${this.format} to Hex is not supported.`)}}toMultibase(){switch(this.format){case"Base58Btc":return`z${this.data}`;default:throw new TypeError(`Conversion from ${this.format} to Multibase is not supported.`)}}toObject(){switch(this.format){case"Base64Url":{const e=base64url.baseDecode(this.data),At=textDecoder$3.decode(e);return JSON.parse(At)}case"String":return JSON.parse(this.data);case"Uint8Array":{const e=textDecoder$3.decode(this.data);return JSON.parse(e)}default:throw new TypeError(`Conversion from ${this.format} to Object is not supported.`)}}toObjectAsync(){return __awaiter$2B(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toStringAsync();return JSON.parse(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Object is not supported.`)}})}toString(){switch(this.format){case"ArrayBuffer":return textDecoder$3.decode(this.data);case"Base64Url":{const e=base64url.baseDecode(this.data);return textDecoder$3.decode(e)}case"Object":return JSON.stringify(this.data);case"Uint8Array":return textDecoder$3.decode(this.data);default:throw new TypeError(`Conversion from ${this.format} to String is not supported.`)}}toStringAsync(){return __awaiter$2B(this,void 0,void 0,function*(){var e,At,kt,Bt;switch(this.format){case"AsyncIterable":{let er="";try{for(var Nt=!0,jt=__asyncValues$9(this.data),Lt;Lt=yield jt.next(),e=Lt.done,!e;Nt=!0){Bt=Lt.value,Nt=!1;const tr=Bt;typeof tr=="string"?er+=tr:er+=textDecoder$3.decode(tr,{stream:!0})}}catch(tr){At={error:tr}}finally{try{!Nt&&!e&&(kt=jt.return)&&(yield kt.call(jt))}finally{if(At)throw At.error}}return er+=textDecoder$3.decode(void 0,{stream:!1}),er}default:throw new TypeError(`Asynchronous conversion from ${this.format} to String is not supported.`)}})}toUint8Array(){switch(this.format){case"ArrayBuffer":return new Uint8Array(this.data);case"Base32Z":return base32z.baseDecode(this.data);case"Base58Btc":return base58btc.baseDecode(this.data);case"Base64Url":return base64url.baseDecode(this.data);case"BufferSource":{const e=universalTypeOf$2(this.data);if(e==="Uint8Array")return this.data;if(e==="ArrayBuffer")return new Uint8Array(this.data);if(ArrayBuffer.isView(this.data))return new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength);throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":{const e=new Uint8Array(this.data.length/2);for(let At=0;At<this.data.length;At+=2){const kt=parseInt(this.data.substring(At,At+2),16);if(isNaN(kt))throw new TypeError("Input is not a valid hexadecimal string.");e[At/2]=kt}return e}case"Object":{const e=JSON.stringify(this.data);return textEncoder$4.encode(e)}case"String":return textEncoder$4.encode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Uint8Array is not supported.`)}}toUint8ArrayAsync(){return __awaiter$2B(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toArrayBufferAsync();return new Uint8Array(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Uint8Array is not supported.`)}})}};var encode_1=encode$6,MSB=128,REST=127,MSBALL=~REST,INT=Math.pow(2,31);function encode$6(xt,e,At){e=e||[],At=At||0;for(var kt=At;xt>=INT;)e[At++]=xt&255|MSB,xt/=128;for(;xt&MSBALL;)e[At++]=xt&255|MSB,xt>>>=7;return e[At]=xt|0,encode$6.bytes=At-kt+1,e}var decode$6=read,MSB$1=128,REST$1=127;function read(xt,kt){var At=0,kt=kt||0,Bt=0,Nt=kt,jt,Lt=xt.length;do{if(Nt>=Lt)throw read.bytes=0,new RangeError("Could not decode varint");jt=xt[Nt++],At+=Bt<28?(jt&REST$1)<<Bt:(jt&REST$1)*Math.pow(2,Bt),Bt+=7}while(jt>=MSB$1);return read.bytes=Nt-kt,At}var N1=Math.pow(2,7),N2=Math.pow(2,14),N3=Math.pow(2,21),N4=Math.pow(2,28),N5=Math.pow(2,35),N6=Math.pow(2,42),N7=Math.pow(2,49),N8=Math.pow(2,56),N9=Math.pow(2,63),length=function(xt){return xt<N1?1:xt<N2?2:xt<N3?3:xt<N4?4:xt<N5?5:xt<N6?6:xt<N7?7:xt<N8?8:xt<N9?9:10},varint={encode:encode_1,decode:decode$6,encodingLength:length},_brrp_varint=varint;function decode$5(xt,e=0){return[_brrp_varint.decode(xt,e),_brrp_varint.decode.bytes]}function encodeTo(xt,e,At=0){return _brrp_varint.encode(xt,e,At),e}function encodingLength$4(xt){return _brrp_varint.encodingLength(xt)}let Multicodec$2=class ts{static addPrefix(e){var At;let{code:kt,data:Bt,name:Nt}=e;if(!(Nt?!kt:kt))throw new Error("Either 'name' or 'code' must be defined, but not both.");if(kt=ts.codeToName.has(kt)?kt:ts.nameToCode.get(Nt),kt===void 0)throw new Error(`Unsupported multicodec: ${(At=e.name)!==null&&At!==void 0?At:e.code}`);const jt=encodingLength$4(kt),Lt=new Uint8Array(jt+Bt.byteLength);return Lt.set(Bt,jt),encodeTo(kt,Lt),Lt}static getCodeFromData(e){const{prefixedData:At}=e,[kt,Bt]=decode$5(At);return kt}static getCodeFromName(e){const{name:At}=e,kt=ts.nameToCode.get(At);if(kt===void 0)throw new Error(`Unsupported multicodec: ${At}`);return kt}static getNameFromCode(e){const{code:At}=e,kt=ts.codeToName.get(At);if(kt===void 0)throw new Error(`Unsupported multicodec: ${At}`);return kt}static registerCodec(e){ts.codeToName.set(e.code,e.name),ts.nameToCode.set(e.name,e.code)}static removePrefix(e){const{prefixedData:At}=e,[kt,Bt]=decode$5(At),Nt=ts.codeToName.get(kt);if(Nt===void 0)throw new Error(`Unsupported multicodec: ${kt}`);return{code:kt,data:At.slice(Bt),name:Nt}}};Multicodec$2.codeToName=new Map;Multicodec$2.nameToCode=new Map;Multicodec$2.registerCodec({code:237,name:"ed25519-pub"});Multicodec$2.registerCodec({code:4864,name:"ed25519-priv"});Multicodec$2.registerCodec({code:236,name:"x25519-pub"});Multicodec$2.registerCodec({code:4866,name:"x25519-priv"});Multicodec$2.registerCodec({code:231,name:"secp256k1-pub"});Multicodec$2.registerCodec({code:4865,name:"secp256k1-priv"});function removeUndefinedProperties$2(xt){Object.keys(xt).forEach(e=>{xt[e]===void 0?delete xt[e]:typeof xt[e]=="object"&&removeUndefinedProperties$2(xt[e])})}var browserLevel={},abstractLevel$1={},abstractLevel={},levelSupports={};levelSupports.supports=function xt(...e){const At=e.reduce((kt,Bt)=>Object.assign(kt,Bt),{});return Object.assign(At,{snapshots:At.snapshots||!1,permanence:At.permanence||!1,seek:At.seek||!1,clear:At.clear||!1,getMany:At.getMany||!1,keyIterator:At.keyIterator||!1,valueIterator:At.valueIterator||!1,iteratorNextv:At.iteratorNextv||!1,iteratorAll:At.iteratorAll||!1,status:At.status||!1,createIfMissing:At.createIfMissing||!1,errorIfExists:At.errorIfExists||!1,deferredOpen:At.deferredOpen||!1,promises:At.promises||!1,streams:At.streams||!1,encodings:Object.assign({},At.encodings),events:Object.assign({},At.events),additionalMethods:Object.assign({},At.additionalMethods)})};var levelTranscoder={},moduleError=class extends Error{constructor(e,At){super(e||""),typeof At=="object"&&At!==null&&(At.code&&(this.code=String(At.code)),At.expected&&(this.expected=!0),At.transient&&(this.transient=!0),At.cause&&(this.cause=At.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},encodings$1={};let lazy=null;var textEndec$1=function(){return lazy===null&&(lazy={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),lazy},formats$2={},encoding={};const ModuleError$8=moduleError,formats$1=new Set(["buffer","view","utf8"]);let Encoding$2=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,typeof this.encode!="function")throw new TypeError("The 'encode' property must be a function");if(typeof this.decode!="function")throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),typeof this.name!="string"||this.name==="")throw new TypeError("The 'name' property must be a string");if(typeof this.format!="string"||!formats$1.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new ModuleError$8(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new ModuleError$8(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new ModuleError$8(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};encoding.Encoding=Encoding$2;const{Buffer:Buffer$3}=buffer$2||{},{Encoding:Encoding$1}=encoding,textEndec=textEndec$1;let BufferFormat$2=class extends Encoding$1{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new ViewFormat$2({encode:this.encode,decode:e=>this.decode(Buffer$3.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},ViewFormat$2=class extends Encoding$1{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new BufferFormat$2({encode:e=>{const At=this.encode(e);return Buffer$3.from(At.buffer,At.byteOffset,At.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}},UTF8Format$2=class extends Encoding$1{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new BufferFormat$2({encode:e=>Buffer$3.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:At}=textEndec();return new ViewFormat$2({encode:kt=>e.encode(this.encode(kt)),decode:kt=>this.decode(At.decode(kt)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};formats$2.BufferFormat=BufferFormat$2;formats$2.ViewFormat=ViewFormat$2;formats$2.UTF8Format=UTF8Format$2;const{Buffer:Buffer$2}=buffer$2||{Buffer:{isBuffer:()=>!1}},{textEncoder:textEncoder$3,textDecoder:textDecoder$2}=textEndec$1(),{BufferFormat:BufferFormat$1,ViewFormat:ViewFormat$1,UTF8Format:UTF8Format$1}=formats$2,identity$1=xt=>xt;encodings$1.utf8=new UTF8Format$1({encode:function(xt){return Buffer$2.isBuffer(xt)?xt.toString("utf8"):ArrayBuffer.isView(xt)?textDecoder$2.decode(xt):String(xt)},decode:identity$1,name:"utf8",createViewTranscoder(){return new ViewFormat$1({encode:function(xt){return ArrayBuffer.isView(xt)?xt:textEncoder$3.encode(xt)},decode:function(xt){return textDecoder$2.decode(xt)},name:`${this.name}+view`})},createBufferTranscoder(){return new BufferFormat$1({encode:function(xt){return Buffer$2.isBuffer(xt)?xt:ArrayBuffer.isView(xt)?Buffer$2.from(xt.buffer,xt.byteOffset,xt.byteLength):Buffer$2.from(String(xt),"utf8")},decode:function(xt){return xt.toString("utf8")},name:`${this.name}+buffer`})}});encodings$1.json=new UTF8Format$1({encode:JSON.stringify,decode:JSON.parse,name:"json"});encodings$1.buffer=new BufferFormat$1({encode:function(xt){return Buffer$2.isBuffer(xt)?xt:ArrayBuffer.isView(xt)?Buffer$2.from(xt.buffer,xt.byteOffset,xt.byteLength):Buffer$2.from(String(xt),"utf8")},decode:identity$1,name:"buffer",createViewTranscoder(){return new ViewFormat$1({encode:function(xt){return ArrayBuffer.isView(xt)?xt:Buffer$2.from(String(xt),"utf8")},decode:function(xt){return Buffer$2.from(xt.buffer,xt.byteOffset,xt.byteLength)},name:`${this.name}+view`})}});encodings$1.view=new ViewFormat$1({encode:function(xt){return ArrayBuffer.isView(xt)?xt:textEncoder$3.encode(xt)},decode:identity$1,name:"view",createBufferTranscoder(){return new BufferFormat$1({encode:function(xt){return Buffer$2.isBuffer(xt)?xt:ArrayBuffer.isView(xt)?Buffer$2.from(xt.buffer,xt.byteOffset,xt.byteLength):Buffer$2.from(String(xt),"utf8")},decode:identity$1,name:`${this.name}+buffer`})}});encodings$1.hex=new BufferFormat$1({encode:function(xt){return Buffer$2.isBuffer(xt)?xt:Buffer$2.from(String(xt),"hex")},decode:function(xt){return xt.toString("hex")},name:"hex"});encodings$1.base64=new BufferFormat$1({encode:function(xt){return Buffer$2.isBuffer(xt)?xt:Buffer$2.from(String(xt),"base64")},decode:function(xt){return xt.toString("base64")},name:"base64"});const ModuleError$7=moduleError,encodings=encodings$1,{Encoding}=encoding,{BufferFormat,ViewFormat,UTF8Format}=formats$2,kFormats=Symbol("formats"),kEncodings=Symbol("encodings"),validFormats=new Set(["buffer","view","utf8"]);let Transcoder$1=class{constructor(e){if(Array.isArray(e)){if(!e.every(At=>validFormats.has(At)))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}else throw new TypeError("The first argument 'formats' must be an array");this[kEncodings]=new Map,this[kFormats]=new Set(e);for(const At in encodings)try{this.encoding(At)}catch(kt){if(kt.code!=="LEVEL_ENCODING_NOT_SUPPORTED")throw kt}}encodings(){return Array.from(new Set(this[kEncodings].values()))}encoding(e){let At=this[kEncodings].get(e);if(At===void 0){if(typeof e=="string"&&e!==""){if(At=lookup$1[e],!At)throw new ModuleError$7(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if(typeof e!="object"||e===null)throw new TypeError("First argument 'encoding' must be a string or object");At=from$2(e)}const{name:kt,format:Bt}=At;if(!this[kFormats].has(Bt))if(this[kFormats].has("view"))At=At.createViewTranscoder();else if(this[kFormats].has("buffer"))At=At.createBufferTranscoder();else if(this[kFormats].has("utf8"))At=At.createUTF8Transcoder();else throw new ModuleError$7(`Encoding '${kt}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});for(const Nt of[e,kt,At.name,At.commonName])this[kEncodings].set(Nt,At)}return At}};levelTranscoder.Transcoder=Transcoder$1;function from$2(xt){if(xt instanceof Encoding)return xt;const e="type"in xt&&typeof xt.type=="string"?xt.type:void 0,At=xt.name||e||`anonymous-${anonymousCount++}`;switch(detectFormat(xt)){case"view":return new ViewFormat({...xt,name:At});case"utf8":return new UTF8Format({...xt,name:At});case"buffer":return new BufferFormat({...xt,name:At});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function detectFormat(xt){return"format"in xt&&xt.format!==void 0?xt.format:"buffer"in xt&&typeof xt.buffer=="boolean"?xt.buffer?"buffer":"utf8":"code"in xt&&Number.isInteger(xt.code)?"view":"buffer"}const aliases={binary:encodings.buffer,"utf-8":encodings.utf8},lookup$1={...encodings,...aliases};let anonymousCount=0;var catering={},nextTickBrowser$1=typeof queueMicrotask=="function"?queueMicrotask:xt=>Promise.resolve().then(xt),nextTick$1=nextTickBrowser$1;catering.fromCallback=function(xt,e){if(xt===void 0){var At=new Promise(function(kt,Bt){xt=function(Nt,jt){Nt?Bt(Nt):kt(jt)}});xt[e!==void 0?e:"promise"]=At}else if(typeof xt!="function")throw new TypeError("Callback must be a function");return xt};catering.fromPromise=function(xt,e){if(e===void 0)return xt;xt.then(function(At){nextTick$1(()=>e(null,At))}).catch(function(At){nextTick$1(()=>e(At))})};var abstractIterator={},common={};common.getCallback=function(xt,e){return typeof xt=="function"?xt:e};common.getOptions=function(xt,e){return typeof xt=="object"&&xt!==null?xt:e!==void 0?e:{}};const{fromCallback:fromCallback$3}=catering,ModuleError$6=moduleError,{getOptions:getOptions$2,getCallback:getCallback$2}=common,kPromise$3=Symbol("promise"),kCallback$2=Symbol("callback"),kWorking=Symbol("working"),kHandleOne$1=Symbol("handleOne"),kHandleMany$1=Symbol("handleMany"),kAutoClose=Symbol("autoClose"),kFinishWork=Symbol("finishWork"),kReturnMany=Symbol("returnMany"),kClosing=Symbol("closing"),kHandleClose=Symbol("handleClose"),kClosed=Symbol("closed"),kCloseCallbacks$1=Symbol("closeCallbacks"),kKeyEncoding$1=Symbol("keyEncoding"),kValueEncoding$1=Symbol("valueEncoding"),kAbortOnClose=Symbol("abortOnClose"),kLegacy=Symbol("legacy"),kKeys=Symbol("keys"),kValues=Symbol("values"),kLimit=Symbol("limit"),kCount=Symbol("count"),emptyOptions$1=Object.freeze({}),noop$1=()=>{};let warnedEnd=!1;class CommonIterator{constructor(e,At,kt){if(typeof e!="object"||e===null){const Bt=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${Bt}`)}if(typeof At!="object"||At===null)throw new TypeError("The second argument must be an options object");this[kClosed]=!1,this[kCloseCallbacks$1]=[],this[kWorking]=!1,this[kClosing]=!1,this[kAutoClose]=!1,this[kCallback$2]=null,this[kHandleOne$1]=this[kHandleOne$1].bind(this),this[kHandleMany$1]=this[kHandleMany$1].bind(this),this[kHandleClose]=this[kHandleClose].bind(this),this[kKeyEncoding$1]=At[kKeyEncoding$1],this[kValueEncoding$1]=At[kValueEncoding$1],this[kLegacy]=kt,this[kLimit]=Number.isInteger(At.limit)&&At.limit>=0?At.limit:1/0,this[kCount]=0,this[kAbortOnClose]=!!At.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[kCount]}get limit(){return this[kLimit]}next(e){let At;if(e===void 0)At=new Promise((kt,Bt)=>{e=(Nt,jt,Lt)=>{Nt?Bt(Nt):this[kLegacy]?jt===void 0&&Lt===void 0?kt():kt([jt,Lt]):kt(jt)}});else if(typeof e!="function")throw new TypeError("Callback must be a function");return this[kClosing]?this.nextTick(e,new ModuleError$6("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[kWorking]?this.nextTick(e,new ModuleError$6("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[kWorking]=!0,this[kCallback$2]=e,this[kCount]>=this[kLimit]?this.nextTick(this[kHandleOne$1],null):this._next(this[kHandleOne$1])),At}_next(e){this.nextTick(e)}nextv(e,At,kt){return kt=getCallback$2(At,kt),kt=fromCallback$3(kt,kPromise$3),At=getOptions$2(At,emptyOptions$1),Number.isInteger(e)?(this[kClosing]?this.nextTick(kt,new ModuleError$6("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[kWorking]?this.nextTick(kt,new ModuleError$6("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[kLimit]<1/0&&(e=Math.min(e,this[kLimit]-this[kCount])),this[kWorking]=!0,this[kCallback$2]=kt,e<=0?this.nextTick(this[kHandleMany$1],null,[]):this._nextv(e,At,this[kHandleMany$1])),kt[kPromise$3]):(this.nextTick(kt,new TypeError("The first argument 'size' must be an integer")),kt[kPromise$3])}_nextv(e,At,kt){const Bt=[],Nt=(jt,Lt,er)=>{if(jt)return kt(jt);if(this[kLegacy]?Lt===void 0&&er===void 0:Lt===void 0)return kt(null,Bt);Bt.push(this[kLegacy]?[Lt,er]:Lt),Bt.length===e?kt(null,Bt):this._next(Nt)};this._next(Nt)}all(e,At){return At=getCallback$2(e,At),At=fromCallback$3(At,kPromise$3),e=getOptions$2(e,emptyOptions$1),this[kClosing]?this.nextTick(At,new ModuleError$6("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[kWorking]?this.nextTick(At,new ModuleError$6("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[kWorking]=!0,this[kCallback$2]=At,this[kAutoClose]=!0,this[kCount]>=this[kLimit]?this.nextTick(this[kHandleMany$1],null,[]):this._all(e,this[kHandleMany$1])),At[kPromise$3]}_all(e,At){let kt=this[kCount];const Bt=[],Nt=()=>{const Lt=this[kLimit]<1/0?Math.min(1e3,this[kLimit]-kt):1e3;Lt<=0?this.nextTick(At,null,Bt):this._nextv(Lt,emptyOptions$1,jt)},jt=(Lt,er)=>{Lt?At(Lt):er.length===0?At(null,Bt):(Bt.push.apply(Bt,er),kt+=er.length,Nt())};Nt()}[kFinishWork](){const e=this[kCallback$2];return this[kAbortOnClose]&&e===null?noop$1:(this[kWorking]=!1,this[kCallback$2]=null,this[kClosing]&&this._close(this[kHandleClose]),e)}[kReturnMany](e,At,kt){this[kAutoClose]?this.close(e.bind(null,At,kt)):e(At,kt)}seek(e,At){if(At=getOptions$2(At,emptyOptions$1),!this[kClosing]){if(this[kWorking])throw new ModuleError$6("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const kt=this.db.keyEncoding(At.keyEncoding||this[kKeyEncoding$1]),Bt=kt.format;At.keyEncoding!==Bt&&(At={...At,keyEncoding:Bt});const Nt=this.db.prefixKey(kt.encode(e),Bt);this._seek(Nt,At)}}}_seek(e,At){throw new ModuleError$6("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){return e=fromCallback$3(e,kPromise$3),this[kClosed]?this.nextTick(e):this[kClosing]?this[kCloseCallbacks$1].push(e):(this[kClosing]=!0,this[kCloseCallbacks$1].push(e),this[kWorking]?this[kAbortOnClose]&&this[kFinishWork]()(new ModuleError$6("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this._close(this[kHandleClose])),e[kPromise$3]}_close(e){this.nextTick(e)}[kHandleClose](){this[kClosed]=!0,this.db.detachResource(this);const e=this[kCloseCallbacks$1];this[kCloseCallbacks$1]=[];for(const At of e)At()}async*[Symbol.asyncIterator](){try{let e;for(;(e=await this.next())!==void 0;)yield e}finally{this[kClosed]||await this.close()}}}let AbstractIterator$3=class extends CommonIterator{constructor(e,At){super(e,At,!0),this[kKeys]=At.keys!==!1,this[kValues]=At.values!==!1}[kHandleOne$1](e,At,kt){const Bt=this[kFinishWork]();if(e)return Bt(e);try{At=this[kKeys]&&At!==void 0?this[kKeyEncoding$1].decode(At):void 0,kt=this[kValues]&&kt!==void 0?this[kValueEncoding$1].decode(kt):void 0}catch(Nt){return Bt(new IteratorDecodeError("entry",Nt))}At===void 0&&kt===void 0||this[kCount]++,Bt(null,At,kt)}[kHandleMany$1](e,At){const kt=this[kFinishWork]();if(e)return this[kReturnMany](kt,e);try{for(const Bt of At){const Nt=Bt[0],jt=Bt[1];Bt[0]=this[kKeys]&&Nt!==void 0?this[kKeyEncoding$1].decode(Nt):void 0,Bt[1]=this[kValues]&&jt!==void 0?this[kValueEncoding$1].decode(jt):void 0}}catch(Bt){return this[kReturnMany](kt,new IteratorDecodeError("entries",Bt))}this[kCount]+=At.length,this[kReturnMany](kt,null,At)}end(e){return!warnedEnd&&typeof console<"u"&&(warnedEnd=!0,console.warn(new ModuleError$6("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}},AbstractKeyIterator$2=class extends CommonIterator{constructor(e,At){super(e,At,!1)}[kHandleOne$1](e,At){const kt=this[kFinishWork]();if(e)return kt(e);try{At=At!==void 0?this[kKeyEncoding$1].decode(At):void 0}catch(Bt){return kt(new IteratorDecodeError("key",Bt))}At!==void 0&&this[kCount]++,kt(null,At)}[kHandleMany$1](e,At){const kt=this[kFinishWork]();if(e)return this[kReturnMany](kt,e);try{for(let Bt=0;Bt<At.length;Bt++){const Nt=At[Bt];At[Bt]=Nt!==void 0?this[kKeyEncoding$1].decode(Nt):void 0}}catch(Bt){return this[kReturnMany](kt,new IteratorDecodeError("keys",Bt))}this[kCount]+=At.length,this[kReturnMany](kt,null,At)}},AbstractValueIterator$2=class extends CommonIterator{constructor(e,At){super(e,At,!1)}[kHandleOne$1](e,At){const kt=this[kFinishWork]();if(e)return kt(e);try{At=At!==void 0?this[kValueEncoding$1].decode(At):void 0}catch(Bt){return kt(new IteratorDecodeError("value",Bt))}At!==void 0&&this[kCount]++,kt(null,At)}[kHandleMany$1](e,At){const kt=this[kFinishWork]();if(e)return this[kReturnMany](kt,e);try{for(let Bt=0;Bt<At.length;Bt++){const Nt=At[Bt];At[Bt]=Nt!==void 0?this[kValueEncoding$1].decode(Nt):void 0}}catch(Bt){return this[kReturnMany](kt,new IteratorDecodeError("values",Bt))}this[kCount]+=At.length,this[kReturnMany](kt,null,At)}};class IteratorDecodeError extends ModuleError$6{constructor(e,At){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:At})}}for(const xt of["_ended property","_nexting property","_end method"])Object.defineProperty(AbstractIterator$3.prototype,xt.split(" ")[0],{get(){throw new ModuleError$6(`The ${xt} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new ModuleError$6(`The ${xt} has been removed`,{code:"LEVEL_LEGACY"})}});AbstractIterator$3.keyEncoding=kKeyEncoding$1;AbstractIterator$3.valueEncoding=kValueEncoding$1;abstractIterator.AbstractIterator=AbstractIterator$3;abstractIterator.AbstractKeyIterator=AbstractKeyIterator$2;abstractIterator.AbstractValueIterator=AbstractValueIterator$2;var defaultKvIterator={};const{AbstractKeyIterator:AbstractKeyIterator$1,AbstractValueIterator:AbstractValueIterator$1}=abstractIterator,kIterator=Symbol("iterator"),kCallback$1=Symbol("callback"),kHandleOne=Symbol("handleOne"),kHandleMany=Symbol("handleMany");let DefaultKeyIterator$1=class extends AbstractKeyIterator$1{constructor(e,At){super(e,At),this[kIterator]=e.iterator({...At,keys:!0,values:!1}),this[kHandleOne]=this[kHandleOne].bind(this),this[kHandleMany]=this[kHandleMany].bind(this)}},DefaultValueIterator$1=class extends AbstractValueIterator$1{constructor(e,At){super(e,At),this[kIterator]=e.iterator({...At,keys:!1,values:!0}),this[kHandleOne]=this[kHandleOne].bind(this),this[kHandleMany]=this[kHandleMany].bind(this)}};for(const xt of[DefaultKeyIterator$1,DefaultValueIterator$1]){const e=xt===DefaultKeyIterator$1,At=e?kt=>kt[0]:kt=>kt[1];xt.prototype._next=function(kt){this[kCallback$1]=kt,this[kIterator].next(this[kHandleOne])},xt.prototype[kHandleOne]=function(kt,Bt,Nt){const jt=this[kCallback$1];kt?jt(kt):jt(null,e?Bt:Nt)},xt.prototype._nextv=function(kt,Bt,Nt){this[kCallback$1]=Nt,this[kIterator].nextv(kt,Bt,this[kHandleMany])},xt.prototype._all=function(kt,Bt){this[kCallback$1]=Bt,this[kIterator].all(kt,this[kHandleMany])},xt.prototype[kHandleMany]=function(kt,Bt){const Nt=this[kCallback$1];kt?Nt(kt):Nt(null,Bt.map(At))},xt.prototype._seek=function(kt,Bt){this[kIterator].seek(kt,Bt)},xt.prototype._close=function(kt){this[kIterator].close(kt)}}defaultKvIterator.DefaultKeyIterator=DefaultKeyIterator$1;defaultKvIterator.DefaultValueIterator=DefaultValueIterator$1;var deferredIterator={};const{AbstractIterator:AbstractIterator$2,AbstractKeyIterator,AbstractValueIterator}=abstractIterator,ModuleError$5=moduleError,kNut=Symbol("nut"),kUndefer$1=Symbol("undefer"),kFactory=Symbol("factory");let DeferredIterator$1=class extends AbstractIterator$2{constructor(e,At){super(e,At),this[kNut]=null,this[kFactory]=()=>e.iterator(At),this.db.defer(()=>this[kUndefer$1]())}},DeferredKeyIterator$1=class extends AbstractKeyIterator{constructor(e,At){super(e,At),this[kNut]=null,this[kFactory]=()=>e.keys(At),this.db.defer(()=>this[kUndefer$1]())}},DeferredValueIterator$1=class extends AbstractValueIterator{constructor(e,At){super(e,At),this[kNut]=null,this[kFactory]=()=>e.values(At),this.db.defer(()=>this[kUndefer$1]())}};for(const xt of[DeferredIterator$1,DeferredKeyIterator$1,DeferredValueIterator$1])xt.prototype[kUndefer$1]=function(){this.db.status==="open"&&(this[kNut]=this[kFactory]())},xt.prototype._next=function(e){this[kNut]!==null?this[kNut].next(e):this.db.status==="opening"?this.db.defer(()=>this._next(e)):this.nextTick(e,new ModuleError$5("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},xt.prototype._nextv=function(e,At,kt){this[kNut]!==null?this[kNut].nextv(e,At,kt):this.db.status==="opening"?this.db.defer(()=>this._nextv(e,At,kt)):this.nextTick(kt,new ModuleError$5("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},xt.prototype._all=function(e,At){this[kNut]!==null?this[kNut].all(At):this.db.status==="opening"?this.db.defer(()=>this._all(e,At)):this.nextTick(At,new ModuleError$5("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},xt.prototype._seek=function(e,At){this[kNut]!==null?this[kNut]._seek(e,At):this.db.status==="opening"&&this.db.defer(()=>this._seek(e,At))},xt.prototype._close=function(e){this[kNut]!==null?this[kNut].close(e):this.db.status==="opening"?this.db.defer(()=>this._close(e)):this.nextTick(e)};deferredIterator.DeferredIterator=DeferredIterator$1;deferredIterator.DeferredKeyIterator=DeferredKeyIterator$1;deferredIterator.DeferredValueIterator=DeferredValueIterator$1;var defaultChainedBatch={},abstractChainedBatch={};const{fromCallback:fromCallback$2}=catering,ModuleError$4=moduleError,{getCallback:getCallback$1,getOptions:getOptions$1}=common,kPromise$2=Symbol("promise"),kStatus$1=Symbol("status"),kOperations$1=Symbol("operations"),kFinishClose=Symbol("finishClose"),kCloseCallbacks=Symbol("closeCallbacks");let AbstractChainedBatch$1=class{constructor(e){if(typeof e!="object"||e===null){const At=e===null?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${At}`)}this[kOperations$1]=[],this[kCloseCallbacks]=[],this[kStatus$1]="open",this[kFinishClose]=this[kFinishClose].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[kOperations$1].length}put(e,At,kt){if(this[kStatus$1]!=="open")throw new ModuleError$4("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const Bt=this.db._checkKey(e)||this.db._checkValue(At);if(Bt)throw Bt;const Nt=kt&&kt.sublevel!=null?kt.sublevel:this.db,jt=kt,Lt=Nt.keyEncoding(kt&&kt.keyEncoding),er=Nt.valueEncoding(kt&&kt.valueEncoding),tr=Lt.format;kt={...kt,keyEncoding:tr,valueEncoding:er.format},Nt!==this.db&&(kt.sublevel=null);const zt=Nt.prefixKey(Lt.encode(e),tr),rr=er.encode(At);return this._put(zt,rr,kt),this[kOperations$1].push({...jt,type:"put",key:e,value:At}),this}_put(e,At,kt){}del(e,At){if(this[kStatus$1]!=="open")throw new ModuleError$4("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const kt=this.db._checkKey(e);if(kt)throw kt;const Bt=At&&At.sublevel!=null?At.sublevel:this.db,Nt=At,jt=Bt.keyEncoding(At&&At.keyEncoding),Lt=jt.format;return At={...At,keyEncoding:Lt},Bt!==this.db&&(At.sublevel=null),this._del(Bt.prefixKey(jt.encode(e),Lt),At),this[kOperations$1].push({...Nt,type:"del",key:e}),this}_del(e,At){}clear(){if(this[kStatus$1]!=="open")throw new ModuleError$4("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[kOperations$1]=[],this}_clear(){}write(e,At){return At=getCallback$1(e,At),At=fromCallback$2(At,kPromise$2),e=getOptions$1(e),this[kStatus$1]!=="open"?this.nextTick(At,new ModuleError$4("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):this.length===0?this.close(At):(this[kStatus$1]="writing",this._write(e,kt=>{this[kStatus$1]="closing",this[kCloseCallbacks].push(()=>At(kt)),kt||this.db.emit("batch",this[kOperations$1]),this._close(this[kFinishClose])})),At[kPromise$2]}_write(e,At){}close(e){return e=fromCallback$2(e,kPromise$2),this[kStatus$1]==="closing"?this[kCloseCallbacks].push(e):this[kStatus$1]==="closed"?this.nextTick(e):(this[kCloseCallbacks].push(e),this[kStatus$1]!=="writing"&&(this[kStatus$1]="closing",this._close(this[kFinishClose]))),e[kPromise$2]}_close(e){this.nextTick(e)}[kFinishClose](){this[kStatus$1]="closed",this.db.detachResource(this);const e=this[kCloseCallbacks];this[kCloseCallbacks]=[];for(const At of e)At()}};abstractChainedBatch.AbstractChainedBatch=AbstractChainedBatch$1;const{AbstractChainedBatch}=abstractChainedBatch,ModuleError$3=moduleError,kEncoded=Symbol("encoded");let DefaultChainedBatch$1=class extends AbstractChainedBatch{constructor(e){super(e),this[kEncoded]=[]}_put(e,At,kt){this[kEncoded].push({...kt,type:"put",key:e,value:At})}_del(e,At){this[kEncoded].push({...At,type:"del",key:e})}_clear(){this[kEncoded]=[]}_write(e,At){this.db.status==="opening"?this.db.defer(()=>this._write(e,At)):this.db.status==="open"?this[kEncoded].length===0?this.nextTick(At):this.db._batch(this[kEncoded],e,At):this.nextTick(At,new ModuleError$3("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}};defaultChainedBatch.DefaultChainedBatch=DefaultChainedBatch$1;const ModuleError$2=moduleError,hasOwnProperty=Object.prototype.hasOwnProperty,rangeOptions$1=new Set(["lt","lte","gt","gte"]);var rangeOptions_1=function(xt,e){const At={};for(const kt in xt)if(hasOwnProperty.call(xt,kt)&&!(kt==="keyEncoding"||kt==="valueEncoding")){if(kt==="start"||kt==="end")throw new ModuleError$2(`The legacy range option '${kt}' has been removed`,{code:"LEVEL_LEGACY"});if(kt==="encoding")throw new ModuleError$2("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});rangeOptions$1.has(kt)?At[kt]=e.encode(xt[kt]):At[kt]=xt[kt]}return At.reverse=!!At.reverse,At.limit=Number.isInteger(At.limit)&&At.limit>=0?At.limit:-1,At};/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let promise;var queueMicrotask_1=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:globalThis):xt=>(promise||(promise=Promise.resolve())).then(xt).catch(e=>setTimeout(()=>{throw e},0)),nextTickBrowser,hasRequiredNextTickBrowser;function requireNextTickBrowser(){if(hasRequiredNextTickBrowser)return nextTickBrowser;hasRequiredNextTickBrowser=1;const xt=queueMicrotask_1;return nextTickBrowser=function(e,...At){At.length===0?xt(e):xt(()=>e(...At))},nextTickBrowser}var abstractSublevelIterator={},hasRequiredAbstractSublevelIterator;function requireAbstractSublevelIterator(){if(hasRequiredAbstractSublevelIterator)return abstractSublevelIterator;hasRequiredAbstractSublevelIterator=1;const{AbstractIterator:xt,AbstractKeyIterator:e,AbstractValueIterator:At}=abstractIterator,kt=Symbol("unfix"),Bt=Symbol("iterator"),Nt=Symbol("handleOne"),jt=Symbol("handleMany"),Lt=Symbol("callback");class er extends xt{constructor(nr,ir,ar,dr){super(nr,ir),this[Bt]=ar,this[kt]=dr,this[Nt]=this[Nt].bind(this),this[jt]=this[jt].bind(this),this[Lt]=null}[Nt](nr,ir,ar){const dr=this[Lt];if(nr)return dr(nr);ir!==void 0&&(ir=this[kt](ir)),dr(nr,ir,ar)}[jt](nr,ir){const ar=this[Lt];if(nr)return ar(nr);for(const dr of ir){const ur=dr[0];ur!==void 0&&(dr[0]=this[kt](ur))}ar(nr,ir)}}class tr extends e{constructor(nr,ir,ar,dr){super(nr,ir),this[Bt]=ar,this[kt]=dr,this[Nt]=this[Nt].bind(this),this[jt]=this[jt].bind(this),this[Lt]=null}[Nt](nr,ir){const ar=this[Lt];if(nr)return ar(nr);ir!==void 0&&(ir=this[kt](ir)),ar(nr,ir)}[jt](nr,ir){const ar=this[Lt];if(nr)return ar(nr);for(let dr=0;dr<ir.length;dr++){const ur=ir[dr];ur!==void 0&&(ir[dr]=this[kt](ur))}ar(nr,ir)}}class zt extends At{constructor(nr,ir,ar){super(nr,ir),this[Bt]=ar}}for(const rr of[er,tr])rr.prototype._next=function(nr){this[Lt]=nr,this[Bt].next(this[Nt])},rr.prototype._nextv=function(nr,ir,ar){this[Lt]=ar,this[Bt].nextv(nr,ir,this[jt])},rr.prototype._all=function(nr,ir){this[Lt]=ir,this[Bt].all(nr,this[jt])};for(const rr of[zt])rr.prototype._next=function(nr){this[Bt].next(nr)},rr.prototype._nextv=function(nr,ir,ar){this[Bt].nextv(nr,ir,ar)},rr.prototype._all=function(nr,ir){this[Bt].all(nr,ir)};for(const rr of[er,tr,zt])rr.prototype._seek=function(nr,ir){this[Bt].seek(nr,ir)},rr.prototype._close=function(nr){this[Bt].close(nr)};return abstractSublevelIterator.AbstractSublevelIterator=er,abstractSublevelIterator.AbstractSublevelKeyIterator=tr,abstractSublevelIterator.AbstractSublevelValueIterator=zt,abstractSublevelIterator}var abstractSublevel,hasRequiredAbstractSublevel;function requireAbstractSublevel(){if(hasRequiredAbstractSublevel)return abstractSublevel;hasRequiredAbstractSublevel=1;const xt=moduleError,{Buffer:e}=buffer$2||{},{AbstractSublevelIterator:At,AbstractSublevelKeyIterator:kt,AbstractSublevelValueIterator:Bt}=requireAbstractSublevelIterator(),Nt=Symbol("prefix"),jt=Symbol("upperBound"),Lt=Symbol("prefixRange"),er=Symbol("parent"),tr=Symbol("unfix"),zt=new TextEncoder,rr={separator:"!"};abstractSublevel=function({AbstractLevel:fr}){class pr extends fr{static defaults(yr){if(typeof yr=="string")throw new xt("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(yr&&yr.open)throw new xt("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return yr==null?rr:yr.separator?yr:{...yr,separator:"!"}}constructor(yr,br,Ar){const{separator:Pr,manifest:kr,...Ur}=pr.defaults(Ar);br=ur(br,Pr);const Hr=Pr.charCodeAt(0)+1,Lr=yr[er]||yr;if(!zt.encode(br).every(gr=>gr>Hr&&gr<127))throw new xt(`Prefix must use bytes > ${Hr} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(nr(Lr,kr),Ur);const Sr=(yr.prefix||"")+Pr+br+Pr,_r=Sr.slice(0,-1)+String.fromCharCode(Hr);this[er]=Lr,this[Nt]=new ar(Sr),this[jt]=new ar(_r),this[tr]=new dr,this.nextTick=Lr.nextTick}prefixKey(yr,br){if(br==="utf8")return this[Nt].utf8+yr;if(yr.byteLength===0)return this[Nt][br];if(br==="view"){const Ar=this[Nt].view,Pr=new Uint8Array(Ar.byteLength+yr.byteLength);return Pr.set(Ar,0),Pr.set(yr,Ar.byteLength),Pr}else{const Ar=this[Nt].buffer;return e.concat([Ar,yr],Ar.byteLength+yr.byteLength)}}[Lt](yr,br){yr.gte!==void 0?yr.gte=this.prefixKey(yr.gte,br):yr.gt!==void 0?yr.gt=this.prefixKey(yr.gt,br):yr.gte=this[Nt][br],yr.lte!==void 0?yr.lte=this.prefixKey(yr.lte,br):yr.lt!==void 0?yr.lt=this.prefixKey(yr.lt,br):yr.lte=this[jt][br]}get prefix(){return this[Nt].utf8}get db(){return this[er]}_open(yr,br){this[er].open({passive:!0},br)}_put(yr,br,Ar,Pr){this[er].put(yr,br,Ar,Pr)}_get(yr,br,Ar){this[er].get(yr,br,Ar)}_getMany(yr,br,Ar){this[er].getMany(yr,br,Ar)}_del(yr,br,Ar){this[er].del(yr,br,Ar)}_batch(yr,br,Ar){this[er].batch(yr,br,Ar)}_clear(yr,br){this[Lt](yr,yr.keyEncoding),this[er].clear(yr,br)}_iterator(yr){this[Lt](yr,yr.keyEncoding);const br=this[er].iterator(yr),Ar=this[tr].get(this[Nt].utf8.length,yr.keyEncoding);return new At(this,yr,br,Ar)}_keys(yr){this[Lt](yr,yr.keyEncoding);const br=this[er].keys(yr),Ar=this[tr].get(this[Nt].utf8.length,yr.keyEncoding);return new kt(this,yr,br,Ar)}_values(yr){this[Lt](yr,yr.keyEncoding);const br=this[er].values(yr);return new Bt(this,yr,br)}}return{AbstractSublevel:pr}};const nr=function(fr,pr){return{...fr.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...pr,encodings:{utf8:ir(fr,"utf8"),buffer:ir(fr,"buffer"),view:ir(fr,"view")}}},ir=function(fr,pr){return fr.supports.encodings[pr]?fr.keyEncoding(pr).name===pr:!1};class ar{constructor(pr){this.utf8=pr,this.view=zt.encode(pr),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class dr{constructor(){this.cache=new Map}get(pr,lr){let yr=this.cache.get(lr);return yr===void 0&&(lr==="view"?yr=(function(br,Ar){return Ar.subarray(br)}).bind(null,pr):yr=(function(br,Ar){return Ar.slice(br)}).bind(null,pr),this.cache.set(lr,yr)),yr}}const ur=function(fr,pr){let lr=0,yr=fr.length;for(;lr<yr&&fr[lr]===pr;)lr++;for(;yr>lr&&fr[yr-1]===pr;)yr--;return fr.slice(lr,yr)};return abstractSublevel}const{supports}=levelSupports,{Transcoder}=levelTranscoder,{EventEmitter:EventEmitter$1}=eventsExports,{fromCallback:fromCallback$1}=catering,ModuleError$1=moduleError,{AbstractIterator:AbstractIterator$1}=abstractIterator,{DefaultKeyIterator,DefaultValueIterator}=defaultKvIterator,{DeferredIterator,DeferredKeyIterator,DeferredValueIterator}=deferredIterator,{DefaultChainedBatch}=defaultChainedBatch,{getCallback,getOptions}=common,rangeOptions=rangeOptions_1,kPromise$1=Symbol("promise"),kLanded=Symbol("landed"),kResources=Symbol("resources"),kCloseResources=Symbol("closeResources"),kOperations=Symbol("operations"),kUndefer=Symbol("undefer"),kDeferOpen=Symbol("deferOpen"),kOptions$1=Symbol("options"),kStatus=Symbol("status"),kDefaultOptions=Symbol("defaultOptions"),kTranscoder=Symbol("transcoder"),kKeyEncoding=Symbol("keyEncoding"),kValueEncoding=Symbol("valueEncoding"),noop=()=>{};let AbstractLevel$1=class extends EventEmitter$1{constructor(e,At){if(super(),typeof e!="object"||e===null)throw new TypeError("The first argument 'manifest' must be an object");At=getOptions(At);const{keyEncoding:kt,valueEncoding:Bt,passive:Nt,...jt}=At;this[kResources]=new Set,this[kOperations]=[],this[kDeferOpen]=!0,this[kOptions$1]=jt,this[kStatus]="opening",this.supports=supports(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:e.snapshots!==!1,permanence:e.permanence!==!1,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[kTranscoder]=new Transcoder(formats(this)),this[kKeyEncoding]=this[kTranscoder].encoding(kt||"utf8"),this[kValueEncoding]=this[kTranscoder].encoding(Bt||"utf8");for(const Lt of this[kTranscoder].encodings())this.supports.encodings[Lt.commonName]||(this.supports.encodings[Lt.commonName]=!0);this[kDefaultOptions]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[kKeyEncoding].commonName,valueEncoding:this[kValueEncoding].commonName}),key:Object.freeze({keyEncoding:this[kKeyEncoding].commonName})},this.nextTick(()=>{this[kDeferOpen]&&this.open({passive:!1},noop)})}get status(){return this[kStatus]}keyEncoding(e){return this[kTranscoder].encoding(e??this[kKeyEncoding])}valueEncoding(e){return this[kTranscoder].encoding(e??this[kValueEncoding])}open(e,At){At=getCallback(e,At),At=fromCallback$1(At,kPromise$1),e={...this[kOptions$1],...getOptions(e)},e.createIfMissing=e.createIfMissing!==!1,e.errorIfExists=!!e.errorIfExists;const kt=Bt=>{this[kStatus]==="closing"||this[kStatus]==="opening"?this.once(kLanded,Bt?()=>kt(Bt):kt):this[kStatus]!=="open"?At(new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:Bt})):At()};return e.passive?this[kStatus]==="opening"?this.once(kLanded,kt):this.nextTick(kt):this[kStatus]==="closed"||this[kDeferOpen]?(this[kDeferOpen]=!1,this[kStatus]="opening",this.emit("opening"),this._open(e,Bt=>{if(Bt){this[kStatus]="closed",this[kCloseResources](()=>{this.emit(kLanded),kt(Bt)}),this[kUndefer]();return}this[kStatus]="open",this[kUndefer](),this.emit(kLanded),this[kStatus]==="open"&&this.emit("open"),this[kStatus]==="open"&&this.emit("ready"),kt()})):this[kStatus]==="open"?this.nextTick(kt):this.once(kLanded,()=>this.open(e,At)),At[kPromise$1]}_open(e,At){this.nextTick(At)}close(e){e=fromCallback$1(e,kPromise$1);const At=kt=>{this[kStatus]==="opening"||this[kStatus]==="closing"?this.once(kLanded,kt?At(kt):At):this[kStatus]!=="closed"?e(new ModuleError$1("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:kt})):e()};if(this[kStatus]==="open"){this[kStatus]="closing",this.emit("closing");const kt=Bt=>{this[kStatus]="open",this[kUndefer](),this.emit(kLanded),At(Bt)};this[kCloseResources](()=>{this._close(Bt=>{if(Bt)return kt(Bt);this[kStatus]="closed",this[kUndefer](),this.emit(kLanded),this[kStatus]==="closed"&&this.emit("closed"),At()})})}else this[kStatus]==="closed"?this.nextTick(At):this.once(kLanded,()=>this.close(e));return e[kPromise$1]}[kCloseResources](e){if(this[kResources].size===0)return this.nextTick(e);let At=this[kResources].size,kt=!0;const Bt=()=>{--At===0&&(kt?this.nextTick(e):e())};for(const Nt of this[kResources])Nt.close(Bt);kt=!1,this[kResources].clear()}_close(e){this.nextTick(e)}get(e,At,kt){if(kt=getCallback(At,kt),kt=fromCallback$1(kt,kPromise$1),At=getOptions(At,this[kDefaultOptions].entry),this[kStatus]==="opening")return this.defer(()=>this.get(e,At,kt)),kt[kPromise$1];if(maybeError(this,kt))return kt[kPromise$1];const Bt=this._checkKey(e);if(Bt)return this.nextTick(kt,Bt),kt[kPromise$1];const Nt=this.keyEncoding(At.keyEncoding),jt=this.valueEncoding(At.valueEncoding),Lt=Nt.format,er=jt.format;return(At.keyEncoding!==Lt||At.valueEncoding!==er)&&(At=Object.assign({},At,{keyEncoding:Lt,valueEncoding:er})),this._get(this.prefixKey(Nt.encode(e),Lt),At,(tr,zt)=>{if(tr)return(tr.code==="LEVEL_NOT_FOUND"||tr.notFound||/NotFound/i.test(tr))&&(tr.code||(tr.code="LEVEL_NOT_FOUND"),tr.notFound||(tr.notFound=!0),tr.status||(tr.status=404)),kt(tr);try{zt=jt.decode(zt)}catch(rr){return kt(new ModuleError$1("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:rr}))}kt(null,zt)}),kt[kPromise$1]}_get(e,At,kt){this.nextTick(kt,new Error("NotFound"))}getMany(e,At,kt){if(kt=getCallback(At,kt),kt=fromCallback$1(kt,kPromise$1),At=getOptions(At,this[kDefaultOptions].entry),this[kStatus]==="opening")return this.defer(()=>this.getMany(e,At,kt)),kt[kPromise$1];if(maybeError(this,kt))return kt[kPromise$1];if(!Array.isArray(e))return this.nextTick(kt,new TypeError("The first argument 'keys' must be an array")),kt[kPromise$1];if(e.length===0)return this.nextTick(kt,null,[]),kt[kPromise$1];const Bt=this.keyEncoding(At.keyEncoding),Nt=this.valueEncoding(At.valueEncoding),jt=Bt.format,Lt=Nt.format;(At.keyEncoding!==jt||At.valueEncoding!==Lt)&&(At=Object.assign({},At,{keyEncoding:jt,valueEncoding:Lt}));const er=new Array(e.length);for(let tr=0;tr<e.length;tr++){const zt=e[tr],rr=this._checkKey(zt);if(rr)return this.nextTick(kt,rr),kt[kPromise$1];er[tr]=this.prefixKey(Bt.encode(zt),jt)}return this._getMany(er,At,(tr,zt)=>{if(tr)return kt(tr);try{for(let rr=0;rr<zt.length;rr++)zt[rr]!==void 0&&(zt[rr]=Nt.decode(zt[rr]))}catch(rr){return kt(new ModuleError$1(`Could not decode one or more of ${zt.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:rr}))}kt(null,zt)}),kt[kPromise$1]}_getMany(e,At,kt){this.nextTick(kt,null,new Array(e.length).fill(void 0))}put(e,At,kt,Bt){if(Bt=getCallback(kt,Bt),Bt=fromCallback$1(Bt,kPromise$1),kt=getOptions(kt,this[kDefaultOptions].entry),this[kStatus]==="opening")return this.defer(()=>this.put(e,At,kt,Bt)),Bt[kPromise$1];if(maybeError(this,Bt))return Bt[kPromise$1];const Nt=this._checkKey(e)||this._checkValue(At);if(Nt)return this.nextTick(Bt,Nt),Bt[kPromise$1];const jt=this.keyEncoding(kt.keyEncoding),Lt=this.valueEncoding(kt.valueEncoding),er=jt.format,tr=Lt.format;(kt.keyEncoding!==er||kt.valueEncoding!==tr)&&(kt=Object.assign({},kt,{keyEncoding:er,valueEncoding:tr}));const zt=this.prefixKey(jt.encode(e),er),rr=Lt.encode(At);return this._put(zt,rr,kt,nr=>{if(nr)return Bt(nr);this.emit("put",e,At),Bt()}),Bt[kPromise$1]}_put(e,At,kt,Bt){this.nextTick(Bt)}del(e,At,kt){if(kt=getCallback(At,kt),kt=fromCallback$1(kt,kPromise$1),At=getOptions(At,this[kDefaultOptions].key),this[kStatus]==="opening")return this.defer(()=>this.del(e,At,kt)),kt[kPromise$1];if(maybeError(this,kt))return kt[kPromise$1];const Bt=this._checkKey(e);if(Bt)return this.nextTick(kt,Bt),kt[kPromise$1];const Nt=this.keyEncoding(At.keyEncoding),jt=Nt.format;return At.keyEncoding!==jt&&(At=Object.assign({},At,{keyEncoding:jt})),this._del(this.prefixKey(Nt.encode(e),jt),At,Lt=>{if(Lt)return kt(Lt);this.emit("del",e),kt()}),kt[kPromise$1]}_del(e,At,kt){this.nextTick(kt)}batch(e,At,kt){if(!arguments.length){if(this[kStatus]==="opening")return new DefaultChainedBatch(this);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(typeof e=="function"?kt=e:kt=getCallback(At,kt),kt=fromCallback$1(kt,kPromise$1),At=getOptions(At,this[kDefaultOptions].empty),this[kStatus]==="opening")return this.defer(()=>this.batch(e,At,kt)),kt[kPromise$1];if(maybeError(this,kt))return kt[kPromise$1];if(!Array.isArray(e))return this.nextTick(kt,new TypeError("The first argument 'operations' must be an array")),kt[kPromise$1];if(e.length===0)return this.nextTick(kt),kt[kPromise$1];const Bt=new Array(e.length),{keyEncoding:Nt,valueEncoding:jt,...Lt}=At;for(let er=0;er<e.length;er++){if(typeof e[er]!="object"||e[er]===null)return this.nextTick(kt,new TypeError("A batch operation must be an object")),kt[kPromise$1];const tr=Object.assign({},e[er]);if(tr.type!=="put"&&tr.type!=="del")return this.nextTick(kt,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),kt[kPromise$1];const zt=this._checkKey(tr.key);if(zt)return this.nextTick(kt,zt),kt[kPromise$1];const rr=tr.sublevel!=null?tr.sublevel:this,nr=rr.keyEncoding(tr.keyEncoding||Nt),ir=nr.format;if(tr.key=rr.prefixKey(nr.encode(tr.key),ir),tr.keyEncoding=ir,tr.type==="put"){const ar=this._checkValue(tr.value);if(ar)return this.nextTick(kt,ar),kt[kPromise$1];const dr=rr.valueEncoding(tr.valueEncoding||jt);tr.value=dr.encode(tr.value),tr.valueEncoding=dr.format}rr!==this&&(tr.sublevel=null),Bt[er]=tr}return this._batch(Bt,Lt,er=>{if(er)return kt(er);this.emit("batch",e),kt()}),kt[kPromise$1]}_batch(e,At,kt){this.nextTick(kt)}sublevel(e,At){return this._sublevel(e,AbstractSublevel.defaults(At))}_sublevel(e,At){return new AbstractSublevel(this,e,At)}prefixKey(e,At){return e}clear(e,At){if(At=getCallback(e,At),At=fromCallback$1(At,kPromise$1),e=getOptions(e,this[kDefaultOptions].empty),this[kStatus]==="opening")return this.defer(()=>this.clear(e,At)),At[kPromise$1];if(maybeError(this,At))return At[kPromise$1];const kt=e,Bt=this.keyEncoding(e.keyEncoding);return e=rangeOptions(e,Bt),e.keyEncoding=Bt.format,e.limit===0?this.nextTick(At):this._clear(e,Nt=>{if(Nt)return At(Nt);this.emit("clear",kt),At()}),At[kPromise$1]}_clear(e,At){this.nextTick(At)}iterator(e){const At=this.keyEncoding(e&&e.keyEncoding),kt=this.valueEncoding(e&&e.valueEncoding);if(e=rangeOptions(e,At),e.keys=e.keys!==!1,e.values=e.values!==!1,e[AbstractIterator$1.keyEncoding]=At,e[AbstractIterator$1.valueEncoding]=kt,e.keyEncoding=At.format,e.valueEncoding=kt.format,this[kStatus]==="opening")return new DeferredIterator(this,e);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new AbstractIterator$1(this,e)}keys(e){const At=this.keyEncoding(e&&e.keyEncoding),kt=this.valueEncoding(e&&e.valueEncoding);if(e=rangeOptions(e,At),e[AbstractIterator$1.keyEncoding]=At,e[AbstractIterator$1.valueEncoding]=kt,e.keyEncoding=At.format,e.valueEncoding=kt.format,this[kStatus]==="opening")return new DeferredKeyIterator(this,e);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new DefaultKeyIterator(this,e)}values(e){const At=this.keyEncoding(e&&e.keyEncoding),kt=this.valueEncoding(e&&e.valueEncoding);if(e=rangeOptions(e,At),e[AbstractIterator$1.keyEncoding]=At,e[AbstractIterator$1.valueEncoding]=kt,e.keyEncoding=At.format,e.valueEncoding=kt.format,this[kStatus]==="opening")return new DeferredValueIterator(this,e);if(this[kStatus]!=="open")throw new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new DefaultValueIterator(this,e)}defer(e){if(typeof e!="function")throw new TypeError("The first argument must be a function");this[kOperations].push(e)}[kUndefer](){if(this[kOperations].length===0)return;const e=this[kOperations];this[kOperations]=[];for(const At of e)At()}attachResource(e){if(typeof e!="object"||e===null||typeof e.close!="function")throw new TypeError("The first argument must be a resource object");this[kResources].add(e)}detachResource(e){this[kResources].delete(e)}_chainedBatch(){return new DefaultChainedBatch(this)}_checkKey(e){if(e==null)return new ModuleError$1("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(e==null)return new ModuleError$1("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}};AbstractLevel$1.prototype.nextTick=requireNextTickBrowser();const{AbstractSublevel}=requireAbstractSublevel()({AbstractLevel:AbstractLevel$1});abstractLevel.AbstractLevel=AbstractLevel$1;abstractLevel.AbstractSublevel=AbstractSublevel;const maybeError=function(xt,e){return xt[kStatus]!=="open"?(xt.nextTick(e,new ModuleError$1("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0):!1},formats=function(xt){return Object.keys(xt.supports.encodings).filter(e=>!!xt.supports.encodings[e])};abstractLevel$1.AbstractLevel=abstractLevel.AbstractLevel;abstractLevel$1.AbstractSublevel=abstractLevel.AbstractSublevel;abstractLevel$1.AbstractIterator=abstractIterator.AbstractIterator;abstractLevel$1.AbstractKeyIterator=abstractIterator.AbstractKeyIterator;abstractLevel$1.AbstractValueIterator=abstractIterator.AbstractValueIterator;abstractLevel$1.AbstractChainedBatch=abstractChainedBatch.AbstractChainedBatch;/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var runParallelLimit_1=runParallelLimit;const queueMicrotask$1=queueMicrotask_1;function runParallelLimit(xt,e,At){if(typeof e!="number")throw new Error("second argument must be a Number");let kt,Bt,Nt,jt,Lt,er=!0,tr;Array.isArray(xt)?(kt=[],Nt=Bt=xt.length):(jt=Object.keys(xt),kt={},Nt=Bt=jt.length);function zt(nr){function ir(){At&&At(nr,kt),At=null}er?queueMicrotask$1(ir):ir()}function rr(nr,ir,ar){if(kt[nr]=ar,ir&&(Lt=!0),--Nt===0||ir)zt(ir);else if(!Lt&&tr<Bt){let dr;jt?(dr=jt[tr],tr+=1,xt[dr](function(ur,fr){rr(dr,ur,fr)})):(dr=tr,tr+=1,xt[dr](function(ur,fr){rr(dr,ur,fr)}))}}tr=e,Nt?jt?jt.some(function(nr,ir){return xt[nr](function(ar,dr){rr(nr,ar,dr)}),ir===e-1}):xt.some(function(nr,ir){return nr(function(ar,dr){rr(ir,ar,dr)}),ir===e-1}):zt(null),er=!1}var iterator={},keyRange=function xt(e){const At=e.gte!==void 0?e.gte:e.gt!==void 0?e.gt:void 0,kt=e.lte!==void 0?e.lte:e.lt!==void 0?e.lt:void 0,Bt=e.gte===void 0,Nt=e.lte===void 0;return At!==void 0&&kt!==void 0?IDBKeyRange.bound(At,kt,Bt,Nt):At!==void 0?IDBKeyRange.lowerBound(At,Bt):kt!==void 0?IDBKeyRange.upperBound(kt,Nt):null};const textEncoder$2=new TextEncoder;var deserialize$2=function(xt){return xt instanceof Uint8Array?xt:xt instanceof ArrayBuffer?new Uint8Array(xt):textEncoder$2.encode(xt)};const{AbstractIterator}=abstractLevel$1,createKeyRange$1=keyRange,deserialize$1=deserialize$2,kCache=Symbol("cache"),kFinished=Symbol("finished"),kOptions=Symbol("options"),kCurrentOptions=Symbol("currentOptions"),kPosition=Symbol("position"),kLocation$1=Symbol("location"),kFirst=Symbol("first"),emptyOptions={};let Iterator$1=class extends AbstractIterator{constructor(e,At,kt){super(e,kt),this[kCache]=[],this[kFinished]=this.limit===0,this[kOptions]=kt,this[kCurrentOptions]={...kt},this[kPosition]=void 0,this[kLocation$1]=At,this[kFirst]=!0}_nextv(e,At,kt){if(this[kFirst]=!1,this[kFinished])return this.nextTick(kt,null,[]);if(this[kCache].length>0)return e=Math.min(e,this[kCache].length),this.nextTick(kt,null,this[kCache].splice(0,e));this[kPosition]!==void 0&&(this[kOptions].reverse?(this[kCurrentOptions].lt=this[kPosition],this[kCurrentOptions].lte=void 0):(this[kCurrentOptions].gt=this[kPosition],this[kCurrentOptions].gte=void 0));let Bt;try{Bt=createKeyRange$1(this[kCurrentOptions])}catch{return this[kFinished]=!0,this.nextTick(kt,null,[])}const Nt=this.db.db.transaction([this[kLocation$1]],"readonly"),jt=Nt.objectStore(this[kLocation$1]),Lt=[];if(this[kOptions].reverse){const er=!this[kOptions].values&&jt.openKeyCursor?"openKeyCursor":"openCursor";jt[er](Bt,"prev").onsuccess=tr=>{const zt=tr.target.result;if(zt){const{key:rr,value:nr}=zt;this[kPosition]=rr,Lt.push([this[kOptions].keys&&rr!==void 0?deserialize$1(rr):void 0,this[kOptions].values&&nr!==void 0?deserialize$1(nr):void 0]),Lt.length<e?zt.continue():maybeCommit(Nt)}else this[kFinished]=!0}}else{let er,tr;const zt=()=>{if(er===void 0||tr===void 0)return;const rr=Math.max(er.length,tr.length);rr===0||e===1/0?this[kFinished]=!0:this[kPosition]=er[rr-1],Lt.length=rr;for(let nr=0;nr<rr;nr++){const ir=er[nr],ar=tr[nr];Lt[nr]=[this[kOptions].keys&&ir!==void 0?deserialize$1(ir):void 0,this[kOptions].values&&ar!==void 0?deserialize$1(ar):void 0]}maybeCommit(Nt)};this[kOptions].keys||e<1/0?jt.getAllKeys(Bt,e<1/0?e:void 0).onsuccess=rr=>{er=rr.target.result,zt()}:(er=[],this.nextTick(zt)),this[kOptions].values?jt.getAll(Bt,e<1/0?e:void 0).onsuccess=rr=>{tr=rr.target.result,zt()}:(tr=[],this.nextTick(zt))}Nt.onabort=()=>{kt(Nt.error||new Error("aborted by user")),kt=null},Nt.oncomplete=()=>{kt(null,Lt),kt=null}}_next(e){if(this[kCache].length>0){const[At,kt]=this[kCache].shift();this.nextTick(e,null,At,kt)}else if(this[kFinished])this.nextTick(e);else{let At=Math.min(100,this.limit-this.count);this[kFirst]&&(this[kFirst]=!1,At=1),this._nextv(At,emptyOptions,(kt,Bt)=>{if(kt)return e(kt);this[kCache]=Bt,this._next(e)})}}_all(e,At){this[kFirst]=!1;const kt=this[kCache].splice(0,this[kCache].length),Bt=this.limit-this.count-kt.length;if(Bt<=0)return this.nextTick(At,null,kt);this._nextv(Bt,emptyOptions,(Nt,jt)=>{if(Nt)return At(Nt);kt.length>0&&(jt=kt.concat(jt)),At(null,jt)})}_seek(e,At){this[kFirst]=!0,this[kCache]=[],this[kFinished]=!1,this[kPosition]=void 0,this[kCurrentOptions]={...this[kOptions]};let kt;try{kt=createKeyRange$1(this[kOptions])}catch{this[kFinished]=!0;return}kt!==null&&!kt.includes(e)?this[kFinished]=!0:this[kOptions].reverse?this[kCurrentOptions].lte=e:this[kCurrentOptions].gte=e}};iterator.Iterator=Iterator$1;function maybeCommit(xt){typeof xt.commit=="function"&&xt.commit()}var clear$1=function xt(e,At,kt,Bt,Nt){if(Bt.limit===0)return e.nextTick(Nt);const jt=e.db.transaction([At],"readwrite"),Lt=jt.objectStore(At);let er=0;jt.oncomplete=function(){Nt()},jt.onabort=function(){Nt(jt.error||new Error("aborted by user"))};const tr=Lt.openKeyCursor?"openKeyCursor":"openCursor",zt=Bt.reverse?"prev":"next";Lt[tr](kt,zt).onsuccess=function(rr){const nr=rr.target.result;nr&&(Lt.delete(nr.key).onsuccess=function(){(Bt.limit<=0||++er<Bt.limit)&&nr.continue()})}};const{AbstractLevel}=abstractLevel$1,ModuleError=moduleError,parallel$1=runParallelLimit_1,{fromCallback}=catering,{Iterator}=iterator,deserialize=deserialize$2,clear=clear$1,createKeyRange=keyRange,DEFAULT_PREFIX="level-js-",kIDB=Symbol("idb"),kNamePrefix=Symbol("namePrefix"),kLocation=Symbol("location"),kVersion=Symbol("version"),kStore=Symbol("store"),kOnComplete=Symbol("onComplete"),kPromise=Symbol("promise");class BrowserLevel extends AbstractLevel{constructor(e,At,kt){if(typeof At=="function"||typeof kt=="function")throw new ModuleError("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:Bt,version:Nt,...jt}=At||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},jt),typeof e!="string")throw new Error("constructor requires a location string argument");this[kLocation]=e,this[kNamePrefix]=Bt??DEFAULT_PREFIX,this[kVersion]=parseInt(Nt||1,10),this[kIDB]=null}get location(){return this[kLocation]}get namePrefix(){return this[kNamePrefix]}get version(){return this[kVersion]}get db(){return this[kIDB]}get type(){return"browser-level"}_open(e,At){const kt=indexedDB.open(this[kNamePrefix]+this[kLocation],this[kVersion]);kt.onerror=function(){At(kt.error||new Error("unknown error"))},kt.onsuccess=()=>{this[kIDB]=kt.result,At()},kt.onupgradeneeded=Bt=>{const Nt=Bt.target.result;Nt.objectStoreNames.contains(this[kLocation])||Nt.createObjectStore(this[kLocation])}}[kStore](e){return this[kIDB].transaction([this[kLocation]],e).objectStore(this[kLocation])}[kOnComplete](e,At){const kt=e.transaction;kt.onabort=function(){At(kt.error||new Error("aborted by user"))},kt.oncomplete=function(){At(null,e.result)}}_get(e,At,kt){const Bt=this[kStore]("readonly");let Nt;try{Nt=Bt.get(e)}catch(jt){return this.nextTick(kt,jt)}this[kOnComplete](Nt,function(jt,Lt){if(jt)return kt(jt);if(Lt===void 0)return kt(new ModuleError("Entry not found",{code:"LEVEL_NOT_FOUND"}));kt(null,deserialize(Lt))})}_getMany(e,At,kt){const Bt=this[kStore]("readonly"),Nt=e.map(jt=>Lt=>{let er;try{er=Bt.get(jt)}catch(tr){return Lt(tr)}er.onsuccess=()=>{const tr=er.result;Lt(null,tr===void 0?tr:deserialize(tr))},er.onerror=tr=>{tr.stopPropagation(),Lt(er.error)}});parallel$1(Nt,16,kt)}_del(e,At,kt){const Bt=this[kStore]("readwrite");let Nt;try{Nt=Bt.delete(e)}catch(jt){return this.nextTick(kt,jt)}this[kOnComplete](Nt,kt)}_put(e,At,kt,Bt){const Nt=this[kStore]("readwrite");let jt;try{jt=Nt.put(At,e)}catch(Lt){return this.nextTick(Bt,Lt)}this[kOnComplete](jt,Bt)}_iterator(e){return new Iterator(this,this[kLocation],e)}_batch(e,At,kt){const Bt=this[kStore]("readwrite"),Nt=Bt.transaction;let jt=0,Lt;Nt.onabort=function(){kt(Lt||Nt.error||new Error("aborted by user"))},Nt.oncomplete=function(){kt()};function er(){const tr=e[jt++],zt=tr.key;let rr;try{rr=tr.type==="del"?Bt.delete(zt):Bt.put(tr.value,zt)}catch(nr){Lt=nr,Nt.abort();return}jt<e.length?rr.onsuccess=er:typeof Nt.commit=="function"&&Nt.commit()}er()}_clear(e,At){let kt,Bt;try{kt=createKeyRange(e)}catch{return this.nextTick(At)}if(e.limit>=0)return clear(this,this[kLocation],kt,e,At);try{const Nt=this[kStore]("readwrite");Bt=kt?Nt.delete(kt):Nt.clear()}catch(Nt){return this.nextTick(At,Nt)}this[kOnComplete](Bt,At)}_close(e){this[kIDB].close(),this.nextTick(e)}}BrowserLevel.destroy=function(xt,e,At){typeof e=="function"&&(At=e,e=DEFAULT_PREFIX),At=fromCallback(At,kPromise);const kt=indexedDB.deleteDatabase(e+xt);return kt.onsuccess=function(){At()},kt.onerror=function(Bt){At(Bt)},At[kPromise]};browserLevel.BrowserLevel=BrowserLevel;var Level$1=browserLevel.BrowserLevel,__awaiter$2A=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let MemoryStore$2=class{constructor(){this.store=new Map}clear(){return __awaiter$2A(this,void 0,void 0,function*(){this.store.clear()})}close(){return __awaiter$2A(this,void 0,void 0,function*(){})}delete(e){return __awaiter$2A(this,void 0,void 0,function*(){return this.store.delete(e)})}get(e){return __awaiter$2A(this,void 0,void 0,function*(){return this.store.get(e)})}has(e){return __awaiter$2A(this,void 0,void 0,function*(){return this.store.has(e)})}list(){return __awaiter$2A(this,void 0,void 0,function*(){return Array.from(this.store.values())})}set(e,At){return __awaiter$2A(this,void 0,void 0,function*(){this.store.set(e,At)})}};var __await$5=function(xt){return this instanceof __await$5?(this.v=xt,this):new __await$5(xt)},browser={exports:{}},stream={exports:{}},primordials={ArrayIsArray(xt){return Array.isArray(xt)},ArrayPrototypeIncludes(xt,e){return xt.includes(e)},ArrayPrototypeIndexOf(xt,e){return xt.indexOf(e)},ArrayPrototypeJoin(xt,e){return xt.join(e)},ArrayPrototypeMap(xt,e){return xt.map(e)},ArrayPrototypePop(xt,e){return xt.pop(e)},ArrayPrototypePush(xt,e){return xt.push(e)},ArrayPrototypeSlice(xt,e,At){return xt.slice(e,At)},Error,FunctionPrototypeCall(xt,e,...At){return xt.call(e,...At)},FunctionPrototypeSymbolHasInstance(xt,e){return Function.prototype[Symbol.hasInstance].call(xt,e)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(xt,e){return Object.defineProperties(xt,e)},ObjectDefineProperty(xt,e,At){return Object.defineProperty(xt,e,At)},ObjectGetOwnPropertyDescriptor(xt,e){return Object.getOwnPropertyDescriptor(xt,e)},ObjectKeys(xt){return Object.keys(xt)},ObjectSetPrototypeOf(xt,e){return Object.setPrototypeOf(xt,e)},Promise,PromisePrototypeCatch(xt,e){return xt.catch(e)},PromisePrototypeThen(xt,e,At){return xt.then(e,At)},PromiseReject(xt){return Promise.reject(xt)},ReflectApply:Reflect.apply,RegExpPrototypeTest(xt,e){return xt.test(e)},SafeSet:Set,String,StringPrototypeSlice(xt,e,At){return xt.slice(e,At)},StringPrototypeToLowerCase(xt){return xt.toLowerCase()},StringPrototypeToUpperCase(xt){return xt.toUpperCase()},StringPrototypeTrim(xt){return xt.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,TypedArrayPrototypeSet(xt,e,At){return xt.set(e,At)},Uint8Array},util={exports:{}};(function(xt){const e=buffer$2,At=Object.getPrototypeOf(async function(){}).constructor,kt=globalThis.Blob||e.Blob,Bt=typeof kt<"u"?function(Lt){return Lt instanceof kt}:function(Lt){return!1};class Nt extends Error{constructor(Lt){if(!Array.isArray(Lt))throw new TypeError(`Expected input to be an Array, got ${typeof Lt}`);let er="";for(let tr=0;tr<Lt.length;tr++)er+=`    ${Lt[tr].stack}
`;super(er),this.name="AggregateError",this.errors=Lt}}xt.exports={AggregateError:Nt,kEmptyObject:Object.freeze({}),once(jt){let Lt=!1;return function(...er){Lt||(Lt=!0,jt.apply(this,er))}},createDeferredPromise:function(){let jt,Lt;return{promise:new Promise((tr,zt)=>{jt=tr,Lt=zt}),resolve:jt,reject:Lt}},promisify(jt){return new Promise((Lt,er)=>{jt((tr,...zt)=>tr?er(tr):Lt(...zt))})},debuglog(){return function(){}},format(jt,...Lt){return jt.replace(/%([sdifj])/g,function(...[er,tr]){const zt=Lt.shift();return tr==="f"?zt.toFixed(6):tr==="j"?JSON.stringify(zt):tr==="s"&&typeof zt=="object"?`${zt.constructor!==Object?zt.constructor.name:""} {}`.trim():zt.toString()})},inspect(jt){switch(typeof jt){case"string":if(jt.includes("'"))if(jt.includes('"')){if(!jt.includes("`")&&!jt.includes("${"))return`\`${jt}\``}else return`"${jt}"`;return`'${jt}'`;case"number":return isNaN(jt)?"NaN":Object.is(jt,-0)?String(jt):jt;case"bigint":return`${String(jt)}n`;case"boolean":case"undefined":return String(jt);case"object":return"{}"}},types:{isAsyncFunction(jt){return jt instanceof At},isArrayBufferView(jt){return ArrayBuffer.isView(jt)}},isBlob:Bt},xt.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")})(util);var utilExports=util.exports,operators={};const{format,inspect:inspect$1,AggregateError:CustomAggregateError}=utilExports,AggregateError$1=globalThis.AggregateError||CustomAggregateError,kIsNodeError=Symbol("kIsNodeError"),kTypes=["string","function","number","object","Function","Object","boolean","bigint","symbol"],classRegExp=/^([A-Z][a-z0-9]*)+$/,nodeInternalPrefix="__node_internal_",codes$1={};function assert(xt,e){if(!xt)throw new codes$1.ERR_INTERNAL_ASSERTION(e)}function addNumericalSeparator(xt){let e="",At=xt.length;const kt=xt[0]==="-"?1:0;for(;At>=kt+4;At-=3)e=`_${xt.slice(At-3,At)}${e}`;return`${xt.slice(0,At)}${e}`}function getMessage(xt,e,At){if(typeof e=="function")return assert(e.length<=At.length,`Code: ${xt}; The provided arguments length (${At.length}) does not match the required ones (${e.length}).`),e(...At);const kt=(e.match(/%[dfijoOs]/g)||[]).length;return assert(kt===At.length,`Code: ${xt}; The provided arguments length (${At.length}) does not match the required ones (${kt}).`),At.length===0?e:format(e,...At)}function E$1(xt,e,At){At||(At=Error);class kt extends At{constructor(...Nt){super(getMessage(xt,e,Nt))}toString(){return`${this.name} [${xt}]: ${this.message}`}}Object.defineProperties(kt.prototype,{name:{value:At.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${xt}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),kt.prototype.code=xt,kt.prototype[kIsNodeError]=!0,codes$1[xt]=kt}function hideStackFrames$1(xt){const e=nodeInternalPrefix+xt.name;return Object.defineProperty(xt,"name",{value:e}),xt}function aggregateTwoErrors$2(xt,e){if(xt&&e&&xt!==e){if(Array.isArray(e.errors))return e.errors.push(xt),e;const At=new AggregateError$1([e,xt],e.message);return At.code=e.code,At}return xt||e}let AbortError$8=class extends Error{constructor(e="The operation was aborted",At=void 0){if(At!==void 0&&typeof At!="object")throw new codes$1.ERR_INVALID_ARG_TYPE("options","Object",At);super(e,At),this.code="ABORT_ERR",this.name="AbortError"}};E$1("ERR_ASSERTION","%s",Error);E$1("ERR_INVALID_ARG_TYPE",(xt,e,At)=>{assert(typeof xt=="string","'name' must be a string"),Array.isArray(e)||(e=[e]);let kt="The ";xt.endsWith(" argument")?kt+=`${xt} `:kt+=`"${xt}" ${xt.includes(".")?"property":"argument"} `,kt+="must be ";const Bt=[],Nt=[],jt=[];for(const er of e)assert(typeof er=="string","All expected entries have to be of type string"),kTypes.includes(er)?Bt.push(er.toLowerCase()):classRegExp.test(er)?Nt.push(er):(assert(er!=="object",'The value "object" should be written as "Object"'),jt.push(er));if(Nt.length>0){const er=Bt.indexOf("object");er!==-1&&(Bt.splice(Bt,er,1),Nt.push("Object"))}if(Bt.length>0){switch(Bt.length){case 1:kt+=`of type ${Bt[0]}`;break;case 2:kt+=`one of type ${Bt[0]} or ${Bt[1]}`;break;default:{const er=Bt.pop();kt+=`one of type ${Bt.join(", ")}, or ${er}`}}(Nt.length>0||jt.length>0)&&(kt+=" or ")}if(Nt.length>0){switch(Nt.length){case 1:kt+=`an instance of ${Nt[0]}`;break;case 2:kt+=`an instance of ${Nt[0]} or ${Nt[1]}`;break;default:{const er=Nt.pop();kt+=`an instance of ${Nt.join(", ")}, or ${er}`}}jt.length>0&&(kt+=" or ")}switch(jt.length){case 0:break;case 1:jt[0].toLowerCase()!==jt[0]&&(kt+="an "),kt+=`${jt[0]}`;break;case 2:kt+=`one of ${jt[0]} or ${jt[1]}`;break;default:{const er=jt.pop();kt+=`one of ${jt.join(", ")}, or ${er}`}}if(At==null)kt+=`. Received ${At}`;else if(typeof At=="function"&&At.name)kt+=`. Received function ${At.name}`;else if(typeof At=="object"){var Lt;if((Lt=At.constructor)!==null&&Lt!==void 0&&Lt.name)kt+=`. Received an instance of ${At.constructor.name}`;else{const er=inspect$1(At,{depth:-1});kt+=`. Received ${er}`}}else{let er=inspect$1(At,{colors:!1});er.length>25&&(er=`${er.slice(0,25)}...`),kt+=`. Received type ${typeof At} (${er})`}return kt},TypeError);E$1("ERR_INVALID_ARG_VALUE",(xt,e,At="is invalid")=>{let kt=inspect$1(e);return kt.length>128&&(kt=kt.slice(0,128)+"..."),`The ${xt.includes(".")?"property":"argument"} '${xt}' ${At}. Received ${kt}`},TypeError);E$1("ERR_INVALID_RETURN_VALUE",(xt,e,At)=>{var kt;const Bt=At!=null&&(kt=At.constructor)!==null&&kt!==void 0&&kt.name?`instance of ${At.constructor.name}`:`type ${typeof At}`;return`Expected ${xt} to be returned from the "${e}" function but got ${Bt}.`},TypeError);E$1("ERR_MISSING_ARGS",(...xt)=>{assert(xt.length>0,"At least one arg needs to be specified");let e;const At=xt.length;switch(xt=(Array.isArray(xt)?xt:[xt]).map(kt=>`"${kt}"`).join(" or "),At){case 1:e+=`The ${xt[0]} argument`;break;case 2:e+=`The ${xt[0]} and ${xt[1]} arguments`;break;default:{const kt=xt.pop();e+=`The ${xt.join(", ")}, and ${kt} arguments`}break}return`${e} must be specified`},TypeError);E$1("ERR_OUT_OF_RANGE",(xt,e,At)=>{assert(e,'Missing "range" argument');let kt;return Number.isInteger(At)&&Math.abs(At)>2**32?kt=addNumericalSeparator(String(At)):typeof At=="bigint"?(kt=String(At),(At>2n**32n||At<-(2n**32n))&&(kt=addNumericalSeparator(kt)),kt+="n"):kt=inspect$1(At),`The value of "${xt}" is out of range. It must be ${e}. Received ${kt}`},RangeError);E$1("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error);E$1("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error);E$1("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error);E$1("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error);E$1("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error);E$1("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);E$1("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error);E$1("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error);E$1("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error);E$1("ERR_STREAM_WRITE_AFTER_END","write after end",Error);E$1("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError);var errors={AbortError:AbortError$8,aggregateTwoErrors:hideStackFrames$1(aggregateTwoErrors$2),hideStackFrames:hideStackFrames$1,codes:codes$1};const{ArrayIsArray:ArrayIsArray$2,ArrayPrototypeIncludes,ArrayPrototypeJoin,ArrayPrototypeMap,NumberIsInteger:NumberIsInteger$1,NumberIsNaN:NumberIsNaN$1,NumberMAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER,NumberParseInt,ObjectPrototypeHasOwnProperty,RegExpPrototypeExec,String:String$1,StringPrototypeToUpperCase,StringPrototypeTrim}=primordials,{hideStackFrames,codes:{ERR_SOCKET_BAD_PORT,ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$5,ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$3,ERR_OUT_OF_RANGE:ERR_OUT_OF_RANGE$1,ERR_UNKNOWN_SIGNAL}}=errors,{normalizeEncoding}=utilExports,{isAsyncFunction,isArrayBufferView}=utilExports.types,signals={};function isInt32(xt){return xt===(xt|0)}function isUint32(xt){return xt===xt>>>0}const octalReg=/^[0-7]+$/,modeDesc="must be a 32-bit unsigned integer or an octal string";function parseFileMode(xt,e,At){if(typeof xt>"u"&&(xt=At),typeof xt=="string"){if(RegExpPrototypeExec(octalReg,xt)===null)throw new ERR_INVALID_ARG_VALUE$3(e,xt,modeDesc);xt=NumberParseInt(xt,8)}return validateUint32(xt,e),xt}const validateInteger$1=hideStackFrames((xt,e,At=NumberMIN_SAFE_INTEGER,kt=NumberMAX_SAFE_INTEGER)=>{if(typeof xt!="number")throw new ERR_INVALID_ARG_TYPE$5(e,"number",xt);if(!NumberIsInteger$1(xt))throw new ERR_OUT_OF_RANGE$1(e,"an integer",xt);if(xt<At||xt>kt)throw new ERR_OUT_OF_RANGE$1(e,`>= ${At} && <= ${kt}`,xt)}),validateInt32=hideStackFrames((xt,e,At=-2147483648,kt=2147483647)=>{if(typeof xt!="number")throw new ERR_INVALID_ARG_TYPE$5(e,"number",xt);if(!NumberIsInteger$1(xt))throw new ERR_OUT_OF_RANGE$1(e,"an integer",xt);if(xt<At||xt>kt)throw new ERR_OUT_OF_RANGE$1(e,`>= ${At} && <= ${kt}`,xt)}),validateUint32=hideStackFrames((xt,e,At=!1)=>{if(typeof xt!="number")throw new ERR_INVALID_ARG_TYPE$5(e,"number",xt);if(!NumberIsInteger$1(xt))throw new ERR_OUT_OF_RANGE$1(e,"an integer",xt);const kt=At?1:0,Bt=4294967295;if(xt<kt||xt>Bt)throw new ERR_OUT_OF_RANGE$1(e,`>= ${kt} && <= ${Bt}`,xt)});function validateString(xt,e){if(typeof xt!="string")throw new ERR_INVALID_ARG_TYPE$5(e,"string",xt)}function validateNumber(xt,e,At=void 0,kt){if(typeof xt!="number")throw new ERR_INVALID_ARG_TYPE$5(e,"number",xt);if(At!=null&&xt<At||kt!=null&&xt>kt||(At!=null||kt!=null)&&NumberIsNaN$1(xt))throw new ERR_OUT_OF_RANGE$1(e,`${At!=null?`>= ${At}`:""}${At!=null&&kt!=null?" && ":""}${kt!=null?`<= ${kt}`:""}`,xt)}const validateOneOf=hideStackFrames((xt,e,At)=>{if(!ArrayPrototypeIncludes(At,xt)){const Bt="must be one of: "+ArrayPrototypeJoin(ArrayPrototypeMap(At,Nt=>typeof Nt=="string"?`'${Nt}'`:String$1(Nt)),", ");throw new ERR_INVALID_ARG_VALUE$3(e,xt,Bt)}});function validateBoolean$1(xt,e){if(typeof xt!="boolean")throw new ERR_INVALID_ARG_TYPE$5(e,"boolean",xt)}function getOwnPropertyValueOrDefault(xt,e,At){return xt==null||!ObjectPrototypeHasOwnProperty(xt,e)?At:xt[e]}const validateObject$3=hideStackFrames((xt,e,At=null)=>{const kt=getOwnPropertyValueOrDefault(At,"allowArray",!1),Bt=getOwnPropertyValueOrDefault(At,"allowFunction",!1);if(!getOwnPropertyValueOrDefault(At,"nullable",!1)&&xt===null||!kt&&ArrayIsArray$2(xt)||typeof xt!="object"&&(!Bt||typeof xt!="function"))throw new ERR_INVALID_ARG_TYPE$5(e,"Object",xt)}),validateDictionary=hideStackFrames((xt,e)=>{if(xt!=null&&typeof xt!="object"&&typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$5(e,"a dictionary",xt)}),validateArray=hideStackFrames((xt,e,At=0)=>{if(!ArrayIsArray$2(xt))throw new ERR_INVALID_ARG_TYPE$5(e,"Array",xt);if(xt.length<At){const kt=`must be longer than ${At}`;throw new ERR_INVALID_ARG_VALUE$3(e,xt,kt)}});function validateStringArray(xt,e){validateArray(xt,e);for(let At=0;At<xt.length;At++)validateString(xt[At],`${e}[${At}]`)}function validateBooleanArray(xt,e){validateArray(xt,e);for(let At=0;At<xt.length;At++)validateBoolean$1(xt[At],`${e}[${At}]`)}function validateSignalName(xt,e="signal"){if(validateString(xt,e),signals[xt]===void 0)throw signals[StringPrototypeToUpperCase(xt)]!==void 0?new ERR_UNKNOWN_SIGNAL(xt+" (signals must use all capital letters)"):new ERR_UNKNOWN_SIGNAL(xt)}const validateBuffer=hideStackFrames((xt,e="buffer")=>{if(!isArrayBufferView(xt))throw new ERR_INVALID_ARG_TYPE$5(e,["Buffer","TypedArray","DataView"],xt)});function validateEncoding(xt,e){const At=normalizeEncoding(e),kt=xt.length;if(At==="hex"&&kt%2!==0)throw new ERR_INVALID_ARG_VALUE$3("encoding",e,`is invalid for data of length ${kt}`)}function validatePort(xt,e="Port",At=!0){if(typeof xt!="number"&&typeof xt!="string"||typeof xt=="string"&&StringPrototypeTrim(xt).length===0||+xt!==+xt>>>0||xt>65535||xt===0&&!At)throw new ERR_SOCKET_BAD_PORT(e,xt,At);return xt|0}const validateAbortSignal$3=hideStackFrames((xt,e)=>{if(xt!==void 0&&(xt===null||typeof xt!="object"||!("aborted"in xt)))throw new ERR_INVALID_ARG_TYPE$5(e,"AbortSignal",xt)}),validateFunction$2=hideStackFrames((xt,e)=>{if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$5(e,"Function",xt)}),validatePlainFunction=hideStackFrames((xt,e)=>{if(typeof xt!="function"||isAsyncFunction(xt))throw new ERR_INVALID_ARG_TYPE$5(e,"Function",xt)}),validateUndefined=hideStackFrames((xt,e)=>{if(xt!==void 0)throw new ERR_INVALID_ARG_TYPE$5(e,"undefined",xt)});function validateUnion(xt,e,At){if(!ArrayPrototypeIncludes(At,xt))throw new ERR_INVALID_ARG_TYPE$5(e,`('${ArrayPrototypeJoin(At,"|")}')`,xt)}const linkValueRegExp=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function validateLinkHeaderFormat(xt,e){if(typeof xt>"u"||!RegExpPrototypeExec(linkValueRegExp,xt))throw new ERR_INVALID_ARG_VALUE$3(e,xt,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function validateLinkHeaderValue(xt){if(typeof xt=="string")return validateLinkHeaderFormat(xt,"hints"),xt;if(ArrayIsArray$2(xt)){const e=xt.length;let At="";if(e===0)return At;for(let kt=0;kt<e;kt++){const Bt=xt[kt];validateLinkHeaderFormat(Bt,"hints"),At+=Bt,kt!==e-1&&(At+=", ")}return At}throw new ERR_INVALID_ARG_VALUE$3("hints",xt,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}var validators={isInt32,isUint32,parseFileMode,validateArray,validateStringArray,validateBooleanArray,validateBoolean:validateBoolean$1,validateBuffer,validateDictionary,validateEncoding,validateFunction:validateFunction$2,validateInt32,validateInteger:validateInteger$1,validateNumber,validateObject:validateObject$3,validateOneOf,validatePlainFunction,validatePort,validateSignalName,validateString,validateUint32,validateUndefined,validateUnion,validateAbortSignal:validateAbortSignal$3,validateLinkHeaderValue},endOfStream={exports:{}};const{Symbol:Symbol$4,SymbolAsyncIterator:SymbolAsyncIterator$2,SymbolIterator:SymbolIterator$2,SymbolFor}=primordials,kDestroyed$1=Symbol$4("kDestroyed"),kIsErrored=Symbol$4("kIsErrored"),kIsReadable=Symbol$4("kIsReadable"),kIsDisturbed=Symbol$4("kIsDisturbed"),kIsClosedPromise$1=SymbolFor("nodejs.webstream.isClosedPromise"),kControllerErrorFunction=SymbolFor("nodejs.webstream.controllerErrorFunction");function isReadableNodeStream$2(xt,e=!1){var At;return!!(xt&&typeof xt.pipe=="function"&&typeof xt.on=="function"&&(!e||typeof xt.pause=="function"&&typeof xt.resume=="function")&&(!xt._writableState||((At=xt._readableState)===null||At===void 0?void 0:At.readable)!==!1)&&(!xt._writableState||xt._readableState))}function isWritableNodeStream$1(xt){var e;return!!(xt&&typeof xt.write=="function"&&typeof xt.on=="function"&&(!xt._readableState||((e=xt._writableState)===null||e===void 0?void 0:e.writable)!==!1))}function isDuplexNodeStream(xt){return!!(xt&&typeof xt.pipe=="function"&&xt._readableState&&typeof xt.on=="function"&&typeof xt.write=="function")}function isNodeStream$4(xt){return xt&&(xt._readableState||xt._writableState||typeof xt.write=="function"&&typeof xt.on=="function"||typeof xt.pipe=="function"&&typeof xt.on=="function")}function isReadableStream$3(xt){return!!(xt&&!isNodeStream$4(xt)&&typeof xt.pipeThrough=="function"&&typeof xt.getReader=="function"&&typeof xt.cancel=="function")}function isWritableStream$2(xt){return!!(xt&&!isNodeStream$4(xt)&&typeof xt.getWriter=="function"&&typeof xt.abort=="function")}function isTransformStream$2(xt){return!!(xt&&!isNodeStream$4(xt)&&typeof xt.readable=="object"&&typeof xt.writable=="object")}function isWebStream$2(xt){return isReadableStream$3(xt)||isWritableStream$2(xt)||isTransformStream$2(xt)}function isIterable$2(xt,e){return xt==null?!1:e===!0?typeof xt[SymbolAsyncIterator$2]=="function":e===!1?typeof xt[SymbolIterator$2]=="function":typeof xt[SymbolAsyncIterator$2]=="function"||typeof xt[SymbolIterator$2]=="function"}function isDestroyed$1(xt){if(!isNodeStream$4(xt))return null;const e=xt._writableState,At=xt._readableState,kt=e||At;return!!(xt.destroyed||xt[kDestroyed$1]||kt!=null&&kt.destroyed)}function isWritableEnded(xt){if(!isWritableNodeStream$1(xt))return null;if(xt.writableEnded===!0)return!0;const e=xt._writableState;return e!=null&&e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function isWritableFinished$1(xt,e){if(!isWritableNodeStream$1(xt))return null;if(xt.writableFinished===!0)return!0;const At=xt._writableState;return At!=null&&At.errored?!1:typeof(At==null?void 0:At.finished)!="boolean"?null:!!(At.finished||e===!1&&At.ended===!0&&At.length===0)}function isReadableEnded$1(xt){if(!isReadableNodeStream$2(xt))return null;if(xt.readableEnded===!0)return!0;const e=xt._readableState;return!e||e.errored?!1:typeof(e==null?void 0:e.ended)!="boolean"?null:e.ended}function isReadableFinished$1(xt,e){if(!isReadableNodeStream$2(xt))return null;const At=xt._readableState;return At!=null&&At.errored?!1:typeof(At==null?void 0:At.endEmitted)!="boolean"?null:!!(At.endEmitted||e===!1&&At.ended===!0&&At.length===0)}function isReadable$3(xt){return xt&&xt[kIsReadable]!=null?xt[kIsReadable]:typeof(xt==null?void 0:xt.readable)!="boolean"?null:isDestroyed$1(xt)?!1:isReadableNodeStream$2(xt)&&xt.readable&&!isReadableFinished$1(xt)}function isWritable$3(xt){return typeof(xt==null?void 0:xt.writable)!="boolean"?null:isDestroyed$1(xt)?!1:isWritableNodeStream$1(xt)&&xt.writable&&!isWritableEnded(xt)}function isFinished$1(xt,e){return isNodeStream$4(xt)?isDestroyed$1(xt)?!0:!((e==null?void 0:e.readable)!==!1&&isReadable$3(xt)||(e==null?void 0:e.writable)!==!1&&isWritable$3(xt)):null}function isWritableErrored$1(xt){var e,At;return isNodeStream$4(xt)?xt.writableErrored?xt.writableErrored:(e=(At=xt._writableState)===null||At===void 0?void 0:At.errored)!==null&&e!==void 0?e:null:null}function isReadableErrored$1(xt){var e,At;return isNodeStream$4(xt)?xt.readableErrored?xt.readableErrored:(e=(At=xt._readableState)===null||At===void 0?void 0:At.errored)!==null&&e!==void 0?e:null:null}function isClosed$1(xt){if(!isNodeStream$4(xt))return null;if(typeof xt.closed=="boolean")return xt.closed;const e=xt._writableState,At=xt._readableState;return typeof(e==null?void 0:e.closed)=="boolean"||typeof(At==null?void 0:At.closed)=="boolean"?(e==null?void 0:e.closed)||(At==null?void 0:At.closed):typeof xt._closed=="boolean"&&isOutgoingMessage(xt)?xt._closed:null}function isOutgoingMessage(xt){return typeof xt._closed=="boolean"&&typeof xt._defaultKeepAlive=="boolean"&&typeof xt._removedConnection=="boolean"&&typeof xt._removedContLen=="boolean"}function isServerResponse(xt){return typeof xt._sent100=="boolean"&&isOutgoingMessage(xt)}function isServerRequest$1(xt){var e;return typeof xt._consuming=="boolean"&&typeof xt._dumped=="boolean"&&((e=xt.req)===null||e===void 0?void 0:e.upgradeOrConnect)===void 0}function willEmitClose(xt){if(!isNodeStream$4(xt))return null;const e=xt._writableState,At=xt._readableState,kt=e||At;return!kt&&isServerResponse(xt)||!!(kt&&kt.autoDestroy&&kt.emitClose&&kt.closed===!1)}function isDisturbed(xt){var e;return!!(xt&&((e=xt[kIsDisturbed])!==null&&e!==void 0?e:xt.readableDidRead||xt.readableAborted))}function isErrored(xt){var e,At,kt,Bt,Nt,jt,Lt,er,tr,zt;return!!(xt&&((e=(At=(kt=(Bt=(Nt=(jt=xt[kIsErrored])!==null&&jt!==void 0?jt:xt.readableErrored)!==null&&Nt!==void 0?Nt:xt.writableErrored)!==null&&Bt!==void 0?Bt:(Lt=xt._readableState)===null||Lt===void 0?void 0:Lt.errorEmitted)!==null&&kt!==void 0?kt:(er=xt._writableState)===null||er===void 0?void 0:er.errorEmitted)!==null&&At!==void 0?At:(tr=xt._readableState)===null||tr===void 0?void 0:tr.errored)!==null&&e!==void 0?e:!((zt=xt._writableState)===null||zt===void 0)&&zt.errored))}var utils$1={kDestroyed:kDestroyed$1,isDisturbed,kIsDisturbed,isErrored,kIsErrored,isReadable:isReadable$3,kIsReadable,kIsClosedPromise:kIsClosedPromise$1,kControllerErrorFunction,isClosed:isClosed$1,isDestroyed:isDestroyed$1,isDuplexNodeStream,isFinished:isFinished$1,isIterable:isIterable$2,isReadableNodeStream:isReadableNodeStream$2,isReadableStream:isReadableStream$3,isReadableEnded:isReadableEnded$1,isReadableFinished:isReadableFinished$1,isReadableErrored:isReadableErrored$1,isNodeStream:isNodeStream$4,isWebStream:isWebStream$2,isWritable:isWritable$3,isWritableNodeStream:isWritableNodeStream$1,isWritableStream:isWritableStream$2,isWritableEnded,isWritableFinished:isWritableFinished$1,isWritableErrored:isWritableErrored$1,isServerRequest:isServerRequest$1,isServerResponse,willEmitClose,isTransformStream:isTransformStream$2};const process$3=browserExports$3,{AbortError:AbortError$7,codes}=errors,{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$4,ERR_STREAM_PREMATURE_CLOSE:ERR_STREAM_PREMATURE_CLOSE$1}=codes,{kEmptyObject,once:once$1}=utilExports,{validateAbortSignal:validateAbortSignal$2,validateFunction:validateFunction$1,validateObject:validateObject$2,validateBoolean}=validators,{Promise:Promise$3,PromisePrototypeThen:PromisePrototypeThen$2}=primordials,{isClosed,isReadable:isReadable$2,isReadableNodeStream:isReadableNodeStream$1,isReadableStream:isReadableStream$2,isReadableFinished,isReadableErrored,isWritable:isWritable$2,isWritableNodeStream,isWritableStream:isWritableStream$1,isWritableFinished,isWritableErrored,isNodeStream:isNodeStream$3,willEmitClose:_willEmitClose,kIsClosedPromise}=utils$1;function isRequest$1(xt){return xt.setHeader&&typeof xt.abort=="function"}const nop=()=>{};function eos$2(xt,e,At){var kt,Bt;if(arguments.length===2?(At=e,e=kEmptyObject):e==null?e=kEmptyObject:validateObject$2(e,"options"),validateFunction$1(At,"callback"),validateAbortSignal$2(e.signal,"options.signal"),At=once$1(At),isReadableStream$2(xt)||isWritableStream$1(xt))return eosWeb(xt,e,At);if(!isNodeStream$3(xt))throw new ERR_INVALID_ARG_TYPE$4("stream",["ReadableStream","WritableStream","Stream"],xt);const Nt=(kt=e.readable)!==null&&kt!==void 0?kt:isReadableNodeStream$1(xt),jt=(Bt=e.writable)!==null&&Bt!==void 0?Bt:isWritableNodeStream(xt),Lt=xt._writableState,er=xt._readableState,tr=()=>{xt.writable||nr()};let zt=_willEmitClose(xt)&&isReadableNodeStream$1(xt)===Nt&&isWritableNodeStream(xt)===jt,rr=isWritableFinished(xt,!1);const nr=()=>{rr=!0,xt.destroyed&&(zt=!1),!(zt&&(!xt.readable||Nt))&&(!Nt||ir)&&At.call(xt)};let ir=isReadableFinished(xt,!1);const ar=()=>{ir=!0,xt.destroyed&&(zt=!1),!(zt&&(!xt.writable||jt))&&(!jt||rr)&&At.call(xt)},dr=br=>{At.call(xt,br)};let ur=isClosed(xt);const fr=()=>{ur=!0;const br=isWritableErrored(xt)||isReadableErrored(xt);if(br&&typeof br!="boolean")return At.call(xt,br);if(Nt&&!ir&&isReadableNodeStream$1(xt,!0)&&!isReadableFinished(xt,!1))return At.call(xt,new ERR_STREAM_PREMATURE_CLOSE$1);if(jt&&!rr&&!isWritableFinished(xt,!1))return At.call(xt,new ERR_STREAM_PREMATURE_CLOSE$1);At.call(xt)},pr=()=>{ur=!0;const br=isWritableErrored(xt)||isReadableErrored(xt);if(br&&typeof br!="boolean")return At.call(xt,br);At.call(xt)},lr=()=>{xt.req.on("finish",nr)};isRequest$1(xt)?(xt.on("complete",nr),zt||xt.on("abort",fr),xt.req?lr():xt.on("request",lr)):jt&&!Lt&&(xt.on("end",tr),xt.on("close",tr)),!zt&&typeof xt.aborted=="boolean"&&xt.on("aborted",fr),xt.on("end",ar),xt.on("finish",nr),e.error!==!1&&xt.on("error",dr),xt.on("close",fr),ur?process$3.nextTick(fr):Lt!=null&&Lt.errorEmitted||er!=null&&er.errorEmitted?zt||process$3.nextTick(pr):(!Nt&&(!zt||isReadable$2(xt))&&(rr||isWritable$2(xt)===!1)||!jt&&(!zt||isWritable$2(xt))&&(ir||isReadable$2(xt)===!1)||er&&xt.req&&xt.aborted)&&process$3.nextTick(pr);const yr=()=>{At=nop,xt.removeListener("aborted",fr),xt.removeListener("complete",nr),xt.removeListener("abort",fr),xt.removeListener("request",lr),xt.req&&xt.req.removeListener("finish",nr),xt.removeListener("end",tr),xt.removeListener("close",tr),xt.removeListener("finish",nr),xt.removeListener("end",ar),xt.removeListener("error",dr),xt.removeListener("close",fr)};if(e.signal&&!ur){const br=()=>{const Ar=At;yr(),Ar.call(xt,new AbortError$7(void 0,{cause:e.signal.reason}))};if(e.signal.aborted)process$3.nextTick(br);else{const Ar=At;At=once$1((...Pr)=>{e.signal.removeEventListener("abort",br),Ar.apply(xt,Pr)}),e.signal.addEventListener("abort",br)}}return yr}function eosWeb(xt,e,At){let kt=!1,Bt=nop;if(e.signal)if(Bt=()=>{kt=!0,At.call(xt,new AbortError$7(void 0,{cause:e.signal.reason}))},e.signal.aborted)process$3.nextTick(Bt);else{const jt=At;At=once$1((...Lt)=>{e.signal.removeEventListener("abort",Bt),jt.apply(xt,Lt)}),e.signal.addEventListener("abort",Bt)}const Nt=(...jt)=>{kt||process$3.nextTick(()=>At.apply(xt,jt))};return PromisePrototypeThen$2(xt[kIsClosedPromise].promise,Nt,Nt),nop}function finished$1(xt,e){var At;let kt=!1;return e===null&&(e=kEmptyObject),(At=e)!==null&&At!==void 0&&At.cleanup&&(validateBoolean(e.cleanup,"cleanup"),kt=e.cleanup),new Promise$3((Bt,Nt)=>{const jt=eos$2(xt,e,Lt=>{kt&&jt(),Lt?Nt(Lt):Bt()})})}endOfStream.exports=eos$2;endOfStream.exports.finished=finished$1;var endOfStreamExports=endOfStream.exports;const process$2=browserExports$3,{aggregateTwoErrors:aggregateTwoErrors$1,codes:{ERR_MULTIPLE_CALLBACK},AbortError:AbortError$6}=errors,{Symbol:Symbol$3}=primordials,{kDestroyed,isDestroyed,isFinished,isServerRequest}=utils$1,kDestroy=Symbol$3("kDestroy"),kConstruct=Symbol$3("kConstruct");function checkError(xt,e,At){xt&&(xt.stack,e&&!e.errored&&(e.errored=xt),At&&!At.errored&&(At.errored=xt))}function destroy(xt,e){const At=this._readableState,kt=this._writableState,Bt=kt||At;return kt!=null&&kt.destroyed||At!=null&&At.destroyed?(typeof e=="function"&&e(),this):(checkError(xt,kt,At),kt&&(kt.destroyed=!0),At&&(At.destroyed=!0),Bt.constructed?_destroy(this,xt,e):this.once(kDestroy,function(Nt){_destroy(this,aggregateTwoErrors$1(Nt,xt),e)}),this)}function _destroy(xt,e,At){let kt=!1;function Bt(Nt){if(kt)return;kt=!0;const jt=xt._readableState,Lt=xt._writableState;checkError(Nt,Lt,jt),Lt&&(Lt.closed=!0),jt&&(jt.closed=!0),typeof At=="function"&&At(Nt),Nt?process$2.nextTick(emitErrorCloseNT,xt,Nt):process$2.nextTick(emitCloseNT,xt)}try{xt._destroy(e||null,Bt)}catch(Nt){Bt(Nt)}}function emitErrorCloseNT(xt,e){emitErrorNT(xt,e),emitCloseNT(xt)}function emitCloseNT(xt){const e=xt._readableState,At=xt._writableState;At&&(At.closeEmitted=!0),e&&(e.closeEmitted=!0),(At!=null&&At.emitClose||e!=null&&e.emitClose)&&xt.emit("close")}function emitErrorNT(xt,e){const At=xt._readableState,kt=xt._writableState;kt!=null&&kt.errorEmitted||At!=null&&At.errorEmitted||(kt&&(kt.errorEmitted=!0),At&&(At.errorEmitted=!0),xt.emit("error",e))}function undestroy(){const xt=this._readableState,e=this._writableState;xt&&(xt.constructed=!0,xt.closed=!1,xt.closeEmitted=!1,xt.destroyed=!1,xt.errored=null,xt.errorEmitted=!1,xt.reading=!1,xt.ended=xt.readable===!1,xt.endEmitted=xt.readable===!1),e&&(e.constructed=!0,e.destroyed=!1,e.closed=!1,e.closeEmitted=!1,e.errored=null,e.errorEmitted=!1,e.finalCalled=!1,e.prefinished=!1,e.ended=e.writable===!1,e.ending=e.writable===!1,e.finished=e.writable===!1)}function errorOrDestroy(xt,e,At){const kt=xt._readableState,Bt=xt._writableState;if(Bt!=null&&Bt.destroyed||kt!=null&&kt.destroyed)return this;kt!=null&&kt.autoDestroy||Bt!=null&&Bt.autoDestroy?xt.destroy(e):e&&(e.stack,Bt&&!Bt.errored&&(Bt.errored=e),kt&&!kt.errored&&(kt.errored=e),At?process$2.nextTick(emitErrorNT,xt,e):emitErrorNT(xt,e))}function construct(xt,e){if(typeof xt._construct!="function")return;const At=xt._readableState,kt=xt._writableState;At&&(At.constructed=!1),kt&&(kt.constructed=!1),xt.once(kConstruct,e),!(xt.listenerCount(kConstruct)>1)&&process$2.nextTick(constructNT,xt)}function constructNT(xt){let e=!1;function At(kt){if(e){errorOrDestroy(xt,kt??new ERR_MULTIPLE_CALLBACK);return}e=!0;const Bt=xt._readableState,Nt=xt._writableState,jt=Nt||Bt;Bt&&(Bt.constructed=!0),Nt&&(Nt.constructed=!0),jt.destroyed?xt.emit(kDestroy,kt):kt?errorOrDestroy(xt,kt,!0):process$2.nextTick(emitConstructNT,xt)}try{xt._construct(kt=>{process$2.nextTick(At,kt)})}catch(kt){process$2.nextTick(At,kt)}}function emitConstructNT(xt){xt.emit(kConstruct)}function isRequest(xt){return(xt==null?void 0:xt.setHeader)&&typeof xt.abort=="function"}function emitCloseLegacy(xt){xt.emit("close")}function emitErrorCloseLegacy(xt,e){xt.emit("error",e),process$2.nextTick(emitCloseLegacy,xt)}function destroyer$2(xt,e){!xt||isDestroyed(xt)||(!e&&!isFinished(xt)&&(e=new AbortError$6),isServerRequest(xt)?(xt.socket=null,xt.destroy(e)):isRequest(xt)?xt.abort():isRequest(xt.req)?xt.req.abort():typeof xt.destroy=="function"?xt.destroy(e):typeof xt.close=="function"?xt.close():e?process$2.nextTick(emitErrorCloseLegacy,xt,e):process$2.nextTick(emitCloseLegacy,xt),xt.destroyed||(xt[kDestroyed]=!0))}var destroy_1={construct,destroyer:destroyer$2,destroy,undestroy,errorOrDestroy};const{ArrayIsArray:ArrayIsArray$1,ObjectSetPrototypeOf:ObjectSetPrototypeOf$2}=primordials,{EventEmitter:EE}=eventsExports;function Stream$2(xt){EE.call(this,xt)}ObjectSetPrototypeOf$2(Stream$2.prototype,EE.prototype);ObjectSetPrototypeOf$2(Stream$2,EE);Stream$2.prototype.pipe=function(xt,e){const At=this;function kt(zt){xt.writable&&xt.write(zt)===!1&&At.pause&&At.pause()}At.on("data",kt);function Bt(){At.readable&&At.resume&&At.resume()}xt.on("drain",Bt),!xt._isStdio&&(!e||e.end!==!1)&&(At.on("end",jt),At.on("close",Lt));let Nt=!1;function jt(){Nt||(Nt=!0,xt.end())}function Lt(){Nt||(Nt=!0,typeof xt.destroy=="function"&&xt.destroy())}function er(zt){tr(),EE.listenerCount(this,"error")===0&&this.emit("error",zt)}prependListener(At,"error",er),prependListener(xt,"error",er);function tr(){At.removeListener("data",kt),xt.removeListener("drain",Bt),At.removeListener("end",jt),At.removeListener("close",Lt),At.removeListener("error",er),xt.removeListener("error",er),At.removeListener("end",tr),At.removeListener("close",tr),xt.removeListener("close",tr)}return At.on("end",tr),At.on("close",tr),xt.on("close",tr),xt.emit("pipe",At),xt};function prependListener(xt,e,At){if(typeof xt.prependListener=="function")return xt.prependListener(e,At);!xt._events||!xt._events[e]?xt.on(e,At):ArrayIsArray$1(xt._events[e])?xt._events[e].unshift(At):xt._events[e]=[At,xt._events[e]]}var legacy={Stream:Stream$2,prependListener},addAbortSignal={exports:{}};(function(xt){const{AbortError:e,codes:At}=errors,{isNodeStream:kt,isWebStream:Bt,kControllerErrorFunction:Nt}=utils$1,jt=endOfStreamExports,{ERR_INVALID_ARG_TYPE:Lt}=At,er=(tr,zt)=>{if(typeof tr!="object"||!("aborted"in tr))throw new Lt(zt,"AbortSignal",tr)};xt.exports.addAbortSignal=function(zt,rr){if(er(zt,"signal"),!kt(rr)&&!Bt(rr))throw new Lt("stream",["ReadableStream","WritableStream","Stream"],rr);return xt.exports.addAbortSignalNoValidate(zt,rr)},xt.exports.addAbortSignalNoValidate=function(tr,zt){if(typeof tr!="object"||!("aborted"in tr))return zt;const rr=kt(zt)?()=>{zt.destroy(new e(void 0,{cause:tr.reason}))}:()=>{zt[Nt](new e(void 0,{cause:tr.reason}))};return tr.aborted?rr():(tr.addEventListener("abort",rr),jt(zt,()=>tr.removeEventListener("abort",rr))),zt}})(addAbortSignal);var addAbortSignalExports=addAbortSignal.exports;const{StringPrototypeSlice,SymbolIterator:SymbolIterator$1,TypedArrayPrototypeSet,Uint8Array:Uint8Array$1}=primordials,{Buffer:Buffer$1}=buffer$2,{inspect}=utilExports;var buffer_list=class{constructor(){this.head=null,this.tail=null,this.length=0}push(e){const At={data:e,next:null};this.length>0?this.tail.next=At:this.head=At,this.tail=At,++this.length}unshift(e){const At={data:e,next:this.head};this.length===0&&(this.tail=At),this.head=At,++this.length}shift(){if(this.length===0)return;const e=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,e}clear(){this.head=this.tail=null,this.length=0}join(e){if(this.length===0)return"";let At=this.head,kt=""+At.data;for(;(At=At.next)!==null;)kt+=e+At.data;return kt}concat(e){if(this.length===0)return Buffer$1.alloc(0);const At=Buffer$1.allocUnsafe(e>>>0);let kt=this.head,Bt=0;for(;kt;)TypedArrayPrototypeSet(At,kt.data,Bt),Bt+=kt.data.length,kt=kt.next;return At}consume(e,At){const kt=this.head.data;if(e<kt.length){const Bt=kt.slice(0,e);return this.head.data=kt.slice(e),Bt}return e===kt.length?this.shift():At?this._getString(e):this._getBuffer(e)}first(){return this.head.data}*[SymbolIterator$1](){for(let e=this.head;e;e=e.next)yield e.data}_getString(e){let At="",kt=this.head,Bt=0;do{const Nt=kt.data;if(e>Nt.length)At+=Nt,e-=Nt.length;else{e===Nt.length?(At+=Nt,++Bt,kt.next?this.head=kt.next:this.head=this.tail=null):(At+=StringPrototypeSlice(Nt,0,e),this.head=kt,kt.data=StringPrototypeSlice(Nt,e));break}++Bt}while((kt=kt.next)!==null);return this.length-=Bt,At}_getBuffer(e){const At=Buffer$1.allocUnsafe(e),kt=e;let Bt=this.head,Nt=0;do{const jt=Bt.data;if(e>jt.length)TypedArrayPrototypeSet(At,jt,kt-e),e-=jt.length;else{e===jt.length?(TypedArrayPrototypeSet(At,jt,kt-e),++Nt,Bt.next?this.head=Bt.next:this.head=this.tail=null):(TypedArrayPrototypeSet(At,new Uint8Array$1(jt.buffer,jt.byteOffset,e),kt-e),this.head=Bt,Bt.data=jt.slice(e));break}++Nt}while((Bt=Bt.next)!==null);return this.length-=Nt,At}[Symbol.for("nodejs.util.inspect.custom")](e,At){return inspect(this,{...At,depth:0,customInspect:!1})}};const{MathFloor:MathFloor$1,NumberIsInteger}=primordials,{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$2}=errors.codes;function highWaterMarkFrom(xt,e,At){return xt.highWaterMark!=null?xt.highWaterMark:e?xt[At]:null}function getDefaultHighWaterMark(xt){return xt?16:16*1024}function getHighWaterMark$1(xt,e,At,kt){const Bt=highWaterMarkFrom(e,kt,At);if(Bt!=null){if(!NumberIsInteger(Bt)||Bt<0){const Nt=kt?`options.${At}`:"options.highWaterMark";throw new ERR_INVALID_ARG_VALUE$2(Nt,Bt)}return MathFloor$1(Bt)}return getDefaultHighWaterMark(xt.objectMode)}var state={getHighWaterMark:getHighWaterMark$1,getDefaultHighWaterMark};const process$1=browserExports$3,{PromisePrototypeThen:PromisePrototypeThen$1,SymbolAsyncIterator:SymbolAsyncIterator$1,SymbolIterator}=primordials,{Buffer}=buffer$2,{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$3,ERR_STREAM_NULL_VALUES}=errors.codes;function from$1(xt,e,At){let kt;if(typeof e=="string"||e instanceof Buffer)return new xt({objectMode:!0,...At,read(){this.push(e),this.push(null)}});let Bt;if(e&&e[SymbolAsyncIterator$1])Bt=!0,kt=e[SymbolAsyncIterator$1]();else if(e&&e[SymbolIterator])Bt=!1,kt=e[SymbolIterator]();else throw new ERR_INVALID_ARG_TYPE$3("iterable",["Iterable"],e);const Nt=new xt({objectMode:!0,highWaterMark:1,...At});let jt=!1;Nt._read=function(){jt||(jt=!0,er())},Nt._destroy=function(tr,zt){PromisePrototypeThen$1(Lt(tr),()=>process$1.nextTick(zt,tr),rr=>process$1.nextTick(zt,rr||tr))};async function Lt(tr){const zt=tr!=null,rr=typeof kt.throw=="function";if(zt&&rr){const{value:nr,done:ir}=await kt.throw(tr);if(await nr,ir)return}if(typeof kt.return=="function"){const{value:nr}=await kt.return();await nr}}async function er(){for(;;){try{const{value:tr,done:zt}=Bt?await kt.next():kt.next();if(zt)Nt.push(null);else{const rr=tr&&typeof tr.then=="function"?await tr:tr;if(rr===null)throw jt=!1,new ERR_STREAM_NULL_VALUES;if(Nt.push(rr))continue;jt=!1}}catch(tr){Nt.destroy(tr)}break}}return Nt}var from_1=from$1,readable,hasRequiredReadable;function requireReadable(){if(hasRequiredReadable)return readable;hasRequiredReadable=1;const xt=browserExports$3,{ArrayPrototypeIndexOf:e,NumberIsInteger:At,NumberIsNaN:kt,NumberParseInt:Bt,ObjectDefineProperties:Nt,ObjectKeys:jt,ObjectSetPrototypeOf:Lt,Promise:er,SafeSet:tr,SymbolAsyncIterator:zt,Symbol:rr}=primordials;readable=vr,vr.ReadableState=$r;const{EventEmitter:nr}=eventsExports,{Stream:ir,prependListener:ar}=legacy,{Buffer:dr}=buffer$2,{addAbortSignal:ur}=addAbortSignalExports,fr=endOfStreamExports;let pr=utilExports.debuglog("stream",en=>{pr=en});const lr=buffer_list,yr=destroy_1,{getHighWaterMark:br,getDefaultHighWaterMark:Ar}=state,{aggregateTwoErrors:Pr,codes:{ERR_INVALID_ARG_TYPE:kr,ERR_METHOD_NOT_IMPLEMENTED:Ur,ERR_OUT_OF_RANGE:Hr,ERR_STREAM_PUSH_AFTER_EOF:Lr,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:Sr}}=errors,{validateObject:_r}=validators,gr=rr("kPaused"),{StringDecoder:wr}=string_decoder,Dr=from_1;Lt(vr.prototype,ir.prototype),Lt(vr,ir);const xr=()=>{},{errorOrDestroy:Ir}=yr;function $r(en,tn,hn){typeof hn!="boolean"&&(hn=tn instanceof requireDuplex()),this.objectMode=!!(en&&en.objectMode),hn&&(this.objectMode=this.objectMode||!!(en&&en.readableObjectMode)),this.highWaterMark=en?br(this,en,"readableHighWaterMark",hn):Ar(!1),this.buffer=new lr,this.length=0,this.pipes=[],this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.constructed=!0,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this[gr]=null,this.errorEmitted=!1,this.emitClose=!en||en.emitClose!==!1,this.autoDestroy=!en||en.autoDestroy!==!1,this.destroyed=!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this.defaultEncoding=en&&en.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.multiAwaitDrain=!1,this.readingMore=!1,this.dataEmitted=!1,this.decoder=null,this.encoding=null,en&&en.encoding&&(this.decoder=new wr(en.encoding),this.encoding=en.encoding)}function vr(en){if(!(this instanceof vr))return new vr(en);const tn=this instanceof requireDuplex();this._readableState=new $r(en,this,tn),en&&(typeof en.read=="function"&&(this._read=en.read),typeof en.destroy=="function"&&(this._destroy=en.destroy),typeof en.construct=="function"&&(this._construct=en.construct),en.signal&&!tn&&ur(en.signal,this)),ir.call(this,en),yr.construct(this,()=>{this._readableState.needReadable&&Yr(this,this._readableState)})}vr.prototype.destroy=yr.destroy,vr.prototype._undestroy=yr.undestroy,vr.prototype._destroy=function(en,tn){tn(en)},vr.prototype[nr.captureRejectionSymbol]=function(en){this.destroy(en)},vr.prototype.push=function(en,tn){return Er(this,en,tn,!1)},vr.prototype.unshift=function(en,tn){return Er(this,en,tn,!0)};function Er(en,tn,hn,mn){pr("readableAddChunk",tn);const yn=en._readableState;let xn;if(yn.objectMode||(typeof tn=="string"?(hn=hn||yn.defaultEncoding,yn.encoding!==hn&&(mn&&yn.encoding?tn=dr.from(tn,hn).toString(yn.encoding):(tn=dr.from(tn,hn),hn=""))):tn instanceof dr?hn="":ir._isUint8Array(tn)?(tn=ir._uint8ArrayToBuffer(tn),hn=""):tn!=null&&(xn=new kr("chunk",["string","Buffer","Uint8Array"],tn))),xn)Ir(en,xn);else if(tn===null)yn.reading=!1,Br(en,yn);else if(yn.objectMode||tn&&tn.length>0)if(mn)if(yn.endEmitted)Ir(en,new Sr);else{if(yn.destroyed||yn.errored)return!1;Tr(en,yn,tn,!0)}else if(yn.ended)Ir(en,new Lr);else{if(yn.destroyed||yn.errored)return!1;yn.reading=!1,yn.decoder&&!hn?(tn=yn.decoder.write(tn),yn.objectMode||tn.length!==0?Tr(en,yn,tn,!1):Yr(en,yn)):Tr(en,yn,tn,!1)}else mn||(yn.reading=!1,Yr(en,yn));return!yn.ended&&(yn.length<yn.highWaterMark||yn.length===0)}function Tr(en,tn,hn,mn){tn.flowing&&tn.length===0&&!tn.sync&&en.listenerCount("data")>0?(tn.multiAwaitDrain?tn.awaitDrainWriters.clear():tn.awaitDrainWriters=null,tn.dataEmitted=!0,en.emit("data",hn)):(tn.length+=tn.objectMode?1:hn.length,mn?tn.buffer.unshift(hn):tn.buffer.push(hn),tn.needReadable&&Cr(en)),Yr(en,tn)}vr.prototype.isPaused=function(){const en=this._readableState;return en[gr]===!0||en.flowing===!1},vr.prototype.setEncoding=function(en){const tn=new wr(en);this._readableState.decoder=tn,this._readableState.encoding=this._readableState.decoder.encoding;const hn=this._readableState.buffer;let mn="";for(const yn of hn)mn+=tn.write(yn);return hn.clear(),mn!==""&&hn.push(mn),this._readableState.length=mn.length,this};const Rr=1073741824;function Mr(en){if(en>Rr)throw new Hr("size","<= 1GiB",en);return en--,en|=en>>>1,en|=en>>>2,en|=en>>>4,en|=en>>>8,en|=en>>>16,en++,en}function Gr(en,tn){return en<=0||tn.length===0&&tn.ended?0:tn.objectMode?1:kt(en)?tn.flowing&&tn.length?tn.buffer.first().length:tn.length:en<=tn.length?en:tn.ended?tn.length:0}vr.prototype.read=function(en){pr("read",en),en===void 0?en=NaN:At(en)||(en=Bt(en,10));const tn=this._readableState,hn=en;if(en>tn.highWaterMark&&(tn.highWaterMark=Mr(en)),en!==0&&(tn.emittedReadable=!1),en===0&&tn.needReadable&&((tn.highWaterMark!==0?tn.length>=tn.highWaterMark:tn.length>0)||tn.ended))return pr("read: emitReadable",tn.length,tn.ended),tn.length===0&&tn.ended?rn(this):Cr(this),null;if(en=Gr(en,tn),en===0&&tn.ended)return tn.length===0&&rn(this),null;let mn=tn.needReadable;if(pr("need readable",mn),(tn.length===0||tn.length-en<tn.highWaterMark)&&(mn=!0,pr("length less than watermark",mn)),tn.ended||tn.reading||tn.destroyed||tn.errored||!tn.constructed)mn=!1,pr("reading, ended or constructing",mn);else if(mn){pr("do read"),tn.reading=!0,tn.sync=!0,tn.length===0&&(tn.needReadable=!0);try{this._read(tn.highWaterMark)}catch(xn){Ir(this,xn)}tn.sync=!1,tn.reading||(en=Gr(hn,tn))}let yn;return en>0?yn=Zr(en,tn):yn=null,yn===null?(tn.needReadable=tn.length<=tn.highWaterMark,en=0):(tn.length-=en,tn.multiAwaitDrain?tn.awaitDrainWriters.clear():tn.awaitDrainWriters=null),tn.length===0&&(tn.ended||(tn.needReadable=!0),hn!==en&&tn.ended&&rn(this)),yn!==null&&!tn.errorEmitted&&!tn.closeEmitted&&(tn.dataEmitted=!0,this.emit("data",yn)),yn};function Br(en,tn){if(pr("onEofChunk"),!tn.ended){if(tn.decoder){const hn=tn.decoder.end();hn&&hn.length&&(tn.buffer.push(hn),tn.length+=tn.objectMode?1:hn.length)}tn.ended=!0,tn.sync?Cr(en):(tn.needReadable=!1,tn.emittedReadable=!0,jr(en))}}function Cr(en){const tn=en._readableState;pr("emitReadable",tn.needReadable,tn.emittedReadable),tn.needReadable=!1,tn.emittedReadable||(pr("emitReadable",tn.flowing),tn.emittedReadable=!0,xt.nextTick(jr,en))}function jr(en){const tn=en._readableState;pr("emitReadable_",tn.destroyed,tn.length,tn.ended),!tn.destroyed&&!tn.errored&&(tn.length||tn.ended)&&(en.emit("readable"),tn.emittedReadable=!1),tn.needReadable=!tn.flowing&&!tn.ended&&tn.length<=tn.highWaterMark,qr(en)}function Yr(en,tn){!tn.readingMore&&tn.constructed&&(tn.readingMore=!0,xt.nextTick(Qr,en,tn))}function Qr(en,tn){for(;!tn.reading&&!tn.ended&&(tn.length<tn.highWaterMark||tn.flowing&&tn.length===0);){const hn=tn.length;if(pr("maybeReadMore read 0"),en.read(0),hn===tn.length)break}tn.readingMore=!1}vr.prototype._read=function(en){throw new Ur("_read()")},vr.prototype.pipe=function(en,tn){const hn=this,mn=this._readableState;mn.pipes.length===1&&(mn.multiAwaitDrain||(mn.multiAwaitDrain=!0,mn.awaitDrainWriters=new tr(mn.awaitDrainWriters?[mn.awaitDrainWriters]:[]))),mn.pipes.push(en),pr("pipe count=%d opts=%j",mn.pipes.length,tn);const xn=(!tn||tn.end!==!1)&&en!==xt.stdout&&en!==xt.stderr?On:Wn;mn.endEmitted?xt.nextTick(xn):hn.once("end",xn),en.on("unpipe",In);function In(kn,Zn){pr("onunpipe"),kn===hn&&Zn&&Zn.hasUnpiped===!1&&(Zn.hasUnpiped=!0,Hn())}function On(){pr("onend"),en.end()}let Dn,Yn=!1;function Hn(){pr("cleanup"),en.removeListener("close",Rn),en.removeListener("finish",Nn),Dn&&en.removeListener("drain",Dn),en.removeListener("error",Pn),en.removeListener("unpipe",In),hn.removeListener("end",On),hn.removeListener("end",Wn),hn.removeListener("data",zn),Yn=!0,Dn&&mn.awaitDrainWriters&&(!en._writableState||en._writableState.needDrain)&&Dn()}function Mn(){Yn||(mn.pipes.length===1&&mn.pipes[0]===en?(pr("false write response, pause",0),mn.awaitDrainWriters=en,mn.multiAwaitDrain=!1):mn.pipes.length>1&&mn.pipes.includes(en)&&(pr("false write response, pause",mn.awaitDrainWriters.size),mn.awaitDrainWriters.add(en)),hn.pause()),Dn||(Dn=Jr(hn,en),en.on("drain",Dn))}hn.on("data",zn);function zn(kn){pr("ondata");const Zn=en.write(kn);pr("dest.write",Zn),Zn===!1&&Mn()}function Pn(kn){if(pr("onerror",kn),Wn(),en.removeListener("error",Pn),en.listenerCount("error")===0){const Zn=en._writableState||en._readableState;Zn&&!Zn.errorEmitted?Ir(en,kn):en.emit("error",kn)}}ar(en,"error",Pn);function Rn(){en.removeListener("finish",Nn),Wn()}en.once("close",Rn);function Nn(){pr("onfinish"),en.removeListener("close",Rn),Wn()}en.once("finish",Nn);function Wn(){pr("unpipe"),hn.unpipe(en)}return en.emit("pipe",hn),en.writableNeedDrain===!0?mn.flowing&&Mn():mn.flowing||(pr("pipe resume"),hn.resume()),en};function Jr(en,tn){return function(){const mn=en._readableState;mn.awaitDrainWriters===tn?(pr("pipeOnDrain",1),mn.awaitDrainWriters=null):mn.multiAwaitDrain&&(pr("pipeOnDrain",mn.awaitDrainWriters.size),mn.awaitDrainWriters.delete(tn)),(!mn.awaitDrainWriters||mn.awaitDrainWriters.size===0)&&en.listenerCount("data")&&en.resume()}}vr.prototype.unpipe=function(en){const tn=this._readableState,hn={hasUnpiped:!1};if(tn.pipes.length===0)return this;if(!en){const yn=tn.pipes;tn.pipes=[],this.pause();for(let xn=0;xn<yn.length;xn++)yn[xn].emit("unpipe",this,{hasUnpiped:!1});return this}const mn=e(tn.pipes,en);return mn===-1?this:(tn.pipes.splice(mn,1),tn.pipes.length===0&&this.pause(),en.emit("unpipe",this,hn),this)},vr.prototype.on=function(en,tn){const hn=ir.prototype.on.call(this,en,tn),mn=this._readableState;return en==="data"?(mn.readableListening=this.listenerCount("readable")>0,mn.flowing!==!1&&this.resume()):en==="readable"&&!mn.endEmitted&&!mn.readableListening&&(mn.readableListening=mn.needReadable=!0,mn.flowing=!1,mn.emittedReadable=!1,pr("on readable",mn.length,mn.reading),mn.length?Cr(this):mn.reading||xt.nextTick(Nr,this)),hn},vr.prototype.addListener=vr.prototype.on,vr.prototype.removeListener=function(en,tn){const hn=ir.prototype.removeListener.call(this,en,tn);return en==="readable"&&xt.nextTick(Wr,this),hn},vr.prototype.off=vr.prototype.removeListener,vr.prototype.removeAllListeners=function(en){const tn=ir.prototype.removeAllListeners.apply(this,arguments);return(en==="readable"||en===void 0)&&xt.nextTick(Wr,this),tn};function Wr(en){const tn=en._readableState;tn.readableListening=en.listenerCount("readable")>0,tn.resumeScheduled&&tn[gr]===!1?tn.flowing=!0:en.listenerCount("data")>0?en.resume():tn.readableListening||(tn.flowing=null)}function Nr(en){pr("readable nexttick read 0"),en.read(0)}vr.prototype.resume=function(){const en=this._readableState;return en.flowing||(pr("resume"),en.flowing=!en.readableListening,Vr(this,en)),en[gr]=!1,this};function Vr(en,tn){tn.resumeScheduled||(tn.resumeScheduled=!0,xt.nextTick(Xr,en,tn))}function Xr(en,tn){pr("resume",tn.reading),tn.reading||en.read(0),tn.resumeScheduled=!1,en.emit("resume"),qr(en),tn.flowing&&!tn.reading&&en.read(0)}vr.prototype.pause=function(){return pr("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(pr("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[gr]=!0,this};function qr(en){const tn=en._readableState;for(pr("flow",tn.flowing);tn.flowing&&en.read()!==null;);}vr.prototype.wrap=function(en){let tn=!1;en.on("data",mn=>{!this.push(mn)&&en.pause&&(tn=!0,en.pause())}),en.on("end",()=>{this.push(null)}),en.on("error",mn=>{Ir(this,mn)}),en.on("close",()=>{this.destroy()}),en.on("destroy",()=>{this.destroy()}),this._read=()=>{tn&&en.resume&&(tn=!1,en.resume())};const hn=jt(en);for(let mn=1;mn<hn.length;mn++){const yn=hn[mn];this[yn]===void 0&&typeof en[yn]=="function"&&(this[yn]=en[yn].bind(en))}return this},vr.prototype[zt]=function(){return Or(this)},vr.prototype.iterator=function(en){return en!==void 0&&_r(en,"options"),Or(this,en)};function Or(en,tn){typeof en.read!="function"&&(en=vr.wrap(en,{objectMode:!0}));const hn=Fr(en,tn);return hn.stream=en,hn}async function*Fr(en,tn){let hn=xr;function mn(In){this===en?(hn(),hn=xr):hn=In}en.on("readable",mn);let yn;const xn=fr(en,{writable:!1},In=>{yn=In?Pr(yn,In):null,hn(),hn=xr});try{for(;;){const In=en.destroyed?null:en.read();if(In!==null)yield In;else{if(yn)throw yn;if(yn===null)return;await new er(mn)}}}catch(In){throw yn=Pr(yn,In),yn}finally{(yn||(tn==null?void 0:tn.destroyOnReturn)!==!1)&&(yn===void 0||en._readableState.autoDestroy)?yr.destroyer(en,null):(en.off("readable",mn),xn())}}Nt(vr.prototype,{readable:{__proto__:null,get(){const en=this._readableState;return!!en&&en.readable!==!1&&!en.destroyed&&!en.errorEmitted&&!en.endEmitted},set(en){this._readableState&&(this._readableState.readable=!!en)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(en){this._readableState&&(this._readableState.flowing=en)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(en){this._readableState&&(this._readableState.destroyed=en)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),Nt($r.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[gr]!==!1},set(en){this[gr]=!!en}}}),vr._fromList=Zr;function Zr(en,tn){if(tn.length===0)return null;let hn;return tn.objectMode?hn=tn.buffer.shift():!en||en>=tn.length?(tn.decoder?hn=tn.buffer.join(""):tn.buffer.length===1?hn=tn.buffer.first():hn=tn.buffer.concat(tn.length),tn.buffer.clear()):hn=tn.buffer.consume(en,tn.decoder),hn}function rn(en){const tn=en._readableState;pr("endReadable",tn.endEmitted),tn.endEmitted||(tn.ended=!0,xt.nextTick(un,tn,en))}function un(en,tn){if(pr("endReadableNT",en.endEmitted,en.length),!en.errored&&!en.closeEmitted&&!en.endEmitted&&en.length===0){if(en.endEmitted=!0,tn.emit("end"),tn.writable&&tn.allowHalfOpen===!1)xt.nextTick(dn,tn);else if(en.autoDestroy){const hn=tn._writableState;(!hn||hn.autoDestroy&&(hn.finished||hn.writable===!1))&&tn.destroy()}}}function dn(en){en.writable&&!en.writableEnded&&!en.destroyed&&en.end()}vr.from=function(en,tn){return Dr(vr,en,tn)};let vn;function $n(){return vn===void 0&&(vn={}),vn}return vr.fromWeb=function(en,tn){return $n().newStreamReadableFromReadableStream(en,tn)},vr.toWeb=function(en,tn){return $n().newReadableStreamFromStreamReadable(en,tn)},vr.wrap=function(en,tn){var hn,mn;return new vr({objectMode:(hn=(mn=en.readableObjectMode)!==null&&mn!==void 0?mn:en.objectMode)!==null&&hn!==void 0?hn:!0,...tn,destroy(yn,xn){yr.destroyer(en,yn),xn(yn)}}).wrap(en)},readable}var writable,hasRequiredWritable;function requireWritable(){if(hasRequiredWritable)return writable;hasRequiredWritable=1;const xt=browserExports$3,{ArrayPrototypeSlice:e,Error:At,FunctionPrototypeSymbolHasInstance:kt,ObjectDefineProperty:Bt,ObjectDefineProperties:Nt,ObjectSetPrototypeOf:jt,StringPrototypeToLowerCase:Lt,Symbol:er,SymbolHasInstance:tr}=primordials;writable=wr,wr.WritableState=_r;const{EventEmitter:zt}=eventsExports,rr=legacy.Stream,{Buffer:nr}=buffer$2,ir=destroy_1,{addAbortSignal:ar}=addAbortSignalExports,{getHighWaterMark:dr,getDefaultHighWaterMark:ur}=state,{ERR_INVALID_ARG_TYPE:fr,ERR_METHOD_NOT_IMPLEMENTED:pr,ERR_MULTIPLE_CALLBACK:lr,ERR_STREAM_CANNOT_PIPE:yr,ERR_STREAM_DESTROYED:br,ERR_STREAM_ALREADY_FINISHED:Ar,ERR_STREAM_NULL_VALUES:Pr,ERR_STREAM_WRITE_AFTER_END:kr,ERR_UNKNOWN_ENCODING:Ur}=errors.codes,{errorOrDestroy:Hr}=ir;jt(wr.prototype,rr.prototype),jt(wr,rr);function Lr(){}const Sr=er("kOnFinished");function _r(Nr,Vr,Xr){typeof Xr!="boolean"&&(Xr=Vr instanceof requireDuplex()),this.objectMode=!!(Nr&&Nr.objectMode),Xr&&(this.objectMode=this.objectMode||!!(Nr&&Nr.writableObjectMode)),this.highWaterMark=Nr?dr(this,Nr,"writableHighWaterMark",Xr):ur(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;const qr=!!(Nr&&Nr.decodeStrings===!1);this.decodeStrings=!qr,this.defaultEncoding=Nr&&Nr.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=vr.bind(void 0,Vr),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,gr(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!Nr||Nr.emitClose!==!1,this.autoDestroy=!Nr||Nr.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[Sr]=[]}function gr(Nr){Nr.buffered=[],Nr.bufferedIndex=0,Nr.allBuffers=!0,Nr.allNoop=!0}_r.prototype.getBuffer=function(){return e(this.buffered,this.bufferedIndex)},Bt(_r.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function wr(Nr){const Vr=this instanceof requireDuplex();if(!Vr&&!kt(wr,this))return new wr(Nr);this._writableState=new _r(Nr,this,Vr),Nr&&(typeof Nr.write=="function"&&(this._write=Nr.write),typeof Nr.writev=="function"&&(this._writev=Nr.writev),typeof Nr.destroy=="function"&&(this._destroy=Nr.destroy),typeof Nr.final=="function"&&(this._final=Nr.final),typeof Nr.construct=="function"&&(this._construct=Nr.construct),Nr.signal&&ar(Nr.signal,this)),rr.call(this,Nr),ir.construct(this,()=>{const Xr=this._writableState;Xr.writing||Mr(this,Xr),jr(this,Xr)})}Bt(wr,tr,{__proto__:null,value:function(Nr){return kt(this,Nr)?!0:this!==wr?!1:Nr&&Nr._writableState instanceof _r}}),wr.prototype.pipe=function(){Hr(this,new yr)};function Dr(Nr,Vr,Xr,qr){const Or=Nr._writableState;if(typeof Xr=="function")qr=Xr,Xr=Or.defaultEncoding;else{if(!Xr)Xr=Or.defaultEncoding;else if(Xr!=="buffer"&&!nr.isEncoding(Xr))throw new Ur(Xr);typeof qr!="function"&&(qr=Lr)}if(Vr===null)throw new Pr;if(!Or.objectMode)if(typeof Vr=="string")Or.decodeStrings!==!1&&(Vr=nr.from(Vr,Xr),Xr="buffer");else if(Vr instanceof nr)Xr="buffer";else if(rr._isUint8Array(Vr))Vr=rr._uint8ArrayToBuffer(Vr),Xr="buffer";else throw new fr("chunk",["string","Buffer","Uint8Array"],Vr);let Fr;return Or.ending?Fr=new kr:Or.destroyed&&(Fr=new br("write")),Fr?(xt.nextTick(qr,Fr),Hr(Nr,Fr,!0),Fr):(Or.pendingcb++,xr(Nr,Or,Vr,Xr,qr))}wr.prototype.write=function(Nr,Vr,Xr){return Dr(this,Nr,Vr,Xr)===!0},wr.prototype.cork=function(){this._writableState.corked++},wr.prototype.uncork=function(){const Nr=this._writableState;Nr.corked&&(Nr.corked--,Nr.writing||Mr(this,Nr))},wr.prototype.setDefaultEncoding=function(Vr){if(typeof Vr=="string"&&(Vr=Lt(Vr)),!nr.isEncoding(Vr))throw new Ur(Vr);return this._writableState.defaultEncoding=Vr,this};function xr(Nr,Vr,Xr,qr,Or){const Fr=Vr.objectMode?1:Xr.length;Vr.length+=Fr;const Zr=Vr.length<Vr.highWaterMark;return Zr||(Vr.needDrain=!0),Vr.writing||Vr.corked||Vr.errored||!Vr.constructed?(Vr.buffered.push({chunk:Xr,encoding:qr,callback:Or}),Vr.allBuffers&&qr!=="buffer"&&(Vr.allBuffers=!1),Vr.allNoop&&Or!==Lr&&(Vr.allNoop=!1)):(Vr.writelen=Fr,Vr.writecb=Or,Vr.writing=!0,Vr.sync=!0,Nr._write(Xr,qr,Vr.onwrite),Vr.sync=!1),Zr&&!Vr.errored&&!Vr.destroyed}function Ir(Nr,Vr,Xr,qr,Or,Fr,Zr){Vr.writelen=qr,Vr.writecb=Zr,Vr.writing=!0,Vr.sync=!0,Vr.destroyed?Vr.onwrite(new br("write")):Xr?Nr._writev(Or,Vr.onwrite):Nr._write(Or,Fr,Vr.onwrite),Vr.sync=!1}function $r(Nr,Vr,Xr,qr){--Vr.pendingcb,qr(Xr),Rr(Vr),Hr(Nr,Xr)}function vr(Nr,Vr){const Xr=Nr._writableState,qr=Xr.sync,Or=Xr.writecb;if(typeof Or!="function"){Hr(Nr,new lr);return}Xr.writing=!1,Xr.writecb=null,Xr.length-=Xr.writelen,Xr.writelen=0,Vr?(Vr.stack,Xr.errored||(Xr.errored=Vr),Nr._readableState&&!Nr._readableState.errored&&(Nr._readableState.errored=Vr),qr?xt.nextTick($r,Nr,Xr,Vr,Or):$r(Nr,Xr,Vr,Or)):(Xr.buffered.length>Xr.bufferedIndex&&Mr(Nr,Xr),qr?Xr.afterWriteTickInfo!==null&&Xr.afterWriteTickInfo.cb===Or?Xr.afterWriteTickInfo.count++:(Xr.afterWriteTickInfo={count:1,cb:Or,stream:Nr,state:Xr},xt.nextTick(Er,Xr.afterWriteTickInfo)):Tr(Nr,Xr,1,Or))}function Er({stream:Nr,state:Vr,count:Xr,cb:qr}){return Vr.afterWriteTickInfo=null,Tr(Nr,Vr,Xr,qr)}function Tr(Nr,Vr,Xr,qr){for(!Vr.ending&&!Nr.destroyed&&Vr.length===0&&Vr.needDrain&&(Vr.needDrain=!1,Nr.emit("drain"));Xr-- >0;)Vr.pendingcb--,qr();Vr.destroyed&&Rr(Vr),jr(Nr,Vr)}function Rr(Nr){if(Nr.writing)return;for(let Or=Nr.bufferedIndex;Or<Nr.buffered.length;++Or){var Vr;const{chunk:Fr,callback:Zr}=Nr.buffered[Or],rn=Nr.objectMode?1:Fr.length;Nr.length-=rn,Zr((Vr=Nr.errored)!==null&&Vr!==void 0?Vr:new br("write"))}const Xr=Nr[Sr].splice(0);for(let Or=0;Or<Xr.length;Or++){var qr;Xr[Or]((qr=Nr.errored)!==null&&qr!==void 0?qr:new br("end"))}gr(Nr)}function Mr(Nr,Vr){if(Vr.corked||Vr.bufferProcessing||Vr.destroyed||!Vr.constructed)return;const{buffered:Xr,bufferedIndex:qr,objectMode:Or}=Vr,Fr=Xr.length-qr;if(!Fr)return;let Zr=qr;if(Vr.bufferProcessing=!0,Fr>1&&Nr._writev){Vr.pendingcb-=Fr-1;const rn=Vr.allNoop?Lr:dn=>{for(let vn=Zr;vn<Xr.length;++vn)Xr[vn].callback(dn)},un=Vr.allNoop&&Zr===0?Xr:e(Xr,Zr);un.allBuffers=Vr.allBuffers,Ir(Nr,Vr,!0,Vr.length,un,"",rn),gr(Vr)}else{do{const{chunk:rn,encoding:un,callback:dn}=Xr[Zr];Xr[Zr++]=null;const vn=Or?1:rn.length;Ir(Nr,Vr,!1,vn,rn,un,dn)}while(Zr<Xr.length&&!Vr.writing);Zr===Xr.length?gr(Vr):Zr>256?(Xr.splice(0,Zr),Vr.bufferedIndex=0):Vr.bufferedIndex=Zr}Vr.bufferProcessing=!1}wr.prototype._write=function(Nr,Vr,Xr){if(this._writev)this._writev([{chunk:Nr,encoding:Vr}],Xr);else throw new pr("_write()")},wr.prototype._writev=null,wr.prototype.end=function(Nr,Vr,Xr){const qr=this._writableState;typeof Nr=="function"?(Xr=Nr,Nr=null,Vr=null):typeof Vr=="function"&&(Xr=Vr,Vr=null);let Or;if(Nr!=null){const Fr=Dr(this,Nr,Vr);Fr instanceof At&&(Or=Fr)}return qr.corked&&(qr.corked=1,this.uncork()),Or||(!qr.errored&&!qr.ending?(qr.ending=!0,jr(this,qr,!0),qr.ended=!0):qr.finished?Or=new Ar("end"):qr.destroyed&&(Or=new br("end"))),typeof Xr=="function"&&(Or||qr.finished?xt.nextTick(Xr,Or):qr[Sr].push(Xr)),this};function Gr(Nr){return Nr.ending&&!Nr.destroyed&&Nr.constructed&&Nr.length===0&&!Nr.errored&&Nr.buffered.length===0&&!Nr.finished&&!Nr.writing&&!Nr.errorEmitted&&!Nr.closeEmitted}function Br(Nr,Vr){let Xr=!1;function qr(Or){if(Xr){Hr(Nr,Or??lr());return}if(Xr=!0,Vr.pendingcb--,Or){const Fr=Vr[Sr].splice(0);for(let Zr=0;Zr<Fr.length;Zr++)Fr[Zr](Or);Hr(Nr,Or,Vr.sync)}else Gr(Vr)&&(Vr.prefinished=!0,Nr.emit("prefinish"),Vr.pendingcb++,xt.nextTick(Yr,Nr,Vr))}Vr.sync=!0,Vr.pendingcb++;try{Nr._final(qr)}catch(Or){qr(Or)}Vr.sync=!1}function Cr(Nr,Vr){!Vr.prefinished&&!Vr.finalCalled&&(typeof Nr._final=="function"&&!Vr.destroyed?(Vr.finalCalled=!0,Br(Nr,Vr)):(Vr.prefinished=!0,Nr.emit("prefinish")))}function jr(Nr,Vr,Xr){Gr(Vr)&&(Cr(Nr,Vr),Vr.pendingcb===0&&(Xr?(Vr.pendingcb++,xt.nextTick((qr,Or)=>{Gr(Or)?Yr(qr,Or):Or.pendingcb--},Nr,Vr)):Gr(Vr)&&(Vr.pendingcb++,Yr(Nr,Vr))))}function Yr(Nr,Vr){Vr.pendingcb--,Vr.finished=!0;const Xr=Vr[Sr].splice(0);for(let qr=0;qr<Xr.length;qr++)Xr[qr]();if(Nr.emit("finish"),Vr.autoDestroy){const qr=Nr._readableState;(!qr||qr.autoDestroy&&(qr.endEmitted||qr.readable===!1))&&Nr.destroy()}}Nt(wr.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(Nr){this._writableState&&(this._writableState.destroyed=Nr)}},writable:{__proto__:null,get(){const Nr=this._writableState;return!!Nr&&Nr.writable!==!1&&!Nr.destroyed&&!Nr.errored&&!Nr.ending&&!Nr.ended},set(Nr){this._writableState&&(this._writableState.writable=!!Nr)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){const Nr=this._writableState;return Nr?!Nr.destroyed&&!Nr.ending&&Nr.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});const Qr=ir.destroy;wr.prototype.destroy=function(Nr,Vr){const Xr=this._writableState;return!Xr.destroyed&&(Xr.bufferedIndex<Xr.buffered.length||Xr[Sr].length)&&xt.nextTick(Rr,Xr),Qr.call(this,Nr,Vr),this},wr.prototype._undestroy=ir.undestroy,wr.prototype._destroy=function(Nr,Vr){Vr(Nr)},wr.prototype[zt.captureRejectionSymbol]=function(Nr){this.destroy(Nr)};let Jr;function Wr(){return Jr===void 0&&(Jr={}),Jr}return wr.fromWeb=function(Nr,Vr){return Wr().newStreamWritableFromWritableStream(Nr,Vr)},wr.toWeb=function(Nr){return Wr().newWritableStreamFromStreamWritable(Nr)},writable}var duplexify,hasRequiredDuplexify;function requireDuplexify(){if(hasRequiredDuplexify)return duplexify;hasRequiredDuplexify=1;const xt=browserExports$3,e=buffer$2,{isReadable:At,isWritable:kt,isIterable:Bt,isNodeStream:Nt,isReadableNodeStream:jt,isWritableNodeStream:Lt,isDuplexNodeStream:er}=utils$1,tr=endOfStreamExports,{AbortError:zt,codes:{ERR_INVALID_ARG_TYPE:rr,ERR_INVALID_RETURN_VALUE:nr}}=errors,{destroyer:ir}=destroy_1,ar=requireDuplex(),dr=requireReadable(),{createDeferredPromise:ur}=utilExports,fr=from_1,pr=globalThis.Blob||e.Blob,lr=typeof pr<"u"?function(Hr){return Hr instanceof pr}:function(Hr){return!1},yr=globalThis.AbortController||requireBrowser().AbortController,{FunctionPrototypeCall:br}=primordials;class Ar extends ar{constructor(Hr){super(Hr),(Hr==null?void 0:Hr.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(Hr==null?void 0:Hr.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}}duplexify=function Ur(Hr,Lr){if(er(Hr))return Hr;if(jt(Hr))return kr({readable:Hr});if(Lt(Hr))return kr({writable:Hr});if(Nt(Hr))return kr({writable:!1,readable:!1});if(typeof Hr=="function"){const{value:_r,write:gr,final:wr,destroy:Dr}=Pr(Hr);if(Bt(_r))return fr(Ar,_r,{objectMode:!0,write:gr,final:wr,destroy:Dr});const xr=_r==null?void 0:_r.then;if(typeof xr=="function"){let Ir;const $r=br(xr,_r,vr=>{if(vr!=null)throw new nr("nully","body",vr)},vr=>{ir(Ir,vr)});return Ir=new Ar({objectMode:!0,readable:!1,write:gr,final(vr){wr(async()=>{try{await $r,xt.nextTick(vr,null)}catch(Er){xt.nextTick(vr,Er)}})},destroy:Dr})}throw new nr("Iterable, AsyncIterable or AsyncFunction",Lr,_r)}if(lr(Hr))return Ur(Hr.arrayBuffer());if(Bt(Hr))return fr(Ar,Hr,{objectMode:!0,writable:!1});if(typeof(Hr==null?void 0:Hr.writable)=="object"||typeof(Hr==null?void 0:Hr.readable)=="object"){const _r=Hr!=null&&Hr.readable?jt(Hr==null?void 0:Hr.readable)?Hr==null?void 0:Hr.readable:Ur(Hr.readable):void 0,gr=Hr!=null&&Hr.writable?Lt(Hr==null?void 0:Hr.writable)?Hr==null?void 0:Hr.writable:Ur(Hr.writable):void 0;return kr({readable:_r,writable:gr})}const Sr=Hr==null?void 0:Hr.then;if(typeof Sr=="function"){let _r;return br(Sr,Hr,gr=>{gr!=null&&_r.push(gr),_r.push(null)},gr=>{ir(_r,gr)}),_r=new Ar({objectMode:!0,writable:!1,read(){}})}throw new rr(Lr,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],Hr)};function Pr(Ur){let{promise:Hr,resolve:Lr}=ur();const Sr=new yr,_r=Sr.signal;return{value:Ur(async function*(){for(;;){const wr=Hr;Hr=null;const{chunk:Dr,done:xr,cb:Ir}=await wr;if(xt.nextTick(Ir),xr)return;if(_r.aborted)throw new zt(void 0,{cause:_r.reason});({promise:Hr,resolve:Lr}=ur()),yield Dr}}(),{signal:_r}),write(wr,Dr,xr){const Ir=Lr;Lr=null,Ir({chunk:wr,done:!1,cb:xr})},final(wr){const Dr=Lr;Lr=null,Dr({done:!0,cb:wr})},destroy(wr,Dr){Sr.abort(),Dr(wr)}}}function kr(Ur){const Hr=Ur.readable&&typeof Ur.readable.read!="function"?dr.wrap(Ur.readable):Ur.readable,Lr=Ur.writable;let Sr=!!At(Hr),_r=!!kt(Lr),gr,wr,Dr,xr,Ir;function $r(vr){const Er=xr;xr=null,Er?Er(vr):vr&&Ir.destroy(vr)}return Ir=new Ar({readableObjectMode:!!(Hr!=null&&Hr.readableObjectMode),writableObjectMode:!!(Lr!=null&&Lr.writableObjectMode),readable:Sr,writable:_r}),_r&&(tr(Lr,vr=>{_r=!1,vr&&ir(Hr,vr),$r(vr)}),Ir._write=function(vr,Er,Tr){Lr.write(vr,Er)?Tr():gr=Tr},Ir._final=function(vr){Lr.end(),wr=vr},Lr.on("drain",function(){if(gr){const vr=gr;gr=null,vr()}}),Lr.on("finish",function(){if(wr){const vr=wr;wr=null,vr()}})),Sr&&(tr(Hr,vr=>{Sr=!1,vr&&ir(Hr,vr),$r(vr)}),Hr.on("readable",function(){if(Dr){const vr=Dr;Dr=null,vr()}}),Hr.on("end",function(){Ir.push(null)}),Ir._read=function(){for(;;){const vr=Hr.read();if(vr===null){Dr=Ir._read;return}if(!Ir.push(vr))return}}),Ir._destroy=function(vr,Er){!vr&&xr!==null&&(vr=new zt),Dr=null,gr=null,wr=null,xr===null?Er(vr):(xr=Er,ir(Lr,vr),ir(Hr,vr))},Ir}return duplexify}var duplex,hasRequiredDuplex;function requireDuplex(){if(hasRequiredDuplex)return duplex;hasRequiredDuplex=1;const{ObjectDefineProperties:xt,ObjectGetOwnPropertyDescriptor:e,ObjectKeys:At,ObjectSetPrototypeOf:kt}=primordials;duplex=jt;const Bt=requireReadable(),Nt=requireWritable();kt(jt.prototype,Bt.prototype),kt(jt,Bt);{const zt=At(Nt.prototype);for(let rr=0;rr<zt.length;rr++){const nr=zt[rr];jt.prototype[nr]||(jt.prototype[nr]=Nt.prototype[nr])}}function jt(zt){if(!(this instanceof jt))return new jt(zt);Bt.call(this,zt),Nt.call(this,zt),zt?(this.allowHalfOpen=zt.allowHalfOpen!==!1,zt.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),zt.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}xt(jt.prototype,{writable:{__proto__:null,...e(Nt.prototype,"writable")},writableHighWaterMark:{__proto__:null,...e(Nt.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...e(Nt.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...e(Nt.prototype,"writableBuffer")},writableLength:{__proto__:null,...e(Nt.prototype,"writableLength")},writableFinished:{__proto__:null,...e(Nt.prototype,"writableFinished")},writableCorked:{__proto__:null,...e(Nt.prototype,"writableCorked")},writableEnded:{__proto__:null,...e(Nt.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...e(Nt.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(zt){this._readableState&&this._writableState&&(this._readableState.destroyed=zt,this._writableState.destroyed=zt)}}});let Lt;function er(){return Lt===void 0&&(Lt={}),Lt}jt.fromWeb=function(zt,rr){return er().newStreamDuplexFromReadableWritablePair(zt,rr)},jt.toWeb=function(zt){return er().newReadableWritablePairFromDuplex(zt)};let tr;return jt.from=function(zt){return tr||(tr=requireDuplexify()),tr(zt,"body")},duplex}const{ObjectSetPrototypeOf:ObjectSetPrototypeOf$1,Symbol:Symbol$2}=primordials;var transform=Transform$1;const{ERR_METHOD_NOT_IMPLEMENTED}=errors.codes,Duplex$2=requireDuplex(),{getHighWaterMark}=state;ObjectSetPrototypeOf$1(Transform$1.prototype,Duplex$2.prototype);ObjectSetPrototypeOf$1(Transform$1,Duplex$2);const kCallback=Symbol$2("kCallback");function Transform$1(xt){if(!(this instanceof Transform$1))return new Transform$1(xt);const e=xt?getHighWaterMark(this,xt,"readableHighWaterMark",!0):null;e===0&&(xt={...xt,highWaterMark:null,readableHighWaterMark:e,writableHighWaterMark:xt.writableHighWaterMark||0}),Duplex$2.call(this,xt),this._readableState.sync=!1,this[kCallback]=null,xt&&(typeof xt.transform=="function"&&(this._transform=xt.transform),typeof xt.flush=="function"&&(this._flush=xt.flush)),this.on("prefinish",prefinish)}function final(xt){typeof this._flush=="function"&&!this.destroyed?this._flush((e,At)=>{if(e){xt?xt(e):this.destroy(e);return}At!=null&&this.push(At),this.push(null),xt&&xt()}):(this.push(null),xt&&xt())}function prefinish(){this._final!==final&&final.call(this)}Transform$1.prototype._final=final;Transform$1.prototype._transform=function(xt,e,At){throw new ERR_METHOD_NOT_IMPLEMENTED("_transform()")};Transform$1.prototype._write=function(xt,e,At){const kt=this._readableState,Bt=this._writableState,Nt=kt.length;this._transform(xt,e,(jt,Lt)=>{if(jt){At(jt);return}Lt!=null&&this.push(Lt),Bt.ended||Nt===kt.length||kt.length<kt.highWaterMark?At():this[kCallback]=At})};Transform$1.prototype._read=function(){if(this[kCallback]){const xt=this[kCallback];this[kCallback]=null,xt()}};const{ObjectSetPrototypeOf}=primordials;var passthrough=PassThrough$1;const Transform=transform;ObjectSetPrototypeOf(PassThrough$1.prototype,Transform.prototype);ObjectSetPrototypeOf(PassThrough$1,Transform);function PassThrough$1(xt){if(!(this instanceof PassThrough$1))return new PassThrough$1(xt);Transform.call(this,xt)}PassThrough$1.prototype._transform=function(xt,e,At){At(null,xt)};const process=browserExports$3,{ArrayIsArray,Promise:Promise$2,SymbolAsyncIterator}=primordials,eos$1=endOfStreamExports,{once}=utilExports,destroyImpl=destroy_1,Duplex$1=requireDuplex(),{aggregateTwoErrors,codes:{ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$2,ERR_INVALID_RETURN_VALUE,ERR_MISSING_ARGS:ERR_MISSING_ARGS$2,ERR_STREAM_DESTROYED,ERR_STREAM_PREMATURE_CLOSE},AbortError:AbortError$5}=errors,{validateFunction,validateAbortSignal:validateAbortSignal$1}=validators,{isIterable:isIterable$1,isReadable:isReadable$1,isReadableNodeStream,isNodeStream:isNodeStream$2,isTransformStream:isTransformStream$1,isWebStream:isWebStream$1,isReadableStream:isReadableStream$1,isReadableEnded}=utils$1,AbortController$1=globalThis.AbortController||requireBrowser().AbortController;let PassThrough,Readable;function destroyer$1(xt,e,At){let kt=!1;xt.on("close",()=>{kt=!0});const Bt=eos$1(xt,{readable:e,writable:At},Nt=>{kt=!Nt});return{destroy:Nt=>{kt||(kt=!0,destroyImpl.destroyer(xt,Nt||new ERR_STREAM_DESTROYED("pipe")))},cleanup:Bt}}function popCallback(xt){return validateFunction(xt[xt.length-1],"streams[stream.length - 1]"),xt.pop()}function makeAsyncIterable(xt){if(isIterable$1(xt))return xt;if(isReadableNodeStream(xt))return fromReadable(xt);throw new ERR_INVALID_ARG_TYPE$2("val",["Readable","Iterable","AsyncIterable"],xt)}async function*fromReadable(xt){Readable||(Readable=requireReadable()),yield*Readable.prototype[SymbolAsyncIterator].call(xt)}async function pumpToNode(xt,e,At,{end:kt}){let Bt,Nt=null;const jt=tr=>{if(tr&&(Bt=tr),Nt){const zt=Nt;Nt=null,zt()}},Lt=()=>new Promise$2((tr,zt)=>{Bt?zt(Bt):Nt=()=>{Bt?zt(Bt):tr()}});e.on("drain",jt);const er=eos$1(e,{readable:!1},jt);try{e.writableNeedDrain&&await Lt();for await(const tr of xt)e.write(tr)||await Lt();kt&&e.end(),await Lt(),At()}catch(tr){At(Bt!==tr?aggregateTwoErrors(Bt,tr):tr)}finally{er(),e.off("drain",jt)}}async function pumpToWeb(xt,e,At,{end:kt}){isTransformStream$1(e)&&(e=e.writable);const Bt=e.getWriter();try{for await(const Nt of xt)await Bt.ready,Bt.write(Nt).catch(()=>{});await Bt.ready,kt&&await Bt.close(),At()}catch(Nt){try{await Bt.abort(Nt),At(Nt)}catch(jt){At(jt)}}}function pipeline$1(...xt){return pipelineImpl(xt,once(popCallback(xt)))}function pipelineImpl(xt,e,At){if(xt.length===1&&ArrayIsArray(xt[0])&&(xt=xt[0]),xt.length<2)throw new ERR_MISSING_ARGS$2("streams");const kt=new AbortController$1,Bt=kt.signal,Nt=At==null?void 0:At.signal,jt=[];validateAbortSignal$1(Nt,"options.signal");function Lt(){ir(new AbortError$5)}Nt==null||Nt.addEventListener("abort",Lt);let er,tr;const zt=[];let rr=0;function nr(fr){ir(fr,--rr===0)}function ir(fr,pr){if(fr&&(!er||er.code==="ERR_STREAM_PREMATURE_CLOSE")&&(er=fr),!(!er&&!pr)){for(;zt.length;)zt.shift()(er);Nt==null||Nt.removeEventListener("abort",Lt),kt.abort(),pr&&(er||jt.forEach(lr=>lr()),process.nextTick(e,er,tr))}}let ar;for(let fr=0;fr<xt.length;fr++){const pr=xt[fr],lr=fr<xt.length-1,yr=fr>0,br=lr||(At==null?void 0:At.end)!==!1,Ar=fr===xt.length-1;if(isNodeStream$2(pr)){let Pr=function(kr){kr&&kr.name!=="AbortError"&&kr.code!=="ERR_STREAM_PREMATURE_CLOSE"&&nr(kr)};if(br){const{destroy:kr,cleanup:Ur}=destroyer$1(pr,lr,yr);zt.push(kr),isReadable$1(pr)&&Ar&&jt.push(Ur)}pr.on("error",Pr),isReadable$1(pr)&&Ar&&jt.push(()=>{pr.removeListener("error",Pr)})}if(fr===0)if(typeof pr=="function"){if(ar=pr({signal:Bt}),!isIterable$1(ar))throw new ERR_INVALID_RETURN_VALUE("Iterable, AsyncIterable or Stream","source",ar)}else isIterable$1(pr)||isReadableNodeStream(pr)||isTransformStream$1(pr)?ar=pr:ar=Duplex$1.from(pr);else if(typeof pr=="function"){if(isTransformStream$1(ar)){var dr;ar=makeAsyncIterable((dr=ar)===null||dr===void 0?void 0:dr.readable)}else ar=makeAsyncIterable(ar);if(ar=pr(ar,{signal:Bt}),lr){if(!isIterable$1(ar,!0))throw new ERR_INVALID_RETURN_VALUE("AsyncIterable",`transform[${fr-1}]`,ar)}else{var ur;PassThrough||(PassThrough=passthrough);const Pr=new PassThrough({objectMode:!0}),kr=(ur=ar)===null||ur===void 0?void 0:ur.then;if(typeof kr=="function")rr++,kr.call(ar,Lr=>{tr=Lr,Lr!=null&&Pr.write(Lr),br&&Pr.end(),process.nextTick(nr)},Lr=>{Pr.destroy(Lr),process.nextTick(nr,Lr)});else if(isIterable$1(ar,!0))rr++,pumpToNode(ar,Pr,nr,{end:br});else if(isReadableStream$1(ar)||isTransformStream$1(ar)){const Lr=ar.readable||ar;rr++,pumpToNode(Lr,Pr,nr,{end:br})}else throw new ERR_INVALID_RETURN_VALUE("AsyncIterable or Promise","destination",ar);ar=Pr;const{destroy:Ur,cleanup:Hr}=destroyer$1(ar,!1,!0);zt.push(Ur),Ar&&jt.push(Hr)}}else if(isNodeStream$2(pr)){if(isReadableNodeStream(ar)){rr+=2;const Pr=pipe$1(ar,pr,nr,{end:br});isReadable$1(pr)&&Ar&&jt.push(Pr)}else if(isTransformStream$1(ar)||isReadableStream$1(ar)){const Pr=ar.readable||ar;rr++,pumpToNode(Pr,pr,nr,{end:br})}else if(isIterable$1(ar))rr++,pumpToNode(ar,pr,nr,{end:br});else throw new ERR_INVALID_ARG_TYPE$2("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],ar);ar=pr}else if(isWebStream$1(pr)){if(isReadableNodeStream(ar))rr++,pumpToWeb(makeAsyncIterable(ar),pr,nr,{end:br});else if(isReadableStream$1(ar)||isIterable$1(ar))rr++,pumpToWeb(ar,pr,nr,{end:br});else if(isTransformStream$1(ar))rr++,pumpToWeb(ar.readable,pr,nr,{end:br});else throw new ERR_INVALID_ARG_TYPE$2("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],ar);ar=pr}else ar=Duplex$1.from(pr)}return(Bt!=null&&Bt.aborted||Nt!=null&&Nt.aborted)&&process.nextTick(Lt),ar}function pipe$1(xt,e,At,{end:kt}){let Bt=!1;if(e.on("close",()=>{Bt||At(new ERR_STREAM_PREMATURE_CLOSE)}),xt.pipe(e,{end:!1}),kt){let Nt=function(){Bt=!0,e.end()};isReadableEnded(xt)?process.nextTick(Nt):xt.once("end",Nt)}else At();return eos$1(xt,{readable:!0,writable:!1},Nt=>{const jt=xt._readableState;Nt&&Nt.code==="ERR_STREAM_PREMATURE_CLOSE"&&jt&&jt.ended&&!jt.errored&&!jt.errorEmitted?xt.once("end",At).once("error",At):At(Nt)}),eos$1(e,{readable:!1,writable:!0},At)}var pipeline_1={pipelineImpl,pipeline:pipeline$1};const{pipeline}=pipeline_1,Duplex=requireDuplex(),{destroyer}=destroy_1,{isNodeStream:isNodeStream$1,isReadable,isWritable:isWritable$1,isWebStream,isTransformStream,isWritableStream,isReadableStream}=utils$1,{AbortError:AbortError$4,codes:{ERR_INVALID_ARG_VALUE:ERR_INVALID_ARG_VALUE$1,ERR_MISSING_ARGS:ERR_MISSING_ARGS$1}}=errors,eos=endOfStreamExports;var compose$1=function xt(...e){if(e.length===0)throw new ERR_MISSING_ARGS$1("streams");if(e.length===1)return Duplex.from(e[0]);const At=[...e];if(typeof e[0]=="function"&&(e[0]=Duplex.from(e[0])),typeof e[e.length-1]=="function"){const ir=e.length-1;e[ir]=Duplex.from(e[ir])}for(let ir=0;ir<e.length;++ir)if(!(!isNodeStream$1(e[ir])&&!isWebStream(e[ir]))){if(ir<e.length-1&&!(isReadable(e[ir])||isReadableStream(e[ir])||isTransformStream(e[ir])))throw new ERR_INVALID_ARG_VALUE$1(`streams[${ir}]`,At[ir],"must be readable");if(ir>0&&!(isWritable$1(e[ir])||isWritableStream(e[ir])||isTransformStream(e[ir])))throw new ERR_INVALID_ARG_VALUE$1(`streams[${ir}]`,At[ir],"must be writable")}let kt,Bt,Nt,jt,Lt;function er(ir){const ar=jt;jt=null,ar?ar(ir):ir?Lt.destroy(ir):!nr&&!rr&&Lt.destroy()}const tr=e[0],zt=pipeline(e,er),rr=!!(isWritable$1(tr)||isWritableStream(tr)||isTransformStream(tr)),nr=!!(isReadable(zt)||isReadableStream(zt)||isTransformStream(zt));if(Lt=new Duplex({writableObjectMode:!!(tr!=null&&tr.writableObjectMode),readableObjectMode:!!(zt!=null&&zt.writableObjectMode),writable:rr,readable:nr}),rr){if(isNodeStream$1(tr))Lt._write=function(ar,dr,ur){tr.write(ar,dr)?ur():kt=ur},Lt._final=function(ar){tr.end(),Bt=ar},tr.on("drain",function(){if(kt){const ar=kt;kt=null,ar()}});else if(isWebStream(tr)){const dr=(isTransformStream(tr)?tr.writable:tr).getWriter();Lt._write=async function(ur,fr,pr){try{await dr.ready,dr.write(ur).catch(()=>{}),pr()}catch(lr){pr(lr)}},Lt._final=async function(ur){try{await dr.ready,dr.close().catch(()=>{}),Bt=ur}catch(fr){ur(fr)}}}const ir=isTransformStream(zt)?zt.readable:zt;eos(ir,()=>{if(Bt){const ar=Bt;Bt=null,ar()}})}if(nr){if(isNodeStream$1(zt))zt.on("readable",function(){if(Nt){const ir=Nt;Nt=null,ir()}}),zt.on("end",function(){Lt.push(null)}),Lt._read=function(){for(;;){const ir=zt.read();if(ir===null){Nt=Lt._read;return}if(!Lt.push(ir))return}};else if(isWebStream(zt)){const ar=(isTransformStream(zt)?zt.readable:zt).getReader();Lt._read=async function(){for(;;)try{const{value:dr,done:ur}=await ar.read();if(!Lt.push(dr))return;if(ur){Lt.push(null);return}}catch{return}}}}return Lt._destroy=function(ir,ar){!ir&&jt!==null&&(ir=new AbortError$4),Nt=null,kt=null,Bt=null,jt===null?ar(ir):(jt=ar,isNodeStream$1(zt)&&destroyer(zt,ir))},Lt};const AbortController=globalThis.AbortController||requireBrowser().AbortController,{codes:{ERR_INVALID_ARG_VALUE,ERR_INVALID_ARG_TYPE:ERR_INVALID_ARG_TYPE$1,ERR_MISSING_ARGS,ERR_OUT_OF_RANGE},AbortError:AbortError$3}=errors,{validateAbortSignal,validateInteger,validateObject:validateObject$1}=validators,kWeakHandler=primordials.Symbol("kWeak"),{finished}=endOfStreamExports,staticCompose=compose$1,{addAbortSignalNoValidate}=addAbortSignalExports,{isWritable,isNodeStream}=utils$1,{ArrayPrototypePush,MathFloor,Number:Number$1,NumberIsNaN,Promise:Promise$1,PromiseReject,PromisePrototypeThen,Symbol:Symbol$1}=primordials,kEmpty=Symbol$1("kEmpty"),kEof=Symbol$1("kEof");function compose(xt,e){if(e!=null&&validateObject$1(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal"),isNodeStream(xt)&&!isWritable(xt))throw new ERR_INVALID_ARG_VALUE("stream",xt,"must be writable");const At=staticCompose(this,xt);return e!=null&&e.signal&&addAbortSignalNoValidate(e.signal,At),At}function map$1(xt,e){if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$1("fn",["Function","AsyncFunction"],xt);e!=null&&validateObject$1(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal");let At=1;return(e==null?void 0:e.concurrency)!=null&&(At=MathFloor(e.concurrency)),validateInteger(At,"concurrency",1),(async function*(){var Bt,Nt;const jt=new AbortController,Lt=this,er=[],tr=jt.signal,zt={signal:tr},rr=()=>jt.abort();e!=null&&(Bt=e.signal)!==null&&Bt!==void 0&&Bt.aborted&&rr(),e==null||(Nt=e.signal)===null||Nt===void 0||Nt.addEventListener("abort",rr);let nr,ir,ar=!1;function dr(){ar=!0}async function ur(){try{for await(let lr of Lt){var fr;if(ar)return;if(tr.aborted)throw new AbortError$3;try{lr=xt(lr,zt)}catch(yr){lr=PromiseReject(yr)}lr!==kEmpty&&(typeof((fr=lr)===null||fr===void 0?void 0:fr.catch)=="function"&&lr.catch(dr),er.push(lr),nr&&(nr(),nr=null),!ar&&er.length&&er.length>=At&&await new Promise$1(yr=>{ir=yr}))}er.push(kEof)}catch(lr){const yr=PromiseReject(lr);PromisePrototypeThen(yr,void 0,dr),er.push(yr)}finally{var pr;ar=!0,nr&&(nr(),nr=null),e==null||(pr=e.signal)===null||pr===void 0||pr.removeEventListener("abort",rr)}}ur();try{for(;;){for(;er.length>0;){const fr=await er[0];if(fr===kEof)return;if(tr.aborted)throw new AbortError$3;fr!==kEmpty&&(yield fr),er.shift(),ir&&(ir(),ir=null)}await new Promise$1(fr=>{nr=fr})}}finally{jt.abort(),ar=!0,ir&&(ir(),ir=null)}}).call(this)}function asIndexedPairs(xt=void 0){return xt!=null&&validateObject$1(xt,"options"),(xt==null?void 0:xt.signal)!=null&&validateAbortSignal(xt.signal,"options.signal"),(async function*(){let At=0;for await(const Bt of this){var kt;if(xt!=null&&(kt=xt.signal)!==null&&kt!==void 0&&kt.aborted)throw new AbortError$3({cause:xt.signal.reason});yield[At++,Bt]}}).call(this)}async function some(xt,e=void 0){for await(const At of filter$1.call(this,xt,e))return!0;return!1}async function every(xt,e=void 0){if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$1("fn",["Function","AsyncFunction"],xt);return!await some.call(this,async(...At)=>!await xt(...At),e)}async function find(xt,e){for await(const At of filter$1.call(this,xt,e))return At}async function forEach(xt,e){if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$1("fn",["Function","AsyncFunction"],xt);async function At(kt,Bt){return await xt(kt,Bt),kEmpty}for await(const kt of map$1.call(this,At,e));}function filter$1(xt,e){if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$1("fn",["Function","AsyncFunction"],xt);async function At(kt,Bt){return await xt(kt,Bt)?kt:kEmpty}return map$1.call(this,At,e)}class ReduceAwareErrMissingArgs extends ERR_MISSING_ARGS{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}}async function reduce(xt,e,At){var kt;if(typeof xt!="function")throw new ERR_INVALID_ARG_TYPE$1("reducer",["Function","AsyncFunction"],xt);At!=null&&validateObject$1(At,"options"),(At==null?void 0:At.signal)!=null&&validateAbortSignal(At.signal,"options.signal");let Bt=arguments.length>1;if(At!=null&&(kt=At.signal)!==null&&kt!==void 0&&kt.aborted){const tr=new AbortError$3(void 0,{cause:At.signal.reason});throw this.once("error",()=>{}),await finished(this.destroy(tr)),tr}const Nt=new AbortController,jt=Nt.signal;if(At!=null&&At.signal){const tr={once:!0,[kWeakHandler]:this};At.signal.addEventListener("abort",()=>Nt.abort(),tr)}let Lt=!1;try{for await(const tr of this){var er;if(Lt=!0,At!=null&&(er=At.signal)!==null&&er!==void 0&&er.aborted)throw new AbortError$3;Bt?e=await xt(e,tr,{signal:jt}):(e=tr,Bt=!0)}if(!Lt&&!Bt)throw new ReduceAwareErrMissingArgs}finally{Nt.abort()}return e}async function toArray(xt){xt!=null&&validateObject$1(xt,"options"),(xt==null?void 0:xt.signal)!=null&&validateAbortSignal(xt.signal,"options.signal");const e=[];for await(const kt of this){var At;if(xt!=null&&(At=xt.signal)!==null&&At!==void 0&&At.aborted)throw new AbortError$3(void 0,{cause:xt.signal.reason});ArrayPrototypePush(e,kt)}return e}function flatMap(xt,e){const At=map$1.call(this,xt,e);return(async function*(){for await(const Bt of At)yield*Bt}).call(this)}function toIntegerOrInfinity(xt){if(xt=Number$1(xt),NumberIsNaN(xt))return 0;if(xt<0)throw new ERR_OUT_OF_RANGE("number",">= 0",xt);return xt}function drop(xt,e=void 0){return e!=null&&validateObject$1(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal"),xt=toIntegerOrInfinity(xt),(async function*(){var kt;if(e!=null&&(kt=e.signal)!==null&&kt!==void 0&&kt.aborted)throw new AbortError$3;for await(const Nt of this){var Bt;if(e!=null&&(Bt=e.signal)!==null&&Bt!==void 0&&Bt.aborted)throw new AbortError$3;xt--<=0&&(yield Nt)}}).call(this)}function take(xt,e=void 0){return e!=null&&validateObject$1(e,"options"),(e==null?void 0:e.signal)!=null&&validateAbortSignal(e.signal,"options.signal"),xt=toIntegerOrInfinity(xt),(async function*(){var kt;if(e!=null&&(kt=e.signal)!==null&&kt!==void 0&&kt.aborted)throw new AbortError$3;for await(const Nt of this){var Bt;if(e!=null&&(Bt=e.signal)!==null&&Bt!==void 0&&Bt.aborted)throw new AbortError$3;if(xt-- >0)yield Nt;else return}}).call(this)}operators.streamReturningOperators={asIndexedPairs,drop,filter:filter$1,flatMap,map:map$1,take,compose};operators.promiseReturningOperators={every,forEach,reduce,toArray,some,find};var promises,hasRequiredPromises;function requirePromises(){if(hasRequiredPromises)return promises;hasRequiredPromises=1;const{ArrayPrototypePop:xt,Promise:e}=primordials,{isIterable:At,isNodeStream:kt,isWebStream:Bt}=utils$1,{pipelineImpl:Nt}=pipeline_1,{finished:jt}=endOfStreamExports;requireStream();function Lt(...er){return new e((tr,zt)=>{let rr,nr;const ir=er[er.length-1];if(ir&&typeof ir=="object"&&!kt(ir)&&!At(ir)&&!Bt(ir)){const ar=xt(er);rr=ar.signal,nr=ar.end}Nt(er,(ar,dr)=>{ar?zt(ar):tr(dr)},{signal:rr,end:nr})})}return promises={finished:jt,pipeline:Lt},promises}var hasRequiredStream;function requireStream(){if(hasRequiredStream)return stream.exports;hasRequiredStream=1;const{Buffer:xt}=buffer$2,{ObjectDefineProperty:e,ObjectKeys:At,ReflectApply:kt}=primordials,{promisify:{custom:Bt}}=utilExports,{streamReturningOperators:Nt,promiseReturningOperators:jt}=operators,{codes:{ERR_ILLEGAL_CONSTRUCTOR:Lt}}=errors,er=compose$1,{pipeline:tr}=pipeline_1,{destroyer:zt}=destroy_1,rr=endOfStreamExports,nr=requirePromises(),ir=utils$1,ar=stream.exports=legacy.Stream;ar.isDisturbed=ir.isDisturbed,ar.isErrored=ir.isErrored,ar.isReadable=ir.isReadable,ar.Readable=requireReadable();for(const fr of At(Nt)){let lr=function(...yr){if(new.target)throw Lt();return ar.Readable.from(kt(pr,this,yr))};var ur=lr;const pr=Nt[fr];e(lr,"name",{__proto__:null,value:pr.name}),e(lr,"length",{__proto__:null,value:pr.length}),e(ar.Readable.prototype,fr,{__proto__:null,value:lr,enumerable:!1,configurable:!0,writable:!0})}for(const fr of At(jt)){let lr=function(...br){if(new.target)throw Lt();return kt(pr,this,br)};var ur=lr;const pr=jt[fr];e(lr,"name",{__proto__:null,value:pr.name}),e(lr,"length",{__proto__:null,value:pr.length}),e(ar.Readable.prototype,fr,{__proto__:null,value:lr,enumerable:!1,configurable:!0,writable:!0})}ar.Writable=requireWritable(),ar.Duplex=requireDuplex(),ar.Transform=transform,ar.PassThrough=passthrough,ar.pipeline=tr;const{addAbortSignal:dr}=addAbortSignalExports;return ar.addAbortSignal=dr,ar.finished=rr,ar.destroy=zt,ar.compose=er,e(ar,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return nr}}),e(tr,Bt,{__proto__:null,enumerable:!0,get(){return nr.pipeline}}),e(rr,Bt,{__proto__:null,enumerable:!0,get(){return nr.finished}}),ar.Stream=ar,ar._isUint8Array=function(pr){return pr instanceof Uint8Array},ar._uint8ArrayToBuffer=function(pr){return xt.from(pr.buffer,pr.byteOffset,pr.byteLength)},stream.exports}(function(xt){const e=requireStream(),At=requirePromises(),kt=e.Readable.destroy;xt.exports=e.Readable,xt.exports._uint8ArrayToBuffer=e._uint8ArrayToBuffer,xt.exports._isUint8Array=e._isUint8Array,xt.exports.isDisturbed=e.isDisturbed,xt.exports.isErrored=e.isErrored,xt.exports.isReadable=e.isReadable,xt.exports.Readable=e.Readable,xt.exports.Writable=e.Writable,xt.exports.Duplex=e.Duplex,xt.exports.Transform=e.Transform,xt.exports.PassThrough=e.PassThrough,xt.exports.addAbortSignal=e.addAbortSignal,xt.exports.finished=e.finished,xt.exports.destroy=e.destroy,xt.exports.destroy=kt,xt.exports.pipeline=e.pipeline,xt.exports.compose=e.compose,Object.defineProperty(e,"promises",{configurable:!0,enumerable:!0,get(){return At}}),xt.exports.Stream=e.Stream,xt.exports.default=xt.exports})(browser);var browserExports=browser.exports,__awaiter$2z=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let Sha256$2=class{static digest(e){return __awaiter$2z(this,arguments,void 0,function*({data:At}){return sha256$5(At)})}},CryptoAlgorithm$2=class{};var __awaiter$2y=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let Sha2Algorithm$2=class extends CryptoAlgorithm$2{digest(e){return __awaiter$2y(this,arguments,void 0,function*({algorithm:At,data:kt}){switch(At){case"SHA-256":return yield Sha256$2.digest({data:kt})}})}};function number(xt){if(!Number.isSafeInteger(xt)||xt<0)throw new Error(`Wrong positive integer: ${xt}`)}function isBytes$5(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}function bytes$1(xt,...e){if(!isBytes$5(xt))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(xt.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${xt.length}`)}function hash(xt){if(typeof xt!="function"||typeof xt.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number(xt.outputLen),number(xt.blockLen)}function exists$1(xt,e=!0){if(xt.destroyed)throw new Error("Hash instance has been destroyed");if(e&&xt.finished)throw new Error("Hash#digest() has already been called")}function output$1(xt,e){bytes$1(xt);const At=e.outputLen;if(xt.length<At)throw new Error(`digestInto() expects output buffer of length at least ${At}`)}const crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$4(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}const createView=xt=>new DataView(xt.buffer,xt.byteOffset,xt.byteLength),rotr=(xt,e)=>xt<<32-e|xt>>>e,isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");const hexes$1=Array.from({length:256},(xt,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$1(xt){if(!isBytes$4(xt))throw new Error("Uint8Array expected");let e="";for(let At=0;At<xt.length;At++)e+=hexes$1[xt[At]];return e}const asciis$1={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16$1(xt){if(xt>=asciis$1._0&&xt<=asciis$1._9)return xt-asciis$1._0;if(xt>=asciis$1._A&&xt<=asciis$1._F)return xt-(asciis$1._A-10);if(xt>=asciis$1._a&&xt<=asciis$1._f)return xt-(asciis$1._a-10)}function hexToBytes$1(xt){if(typeof xt!="string")throw new Error("hex string expected, got "+typeof xt);const e=xt.length,At=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const kt=new Uint8Array(At);for(let Bt=0,Nt=0;Bt<At;Bt++,Nt+=2){const jt=asciiToBase16$1(xt.charCodeAt(Nt)),Lt=asciiToBase16$1(xt.charCodeAt(Nt+1));if(jt===void 0||Lt===void 0){const er=xt[Nt]+xt[Nt+1];throw new Error('hex string expected, got non-hex character "'+er+'" at index '+Nt)}kt[Bt]=jt*16+Lt}return kt}const nextTick=async()=>{};async function asyncLoop(xt,e,At){let kt=Date.now();for(let Bt=0;Bt<xt;Bt++){At(Bt);const Nt=Date.now()-kt;Nt>=0&&Nt<e||(await nextTick(),kt+=Nt)}}function utf8ToBytes$2(xt){if(typeof xt!="string")throw new Error(`utf8ToBytes expected string, got ${typeof xt}`);return new Uint8Array(new TextEncoder().encode(xt))}function toBytes$1(xt){if(typeof xt=="string"&&(xt=utf8ToBytes$2(xt)),!isBytes$4(xt))throw new Error(`expected Uint8Array, got ${typeof xt}`);return xt}function concatBytes$1(...xt){let e=0;for(let kt=0;kt<xt.length;kt++){const Bt=xt[kt];if(!isBytes$4(Bt))throw new Error("Uint8Array expected");e+=Bt.length}const At=new Uint8Array(e);for(let kt=0,Bt=0;kt<xt.length;kt++){const Nt=xt[kt];At.set(Nt,Bt),Bt+=Nt.length}return At}class Hash{clone(){return this._cloneInto()}}const toStr={}.toString;function checkOpts(xt,e){if(e!==void 0&&toStr.call(e)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(xt,e)}function wrapConstructor(xt){const e=kt=>xt().update(toBytes$1(kt)).digest(),At=xt();return e.outputLen=At.outputLen,e.blockLen=At.blockLen,e.create=()=>xt(),e}function randomBytes$2(xt=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array(xt));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64(xt,e,At,kt){if(typeof xt.setBigUint64=="function")return xt.setBigUint64(e,At,kt);const Bt=BigInt(32),Nt=BigInt(4294967295),jt=Number(At>>Bt&Nt),Lt=Number(At&Nt),er=kt?4:0,tr=kt?0:4;xt.setUint32(e+er,jt,kt),xt.setUint32(e+tr,Lt,kt)}class SHA2 extends Hash{constructor(e,At,kt,Bt){super(),this.blockLen=e,this.outputLen=At,this.padOffset=kt,this.isLE=Bt,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView(this.buffer)}update(e){exists$1(this);const{view:At,buffer:kt,blockLen:Bt}=this;e=toBytes$1(e);const Nt=e.length;for(let jt=0;jt<Nt;){const Lt=Math.min(Bt-this.pos,Nt-jt);if(Lt===Bt){const er=createView(e);for(;Bt<=Nt-jt;jt+=Bt)this.process(er,jt);continue}kt.set(e.subarray(jt,jt+Lt),this.pos),this.pos+=Lt,jt+=Lt,this.pos===Bt&&(this.process(At,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists$1(this),output$1(e,this),this.finished=!0;const{buffer:At,view:kt,blockLen:Bt,isLE:Nt}=this;let{pos:jt}=this;At[jt++]=128,this.buffer.subarray(jt).fill(0),this.padOffset>Bt-jt&&(this.process(kt,0),jt=0);for(let rr=jt;rr<Bt;rr++)At[rr]=0;setBigUint64(kt,Bt-8,BigInt(this.length*8),Nt),this.process(kt,0);const Lt=createView(e),er=this.outputLen;if(er%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const tr=er/4,zt=this.get();if(tr>zt.length)throw new Error("_sha2: outputLen bigger than state");for(let rr=0;rr<tr;rr++)Lt.setUint32(4*rr,zt[rr],Nt)}digest(){const{buffer:e,outputLen:At}=this;this.digestInto(e);const kt=e.slice(0,At);return this.destroy(),kt}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:At,buffer:kt,length:Bt,finished:Nt,destroyed:jt,pos:Lt}=this;return e.length=Bt,e.pos=Lt,e.finished=Nt,e.destroyed=jt,Bt%At&&e.buffer.set(kt),e}}const Chi=(xt,e,At)=>xt&e^~xt&At,Maj=(xt,e,At)=>xt&e^xt&At^e&At,SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:e,B:At,C:kt,D:Bt,E:Nt,F:jt,G:Lt,H:er}=this;return[e,At,kt,Bt,Nt,jt,Lt,er]}set(e,At,kt,Bt,Nt,jt,Lt,er){this.A=e|0,this.B=At|0,this.C=kt|0,this.D=Bt|0,this.E=Nt|0,this.F=jt|0,this.G=Lt|0,this.H=er|0}process(e,At){for(let rr=0;rr<16;rr++,At+=4)SHA256_W[rr]=e.getUint32(At,!1);for(let rr=16;rr<64;rr++){const nr=SHA256_W[rr-15],ir=SHA256_W[rr-2],ar=rotr(nr,7)^rotr(nr,18)^nr>>>3,dr=rotr(ir,17)^rotr(ir,19)^ir>>>10;SHA256_W[rr]=dr+SHA256_W[rr-7]+ar+SHA256_W[rr-16]|0}let{A:kt,B:Bt,C:Nt,D:jt,E:Lt,F:er,G:tr,H:zt}=this;for(let rr=0;rr<64;rr++){const nr=rotr(Lt,6)^rotr(Lt,11)^rotr(Lt,25),ir=zt+nr+Chi(Lt,er,tr)+SHA256_K[rr]+SHA256_W[rr]|0,dr=(rotr(kt,2)^rotr(kt,13)^rotr(kt,22))+Maj(kt,Bt,Nt)|0;zt=tr,tr=er,er=Lt,Lt=jt+ir|0,jt=Nt,Nt=Bt,Bt=kt,kt=ir+dr|0}kt=kt+this.A|0,Bt=Bt+this.B|0,Nt=Nt+this.C|0,jt=jt+this.D|0,Lt=Lt+this.E|0,er=er+this.F|0,tr=tr+this.G|0,zt=zt+this.H|0,this.set(kt,Bt,Nt,jt,Lt,er,tr,zt)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const sha256=wrapConstructor(()=>new SHA256);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$5=BigInt(0),_1n$7=BigInt(1),_2n$4=BigInt(2);function isBytes$3(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}const hexes=Array.from({length:256},(xt,e)=>e.toString(16).padStart(2,"0"));function bytesToHex(xt){if(!isBytes$3(xt))throw new Error("Uint8Array expected");let e="";for(let At=0;At<xt.length;At++)e+=hexes[xt[At]];return e}function numberToHexUnpadded(xt){const e=xt.toString(16);return e.length&1?`0${e}`:e}function hexToNumber(xt){if(typeof xt!="string")throw new Error("hex string expected, got "+typeof xt);return BigInt(xt===""?"0":`0x${xt}`)}const asciis={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16(xt){if(xt>=asciis._0&&xt<=asciis._9)return xt-asciis._0;if(xt>=asciis._A&&xt<=asciis._F)return xt-(asciis._A-10);if(xt>=asciis._a&&xt<=asciis._f)return xt-(asciis._a-10)}function hexToBytes(xt){if(typeof xt!="string")throw new Error("hex string expected, got "+typeof xt);const e=xt.length,At=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const kt=new Uint8Array(At);for(let Bt=0,Nt=0;Bt<At;Bt++,Nt+=2){const jt=asciiToBase16(xt.charCodeAt(Nt)),Lt=asciiToBase16(xt.charCodeAt(Nt+1));if(jt===void 0||Lt===void 0){const er=xt[Nt]+xt[Nt+1];throw new Error('hex string expected, got non-hex character "'+er+'" at index '+Nt)}kt[Bt]=jt*16+Lt}return kt}function bytesToNumberBE(xt){return hexToNumber(bytesToHex(xt))}function bytesToNumberLE(xt){if(!isBytes$3(xt))throw new Error("Uint8Array expected");return hexToNumber(bytesToHex(Uint8Array.from(xt).reverse()))}function numberToBytesBE(xt,e){return hexToBytes(xt.toString(16).padStart(e*2,"0"))}function numberToBytesLE(xt,e){return numberToBytesBE(xt,e).reverse()}function numberToVarBytesBE(xt){return hexToBytes(numberToHexUnpadded(xt))}function ensureBytes$2(xt,e,At){let kt;if(typeof e=="string")try{kt=hexToBytes(e)}catch(Nt){throw new Error(`${xt} must be valid hex string, got "${e}". Cause: ${Nt}`)}else if(isBytes$3(e))kt=Uint8Array.from(e);else throw new Error(`${xt} must be hex string or Uint8Array`);const Bt=kt.length;if(typeof At=="number"&&Bt!==At)throw new Error(`${xt} expected ${At} bytes, got ${Bt}`);return kt}function concatBytes(...xt){let e=0;for(let Bt=0;Bt<xt.length;Bt++){const Nt=xt[Bt];if(!isBytes$3(Nt))throw new Error("Uint8Array expected");e+=Nt.length}let At=new Uint8Array(e),kt=0;for(let Bt=0;Bt<xt.length;Bt++){const Nt=xt[Bt];At.set(Nt,kt),kt+=Nt.length}return At}function equalBytes(xt,e){if(xt.length!==e.length)return!1;let At=0;for(let kt=0;kt<xt.length;kt++)At|=xt[kt]^e[kt];return At===0}function utf8ToBytes$1(xt){if(typeof xt!="string")throw new Error(`utf8ToBytes expected string, got ${typeof xt}`);return new Uint8Array(new TextEncoder().encode(xt))}function bitLen(xt){let e;for(e=0;xt>_0n$5;xt>>=_1n$7,e+=1);return e}function bitGet(xt,e){return xt>>BigInt(e)&_1n$7}const bitSet=(xt,e,At)=>xt|(At?_1n$7:_0n$5)<<BigInt(e),bitMask=xt=>(_2n$4<<BigInt(xt-1))-_1n$7,u8n=xt=>new Uint8Array(xt),u8fr=xt=>Uint8Array.from(xt);function createHmacDrbg(xt,e,At){if(typeof xt!="number"||xt<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof At!="function")throw new Error("hmacFn must be a function");let kt=u8n(xt),Bt=u8n(xt),Nt=0;const jt=()=>{kt.fill(1),Bt.fill(0),Nt=0},Lt=(...rr)=>At(Bt,kt,...rr),er=(rr=u8n())=>{Bt=Lt(u8fr([0]),rr),kt=Lt(),rr.length!==0&&(Bt=Lt(u8fr([1]),rr),kt=Lt())},tr=()=>{if(Nt++>=1e3)throw new Error("drbg: tried 1000 values");let rr=0;const nr=[];for(;rr<e;){kt=Lt();const ir=kt.slice();nr.push(ir),rr+=kt.length}return concatBytes(...nr)};return(rr,nr)=>{jt(),er(rr);let ir;for(;!(ir=nr(tr()));)er();return jt(),ir}}const validatorFns={bigint:xt=>typeof xt=="bigint",function:xt=>typeof xt=="function",boolean:xt=>typeof xt=="boolean",string:xt=>typeof xt=="string",stringOrUint8Array:xt=>typeof xt=="string"||isBytes$3(xt),isSafeInteger:xt=>Number.isSafeInteger(xt),array:xt=>Array.isArray(xt),field:(xt,e)=>e.Fp.isValid(xt),hash:xt=>typeof xt=="function"&&Number.isSafeInteger(xt.outputLen)};function validateObject(xt,e,At={}){const kt=(Bt,Nt,jt)=>{const Lt=validatorFns[Nt];if(typeof Lt!="function")throw new Error(`Invalid validator "${Nt}", expected function`);const er=xt[Bt];if(!(jt&&er===void 0)&&!Lt(er,xt))throw new Error(`Invalid param ${String(Bt)}=${er} (${typeof er}), expected ${Nt}`)};for(const[Bt,Nt]of Object.entries(e))kt(Bt,Nt,!1);for(const[Bt,Nt]of Object.entries(At))kt(Bt,Nt,!0);return xt}const ut=Object.freeze(Object.defineProperty({__proto__:null,bitGet,bitLen,bitMask,bitSet,bytesToHex,bytesToNumberBE,bytesToNumberLE,concatBytes,createHmacDrbg,ensureBytes:ensureBytes$2,equalBytes,hexToBytes,hexToNumber,isBytes:isBytes$3,numberToBytesBE,numberToBytesLE,numberToHexUnpadded,numberToVarBytesBE,utf8ToBytes:utf8ToBytes$1,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$6=BigInt(1),_2n$3=BigInt(2),_3n$1=BigInt(3),_4n=BigInt(4),_5n$1=BigInt(5),_8n$1=BigInt(8);BigInt(9);BigInt(16);function mod(xt,e){const At=xt%e;return At>=_0n$4?At:e+At}function pow(xt,e,At){if(At<=_0n$4||e<_0n$4)throw new Error("Expected power/modulo > 0");if(At===_1n$6)return _0n$4;let kt=_1n$6;for(;e>_0n$4;)e&_1n$6&&(kt=kt*xt%At),xt=xt*xt%At,e>>=_1n$6;return kt}function pow2(xt,e,At){let kt=xt;for(;e-- >_0n$4;)kt*=kt,kt%=At;return kt}function invert(xt,e){if(xt===_0n$4||e<=_0n$4)throw new Error(`invert: expected positive integers, got n=${xt} mod=${e}`);let At=mod(xt,e),kt=e,Bt=_0n$4,Nt=_1n$6;for(;At!==_0n$4;){const Lt=kt/At,er=kt%At,tr=Bt-Nt*Lt;kt=At,At=er,Bt=Nt,Nt=tr}if(kt!==_1n$6)throw new Error("invert: does not exist");return mod(Bt,e)}function tonelliShanks(xt){const e=(xt-_1n$6)/_2n$3;let At,kt,Bt;for(At=xt-_1n$6,kt=0;At%_2n$3===_0n$4;At/=_2n$3,kt++);for(Bt=_2n$3;Bt<xt&&pow(Bt,e,xt)!==xt-_1n$6;Bt++);if(kt===1){const jt=(xt+_1n$6)/_4n;return function(er,tr){const zt=er.pow(tr,jt);if(!er.eql(er.sqr(zt),tr))throw new Error("Cannot find square root");return zt}}const Nt=(At+_1n$6)/_2n$3;return function(Lt,er){if(Lt.pow(er,e)===Lt.neg(Lt.ONE))throw new Error("Cannot find square root");let tr=kt,zt=Lt.pow(Lt.mul(Lt.ONE,Bt),At),rr=Lt.pow(er,Nt),nr=Lt.pow(er,At);for(;!Lt.eql(nr,Lt.ONE);){if(Lt.eql(nr,Lt.ZERO))return Lt.ZERO;let ir=1;for(let dr=Lt.sqr(nr);ir<tr&&!Lt.eql(dr,Lt.ONE);ir++)dr=Lt.sqr(dr);const ar=Lt.pow(zt,_1n$6<<BigInt(tr-ir-1));zt=Lt.sqr(ar),rr=Lt.mul(rr,ar),nr=Lt.mul(nr,zt),tr=ir}return rr}}function FpSqrt(xt){if(xt%_4n===_3n$1){const e=(xt+_1n$6)/_4n;return function(kt,Bt){const Nt=kt.pow(Bt,e);if(!kt.eql(kt.sqr(Nt),Bt))throw new Error("Cannot find square root");return Nt}}if(xt%_8n$1===_5n$1){const e=(xt-_5n$1)/_8n$1;return function(kt,Bt){const Nt=kt.mul(Bt,_2n$3),jt=kt.pow(Nt,e),Lt=kt.mul(Bt,jt),er=kt.mul(kt.mul(Lt,_2n$3),jt),tr=kt.mul(Lt,kt.sub(er,kt.ONE));if(!kt.eql(kt.sqr(tr),Bt))throw new Error("Cannot find square root");return tr}}return tonelliShanks(xt)}const isNegativeLE=(xt,e)=>(mod(xt,e)&_1n$6)===_1n$6,FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(xt){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},At=FIELD_FIELDS.reduce((kt,Bt)=>(kt[Bt]="function",kt),e);return validateObject(xt,At)}function FpPow(xt,e,At){if(At<_0n$4)throw new Error("Expected power > 0");if(At===_0n$4)return xt.ONE;if(At===_1n$6)return e;let kt=xt.ONE,Bt=e;for(;At>_0n$4;)At&_1n$6&&(kt=xt.mul(kt,Bt)),Bt=xt.sqr(Bt),At>>=_1n$6;return kt}function FpInvertBatch(xt,e){const At=new Array(e.length),kt=e.reduce((Nt,jt,Lt)=>xt.is0(jt)?Nt:(At[Lt]=Nt,xt.mul(Nt,jt)),xt.ONE),Bt=xt.inv(kt);return e.reduceRight((Nt,jt,Lt)=>xt.is0(jt)?Nt:(At[Lt]=xt.mul(Nt,At[Lt]),xt.mul(Nt,jt)),Bt),At}function nLength(xt,e){const At=e!==void 0?e:xt.toString(2).length,kt=Math.ceil(At/8);return{nBitLength:At,nByteLength:kt}}function Field(xt,e,At=!1,kt={}){if(xt<=_0n$4)throw new Error(`Expected Field ORDER > 0, got ${xt}`);const{nBitLength:Bt,nByteLength:Nt}=nLength(xt,e);if(Nt>2048)throw new Error("Field lengths over 2048 bytes are not supported");const jt=FpSqrt(xt),Lt=Object.freeze({ORDER:xt,BITS:Bt,BYTES:Nt,MASK:bitMask(Bt),ZERO:_0n$4,ONE:_1n$6,create:er=>mod(er,xt),isValid:er=>{if(typeof er!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof er}`);return _0n$4<=er&&er<xt},is0:er=>er===_0n$4,isOdd:er=>(er&_1n$6)===_1n$6,neg:er=>mod(-er,xt),eql:(er,tr)=>er===tr,sqr:er=>mod(er*er,xt),add:(er,tr)=>mod(er+tr,xt),sub:(er,tr)=>mod(er-tr,xt),mul:(er,tr)=>mod(er*tr,xt),pow:(er,tr)=>FpPow(Lt,er,tr),div:(er,tr)=>mod(er*invert(tr,xt),xt),sqrN:er=>er*er,addN:(er,tr)=>er+tr,subN:(er,tr)=>er-tr,mulN:(er,tr)=>er*tr,inv:er=>invert(er,xt),sqrt:kt.sqrt||(er=>jt(Lt,er)),invertBatch:er=>FpInvertBatch(Lt,er),cmov:(er,tr,zt)=>zt?tr:er,toBytes:er=>At?numberToBytesLE(er,Nt):numberToBytesBE(er,Nt),fromBytes:er=>{if(er.length!==Nt)throw new Error(`Fp.fromBytes: expected ${Nt}, got ${er.length}`);return At?bytesToNumberLE(er):bytesToNumberBE(er)}});return Object.freeze(Lt)}function FpSqrtEven(xt,e){if(!xt.isOdd)throw new Error("Field doesn't have isOdd");const At=xt.sqrt(e);return xt.isOdd(At)?xt.neg(At):At}function getFieldBytesLength(xt){if(typeof xt!="bigint")throw new Error("field order must be bigint");const e=xt.toString(2).length;return Math.ceil(e/8)}function getMinHashLength(xt){const e=getFieldBytesLength(xt);return e+Math.ceil(e/2)}function mapHashToField(xt,e,At=!1){const kt=xt.length,Bt=getFieldBytesLength(e),Nt=getMinHashLength(e);if(kt<16||kt<Nt||kt>1024)throw new Error(`expected ${Nt}-1024 bytes of input, got ${kt}`);const jt=At?bytesToNumberBE(xt):bytesToNumberLE(xt),Lt=mod(jt,e-_1n$6)+_1n$6;return At?numberToBytesLE(Lt,Bt):numberToBytesBE(Lt,Bt)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$5=BigInt(1);function wNAF(xt,e){const At=(Bt,Nt)=>{const jt=Nt.negate();return Bt?jt:Nt},kt=Bt=>{const Nt=Math.ceil(e/Bt)+1,jt=2**(Bt-1);return{windows:Nt,windowSize:jt}};return{constTimeNegate:At,unsafeLadder(Bt,Nt){let jt=xt.ZERO,Lt=Bt;for(;Nt>_0n$3;)Nt&_1n$5&&(jt=jt.add(Lt)),Lt=Lt.double(),Nt>>=_1n$5;return jt},precomputeWindow(Bt,Nt){const{windows:jt,windowSize:Lt}=kt(Nt),er=[];let tr=Bt,zt=tr;for(let rr=0;rr<jt;rr++){zt=tr,er.push(zt);for(let nr=1;nr<Lt;nr++)zt=zt.add(tr),er.push(zt);tr=zt.double()}return er},wNAF(Bt,Nt,jt){const{windows:Lt,windowSize:er}=kt(Bt);let tr=xt.ZERO,zt=xt.BASE;const rr=BigInt(2**Bt-1),nr=2**Bt,ir=BigInt(Bt);for(let ar=0;ar<Lt;ar++){const dr=ar*er;let ur=Number(jt&rr);jt>>=ir,ur>er&&(ur-=nr,jt+=_1n$5);const fr=dr,pr=dr+Math.abs(ur)-1,lr=ar%2!==0,yr=ur<0;ur===0?zt=zt.add(At(lr,Nt[fr])):tr=tr.add(At(yr,Nt[pr]))}return{p:tr,f:zt}},wNAFCached(Bt,Nt,jt,Lt){const er=Bt._WINDOW_SIZE||1;let tr=Nt.get(Bt);return tr||(tr=this.precomputeWindow(Bt,er),er!==1&&Nt.set(Bt,Lt(tr))),this.wNAF(er,tr,jt)}}}function validateBasic(xt){return validateField(xt.Fp),validateObject(xt,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(xt.n,xt.nBitLength),...xt,p:xt.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts(xt){const e=validateBasic(xt);validateObject(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:At,Fp:kt,a:Bt}=e;if(At){if(!kt.eql(Bt,kt.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof At!="object"||typeof At.beta!="bigint"||typeof At.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(xt){const{Err:e}=DER;if(xt.length<2||xt[0]!==2)throw new e("Invalid signature integer tag");const At=xt[1],kt=xt.subarray(2,At+2);if(!At||kt.length!==At)throw new e("Invalid signature integer: wrong length");if(kt[0]&128)throw new e("Invalid signature integer: negative");if(kt[0]===0&&!(kt[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:b2n(kt),l:xt.subarray(At+2)}},toSig(xt){const{Err:e}=DER,At=typeof xt=="string"?h2b(xt):xt;if(!isBytes$3(At))throw new Error("ui8a expected");let kt=At.length;if(kt<2||At[0]!=48)throw new e("Invalid signature tag");if(At[1]!==kt-2)throw new e("Invalid signature: incorrect length");const{d:Bt,l:Nt}=DER._parseInt(At.subarray(2)),{d:jt,l:Lt}=DER._parseInt(Nt);if(Lt.length)throw new e("Invalid signature: left bytes after parsing");return{r:Bt,s:jt}},hexFromSig(xt){const e=tr=>Number.parseInt(tr[0],16)&8?"00"+tr:tr,At=tr=>{const zt=tr.toString(16);return zt.length&1?`0${zt}`:zt},kt=e(At(xt.s)),Bt=e(At(xt.r)),Nt=kt.length/2,jt=Bt.length/2,Lt=At(Nt),er=At(jt);return`30${At(jt+Nt+4)}02${er}${Bt}02${Lt}${kt}`}},_0n$2=BigInt(0),_1n$4=BigInt(1);BigInt(2);const _3n=BigInt(3);BigInt(4);function weierstrassPoints(xt){const e=validatePointOpts(xt),{Fp:At}=e,kt=e.toBytes||((ar,dr,ur)=>{const fr=dr.toAffine();return concatBytes(Uint8Array.from([4]),At.toBytes(fr.x),At.toBytes(fr.y))}),Bt=e.fromBytes||(ar=>{const dr=ar.subarray(1),ur=At.fromBytes(dr.subarray(0,At.BYTES)),fr=At.fromBytes(dr.subarray(At.BYTES,2*At.BYTES));return{x:ur,y:fr}});function Nt(ar){const{a:dr,b:ur}=e,fr=At.sqr(ar),pr=At.mul(fr,ar);return At.add(At.add(pr,At.mul(ar,dr)),ur)}if(!At.eql(At.sqr(e.Gy),Nt(e.Gx)))throw new Error("bad generator point: equation left != right");function jt(ar){return typeof ar=="bigint"&&_0n$2<ar&&ar<e.n}function Lt(ar){if(!jt(ar))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function er(ar){const{allowedPrivateKeyLengths:dr,nByteLength:ur,wrapPrivateKey:fr,n:pr}=e;if(dr&&typeof ar!="bigint"){if(isBytes$3(ar)&&(ar=bytesToHex(ar)),typeof ar!="string"||!dr.includes(ar.length))throw new Error("Invalid key");ar=ar.padStart(ur*2,"0")}let lr;try{lr=typeof ar=="bigint"?ar:bytesToNumberBE(ensureBytes$2("private key",ar,ur))}catch{throw new Error(`private key must be ${ur} bytes, hex or bigint, not ${typeof ar}`)}return fr&&(lr=mod(lr,pr)),Lt(lr),lr}const tr=new Map;function zt(ar){if(!(ar instanceof rr))throw new Error("ProjectivePoint expected")}class rr{constructor(dr,ur,fr){if(this.px=dr,this.py=ur,this.pz=fr,dr==null||!At.isValid(dr))throw new Error("x required");if(ur==null||!At.isValid(ur))throw new Error("y required");if(fr==null||!At.isValid(fr))throw new Error("z required")}static fromAffine(dr){const{x:ur,y:fr}=dr||{};if(!dr||!At.isValid(ur)||!At.isValid(fr))throw new Error("invalid affine point");if(dr instanceof rr)throw new Error("projective point not allowed");const pr=lr=>At.eql(lr,At.ZERO);return pr(ur)&&pr(fr)?rr.ZERO:new rr(ur,fr,At.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(dr){const ur=At.invertBatch(dr.map(fr=>fr.pz));return dr.map((fr,pr)=>fr.toAffine(ur[pr])).map(rr.fromAffine)}static fromHex(dr){const ur=rr.fromAffine(Bt(ensureBytes$2("pointHex",dr)));return ur.assertValidity(),ur}static fromPrivateKey(dr){return rr.BASE.multiply(er(dr))}_setWindowSize(dr){this._WINDOW_SIZE=dr,tr.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!At.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:dr,y:ur}=this.toAffine();if(!At.isValid(dr)||!At.isValid(ur))throw new Error("bad point: x or y not FE");const fr=At.sqr(ur),pr=Nt(dr);if(!At.eql(fr,pr))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:dr}=this.toAffine();if(At.isOdd)return!At.isOdd(dr);throw new Error("Field doesn't support isOdd")}equals(dr){zt(dr);const{px:ur,py:fr,pz:pr}=this,{px:lr,py:yr,pz:br}=dr,Ar=At.eql(At.mul(ur,br),At.mul(lr,pr)),Pr=At.eql(At.mul(fr,br),At.mul(yr,pr));return Ar&&Pr}negate(){return new rr(this.px,At.neg(this.py),this.pz)}double(){const{a:dr,b:ur}=e,fr=At.mul(ur,_3n),{px:pr,py:lr,pz:yr}=this;let br=At.ZERO,Ar=At.ZERO,Pr=At.ZERO,kr=At.mul(pr,pr),Ur=At.mul(lr,lr),Hr=At.mul(yr,yr),Lr=At.mul(pr,lr);return Lr=At.add(Lr,Lr),Pr=At.mul(pr,yr),Pr=At.add(Pr,Pr),br=At.mul(dr,Pr),Ar=At.mul(fr,Hr),Ar=At.add(br,Ar),br=At.sub(Ur,Ar),Ar=At.add(Ur,Ar),Ar=At.mul(br,Ar),br=At.mul(Lr,br),Pr=At.mul(fr,Pr),Hr=At.mul(dr,Hr),Lr=At.sub(kr,Hr),Lr=At.mul(dr,Lr),Lr=At.add(Lr,Pr),Pr=At.add(kr,kr),kr=At.add(Pr,kr),kr=At.add(kr,Hr),kr=At.mul(kr,Lr),Ar=At.add(Ar,kr),Hr=At.mul(lr,yr),Hr=At.add(Hr,Hr),kr=At.mul(Hr,Lr),br=At.sub(br,kr),Pr=At.mul(Hr,Ur),Pr=At.add(Pr,Pr),Pr=At.add(Pr,Pr),new rr(br,Ar,Pr)}add(dr){zt(dr);const{px:ur,py:fr,pz:pr}=this,{px:lr,py:yr,pz:br}=dr;let Ar=At.ZERO,Pr=At.ZERO,kr=At.ZERO;const Ur=e.a,Hr=At.mul(e.b,_3n);let Lr=At.mul(ur,lr),Sr=At.mul(fr,yr),_r=At.mul(pr,br),gr=At.add(ur,fr),wr=At.add(lr,yr);gr=At.mul(gr,wr),wr=At.add(Lr,Sr),gr=At.sub(gr,wr),wr=At.add(ur,pr);let Dr=At.add(lr,br);return wr=At.mul(wr,Dr),Dr=At.add(Lr,_r),wr=At.sub(wr,Dr),Dr=At.add(fr,pr),Ar=At.add(yr,br),Dr=At.mul(Dr,Ar),Ar=At.add(Sr,_r),Dr=At.sub(Dr,Ar),kr=At.mul(Ur,wr),Ar=At.mul(Hr,_r),kr=At.add(Ar,kr),Ar=At.sub(Sr,kr),kr=At.add(Sr,kr),Pr=At.mul(Ar,kr),Sr=At.add(Lr,Lr),Sr=At.add(Sr,Lr),_r=At.mul(Ur,_r),wr=At.mul(Hr,wr),Sr=At.add(Sr,_r),_r=At.sub(Lr,_r),_r=At.mul(Ur,_r),wr=At.add(wr,_r),Lr=At.mul(Sr,wr),Pr=At.add(Pr,Lr),Lr=At.mul(Dr,wr),Ar=At.mul(gr,Ar),Ar=At.sub(Ar,Lr),Lr=At.mul(gr,Sr),kr=At.mul(Dr,kr),kr=At.add(kr,Lr),new rr(Ar,Pr,kr)}subtract(dr){return this.add(dr.negate())}is0(){return this.equals(rr.ZERO)}wNAF(dr){return ir.wNAFCached(this,tr,dr,ur=>{const fr=At.invertBatch(ur.map(pr=>pr.pz));return ur.map((pr,lr)=>pr.toAffine(fr[lr])).map(rr.fromAffine)})}multiplyUnsafe(dr){const ur=rr.ZERO;if(dr===_0n$2)return ur;if(Lt(dr),dr===_1n$4)return this;const{endo:fr}=e;if(!fr)return ir.unsafeLadder(this,dr);let{k1neg:pr,k1:lr,k2neg:yr,k2:br}=fr.splitScalar(dr),Ar=ur,Pr=ur,kr=this;for(;lr>_0n$2||br>_0n$2;)lr&_1n$4&&(Ar=Ar.add(kr)),br&_1n$4&&(Pr=Pr.add(kr)),kr=kr.double(),lr>>=_1n$4,br>>=_1n$4;return pr&&(Ar=Ar.negate()),yr&&(Pr=Pr.negate()),Pr=new rr(At.mul(Pr.px,fr.beta),Pr.py,Pr.pz),Ar.add(Pr)}multiply(dr){Lt(dr);let ur=dr,fr,pr;const{endo:lr}=e;if(lr){const{k1neg:yr,k1:br,k2neg:Ar,k2:Pr}=lr.splitScalar(ur);let{p:kr,f:Ur}=this.wNAF(br),{p:Hr,f:Lr}=this.wNAF(Pr);kr=ir.constTimeNegate(yr,kr),Hr=ir.constTimeNegate(Ar,Hr),Hr=new rr(At.mul(Hr.px,lr.beta),Hr.py,Hr.pz),fr=kr.add(Hr),pr=Ur.add(Lr)}else{const{p:yr,f:br}=this.wNAF(ur);fr=yr,pr=br}return rr.normalizeZ([fr,pr])[0]}multiplyAndAddUnsafe(dr,ur,fr){const pr=rr.BASE,lr=(br,Ar)=>Ar===_0n$2||Ar===_1n$4||!br.equals(pr)?br.multiplyUnsafe(Ar):br.multiply(Ar),yr=lr(this,ur).add(lr(dr,fr));return yr.is0()?void 0:yr}toAffine(dr){const{px:ur,py:fr,pz:pr}=this,lr=this.is0();dr==null&&(dr=lr?At.ONE:At.inv(pr));const yr=At.mul(ur,dr),br=At.mul(fr,dr),Ar=At.mul(pr,dr);if(lr)return{x:At.ZERO,y:At.ZERO};if(!At.eql(Ar,At.ONE))throw new Error("invZ was invalid");return{x:yr,y:br}}isTorsionFree(){const{h:dr,isTorsionFree:ur}=e;if(dr===_1n$4)return!0;if(ur)return ur(rr,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:dr,clearCofactor:ur}=e;return dr===_1n$4?this:ur?ur(rr,this):this.multiplyUnsafe(e.h)}toRawBytes(dr=!0){return this.assertValidity(),kt(rr,this,dr)}toHex(dr=!0){return bytesToHex(this.toRawBytes(dr))}}rr.BASE=new rr(e.Gx,e.Gy,At.ONE),rr.ZERO=new rr(At.ZERO,At.ONE,At.ZERO);const nr=e.nBitLength,ir=wNAF(rr,e.endo?Math.ceil(nr/2):nr);return{CURVE:e,ProjectivePoint:rr,normPrivateKeyToScalar:er,weierstrassEquation:Nt,isWithinCurveOrder:jt}}function validateOpts$2(xt){const e=validateBasic(xt);return validateObject(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass(xt){const e=validateOpts$2(xt),{Fp:At,n:kt}=e,Bt=At.BYTES+1,Nt=2*At.BYTES+1;function jt(wr){return _0n$2<wr&&wr<At.ORDER}function Lt(wr){return mod(wr,kt)}function er(wr){return invert(wr,kt)}const{ProjectivePoint:tr,normPrivateKeyToScalar:zt,weierstrassEquation:rr,isWithinCurveOrder:nr}=weierstrassPoints({...e,toBytes(wr,Dr,xr){const Ir=Dr.toAffine(),$r=At.toBytes(Ir.x),vr=concatBytes;return xr?vr(Uint8Array.from([Dr.hasEvenY()?2:3]),$r):vr(Uint8Array.from([4]),$r,At.toBytes(Ir.y))},fromBytes(wr){const Dr=wr.length,xr=wr[0],Ir=wr.subarray(1);if(Dr===Bt&&(xr===2||xr===3)){const $r=bytesToNumberBE(Ir);if(!jt($r))throw new Error("Point is not on curve");const vr=rr($r);let Er=At.sqrt(vr);const Tr=(Er&_1n$4)===_1n$4;return(xr&1)===1!==Tr&&(Er=At.neg(Er)),{x:$r,y:Er}}else if(Dr===Nt&&xr===4){const $r=At.fromBytes(Ir.subarray(0,At.BYTES)),vr=At.fromBytes(Ir.subarray(At.BYTES,2*At.BYTES));return{x:$r,y:vr}}else throw new Error(`Point of length ${Dr} was invalid. Expected ${Bt} compressed bytes or ${Nt} uncompressed bytes`)}}),ir=wr=>bytesToHex(numberToBytesBE(wr,e.nByteLength));function ar(wr){const Dr=kt>>_1n$4;return wr>Dr}function dr(wr){return ar(wr)?Lt(-wr):wr}const ur=(wr,Dr,xr)=>bytesToNumberBE(wr.slice(Dr,xr));class fr{constructor(Dr,xr,Ir){this.r=Dr,this.s=xr,this.recovery=Ir,this.assertValidity()}static fromCompact(Dr){const xr=e.nByteLength;return Dr=ensureBytes$2("compactSignature",Dr,xr*2),new fr(ur(Dr,0,xr),ur(Dr,xr,2*xr))}static fromDER(Dr){const{r:xr,s:Ir}=DER.toSig(ensureBytes$2("DER",Dr));return new fr(xr,Ir)}assertValidity(){if(!nr(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!nr(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(Dr){return new fr(this.r,this.s,Dr)}recoverPublicKey(Dr){const{r:xr,s:Ir,recovery:$r}=this,vr=Pr(ensureBytes$2("msgHash",Dr));if($r==null||![0,1,2,3].includes($r))throw new Error("recovery id invalid");const Er=$r===2||$r===3?xr+e.n:xr;if(Er>=At.ORDER)throw new Error("recovery id 2 or 3 invalid");const Tr=$r&1?"03":"02",Rr=tr.fromHex(Tr+ir(Er)),Mr=er(Er),Gr=Lt(-vr*Mr),Br=Lt(Ir*Mr),Cr=tr.BASE.multiplyAndAddUnsafe(Rr,Gr,Br);if(!Cr)throw new Error("point at infinify");return Cr.assertValidity(),Cr}hasHighS(){return ar(this.s)}normalizeS(){return this.hasHighS()?new fr(this.r,Lt(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes(this.toDERHex())}toDERHex(){return DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes(this.toCompactHex())}toCompactHex(){return ir(this.r)+ir(this.s)}}const pr={isValidPrivateKey(wr){try{return zt(wr),!0}catch{return!1}},normPrivateKeyToScalar:zt,randomPrivateKey:()=>{const wr=getMinHashLength(e.n);return mapHashToField(e.randomBytes(wr),e.n)},precompute(wr=8,Dr=tr.BASE){return Dr._setWindowSize(wr),Dr.multiply(BigInt(3)),Dr}};function lr(wr,Dr=!0){return tr.fromPrivateKey(wr).toRawBytes(Dr)}function yr(wr){const Dr=isBytes$3(wr),xr=typeof wr=="string",Ir=(Dr||xr)&&wr.length;return Dr?Ir===Bt||Ir===Nt:xr?Ir===2*Bt||Ir===2*Nt:wr instanceof tr}function br(wr,Dr,xr=!0){if(yr(wr))throw new Error("first arg must be private key");if(!yr(Dr))throw new Error("second arg must be public key");return tr.fromHex(Dr).multiply(zt(wr)).toRawBytes(xr)}const Ar=e.bits2int||function(wr){const Dr=bytesToNumberBE(wr),xr=wr.length*8-e.nBitLength;return xr>0?Dr>>BigInt(xr):Dr},Pr=e.bits2int_modN||function(wr){return Lt(Ar(wr))},kr=bitMask(e.nBitLength);function Ur(wr){if(typeof wr!="bigint")throw new Error("bigint expected");if(!(_0n$2<=wr&&wr<kr))throw new Error(`bigint expected < 2^${e.nBitLength}`);return numberToBytesBE(wr,e.nByteLength)}function Hr(wr,Dr,xr=Lr){if(["recovered","canonical"].some(Yr=>Yr in xr))throw new Error("sign() legacy options not supported");const{hash:Ir,randomBytes:$r}=e;let{lowS:vr,prehash:Er,extraEntropy:Tr}=xr;vr==null&&(vr=!0),wr=ensureBytes$2("msgHash",wr),Er&&(wr=ensureBytes$2("prehashed msgHash",Ir(wr)));const Rr=Pr(wr),Mr=zt(Dr),Gr=[Ur(Mr),Ur(Rr)];if(Tr!=null){const Yr=Tr===!0?$r(At.BYTES):Tr;Gr.push(ensureBytes$2("extraEntropy",Yr))}const Br=concatBytes(...Gr),Cr=Rr;function jr(Yr){const Qr=Ar(Yr);if(!nr(Qr))return;const Jr=er(Qr),Wr=tr.BASE.multiply(Qr).toAffine(),Nr=Lt(Wr.x);if(Nr===_0n$2)return;const Vr=Lt(Jr*Lt(Cr+Nr*Mr));if(Vr===_0n$2)return;let Xr=(Wr.x===Nr?0:2)|Number(Wr.y&_1n$4),qr=Vr;return vr&&ar(Vr)&&(qr=dr(Vr),Xr^=1),new fr(Nr,qr,Xr)}return{seed:Br,k2sig:jr}}const Lr={lowS:e.lowS,prehash:!1},Sr={lowS:e.lowS,prehash:!1};function _r(wr,Dr,xr=Lr){const{seed:Ir,k2sig:$r}=Hr(wr,Dr,xr),vr=e;return createHmacDrbg(vr.hash.outputLen,vr.nByteLength,vr.hmac)(Ir,$r)}tr.BASE._setWindowSize(8);function gr(wr,Dr,xr,Ir=Sr){var Wr;const $r=wr;if(Dr=ensureBytes$2("msgHash",Dr),xr=ensureBytes$2("publicKey",xr),"strict"in Ir)throw new Error("options.strict was renamed to lowS");const{lowS:vr,prehash:Er}=Ir;let Tr,Rr;try{if(typeof $r=="string"||isBytes$3($r))try{Tr=fr.fromDER($r)}catch(Nr){if(!(Nr instanceof DER.Err))throw Nr;Tr=fr.fromCompact($r)}else if(typeof $r=="object"&&typeof $r.r=="bigint"&&typeof $r.s=="bigint"){const{r:Nr,s:Vr}=$r;Tr=new fr(Nr,Vr)}else throw new Error("PARSE");Rr=tr.fromHex(xr)}catch(Nr){if(Nr.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(vr&&Tr.hasHighS())return!1;Er&&(Dr=e.hash(Dr));const{r:Mr,s:Gr}=Tr,Br=Pr(Dr),Cr=er(Gr),jr=Lt(Br*Cr),Yr=Lt(Mr*Cr),Qr=(Wr=tr.BASE.multiplyAndAddUnsafe(Rr,jr,Yr))==null?void 0:Wr.toAffine();return Qr?Lt(Qr.x)===Mr:!1}return{CURVE:e,getPublicKey:lr,getSharedSecret:br,sign:_r,verify:gr,ProjectivePoint:tr,Signature:fr,utils:pr}}class HMAC extends Hash{constructor(e,At){super(),this.finished=!1,this.destroyed=!1,hash(e);const kt=toBytes$1(At);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const Bt=this.blockLen,Nt=new Uint8Array(Bt);Nt.set(kt.length>Bt?e.create().update(kt).digest():kt);for(let jt=0;jt<Nt.length;jt++)Nt[jt]^=54;this.iHash.update(Nt),this.oHash=e.create();for(let jt=0;jt<Nt.length;jt++)Nt[jt]^=106;this.oHash.update(Nt),Nt.fill(0)}update(e){return exists$1(this),this.iHash.update(e),this}digestInto(e){exists$1(this),bytes$1(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:At,iHash:kt,finished:Bt,destroyed:Nt,blockLen:jt,outputLen:Lt}=this;return e=e,e.finished=Bt,e.destroyed=Nt,e.blockLen=jt,e.outputLen=Lt,e.oHash=At._cloneInto(e.oHash),e.iHash=kt._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(xt,e,At)=>new HMAC(xt,e).update(At).digest();hmac.create=(xt,e)=>new HMAC(xt,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(xt){return{hash:xt,hmac:(e,...At)=>hmac(xt,e,concatBytes$1(...At)),randomBytes:randomBytes$2}}function createCurve(xt,e){const At=kt=>weierstrass({...xt,...getHash(kt)});return Object.freeze({...At(e),create:At})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$3=BigInt(1),_2n$2=BigInt(2),divNearest=(xt,e)=>(xt+e/_2n$2)/e;function sqrtMod(xt){const e=secp256k1P,At=BigInt(3),kt=BigInt(6),Bt=BigInt(11),Nt=BigInt(22),jt=BigInt(23),Lt=BigInt(44),er=BigInt(88),tr=xt*xt*xt%e,zt=tr*tr*xt%e,rr=pow2(zt,At,e)*zt%e,nr=pow2(rr,At,e)*zt%e,ir=pow2(nr,_2n$2,e)*tr%e,ar=pow2(ir,Bt,e)*ir%e,dr=pow2(ar,Nt,e)*ar%e,ur=pow2(dr,Lt,e)*dr%e,fr=pow2(ur,er,e)*ur%e,pr=pow2(fr,Lt,e)*dr%e,lr=pow2(pr,At,e)*zt%e,yr=pow2(lr,jt,e)*ar%e,br=pow2(yr,kt,e)*tr%e,Ar=pow2(br,_2n$2,e);if(!Fp$2.eql(Fp$2.sqr(Ar),xt))throw new Error("Cannot find square root");return Ar}const Fp$2=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1=createCurve({a:BigInt(0),b:BigInt(7),Fp:Fp$2,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:xt=>{const e=secp256k1N,At=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),kt=-_1n$3*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),Bt=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),Nt=At,jt=BigInt("0x100000000000000000000000000000000"),Lt=divNearest(Nt*xt,e),er=divNearest(-kt*xt,e);let tr=mod(xt-Lt*At-er*Bt,e),zt=mod(-Lt*kt-er*Nt,e);const rr=tr>jt,nr=zt>jt;if(rr&&(tr=e-tr),nr&&(zt=e-zt),tr>jt||zt>jt)throw new Error("splitScalar: Endomorphism failed, k="+xt);return{k1neg:rr,k1:tr,k2neg:nr,k2:zt}}}},sha256);BigInt(0);secp256k1.ProjectivePoint;function canonicalize$4(xt){const e=kt=>{if(kt!==null&&typeof kt=="object"&&!Array.isArray(kt)){const Bt=Object.keys(kt).sort(),Nt={};for(const jt of Bt)Nt[jt]=e(kt[jt]);return Nt}return kt},At=e(xt);return JSON.stringify(At)}var __awaiter$2x=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const KEY_URI_PREFIX_JWK$2="urn:jwk:";function computeJwkThumbprint$2(xt){return __awaiter$2x(this,arguments,void 0,function*({jwk:e}){const At=e.kty;let kt;if(At==="EC")kt={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(At==="oct")kt={k:e.k,kty:e.kty};else if(At==="OKP")kt={crv:e.crv,kty:e.kty,x:e.x};else if(At==="RSA")kt={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${At}`);removeUndefinedProperties$2(kt);const Bt=canonicalize$4(kt),Nt=Convert$2.string(Bt).toUint8Array(),jt=yield Sha256$2.digest({data:Nt});return Convert$2.uint8Array(jt).toBase64Url()})}function isEcPrivateJwk$2(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"crv"in xt&&"x"in xt&&"d"in xt)||xt.kty!=="EC"||typeof xt.d!="string"||typeof xt.x!="string")}function isEcPublicJwk$2(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"crv"in xt&&"x"in xt)||"d"in xt||xt.kty!=="EC"||typeof xt.x!="string")}function isOctPrivateJwk$1(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"k"in xt)||xt.kty!=="oct"||typeof xt.k!="string")}function isOkpPrivateJwk$2(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"crv"in xt&&"x"in xt&&"d"in xt)||xt.kty!=="OKP"||typeof xt.d!="string"||typeof xt.x!="string")}function isOkpPublicJwk$2(xt){return!(!xt||typeof xt!="object"||"d"in xt||!("kty"in xt&&"crv"in xt&&"x"in xt)||xt.kty!=="OKP"||typeof xt.x!="string")}function isPrivateJwk$2(xt){if(!xt||typeof xt!="object")return!1;switch(xt.kty){case"EC":case"OKP":case"RSA":return"d"in xt;case"oct":return"k"in xt;default:return!1}}var __awaiter$2w=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$C=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let Secp256k1$2=class Lo{static adjustSignatureToLowS(e){return __awaiter$2w(this,arguments,void 0,function*({signature:At}){const kt=secp256k1.Signature.fromCompact(At);return kt.hasHighS()?kt.normalizeS().toCompactRawBytes():At})}static bytesToPrivateKey(e){return __awaiter$2w(this,arguments,void 0,function*({privateKeyBytes:At}){const kt=yield Lo.getCurvePoint({keyBytes:At}),Bt={kty:"EC",crv:"secp256k1",d:Convert$2.uint8Array(At).toBase64Url(),x:Convert$2.uint8Array(kt.x).toBase64Url(),y:Convert$2.uint8Array(kt.y).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$2({jwk:Bt}),Bt})}static bytesToPublicKey(e){return __awaiter$2w(this,arguments,void 0,function*({publicKeyBytes:At}){const kt=yield Lo.getCurvePoint({keyBytes:At}),Bt={kty:"EC",crv:"secp256k1",x:Convert$2.uint8Array(kt.x).toBase64Url(),y:Convert$2.uint8Array(kt.y).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$2({jwk:Bt}),Bt})}static compressPublicKey(e){return __awaiter$2w(this,arguments,void 0,function*({publicKeyBytes:At}){return secp256k1.ProjectivePoint.fromHex(At).toRawBytes(!0)})}static computePublicKey(e){return __awaiter$2w(this,arguments,void 0,function*({key:At}){const kt=yield Lo.privateKeyToBytes({privateKey:At}),Bt=yield Lo.getCurvePoint({keyBytes:kt}),Nt={kty:"EC",crv:"secp256k1",x:Convert$2.uint8Array(Bt.x).toBase64Url(),y:Convert$2.uint8Array(Bt.y).toBase64Url()};return Nt.kid=yield computeJwkThumbprint$2({jwk:Nt}),Nt})}static convertDerToCompactSignature(e){return __awaiter$2w(this,arguments,void 0,function*({derSignature:At}){return secp256k1.Signature.fromDER(At).toCompactRawBytes()})}static decompressPublicKey(e){return __awaiter$2w(this,arguments,void 0,function*({publicKeyBytes:At}){return secp256k1.ProjectivePoint.fromHex(At).toRawBytes(!1)})}static generateKey(){return __awaiter$2w(this,void 0,void 0,function*(){const e=secp256k1.utils.randomPrivateKey(),At=yield Lo.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint$2({jwk:At}),At})}static getPublicKey(e){return __awaiter$2w(this,arguments,void 0,function*({key:At}){var kt;if(!(isEcPrivateJwk$2(At)&&At.crv==="secp256k1"))throw new Error("Secp256k1: The provided key is not a secp256k1 private JWK.");let Bt=__rest$C(At,["d"]);return(kt=Bt.kid)!==null&&kt!==void 0||(Bt.kid=yield computeJwkThumbprint$2({jwk:Bt})),Bt})}static privateKeyToBytes(e){return __awaiter$2w(this,arguments,void 0,function*({privateKey:At}){if(!isEcPrivateJwk$2(At))throw new Error("Secp256k1: The provided key is not a valid EC private key.");return Convert$2.base64Url(At.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$2w(this,arguments,void 0,function*({publicKey:At}){if(!(isEcPublicJwk$2(At)&&At.y))throw new Error("Secp256k1: The provided key is not a valid EC public key.");const kt=new Uint8Array([4]),Bt=Convert$2.base64Url(At.x).toUint8Array(),Nt=Convert$2.base64Url(At.y).toUint8Array();return new Uint8Array([...kt,...Bt,...Nt])})}static sharedSecret(e){return __awaiter$2w(this,arguments,void 0,function*({privateKeyA:At,publicKeyB:kt}){if("x"in At&&"x"in kt&&At.x===kt.x)throw new Error("Secp256k1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const Bt=yield Lo.privateKeyToBytes({privateKey:At}),Nt=yield Lo.publicKeyToBytes({publicKey:kt});return secp256k1.getSharedSecret(Bt,Nt,!0).slice(1)})}static sign(e){return __awaiter$2w(this,arguments,void 0,function*({data:At,key:kt}){const Bt=yield Lo.privateKeyToBytes({privateKey:kt}),Nt=sha256$5(At);return secp256k1.sign(Nt,Bt).toCompactRawBytes()})}static validatePrivateKey(e){return __awaiter$2w(this,arguments,void 0,function*({privateKeyBytes:At}){return secp256k1.utils.isValidPrivateKey(At)})}static validatePublicKey(e){return __awaiter$2w(this,arguments,void 0,function*({publicKeyBytes:At}){try{secp256k1.ProjectivePoint.fromHex(At).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$2w(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){const Nt=yield Lo.publicKeyToBytes({publicKey:At}),jt=sha256$5(Bt);return secp256k1.verify(kt,jt,Nt,{lowS:!1})})}static getCurvePoint(e){return __awaiter$2w(this,arguments,void 0,function*({keyBytes:At}){At.byteLength===32&&(At=secp256k1.getPublicKey(At));const kt=secp256k1.ProjectivePoint.fromHex(At),Bt=numberToBytesBE(kt.x,32),Nt=numberToBytesBE(kt.y,32);return{x:Bt,y:Nt}})}};/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fp$1=Field(BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff")),CURVE_A=Fp$1.create(BigInt("-3")),CURVE_B=BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),p256=createCurve({a:CURVE_A,b:CURVE_B,Fp:Fp$1,n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),h:BigInt(1),lowS:!1},sha256),secp256r1=p256;var __awaiter$2v=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$B=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let Secp256r1$2=class Ko{static adjustSignatureToLowS(e){return __awaiter$2v(this,arguments,void 0,function*({signature:At}){const kt=secp256r1.Signature.fromCompact(At);return kt.hasHighS()?kt.normalizeS().toCompactRawBytes():At})}static bytesToPrivateKey(e){return __awaiter$2v(this,arguments,void 0,function*({privateKeyBytes:At}){const kt=yield Ko.getCurvePoint({keyBytes:At}),Bt={kty:"EC",crv:"P-256",d:Convert$2.uint8Array(At).toBase64Url(),x:Convert$2.uint8Array(kt.x).toBase64Url(),y:Convert$2.uint8Array(kt.y).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$2({jwk:Bt}),Bt})}static bytesToPublicKey(e){return __awaiter$2v(this,arguments,void 0,function*({publicKeyBytes:At}){const kt=yield Ko.getCurvePoint({keyBytes:At}),Bt={kty:"EC",crv:"P-256",x:Convert$2.uint8Array(kt.x).toBase64Url(),y:Convert$2.uint8Array(kt.y).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$2({jwk:Bt}),Bt})}static compressPublicKey(e){return __awaiter$2v(this,arguments,void 0,function*({publicKeyBytes:At}){return secp256r1.ProjectivePoint.fromHex(At).toRawBytes(!0)})}static computePublicKey(e){return __awaiter$2v(this,arguments,void 0,function*({key:At}){const kt=yield Ko.privateKeyToBytes({privateKey:At}),Bt=yield Ko.getCurvePoint({keyBytes:kt}),Nt={kty:"EC",crv:"P-256",x:Convert$2.uint8Array(Bt.x).toBase64Url(),y:Convert$2.uint8Array(Bt.y).toBase64Url()};return Nt.kid=yield computeJwkThumbprint$2({jwk:Nt}),Nt})}static convertDerToCompactSignature(e){return __awaiter$2v(this,arguments,void 0,function*({derSignature:At}){return secp256r1.Signature.fromDER(At).toCompactRawBytes()})}static decompressPublicKey(e){return __awaiter$2v(this,arguments,void 0,function*({publicKeyBytes:At}){return secp256r1.ProjectivePoint.fromHex(At).toRawBytes(!1)})}static generateKey(){return __awaiter$2v(this,void 0,void 0,function*(){const e=secp256r1.utils.randomPrivateKey(),At=yield Ko.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint$2({jwk:At}),At})}static getPublicKey(e){return __awaiter$2v(this,arguments,void 0,function*({key:At}){var kt;if(!(isEcPrivateJwk$2(At)&&At.crv==="P-256"))throw new Error("Secp256r1: The provided key is not a 'P-256' private JWK.");let Bt=__rest$B(At,["d"]);return(kt=Bt.kid)!==null&&kt!==void 0||(Bt.kid=yield computeJwkThumbprint$2({jwk:Bt})),Bt})}static privateKeyToBytes(e){return __awaiter$2v(this,arguments,void 0,function*({privateKey:At}){if(!isEcPrivateJwk$2(At))throw new Error("Secp256r1: The provided key is not a valid EC private key.");return Convert$2.base64Url(At.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$2v(this,arguments,void 0,function*({publicKey:At}){if(!(isEcPublicJwk$2(At)&&At.y))throw new Error("Secp256r1: The provided key is not a valid EC public key.");const kt=new Uint8Array([4]),Bt=Convert$2.base64Url(At.x).toUint8Array(),Nt=Convert$2.base64Url(At.y).toUint8Array();return new Uint8Array([...kt,...Bt,...Nt])})}static sharedSecret(e){return __awaiter$2v(this,arguments,void 0,function*({privateKeyA:At,publicKeyB:kt}){if("x"in At&&"x"in kt&&At.x===kt.x)throw new Error("Secp256r1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const Bt=yield Ko.privateKeyToBytes({privateKey:At}),Nt=yield Ko.publicKeyToBytes({publicKey:kt});return secp256r1.getSharedSecret(Bt,Nt,!0).slice(1)})}static sign(e){return __awaiter$2v(this,arguments,void 0,function*({data:At,key:kt}){const Bt=yield Ko.privateKeyToBytes({privateKey:kt}),Nt=sha256$5(At);return secp256r1.sign(Nt,Bt).toCompactRawBytes()})}static validatePrivateKey(e){return __awaiter$2v(this,arguments,void 0,function*({privateKeyBytes:At}){return secp256r1.utils.isValidPrivateKey(At)})}static validatePublicKey(e){return __awaiter$2v(this,arguments,void 0,function*({publicKeyBytes:At}){try{secp256r1.ProjectivePoint.fromHex(At).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$2v(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){const Nt=yield Ko.publicKeyToBytes({publicKey:At}),jt=sha256$5(Bt);return secp256r1.verify(kt,jt,Nt,{lowS:!1})})}static getCurvePoint(e){return __awaiter$2v(this,arguments,void 0,function*({keyBytes:At}){At.byteLength===32&&(At=secp256r1.getPublicKey(At));const kt=secp256r1.ProjectivePoint.fromHex(At),Bt=numberToBytesBE(kt.x,32),Nt=numberToBytesBE(kt.y,32);return{x:Bt,y:Nt}})}};var __awaiter$2u=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let EcdsaAlgorithm$4=class extends CryptoAlgorithm$2{computePublicKey(e){return __awaiter$2u(this,arguments,void 0,function*({key:At}){if(!isEcPrivateJwk$2(At))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(At.crv){case"secp256k1":{const kt=yield Secp256k1$2.computePublicKey({key:At});return kt.alg="ES256K",kt}case"P-256":{const kt=yield Secp256r1$2.computePublicKey({key:At});return kt.alg="ES256",kt}default:throw new Error(`Unsupported curve: ${At.crv}`)}})}generateKey(e){return __awaiter$2u(this,arguments,void 0,function*({algorithm:At}){switch(At){case"ES256K":case"secp256k1":{const kt=yield Secp256k1$2.generateKey();return kt.alg="ES256K",kt}case"ES256":case"secp256r1":{const kt=yield Secp256r1$2.generateKey();return kt.alg="ES256",kt}}})}getPublicKey(e){return __awaiter$2u(this,arguments,void 0,function*({key:At}){if(!isEcPrivateJwk$2(At))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(At.crv){case"secp256k1":{const kt=yield Secp256k1$2.getPublicKey({key:At});return kt.alg="ES256K",kt}case"P-256":{const kt=yield Secp256r1$2.getPublicKey({key:At});return kt.alg="ES256",kt}default:throw new Error(`Unsupported curve: ${At.crv}`)}})}sign(e){return __awaiter$2u(this,arguments,void 0,function*({key:At,data:kt}){if(!isEcPrivateJwk$2(At))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(At.crv){case"secp256k1":return yield Secp256k1$2.sign({key:At,data:kt});case"P-256":return yield Secp256r1$2.sign({key:At,data:kt});default:throw new Error(`Unsupported curve: ${At.crv}`)}})}verify(e){return __awaiter$2u(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){if(!isEcPublicJwk$2(At))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(At.crv){case"secp256k1":return yield Secp256k1$2.verify({key:At,signature:kt,data:Bt});case"P-256":return yield Secp256r1$2.verify({key:At,signature:kt,data:Bt});default:throw new Error(`Unsupported curve: ${At.crv}`)}})}};const U32_MASK64=BigInt(2**32-1),_32n=BigInt(32);function fromBig(xt,e=!1){return e?{h:Number(xt&U32_MASK64),l:Number(xt>>_32n&U32_MASK64)}:{h:Number(xt>>_32n&U32_MASK64)|0,l:Number(xt&U32_MASK64)|0}}function split(xt,e=!1){let At=new Uint32Array(xt.length),kt=new Uint32Array(xt.length);for(let Bt=0;Bt<xt.length;Bt++){const{h:Nt,l:jt}=fromBig(xt[Bt],e);[At[Bt],kt[Bt]]=[Nt,jt]}return[At,kt]}const toBig=(xt,e)=>BigInt(xt>>>0)<<_32n|BigInt(e>>>0),shrSH=(xt,e,At)=>xt>>>At,shrSL=(xt,e,At)=>xt<<32-At|e>>>At,rotrSH=(xt,e,At)=>xt>>>At|e<<32-At,rotrSL=(xt,e,At)=>xt<<32-At|e>>>At,rotrBH=(xt,e,At)=>xt<<64-At|e>>>At-32,rotrBL=(xt,e,At)=>xt>>>At-32|e<<64-At,rotr32H=(xt,e)=>e,rotr32L=(xt,e)=>xt,rotlSH=(xt,e,At)=>xt<<At|e>>>32-At,rotlSL=(xt,e,At)=>e<<At|xt>>>32-At,rotlBH=(xt,e,At)=>e<<At-32|xt>>>64-At,rotlBL=(xt,e,At)=>xt<<At-32|e>>>64-At;function add(xt,e,At,kt){const Bt=(e>>>0)+(kt>>>0);return{h:xt+At+(Bt/2**32|0)|0,l:Bt|0}}const add3L=(xt,e,At)=>(xt>>>0)+(e>>>0)+(At>>>0),add3H=(xt,e,At,kt)=>e+At+kt+(xt/2**32|0)|0,add4L=(xt,e,At,kt)=>(xt>>>0)+(e>>>0)+(At>>>0)+(kt>>>0),add4H=(xt,e,At,kt,Bt)=>e+At+kt+Bt+(xt/2**32|0)|0,add5L=(xt,e,At,kt,Bt)=>(xt>>>0)+(e>>>0)+(At>>>0)+(kt>>>0)+(Bt>>>0),add5H=(xt,e,At,kt,Bt,Nt)=>e+At+kt+Bt+Nt+(xt/2**32|0)|0,u64={fromBig,split,toBig,shrSH,shrSL,rotrSH,rotrSL,rotrBH,rotrBL,rotr32H,rotr32L,rotlSH,rotlSL,rotlBH,rotlBL,add,add3L,add3H,add4L,add4H,add5H,add5L},[SHA512_Kh,SHA512_Kl]=u64.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(xt=>BigInt(xt))),SHA512_W_H=new Uint32Array(80),SHA512_W_L=new Uint32Array(80);class SHA512 extends SHA2{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:At,Bh:kt,Bl:Bt,Ch:Nt,Cl:jt,Dh:Lt,Dl:er,Eh:tr,El:zt,Fh:rr,Fl:nr,Gh:ir,Gl:ar,Hh:dr,Hl:ur}=this;return[e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar,dr,ur]}set(e,At,kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar,dr,ur){this.Ah=e|0,this.Al=At|0,this.Bh=kt|0,this.Bl=Bt|0,this.Ch=Nt|0,this.Cl=jt|0,this.Dh=Lt|0,this.Dl=er|0,this.Eh=tr|0,this.El=zt|0,this.Fh=rr|0,this.Fl=nr|0,this.Gh=ir|0,this.Gl=ar|0,this.Hh=dr|0,this.Hl=ur|0}process(e,At){for(let lr=0;lr<16;lr++,At+=4)SHA512_W_H[lr]=e.getUint32(At),SHA512_W_L[lr]=e.getUint32(At+=4);for(let lr=16;lr<80;lr++){const yr=SHA512_W_H[lr-15]|0,br=SHA512_W_L[lr-15]|0,Ar=u64.rotrSH(yr,br,1)^u64.rotrSH(yr,br,8)^u64.shrSH(yr,br,7),Pr=u64.rotrSL(yr,br,1)^u64.rotrSL(yr,br,8)^u64.shrSL(yr,br,7),kr=SHA512_W_H[lr-2]|0,Ur=SHA512_W_L[lr-2]|0,Hr=u64.rotrSH(kr,Ur,19)^u64.rotrBH(kr,Ur,61)^u64.shrSH(kr,Ur,6),Lr=u64.rotrSL(kr,Ur,19)^u64.rotrBL(kr,Ur,61)^u64.shrSL(kr,Ur,6),Sr=u64.add4L(Pr,Lr,SHA512_W_L[lr-7],SHA512_W_L[lr-16]),_r=u64.add4H(Sr,Ar,Hr,SHA512_W_H[lr-7],SHA512_W_H[lr-16]);SHA512_W_H[lr]=_r|0,SHA512_W_L[lr]=Sr|0}let{Ah:kt,Al:Bt,Bh:Nt,Bl:jt,Ch:Lt,Cl:er,Dh:tr,Dl:zt,Eh:rr,El:nr,Fh:ir,Fl:ar,Gh:dr,Gl:ur,Hh:fr,Hl:pr}=this;for(let lr=0;lr<80;lr++){const yr=u64.rotrSH(rr,nr,14)^u64.rotrSH(rr,nr,18)^u64.rotrBH(rr,nr,41),br=u64.rotrSL(rr,nr,14)^u64.rotrSL(rr,nr,18)^u64.rotrBL(rr,nr,41),Ar=rr&ir^~rr&dr,Pr=nr&ar^~nr&ur,kr=u64.add5L(pr,br,Pr,SHA512_Kl[lr],SHA512_W_L[lr]),Ur=u64.add5H(kr,fr,yr,Ar,SHA512_Kh[lr],SHA512_W_H[lr]),Hr=kr|0,Lr=u64.rotrSH(kt,Bt,28)^u64.rotrBH(kt,Bt,34)^u64.rotrBH(kt,Bt,39),Sr=u64.rotrSL(kt,Bt,28)^u64.rotrBL(kt,Bt,34)^u64.rotrBL(kt,Bt,39),_r=kt&Nt^kt&Lt^Nt&Lt,gr=Bt&jt^Bt&er^jt&er;fr=dr|0,pr=ur|0,dr=ir|0,ur=ar|0,ir=rr|0,ar=nr|0,{h:rr,l:nr}=u64.add(tr|0,zt|0,Ur|0,Hr|0),tr=Lt|0,zt=er|0,Lt=Nt|0,er=jt|0,Nt=kt|0,jt=Bt|0;const wr=u64.add3L(Hr,Sr,gr);kt=u64.add3H(wr,Ur,Lr,_r),Bt=wr|0}({h:kt,l:Bt}=u64.add(this.Ah|0,this.Al|0,kt|0,Bt|0)),{h:Nt,l:jt}=u64.add(this.Bh|0,this.Bl|0,Nt|0,jt|0),{h:Lt,l:er}=u64.add(this.Ch|0,this.Cl|0,Lt|0,er|0),{h:tr,l:zt}=u64.add(this.Dh|0,this.Dl|0,tr|0,zt|0),{h:rr,l:nr}=u64.add(this.Eh|0,this.El|0,rr|0,nr|0),{h:ir,l:ar}=u64.add(this.Fh|0,this.Fl|0,ir|0,ar|0),{h:dr,l:ur}=u64.add(this.Gh|0,this.Gl|0,dr|0,ur|0),{h:fr,l:pr}=u64.add(this.Hh|0,this.Hl|0,fr|0,pr|0),this.set(kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir,ar,dr,ur,fr,pr)}roundClean(){SHA512_W_H.fill(0),SHA512_W_L.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const sha512=wrapConstructor(()=>new SHA512);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$1=BigInt(0),_1n$2=BigInt(1),_2n$1=BigInt(2),_8n=BigInt(8),VERIFY_DEFAULT={zip215:!0};function validateOpts$1(xt){const e=validateBasic(xt);return validateObject(xt,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function twistedEdwards(xt){const e=validateOpts$1(xt),{Fp:At,n:kt,prehash:Bt,hash:Nt,randomBytes:jt,nByteLength:Lt,h:er}=e,tr=_2n$1<<BigInt(Lt*8)-_1n$2,zt=At.create,rr=e.uvRatio||((Ir,$r)=>{try{return{isValid:!0,value:At.sqrt(Ir*At.inv($r))}}catch{return{isValid:!1,value:_0n$1}}}),nr=e.adjustScalarBytes||(Ir=>Ir),ir=e.domain||((Ir,$r,vr)=>{if($r.length||vr)throw new Error("Contexts/pre-hash are not supported");return Ir}),ar=Ir=>typeof Ir=="bigint"&&_0n$1<Ir,dr=(Ir,$r)=>ar(Ir)&&ar($r)&&Ir<$r,ur=Ir=>Ir===_0n$1||dr(Ir,tr);function fr(Ir,$r){if(dr(Ir,$r))return Ir;throw new Error(`Expected valid scalar < ${$r}, got ${typeof Ir} ${Ir}`)}function pr(Ir){return Ir===_0n$1?Ir:fr(Ir,kt)}const lr=new Map;function yr(Ir){if(!(Ir instanceof br))throw new Error("ExtendedPoint expected")}class br{constructor($r,vr,Er,Tr){if(this.ex=$r,this.ey=vr,this.ez=Er,this.et=Tr,!ur($r))throw new Error("x required");if(!ur(vr))throw new Error("y required");if(!ur(Er))throw new Error("z required");if(!ur(Tr))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine($r){if($r instanceof br)throw new Error("extended point not allowed");const{x:vr,y:Er}=$r||{};if(!ur(vr)||!ur(Er))throw new Error("invalid affine point");return new br(vr,Er,_1n$2,zt(vr*Er))}static normalizeZ($r){const vr=At.invertBatch($r.map(Er=>Er.ez));return $r.map((Er,Tr)=>Er.toAffine(vr[Tr])).map(br.fromAffine)}_setWindowSize($r){this._WINDOW_SIZE=$r,lr.delete(this)}assertValidity(){const{a:$r,d:vr}=e;if(this.is0())throw new Error("bad point: ZERO");const{ex:Er,ey:Tr,ez:Rr,et:Mr}=this,Gr=zt(Er*Er),Br=zt(Tr*Tr),Cr=zt(Rr*Rr),jr=zt(Cr*Cr),Yr=zt(Gr*$r),Qr=zt(Cr*zt(Yr+Br)),Jr=zt(jr+zt(vr*zt(Gr*Br)));if(Qr!==Jr)throw new Error("bad point: equation left != right (1)");const Wr=zt(Er*Tr),Nr=zt(Rr*Mr);if(Wr!==Nr)throw new Error("bad point: equation left != right (2)")}equals($r){yr($r);const{ex:vr,ey:Er,ez:Tr}=this,{ex:Rr,ey:Mr,ez:Gr}=$r,Br=zt(vr*Gr),Cr=zt(Rr*Tr),jr=zt(Er*Gr),Yr=zt(Mr*Tr);return Br===Cr&&jr===Yr}is0(){return this.equals(br.ZERO)}negate(){return new br(zt(-this.ex),this.ey,this.ez,zt(-this.et))}double(){const{a:$r}=e,{ex:vr,ey:Er,ez:Tr}=this,Rr=zt(vr*vr),Mr=zt(Er*Er),Gr=zt(_2n$1*zt(Tr*Tr)),Br=zt($r*Rr),Cr=vr+Er,jr=zt(zt(Cr*Cr)-Rr-Mr),Yr=Br+Mr,Qr=Yr-Gr,Jr=Br-Mr,Wr=zt(jr*Qr),Nr=zt(Yr*Jr),Vr=zt(jr*Jr),Xr=zt(Qr*Yr);return new br(Wr,Nr,Xr,Vr)}add($r){yr($r);const{a:vr,d:Er}=e,{ex:Tr,ey:Rr,ez:Mr,et:Gr}=this,{ex:Br,ey:Cr,ez:jr,et:Yr}=$r;if(vr===BigInt(-1)){const dn=zt((Rr-Tr)*(Cr+Br)),vn=zt((Rr+Tr)*(Cr-Br)),$n=zt(vn-dn);if($n===_0n$1)return this.double();const en=zt(Mr*_2n$1*Yr),tn=zt(Gr*_2n$1*jr),hn=tn+en,mn=vn+dn,yn=tn-en,xn=zt(hn*$n),In=zt(mn*yn),On=zt(hn*yn),Dn=zt($n*mn);return new br(xn,In,Dn,On)}const Qr=zt(Tr*Br),Jr=zt(Rr*Cr),Wr=zt(Gr*Er*Yr),Nr=zt(Mr*jr),Vr=zt((Tr+Rr)*(Br+Cr)-Qr-Jr),Xr=Nr-Wr,qr=Nr+Wr,Or=zt(Jr-vr*Qr),Fr=zt(Vr*Xr),Zr=zt(qr*Or),rn=zt(Vr*Or),un=zt(Xr*qr);return new br(Fr,Zr,un,rn)}subtract($r){return this.add($r.negate())}wNAF($r){return kr.wNAFCached(this,lr,$r,br.normalizeZ)}multiply($r){const{p:vr,f:Er}=this.wNAF(fr($r,kt));return br.normalizeZ([vr,Er])[0]}multiplyUnsafe($r){let vr=pr($r);return vr===_0n$1?Pr:this.equals(Pr)||vr===_1n$2?this:this.equals(Ar)?this.wNAF(vr).p:kr.unsafeLadder(this,vr)}isSmallOrder(){return this.multiplyUnsafe(er).is0()}isTorsionFree(){return kr.unsafeLadder(this,kt).is0()}toAffine($r){const{ex:vr,ey:Er,ez:Tr}=this,Rr=this.is0();$r==null&&($r=Rr?_8n:At.inv(Tr));const Mr=zt(vr*$r),Gr=zt(Er*$r),Br=zt(Tr*$r);if(Rr)return{x:_0n$1,y:_1n$2};if(Br!==_1n$2)throw new Error("invZ was invalid");return{x:Mr,y:Gr}}clearCofactor(){const{h:$r}=e;return $r===_1n$2?this:this.multiplyUnsafe($r)}static fromHex($r,vr=!1){const{d:Er,a:Tr}=e,Rr=At.BYTES;$r=ensureBytes$2("pointHex",$r,Rr);const Mr=$r.slice(),Gr=$r[Rr-1];Mr[Rr-1]=Gr&-129;const Br=bytesToNumberLE(Mr);Br===_0n$1||(vr?fr(Br,tr):fr(Br,At.ORDER));const Cr=zt(Br*Br),jr=zt(Cr-_1n$2),Yr=zt(Er*Cr-Tr);let{isValid:Qr,value:Jr}=rr(jr,Yr);if(!Qr)throw new Error("Point.fromHex: invalid y coordinate");const Wr=(Jr&_1n$2)===_1n$2,Nr=(Gr&128)!==0;if(!vr&&Jr===_0n$1&&Nr)throw new Error("Point.fromHex: x=0 and x_0=1");return Nr!==Wr&&(Jr=zt(-Jr)),br.fromAffine({x:Jr,y:Br})}static fromPrivateKey($r){return Lr($r).point}toRawBytes(){const{x:$r,y:vr}=this.toAffine(),Er=numberToBytesLE(vr,At.BYTES);return Er[Er.length-1]|=$r&_1n$2?128:0,Er}toHex(){return bytesToHex(this.toRawBytes())}}br.BASE=new br(e.Gx,e.Gy,_1n$2,zt(e.Gx*e.Gy)),br.ZERO=new br(_0n$1,_1n$2,_1n$2,_0n$1);const{BASE:Ar,ZERO:Pr}=br,kr=wNAF(br,Lt*8);function Ur(Ir){return mod(Ir,kt)}function Hr(Ir){return Ur(bytesToNumberLE(Ir))}function Lr(Ir){const $r=Lt;Ir=ensureBytes$2("private key",Ir,$r);const vr=ensureBytes$2("hashed private key",Nt(Ir),2*$r),Er=nr(vr.slice(0,$r)),Tr=vr.slice($r,2*$r),Rr=Hr(Er),Mr=Ar.multiply(Rr),Gr=Mr.toRawBytes();return{head:Er,prefix:Tr,scalar:Rr,point:Mr,pointBytes:Gr}}function Sr(Ir){return Lr(Ir).pointBytes}function _r(Ir=new Uint8Array,...$r){const vr=concatBytes(...$r);return Hr(Nt(ir(vr,ensureBytes$2("context",Ir),!!Bt)))}function gr(Ir,$r,vr={}){Ir=ensureBytes$2("message",Ir),Bt&&(Ir=Bt(Ir));const{prefix:Er,scalar:Tr,pointBytes:Rr}=Lr($r),Mr=_r(vr.context,Er,Ir),Gr=Ar.multiply(Mr).toRawBytes(),Br=_r(vr.context,Gr,Rr,Ir),Cr=Ur(Mr+Br*Tr);pr(Cr);const jr=concatBytes(Gr,numberToBytesLE(Cr,At.BYTES));return ensureBytes$2("result",jr,Lt*2)}const wr=VERIFY_DEFAULT;function Dr(Ir,$r,vr,Er=wr){const{context:Tr,zip215:Rr}=Er,Mr=At.BYTES;Ir=ensureBytes$2("signature",Ir,2*Mr),$r=ensureBytes$2("message",$r),Bt&&($r=Bt($r));const Gr=bytesToNumberLE(Ir.slice(Mr,2*Mr));let Br,Cr,jr;try{Br=br.fromHex(vr,Rr),Cr=br.fromHex(Ir.slice(0,Mr),Rr),jr=Ar.multiplyUnsafe(Gr)}catch{return!1}if(!Rr&&Br.isSmallOrder())return!1;const Yr=_r(Tr,Cr.toRawBytes(),Br.toRawBytes(),$r);return Cr.add(Br.multiplyUnsafe(Yr)).subtract(jr).clearCofactor().equals(br.ZERO)}return Ar._setWindowSize(8),{CURVE:e,getPublicKey:Sr,sign:gr,verify:Dr,ExtendedPoint:br,utils:{getExtendedPublicKey:Lr,randomPrivateKey:()=>jt(At.BYTES),precompute(Ir=8,$r=br.BASE){return $r._setWindowSize(Ir),$r.multiply(BigInt(3)),$r}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n=BigInt(0),_1n$1=BigInt(1);function validateOpts(xt){return validateObject(xt,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...xt})}function montgomery(xt){const e=validateOpts(xt),{P:At}=e,kt=lr=>mod(lr,At),Bt=e.montgomeryBits,Nt=Math.ceil(Bt/8),jt=e.nByteLength,Lt=e.adjustScalarBytes||(lr=>lr),er=e.powPminus2||(lr=>pow(lr,At-BigInt(2),At));function tr(lr,yr,br){const Ar=kt(lr*(yr-br));return yr=kt(yr-Ar),br=kt(br+Ar),[yr,br]}function zt(lr){if(typeof lr=="bigint"&&_0n<=lr&&lr<At)return lr;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const rr=(e.a-BigInt(2))/BigInt(4);function nr(lr,yr){const br=zt(lr),Ar=zt(yr),Pr=br;let kr=_1n$1,Ur=_0n,Hr=br,Lr=_1n$1,Sr=_0n,_r;for(let wr=BigInt(Bt-1);wr>=_0n;wr--){const Dr=Ar>>wr&_1n$1;Sr^=Dr,_r=tr(Sr,kr,Hr),kr=_r[0],Hr=_r[1],_r=tr(Sr,Ur,Lr),Ur=_r[0],Lr=_r[1],Sr=Dr;const xr=kr+Ur,Ir=kt(xr*xr),$r=kr-Ur,vr=kt($r*$r),Er=Ir-vr,Tr=Hr+Lr,Rr=Hr-Lr,Mr=kt(Rr*xr),Gr=kt(Tr*$r),Br=Mr+Gr,Cr=Mr-Gr;Hr=kt(Br*Br),Lr=kt(Pr*kt(Cr*Cr)),kr=kt(Ir*vr),Ur=kt(Er*(Ir+kt(rr*Er)))}_r=tr(Sr,kr,Hr),kr=_r[0],Hr=_r[1],_r=tr(Sr,Ur,Lr),Ur=_r[0],Lr=_r[1];const gr=er(Ur);return kt(kr*gr)}function ir(lr){return numberToBytesLE(kt(lr),Nt)}function ar(lr){const yr=ensureBytes$2("u coordinate",lr,Nt);return jt===32&&(yr[31]&=127),bytesToNumberLE(yr)}function dr(lr){const yr=ensureBytes$2("scalar",lr),br=yr.length;if(br!==Nt&&br!==jt)throw new Error(`Expected ${Nt} or ${jt} bytes, got ${br}`);return bytesToNumberLE(Lt(yr))}function ur(lr,yr){const br=ar(yr),Ar=dr(lr),Pr=nr(br,Ar);if(Pr===_0n)throw new Error("Invalid private or public key received");return ir(Pr)}const fr=ir(e.Gu);function pr(lr){return ur(lr,fr)}return{scalarMult:ur,scalarMultBase:pr,getSharedSecret:(lr,yr)=>ur(lr,yr),getPublicKey:lr=>pr(lr),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:fr}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ED25519_P=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),ED25519_SQRT_M1=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const _1n=BigInt(1),_2n=BigInt(2),_5n=BigInt(5),_10n=BigInt(10),_20n=BigInt(20),_40n=BigInt(40),_80n=BigInt(80);function ed25519_pow_2_252_3(xt){const e=ED25519_P,kt=xt*xt%e*xt%e,Bt=pow2(kt,_2n,e)*kt%e,Nt=pow2(Bt,_1n,e)*xt%e,jt=pow2(Nt,_5n,e)*Nt%e,Lt=pow2(jt,_10n,e)*jt%e,er=pow2(Lt,_20n,e)*Lt%e,tr=pow2(er,_40n,e)*er%e,zt=pow2(tr,_80n,e)*tr%e,rr=pow2(zt,_80n,e)*tr%e,nr=pow2(rr,_10n,e)*jt%e;return{pow_p_5_8:pow2(nr,_2n,e)*xt%e,b2:kt}}function adjustScalarBytes(xt){return xt[0]&=248,xt[31]&=127,xt[31]|=64,xt}function uvRatio(xt,e){const At=ED25519_P,kt=mod(e*e*e,At),Bt=mod(kt*kt*e,At),Nt=ed25519_pow_2_252_3(xt*Bt).pow_p_5_8;let jt=mod(xt*kt*Nt,At);const Lt=mod(e*jt*jt,At),er=jt,tr=mod(jt*ED25519_SQRT_M1,At),zt=Lt===xt,rr=Lt===mod(-xt,At),nr=Lt===mod(-xt*ED25519_SQRT_M1,At);return zt&&(jt=er),(rr||nr)&&(jt=tr),isNegativeLE(jt,At)&&(jt=mod(-jt,At)),{isValid:zt||rr,value:jt}}const Fp=Field(ED25519_P,void 0,!0),ed25519Defaults={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:sha512,randomBytes:randomBytes$2,adjustScalarBytes,uvRatio},ed25519=twistedEdwards(ed25519Defaults);function ed25519_domain(xt,e,At){if(e.length>255)throw new Error("Context is too big");return concatBytes$1(utf8ToBytes$2("SigEd25519 no Ed25519 collisions"),new Uint8Array([At?1:0,e.length]),e,xt)}({...ed25519Defaults});({...ed25519Defaults});const x25519=montgomery({P:ED25519_P,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:xt=>{const e=ED25519_P,{pow_p_5_8:At,b2:kt}=ed25519_pow_2_252_3(xt);return mod(pow2(At,BigInt(3),e)*kt,e)},adjustScalarBytes,randomBytes:randomBytes$2});function edwardsToMontgomeryPub(xt){const{y:e}=ed25519.ExtendedPoint.fromHex(xt),At=BigInt(1);return Fp.toBytes(Fp.create((At+e)*Fp.inv(At-e)))}function edwardsToMontgomeryPriv(xt){const e=ed25519Defaults.hash(xt.subarray(0,32));return ed25519Defaults.adjustScalarBytes(e).subarray(0,32)}const ELL2_C1=(Fp.ORDER+BigInt(3))/BigInt(8);Fp.pow(_2n,ELL2_C1);Fp.sqrt(Fp.neg(Fp.ONE));(Fp.ORDER-BigInt(5))/BigInt(8);BigInt(486662);FpSqrtEven(Fp,Fp.neg(BigInt(486664)));BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235");BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578");BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838");BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var __awaiter$2t=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$A=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let Ed25519$2=class rs{static bytesToPrivateKey(e){return __awaiter$2t(this,arguments,void 0,function*({privateKeyBytes:At}){const kt=ed25519.getPublicKey(At),Bt={crv:"Ed25519",d:Convert$2.uint8Array(At).toBase64Url(),kty:"OKP",x:Convert$2.uint8Array(kt).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$2({jwk:Bt}),Bt})}static bytesToPublicKey(e){return __awaiter$2t(this,arguments,void 0,function*({publicKeyBytes:At}){const kt={kty:"OKP",crv:"Ed25519",x:Convert$2.uint8Array(At).toBase64Url()};return kt.kid=yield computeJwkThumbprint$2({jwk:kt}),kt})}static computePublicKey(e){return __awaiter$2t(this,arguments,void 0,function*({key:At}){const kt=yield rs.privateKeyToBytes({privateKey:At}),Bt=ed25519.getPublicKey(kt),Nt={kty:"OKP",crv:"Ed25519",x:Convert$2.uint8Array(Bt).toBase64Url()};return Nt.kid=yield computeJwkThumbprint$2({jwk:Nt}),Nt})}static convertPrivateKeyToX25519(e){return __awaiter$2t(this,arguments,void 0,function*({privateKey:At}){const kt=yield rs.privateKeyToBytes({privateKey:At}),Bt=edwardsToMontgomeryPriv(kt),Nt=x25519.getPublicKey(Bt),jt={kty:"OKP",crv:"X25519",d:Convert$2.uint8Array(Bt).toBase64Url(),x:Convert$2.uint8Array(Nt).toBase64Url()};return jt.kid=yield computeJwkThumbprint$2({jwk:jt}),jt})}static convertPublicKeyToX25519(e){return __awaiter$2t(this,arguments,void 0,function*({publicKey:At}){const kt=yield rs.publicKeyToBytes({publicKey:At});if(!(yield rs.validatePublicKey({publicKeyBytes:kt})))throw new Error("Ed25519: Invalid public key.");const Nt=edwardsToMontgomeryPub(kt),jt={kty:"OKP",crv:"X25519",x:Convert$2.uint8Array(Nt).toBase64Url()};return jt.kid=yield computeJwkThumbprint$2({jwk:jt}),jt})}static generateKey(){return __awaiter$2t(this,void 0,void 0,function*(){const e=ed25519.utils.randomPrivateKey(),At=yield rs.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint$2({jwk:At}),At})}static getPublicKey(e){return __awaiter$2t(this,arguments,void 0,function*({key:At}){var kt;if(!(isOkpPrivateJwk$2(At)&&At.crv==="Ed25519"))throw new Error("Ed25519: The provided key is not an Ed25519 private JWK.");let Bt=__rest$A(At,["d"]);return(kt=Bt.kid)!==null&&kt!==void 0||(Bt.kid=yield computeJwkThumbprint$2({jwk:Bt})),Bt})}static privateKeyToBytes(e){return __awaiter$2t(this,arguments,void 0,function*({privateKey:At}){if(!isOkpPrivateJwk$2(At))throw new Error("Ed25519: The provided key is not a valid OKP private key.");return Convert$2.base64Url(At.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$2t(this,arguments,void 0,function*({publicKey:At}){if(!isOkpPublicJwk$2(At))throw new Error("Ed25519: The provided key is not a valid OKP public key.");return Convert$2.base64Url(At.x).toUint8Array()})}static sign(e){return __awaiter$2t(this,arguments,void 0,function*({key:At,data:kt}){const Bt=yield rs.privateKeyToBytes({privateKey:At});return ed25519.sign(kt,Bt)})}static validatePublicKey(e){return __awaiter$2t(this,arguments,void 0,function*({publicKeyBytes:At}){try{ed25519.ExtendedPoint.fromHex(At).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$2t(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){const Nt=yield rs.publicKeyToBytes({publicKey:At});return ed25519.verify(kt,Bt,Nt)})}};var __awaiter$2s=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let EdDsaAlgorithm$4=class extends CryptoAlgorithm$2{computePublicKey(e){return __awaiter$2s(this,arguments,void 0,function*({key:At}){if(!isOkpPrivateJwk$2(At))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(At.crv){case"Ed25519":{const kt=yield Ed25519$2.computePublicKey({key:At});return kt.alg="EdDSA",kt}default:throw new Error(`Unsupported curve: ${At.crv}`)}})}generateKey(e){return __awaiter$2s(this,arguments,void 0,function*({algorithm:At}){switch(At){case"Ed25519":{const kt=yield Ed25519$2.generateKey();return kt.alg="EdDSA",kt}}})}getPublicKey(e){return __awaiter$2s(this,arguments,void 0,function*({key:At}){if(!isOkpPrivateJwk$2(At))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(At.crv){case"Ed25519":{const kt=yield Ed25519$2.getPublicKey({key:At});return kt.alg="EdDSA",kt}default:throw new Error(`Unsupported curve: ${At.crv}`)}})}sign(e){return __awaiter$2s(this,arguments,void 0,function*({key:At,data:kt}){if(!isOkpPrivateJwk$2(At))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(At.crv){case"Ed25519":return yield Ed25519$2.sign({key:At,data:kt});default:throw new Error(`Unsupported curve: ${At.crv}`)}})}verify(e){return __awaiter$2s(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){if(!isOkpPublicJwk$2(At))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(At.crv){case"Ed25519":return yield Ed25519$2.verify({key:At,signature:kt,data:Bt});default:throw new Error(`Unsupported curve: ${At.crv}`)}})}};var __awaiter$2r=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const supportedAlgorithms$6={Ed25519:{implementation:EdDsaAlgorithm$4,names:["Ed25519"]},secp256k1:{implementation:EcdsaAlgorithm$4,names:["ES256K","secp256k1"]},secp256r1:{implementation:EcdsaAlgorithm$4,names:["ES256","secp256r1"]},"SHA-256":{implementation:Sha2Algorithm$2,names:["SHA-256"]}};let LocalKeyManager$4=class{constructor(e){var At;this._algorithmInstances=new Map,this._keyStore=(At=e==null?void 0:e.keyStore)!==null&&At!==void 0?At:new MemoryStore$2}digest(e){return __awaiter$2r(this,arguments,void 0,function*({algorithm:At,data:kt}){return yield this.getAlgorithm({algorithm:At}).digest({algorithm:At,data:kt})})}exportKey(e){return __awaiter$2r(this,arguments,void 0,function*({keyUri:At}){return yield this.getPrivateKey({keyUri:At})})}generateKey(e){return __awaiter$2r(this,arguments,void 0,function*({algorithm:At}){const Bt=yield this.getAlgorithm({algorithm:At}).generateKey({algorithm:At});if((Bt==null?void 0:Bt.kid)===void 0)throw new Error("Generated key is missing a required property: kid");const Nt=`${KEY_URI_PREFIX_JWK$2}${Bt.kid}`;return yield this._keyStore.set(Nt,Bt),Nt})}getKeyUri(e){return __awaiter$2r(this,arguments,void 0,function*({key:At}){const kt=yield computeJwkThumbprint$2({jwk:At});return`${KEY_URI_PREFIX_JWK$2}${kt}`})}getPublicKey(e){return __awaiter$2r(this,arguments,void 0,function*({keyUri:At}){const kt=yield this.getPrivateKey({keyUri:At}),Bt=this.getAlgorithmName({key:kt});return yield this.getAlgorithm({algorithm:Bt}).getPublicKey({key:kt})})}importKey(e){return __awaiter$2r(this,arguments,void 0,function*({key:At}){var kt;if(!isPrivateJwk$2(At))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const Bt=structuredClone(At);(kt=Bt.kid)!==null&&kt!==void 0||(Bt.kid=yield computeJwkThumbprint$2({jwk:Bt}));const Nt=yield this.getKeyUri({key:Bt});return yield this._keyStore.set(Nt,Bt),Nt})}sign(e){return __awaiter$2r(this,arguments,void 0,function*({keyUri:At,data:kt}){const Bt=yield this.getPrivateKey({keyUri:At}),Nt=this.getAlgorithmName({key:Bt});return this.getAlgorithm({algorithm:Nt}).sign({data:kt,key:Bt})})}verify(e){return __awaiter$2r(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){const Nt=this.getAlgorithmName({key:At});return this.getAlgorithm({algorithm:Nt}).verify({key:At,signature:kt,data:Bt})})}getAlgorithm({algorithm:e}){var At;const kt=(At=supportedAlgorithms$6[e])===null||At===void 0?void 0:At.implementation;if(!kt)throw new Error(`Algorithm not supported: ${e}`);return this._algorithmInstances.has(kt)||this._algorithmInstances.set(kt,new kt),this._algorithmInstances.get(kt)}getAlgorithmName({key:e}){const At=e.alg,kt=e.crv;for(const Bt in supportedAlgorithms$6){const Nt=supportedAlgorithms$6[Bt];if(At&&Nt.names.includes(At))return Bt;if(kt&&Nt.names.includes(kt))return Bt}throw new Error(`Unable to determine algorithm based on provided input: alg=${At}, crv=${kt}`)}getPrivateKey(e){return __awaiter$2r(this,arguments,void 0,function*({keyUri:At}){const kt=yield this._keyStore.get(At);if(!kt)throw new Error(`Key not found: ${At}`);return kt})}};function getJoseSignatureAlgorithmFromPublicKey$2(xt){const e={Ed25519:"EdDSA","P-256":"ES256","P-384":"ES384","P-521":"ES512",secp256k1:"ES256K"};if(xt.alg&&Object.values(e).includes(xt.alg))return xt.alg;if(xt.crv&&Object.keys(e).includes(xt.crv))return e[xt.crv];throw new Error(`Unable to determine algorithm based on provided input: alg=${xt.alg}, crv=${xt.crv}. Supported 'alg' values: ${Object.values(e).join(", ")}. Supported 'crv' values: ${Object.keys(e).join(", ")}.`)}function randomBytes$1(xt){return randomBytes$7(xt)}function randomUuid$1(){return crypto$7.randomUUID()}function randomPin$1({length:xt}){if(3>xt||xt>10)throw new Error("randomPin() can securely generate a PIN between 3 to 10 digits.");const e=Math.pow(10,xt)-1;let At;if(xt<=6){const kt=Math.pow(10,xt);do{const Bt=randomBytes$1(Math.ceil(xt/2));At=new DataView(Bt.buffer).getUint16(0,!1)%kt}while(At>e)}else{const kt=Math.pow(10,10);do{const Bt=randomBytes$1(4);At=new DataView(Bt.buffer).getUint32(0,!1)%kt}while(At>e)}return At.toString().padStart(xt,"0")}const CryptoUtils$1={randomPin:randomPin$1,randomUuid:randomUuid$1,randomBytes:randomBytes$1,getJoseSignatureAlgorithmFromPublicKey:getJoseSignatureAlgorithmFromPublicKey$2};var __awaiter$2q=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$z=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const AES_GCM_IV_LENGTH$1=96,AES_KEY_LENGTHS$3=[128,192,256],AES_GCM_TAG_LENGTHS$1=[96,104,112,120,128];let AesGcm$1=class{static bytesToPrivateKey(e){return __awaiter$2q(this,arguments,void 0,function*({privateKeyBytes:At}){const kt={k:Convert$2.uint8Array(At).toBase64Url(),kty:"oct"};return kt.kid=yield computeJwkThumbprint$2({jwk:kt}),kt})}static decrypt(e){return __awaiter$2q(this,arguments,void 0,function*({key:At,data:kt,iv:Bt,additionalData:Nt,tagLength:jt}){if(Bt.byteLength!==AES_GCM_IV_LENGTH$1/8)throw new TypeError(`The initialization vector must be ${AES_GCM_IV_LENGTH$1} bits in length`);if(jt&&!AES_GCM_TAG_LENGTHS$1.includes(jt))throw new RangeError(`The tag length is invalid: Must be ${AES_GCM_TAG_LENGTHS$1.join(", ")} bits`);const Lt=getWebcryptoSubtle(),er=yield Lt.importKey("jwk",At,{name:"AES-GCM"},!0,["decrypt"]),tr=Object.assign(Object.assign({name:"AES-GCM",iv:Bt},jt&&{tagLength:jt}),Nt&&{additionalData:Nt}),zt=yield Lt.decrypt(tr,er,kt);return new Uint8Array(zt)})}static encrypt(e){return __awaiter$2q(this,arguments,void 0,function*({data:At,iv:kt,key:Bt,additionalData:Nt,tagLength:jt}){if(kt.byteLength!==AES_GCM_IV_LENGTH$1/8)throw new TypeError(`The initialization vector must be ${AES_GCM_IV_LENGTH$1} bits in length`);if(jt&&!AES_GCM_TAG_LENGTHS$1.includes(jt))throw new RangeError(`The tag length is invalid: Must be ${AES_GCM_TAG_LENGTHS$1.join(", ")} bits`);const Lt=getWebcryptoSubtle(),er=yield Lt.importKey("jwk",Bt,{name:"AES-GCM"},!0,["encrypt"]),tr=Object.assign(Object.assign({name:"AES-GCM",iv:kt},jt&&{tagLength:jt}),Nt&&{additionalData:Nt}),zt=yield Lt.encrypt(tr,er,At);return new Uint8Array(zt)})}static generateKey(e){return __awaiter$2q(this,arguments,void 0,function*({length:At}){if(!AES_KEY_LENGTHS$3.includes(At))throw new RangeError(`The key length is invalid: Must be ${AES_KEY_LENGTHS$3.join(", ")} bits`);const kt=getWebcryptoSubtle(),Bt=yield kt.generateKey({name:"AES-GCM",length:At},!0,["encrypt"]),Nt=yield kt.exportKey("jwk",Bt),jt=__rest$z(Nt,["ext","key_ops"]);return jt.kid=yield computeJwkThumbprint$2({jwk:jt}),jt})}static privateKeyToBytes(e){return __awaiter$2q(this,arguments,void 0,function*({privateKey:At}){if(!isOctPrivateJwk$1(At))throw new Error("AesGcm: The provided key is not a valid oct private key.");return Convert$2.base64Url(At.k).toUint8Array()})}};var __awaiter$2p=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let AesGcmAlgorithm$3=class extends CryptoAlgorithm$2{decrypt(e){return __awaiter$2p(this,void 0,void 0,function*(){return AesGcm$1.decrypt(e)})}encrypt(e){return __awaiter$2p(this,void 0,void 0,function*(){return AesGcm$1.encrypt(e)})}generateKey(e){return __awaiter$2p(this,arguments,void 0,function*({algorithm:At}){const kt={A128GCM:128,A192GCM:192,A256GCM:256}[At],Bt=yield AesGcm$1.generateKey({length:kt});return Bt.alg=At,Bt})}};var __awaiter$2o=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$y=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let X25519$2=class Ps{static bytesToPrivateKey(e){return __awaiter$2o(this,arguments,void 0,function*({privateKeyBytes:At}){const kt=x25519.getPublicKey(At),Bt={kty:"OKP",crv:"X25519",d:Convert$2.uint8Array(At).toBase64Url(),x:Convert$2.uint8Array(kt).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$2({jwk:Bt}),Bt})}static bytesToPublicKey(e){return __awaiter$2o(this,arguments,void 0,function*({publicKeyBytes:At}){const kt={kty:"OKP",crv:"X25519",x:Convert$2.uint8Array(At).toBase64Url()};return kt.kid=yield computeJwkThumbprint$2({jwk:kt}),kt})}static computePublicKey(e){return __awaiter$2o(this,arguments,void 0,function*({key:At}){const kt=yield Ps.privateKeyToBytes({privateKey:At}),Bt=x25519.getPublicKey(kt),Nt={kty:"OKP",crv:"X25519",x:Convert$2.uint8Array(Bt).toBase64Url()};return Nt.kid=yield computeJwkThumbprint$2({jwk:Nt}),Nt})}static generateKey(){return __awaiter$2o(this,void 0,void 0,function*(){const e=x25519.utils.randomPrivateKey(),At=yield Ps.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint$2({jwk:At}),At})}static getPublicKey(e){return __awaiter$2o(this,arguments,void 0,function*({key:At}){var kt;if(!(isOkpPrivateJwk$2(At)&&At.crv==="X25519"))throw new Error("X25519: The provided key is not an X25519 private JWK.");let Bt=__rest$y(At,["d"]);return(kt=Bt.kid)!==null&&kt!==void 0||(Bt.kid=yield computeJwkThumbprint$2({jwk:Bt})),Bt})}static privateKeyToBytes(e){return __awaiter$2o(this,arguments,void 0,function*({privateKey:At}){if(!isOkpPrivateJwk$2(At))throw new Error("X25519: The provided key is not a valid OKP private key.");return Convert$2.base64Url(At.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$2o(this,arguments,void 0,function*({publicKey:At}){if(!isOkpPublicJwk$2(At))throw new Error("X25519: The provided key is not a valid OKP public key.");return Convert$2.base64Url(At.x).toUint8Array()})}static sharedSecret(e){return __awaiter$2o(this,arguments,void 0,function*({privateKeyA:At,publicKeyB:kt}){if("x"in At&&"x"in kt&&At.x===kt.x)throw new Error("X25519: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const Bt=yield Ps.privateKeyToBytes({privateKey:At}),Nt=yield Ps.publicKeyToBytes({publicKey:kt});return x25519.getSharedSecret(Bt,Nt)})}};const u8to16$1=(xt,e)=>xt[e++]&255|(xt[e++]&255)<<8;let Poly1305$1=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=toBytes$2(e),bytes$2(e,32);const At=u8to16$1(e,0),kt=u8to16$1(e,2),Bt=u8to16$1(e,4),Nt=u8to16$1(e,6),jt=u8to16$1(e,8),Lt=u8to16$1(e,10),er=u8to16$1(e,12),tr=u8to16$1(e,14);this.r[0]=At&8191,this.r[1]=(At>>>13|kt<<3)&8191,this.r[2]=(kt>>>10|Bt<<6)&7939,this.r[3]=(Bt>>>7|Nt<<9)&8191,this.r[4]=(Nt>>>4|jt<<12)&255,this.r[5]=jt>>>1&8190,this.r[6]=(jt>>>14|Lt<<2)&8191,this.r[7]=(Lt>>>11|er<<5)&8065,this.r[8]=(er>>>8|tr<<8)&8191,this.r[9]=tr>>>5&127;for(let zt=0;zt<8;zt++)this.pad[zt]=u8to16$1(e,16+2*zt)}process(e,At,kt=!1){const Bt=kt?0:2048,{h:Nt,r:jt}=this,Lt=jt[0],er=jt[1],tr=jt[2],zt=jt[3],rr=jt[4],nr=jt[5],ir=jt[6],ar=jt[7],dr=jt[8],ur=jt[9],fr=u8to16$1(e,At+0),pr=u8to16$1(e,At+2),lr=u8to16$1(e,At+4),yr=u8to16$1(e,At+6),br=u8to16$1(e,At+8),Ar=u8to16$1(e,At+10),Pr=u8to16$1(e,At+12),kr=u8to16$1(e,At+14);let Ur=Nt[0]+(fr&8191),Hr=Nt[1]+((fr>>>13|pr<<3)&8191),Lr=Nt[2]+((pr>>>10|lr<<6)&8191),Sr=Nt[3]+((lr>>>7|yr<<9)&8191),_r=Nt[4]+((yr>>>4|br<<12)&8191),gr=Nt[5]+(br>>>1&8191),wr=Nt[6]+((br>>>14|Ar<<2)&8191),Dr=Nt[7]+((Ar>>>11|Pr<<5)&8191),xr=Nt[8]+((Pr>>>8|kr<<8)&8191),Ir=Nt[9]+(kr>>>5|Bt),$r=0,vr=$r+Ur*Lt+Hr*(5*ur)+Lr*(5*dr)+Sr*(5*ar)+_r*(5*ir);$r=vr>>>13,vr&=8191,vr+=gr*(5*nr)+wr*(5*rr)+Dr*(5*zt)+xr*(5*tr)+Ir*(5*er),$r+=vr>>>13,vr&=8191;let Er=$r+Ur*er+Hr*Lt+Lr*(5*ur)+Sr*(5*dr)+_r*(5*ar);$r=Er>>>13,Er&=8191,Er+=gr*(5*ir)+wr*(5*nr)+Dr*(5*rr)+xr*(5*zt)+Ir*(5*tr),$r+=Er>>>13,Er&=8191;let Tr=$r+Ur*tr+Hr*er+Lr*Lt+Sr*(5*ur)+_r*(5*dr);$r=Tr>>>13,Tr&=8191,Tr+=gr*(5*ar)+wr*(5*ir)+Dr*(5*nr)+xr*(5*rr)+Ir*(5*zt),$r+=Tr>>>13,Tr&=8191;let Rr=$r+Ur*zt+Hr*tr+Lr*er+Sr*Lt+_r*(5*ur);$r=Rr>>>13,Rr&=8191,Rr+=gr*(5*dr)+wr*(5*ar)+Dr*(5*ir)+xr*(5*nr)+Ir*(5*rr),$r+=Rr>>>13,Rr&=8191;let Mr=$r+Ur*rr+Hr*zt+Lr*tr+Sr*er+_r*Lt;$r=Mr>>>13,Mr&=8191,Mr+=gr*(5*ur)+wr*(5*dr)+Dr*(5*ar)+xr*(5*ir)+Ir*(5*nr),$r+=Mr>>>13,Mr&=8191;let Gr=$r+Ur*nr+Hr*rr+Lr*zt+Sr*tr+_r*er;$r=Gr>>>13,Gr&=8191,Gr+=gr*Lt+wr*(5*ur)+Dr*(5*dr)+xr*(5*ar)+Ir*(5*ir),$r+=Gr>>>13,Gr&=8191;let Br=$r+Ur*ir+Hr*nr+Lr*rr+Sr*zt+_r*tr;$r=Br>>>13,Br&=8191,Br+=gr*er+wr*Lt+Dr*(5*ur)+xr*(5*dr)+Ir*(5*ar),$r+=Br>>>13,Br&=8191;let Cr=$r+Ur*ar+Hr*ir+Lr*nr+Sr*rr+_r*zt;$r=Cr>>>13,Cr&=8191,Cr+=gr*tr+wr*er+Dr*Lt+xr*(5*ur)+Ir*(5*dr),$r+=Cr>>>13,Cr&=8191;let jr=$r+Ur*dr+Hr*ar+Lr*ir+Sr*nr+_r*rr;$r=jr>>>13,jr&=8191,jr+=gr*zt+wr*tr+Dr*er+xr*Lt+Ir*(5*ur),$r+=jr>>>13,jr&=8191;let Yr=$r+Ur*ur+Hr*dr+Lr*ar+Sr*ir+_r*nr;$r=Yr>>>13,Yr&=8191,Yr+=gr*rr+wr*zt+Dr*tr+xr*er+Ir*Lt,$r+=Yr>>>13,Yr&=8191,$r=($r<<2)+$r|0,$r=$r+vr|0,vr=$r&8191,$r=$r>>>13,Er+=$r,Nt[0]=vr,Nt[1]=Er,Nt[2]=Tr,Nt[3]=Rr,Nt[4]=Mr,Nt[5]=Gr,Nt[6]=Br,Nt[7]=Cr,Nt[8]=jr,Nt[9]=Yr}finalize(){const{h:e,pad:At}=this,kt=new Uint16Array(10);let Bt=e[1]>>>13;e[1]&=8191;for(let Lt=2;Lt<10;Lt++)e[Lt]+=Bt,Bt=e[Lt]>>>13,e[Lt]&=8191;e[0]+=Bt*5,Bt=e[0]>>>13,e[0]&=8191,e[1]+=Bt,Bt=e[1]>>>13,e[1]&=8191,e[2]+=Bt,kt[0]=e[0]+5,Bt=kt[0]>>>13,kt[0]&=8191;for(let Lt=1;Lt<10;Lt++)kt[Lt]=e[Lt]+Bt,Bt=kt[Lt]>>>13,kt[Lt]&=8191;kt[9]-=8192;let Nt=(Bt^1)-1;for(let Lt=0;Lt<10;Lt++)kt[Lt]&=Nt;Nt=~Nt;for(let Lt=0;Lt<10;Lt++)e[Lt]=e[Lt]&Nt|kt[Lt];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let jt=e[0]+At[0];e[0]=jt&65535;for(let Lt=1;Lt<8;Lt++)jt=(e[Lt]+At[Lt]|0)+(jt>>>16)|0,e[Lt]=jt&65535}update(e){exists$2(this);const{buffer:At,blockLen:kt}=this;e=toBytes$2(e);const Bt=e.length;for(let Nt=0;Nt<Bt;){const jt=Math.min(kt-this.pos,Bt-Nt);if(jt===kt){for(;kt<=Bt-Nt;Nt+=kt)this.process(e,Nt);continue}At.set(e.subarray(Nt,Nt+jt),this.pos),this.pos+=jt,Nt+=jt,this.pos===kt&&(this.process(At,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){exists$2(this),output$2(e,this),this.finished=!0;const{buffer:At,h:kt}=this;let{pos:Bt}=this;if(Bt){for(At[Bt++]=1;Bt<16;Bt++)At[Bt]=0;this.process(At,0,!0)}this.finalize();let Nt=0;for(let jt=0;jt<8;jt++)e[Nt++]=kt[jt]>>>0,e[Nt++]=kt[jt]>>>8;return e}digest(){const{buffer:e,outputLen:At}=this;this.digestInto(e);const kt=e.slice(0,At);return this.destroy(),kt}};function wrapConstructorWithKey$1(xt){const e=(kt,Bt)=>xt(Bt).update(toBytes$2(kt)).digest(),At=xt(new Uint8Array(32));return e.outputLen=At.outputLen,e.blockLen=At.blockLen,e.create=kt=>xt(kt),e}const poly1305=wrapConstructorWithKey$1(xt=>new Poly1305$1(xt)),_utf8ToBytes=xt=>Uint8Array.from(xt.split("").map(e=>e.charCodeAt(0))),sigma16$1=_utf8ToBytes("expand 16-byte k"),sigma32$1=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32$1(sigma16$1),sigma32_32=u32$1(sigma32$1);sigma32_32.slice();function rotl$1(xt,e){return xt<<e|xt>>>32-e}function isAligned32(xt){return xt.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(xt,e,At,kt,Bt,Nt,jt,Lt){const er=Bt.length,tr=new Uint8Array(BLOCK_LEN),zt=u32$1(tr),rr=isAligned32(Bt)&&isAligned32(Nt),nr=rr?u32$1(Bt):U32_EMPTY,ir=rr?u32$1(Nt):U32_EMPTY;for(let ar=0;ar<er;jt++){if(xt(e,At,kt,zt,jt,Lt),jt>=MAX_COUNTER)throw new Error("arx: counter overflow");const dr=Math.min(BLOCK_LEN,er-ar);if(rr&&dr===BLOCK_LEN){const ur=ar/4;if(ar%4!==0)throw new Error("arx: invalid block position");for(let fr=0,pr;fr<BLOCK_LEN32;fr++)pr=ur+fr,ir[pr]=nr[pr]^zt[fr];ar+=BLOCK_LEN;continue}for(let ur=0,fr;ur<dr;ur++)fr=ar+ur,Nt[fr]=Bt[fr]^tr[ur];ar+=dr}}function createCipher(xt,e){const{allowShortKeys:At,extendNonceFn:kt,counterLength:Bt,counterRight:Nt,rounds:jt}=checkOpts$1({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof xt!="function")throw new Error("core must be a function");return number$1(Bt),number$1(jt),bool(Nt),bool(At),(Lt,er,tr,zt,rr=0)=>{bytes$2(Lt),bytes$2(er),bytes$2(tr);const nr=tr.length;if(zt||(zt=new Uint8Array(nr)),bytes$2(zt),number$1(rr),rr<0||rr>=MAX_COUNTER)throw new Error("arx: counter overflow");if(zt.length<nr)throw new Error(`arx: output (${zt.length}) is shorter than data (${nr})`);const ir=[];let ar=Lt.length,dr,ur;if(ar===32)dr=Lt.slice(),ir.push(dr),ur=sigma32_32;else if(ar===16&&At)dr=new Uint8Array(32),dr.set(Lt),dr.set(Lt,16),ur=sigma16_32,ir.push(dr);else throw new Error(`arx: invalid 32-byte key, got length=${ar}`);isAligned32(er)||(er=er.slice(),ir.push(er));const fr=u32$1(dr);if(kt){if(er.length!==24)throw new Error("arx: extended nonce must be 24 bytes");kt(ur,fr,u32$1(er.subarray(0,16)),fr),er=er.subarray(16)}const pr=16-Bt;if(pr!==er.length)throw new Error(`arx: nonce must be ${pr} or 16 bytes`);if(pr!==12){const yr=new Uint8Array(12);yr.set(er,Nt?0:12-er.length),er=yr,ir.push(er)}const lr=u32$1(er);for(runCipher(xt,ur,fr,lr,tr,zt,rr,jt);ir.length>0;)ir.pop().fill(0);return zt}}function chachaCore(xt,e,At,kt,Bt,Nt=20){let jt=xt[0],Lt=xt[1],er=xt[2],tr=xt[3],zt=e[0],rr=e[1],nr=e[2],ir=e[3],ar=e[4],dr=e[5],ur=e[6],fr=e[7],pr=Bt,lr=At[0],yr=At[1],br=At[2],Ar=jt,Pr=Lt,kr=er,Ur=tr,Hr=zt,Lr=rr,Sr=nr,_r=ir,gr=ar,wr=dr,Dr=ur,xr=fr,Ir=pr,$r=lr,vr=yr,Er=br;for(let Rr=0;Rr<Nt;Rr+=2)Ar=Ar+Hr|0,Ir=rotl$1(Ir^Ar,16),gr=gr+Ir|0,Hr=rotl$1(Hr^gr,12),Ar=Ar+Hr|0,Ir=rotl$1(Ir^Ar,8),gr=gr+Ir|0,Hr=rotl$1(Hr^gr,7),Pr=Pr+Lr|0,$r=rotl$1($r^Pr,16),wr=wr+$r|0,Lr=rotl$1(Lr^wr,12),Pr=Pr+Lr|0,$r=rotl$1($r^Pr,8),wr=wr+$r|0,Lr=rotl$1(Lr^wr,7),kr=kr+Sr|0,vr=rotl$1(vr^kr,16),Dr=Dr+vr|0,Sr=rotl$1(Sr^Dr,12),kr=kr+Sr|0,vr=rotl$1(vr^kr,8),Dr=Dr+vr|0,Sr=rotl$1(Sr^Dr,7),Ur=Ur+_r|0,Er=rotl$1(Er^Ur,16),xr=xr+Er|0,_r=rotl$1(_r^xr,12),Ur=Ur+_r|0,Er=rotl$1(Er^Ur,8),xr=xr+Er|0,_r=rotl$1(_r^xr,7),Ar=Ar+Lr|0,Er=rotl$1(Er^Ar,16),Dr=Dr+Er|0,Lr=rotl$1(Lr^Dr,12),Ar=Ar+Lr|0,Er=rotl$1(Er^Ar,8),Dr=Dr+Er|0,Lr=rotl$1(Lr^Dr,7),Pr=Pr+Sr|0,Ir=rotl$1(Ir^Pr,16),xr=xr+Ir|0,Sr=rotl$1(Sr^xr,12),Pr=Pr+Sr|0,Ir=rotl$1(Ir^Pr,8),xr=xr+Ir|0,Sr=rotl$1(Sr^xr,7),kr=kr+_r|0,$r=rotl$1($r^kr,16),gr=gr+$r|0,_r=rotl$1(_r^gr,12),kr=kr+_r|0,$r=rotl$1($r^kr,8),gr=gr+$r|0,_r=rotl$1(_r^gr,7),Ur=Ur+Hr|0,vr=rotl$1(vr^Ur,16),wr=wr+vr|0,Hr=rotl$1(Hr^wr,12),Ur=Ur+Hr|0,vr=rotl$1(vr^Ur,8),wr=wr+vr|0,Hr=rotl$1(Hr^wr,7);let Tr=0;kt[Tr++]=jt+Ar|0,kt[Tr++]=Lt+Pr|0,kt[Tr++]=er+kr|0,kt[Tr++]=tr+Ur|0,kt[Tr++]=zt+Hr|0,kt[Tr++]=rr+Lr|0,kt[Tr++]=nr+Sr|0,kt[Tr++]=ir+_r|0,kt[Tr++]=ar+gr|0,kt[Tr++]=dr+wr|0,kt[Tr++]=ur+Dr|0,kt[Tr++]=fr+xr|0,kt[Tr++]=pr+Ir|0,kt[Tr++]=lr+$r|0,kt[Tr++]=yr+vr|0,kt[Tr++]=br+Er|0}function hchacha(xt,e,At,kt){let Bt=xt[0],Nt=xt[1],jt=xt[2],Lt=xt[3],er=e[0],tr=e[1],zt=e[2],rr=e[3],nr=e[4],ir=e[5],ar=e[6],dr=e[7],ur=At[0],fr=At[1],pr=At[2],lr=At[3];for(let br=0;br<20;br+=2)Bt=Bt+er|0,ur=rotl$1(ur^Bt,16),nr=nr+ur|0,er=rotl$1(er^nr,12),Bt=Bt+er|0,ur=rotl$1(ur^Bt,8),nr=nr+ur|0,er=rotl$1(er^nr,7),Nt=Nt+tr|0,fr=rotl$1(fr^Nt,16),ir=ir+fr|0,tr=rotl$1(tr^ir,12),Nt=Nt+tr|0,fr=rotl$1(fr^Nt,8),ir=ir+fr|0,tr=rotl$1(tr^ir,7),jt=jt+zt|0,pr=rotl$1(pr^jt,16),ar=ar+pr|0,zt=rotl$1(zt^ar,12),jt=jt+zt|0,pr=rotl$1(pr^jt,8),ar=ar+pr|0,zt=rotl$1(zt^ar,7),Lt=Lt+rr|0,lr=rotl$1(lr^Lt,16),dr=dr+lr|0,rr=rotl$1(rr^dr,12),Lt=Lt+rr|0,lr=rotl$1(lr^Lt,8),dr=dr+lr|0,rr=rotl$1(rr^dr,7),Bt=Bt+tr|0,lr=rotl$1(lr^Bt,16),ar=ar+lr|0,tr=rotl$1(tr^ar,12),Bt=Bt+tr|0,lr=rotl$1(lr^Bt,8),ar=ar+lr|0,tr=rotl$1(tr^ar,7),Nt=Nt+zt|0,ur=rotl$1(ur^Nt,16),dr=dr+ur|0,zt=rotl$1(zt^dr,12),Nt=Nt+zt|0,ur=rotl$1(ur^Nt,8),dr=dr+ur|0,zt=rotl$1(zt^dr,7),jt=jt+rr|0,fr=rotl$1(fr^jt,16),nr=nr+fr|0,rr=rotl$1(rr^nr,12),jt=jt+rr|0,fr=rotl$1(fr^jt,8),nr=nr+fr|0,rr=rotl$1(rr^nr,7),Lt=Lt+er|0,pr=rotl$1(pr^Lt,16),ir=ir+pr|0,er=rotl$1(er^ir,12),Lt=Lt+er|0,pr=rotl$1(pr^Lt,8),ir=ir+pr|0,er=rotl$1(er^ir,7);let yr=0;kt[yr++]=Bt,kt[yr++]=Nt,kt[yr++]=jt,kt[yr++]=Lt,kt[yr++]=ur,kt[yr++]=fr,kt[yr++]=pr,kt[yr++]=lr}const xchacha20=createCipher(chachaCore,{counterRight:!1,counterLength:8,extendNonceFn:hchacha,allowShortKeys:!1}),ZEROS16=new Uint8Array(16),updatePadded=(xt,e)=>{xt.update(e);const At=e.length%16;At&&xt.update(ZEROS16.subarray(At))},ZEROS32=new Uint8Array(32);function computeTag(xt,e,At,kt,Bt){const Nt=xt(e,At,ZEROS32),jt=poly1305.create(Nt);Bt&&updatePadded(jt,Bt),updatePadded(jt,kt);const Lt=new Uint8Array(16),er=createView$1(Lt);setBigUint64$1(er,0,BigInt(Bt?Bt.length:0),!0),setBigUint64$1(er,8,BigInt(kt.length),!0),jt.update(Lt);const tr=jt.digest();return Nt.fill(0),tr}const _poly1305_aead=xt=>(e,At,kt)=>(bytes$2(e,32),bytes$2(At),{encrypt:(Nt,jt)=>{const Lt=Nt.length,er=Lt+16;jt?bytes$2(jt,er):jt=new Uint8Array(er),xt(e,At,Nt,jt,1);const tr=computeTag(xt,e,At,jt.subarray(0,-16),kt);return jt.set(tr,Lt),jt},decrypt:(Nt,jt)=>{const Lt=Nt.length,er=Lt-16;if(Lt<16)throw new Error("encrypted data must be at least 16 bytes");jt?bytes$2(jt,er):jt=new Uint8Array(er);const tr=Nt.subarray(0,-16),zt=Nt.subarray(-16),rr=computeTag(xt,e,At,tr,kt);if(!equalBytes$1(zt,rr))throw new Error("invalid tag");return xt(e,At,tr,jt,1),jt}}),xchacha20poly1305=wrapCipher({blockSize:64,nonceLength:24,tagLength:16},_poly1305_aead(xchacha20));function isArrayBufferSlice$1(xt){return xt.byteOffset!==0||xt.byteLength!==xt.buffer.byteLength}function isAsyncIterable$6(xt){return typeof xt!="object"||xt===null?!1:typeof xt[Symbol.asyncIterator]=="function"}function universalTypeOf$1(xt){const At=Object.prototype.toString.call(xt).match(/\s([a-zA-Z0-9]+)/),[kt,Bt]=At;return Bt}var __awaiter$2n=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues$8=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}};const textEncoder$1=new TextEncoder,textDecoder$1=new TextDecoder;let Convert$1=class Do{constructor(e,At){this.data=e,this.format=At}static arrayBuffer(e){return new Do(e,"ArrayBuffer")}static asyncIterable(e){if(!isAsyncIterable$6(e))throw new TypeError("Input must be of type AsyncIterable.");return new Do(e,"AsyncIterable")}static base32Z(e){return new Do(e,"Base32Z")}static base58Btc(e){return new Do(e,"Base58Btc")}static base64Url(e){return new Do(e,"Base64Url")}static bufferSource(e){return new Do(e,"BufferSource")}static hex(e){if(typeof e!="string")throw new TypeError("Hex input must be a string.");if(e.length%2!==0)throw new TypeError("Hex input must have an even number of characters.");return new Do(e,"Hex")}static multibase(e){return new Do(e,"Multibase")}static object(e){return new Do(e,"Object")}static string(e){return new Do(e,"String")}static uint8Array(e){return new Do(e,"Uint8Array")}toArrayBuffer(){switch(this.format){case"Base58Btc":return base58btc$1.baseDecode(this.data).buffer;case"Base64Url":return base64url$3.baseDecode(this.data).buffer;case"BufferSource":{if(universalTypeOf$1(this.data)==="ArrayBuffer")return this.data;if(ArrayBuffer.isView(this.data))return isArrayBufferSlice$1(this.data)?this.data.buffer.slice(this.data.byteOffset,this.data.byteOffset+this.data.byteLength):this.data.buffer;throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":return this.toUint8Array().buffer;case"String":return this.toUint8Array().buffer;case"Uint8Array":return this.data.buffer;default:throw new TypeError(`Conversion from ${this.format} to ArrayBuffer is not supported.`)}}toArrayBufferAsync(){return __awaiter$2n(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":return yield(yield this.toBlobAsync()).arrayBuffer();default:throw new TypeError(`Asynchronous conversion from ${this.format} to ArrayBuffer is not supported.`)}})}toBase32Z(){switch(this.format){case"Uint8Array":return base32z$1.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Z is not supported.`)}}toBase58Btc(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return base58btc$1.baseEncode(e)}case"Multibase":return this.data.substring(1);case"Uint8Array":return base58btc$1.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base58Btc is not supported.`)}}toBase64Url(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return base64url$3.baseEncode(e)}case"BufferSource":{const e=this.toUint8Array();return base64url$3.baseEncode(e)}case"Object":{const e=JSON.stringify(this.data),At=textEncoder$1.encode(e);return base64url$3.baseEncode(At)}case"String":{const e=textEncoder$1.encode(this.data);return base64url$3.baseEncode(e)}case"Uint8Array":return base64url$3.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Url is not supported.`)}}toBlobAsync(){var e,At,kt,Bt;return __awaiter$2n(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const er=[];try{for(var Nt=!0,jt=__asyncValues$8(this.data),Lt;Lt=yield jt.next(),e=Lt.done,!e;Nt=!0){Bt=Lt.value,Nt=!1;const zt=Bt;er.push(zt)}}catch(zt){At={error:zt}}finally{try{!Nt&&!e&&(kt=jt.return)&&(yield kt.call(jt))}finally{if(At)throw At.error}}return new Blob(er)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Blob is not supported.`)}})}toHex(){const e=Array.from({length:256},(At,kt)=>kt.toString(16).padStart(2,"0"));switch(this.format){case"ArrayBuffer":{const At=this.toUint8Array();return Do.uint8Array(At).toHex()}case"Base64Url":{const At=this.toUint8Array();return Do.uint8Array(At).toHex()}case"Uint8Array":{let At="";for(let kt=0;kt<this.data.length;kt++)At+=e[this.data[kt]];return At}default:throw new TypeError(`Conversion from ${this.format} to Hex is not supported.`)}}toMultibase(){switch(this.format){case"Base58Btc":return`z${this.data}`;default:throw new TypeError(`Conversion from ${this.format} to Multibase is not supported.`)}}toObject(){switch(this.format){case"Base64Url":{const e=base64url$3.baseDecode(this.data),At=textDecoder$1.decode(e);return JSON.parse(At)}case"String":return JSON.parse(this.data);case"Uint8Array":{const e=textDecoder$1.decode(this.data);return JSON.parse(e)}default:throw new TypeError(`Conversion from ${this.format} to Object is not supported.`)}}toObjectAsync(){return __awaiter$2n(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toStringAsync();return JSON.parse(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Object is not supported.`)}})}toString(){switch(this.format){case"ArrayBuffer":return textDecoder$1.decode(this.data);case"Base64Url":{const e=base64url$3.baseDecode(this.data);return textDecoder$1.decode(e)}case"Object":return JSON.stringify(this.data);case"Uint8Array":return textDecoder$1.decode(this.data);default:throw new TypeError(`Conversion from ${this.format} to String is not supported.`)}}toStringAsync(){var e,At,kt,Bt;return __awaiter$2n(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{let er="";try{for(var Nt=!0,jt=__asyncValues$8(this.data),Lt;Lt=yield jt.next(),e=Lt.done,!e;Nt=!0){Bt=Lt.value,Nt=!1;const tr=Bt;typeof tr=="string"?er+=tr:er+=textDecoder$1.decode(tr,{stream:!0})}}catch(tr){At={error:tr}}finally{try{!Nt&&!e&&(kt=jt.return)&&(yield kt.call(jt))}finally{if(At)throw At.error}}return er+=textDecoder$1.decode(void 0,{stream:!1}),er}default:throw new TypeError(`Asynchronous conversion from ${this.format} to String is not supported.`)}})}toUint8Array(){switch(this.format){case"ArrayBuffer":return new Uint8Array(this.data);case"Base32Z":return base32z$1.baseDecode(this.data);case"Base58Btc":return base58btc$1.baseDecode(this.data);case"Base64Url":return base64url$3.baseDecode(this.data);case"BufferSource":{const e=universalTypeOf$1(this.data);if(e==="Uint8Array")return this.data;if(e==="ArrayBuffer")return new Uint8Array(this.data);if(ArrayBuffer.isView(this.data))return new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength);throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":{const e=new Uint8Array(this.data.length/2);for(let At=0;At<this.data.length;At+=2){const kt=parseInt(this.data.substring(At,At+2),16);if(isNaN(kt))throw new TypeError("Input is not a valid hexadecimal string.");e[At/2]=kt}return e}case"Object":{const e=JSON.stringify(this.data);return textEncoder$1.encode(e)}case"String":return textEncoder$1.encode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Uint8Array is not supported.`)}}toUint8ArrayAsync(){return __awaiter$2n(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toArrayBufferAsync();return new Uint8Array(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Uint8Array is not supported.`)}})}},Multicodec$1=class ns{static addPrefix(e){var At;let{code:kt,data:Bt,name:Nt}=e;if(!(Nt?!kt:kt))throw new Error("Either 'name' or 'code' must be defined, but not both.");if(kt=ns.codeToName.has(kt)?kt:ns.nameToCode.get(Nt),kt===void 0)throw new Error(`Unsupported multicodec: ${(At=e.name)!==null&&At!==void 0?At:e.code}`);const jt=encodingLength$8(kt),Lt=new Uint8Array(jt+Bt.byteLength);return Lt.set(Bt,jt),encodeTo$3(kt,Lt),Lt}static getCodeFromData(e){const{prefixedData:At}=e,[kt,Bt]=decode$n(At);return kt}static getCodeFromName(e){const{name:At}=e,kt=ns.nameToCode.get(At);if(kt===void 0)throw new Error(`Unsupported multicodec: ${At}`);return kt}static getNameFromCode(e){const{code:At}=e,kt=ns.codeToName.get(At);if(kt===void 0)throw new Error(`Unsupported multicodec: ${At}`);return kt}static registerCodec(e){ns.codeToName.set(e.code,e.name),ns.nameToCode.set(e.name,e.code)}static removePrefix(e){const{prefixedData:At}=e,[kt,Bt]=decode$n(At),Nt=ns.codeToName.get(kt);if(Nt===void 0)throw new Error(`Unsupported multicodec: ${kt}`);return{code:kt,data:At.slice(Bt),name:Nt}}};Multicodec$1.codeToName=new Map;Multicodec$1.nameToCode=new Map;Multicodec$1.registerCodec({code:237,name:"ed25519-pub"});Multicodec$1.registerCodec({code:4864,name:"ed25519-priv"});Multicodec$1.registerCodec({code:236,name:"x25519-pub"});Multicodec$1.registerCodec({code:4866,name:"x25519-priv"});Multicodec$1.registerCodec({code:231,name:"secp256k1-pub"});Multicodec$1.registerCodec({code:4865,name:"secp256k1-priv"});function removeUndefinedProperties$1(xt){Object.keys(xt).forEach(e=>{xt[e]===void 0?delete xt[e]:typeof xt[e]=="object"&&removeUndefinedProperties$1(xt[e])})}var Level=browserLevel.BrowserLevel,__awaiter$2m=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let LevelStore$1=class{constructor({db:e,location:At="DATASTORE"}={}){this.store=e??new Level(At)}clear(){return __awaiter$2m(this,void 0,void 0,function*(){yield this.store.clear()})}close(){return __awaiter$2m(this,void 0,void 0,function*(){yield this.store.close()})}delete(e){return __awaiter$2m(this,void 0,void 0,function*(){yield this.store.del(e)})}get(e){return __awaiter$2m(this,void 0,void 0,function*(){try{return yield this.store.get(e)}catch(At){if(At.notFound)return;throw At}})}set(e,At){return __awaiter$2m(this,void 0,void 0,function*(){yield this.store.put(e,At)})}},MemoryStore$1=class{constructor(){this.store=new Map}clear(){return __awaiter$2m(this,void 0,void 0,function*(){this.store.clear()})}close(){return __awaiter$2m(this,void 0,void 0,function*(){})}delete(e){return __awaiter$2m(this,void 0,void 0,function*(){return this.store.delete(e)})}get(e){return __awaiter$2m(this,void 0,void 0,function*(){return this.store.get(e)})}has(e){return __awaiter$2m(this,void 0,void 0,function*(){return this.store.has(e)})}list(){return __awaiter$2m(this,void 0,void 0,function*(){return Array.from(this.store.values())})}set(e,At){return __awaiter$2m(this,void 0,void 0,function*(){this.store.set(e,At)})}};var __awaiter$2l=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__await$4=function(xt){return this instanceof __await$4?(this.v=xt,this):new __await$4(xt)},__asyncGenerator$4=function(xt,e,At){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var kt=At.apply(xt,e||[]),Bt,Nt=[];return Bt={},jt("next"),jt("throw"),jt("return"),Bt[Symbol.asyncIterator]=function(){return this},Bt;function jt(nr){kt[nr]&&(Bt[nr]=function(ir){return new Promise(function(ar,dr){Nt.push([nr,ir,ar,dr])>1||Lt(nr,ir)})})}function Lt(nr,ir){try{er(kt[nr](ir))}catch(ar){rr(Nt[0][3],ar)}}function er(nr){nr.value instanceof __await$4?Promise.resolve(nr.value.v).then(tr,zt):rr(Nt[0][2],nr)}function tr(nr){Lt("next",nr)}function zt(nr){Lt("throw",nr)}function rr(nr,ir){nr(ir),Nt.shift(),Nt.length&&Lt(Nt[0][0],Nt[0][1])}};let Stream$1=class Fo{static asAsyncIterator(e){return __asyncGenerator$4(this,arguments,function*(){const kt=e.getReader();try{for(;;){const{done:Bt,value:Nt}=yield __await$4(kt.read());if(Bt)break;yield yield __await$4(Nt)}}finally{kt.releaseLock()}})}static consumeToArrayBuffer({readableStream:e}){return __awaiter$2l(this,void 0,void 0,function*(){const At=Fo.asAsyncIterator(e);return yield Convert$1.asyncIterable(At).toArrayBufferAsync()})}static consumeToBlob({readableStream:e}){return __awaiter$2l(this,void 0,void 0,function*(){const At=Fo.asAsyncIterator(e);return yield Convert$1.asyncIterable(At).toBlobAsync()})}static consumeToBytes({readableStream:e}){return __awaiter$2l(this,void 0,void 0,function*(){const At=Fo.asAsyncIterator(e);return yield Convert$1.asyncIterable(At).toUint8ArrayAsync()})}static consumeToJson({readableStream:e}){return __awaiter$2l(this,void 0,void 0,function*(){const At=Fo.asAsyncIterator(e);return yield Convert$1.asyncIterable(At).toObjectAsync()})}static consumeToText({readableStream:e}){return __awaiter$2l(this,void 0,void 0,function*(){const At=Fo.asAsyncIterator(e);return yield Convert$1.asyncIterable(At).toStringAsync()})}static generateByteStream({streamLength:e,chunkLength:At,fillValue:kt}){let Bt=e??1/0,Nt;function jt(){const Lt=Math.min(Bt,At??1/0);Bt-=Lt;let er;if(typeof kt=="number")er=new Uint8Array(Lt).fill(kt);else if(Array.isArray(kt)){er=new Uint8Array(Lt);const[tr,zt]=kt,rr=zt-tr+1;for(let nr=0;nr<Lt;nr++)er[nr]=Math.floor(Math.random()*rr)+tr}else er=new Uint8Array(Lt);Nt.enqueue(er),Bt<=0&&Nt.close()}return new ReadableStream({start(Lt){Nt=Lt,jt()},pull(){jt()}})}static isReadable({readableStream:e}){if(!Fo.isReadableStream(e)||e.locked)return!1;try{return e.getReader().releaseLock(),!0}catch{return!1}}static isReadableStream(e){return typeof e=="object"&&e!==null&&"getReader"in e&&typeof e.getReader=="function"}static isStream(e){return Fo.isReadableStream(e)||Fo.isWritableStream(e)||Fo.isTransformStream(e)}static isTransformStream(e){return typeof e=="object"&&e!==null&&"readable"in e&&typeof e.readable=="object"&&"writable"in e&&typeof e.writable=="object"}static isWritableStream(e){return typeof e=="object"&&e!==null&&"getWriter"in e&&typeof e.getWriter=="function"&&"abort"in e&&typeof e.abort=="function"}};var __awaiter$2k=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let NodeStream$1=class Rs{static consumeToArrayBuffer({readable:e}){return __awaiter$2k(this,void 0,void 0,function*(){return yield Convert$1.asyncIterable(e).toArrayBufferAsync()})}static consumeToBlob({readable:e}){return __awaiter$2k(this,void 0,void 0,function*(){return yield Convert$1.asyncIterable(e).toBlobAsync()})}static consumeToBytes({readable:e}){return __awaiter$2k(this,void 0,void 0,function*(){return yield Convert$1.asyncIterable(e).toUint8ArrayAsync()})}static consumeToJson({readable:e}){return __awaiter$2k(this,void 0,void 0,function*(){return yield Convert$1.asyncIterable(e).toObjectAsync()})}static consumeToText({readable:e}){return __awaiter$2k(this,void 0,void 0,function*(){return yield Convert$1.asyncIterable(e).toStringAsync()})}static fromWebReadable({readableStream:e,readableOptions:At}){if(!Stream$1.isReadableStream(e))throw new TypeError("NodeStream.fromWebReadable: 'readableStream' is not a Web ReadableStream.");const kt=e.getReader();let Bt=!1;const Nt=new browserExports.Readable(Object.assign(Object.assign({},At),{read:function(){kt.read().then(({done:jt,value:Lt})=>{if(jt)this.push(null);else if(!this.push(Lt))return}).catch(jt=>{this.destroy(jt)})},destroy:function(jt,Lt){function er(){Lt(jt)}if(!Bt){kt.cancel(jt).then(er).catch(er);return}er()}}));return kt.closed.then(()=>{Bt=!0}).catch(jt=>{Bt=!0,Nt.destroy(jt)}),Nt}static isDestroyed({stream:e}){if(!Rs.isStream(e))throw new TypeError("NodeStream.isDestroyed: 'stream' is not a Node stream.");const At="_writableState"in e?e._writableState:void 0,kt=e._readableState,Bt=At||kt;return!!(e.destroyed||Bt.destroyed)}static isReadable({readable:e}){return Rs.isReadableStream(e)?e.readable&&typeof e._readableState.ended=="boolean"&&!e._readableState.ended&&typeof e._readableState.endEmitted=="boolean"&&!e._readableState.endEmitted&&!e.destroyed&&!e.isPaused():!1}static isReadableStream(e){return typeof e=="object"&&e!==null&&"pipe"in e&&typeof e.pipe=="function"&&"on"in e&&typeof e.on=="function"&&!("_writableState"in e)&&"_readableState"in e}static isStream(e){return typeof e=="object"&&e!==null&&("_readableState"in e||"_writableState"in e)}static toWebReadable({readable:e}){if(!Rs.isReadableStream(e))throw new TypeError("NodeStream.toWebReadable: 'readable' is not a Node Readable stream.");if(Rs.isDestroyed({stream:e})){const At=new ReadableStream;return At.cancel(),At}return new ReadableStream({start(At){e.on("data",kt=>{At.enqueue(kt)}),e.on("end",()=>{At.close()}),e.on("error",kt=>{At.error(kt)})},cancel(){e.destroy()}})}};function extractDidFragment$2(xt){if(typeof xt=="string"&&xt.length!==0)return xt.split("#").pop()}function getVerificationMethods$2({didDocument:xt}){var e,At;if(!xt)throw new TypeError("Required parameter missing: 'didDocument'");const kt=[];return kt.push(...(At=(e=xt.verificationMethod)===null||e===void 0?void 0:e.filter(isDidVerificationMethod$2))!==null&&At!==void 0?At:[]),Object.keys(DidVerificationRelationship$2).forEach(Bt=>{var Nt,jt;kt.push(...(jt=(Nt=xt[Bt])===null||Nt===void 0?void 0:Nt.filter(isDidVerificationMethod$2))!==null&&jt!==void 0?jt:[])}),kt}function getVerificationMethodTypes$2({didDocument:xt}){const At=getVerificationMethods$2({didDocument:xt}).map(kt=>kt.type);return[...new Set(At)]}function getVerificationRelationshipsById$2({didDocument:xt,methodId:e}){const At=[];return Object.keys(DidVerificationRelationship$2).forEach(kt=>{if(Array.isArray(xt[kt])){const Bt=xt[kt],Nt=extractDidFragment$2(e);Bt.some(Lt=>{const er=extractDidFragment$2(Lt)===Nt,tr=isDidVerificationMethod$2(Lt)&&extractDidFragment$2(Lt.id)===Nt;return er||tr})&&At.push(kt)}}),At}function isDidService$1(xt){return!xt||typeof xt!="object"||xt===null?!1:"id"in xt&&"type"in xt&&"serviceEndpoint"in xt}function isDwnDidService$1(xt){if(!isDidService$1(xt)||xt.type!=="DecentralizedWebNode"||!("enc"in xt&&"sig"in xt))return!1;const e=At=>typeof At=="string"||Array.isArray(At)&&At.every(kt=>typeof kt=="string");return e(xt.enc)&&e(xt.sig)}function isDidVerificationMethod$2(xt){return!(!xt||typeof xt!="object"||xt===null||!("id"in xt&&"type"in xt&&"controller"in xt)||typeof xt.id!="string"||typeof xt.type!="string"||typeof xt.controller!="string")}function keyBytesToMultibaseId$2({keyBytes:xt,multicodecCode:e,multicodecName:At}){const kt=Multicodec$1.addPrefix({code:e,data:xt,name:At}),Bt=Convert$1.uint8Array(kt).toBase58Btc();return Convert$1.base58Btc(Bt).toMultibase()}function multibaseIdToKeyBytes$2({multibaseKeyId:xt}){try{const e=Convert$1.multibase(xt).toBase58Btc(),At=Convert$1.base58Btc(e).toUint8Array(),{code:kt,data:Bt,name:Nt}=Multicodec$1.removePrefix({prefixedData:At});return{keyBytes:Bt,multicodecCode:kt,multicodecName:Nt}}catch{throw new DidError$2(DidErrorCode$2.InvalidDid,`Invalid multibase identifier: ${xt}`)}}var __awaiter$2j=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let BearerDid$2=class Sl{constructor({uri:e,document:At,metadata:kt,keyManager:Bt}){this.uri=e,this.document=At,this.metadata=kt,this.keyManager=Bt}export(){return __awaiter$2j(this,void 0,void 0,function*(){if(!(Array.isArray(this.document.verificationMethod)&&this.document.verificationMethod.length>0))throw new Error(`DID document for '${this.uri}' is missing verification methods`);let e={uri:this.uri,document:this.document,metadata:this.metadata};if("exportKey"in this.keyManager&&typeof this.keyManager.exportKey=="function"){const At=[];for(let kt of this.document.verificationMethod){if(!kt.publicKeyJwk)throw new Error(`Verification method '${kt.id}' does not contain a public key in JWK format`);const Bt=yield this.keyManager.getKeyUri({key:kt.publicKeyJwk}),Nt=yield this.keyManager.exportKey({keyUri:Bt});At.push(Object.assign({},Nt))}e.privateKeys=At}return e})}getSigner(e){return __awaiter$2j(this,void 0,void 0,function*(){var At;const kt=(At=this.document.verificationMethod)===null||At===void 0?void 0:At.find(er=>{var tr,zt;return extractDidFragment$2(er.id)===((tr=extractDidFragment$2(e==null?void 0:e.methodId))!==null&&tr!==void 0?tr:extractDidFragment$2((zt=this.document.assertionMethod)===null||zt===void 0?void 0:zt[0]))});if(!(kt&&kt.publicKeyJwk))throw new DidError$2(DidErrorCode$2.InternalError,"A verification method intended for signing could not be determined from the DID Document");const Bt=yield this.keyManager.getKeyUri({key:kt.publicKeyJwk}),Nt=yield this.keyManager.getPublicKey({keyUri:Bt}),jt=this.keyManager;return{algorithm:CryptoUtils$1.getJoseSignatureAlgorithmFromPublicKey(Nt),keyId:kt.id,sign(er){return __awaiter$2j(this,arguments,void 0,function*({data:tr}){return yield jt.sign({data:tr,keyUri:Bt})})},verify(er){return __awaiter$2j(this,arguments,void 0,function*({data:tr,signature:zt}){return yield jt.verify({data:tr,key:Nt,signature:zt})})}}})}static import(e){return __awaiter$2j(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager$4}){var Bt;const Nt=getVerificationMethods$2({didDocument:At.document});if(Nt.length===0)throw new DidError$2(DidErrorCode$2.InvalidDidDocument,"At least one verification method is required but 0 were given");for(let Lt of(Bt=At.privateKeys)!==null&&Bt!==void 0?Bt:[])yield kt.importKey({key:Lt});for(let Lt of Nt){if(!Lt.publicKeyJwk)throw new Error(`Verification method '${Lt.id}' does not contain a public key in JWK format`);const er=yield kt.getKeyUri({key:Lt.publicKeyJwk});yield kt.getPublicKey({keyUri:er})}return new Sl({uri:At.uri,document:At.document,metadata:At.metadata,keyManager:kt})})}};/* Common package for dealing with hex/string/uint8 conversions (and sha1 hashing)
*
* @author   Jimmy Wärting <jimmy@warting.se> (https://jimmy.warting.se/opensource)
* @license  MIT
*/const alphabet$1="0123456789abcdef",encodeLookup=[];for(let xt=0;xt<256;xt++)encodeLookup[xt]=alphabet$1[xt>>4&15]+alphabet$1[xt&15];const arr2hex=xt=>{const e=xt.length;let At="",kt=0;for(;kt<e;)At+=encodeLookup[xt[kt++]];return At},concat=(xt,e=0)=>{const At=xt.length||0;if(!e){let jt=At;for(;jt--;)e+=xt[jt].length}const kt=new Uint8Array(e);let Bt=e,Nt=At;for(;Nt--;)Bt-=xt[Nt].length,kt.set(xt[Nt],Bt);return kt};var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var i=0;i<chars.length;i++)lookup[chars.charCodeAt(i)]=i;const decoder=new TextDecoder,arr2text=(xt,e)=>decoder.decode(xt),encoder=new TextEncoder,text2arr=xt=>encoder.encode(xt),scope=typeof window<"u"?window:self,crypto$1=scope.crypto||scope.msCrypto||{};crypto$1.subtle||crypto$1.webkitSubtle;function digitCount(xt){const e=xt<0?1:0;return xt=Math.abs(Number(xt||1)),Math.floor(Math.log10(xt))+1+e}function getType(xt){return ArrayBuffer.isView(xt)?"arraybufferview":Array.isArray(xt)?"array":xt instanceof Number?"number":xt instanceof Boolean?"boolean":xt instanceof Set?"set":xt instanceof Map?"map":xt instanceof String?"string":xt instanceof ArrayBuffer?"arraybuffer":typeof xt}function encode$5(xt,e,At){const kt=[];let Bt=null;return encode$5._encode(kt,xt),Bt=concat(kt),encode$5.bytes=Bt.length,ArrayBuffer.isView(e)?(e.set(Bt,At),e):Bt}encode$5.bytes=-1;encode$5._floatConversionDetected=!1;encode$5._encode=function(xt,e){if(e!=null)switch(getType(e)){case"object":encode$5.dict(xt,e);break;case"map":encode$5.dictMap(xt,e);break;case"array":encode$5.list(xt,e);break;case"set":encode$5.listSet(xt,e);break;case"string":encode$5.string(xt,e);break;case"number":encode$5.number(xt,e);break;case"boolean":encode$5.number(xt,e);break;case"arraybufferview":encode$5.buffer(xt,new Uint8Array(e.buffer,e.byteOffset,e.byteLength));break;case"arraybuffer":encode$5.buffer(xt,new Uint8Array(e));break}};const buffE=new Uint8Array([101]),buffD=new Uint8Array([100]),buffL=new Uint8Array([108]);encode$5.buffer=function(xt,e){xt.push(text2arr(e.length+":"),e)};encode$5.string=function(xt,e){xt.push(text2arr(text2arr(e).byteLength+":"+e))};encode$5.number=function(xt,e){if(Number.isInteger(e))return xt.push(text2arr("i"+BigInt(e)+"e"));const At=2147483648,kt=e/At<<0,Bt=e%At<<0,Nt=kt*At+Bt;xt.push(text2arr("i"+Nt+"e")),Nt!==e&&!encode$5._floatConversionDetected&&(encode$5._floatConversionDetected=!0,console.warn('WARNING: Possible data corruption detected with value "'+e+'":','Bencoding only defines support for integers, value was converted to "'+Nt+'"'),console.trace())};encode$5.dict=function(xt,e){xt.push(buffD);let At=0,kt;const Bt=Object.keys(e).sort(),Nt=Bt.length;for(;At<Nt;At++)kt=Bt[At],e[kt]!=null&&(encode$5.string(xt,kt),encode$5._encode(xt,e[kt]));xt.push(buffE)};encode$5.dictMap=function(xt,e){xt.push(buffD);const At=Array.from(e.keys()).sort();for(const kt of At)e.get(kt)!=null&&(ArrayBuffer.isView(kt)?encode$5._encode(xt,kt):encode$5.string(xt,String(kt)),encode$5._encode(xt,e.get(kt)));xt.push(buffE)};encode$5.list=function(xt,e){let At=0;const kt=e.length;for(xt.push(buffL);At<kt;At++)e[At]!=null&&encode$5._encode(xt,e[At]);xt.push(buffE)};encode$5.listSet=function(xt,e){xt.push(buffL);for(const At of e)At!=null&&encode$5._encode(xt,At);xt.push(buffE)};const INTEGER_START=105,STRING_DELIM=58,DICTIONARY_START=100,LIST_START=108,END_OF_TYPE=101;function getIntFromBuffer(xt,e,At){let kt=0,Bt=1;for(let Nt=e;Nt<At;Nt++){const jt=xt[Nt];if(jt<58&&jt>=48){kt=kt*10+(jt-48);continue}if(!(Nt===e&&jt===43)){if(Nt===e&&jt===45){Bt=-1;continue}if(jt===46)break;throw new Error("not a number: buffer["+Nt+"] = "+jt)}}return kt*Bt}function decode$4(xt,e,At,kt){return xt==null||xt.length===0?null:(typeof e!="number"&&kt==null&&(kt=e,e=void 0),typeof At!="number"&&kt==null&&(kt=At,At=void 0),decode$4.position=0,decode$4.encoding=kt||null,decode$4.data=ArrayBuffer.isView(xt)?new Uint8Array(xt.slice(e,At)):text2arr(xt),decode$4.bytes=decode$4.data.length,decode$4.next())}decode$4.bytes=0;decode$4.position=0;decode$4.data=null;decode$4.encoding=null;decode$4.next=function(){switch(decode$4.data[decode$4.position]){case DICTIONARY_START:return decode$4.dictionary();case LIST_START:return decode$4.list();case INTEGER_START:return decode$4.integer();default:return decode$4.buffer()}};decode$4.find=function(xt){let e=decode$4.position;const At=decode$4.data.length,kt=decode$4.data;for(;e<At;){if(kt[e]===xt)return e;e++}throw new Error('Invalid data: Missing delimiter "'+String.fromCharCode(xt)+'" [0x'+xt.toString(16)+"]")};decode$4.dictionary=function(){decode$4.position++;const xt={};for(;decode$4.data[decode$4.position]!==END_OF_TYPE;){const e=decode$4.buffer();let At=arr2text(e);At.includes("�")&&(At=arr2hex(e)),xt[At]=decode$4.next()}return decode$4.position++,xt};decode$4.list=function(){decode$4.position++;const xt=[];for(;decode$4.data[decode$4.position]!==END_OF_TYPE;)xt.push(decode$4.next());return decode$4.position++,xt};decode$4.integer=function(){const xt=decode$4.find(END_OF_TYPE),e=getIntFromBuffer(decode$4.data,decode$4.position+1,xt);return decode$4.position+=xt+1-decode$4.position,e};decode$4.buffer=function(){let xt=decode$4.find(STRING_DELIM);const e=getIntFromBuffer(decode$4.data,decode$4.position,xt),At=++xt+e;return decode$4.position=At,decode$4.encoding?arr2text(decode$4.data.slice(xt,At)):decode$4.data.slice(xt,At)};function listLength(xt){let e=2;for(const At of xt)e+=encodingLength$3(At);return e}function mapLength(xt){let e=2;for(const[At,kt]of xt){const Bt=text2arr(At).byteLength;e+=digitCount(Bt)+1+Bt,e+=encodingLength$3(kt)}return e}function objectLength(xt){let e=2;const At=Object.keys(xt);for(let kt=0;kt<At.length;kt++){const Bt=text2arr(At[kt]).byteLength;e+=digitCount(Bt)+1+Bt,e+=encodingLength$3(xt[At[kt]])}return e}function stringLength(xt){const e=text2arr(xt).byteLength;return digitCount(e)+1+e}function arrayBufferLength(xt){const e=xt.byteLength-xt.byteOffset;return digitCount(e)+1+e}function encodingLength$3(xt){if(xt==null)return 0;const At=getType(xt);switch(At){case"arraybufferview":return arrayBufferLength(xt);case"string":return stringLength(xt);case"array":case"set":return listLength(xt);case"number":return 1+digitCount(Math.floor(xt))+1;case"bigint":return 1+xt.toString().length+1;case"object":return objectLength(xt);case"map":return mapLength(xt);default:throw new TypeError(`Unsupported value of type "${At}"`)}}const encodingLength$2=encodingLength$3,bencode={encode:encode$5,decode:decode$4,byteLength:encodingLength$3,encodingLength:encodingLength$2},v4Regex=/^(\d{1,3}\.){3,3}\d{1,3}$/,v4Size=4,v6Regex=/^(::)?(((\d{1,3}\.){3}(\d{1,3}){1})?([0-9a-f]){0,4}:{0,2}){1,8}(::)?$/i,v6Size=16,v4={name:"v4",size:v4Size,isFormat:xt=>v4Regex.test(xt),encode(xt,e,At){At=~~At,e=e||new Uint8Array(At+v4Size);const kt=xt.length;let Bt=0;for(let Nt=0;Nt<kt;){const jt=xt.charCodeAt(Nt++);jt===46?(e[At++]=Bt,Bt=0):Bt=Bt*10+(jt-48)}return e[At]=Bt,e},decode(xt,e){return e=~~e,`${xt[e++]}.${xt[e++]}.${xt[e++]}.${xt[e]}`}},v6={name:"v6",size:v6Size,isFormat:xt=>xt.length>0&&v6Regex.test(xt),encode(xt,e,At){At=~~At;let kt=At+v6Size,Bt=-1,Nt=0,jt=0,Lt=!0,er=!1;e=e||new Uint8Array(At+v6Size);for(let tr=0;tr<xt.length;tr++){let zt=xt.charCodeAt(tr);zt===58?(Lt?Bt!==-1?(At<kt&&(e[At]=0),At<kt-1&&(e[At+1]=0),At+=2):At<kt&&(Bt=At):(er===!0?(At<kt&&(e[At]=jt),At++):(At<kt&&(e[At]=Nt>>8),At<kt-1&&(e[At+1]=Nt&255),At+=2),Nt=0,jt=0),Lt=!0,er=!1):zt===46?(At<kt&&(e[At]=jt),At++,jt=0,Nt=0,Lt=!1,er=!0):(Lt=!1,zt>=97?zt-=87:zt>=65?zt-=55:(zt-=48,jt=jt*10+zt),Nt=(Nt<<4)+zt)}if(Lt===!1)er===!0?(At<kt&&(e[At]=jt),At++):(At<kt&&(e[At]=Nt>>8),At<kt-1&&(e[At+1]=Nt&255),At+=2);else if(Bt===0)At<kt&&(e[At]=0),At<kt-1&&(e[At+1]=0),At+=2;else if(Bt!==-1){At+=2;for(let tr=Math.min(At-1,kt-1);tr>=Bt+2;tr--)e[tr]=e[tr-2];e[Bt]=0,e[Bt+1]=0,Bt=At}if(Bt!==At&&Bt!==-1)for(At>kt-2&&(At=kt-2);kt>Bt;)e[--kt]=At<kt&&At>Bt?e[--At]:0;else for(;At<kt;)e[At++]=0;return e},decode(xt,e){e=~~e;let At="";for(let kt=0;kt<v6Size;kt+=2)kt!==0&&(At+=":"),At+=(xt[e+kt]<<8|xt[e+kt+1]).toString(16);return At.replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}};function sizeOf(xt){if(v4.isFormat(xt))return v4.size;if(v6.isFormat(xt))return v6.size;throw Error(`Invalid ip address: ${xt}`)}function familyOf(xt){return sizeOf(xt)===v4.size?1:2}function encode$4(xt,e,At){At=~~At;const kt=sizeOf(xt);return typeof e=="function"&&(e=e(At+kt)),kt===v4.size?v4.encode(xt,e,At):v6.encode(xt,e,At)}function decode$3(xt,e,At){if(e=~~e,At=At||xt.length-e,At===v4.size)return v4.decode(xt,e,At);if(At===v6.size)return v6.decode(xt,e,At);throw Error(`Invalid buffer size needs to be ${v4.size} for v4 or ${v6.size} for v6.`)}function toString$4(xt){switch(xt){case 1:return"A";case 10:return"NULL";case 28:return"AAAA";case 18:return"AFSDB";case 42:return"APL";case 257:return"CAA";case 60:return"CDNSKEY";case 59:return"CDS";case 37:return"CERT";case 5:return"CNAME";case 49:return"DHCID";case 32769:return"DLV";case 39:return"DNAME";case 48:return"DNSKEY";case 43:return"DS";case 55:return"HIP";case 13:return"HINFO";case 45:return"IPSECKEY";case 25:return"KEY";case 36:return"KX";case 29:return"LOC";case 15:return"MX";case 35:return"NAPTR";case 2:return"NS";case 47:return"NSEC";case 50:return"NSEC3";case 51:return"NSEC3PARAM";case 12:return"PTR";case 46:return"RRSIG";case 17:return"RP";case 24:return"SIG";case 6:return"SOA";case 99:return"SPF";case 33:return"SRV";case 44:return"SSHFP";case 32768:return"TA";case 249:return"TKEY";case 52:return"TLSA";case 250:return"TSIG";case 16:return"TXT";case 252:return"AXFR";case 251:return"IXFR";case 41:return"OPT";case 255:return"ANY"}return"UNKNOWN_"+xt}function toType(xt){switch(xt.toUpperCase()){case"A":return 1;case"NULL":return 10;case"AAAA":return 28;case"AFSDB":return 18;case"APL":return 42;case"CAA":return 257;case"CDNSKEY":return 60;case"CDS":return 59;case"CERT":return 37;case"CNAME":return 5;case"DHCID":return 49;case"DLV":return 32769;case"DNAME":return 39;case"DNSKEY":return 48;case"DS":return 43;case"HIP":return 55;case"HINFO":return 13;case"IPSECKEY":return 45;case"KEY":return 25;case"KX":return 36;case"LOC":return 29;case"MX":return 15;case"NAPTR":return 35;case"NS":return 2;case"NSEC":return 47;case"NSEC3":return 50;case"NSEC3PARAM":return 51;case"PTR":return 12;case"RRSIG":return 46;case"RP":return 17;case"SIG":return 24;case"SOA":return 6;case"SPF":return 99;case"SRV":return 33;case"SSHFP":return 44;case"TA":return 32768;case"TKEY":return 249;case"TLSA":return 52;case"TSIG":return 250;case"TXT":return 16;case"AXFR":return 252;case"IXFR":return 251;case"OPT":return 41;case"ANY":return 255;case"*":return 255}return xt.toUpperCase().startsWith("UNKNOWN_")?parseInt(xt.slice(8)):0}function toString$3(xt){switch(xt){case 0:return"NOERROR";case 1:return"FORMERR";case 2:return"SERVFAIL";case 3:return"NXDOMAIN";case 4:return"NOTIMP";case 5:return"REFUSED";case 6:return"YXDOMAIN";case 7:return"YXRRSET";case 8:return"NXRRSET";case 9:return"NOTAUTH";case 10:return"NOTZONE";case 11:return"RCODE_11";case 12:return"RCODE_12";case 13:return"RCODE_13";case 14:return"RCODE_14";case 15:return"RCODE_15"}return"RCODE_"+xt}function toString$2(xt){switch(xt){case 0:return"QUERY";case 1:return"IQUERY";case 2:return"STATUS";case 3:return"OPCODE_3";case 4:return"NOTIFY";case 5:return"UPDATE";case 6:return"OPCODE_6";case 7:return"OPCODE_7";case 8:return"OPCODE_8";case 9:return"OPCODE_9";case 10:return"OPCODE_10";case 11:return"OPCODE_11";case 12:return"OPCODE_12";case 13:return"OPCODE_13";case 14:return"OPCODE_14";case 15:return"OPCODE_15"}return"OPCODE_"+xt}function toString$1(xt){switch(xt){case 1:return"IN";case 2:return"CS";case 3:return"CH";case 4:return"HS";case 255:return"ANY"}return"UNKNOWN_"+xt}function toClass(xt){switch(xt.toUpperCase()){case"IN":return 1;case"CS":return 2;case"CH":return 3;case"HS":return 4;case"ANY":return 255}return 0}function toString(xt){switch(xt){case 1:return"LLQ";case 2:return"UL";case 3:return"NSID";case 5:return"DAU";case 6:return"DHU";case 7:return"N3U";case 8:return"CLIENT_SUBNET";case 9:return"EXPIRE";case 10:return"COOKIE";case 11:return"TCP_KEEPALIVE";case 12:return"PADDING";case 13:return"CHAIN";case 14:return"KEY_TAG";case 26946:return"DEVICEID"}return xt<0?null:`OPTION_${xt}`}function toCode(xt){if(typeof xt=="number")return xt;if(!xt)return-1;switch(xt.toUpperCase()){case"OPTION_0":return 0;case"LLQ":return 1;case"UL":return 2;case"NSID":return 3;case"OPTION_4":return 4;case"DAU":return 5;case"DHU":return 6;case"N3U":return 7;case"CLIENT_SUBNET":return 8;case"EXPIRE":return 9;case"COOKIE":return 10;case"TCP_KEEPALIVE":return 11;case"PADDING":return 12;case"CHAIN":return 13;case"KEY_TAG":return 14;case"DEVICEID":return 26946;case"OPTION_65535":return 65535}const e=xt.match(/_(\d+)$/);return e?parseInt(e[1],10):-1}const SURROGATE_A=55296,SURROGATE_B=56320;function encodingLength$1(xt){let e=0;const At=xt.length;for(let kt=0;kt<At;kt+=1){const Bt=xt.charCodeAt(kt);if(Bt<=127)e+=1;else if(Bt<=2047)e+=2;else if((Bt&63488)!==SURROGATE_A)e+=3;else{const Nt=kt+1;Nt===At||Bt>=SURROGATE_B||(xt.charCodeAt(Nt)&64512)!==SURROGATE_B?e+=3:(kt=Nt,e+=4)}}return e}function encode$3(xt,e,At){const kt=xt.length;At==null&&(At=0),e===void 0&&(e=new Uint8Array(encodingLength$1(xt)+At));let Bt=At;for(let Nt=0;Nt<kt;Nt+=1){let jt=xt.charCodeAt(Nt);if(jt<=127)e[Bt++]=jt;else if(jt<=2047)e[Bt++]=192|(jt&1984)>>6,e[Bt++]=128|jt&63;else if((jt&63488)!==SURROGATE_A)e[Bt++]=224|(jt&61440)>>12,e[Bt++]=128|(jt&4032)>>6,e[Bt++]=128|jt&63;else{const Lt=Nt+1;if(Lt===kt||jt>=SURROGATE_B)e[Bt++]=239,e[Bt++]=191,e[Bt++]=189;else{const er=xt.charCodeAt(Lt);(er&64512)!==SURROGATE_B?(e[Bt++]=239,e[Bt++]=191,e[Bt++]=189):(Nt=Lt,jt=65536|(jt&1023)<<10|er&1023,e[Bt++]=240|(jt&1835008)>>18,e[Bt++]=128|(jt&258048)>>12,e[Bt++]=128|(jt&4032)>>6,e[Bt++]=128|jt&63)}}}return encode$3.bytes=Bt-At,e}encode$3.bytes=0;function decode$2(xt,e,At){let kt="";e==null&&(e=0),At==null&&(At=xt.length);for(let Bt=e;Bt<At;){const Nt=xt[Bt++];let jt;if(Nt<=128)jt=Nt;else if(Nt>191&&Nt<224)jt=(Nt&31)<<6|xt[Bt++]&63;else if(Nt>239&&Nt<365){jt=((Nt&7)<<18|(xt[Bt++]&63)<<12|(xt[Bt++]&63)<<6|xt[Bt++]&63)-65536;const Lt=SURROGATE_A|jt>>10&1023;kt+=String.fromCharCode(Lt),jt=SURROGATE_B|jt&1023}else jt=(Nt&15)<<12|(xt[Bt++]&63)<<6|xt[Bt++]&63;kt+=String.fromCharCode(jt)}return decode$2.bytes=At-e,kt}decode$2.bytes=0;const isU8Arr=xt=>xt instanceof Uint8Array;function bytelength(xt){return typeof xt=="string"?encodingLength$1(xt):xt.byteLength}function from(xt){return xt instanceof Uint8Array?xt:Array.isArray(xt)?new Uint8Array(xt):encode$3(xt)}function write(xt,e,At){if(typeof e!="string")throw new Error("unknown input type");return encode$3(e,xt,At),encode$3.bytes}const hexNum={},numHex=new Array(255);for(let xt=0;xt<=15;xt+=1){const e=xt.toString(16),At=e.toUpperCase();for(let kt=0;kt<=15;kt+=1){const Bt=kt.toString(16),Nt=Bt.toUpperCase(),jt=xt<<4|kt,Lt=`${e}${Bt}`;numHex[jt]=Lt,hexNum[Lt]=jt,hexNum[`${At}${Bt}`]=jt,hexNum[`${e}${Nt}`]=jt,hexNum[`${At}${Nt}`]=jt}}function toHex(xt,e,At){let kt="";for(let Bt=e;Bt<At;){const Nt=xt[Bt++];kt+=numHex[Nt]}return kt}function hexLength(xt){return xt.length>>>1}function writeHex(xt,e,At,kt){let Bt=0;for(;At<kt;){const Nt=e.substr(Bt,2),jt=hexNum[Nt];if(jt===void 0)return;xt[At++]=jt,Bt+=2}return xt}const P_24=Math.pow(2,24),P_16=Math.pow(2,16),P_8=Math.pow(2,8),readUInt32BE=(xt,e)=>xt[e]*P_24+xt[e+1]*P_16+xt[e+2]*P_8+xt[e+3],readUInt16BE=(xt,e)=>xt[e]<<8|xt[e+1],writeUInt32BE=(xt,e,At)=>(e=+e,xt[At+3]=e,e=e>>>8,xt[At+2]=e,e=e>>>8,xt[At+1]=e,e=e>>>8,xt[At]=e,At+4),writeUInt16BE=(xt,e,At)=>(xt[At]=e>>8,xt[At+1]=e&255,At+2);function copy(xt,e,At,kt,Bt){return At<0&&(kt-=At,At=0),kt<0&&(kt=0),Bt<0?new Uint8Array(0):At>=e.length||kt>=Bt?0:_copyActual(xt,e,At,kt,Bt)}function _copyActual(xt,e,At,kt,Bt){Bt-kt>e.length-At&&(Bt=kt+e.length-At);let Nt=Bt-kt;const jt=xt.length-kt;return Nt>jt&&(Nt=jt),(kt!==0||Bt<xt.length)&&(xt=new Uint8Array(xt.buffer,xt.byteOffset+kt,Nt)),e.set(xt,At),Nt}const QUERY_FLAG=0,RESPONSE_FLAG=32768,FLUSH_MASK=32768,NOT_FLUSH_MASK=~FLUSH_MASK,QU_MASK=32768,NOT_QU_MASK=~QU_MASK;function codec({bytes:xt=0,encode:e,decode:At,encodingLength:kt}){return e.bytes=xt,At.bytes=xt,{encode:e,decode:At,encodingLength:kt||(()=>xt)}}const name$1=codec({encode(xt,e,At){e||(e=new Uint8Array(name$1.encodingLength(xt))),At||(At=0);const kt=At,Bt=xt.replace(/^\.|\.$/gm,"");if(Bt.length){const Nt=Bt.split(".");for(let jt=0;jt<Nt.length;jt++){const Lt=write(e,Nt[jt],At+1);e[At]=Lt,At+=Lt+1}}return e[At++]=0,name$1.encode.bytes=At-kt,e},decode(xt,e){e||(e=0);const At=[];let kt=e,Bt=0,Nt=0,jt=!1;for(;;){if(e>=xt.length)throw new Error("Cannot decode name (buffer overflow)");const Lt=xt[e++];if(Nt+=jt?0:1,Lt===0)break;if(Lt&192)if((Lt&192)===192){if(e+1>xt.length)throw new Error("Cannot decode name (buffer overflow)");const er=readUInt16BE(xt,e-1)-49152;if(er>=kt)throw new Error("Cannot decode name (bad pointer)");e=er,kt=er,Nt+=jt?0:1,jt=!0}else throw new Error("Cannot decode name (bad label)");else{if(e+Lt>xt.length)throw new Error("Cannot decode name (buffer overflow)");if(Bt+=Lt+1,Bt>254)throw new Error("Cannot decode name (name too long)");At.push(decode$2(xt,e,e+Lt)),e+=Lt,Nt+=jt?0:Lt}}return name$1.decode.bytes=Nt,At.length===0?".":At.join(".")},encodingLength(xt){return xt==="."||xt===".."?1:bytelength(xt.replace(/^\.|\.$/gm,""))+2}}),string=codec({encode(xt,e,At){e||(e=new Uint8Array(string.encodingLength(xt))),At||(At=0);const kt=write(e,xt,At+1);return e[At]=kt,string.encode.bytes=kt+1,e},decode(xt,e){e||(e=0);const At=xt[e],kt=decode$2(xt,e+1,e+1+At);return string.decode.bytes=At+1,kt},encodingLength(xt){return bytelength(xt)+1}}),header=codec({bytes:12,encode(xt,e,At){e||(e=new Uint8Array(header.encodingLength(xt))),At||(At=0);const kt=(xt.flags||0)&32767,Bt=xt.type==="response"?RESPONSE_FLAG:QUERY_FLAG;return writeUInt16BE(e,xt.id||0,At),writeUInt16BE(e,kt|Bt,At+2),writeUInt16BE(e,xt.questions.length,At+4),writeUInt16BE(e,xt.answers.length,At+6),writeUInt16BE(e,xt.authorities.length,At+8),writeUInt16BE(e,xt.additionals.length,At+10),e},decode(xt,e){if(e||(e=0),xt.length<12)throw new Error("Header must be 12 bytes");const At=readUInt16BE(xt,e+2);return{id:readUInt16BE(xt,e),type:At&RESPONSE_FLAG?"response":"query",flags:At&32767,flag_qr:(At>>15&1)===1,opcode:toString$2(At>>11&15),flag_aa:(At>>10&1)===1,flag_tc:(At>>9&1)===1,flag_rd:(At>>8&1)===1,flag_ra:(At>>7&1)===1,flag_z:(At>>6&1)===1,flag_ad:(At>>5&1)===1,flag_cd:(At>>4&1)===1,rcode:toString$3(At&15),questions:new Array(readUInt16BE(xt,e+4)),answers:new Array(readUInt16BE(xt,e+6)),authorities:new Array(readUInt16BE(xt,e+8)),additionals:new Array(readUInt16BE(xt,e+10))}},encodingLength(){return 12}}),runknown=codec({encode(xt,e,At){e||(e=new Uint8Array(runknown.encodingLength(xt))),At||(At=0);const kt=xt.length;return writeUInt16BE(e,kt,At),copy(xt,e,At+2,0,kt),runknown.encode.bytes=kt+2,e},decode(xt,e){e||(e=0);const At=readUInt16BE(xt,e),kt=xt.slice(e+2,e+2+At);return runknown.decode.bytes=At+2,kt},encodingLength(xt){return xt.length+2}}),rns=codec({encode(xt,e,At){return e||(e=new Uint8Array(rns.encodingLength(xt))),At||(At=0),name$1.encode(xt,e,At+2),writeUInt16BE(e,name$1.encode.bytes,At),rns.encode.bytes=name$1.encode.bytes+2,e},decode(xt,e){e||(e=0);const At=readUInt16BE(xt,e),kt=name$1.decode(xt,e+2);return rns.decode.bytes=At+2,kt},encodingLength(xt){return name$1.encodingLength(xt)+2}}),rsoa=codec({encode(xt,e,At){e||(e=new Uint8Array(rsoa.encodingLength(xt))),At||(At=0);const kt=At;return At+=2,name$1.encode(xt.mname,e,At),At+=name$1.encode.bytes,name$1.encode(xt.rname,e,At),At+=name$1.encode.bytes,writeUInt32BE(e,xt.serial||0,At),At+=4,writeUInt32BE(e,xt.refresh||0,At),At+=4,writeUInt32BE(e,xt.retry||0,At),At+=4,writeUInt32BE(e,xt.expire||0,At),At+=4,writeUInt32BE(e,xt.minimum||0,At),At+=4,writeUInt16BE(e,At-kt-2,kt),rsoa.encode.bytes=At-kt,e},decode(xt,e){e||(e=0);const At=e,kt={};return e+=2,kt.mname=name$1.decode(xt,e),e+=name$1.decode.bytes,kt.rname=name$1.decode(xt,e),e+=name$1.decode.bytes,kt.serial=readUInt32BE(xt,e),e+=4,kt.refresh=readUInt32BE(xt,e),e+=4,kt.retry=readUInt32BE(xt,e),e+=4,kt.expire=readUInt32BE(xt,e),e+=4,kt.minimum=readUInt32BE(xt,e),e+=4,rsoa.decode.bytes=e-At,kt},encodingLength(xt){return 22+name$1.encodingLength(xt.mname)+name$1.encodingLength(xt.rname)}}),rtxt=codec({encode(xt,e,At){Array.isArray(xt)||(xt=[xt]);for(let Bt=0;Bt<xt.length;Bt++)if(typeof xt[Bt]=="string"&&(xt[Bt]=from(xt[Bt])),!isU8Arr(xt[Bt]))throw new Error("Must be a Buffer");e||(e=new Uint8Array(rtxt.encodingLength(xt))),At||(At=0);const kt=At;return At+=2,xt.forEach(function(Bt){e[At++]=Bt.length,copy(Bt,e,At,0,Bt.length),At+=Bt.length}),writeUInt16BE(e,At-kt-2,kt),rtxt.encode.bytes=At-kt,e},decode(xt,e){e||(e=0);const At=e;let kt=readUInt16BE(xt,e);e+=2;const Bt=[];for(;kt>0;){const Nt=xt[e++];if(--kt,kt<Nt)throw new Error("Buffer overflow");Bt.push(xt.slice(e,e+Nt)),e+=Nt,kt-=Nt}return rtxt.decode.bytes=e-At,Bt},encodingLength(xt){Array.isArray(xt)||(xt=[xt]);let e=2;return xt.forEach(function(At){typeof At=="string"?e+=bytelength(At)+1:e+=At.length+1}),e}}),rnull=codec({encode(xt,e,At){e||(e=new Uint8Array(rnull.encodingLength(xt))),At||(At=0),typeof xt=="string"&&(xt=from(xt)),xt||(xt=new Uint8Array(0));const kt=At;At+=2;const Bt=xt.length;return copy(xt,e,At,0,Bt),At+=Bt,writeUInt16BE(e,At-kt-2,kt),rnull.encode.bytes=At-kt,e},decode(xt,e){e||(e=0);const At=e,kt=readUInt16BE(xt,e);e+=2;const Bt=xt.slice(e,e+kt);return e+=kt,rnull.decode.bytes=e-At,Bt},encodingLength(xt){return xt?(isU8Arr(xt)?xt.length:bytelength(xt))+2:2}}),rhinfo=codec({encode(xt,e,At){e||(e=new Uint8Array(rhinfo.encodingLength(xt))),At||(At=0);const kt=At;return At+=2,string.encode(xt.cpu,e,At),At+=string.encode.bytes,string.encode(xt.os,e,At),At+=string.encode.bytes,writeUInt16BE(e,At-kt-2,kt),rhinfo.encode.bytes=At-kt,e},decode(xt,e){e||(e=0);const At=e,kt={};return e+=2,kt.cpu=string.decode(xt,e),e+=string.decode.bytes,kt.os=string.decode(xt,e),e+=string.decode.bytes,rhinfo.decode.bytes=e-At,kt},encodingLength(xt){return string.encodingLength(xt.cpu)+string.encodingLength(xt.os)+2}}),rptr=codec({encode(xt,e,At){return e||(e=new Uint8Array(rptr.encodingLength(xt))),At||(At=0),name$1.encode(xt,e,At+2),writeUInt16BE(e,name$1.encode.bytes,At),rptr.encode.bytes=name$1.encode.bytes+2,e},decode(xt,e){e||(e=0);const At=name$1.decode(xt,e+2);return rptr.decode.bytes=name$1.decode.bytes+2,At},encodingLength(xt){return name$1.encodingLength(xt)+2}}),rsrv=codec({encode(xt,e,At){e||(e=new Uint8Array(rsrv.encodingLength(xt))),At||(At=0),writeUInt16BE(e,xt.priority||0,At+2),writeUInt16BE(e,xt.weight||0,At+4),writeUInt16BE(e,xt.port||0,At+6),name$1.encode(xt.target,e,At+8);const kt=name$1.encode.bytes+6;return writeUInt16BE(e,kt,At),rsrv.encode.bytes=kt+2,e},decode(xt,e){e||(e=0);const At=readUInt16BE(xt,e),kt={};return kt.priority=readUInt16BE(xt,e+2),kt.weight=readUInt16BE(xt,e+4),kt.port=readUInt16BE(xt,e+6),kt.target=name$1.decode(xt,e+8),rsrv.decode.bytes=At+2,kt},encodingLength(xt){return 8+name$1.encodingLength(xt.target)}}),rcaa=codec({encode(xt,e,At){const kt=rcaa.encodingLength(xt);return e||(e=new Uint8Array(rcaa.encodingLength(xt))),At||(At=0),xt.issuerCritical&&(xt.flags=rcaa.ISSUER_CRITICAL),writeUInt16BE(e,kt-2,At),At+=2,e[At]=xt.flags||0,At+=1,string.encode(xt.tag,e,At),At+=string.encode.bytes,write(e,xt.value,At),At+=bytelength(xt.value),rcaa.encode.bytes=kt,e},decode(xt,e){e||(e=0);const At=readUInt16BE(xt,e);e+=2;const kt=e,Bt={};return Bt.flags=xt[e],e+=1,Bt.tag=string.decode(xt,e),e+=string.decode.bytes,Bt.value=decode$2(xt,e,kt+At),Bt.issuerCritical=!!(Bt.flags&rcaa.ISSUER_CRITICAL),rcaa.decode.bytes=At+2,Bt},encodingLength(xt){return string.encodingLength(xt.tag)+string.encodingLength(xt.value)+2}});rcaa.ISSUER_CRITICAL=128;const rmx=codec({encode(xt,e,At){e||(e=new Uint8Array(rmx.encodingLength(xt))),At||(At=0);const kt=At;return At+=2,writeUInt16BE(e,xt.preference||0,At),At+=2,name$1.encode(xt.exchange,e,At),At+=name$1.encode.bytes,writeUInt16BE(e,At-kt-2,kt),rmx.encode.bytes=At-kt,e},decode(xt,e){e||(e=0);const At=e,kt={};return e+=2,kt.preference=readUInt16BE(xt,e),e+=2,kt.exchange=name$1.decode(xt,e),e+=name$1.decode.bytes,rmx.decode.bytes=e-At,kt},encodingLength(xt){return 4+name$1.encodingLength(xt.exchange)}}),ra=codec({encode(xt,e,At){return e||(e=new Uint8Array(ra.encodingLength(xt))),At||(At=0),writeUInt16BE(e,4,At),At+=2,v4.encode(xt,e,At),e},decode(xt,e){return e||(e=0),e+=2,v4.decode(xt,e)},bytes:6}),raaaa=codec({encode(xt,e,At){return e||(e=new Uint8Array(raaaa.encodingLength(xt))),At||(At=0),writeUInt16BE(e,16,At),At+=2,v6.encode(xt,e,At),raaaa.encode.bytes=18,e},decode(xt,e){e||(e=0),e+=2;const At=v6.decode(xt,e);return raaaa.decode.bytes=18,At},bytes:18}),alloc=xt=>new Uint8Array(xt),roption=codec({encode(xt,e,At){e||(e=new Uint8Array(roption.encodingLength(xt))),At||(At=0);const kt=At,Bt=toCode(xt.code);if(writeUInt16BE(e,Bt,At),At+=2,xt.data)writeUInt16BE(e,xt.data.length,At),At+=2,copy(xt.data,e,At),At+=xt.data.length;else switch(Bt){case 8:{const Nt=xt.sourcePrefixLength||0,jt=xt.family||familyOf(xt.ip),Lt=encode$4(xt.ip,alloc),er=Math.ceil(Nt/8);writeUInt16BE(e,er+4,At),At+=2,writeUInt16BE(e,jt,At),At+=2,e[At++]=Nt,e[At++]=xt.scopePrefixLength||0,copy(Lt,e,At,0,er),At+=er}break;case 11:xt.timeout?(writeUInt16BE(e,2,At),At+=2,writeUInt16BE(e,xt.timeout,At),At+=2):(writeUInt16BE(e,0,At),At+=2);break;case 12:{const Nt=xt.length||0;writeUInt16BE(e,Nt,At),At+=2,e.fill(0,At,At+Nt),At+=Nt}break;case 14:{const Nt=xt.tags.length*2;writeUInt16BE(e,Nt,At),At+=2;for(const jt of xt.tags)writeUInt16BE(e,jt,At),At+=2}break;default:throw new Error(`Unknown roption code: ${xt.code}`)}return roption.encode.bytes=At-kt,e},decode(xt,e){e||(e=0);const At={};At.code=readUInt16BE(xt,e),At.type=toString(At.code),e+=2;const kt=readUInt16BE(xt,e);switch(e+=2,At.data=xt.slice(e,e+kt),At.code){case 8:At.family=readUInt16BE(xt,e),e+=2,At.sourcePrefixLength=xt[e++],At.scopePrefixLength=xt[e++];{const Bt=new Uint8Array(At.family===1?4:16);copy(xt,Bt,0,e,e+kt-4),At.ip=decode$3(Bt)}break;case 11:kt>0&&(At.timeout=readUInt16BE(xt,e),e+=2);break;case 14:At.tags=[];for(let Bt=0;Bt<kt;Bt+=2)At.tags.push(readUInt16BE(xt,e)),e+=2}return roption.decode.bytes=kt+4,At},encodingLength(xt){if(xt.data)return xt.data.length+4;switch(toCode(xt.code)){case 8:{const At=xt.sourcePrefixLength||0;return Math.ceil(At/8)+8}case 11:return typeof xt.timeout=="number"?6:4;case 12:return xt.length+4;case 14:return 4+xt.tags.length*2}throw new Error(`Unknown roption code: ${xt.code}`)}}),ropt=codec({encode(xt,e,At){e||(e=new Uint8Array(ropt.encodingLength(xt))),At||(At=0);const kt=At,Bt=encodingLengthList(xt,roption);return writeUInt16BE(e,Bt,At),At=encodeList(xt,roption,e,At+2),ropt.encode.bytes=At-kt,e},decode(xt,e){e||(e=0);const At=e,kt=[];let Bt=readUInt16BE(xt,e);e+=2;let Nt=0;for(;Bt>0;)kt[Nt++]=roption.decode(xt,e),e+=roption.decode.bytes,Bt-=roption.decode.bytes;return ropt.decode.bytes=e-At,kt},encodingLength(xt){return 2+encodingLengthList(xt||[],roption)}}),rdnskey=codec({encode(xt,e,At){e||(e=new Uint8Array(rdnskey.encodingLength(xt))),At||(At=0);const kt=At,Bt=xt.key;if(!isU8Arr(Bt))throw new Error("Key must be a Buffer");return At+=2,writeUInt16BE(e,xt.flags,At),At+=2,e[At]=rdnskey.PROTOCOL_DNSSEC,At+=1,e[At]=xt.algorithm,At+=1,copy(Bt,e,At,0,Bt.length),At+=Bt.length,rdnskey.encode.bytes=At-kt,writeUInt16BE(e,rdnskey.encode.bytes-2,kt),e},decode(xt,e){e||(e=0);const At=e,kt={},Bt=readUInt16BE(xt,e);if(e+=2,kt.flags=readUInt16BE(xt,e),e+=2,xt[e]!==rdnskey.PROTOCOL_DNSSEC)throw new Error("Protocol must be 3");return e+=1,kt.algorithm=xt[e],e+=1,kt.key=xt.slice(e,At+Bt+2),e+=kt.key.length,rdnskey.decode.bytes=e-At,kt},encodingLength(xt){return 6+bytelength(xt.key)}});rdnskey.PROTOCOL_DNSSEC=3;rdnskey.ZONE_KEY=128;rdnskey.SECURE_ENTRYPOINT=32768;const rrrsig=codec({encode(xt,e,At){e||(e=new Uint8Array(rrrsig.encodingLength(xt))),At||(At=0);const kt=At,Bt=xt.signature;if(!isU8Arr(Bt))throw new Error("Signature must be a Buffer");return At+=2,writeUInt16BE(e,toType(xt.typeCovered),At),At+=2,e[At]=xt.algorithm,At+=1,e[At]=xt.labels,At+=1,writeUInt32BE(e,xt.originalTTL,At),At+=4,writeUInt32BE(e,xt.expiration,At),At+=4,writeUInt32BE(e,xt.inception,At),At+=4,writeUInt16BE(e,xt.keyTag,At),At+=2,name$1.encode(xt.signersName,e,At),At+=name$1.encode.bytes,copy(Bt,e,At,0,Bt.length),At+=Bt.length,rrrsig.encode.bytes=At-kt,writeUInt16BE(e,rrrsig.encode.bytes-2,kt),e},decode(xt,e){e||(e=0);const At=e,kt={},Bt=readUInt16BE(xt,e);return e+=2,kt.typeCovered=toString$4(readUInt16BE(xt,e)),e+=2,kt.algorithm=xt[e],e+=1,kt.labels=xt[e],e+=1,kt.originalTTL=readUInt32BE(xt,e),e+=4,kt.expiration=readUInt32BE(xt,e),e+=4,kt.inception=readUInt32BE(xt,e),e+=4,kt.keyTag=readUInt16BE(xt,e),e+=2,kt.signersName=name$1.decode(xt,e),e+=name$1.decode.bytes,kt.signature=xt.slice(e,At+Bt+2),e+=kt.signature.length,rrrsig.decode.bytes=e-At,kt},encodingLength(xt){return 20+name$1.encodingLength(xt.signersName)+bytelength(xt.signature)}}),rrp=codec({encode(xt,e,At){e||(e=new Uint8Array(rrp.encodingLength(xt))),At||(At=0);const kt=At;return At+=2,name$1.encode(xt.mbox||".",e,At),At+=name$1.encode.bytes,name$1.encode(xt.txt||".",e,At),At+=name$1.encode.bytes,rrp.encode.bytes=At-kt,writeUInt16BE(e,rrp.encode.bytes-2,kt),e},decode(xt,e){e||(e=0);const At=e,kt={};return e+=2,kt.mbox=name$1.decode(xt,e)||".",e+=name$1.decode.bytes,kt.txt=name$1.decode(xt,e)||".",e+=name$1.decode.bytes,rrp.decode.bytes=e-At,kt},encodingLength(xt){return 2+name$1.encodingLength(xt.mbox||".")+name$1.encodingLength(xt.txt||".")}}),typebitmap=codec({encode(xt,e,At){e||(e=new Uint8Array(typebitmap.encodingLength(xt))),At||(At=0);const kt=At,Bt=[];for(let Nt=0;Nt<xt.length;Nt++){const jt=toType(xt[Nt]);Bt[jt>>8]===void 0&&(Bt[jt>>8]=[]),Bt[jt>>8][jt>>3&31]|=1<<7-(jt&7)}for(let Nt=0;Nt<Bt.length;Nt++)if(Bt[Nt]!==void 0){const jt=from(Bt[Nt]);e[At]=Nt,At+=1,e[At]=jt.length,At+=1,copy(jt,e,At,0,jt.length),At+=jt.length}return typebitmap.encode.bytes=At-kt,e},decode(xt,e,At){e||(e=0);const kt=e,Bt=[];for(;e-kt<At;){const Nt=xt[e];e+=1;const jt=xt[e];e+=1;for(let Lt=0;Lt<jt;Lt++){const er=xt[e+Lt];for(let tr=0;tr<8;tr++)if(er&1<<7-tr){const zt=toString$4(Nt<<8|Lt<<3|tr);Bt.push(zt)}}e+=jt}return typebitmap.decode.bytes=e-kt,Bt},encodingLength(xt){const e=[];for(let kt=0;kt<xt.length;kt++){const Bt=toType(xt[kt]);e[Bt>>8]=Math.max(e[Bt>>8]||0,Bt&255)}let At=0;for(let kt=0;kt<e.length;kt++)e[kt]!==void 0&&(At+=2+Math.ceil((e[kt]+1)/8));return At}}),rnsec=codec({encode(xt,e,At){e||(e=new Uint8Array(rnsec.encodingLength(xt))),At||(At=0);const kt=At;return At+=2,name$1.encode(xt.nextDomain,e,At),At+=name$1.encode.bytes,typebitmap.encode(xt.rrtypes,e,At),At+=typebitmap.encode.bytes,rnsec.encode.bytes=At-kt,writeUInt16BE(e,rnsec.encode.bytes-2,kt),e},decode(xt,e){e||(e=0);const At=e,kt={},Bt=readUInt16BE(xt,e);return e+=2,kt.nextDomain=name$1.decode(xt,e),e+=name$1.decode.bytes,kt.rrtypes=typebitmap.decode(xt,e,Bt-(e-At)),e+=typebitmap.decode.bytes,rnsec.decode.bytes=e-At,kt},encodingLength(xt){return 2+name$1.encodingLength(xt.nextDomain)+typebitmap.encodingLength(xt.rrtypes)}}),rnsec3=codec({encode(xt,e,At){e||(e=new Uint8Array(rnsec3.encodingLength(xt))),At||(At=0);const kt=At,Bt=xt.salt;if(!isU8Arr(Bt))throw new Error("salt must be a Buffer");const Nt=xt.nextDomain;if(!isU8Arr(Nt))throw new Error("nextDomain must be a Buffer");return At+=2,e[At]=xt.algorithm,At+=1,e[At]=xt.flags,At+=1,writeUInt16BE(e,xt.iterations,At),At+=2,e[At]=Bt.length,At+=1,copy(Bt,e,At,0,Bt.length),At+=Bt.length,e[At]=Nt.length,At+=1,copy(Nt,e,At,0,Nt.length),At+=Nt.length,typebitmap.encode(xt.rrtypes,e,At),At+=typebitmap.encode.bytes,rnsec3.encode.bytes=At-kt,writeUInt16BE(e,rnsec3.encode.bytes-2,kt),e},decode(xt,e){e||(e=0);const At=e,kt={},Bt=readUInt16BE(xt,e);e+=2,kt.algorithm=xt[e],e+=1,kt.flags=xt[e],e+=1,kt.iterations=readUInt16BE(xt,e),e+=2;const Nt=xt[e];e+=1,kt.salt=xt.slice(e,e+Nt),e+=Nt;const jt=xt[e];return e+=1,kt.nextDomain=xt.slice(e,e+jt),e+=jt,kt.rrtypes=typebitmap.decode(xt,e,Bt-(e-At)),e+=typebitmap.decode.bytes,rnsec3.decode.bytes=e-At,kt},encodingLength(xt){return 8+xt.salt.length+xt.nextDomain.length+typebitmap.encodingLength(xt.rrtypes)}}),rds=codec({encode(xt,e,At){e||(e=new Uint8Array(rds.encodingLength(xt))),At||(At=0);const kt=At,Bt=xt.digest;if(!isU8Arr(Bt))throw new Error("Digest must be a Buffer");return At+=2,writeUInt16BE(e,xt.keyTag,At),At+=2,e[At]=xt.algorithm,At+=1,e[At]=xt.digestType,At+=1,copy(Bt,e,At,0,Bt.length),At+=Bt.length,rds.encode.bytes=At-kt,writeUInt16BE(e,rds.encode.bytes-2,kt),e},decode(xt,e){e||(e=0);const At=e,kt={},Bt=readUInt16BE(xt,e);return e+=2,kt.keyTag=readUInt16BE(xt,e),e+=2,kt.algorithm=xt[e],e+=1,kt.digestType=xt[e],e+=1,kt.digest=xt.slice(e,At+Bt+2),e+=kt.digest.length,rds.decode.bytes=e-At,kt},encodingLength(xt){return 6+bytelength(xt.digest)}}),rsshfp=codec({encode(xt,e,At){e||(e=new Uint8Array(rsshfp.encodingLength(xt))),At||(At=0);const kt=At;At+=2,e[At]=xt.algorithm,At+=1,e[At]=xt.hash,At+=1;const Bt=hexLength(xt.fingerprint),Nt=getFingerprintLengthForHashType(xt.hash);if(Bt!==Nt)throw new Error(`Invalid length of fingerprint "${xt.fingerprint}" for hashType=${xt.hash}: ${Bt} != ${Nt}`);return writeHex(e,xt.fingerprint,At,At+=Bt),rsshfp.encode.bytes=At-kt,writeUInt16BE(e,rsshfp.encode.bytes-2,kt),e},decode(xt,e){e||(e=0);const At=e,kt={};e+=2,kt.algorithm=xt[e],e+=1,kt.hash=xt[e],e+=1;const Bt=getFingerprintLengthForHashType(kt.hash);return kt.fingerprint=toHex(xt,e,e+Bt),e+=Bt,rsshfp.decode.bytes=e-At,kt},encodingLength(xt){return 4+hexLength(xt.fingerprint)}});function getFingerprintLengthForHashType(xt){if(xt===1)return 20;if(xt===2)return 32;throw new Error(`Invalid hashType=${xt}, supported=1,2`)}rsshfp.getFingerprintLengthForHashType=getFingerprintLengthForHashType;function renc(xt){switch(xt.toUpperCase()){case"A":return ra;case"PTR":return rptr;case"CNAME":return rptr;case"DNAME":return rptr;case"TXT":return rtxt;case"NULL":return rnull;case"AAAA":return raaaa;case"SRV":return rsrv;case"HINFO":return rhinfo;case"CAA":return rcaa;case"NS":return rns;case"SOA":return rsoa;case"MX":return rmx;case"OPT":return ropt;case"DNSKEY":return rdnskey;case"RRSIG":return rrrsig;case"RP":return rrp;case"NSEC":return rnsec;case"NSEC3":return rnsec3;case"SSHFP":return rsshfp;case"DS":return rds}return runknown}const answer=codec({encode(xt,e,At){e||(e=new Uint8Array(answer.encodingLength(xt))),At||(At=0);const kt=At;if(name$1.encode(xt.name,e,At),At+=name$1.encode.bytes,writeUInt16BE(e,toType(xt.type),At),xt.type.toUpperCase()==="OPT"){if(xt.name!==".")throw new Error("OPT name must be root.");writeUInt16BE(e,xt.udpPayloadSize||4096,At+2),e[At+4]=xt.extendedRcode||0,e[At+5]=xt.ednsVersion||0,writeUInt16BE(e,xt.flags||0,At+6),At+=8,ropt.encode(xt.options||[],e,At),At+=ropt.encode.bytes}else{let Bt=toClass(xt.class===void 0?"IN":xt.class);xt.flush&&(Bt|=FLUSH_MASK),writeUInt16BE(e,Bt,At+2),writeUInt32BE(e,xt.ttl||0,At+4),At+=8;const Nt=renc(xt.type);Nt.encode(xt.data,e,At),At+=Nt.encode.bytes}return answer.encode.bytes=At-kt,e},decode(xt,e){e||(e=0);const At={},kt=e;if(At.name=name$1.decode(xt,e),e+=name$1.decode.bytes,At.type=toString$4(readUInt16BE(xt,e)),At.type==="OPT")At.udpPayloadSize=readUInt16BE(xt,e+2),At.extendedRcode=xt[e+4],At.ednsVersion=xt[e+5],At.flags=readUInt16BE(xt,e+6),At.flag_do=(At.flags>>15&1)===1,At.options=ropt.decode(xt,e+8),e+=8+ropt.decode.bytes;else{const Bt=readUInt16BE(xt,e+2);At.ttl=readUInt32BE(xt,e+4),At.class=toString$1(Bt&NOT_FLUSH_MASK),At.flush=!!(Bt&FLUSH_MASK);const Nt=renc(At.type);At.data=Nt.decode(xt,e+8),e+=8+Nt.decode.bytes}return answer.decode.bytes=e-kt,At},encodingLength(xt){const e=xt.data!==null&&xt.data!==void 0?xt.data:xt.options;return name$1.encodingLength(xt.name)+8+renc(xt.type).encodingLength(e)}}),question=codec({encode(xt,e,At){e||(e=new Uint8Array(question.encodingLength(xt))),At||(At=0);const kt=At;return name$1.encode(xt.name,e,At),At+=name$1.encode.bytes,writeUInt16BE(e,toType(xt.type),At),At+=2,writeUInt16BE(e,toClass(xt.class===void 0?"IN":xt.class),At),At+=2,question.encode.bytes=At-kt,xt},decode(xt,e){e||(e=0);const At=e,kt={};return kt.name=name$1.decode(xt,e),e+=name$1.decode.bytes,kt.type=toString$4(readUInt16BE(xt,e)),e+=2,kt.class=toString$1(readUInt16BE(xt,e)),e+=2,!!(kt.class&QU_MASK)&&(kt.class&=NOT_QU_MASK),question.decode.bytes=e-At,kt},encodingLength(xt){return name$1.encodingLength(xt.name)+4}}),AUTHORITATIVE_ANSWER=1024,packet={encode:function(xt,e,At){const kt=!e;kt&&(e=new Uint8Array(encodingLength(xt))),At||(At=0);const Bt=At;return xt.questions||(xt.questions=[]),xt.answers||(xt.answers=[]),xt.authorities||(xt.authorities=[]),xt.additionals||(xt.additionals=[]),header.encode(xt,e,At),At+=header.encode.bytes,At=encodeList(xt.questions,question,e,At),At=encodeList(xt.answers,answer,e,At),At=encodeList(xt.authorities,answer,e,At),At=encodeList(xt.additionals,answer,e,At),packet.encode.bytes=At-Bt,kt&&encode$2.bytes!==e.length?e.slice(0,encode$2.bytes):e},decode:function(xt,e){e||(e=0);const At=e,kt=header.decode(xt,e);return e+=header.decode.bytes,e=decodeList(kt.questions,question,xt,e),e=decodeList(kt.answers,answer,xt,e),e=decodeList(kt.authorities,answer,xt,e),e=decodeList(kt.additionals,answer,xt,e),packet.decode.bytes=e-At,kt},encodingLength:function(xt){return header.encodingLength(xt)+encodingLengthList(xt.questions||[],question)+encodingLengthList(xt.answers||[],answer)+encodingLengthList(xt.authorities||[],answer)+encodingLengthList(xt.additionals||[],answer)}};packet.encode.bytes=0;packet.decode.bytes=0;const encode$2=packet.encode,decode$1=packet.decode,encodingLength=packet.encodingLength;function encodingLengthList(xt,e){let At=0;for(let kt=0;kt<xt.length;kt++)At+=e.encodingLength(xt[kt]);return At}function encodeList(xt,e,At,kt){for(let Bt=0;Bt<xt.length;Bt++)e.encode(xt[Bt],At,kt),kt+=e.encode.bytes;return kt}function decodeList(xt,e,At,kt){for(let Bt=0;Bt<xt.length;Bt++)xt[Bt]=e.decode(At,kt),kt+=e.decode.bytes;return kt}var __awaiter$2i=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DidMethod$2=class{static getSigningMethod(e){return __awaiter$2i(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement getSigningMethod()")})}static resolve(e,At){return __awaiter$2i(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement resolve()")})}};var __awaiter$2h=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$x=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const DEFAULT_GATEWAY_URI$5="https://diddht.tbddev.org",DID_DHT_SPECIFICATION_VERSION$2=0,DNS_RECORD_TTL$2=7200,PROPERTY_SEPARATOR$2=";",VALUE_SEPARATOR$2=",";var DidDhtRegisteredDidType$2;(function(xt){xt[xt.Discoverable=0]="Discoverable",xt[xt.Organization=1]="Organization",xt[xt.Government=2]="Government",xt[xt.Corporation=3]="Corporation",xt[xt.LocalBusiness=4]="LocalBusiness",xt[xt.SoftwarePackage=5]="SoftwarePackage",xt[xt.WebApp=6]="WebApp",xt[xt.FinancialInstitution=7]="FinancialInstitution"})(DidDhtRegisteredDidType$2||(DidDhtRegisteredDidType$2={}));var DidDhtRegisteredKeyType$2;(function(xt){xt[xt.Ed25519=0]="Ed25519",xt[xt.secp256k1=1]="secp256k1",xt[xt.secp256r1=2]="secp256r1",xt[xt.X25519=3]="X25519"})(DidDhtRegisteredKeyType$2||(DidDhtRegisteredKeyType$2={}));var DidDhtVerificationRelationship$2;(function(xt){xt.authentication="auth",xt.assertionMethod="asm",xt.capabilityDelegation="del",xt.capabilityInvocation="inv",xt.keyAgreement="agm"})(DidDhtVerificationRelationship$2||(DidDhtVerificationRelationship$2={}));const AlgorithmToKeyTypeMap$8={Ed25519:DidDhtRegisteredKeyType$2.Ed25519,ES256K:DidDhtRegisteredKeyType$2.secp256k1,ES256:DidDhtRegisteredKeyType$2.secp256r1,"P-256":DidDhtRegisteredKeyType$2.secp256r1,secp256k1:DidDhtRegisteredKeyType$2.secp256k1,secp256r1:DidDhtRegisteredKeyType$2.secp256r1,X25519:DidDhtRegisteredKeyType$2.X25519},KeyTypeToDefaultAlgorithmMap$2={[DidDhtRegisteredKeyType$2.Ed25519]:"EdDSA",[DidDhtRegisteredKeyType$2.secp256k1]:"ES256K",[DidDhtRegisteredKeyType$2.secp256r1]:"ES256",[DidDhtRegisteredKeyType$2.X25519]:"ECDH-ES+A256KW"};let DidDht$2=class Xs extends DidMethod$2{static create(){return __awaiter$2h(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$4,options:At={}}={}){var kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir;if(!((kt=At.verificationMethods)===null||kt===void 0)&&kt.some(br=>!(br.algorithm in AlgorithmToKeyTypeMap$8)))throw new Error("One or more verification method algorithms are not supported");const ar=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt.filter(br=>"id"in br).map(br=>br.id);if(ar&&ar.length!==new Set(ar).size)throw new Error("One or more verification method IDs are not unique");if(!((Nt=At.services)===null||Nt===void 0)&&Nt.some(br=>!br.id||!br.type||!br.serviceEndpoint))throw new Error("One or more services are missing required properties");const dr=yield e.generateKey({algorithm:"Ed25519"}),ur=yield e.getPublicKey({keyUri:dr}),fr=yield DidDhtUtils$2.identityKeyToIdentifier({identityKey:ur}),pr=Object.assign(Object.assign({id:fr},At.alsoKnownAs&&{alsoKnownAs:At.alsoKnownAs}),At.controllers&&{controller:At.controllers}),lr=[...(jt=At.verificationMethods)!==null&&jt!==void 0?jt:[]];lr!=null&&lr.some(br=>{var Ar;return((Ar=br.id)===null||Ar===void 0?void 0:Ar.split("#").pop())==="0"})||lr.unshift({algorithm:"Ed25519",id:"0",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]});for(const br of lr){const Ar=br.id&&br.id.split("#").pop()==="0"?dr:yield e.generateKey({algorithm:br.algorithm}),Pr=yield e.getPublicKey({keyUri:Ar});let kr=(er=(Lt=br.id)!==null&&Lt!==void 0?Lt:Pr.kid)!==null&&er!==void 0?er:yield computeJwkThumbprint$2({jwk:Pr});kr=`${fr}#${extractDidFragment$2(kr)}`,(tr=pr.verificationMethod)!==null&&tr!==void 0||(pr.verificationMethod=[]),pr.verificationMethod.push({id:kr,type:"JsonWebKey",controller:(zt=br.controller)!==null&&zt!==void 0?zt:fr,publicKeyJwk:Pr});for(const Ur of(rr=br.purposes)!==null&&rr!==void 0?rr:[])pr[Ur]||(pr[Ur]=[]),pr[Ur].push(kr)}(nr=At.services)===null||nr===void 0||nr.forEach(br=>{var Ar;(Ar=pr.service)!==null&&Ar!==void 0||(pr.service=[]),br.id=`${fr}#${br.id.split("#").pop()}`,pr.service.push(br)});const yr=new BearerDid$2({uri:fr,document:pr,metadata:Object.assign({published:!1},At.types&&{types:At.types}),keyManager:e});if(!((ir=At.publish)!==null&&ir!==void 0)||ir){const br=yield Xs.publish({did:yr,gatewayUri:At.gatewayUri});yr.metadata=br.didDocumentMetadata}return yr})}static import(e){return __awaiter$2h(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager$4}){var Bt;const Nt=Did$2.parse(At.uri);if((Nt==null?void 0:Nt.method)!==Xs.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,"Method not supported");const jt=yield BearerDid$2.import({portableDid:At,keyManager:kt});if(!(!((Bt=jt.document.verificationMethod)===null||Bt===void 0)&&Bt.some(Lt=>{var er;return((er=Lt.id)===null||er===void 0?void 0:er.split("#").pop())==="0"})))throw new DidError$2(DidErrorCode$2.InvalidDidDocument,"DID document must contain an Identity Key");return jt})}static getSigningMethod(e){return __awaiter$2h(this,arguments,void 0,function*({didDocument:At,methodId:kt="#0"}){var Bt;const Nt=Did$2.parse(At.id);if(Nt&&Nt.method!==this.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${Nt.method}`);const jt=(Bt=At.verificationMethod)===null||Bt===void 0?void 0:Bt.find(Lt=>{var er,tr;return extractDidFragment$2(Lt.id)===((er=extractDidFragment$2(kt))!==null&&er!==void 0?er:extractDidFragment$2((tr=At.assertionMethod)===null||tr===void 0?void 0:tr[0]))});if(!(jt&&jt.publicKeyJwk))throw new DidError$2(DidErrorCode$2.InternalError,"A verification method intended for signing could not be determined from the DID Document");return jt})}static publish(e){return __awaiter$2h(this,arguments,void 0,function*({did:At,gatewayUri:kt=DEFAULT_GATEWAY_URI$5}){return yield DidDhtDocument$2.put({did:At,gatewayUri:kt})})}static resolve(e){return __awaiter$2h(this,arguments,void 0,function*(At,kt={}){var Bt;const Nt=(Bt=kt==null?void 0:kt.gatewayUri)!==null&&Bt!==void 0?Bt:DEFAULT_GATEWAY_URI$5;try{yield DidDhtUtils$2.identifierToIdentityKey({didUri:At});const{didDocument:jt,didDocumentMetadata:Lt}=yield DidDhtDocument$2.get({didUri:At,gatewayUri:Nt});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didDocument:jt,didDocumentMetadata:Lt})}catch(jt){if(!(jt instanceof DidError$2))throw new Error(jt);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:Object.assign({error:jt.code},jt.message&&{errorMessage:jt.message})})}})}};DidDht$2.methodName="dht";let DidDhtDocument$2=class cs{static get(e){return __awaiter$2h(this,arguments,void 0,function*({didUri:At,gatewayUri:kt}){const Bt=DidDhtUtils$2.identifierToIdentityKeyBytes({didUri:At}),Nt=yield cs.pkarrGet({gatewayUri:kt,publicKeyBytes:Bt}),jt=yield DidDhtUtils$2.parseBep44GetMessage({bep44Message:Nt}),Lt=yield cs.fromDnsPacket({didUri:At,dnsPacket:jt});return Lt.didDocumentMetadata.versionId=Nt.seq.toString(),Lt})}static put(e){return __awaiter$2h(this,arguments,void 0,function*({did:At,gatewayUri:kt}){const Bt=yield cs.toDnsPacket({didDocument:At.document,didMetadata:At.metadata,authoritativeGatewayUris:[kt]}),Nt=yield DidDhtUtils$2.createBep44PutMessage({dnsPacket:Bt,publicKeyBytes:DidDhtUtils$2.identifierToIdentityKeyBytes({didUri:At.uri}),signer:yield At.getSigner({methodId:"0"})}),jt=yield cs.pkarrPut({gatewayUri:kt,bep44Message:Nt});return{didDocument:At.document,didDocumentMetadata:Object.assign(Object.assign({},At.metadata),{published:jt,versionId:Nt.seq.toString()}),didRegistrationMetadata:{}}})}static pkarrGet(e){return __awaiter$2h(this,arguments,void 0,function*({gatewayUri:At,publicKeyBytes:kt}){const Bt=Convert$1.uint8Array(kt).toBase32Z(),Nt=new URL(Bt,At).href;let jt;try{if(jt=yield fetch(Nt,{method:"GET"}),!jt.ok)throw new DidError$2(DidErrorCode$2.NotFound,`Pkarr record not found for: ${Bt}`)}catch(tr){throw tr instanceof DidError$2?tr:new DidError$2(DidErrorCode$2.InternalError,`Failed to fetch Pkarr record: ${tr.message}`)}const Lt=yield jt.arrayBuffer();if(!Lt)throw new DidError$2(DidErrorCode$2.NotFound,`Pkarr record not found for: ${Bt}`);if(Lt.byteLength<72)throw new DidError$2(DidErrorCode$2.InvalidDidDocumentLength,`Pkarr response must be at least 72 bytes but got: ${Lt.byteLength}`);if(Lt.byteLength>1072)throw new DidError$2(DidErrorCode$2.InvalidDidDocumentLength,`Pkarr response exceeds 1000 byte limit: ${Lt.byteLength}`);return{k:kt,seq:Number(new DataView(Lt).getBigUint64(64)),sig:new Uint8Array(Lt,0,64),v:new Uint8Array(Lt,72)}})}static pkarrPut(e){return __awaiter$2h(this,arguments,void 0,function*({gatewayUri:At,bep44Message:kt}){const Bt=Convert$1.uint8Array(kt.k).toBase32Z(),Nt=new URL(Bt,At).href,jt=new Uint8Array(kt.v.length+72);jt.set(kt.sig,0),new DataView(jt.buffer).setBigUint64(kt.sig.length,BigInt(kt.seq)),jt.set(kt.v,kt.sig.length+8);let Lt;try{Lt=yield fetch(Nt,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:jt})}catch(er){throw new DidError$2(DidErrorCode$2.InternalError,`Failed to put Pkarr record for identifier ${Bt}: ${er.message}`)}return Lt.ok})}static fromDnsPacket(e){return __awaiter$2h(this,arguments,void 0,function*({didUri:At,dnsPacket:kt}){var Bt,Nt,jt;const Lt={id:At},er={published:!0},tr=new Map;for(const zt of(Bt=kt==null?void 0:kt.answers)!==null&&Bt!==void 0?Bt:[]){if(zt.type!=="TXT")continue;const rr=zt.name.split(".")[0].substring(1);switch(!0){case rr.startsWith("aka"):{const nr=DidDhtUtils$2.parseTxtDataToString(zt.data);Lt.alsoKnownAs=nr.split(VALUE_SEPARATOR$2);break}case rr.startsWith("cnt"):{const nr=DidDhtUtils$2.parseTxtDataToString(zt.data);Lt.controller=nr.includes(VALUE_SEPARATOR$2)?nr.split(VALUE_SEPARATOR$2):nr;break}case rr.startsWith("k"):{const{id:nr,t:ir,k:ar,c:dr,a:ur}=DidDhtUtils$2.parseTxtDataToObject(zt.data),fr=Convert$1.base64Url(ar).toUint8Array(),pr=DidDhtRegisteredKeyType$2[Number(ir)];let lr=yield DidDhtUtils$2.keyConverter(pr).bytesToPublicKey({publicKeyBytes:fr});lr.alg=ur||KeyTypeToDefaultAlgorithmMap$2[Number(ir)];const yr=rr==="k0"?"0":nr!==void 0?nr:yield computeJwkThumbprint$2({jwk:lr});(Nt=Lt.verificationMethod)!==null&&Nt!==void 0||(Lt.verificationMethod=[]);const br=`${At}#${yr}`;Lt.verificationMethod.push({id:br,type:"JsonWebKey",controller:dr??At,publicKeyJwk:lr}),tr.set(rr,br);break}case rr.startsWith("s"):{const nr=DidDhtUtils$2.parseTxtDataToObject(zt.data),{id:ir,t:ar,se:dr}=nr,ur=__rest$x(nr,["id","t","se"]),fr=dr.includes(VALUE_SEPARATOR$2)?dr.split(VALUE_SEPARATOR$2):[dr],pr=Object.fromEntries(Object.entries(ur).map(([lr,yr])=>[lr,yr.includes(VALUE_SEPARATOR$2)?yr.split(VALUE_SEPARATOR$2):yr]));(jt=Lt.service)!==null&&jt!==void 0||(Lt.service=[]),Lt.service.push(Object.assign(Object.assign({},pr),{id:`${At}#${ir}`,type:ar,serviceEndpoint:fr}));break}case rr.startsWith("typ"):{const{id:nr}=DidDhtUtils$2.parseTxtDataToObject(zt.data);er.types=nr.split(VALUE_SEPARATOR$2).map(ir=>Number(ir));break}case rr.startsWith("did"):{const nr=pr=>pr.split(VALUE_SEPARATOR$2).map(lr=>tr.get(lr)).filter(lr=>typeof lr=="string"),{auth:ir,asm:ar,del:dr,inv:ur,agm:fr}=DidDhtUtils$2.parseTxtDataToObject(zt.data);ir&&(Lt.authentication=nr(ir)),ar&&(Lt.assertionMethod=nr(ar)),dr&&(Lt.capabilityDelegation=nr(dr)),ur&&(Lt.capabilityInvocation=nr(ur)),fr&&(Lt.keyAgreement=nr(fr));break}}}return{didDocument:Lt,didDocumentMetadata:er,didResolutionMetadata:{}}})}static toDnsPacket(e){return __awaiter$2h(this,arguments,void 0,function*({didDocument:At,didMetadata:kt,authoritativeGatewayUris:Bt,previousDidProof:Nt}){var jt,Lt,er,tr,zt;const rr=[],nr=[],ir=new Map,ar=[],dr=[];if(Nt!==void 0){const{signature:pr,previousDid:lr}=Nt;yield DidDhtUtils$2.validatePreviousDidProof({newDid:At.id,previousDidProof:Nt}),rr.push({type:"TXT",name:"_prv._did.",ttl:DNS_RECORD_TTL$2,data:`id=${lr};s=${pr}`})}if(At.alsoKnownAs&&rr.push({type:"TXT",name:"_aka._did.",ttl:DNS_RECORD_TTL$2,data:At.alsoKnownAs.join(VALUE_SEPARATOR$2)}),At.controller){const pr=Array.isArray(At.controller)?At.controller.join(VALUE_SEPARATOR$2):At.controller;rr.push({type:"TXT",name:"_cnt._did.",ttl:DNS_RECORD_TTL$2,data:pr})}for(const[pr,lr]of(Lt=(jt=At.verificationMethod)===null||jt===void 0?void 0:jt.entries())!==null&&Lt!==void 0?Lt:[]){const yr=`k${pr}`;dr.push(yr);let br=lr.id.split("#").pop();ir.set(br,yr);const Ar=lr.publicKeyJwk;if(!(Ar!=null&&Ar.crv&&Ar.crv in AlgorithmToKeyTypeMap$8))throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Verification method '${lr.id}' contains an unsupported key type: ${(er=Ar==null?void 0:Ar.crv)!==null&&er!==void 0?er:"undefined"}`);const Pr=DidDhtRegisteredKeyType$2[Ar.crv],kr=yield DidDhtUtils$2.keyConverter(Ar.crv).publicKeyToBytes({publicKey:Ar}),Ur=Convert$1.uint8Array(kr).toBase64Url(),Hr=[`t=${Pr}`,`k=${Ur}`];br!=="0"&&(yield computeJwkThumbprint$2({jwk:Ar}))!==br&&Hr.unshift(`id=${br}`),Ar.alg!==KeyTypeToDefaultAlgorithmMap$2[Pr]&&Hr.push(`a=${Ar.alg}`),lr.controller!==At.id&&Hr.push(`c=${lr.controller}`),rr.push({type:"TXT",name:`_${yr}._did.`,ttl:DNS_RECORD_TTL$2,data:Hr.join(PROPERTY_SEPARATOR$2)})}(tr=At.service)===null||tr===void 0||tr.forEach((pr,lr)=>{const yr=`s${lr}`;ar.push(yr);let{id:br,type:Ar,serviceEndpoint:Pr}=pr,kr=__rest$x(pr,["id","type","serviceEndpoint"]);br=extractDidFragment$2(br),Pr=Array.isArray(Pr)?Pr.join(","):Pr;const Hr=Object.entries(Object.assign({id:br,t:Ar,se:Pr},kr)).map(([Sr,_r])=>`${Sr}=${_r}`).join(PROPERTY_SEPARATOR$2),Lr=DidDhtUtils$2.chunkDataIfNeeded(Hr);rr.push({type:"TXT",name:`_${yr}._did.`,ttl:DNS_RECORD_TTL$2,data:Lr})});const ur=[`v=${DID_DHT_SPECIFICATION_VERSION$2}`];if(dr.length&&ur.push(`vm=${dr.join(VALUE_SEPARATOR$2)}`),Object.keys(DidVerificationRelationship$2).forEach(pr=>{var lr;const yr=(lr=At[pr])===null||lr===void 0?void 0:lr.map(br=>ir.get(br.split("#").pop()));if(yr){const br=DidDhtVerificationRelationship$2[pr];ur.push(`${br}=${yr.join(VALUE_SEPARATOR$2)}`)}}),ar.length&&ur.push(`svc=${ar.join(VALUE_SEPARATOR$2)}`),!((zt=kt.types)===null||zt===void 0)&&zt.length){const lr=kt.types.map(yr=>typeof yr=="string"?DidDhtRegisteredDidType$2[yr]:yr);rr.push({type:"TXT",name:"_typ._did.",ttl:DNS_RECORD_TTL$2,data:`id=${lr.join(VALUE_SEPARATOR$2)}`})}rr.push({type:"TXT",name:"_did."+cs.getUniqueDidSuffix(At.id)+".",ttl:DNS_RECORD_TTL$2,data:ur.join(PROPERTY_SEPARATOR$2)});for(const pr of Bt||[])nr.push({type:"NS",name:"_did."+cs.getUniqueDidSuffix(At.id)+".",ttl:DNS_RECORD_TTL$2,data:pr+"."});return{id:0,type:"response",flags:AUTHORITATIVE_ANSWER,answers:[...rr,...nr]}})}static getUniqueDidSuffix(e){return e.split(":")[2]}},DidDhtUtils$2=class qs{static createBep44PutMessage(e){return __awaiter$2h(this,arguments,void 0,function*({dnsPacket:At,publicKeyBytes:kt,signer:Bt}){const Nt=Math.ceil(Date.now()/1e3),jt=encode$2(At),Lt=bencode.encode({seq:Nt,v:jt}).subarray(1,-1);if(Lt.length>1e3)throw new DidError$2(DidErrorCode$2.InvalidDidDocumentLength,`DNS packet exceeds the 1000 byte maximum size: ${Lt.length} bytes`);const er=yield Bt.sign({data:Lt});return{k:kt,seq:Nt,sig:er,v:jt}})}static identifierToIdentityKey(e){return __awaiter$2h(this,arguments,void 0,function*({didUri:At}){let kt=qs.identifierToIdentityKeyBytes({didUri:At});return yield Ed25519$2.bytesToPublicKey({publicKeyBytes:kt})})}static identifierToIdentityKeyBytes({didUri:e}){const At=Did$2.parse(e);if(!At)throw new DidError$2(DidErrorCode$2.InvalidDid,`Invalid DID URI: ${e}`);if(At.method!==DidDht$2.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${At.method}`);let kt;try{kt=Convert$1.base32Z(At.id).toUint8Array()}catch{throw new DidError$2(DidErrorCode$2.InvalidPublicKey,"Failed to decode method-specific identifier")}if(kt.length!==32)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyLength,`Invalid public key length: ${kt.length}`);return kt}static identityKeyToIdentifier(e){return __awaiter$2h(this,arguments,void 0,function*({identityKey:At}){const kt=yield Ed25519$2.publicKeyToBytes({publicKey:At}),Bt=Convert$1.uint8Array(kt).toBase32Z();return`did:${DidDht$2.methodName}:${Bt}`})}static keyConverter(e){const kt={Ed25519:Ed25519$2,"P-256":{publicKeyToBytes:Bt=>__awaiter$2h(this,[Bt],void 0,function*({publicKey:Nt}){const jt=yield Secp256r1$2.publicKeyToBytes({publicKey:Nt});return yield Secp256r1$2.compressPublicKey({publicKeyBytes:jt})}),bytesToPublicKey:Secp256r1$2.bytesToPublicKey,privateKeyToBytes:Secp256r1$2.privateKeyToBytes,bytesToPrivateKey:Secp256r1$2.bytesToPrivateKey},secp256k1:{publicKeyToBytes:Bt=>__awaiter$2h(this,[Bt],void 0,function*({publicKey:Nt}){const jt=yield Secp256k1$2.publicKeyToBytes({publicKey:Nt});return yield Secp256k1$2.compressPublicKey({publicKeyBytes:jt})}),bytesToPublicKey:Secp256k1$2.bytesToPublicKey,privateKeyToBytes:Secp256k1$2.privateKeyToBytes,bytesToPrivateKey:Secp256k1$2.bytesToPrivateKey},X25519:X25519$2}[e];if(!kt)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Unsupported curve: ${e}`);return kt}static parseBep44GetMessage(e){return __awaiter$2h(this,arguments,void 0,function*({bep44Message:At}){const kt=yield Ed25519$2.bytesToPublicKey({publicKeyBytes:At.k}),Bt=bencode.encode({seq:At.seq,v:At.v}).subarray(1,-1);if(!(yield Ed25519$2.verify({key:kt,signature:At.sig,data:Bt})))throw new DidError$2(DidErrorCode$2.InvalidSignature,"Invalid signature for DHT BEP44 message");return decode$1(At.v)})}static parseTxtDataToObject(e){return this.parseTxtDataToString(e).split(PROPERTY_SEPARATOR$2).reduce((At,kt)=>{const[Bt,Nt]=kt.split("=");return At[Bt]=Nt,At},{})}static parseTxtDataToString(e){if(typeof e=="string")return e;if(e instanceof Uint8Array)return Convert$1.uint8Array(e).toString();if(Array.isArray(e))return e.map(At=>this.parseTxtDataToString(At)).join("");throw new DidError$2(DidErrorCode$2.InternalError,"Pkarr returned DNS TXT record with invalid data type")}static validatePreviousDidProof(e){return __awaiter$2h(this,arguments,void 0,function*({newDid:At,previousDidProof:kt}){const Bt=yield qs.identifierToIdentityKey({didUri:kt.previousDid}),Nt=qs.identifierToIdentityKeyBytes({didUri:At}),jt=Convert$1.base64Url(kt.signature).toUint8Array();if(!(yield Ed25519$2.verify({key:Bt,data:Nt,signature:jt})))throw new DidError$2(DidErrorCode$2.InvalidPreviousDidProof,"The previous DID proof is invalid.")})}static chunkDataIfNeeded(e){if(e.length<=255)return e;const At=[];for(let kt=0;kt<e.length;kt+=255)At.push(e.slice(kt,kt+255));return At}};const ErrorCode={DeltaExceedsMaximumSize:"DeltaExceedsMaximumSize",DidDocumentPublicKeyIdDuplicated:"DidDocumentPublicKeyIdDuplicated",DidDocumentPublicKeyMissingOrIncorrectType:"DidDocumentPublicKeyMissingOrIncorrectType",DidDocumentServiceIdDuplicated:"DidDocumentServiceIdDuplicated",DidSuffixIncorrectLength:"DidSuffixIncorrectLength",EncodedStringIncorrectEncoding:"EncodedStringIncorrectEncoding",IdNotUsingBase64UrlCharacterSet:"IdNotUsingBase64UrlCharacterSet",IdTooLong:"IdTooLong",JwkEs256kMissingOrInvalidCrv:"JwkEs256kMissingOrInvalidCrv",JwkEs256kMissingOrInvalidKty:"JwkEs256kMissingOrInvalidKty",JwkEs256kHasIncorrectLengthOfX:"JwkEs256kHasIncorrectLengthOfX",JwkEs256kHasIncorrectLengthOfY:"JwkEs256kHasIncorrectLengthOfY",JwkEs256kHasIncorrectLengthOfD:"JwkEs256kHasIncorrectLengthOfD",MultihashStringNotAMultihash:"MultihashStringNotAMultihash",MultihashUnsupportedHashAlgorithm:"MultihashUnsupportedHashAlgorithm",PublicKeyJwkEs256kHasUnexpectedProperty:"PublicKeyJwkEs256kHasUnexpectedProperty",PublicKeyPurposeDuplicated:"PublicKeyPurposeDuplicated",ServiceEndpointCannotBeAnArray:"ServiceEndpointCannotBeAnArray",ServiceEndpointStringNotValidUri:"ServiceEndpointStringNotValidUri",ServiceTypeTooLong:"ServiceTypeTooLong"};class IonError extends Error{constructor(e,At){super(`${e}: ${At}`),this.code=e,Object.setPrototypeOf(this,new.target.prototype)}}class Encoder{static encode(e){return base64url$1.baseEncode(e)}static decodeAsBytes(e,At){if(!Encoder.isBase64UrlString(e))throw new IonError(ErrorCode.EncodedStringIncorrectEncoding,`Given ${At} must be base64url string.`);return base64url$1.baseDecode(e)}static decodeAsString(e,At){const kt=Encoder.decodeAsBytes(e,At);return Encoder.bytesToString(kt)}static isBase64UrlString(e){return/^[A-Za-z0-9_-]+$/.test(e)}static stringToBytes(e){return new TextEncoder().encode(e)}static bytesToString(e){return new TextDecoder().decode(e)}}var OperationKeyType;(function(xt){xt.Public="public",xt.Private="private"})(OperationKeyType||(OperationKeyType={}));const OperationKeyType$1=OperationKeyType;class InputValidator{static validateEs256kOperationKey(e,At){const kt=new Set(["kty","crv","x","y"]);At===OperationKeyType$1.Private&&kt.add("d");for(const Bt in e)if(!kt.has(Bt))throw new IonError(ErrorCode.PublicKeyJwkEs256kHasUnexpectedProperty,`SECP256K1 JWK key has unexpected property '${Bt}'.`);if(e.crv!=="secp256k1")throw new IonError(ErrorCode.JwkEs256kMissingOrInvalidCrv,`SECP256K1 JWK 'crv' property must be 'secp256k1' but got '${e.crv}.'`);if(e.kty!=="EC")throw new IonError(ErrorCode.JwkEs256kMissingOrInvalidKty,`SECP256K1 JWK 'kty' property must be 'EC' but got '${e.kty}.'`);if(e.x.length!==43)throw new IonError(ErrorCode.JwkEs256kHasIncorrectLengthOfX,"SECP256K1 JWK 'x' property must be 43 bytes.");if(e.y.length!==43)throw new IonError(ErrorCode.JwkEs256kHasIncorrectLengthOfY,"SECP256K1 JWK 'y' property must be 43 bytes.");if(At===OperationKeyType$1.Private&&(e.d===void 0||e.d.length!==43))throw new IonError(ErrorCode.JwkEs256kHasIncorrectLengthOfD,"SECP256K1 JWK 'd' property must be 43 bytes.")}static validateId(e){if(e.length>50)throw new IonError(ErrorCode.IdTooLong,`Key ID length ${e.length} exceed max allowed length of 50.`);if(!Encoder.isBase64UrlString(e))throw new IonError(ErrorCode.IdNotUsingBase64UrlCharacterSet,`Key ID '${e}' is not a Base64URL string.`)}static validatePublicKeyPurposes(e){if(e===void 0)return;const At=new Set;for(const kt of e){if(At.has(kt))throw new IonError(ErrorCode.PublicKeyPurposeDuplicated,`Public key purpose '${kt}' already specified.`);At.add(kt)}}}class IonSdkConfig{}IonSdkConfig.hashAlgorithmInMultihashCode=18;IonSdkConfig.maxCanonicalizedDeltaSizeInBytes=1e3;var canonicalize$2=function xt(e){if(typeof e=="number"&&isNaN(e))throw new Error("NaN is not allowed");if(typeof e=="number"&&!isFinite(e))throw new Error("Infinity is not allowed");return e===null||typeof e!="object"?JSON.stringify(e):e.toJSON instanceof Function?xt(e.toJSON()):Array.isArray(e)?`[${e.reduce((Bt,Nt,jt)=>`${Bt}${jt===0?"":","}${xt(Nt===void 0||typeof Nt=="symbol"?null:Nt)}`,"")}]`:`{${Object.keys(e).sort().reduce((kt,Bt)=>{if(e[Bt]===void 0||typeof e[Bt]=="symbol")return kt;const Nt=kt.length===0?"":",";return`${kt}${Nt}${xt(Bt)}:${xt(e[Bt])}`},"")}}`};const canonicalize$3=getDefaultExportFromCjs(canonicalize$2);class JsonCanonicalizer{static canonicalizeAsBytes(e){const At=JsonCanonicalizer.removeAllUndefinedProperties(e),kt=canonicalize$3(At);return Encoder.stringToBytes(kt)}static removeAllUndefinedProperties(e){for(const At in e)typeof e[At]=="object"?JsonCanonicalizer.removeAllUndefinedProperties(e[At]):e[At]===void 0&&delete e[At];return e}}var __awaiter$2g=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Multihash{static hash(e,At){return __awaiter$2g(this,void 0,void 0,function*(){let kt;switch(At){case 18:kt=(yield sha256$4.digest(e)).bytes;break;default:throw new IonError(ErrorCode.MultihashUnsupportedHashAlgorithm,`Hash algorithm defined in multihash code ${At} is not supported.`)}return kt})}static hashAsNonMultihashBytes(e,At){return __awaiter$2g(this,void 0,void 0,function*(){let kt;switch(At){case 18:kt=yield sha256$4.encode(e);break;default:throw new IonError(ErrorCode.MultihashUnsupportedHashAlgorithm,`Hash algorithm defined in multihash code ${At} is not supported.`)}return kt})}static canonicalizeThenHashThenEncode(e,At){return __awaiter$2g(this,void 0,void 0,function*(){const kt=JsonCanonicalizer.canonicalizeAsBytes(e);return yield Multihash.hashThenEncode(kt,At)})}static canonicalizeThenDoubleHashThenEncode(e,At){return __awaiter$2g(this,void 0,void 0,function*(){const kt=JsonCanonicalizer.canonicalizeAsBytes(e),Bt=yield Multihash.hashAsNonMultihashBytes(kt,At);return yield Multihash.hashThenEncode(Bt,At)})}static hashThenEncode(e,At){return __awaiter$2g(this,void 0,void 0,function*(){const kt=yield Multihash.hash(e,At);return Encoder.encode(kt)})}static validateEncodedHashComputedUsingSupportedHashAlgorithm(e,At){let kt;const Bt=Encoder.decodeAsBytes(e,At);try{kt=decode$c(Bt)}catch{throw new IonError(ErrorCode.MultihashStringNotAMultihash,`Given ${At} string '${e}' is not a multihash after decoding.`)}const Nt=IonSdkConfig.hashAlgorithmInMultihashCode;if(Nt!==kt.code)throw new IonError(ErrorCode.MultihashUnsupportedHashAlgorithm,`Given ${At} uses unsupported multihash algorithm with code ${kt.code}, should use ${Nt} or change IonSdkConfig to desired hashing algorithm.`)}}var OperationType;(function(xt){xt.Create="create",xt.Update="update",xt.Deactivate="deactivate",xt.Recover="recover"})(OperationType||(OperationType={}));const OperationType$1=OperationType;var PatchAction;(function(xt){xt.Replace="replace",xt.AddPublicKeys="add-public-keys",xt.RemovePublicKeys="remove-public-keys",xt.AddServices="add-services",xt.RemoveServices="remove-services"})(PatchAction||(PatchAction={}));const PatchAction$1=PatchAction;var __awaiter$2f=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class IonRequest{static createCreateRequest(e){return __awaiter$2f(this,void 0,void 0,function*(){const At=e.recoveryKey,kt=e.updateKey,Bt=e.document.publicKeys,Nt=e.document.services;InputValidator.validateEs256kOperationKey(At,OperationKeyType$1.Public),InputValidator.validateEs256kOperationKey(kt,OperationKeyType$1.Public),IonRequest.validateDidDocumentKeys(Bt),IonRequest.validateServices(Nt);const jt=IonSdkConfig.hashAlgorithmInMultihashCode,Lt=[{action:PatchAction$1.Replace,document:e.document}],er={updateCommitment:yield Multihash.canonicalizeThenDoubleHashThenEncode(kt,jt),patches:Lt};IonRequest.validateDeltaSize(er);const zt={deltaHash:yield Multihash.canonicalizeThenHashThenEncode(er,jt),recoveryCommitment:yield Multihash.canonicalizeThenDoubleHashThenEncode(At,jt)};return{type:OperationType$1.Create,suffixData:zt,delta:er}})}static createDeactivateRequest(e){return __awaiter$2f(this,void 0,void 0,function*(){IonRequest.validateDidSuffix(e.didSuffix),InputValidator.validateEs256kOperationKey(e.recoveryPublicKey,OperationKeyType$1.Public);const At=IonSdkConfig.hashAlgorithmInMultihashCode,kt=yield Multihash.canonicalizeThenHashThenEncode(e.recoveryPublicKey,At),Bt={didSuffix:e.didSuffix,recoveryKey:e.recoveryPublicKey},Nt=yield e.signer.sign({alg:"ES256K"},Bt);return{type:OperationType$1.Deactivate,didSuffix:e.didSuffix,revealValue:kt,signedData:Nt}})}static createRecoverRequest(e){return __awaiter$2f(this,void 0,void 0,function*(){IonRequest.validateDidSuffix(e.didSuffix),InputValidator.validateEs256kOperationKey(e.recoveryPublicKey,OperationKeyType$1.Public),InputValidator.validateEs256kOperationKey(e.nextRecoveryPublicKey,OperationKeyType$1.Public),InputValidator.validateEs256kOperationKey(e.nextUpdatePublicKey,OperationKeyType$1.Public),IonRequest.validateDidDocumentKeys(e.document.publicKeys),IonRequest.validateServices(e.document.services);const At=IonSdkConfig.hashAlgorithmInMultihashCode,kt=yield Multihash.canonicalizeThenHashThenEncode(e.recoveryPublicKey,At),Bt=[{action:PatchAction$1.Replace,document:e.document}],Nt=yield Multihash.canonicalizeThenDoubleHashThenEncode(e.nextUpdatePublicKey,At),jt={patches:Bt,updateCommitment:Nt},Lt=yield Multihash.canonicalizeThenHashThenEncode(jt,At),tr={recoveryCommitment:yield Multihash.canonicalizeThenDoubleHashThenEncode(e.nextRecoveryPublicKey,At),recoveryKey:e.recoveryPublicKey,deltaHash:Lt},zt=yield e.signer.sign({alg:"ES256K"},tr);return{type:OperationType$1.Recover,didSuffix:e.didSuffix,revealValue:kt,delta:jt,signedData:zt}})}static createUpdateRequest(e){return __awaiter$2f(this,void 0,void 0,function*(){if(IonRequest.validateDidSuffix(e.didSuffix),InputValidator.validateEs256kOperationKey(e.updatePublicKey,OperationKeyType$1.Public),InputValidator.validateEs256kOperationKey(e.nextUpdatePublicKey,OperationKeyType$1.Public),IonRequest.validateServices(e.servicesToAdd),IonRequest.validateDidDocumentKeys(e.publicKeysToAdd),e.idsOfServicesToRemove!==void 0)for(const ar of e.idsOfServicesToRemove)InputValidator.validateId(ar);if(e.idsOfPublicKeysToRemove!==void 0)for(const ar of e.idsOfPublicKeysToRemove)InputValidator.validateId(ar);const At=[],kt=e.servicesToAdd;if(kt!==void 0&&kt.length>0){const ar={action:PatchAction$1.AddServices,services:kt};At.push(ar)}const Bt=e.idsOfServicesToRemove;if(Bt!==void 0&&Bt.length>0){const ar={action:PatchAction$1.RemoveServices,ids:Bt};At.push(ar)}const Nt=e.publicKeysToAdd;if(Nt!==void 0&&Nt.length>0){const ar={action:PatchAction$1.AddPublicKeys,publicKeys:Nt};At.push(ar)}const jt=e.idsOfPublicKeysToRemove;if(jt!==void 0&&jt.length>0){const ar={action:PatchAction$1.RemovePublicKeys,ids:jt};At.push(ar)}const Lt=IonSdkConfig.hashAlgorithmInMultihashCode,er=yield Multihash.canonicalizeThenHashThenEncode(e.updatePublicKey,Lt),tr=yield Multihash.canonicalizeThenDoubleHashThenEncode(e.nextUpdatePublicKey,Lt),zt={patches:At,updateCommitment:tr},rr=yield Multihash.canonicalizeThenHashThenEncode(zt,Lt),nr={updateKey:e.updatePublicKey,deltaHash:rr},ir=yield e.signer.sign({alg:"ES256K"},nr);return{type:OperationType$1.Update,didSuffix:e.didSuffix,revealValue:er,delta:zt,signedData:ir}})}static validateDidSuffix(e){Multihash.validateEncodedHashComputedUsingSupportedHashAlgorithm(e,"didSuffix")}static validateDidDocumentKeys(e){if(e===void 0)return;const At=new Set;for(const kt of e){if(Array.isArray(kt.publicKeyJwk))throw new IonError(ErrorCode.DidDocumentPublicKeyMissingOrIncorrectType,"DID Document key 'publicKeyJwk' property is not a non-array object.");if(InputValidator.validateId(kt.id),At.has(kt.id))throw new IonError(ErrorCode.DidDocumentPublicKeyIdDuplicated,`DID Document key with ID '${kt.id}' already exists.`);At.add(kt.id),InputValidator.validatePublicKeyPurposes(kt.purposes)}}static validateServices(e){if(e!==void 0&&e.length!==0){const At=new Set;for(const kt of e){if(IonRequest.validateService(kt),At.has(kt.id))throw new IonError(ErrorCode.DidDocumentServiceIdDuplicated,"Service id has to be unique");At.add(kt.id)}}}static validateService(e){InputValidator.validateId(e.id);const At=30;if(e.type.length>At){const kt=`Service endpoint type length ${e.type.length} exceeds max allowed length of ${At}.`;throw new IonError(ErrorCode.ServiceTypeTooLong,kt)}if(Array.isArray(e.serviceEndpoint)){const kt="Service endpoint value cannot be an array.";throw new IonError(ErrorCode.ServiceEndpointCannotBeAnArray,kt)}if(typeof e.serviceEndpoint=="string"&&uri_allExports.parse(e.serviceEndpoint).error!==void 0)throw new IonError(ErrorCode.ServiceEndpointStringNotValidUri,`Service endpoint string '${e.serviceEndpoint}' is not a URI.`)}static validateDeltaSize(e){const At=JsonCanonicalizer.canonicalizeAsBytes(e);if(At.length>IonSdkConfig.maxCanonicalizedDeltaSizeInBytes){const kt=`Delta of ${At.length} bytes exceeded limit of ${IonSdkConfig.maxCanonicalizedDeltaSizeInBytes} bytes.`;throw new IonError(ErrorCode.DeltaExceedsMaximumSize,kt)}}}var __awaiter$2e=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class IonDid{static createLongFormDid(e){return __awaiter$2e(this,void 0,void 0,function*(){const At=yield IonRequest.createCreateRequest(e),kt=yield IonDid.computeDidUniqueSuffix(At.suffixData);let Bt;IonSdkConfig.network===void 0||IonSdkConfig.network==="mainnet"?Bt=`did:ion:${kt}`:Bt=`did:ion:${IonSdkConfig.network}:${kt}`;const Nt={suffixData:At.suffixData,delta:At.delta},jt=JsonCanonicalizer.canonicalizeAsBytes(Nt),Lt=Encoder.encode(jt);return`${Bt}:${Lt}`})}static computeDidUniqueSuffix(e){return __awaiter$2e(this,void 0,void 0,function*(){const At=JsonCanonicalizer.canonicalizeAsBytes(e),kt=yield Multihash.hash(At,IonSdkConfig.hashAlgorithmInMultihashCode);return Encoder.encode(kt)})}}var IonNetwork;(function(xt){xt.Mainnet="mainnet",xt.Testnet="test"})(IonNetwork||(IonNetwork={}));var IonPublicKeyPurpose;(function(xt){xt.Authentication="authentication",xt.AssertionMethod="assertionMethod",xt.CapabilityInvocation="capabilityInvocation",xt.CapabilityDelegation="capabilityDelegation",xt.KeyAgreement="keyAgreement"})(IonPublicKeyPurpose||(IonPublicKeyPurpose={}));var __awaiter$2d=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},DidIonRegisteredKeyType$2;(function(xt){xt.Ed25519="Ed25519",xt.secp256k1="secp256k1",xt.secp256r1="secp256r1",xt.X25519="X25519"})(DidIonRegisteredKeyType$2||(DidIonRegisteredKeyType$2={}));const AlgorithmToKeyTypeMap$7={Ed25519:DidIonRegisteredKeyType$2.Ed25519,ES256K:DidIonRegisteredKeyType$2.secp256k1,ES256:DidIonRegisteredKeyType$2.secp256r1,"P-256":DidIonRegisteredKeyType$2.secp256r1,secp256k1:DidIonRegisteredKeyType$2.secp256k1,secp256r1:DidIonRegisteredKeyType$2.secp256r1},DEFAULT_GATEWAY_URI$4="https://ion.tbd.engineering";let DidIon$2=class ks extends DidMethod$2{static create(){return __awaiter$2d(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$4,options:At={}}={}){var kt,Bt,Nt,jt,Lt,er,tr;if(!((kt=At.verificationMethods)===null||kt===void 0)&&kt.some(br=>!(br.algorithm in AlgorithmToKeyTypeMap$7)))throw new Error("One or more verification method algorithms are not supported");const zt=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt.filter(br=>"id"in br).map(br=>br.id);if(zt&&zt.length!==new Set(zt).size)throw new Error("One or more verification method IDs are not unique");if(!((Nt=At.services)===null||Nt===void 0)&&Nt.some(br=>!br.id||!br.type||!br.serviceEndpoint))throw new Error("One or more services are missing required properties");const rr={algorithm:"Ed25519",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]},nr=[];for(const br of(jt=At.verificationMethods)!==null&&jt!==void 0?jt:[rr]){const Ar=yield e.generateKey({algorithm:br.algorithm}),Pr=yield e.getPublicKey({keyUri:Ar});nr.push({id:br.id,publicKeyJwk:Pr,purposes:(Lt=br.purposes)!==null&&Lt!==void 0?Lt:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]})}const ir=yield e.generateKey({algorithm:DidIonRegisteredKeyType$2.secp256k1}),ar=yield e.getPublicKey({keyUri:ir}),dr=yield e.generateKey({algorithm:DidIonRegisteredKeyType$2.secp256k1}),ur=yield e.getPublicKey({keyUri:dr}),fr=yield DidIonUtils$2.computeLongFormDidUri({recoveryKey:ar,updateKey:ur,services:(er=At.services)!==null&&er!==void 0?er:[],verificationMethods:nr}),{didDocument:pr,didResolutionMetadata:lr}=yield ks.resolve(fr,{gatewayUri:At.gatewayUri});if(pr===null)throw new Error(`Unable to resolve DID during creation: ${lr==null?void 0:lr.error}`);const yr=new BearerDid$2({uri:fr,document:pr,metadata:{published:!1,canonicalId:fr.split(":",3).join(":"),recoveryKey:ar,updateKey:ur},keyManager:e});if(!((tr=At.publish)!==null&&tr!==void 0)||tr){const br=yield ks.publish({did:yr,gatewayUri:At.gatewayUri});yr.metadata=br.didDocumentMetadata}return yr})}static getSigningMethod(e){return __awaiter$2d(this,arguments,void 0,function*({didDocument:At,methodId:kt}){var Bt;const Nt=Did$2.parse(At.id);if(Nt&&Nt.method!==this.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${Nt.method}`);const jt=(Bt=At.verificationMethod)===null||Bt===void 0?void 0:Bt.find(Lt=>{var er;return Lt.id===(kt??((er=At.assertionMethod)===null||er===void 0?void 0:er[0]))});if(!(jt&&jt.publicKeyJwk))throw new DidError$2(DidErrorCode$2.InternalError,"A verification method intended for signing could not be determined from the DID Document");return jt})}static import(e){return __awaiter$2d(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager$4}){const Bt=Did$2.parse(At.uri);if((Bt==null?void 0:Bt.method)!==ks.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,"Method not supported");return yield BearerDid$2.import({portableDid:At,keyManager:kt})})}static publish(e){return __awaiter$2d(this,arguments,void 0,function*({did:At,gatewayUri:kt=DEFAULT_GATEWAY_URI$4}){var Bt,Nt,jt;const Lt=(Nt=(Bt=At.document.verificationMethod)===null||Bt===void 0?void 0:Bt.map(zt=>({id:zt.id,publicKeyJwk:zt.publicKeyJwk,purposes:getVerificationRelationshipsById$2({didDocument:At.document,methodId:zt.id})})))!==null&&Nt!==void 0?Nt:[],er=yield DidIonUtils$2.createIonDocument({services:(jt=At.document.service)!==null&&jt!==void 0?jt:[],verificationMethods:Lt}),tr=yield DidIonUtils$2.constructCreateRequest({ionDocument:er,recoveryKey:At.metadata.recoveryKey,updateKey:At.metadata.updateKey});try{const zt=DidIonUtils$2.appendPathToUrl({baseUrl:kt,path:"/operations"}),rr=yield fetch(zt,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(tr)});return{didDocument:At.document,didDocumentMetadata:Object.assign(Object.assign({},At.metadata),{published:rr.ok}),didRegistrationMetadata:{}}}catch{return{didDocument:null,didDocumentMetadata:{published:!1},didRegistrationMetadata:{error:DidErrorCode$2.InternalError,errorMessage:`Failed to publish DID document for: ${At.uri}`}}}})}static resolve(e){return __awaiter$2d(this,arguments,void 0,function*(At,kt={}){var Bt,Nt;const jt=Did$2.parse(At);if(!jt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"invalidDid"}});if(jt.method!==ks.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"methodNotSupported"}});const Lt=(Bt=kt==null?void 0:kt.gatewayUri)!==null&&Bt!==void 0?Bt:DEFAULT_GATEWAY_URI$4;try{const er=DidIonUtils$2.appendPathToUrl({baseUrl:Lt,path:`/identifiers/${At}`}),tr=yield fetch(er);if(!tr.ok)throw new DidError$2(DidErrorCode$2.NotFound,`Unable to find DID document for: ${At}`);const{didDocument:zt,didDocumentMetadata:rr}=yield tr.json();return Object.assign(Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),zt&&{didDocument:zt}),{didDocumentMetadata:Object.assign({published:(Nt=rr==null?void 0:rr.method)===null||Nt===void 0?void 0:Nt.published},rr)})}catch(er){if(!(er instanceof DidError$2))throw new Error(er);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:Object.assign({error:er.code},er.message&&{errorMessage:er.message})})}})}};DidIon$2.methodName="ion";let DidIonUtils$2=class ds{static appendPathToUrl({baseUrl:e,path:At}){const kt=new URL(e);return kt.pathname=kt.pathname.endsWith("/")?kt.pathname:kt.pathname+"/",kt.pathname+=At.startsWith("/")?At.substring(1):At,kt.toString()}static computeLongFormDidUri(e){return __awaiter$2d(this,arguments,void 0,function*({recoveryKey:At,updateKey:kt,services:Bt,verificationMethods:Nt}){const jt=yield ds.createIonDocument({services:Bt,verificationMethods:Nt}),Lt=ds.normalizeJwk(At),er=ds.normalizeJwk(kt);return yield IonDid.createLongFormDid({document:jt,recoveryKey:Lt,updateKey:er})})}static constructCreateRequest(e){return __awaiter$2d(this,arguments,void 0,function*({ionDocument:At,recoveryKey:kt,updateKey:Bt}){return yield IonRequest.createCreateRequest({document:At,recoveryKey:ds.normalizeJwk(kt),updateKey:ds.normalizeJwk(Bt)})})}static createIonDocument(e){return __awaiter$2d(this,arguments,void 0,function*({services:At,verificationMethods:kt}){var Bt,Nt;const jt=[];for(const tr of kt){let zt=(Nt=(Bt=tr.id)!==null&&Bt!==void 0?Bt:tr.publicKeyJwk.kid)!==null&&Nt!==void 0?Nt:yield computeJwkThumbprint$2({jwk:tr.publicKeyJwk});zt=`${zt.split("#").pop()}`;const rr={id:zt,publicKeyJwk:ds.normalizeJwk(tr.publicKeyJwk),purposes:tr.purposes,type:"JsonWebKey2020"};jt.push(rr)}const Lt=At.map(tr=>Object.assign(Object.assign({},tr),{id:`${tr.id.split("#").pop()}`}));return{publicKeys:jt,services:Lt}})}static normalizeJwk(e){const At=e.kty;let kt;if(At==="EC")kt={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(At==="oct")kt={k:e.k,kty:e.kty};else if(At==="OKP")kt={crv:e.crv,kty:e.kty,x:e.x};else if(At==="RSA")kt={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${At}`);return kt}};var __awaiter$2c=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DidJwk$2=class Cs extends DidMethod$2{static create(){return __awaiter$2c(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$4,options:At={}}={}){var kt,Bt,Nt,jt;if(At.algorithm&&At.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(At.verificationMethods&&At.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Lt=(jt=(kt=At.algorithm)!==null&&kt!==void 0?kt:(Nt=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt[0])===null||Nt===void 0?void 0:Nt.algorithm)!==null&&jt!==void 0?jt:"Ed25519",er=yield e.generateKey({algorithm:Lt}),tr=yield e.getPublicKey({keyUri:er}),zt=Convert$1.object(tr).toBase64Url(),rr=`did:${Cs.methodName}:${zt}`,ir=(yield Cs.resolve(rr)).didDocument;return new BearerDid$2({uri:rr,document:ir,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$2c(this,arguments,void 0,function*({didDocument:At}){var kt;const Bt=Did$2.parse(At.id);if(Bt&&Bt.method!==this.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${Bt.method}`);const[Nt]=(kt=At.verificationMethod)!==null&&kt!==void 0?kt:[];if(!(Nt&&Nt.publicKeyJwk))throw new DidError$2(DidErrorCode$2.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Nt})}static import(e){return __awaiter$2c(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager$4}){const Bt=Did$2.parse(At.uri);if((Bt==null?void 0:Bt.method)!==Cs.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,"Method not supported");const Nt=yield BearerDid$2.import({portableDid:At,keyManager:kt});if(Nt.document.verificationMethod.length!==1)throw new DidError$2(DidErrorCode$2.InvalidDidDocument,"DID document must contain exactly one verification method");return Nt})}static resolve(e,At){return __awaiter$2c(this,void 0,void 0,function*(){const kt=Did$2.parse(e);let Bt;try{Bt=Convert$1.base64Url(kt.id).toObject()}catch{}if(!kt||!Bt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"invalidDid"}});if(kt.method!==Cs.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"methodNotSupported"}});const Nt={"@context":["https://www.w3.org/ns/did/v1"],id:kt.uri},jt=`${Nt.id}#0`;switch(Nt.verificationMethod=[{id:jt,type:"JsonWebKey",controller:Nt.id,publicKeyJwk:Bt}],Nt.authentication=[jt],Nt.assertionMethod=[jt],Nt.capabilityInvocation=[jt],Nt.capabilityDelegation=[jt],Nt.keyAgreement=[jt],Bt.use){case"sig":{delete Nt.keyAgreement;break}case"enc":{delete Nt.authentication,delete Nt.assertionMethod,delete Nt.capabilityInvocation,delete Nt.capabilityDelegation;break}}return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didDocument:Nt})})}};DidJwk$2.methodName="jwk";var __awaiter$2b=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},DidKeyRegisteredKeyType$2;(function(xt){xt.Ed25519="Ed25519",xt.secp256k1="secp256k1",xt.secp256r1="secp256r1",xt.X25519="X25519"})(DidKeyRegisteredKeyType$2||(DidKeyRegisteredKeyType$2={}));const DidKeyVerificationMethodType$2={Ed25519VerificationKey2020:"https://w3id.org/security/suites/ed25519-2020/v1",JsonWebKey2020:"https://w3id.org/security/suites/jws-2020/v1",X25519KeyAgreementKey2020:"https://w3id.org/security/suites/x25519-2020/v1"},AlgorithmToKeyTypeMap$6={Ed25519:DidKeyRegisteredKeyType$2.Ed25519,ES256K:DidKeyRegisteredKeyType$2.secp256k1,ES256:DidKeyRegisteredKeyType$2.secp256r1,"P-256":DidKeyRegisteredKeyType$2.secp256r1,secp256k1:DidKeyRegisteredKeyType$2.secp256k1,secp256r1:DidKeyRegisteredKeyType$2.secp256r1,X25519:DidKeyRegisteredKeyType$2.X25519};let DidKey$2=class Wo extends DidMethod$2{static create(){return __awaiter$2b(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$4,options:At={}}={}){var kt,Bt,Nt,jt;if(At.algorithm&&At.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(At.verificationMethods&&At.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Lt=(jt=(kt=At.algorithm)!==null&&kt!==void 0?kt:(Nt=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt[0])===null||Nt===void 0?void 0:Nt.algorithm)!==null&&jt!==void 0?jt:"Ed25519",er=yield e.generateKey({algorithm:Lt}),tr=yield e.getPublicKey({keyUri:er}),zt=yield DidKeyUtils$2.publicKeyToMultibaseId({publicKey:tr}),rr=`did:${Wo.methodName}:${zt}`,ir=(yield Wo.resolve(rr,At)).didDocument;return new BearerDid$2({uri:rr,document:ir,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$2b(this,arguments,void 0,function*({didDocument:At}){var kt;const Bt=Did$2.parse(At.id);if(Bt&&Bt.method!==this.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${Bt.method}`);const[Nt]=At.assertionMethod||[],jt=(kt=At.verificationMethod)===null||kt===void 0?void 0:kt.find(Lt=>Lt.id===Nt);if(!(jt&&jt.publicKeyJwk))throw new DidError$2(DidErrorCode$2.InternalError,"A verification method intended for signing could not be determined from the DID Document");return jt})}static import(e){return __awaiter$2b(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager$4}){const Bt=Did$2.parse(At.uri);if((Bt==null?void 0:Bt.method)!==Wo.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,"Method not supported");const Nt=yield BearerDid$2.import({portableDid:At,keyManager:kt});if(Nt.document.verificationMethod.length!==1)throw new DidError$2(DidErrorCode$2.InvalidDidDocument,"DID document must contain exactly one verification method");return Nt})}static resolve(e,At){return __awaiter$2b(this,void 0,void 0,function*(){try{const kt=yield Wo.createDocument({didUri:e,options:At});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didDocument:kt})}catch(kt){if(!(kt instanceof DidError$2))throw new Error(kt);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:Object.assign({error:kt.code},kt.message&&{errorMessage:kt.message})})}})}static createDocument(e){return __awaiter$2b(this,arguments,void 0,function*({didUri:At,options:kt={}}){const{defaultContext:Bt="https://www.w3.org/ns/did/v1",enableEncryptionKeyDerivation:Nt=!1,enableExperimentalPublicKeyTypes:jt=!1,publicKeyFormat:Lt="JsonWebKey2020"}=kt,er={id:""},tr=Did$2.parse(At);if(!tr)throw new DidError$2(DidErrorCode$2.InvalidDid,`Invalid DID URI: ${At}`);const zt=tr.id;if(tr.method!==Wo.methodName)throw new DidError$2(DidErrorCode$2.MethodNotSupported,`Method not supported: ${tr.method}`);if(!Wo.validateIdentifier(tr))throw new DidError$2(DidErrorCode$2.InvalidDid,`Invalid DID URI: ${At}`);const rr=yield Wo.createSignatureMethod({didUri:At,multibaseValue:zt,options:{enableExperimentalPublicKeyTypes:jt,publicKeyFormat:Lt}});if(er.id=tr.uri,er.verificationMethod=[rr],er.authentication=[rr.id],er.assertionMethod=[rr.id],er.capabilityInvocation=[rr.id],er.capabilityDelegation=[rr.id],Nt===!0){const ar=Lt==="Ed25519VerificationKey2020"?"X25519KeyAgreementKey2020":"JsonWebKey2020",dr=yield this.createEncryptionMethod({didUri:At,multibaseValue:zt,options:{enableExperimentalPublicKeyTypes:jt,publicKeyFormat:ar}});er.verificationMethod.push(dr),er.keyAgreement=[dr.id]}const nr=[Bt];return getVerificationMethodTypes$2({didDocument:er}).forEach(ar=>{const dr=DidKeyVerificationMethodType$2[ar];nr.push(dr)}),er["@context"]=nr,er})}static createEncryptionMethod(e){return __awaiter$2b(this,arguments,void 0,function*({didUri:At,multibaseValue:kt,options:Bt}){const{enableExperimentalPublicKeyTypes:Nt,publicKeyFormat:jt}=Bt,Lt={id:"",type:"",controller:""},{keyBytes:er,multicodecCode:tr}=yield Wo.deriveEncryptionKey({multibaseValue:kt}),zt=er.byteLength,rr=DidKeyUtils$2.MULTICODEC_PUBLIC_KEY_LENGTH[tr];if(zt!==rr)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyLength,`Expected ${zt} bytes. Actual: ${rr}`);const nr=keyBytesToMultibaseId$2({keyBytes:er,multicodecCode:tr});Lt.id=`${At}#${nr}`;try{new URL(Lt.id)}catch{throw new DidError$2(DidErrorCode$2.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(jt in DidKeyVerificationMethodType$2))throw new DidError$2(DidErrorCode$2.UnsupportedPublicKeyType,`Unsupported format: ${jt}`);if(Nt===!1&&!["Multikey","JsonWebKey2020","X25519KeyAgreementKey2020"].includes(jt))throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Specified '${jt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Lt.type=jt,Lt.controller=At,jt==="X25519KeyAgreementKey2020"&&(Lt.publicKeyMultibase=nr),jt==="JsonWebKey2020"){const{crv:ar}=yield DidKeyUtils$2.multicodecToJwk({code:tr});Lt.publicKeyJwk=yield DidKeyUtils$2.keyConverter(ar).bytesToPublicKey({publicKeyBytes:er})}return Lt})}static createSignatureMethod(e){return __awaiter$2b(this,arguments,void 0,function*({didUri:At,multibaseValue:kt,options:Bt}){const{enableExperimentalPublicKeyTypes:Nt,publicKeyFormat:jt}=Bt,Lt={id:"",type:"",controller:""},{keyBytes:er,multicodecCode:tr,multicodecName:zt}=multibaseIdToKeyBytes$2({multibaseKeyId:kt}),rr=er.byteLength,nr=DidKeyUtils$2.MULTICODEC_PUBLIC_KEY_LENGTH[tr];if(rr!==nr)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyLength,`Expected ${rr} bytes. Actual: ${nr}`);let ir=!1;switch(zt){case"secp256k1-pub":ir=yield Secp256k1$2.validatePublicKey({publicKeyBytes:er});break;case"ed25519-pub":ir=yield Ed25519$2.validatePublicKey({publicKeyBytes:er});break;case"x25519-pub":ir=!0;break}if(!ir)throw new DidError$2(DidErrorCode$2.InvalidPublicKey,"Invalid public key detected.");Lt.id=`${At}#${kt}`;try{new URL(Lt.id)}catch{throw new DidError$2(DidErrorCode$2.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(jt in DidKeyVerificationMethodType$2))throw new DidError$2(DidErrorCode$2.UnsupportedPublicKeyType,`Unsupported format: ${jt}`);if(Nt===!1&&!["Multikey","JsonWebKey2020","Ed25519VerificationKey2020"].includes(jt))throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Specified '${jt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Lt.type=jt,Lt.controller=At,jt==="Ed25519VerificationKey2020"&&(Lt.publicKeyMultibase=kt),jt==="JsonWebKey2020"){const{crv:dr}=yield DidKeyUtils$2.multicodecToJwk({code:tr});Lt.publicKeyJwk=yield DidKeyUtils$2.keyConverter(dr).bytesToPublicKey({publicKeyBytes:er})}return Lt})}static deriveEncryptionKey(e){return __awaiter$2b(this,arguments,void 0,function*({multibaseValue:At}){let kt={keyBytes:new Uint8Array,multicodecCode:0};const{keyBytes:Bt,multicodecCode:Nt}=multibaseIdToKeyBytes$2({multibaseKeyId:At});if(Nt===237){const jt=yield DidKeyUtils$2.keyConverter("Ed25519").bytesToPublicKey({publicKeyBytes:Bt}),Lt=yield Ed25519$2.convertPublicKeyToX25519({publicKey:jt});kt={keyBytes:yield DidKeyUtils$2.keyConverter("Ed25519").publicKeyToBytes({publicKey:Lt}),multicodecCode:236}}return kt})}static validateIdentifier(e){const{method:At,id:kt}=e,[Bt]=e.uri.split(":",1);return Bt==="did"&&At==="key"&&Number("1")>0&&universalTypeOf$1(kt)==="String"&&kt.startsWith("z")}};DidKey$2.methodName="key";let DidKeyUtils$2=class $s{static jwkToMulticodec(e){return __awaiter$2b(this,arguments,void 0,function*({jwk:At}){const kt=[];At.crv&&(kt.push(At.crv),At.d?kt.push("private"):kt.push("public"));const Bt=kt.join(":"),Nt=$s.JWK_TO_MULTICODEC[Bt];if(Nt===void 0)throw new Error(`Unsupported JWK to Multicodec conversion: '${Bt}'`);return{code:Multicodec$1.getCodeFromName({name:Nt}),name:Nt}})}static keyCompressor(e){const kt={"P-256":Secp256r1$2.compressPublicKey,secp256k1:Secp256k1$2.compressPublicKey}[e];if(!kt)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Unsupported curve: ${e}`);return kt}static keyConverter(e){const kt={Ed25519:Ed25519$2,"P-256":Secp256r1$2,secp256k1:Secp256k1$2,X25519:X25519$2}[e];if(!kt)throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Unsupported curve: ${e}`);return kt}static multicodecToJwk(e){return __awaiter$2b(this,arguments,void 0,function*({code:At,name:kt}){if(!(kt?!At:At))throw new Error("Either 'name' or 'code' must be defined, but not both.");kt=kt===void 0?Multicodec$1.getNameFromCode({code:At}):kt;const Bt=kt,Nt=$s.MULTICODEC_TO_JWK[Bt];if(Nt===void 0)throw new Error("Unsupported Multicodec to JWK conversion");return Object.assign({},Nt)})}static publicKeyToMultibaseId(e){return __awaiter$2b(this,arguments,void 0,function*({publicKey:At}){var kt;if(!(At!=null&&At.crv&&At.crv in AlgorithmToKeyTypeMap$6))throw new DidError$2(DidErrorCode$2.InvalidPublicKeyType,`Public key contains an unsupported key type: ${(kt=At==null?void 0:At.crv)!==null&&kt!==void 0?kt:"undefined"}`);let Bt=yield $s.keyConverter(At.crv).publicKeyToBytes({publicKey:At});/^(secp256k1|P-256|P-384|P-521)$/.test(At.crv)&&(Bt=yield $s.keyCompressor(At.crv)({publicKeyBytes:Bt}));const{name:Nt}=yield $s.jwkToMulticodec({jwk:At});return keyBytesToMultibaseId$2({keyBytes:Bt,multicodecName:Nt})})}};DidKeyUtils$2.JWK_TO_MULTICODEC={"Ed25519:public":"ed25519-pub","Ed25519:private":"ed25519-priv","secp256k1:public":"secp256k1-pub","secp256k1:private":"secp256k1-priv","X25519:public":"x25519-pub","X25519:private":"x25519-priv"};DidKeyUtils$2.MULTICODEC_PUBLIC_KEY_LENGTH={231:33,236:32,237:32};DidKeyUtils$2.MULTICODEC_TO_JWK={"ed25519-pub":{crv:"Ed25519",kty:"OKP",x:""},"ed25519-priv":{crv:"Ed25519",kty:"OKP",x:"",d:""},"secp256k1-pub":{crv:"secp256k1",kty:"EC",x:"",y:""},"secp256k1-priv":{crv:"secp256k1",kty:"EC",x:"",y:"",d:""},"x25519-pub":{crv:"X25519",kty:"OKP",x:""},"x25519-priv":{crv:"X25519",kty:"OKP",x:"",d:""}};var __awaiter$2a=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DidWeb$2=class Tl extends DidMethod$2{static resolve(e,At){return __awaiter$2a(this,void 0,void 0,function*(){const kt=Did$2.parse(e);if(!kt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"invalidDid"}});if(kt.method!==Tl.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"methodNotSupported"}});let Bt=`https://${kt.id.replace(/:/g,"/")}`;Bt=decodeURIComponent(Bt);const Nt=kt.id.includes(":")?`${Bt}/did.json`:`${Bt}/.well-known/did.json`;try{const jt=yield fetch(Nt);if(!jt.ok)throw new Error("HTTP error status code returned");const Lt=yield jt.json();return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didDocument:Lt})}catch{return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:"notFound"}})}})}};DidWeb$2.methodName="web";var s=1e3,m=s*60,h=m*60,d=h*24,w=d*7,y=d*365.25,ms=function(xt,e){e=e||{};var At=typeof xt;if(At==="string"&&xt.length>0)return parse$1(xt);if(At==="number"&&isFinite(xt))return e.long?fmtLong(xt):fmtShort(xt);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(xt))};function parse$1(xt){if(xt=String(xt),!(xt.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(xt);if(e){var At=parseFloat(e[1]),kt=(e[2]||"ms").toLowerCase();switch(kt){case"years":case"year":case"yrs":case"yr":case"y":return At*y;case"weeks":case"week":case"w":return At*w;case"days":case"day":case"d":return At*d;case"hours":case"hour":case"hrs":case"hr":case"h":return At*h;case"minutes":case"minute":case"mins":case"min":case"m":return At*m;case"seconds":case"second":case"secs":case"sec":case"s":return At*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return At;default:return}}}}function fmtShort(xt){var e=Math.abs(xt);return e>=d?Math.round(xt/d)+"d":e>=h?Math.round(xt/h)+"h":e>=m?Math.round(xt/m)+"m":e>=s?Math.round(xt/s)+"s":xt+"ms"}function fmtLong(xt){var e=Math.abs(xt);return e>=d?plural(xt,e,d,"day"):e>=h?plural(xt,e,h,"hour"):e>=m?plural(xt,e,m,"minute"):e>=s?plural(xt,e,s,"second"):xt+" ms"}function plural(xt,e,At,kt){var Bt=e>=At*1.5;return Math.round(xt/At)+" "+kt+(Bt?"s":"")}const ms$1=getDefaultExportFromCjs(ms);var __awaiter$29=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DidResolverCacheLevel$1=class{constructor({db:e,location:At="DATA/DID_RESOLVERCACHE",ttl:kt="15m"}={}){this.cache=e??new Level$1(At),this.ttl=ms$1(kt)}get(e){return __awaiter$29(this,void 0,void 0,function*(){try{const At=yield this.cache.get(e),kt=JSON.parse(At);if(Date.now()>=kt.ttlMillis){this.cache.nextTick(()=>this.cache.del(e));return}else return kt.value}catch(At){if(At.notFound)return;throw At}})}set(e,At){const kt={ttlMillis:Date.now()+this.ttl,value:At},Bt=JSON.stringify(kt);return this.cache.put(e,Bt)}delete(e){return this.cache.del(e)}clear(){return this.cache.clear()}close(){return this.cache.close()}};const DidResolverCacheNoop$1={get:function(xt){return null},set:function(xt,e){return null},delete:function(xt){return null},clear:function(){return null},close:function(){return null}};var __awaiter$28=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let UniversalResolver$1=class{constructor({cache:e,didResolvers:At}){this.didResolvers=new Map,this.cache=e||DidResolverCacheNoop$1;for(const kt of At)this.didResolvers.set(kt.methodName,kt)}resolve(e,At){return __awaiter$28(this,void 0,void 0,function*(){const kt=Did$2.parse(e);if(!kt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:DidErrorCode$2.InvalidDid,errorMessage:`Invalid DID URI: ${e}`}});const Bt=this.didResolvers.get(kt.method);if(!Bt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$2),{didResolutionMetadata:{error:DidErrorCode$2.MethodNotSupported,errorMessage:`Method not supported: ${kt.method}`}});const Nt=yield this.cache.get(kt.uri);if(Nt)return Nt;{const jt=yield Bt.resolve(kt.uri,At);return jt.didResolutionMetadata.error||(yield this.cache.set(kt.uri,jt)),jt}})}dereference(e,At){return __awaiter$28(this,void 0,void 0,function*(){const kt=Did$2.parse(e);if(!kt)return{dereferencingMetadata:{error:DidErrorCode$2.InvalidDidUrl},contentStream:null,contentMetadata:{}};const{didDocument:Bt,didResolutionMetadata:Nt,didDocumentMetadata:jt}=yield this.resolve(kt.uri);if(!Bt)return{dereferencingMetadata:{error:Nt.error},contentStream:null,contentMetadata:{}};if(!kt.fragment||kt.query)return{dereferencingMetadata:{contentType:"application/did+json"},contentStream:Bt,contentMetadata:jt};const{service:Lt=[],verificationMethod:er=[]}=Bt,tr=new Set([e,kt.fragment,`#${kt.fragment}`]);let zt;for(let rr of er)if(tr.has(rr.id)){zt=rr;break}for(let rr of Lt)if(tr.has(rr.id)){zt=rr;break}return zt?{dereferencingMetadata:{contentType:"application/did+json"},contentStream:zt,contentMetadata:Nt}:{dereferencingMetadata:{error:DidErrorCode$2.NotFound},contentStream:null,contentMetadata:{}}})}};var __awaiter$27=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Dwn{constructor(e){this.didResolver=e.didResolver,this.tenantGate=e.tenantGate,this.eventStream=e.eventStream,this.messageStore=e.messageStore,this.dataStore=e.dataStore,this.resumableTaskStore=e.resumableTaskStore,this.eventLog=e.eventLog,this.eventStream=e.eventStream,this.storageController=new StorageController({messageStore:this.messageStore,dataStore:this.dataStore,eventLog:this.eventLog,eventStream:this.eventStream}),this.resumableTaskManager=new ResumableTaskManager(e.resumableTaskStore,this.storageController),this.methodHandlers={[DwnInterfaceName.Messages+DwnMethodName.Query]:new MessagesQueryHandler(this.didResolver,this.messageStore,this.eventLog),[DwnInterfaceName.Messages+DwnMethodName.Read]:new MessagesReadHandler(this.didResolver,this.messageStore,this.dataStore),[DwnInterfaceName.Messages+DwnMethodName.Subscribe]:new MessagesSubscribeHandler(this.didResolver,this.messageStore,this.eventStream),[DwnInterfaceName.Protocols+DwnMethodName.Configure]:new ProtocolsConfigureHandler(this.didResolver,this.messageStore,this.eventLog,this.eventStream),[DwnInterfaceName.Protocols+DwnMethodName.Query]:new ProtocolsQueryHandler(this.didResolver,this.messageStore,this.dataStore),[DwnInterfaceName.Records+DwnMethodName.Delete]:new RecordsDeleteHandler(this.didResolver,this.messageStore,this.resumableTaskManager),[DwnInterfaceName.Records+DwnMethodName.Query]:new RecordsQueryHandler(this.didResolver,this.messageStore,this.dataStore),[DwnInterfaceName.Records+DwnMethodName.Read]:new RecordsReadHandler(this.didResolver,this.messageStore,this.dataStore),[DwnInterfaceName.Records+DwnMethodName.Subscribe]:new RecordsSubscribeHandler(this.didResolver,this.messageStore,this.eventStream),[DwnInterfaceName.Records+DwnMethodName.Write]:new RecordsWriteHandler(this.didResolver,this.messageStore,this.dataStore,this.eventLog,this.eventStream)}}static create(e){var At,kt;return __awaiter$27(this,void 0,void 0,function*(){(At=e.didResolver)!==null&&At!==void 0||(e.didResolver=new UniversalResolver$1({didResolvers:[DidDht$2,DidJwk$2,DidKey$2],cache:new DidResolverCacheLevel$1({location:"RESOLVERCACHE"})})),(kt=e.tenantGate)!==null&&kt!==void 0||(e.tenantGate=new AllowAllTenantGate);const Bt=new Dwn(e);return yield Bt.open(),Bt})}open(){var e;return __awaiter$27(this,void 0,void 0,function*(){yield this.messageStore.open(),yield this.dataStore.open(),yield this.resumableTaskStore.open(),yield this.eventLog.open(),yield(e=this.eventStream)===null||e===void 0?void 0:e.open(),yield this.resumableTaskManager.resumeTasksAndWaitForCompletion()})}close(){var e;return __awaiter$27(this,void 0,void 0,function*(){yield(e=this.eventStream)===null||e===void 0?void 0:e.close(),yield this.messageStore.close(),yield this.dataStore.close(),yield this.resumableTaskStore.close(),yield this.eventLog.close()})}processMessage(e,At,kt={}){var Bt;return __awaiter$27(this,void 0,void 0,function*(){const Nt=(Bt=yield this.validateTenant(e))!==null&&Bt!==void 0?Bt:yield this.validateMessageIntegrity(At);if(Nt!==void 0)return Nt;const{dataStream:jt,subscriptionHandler:Lt}=kt,er=At.descriptor.interface+At.descriptor.method;return yield this.methodHandlers[er].handle({tenant:e,message:At,dataStream:jt,subscriptionHandler:Lt})})}validateTenant(e){var At;return __awaiter$27(this,void 0,void 0,function*(){const kt=yield this.tenantGate.isActiveTenant(e);if(!kt.isActiveTenant)return{status:{code:401,detail:(At=kt.detail)!==null&&At!==void 0?At:`DID ${e} is not an active tenant.`}}})}validateMessageIntegrity(e){var At,kt;return __awaiter$27(this,void 0,void 0,function*(){const Bt=(At=e==null?void 0:e.descriptor)===null||At===void 0?void 0:At.interface,Nt=(kt=e==null?void 0:e.descriptor)===null||kt===void 0?void 0:kt.method;if(Bt===void 0||Nt===void 0)return{status:{code:400,detail:`Both interface and method must be present, interface: ${Bt}, method: ${Nt}`}};try{Message.validateJsonSchema(e)}catch(jt){return messageReplyFromError(jt,400)}})}}var __awaiter$26=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function promisifySignal(xt){return new Promise((e,At)=>{if(xt.aborted){At(xt.reason);return}xt.addEventListener("abort",()=>{At(xt.reason)})})}function executeUnlessAborted(xt,e){return __awaiter$26(this,void 0,void 0,function*(){return e?Promise.race([xt,promisifySignal(e)]):xt})}var __awaiter$25=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__await$3=function(xt){return this instanceof __await$3?(this.v=xt,this):new __await$3(xt)},__asyncValues$7=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}},__asyncGenerator$3=function(xt,e,At){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var kt=At.apply(xt,e||[]),Bt,Nt=[];return Bt={},jt("next"),jt("throw"),jt("return"),Bt[Symbol.asyncIterator]=function(){return this},Bt;function jt(nr){kt[nr]&&(Bt[nr]=function(ir){return new Promise(function(ar,dr){Nt.push([nr,ir,ar,dr])>1||Lt(nr,ir)})})}function Lt(nr,ir){try{er(kt[nr](ir))}catch(ar){rr(Nt[0][3],ar)}}function er(nr){nr.value instanceof __await$3?Promise.resolve(nr.value.v).then(tr,zt):rr(Nt[0][2],nr)}function tr(nr){Lt("next",nr)}function zt(nr){Lt("throw",nr)}function rr(nr,ir){nr(ir),Nt.shift(),Nt.length&&Lt(Nt[0][0],Nt[0][1])}};function createLevelDatabase(xt,e){return __awaiter$25(this,void 0,void 0,function*(){return new Level(xt,Object.assign(Object.assign({},e),{keyEncoding:"utf8"}))})}class LevelWrapper{constructor(e,At){this.config=Object.assign({createLevelDatabase},e),this.db=At}open(){return __awaiter$25(this,void 0,void 0,function*(){switch(yield this.createLevelDatabase(),this.db.status){case"open":return;case"opening":return new Promise(e=>{this.db.once("open",e)});case"closing":return new Promise((e,At)=>{const kt=()=>{this.db.open().then(e).catch(At)};this.db.once("closed",kt)});case"closed":return this.db.open()}})}close(){return __awaiter$25(this,void 0,void 0,function*(){if(this.db)switch(this.db.status){case"open":return this.db.close();case"opening":return new Promise((e,At)=>{const kt=()=>{this.db.close().then(e).catch(At)};this.db.once("open",kt)});case"closing":return new Promise(e=>{this.db.once("closed",e)});case"closed":return}})}partition(e){return __awaiter$25(this,void 0,void 0,function*(){return yield this.createLevelDatabase(),new LevelWrapper(this.config,this.db.sublevel(e,{keyEncoding:"utf8",valueEncoding:this.config.valueEncoding}))})}get(e,At){var kt;return __awaiter$25(this,void 0,void 0,function*(){(kt=At==null?void 0:At.signal)===null||kt===void 0||kt.throwIfAborted(),yield executeUnlessAborted(this.createLevelDatabase(),At==null?void 0:At.signal);try{return yield executeUnlessAborted(this.db.get(String(e)),At==null?void 0:At.signal)}catch(Bt){if(Bt.code==="LEVEL_NOT_FOUND")return;throw Bt}})}has(e,At){return __awaiter$25(this,void 0,void 0,function*(){return!!(yield this.get(e,At))})}keys(e){var At,kt;return __asyncGenerator$3(this,arguments,function*(){var Nt,jt,Lt,er;(At=e==null?void 0:e.signal)===null||At===void 0||At.throwIfAborted(),yield __await$3(executeUnlessAborted(this.createLevelDatabase(),e==null?void 0:e.signal));try{for(var tr=!0,zt=__asyncValues$7(this.db.keys()),rr;rr=yield __await$3(zt.next()),Nt=rr.done,!Nt;tr=!0){er=rr.value,tr=!1;const nr=er;(kt=e==null?void 0:e.signal)===null||kt===void 0||kt.throwIfAborted(),yield yield __await$3(nr)}}catch(nr){jt={error:nr}}finally{try{!tr&&!Nt&&(Lt=zt.return)&&(yield __await$3(Lt.call(zt)))}finally{if(jt)throw jt.error}}})}iterator(e,At){var kt,Bt;return __asyncGenerator$3(this,arguments,function*(){var jt,Lt,er,tr;(kt=At==null?void 0:At.signal)===null||kt===void 0||kt.throwIfAborted(),yield __await$3(executeUnlessAborted(this.createLevelDatabase(),At==null?void 0:At.signal));try{for(var zt=!0,rr=__asyncValues$7(this.db.iterator(e)),nr;nr=yield __await$3(rr.next()),jt=nr.done,!jt;zt=!0){tr=nr.value,zt=!1;const ir=tr;(Bt=At==null?void 0:At.signal)===null||Bt===void 0||Bt.throwIfAborted(),yield yield __await$3(ir)}}catch(ir){Lt={error:ir}}finally{try{!zt&&!jt&&(er=rr.return)&&(yield __await$3(er.call(rr)))}finally{if(Lt)throw Lt.error}}})}put(e,At,kt){var Bt;return __awaiter$25(this,void 0,void 0,function*(){return(Bt=kt==null?void 0:kt.signal)===null||Bt===void 0||Bt.throwIfAborted(),yield executeUnlessAborted(this.createLevelDatabase(),kt==null?void 0:kt.signal),executeUnlessAborted(this.db.put(String(e),At),kt==null?void 0:kt.signal)})}delete(e,At){var kt;return __awaiter$25(this,void 0,void 0,function*(){return(kt=At==null?void 0:At.signal)===null||kt===void 0||kt.throwIfAborted(),yield executeUnlessAborted(this.createLevelDatabase(),At==null?void 0:At.signal),executeUnlessAborted(this.db.del(String(e)),At==null?void 0:At.signal)})}isEmpty(e){var At,kt,Bt,Nt;return __awaiter$25(this,void 0,void 0,function*(){try{for(var jt=!0,Lt=__asyncValues$7(this.keys(e)),er;er=yield Lt.next(),At=er.done,!At;jt=!0){Nt=er.value,jt=!1;const tr=Nt;return!1}}catch(tr){kt={error:tr}}finally{try{!jt&&!At&&(Bt=Lt.return)&&(yield Bt.call(Lt))}finally{if(kt)throw kt.error}}return!0})}clear(){return __awaiter$25(this,void 0,void 0,function*(){yield this.createLevelDatabase(),yield this.db.clear(),yield this.compactUnderlyingStorage()})}batch(e,At){var kt;return __awaiter$25(this,void 0,void 0,function*(){return(kt=At==null?void 0:At.signal)===null||kt===void 0||kt.throwIfAborted(),yield executeUnlessAborted(this.createLevelDatabase(),At==null?void 0:At.signal),executeUnlessAborted(this.db.batch(e),At==null?void 0:At.signal)})}createPartitionOperation(e,At){return Object.assign(Object.assign({},At),{sublevel:this.db.sublevel(e,{keyEncoding:"utf8",valueEncoding:this.config.valueEncoding})})}compactUnderlyingStorage(e){var At,kt,Bt;return __awaiter$25(this,void 0,void 0,function*(){(At=e==null?void 0:e.signal)===null||At===void 0||At.throwIfAborted(),yield executeUnlessAborted(this.createLevelDatabase(),e==null?void 0:e.signal);const Nt=this.sublevelRange;if(!Nt)return;const jt=this.root;if(jt.db.supports.additionalMethods.compactRange)return executeUnlessAborted((Bt=(kt=jt.db).compactRange)===null||Bt===void 0?void 0:Bt.call(kt,...Nt),e==null?void 0:e.signal)})}get sublevelRange(){const e=this.db.prefix;if(!e)return;const At=e.slice(0,-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1);return[e,At]}get root(){let e=this.db;for(const At=e.db;At&&At!==e;)e=At;return new LevelWrapper(this.config,e)}createLevelDatabase(){var e;return __awaiter$25(this,void 0,void 0,function*(){(e=this.db)!==null&&e!==void 0||(this.db=yield this.config.createLevelDatabase(this.config.location,{keyEncoding:"utf8",valueEncoding:this.config.valueEncoding}))})}}var __awaiter$24=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues$6=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}},__await$2=function(xt){return this instanceof __await$2?(this.v=xt,this):new __await$2(xt)},__asyncGenerator$2=function(xt,e,At){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var kt=At.apply(xt,e||[]),Bt,Nt=[];return Bt={},jt("next"),jt("throw"),jt("return"),Bt[Symbol.asyncIterator]=function(){return this},Bt;function jt(nr){kt[nr]&&(Bt[nr]=function(ir){return new Promise(function(ar,dr){Nt.push([nr,ir,ar,dr])>1||Lt(nr,ir)})})}function Lt(nr,ir){try{er(kt[nr](ir))}catch(ar){rr(Nt[0][3],ar)}}function er(nr){nr.value instanceof __await$2?Promise.resolve(nr.value.v).then(tr,zt):rr(Nt[0][2],nr)}function tr(nr){Lt("next",nr)}function zt(nr){Lt("throw",nr)}function rr(nr,ir){nr(ir),Nt.shift(),Nt.length&&Lt(Nt[0][0],Nt[0][1])}};class BlockstoreLevel{constructor(e,At){this.config=Object.assign({createLevelDatabase},e),this.db=At??new LevelWrapper(Object.assign(Object.assign({},this.config),{valueEncoding:"binary"}))}open(){return __awaiter$24(this,void 0,void 0,function*(){return this.db.open()})}close(){return __awaiter$24(this,void 0,void 0,function*(){return this.db.close()})}partition(e){return __awaiter$24(this,void 0,void 0,function*(){const At=yield this.db.partition(e);return new BlockstoreLevel(Object.assign(Object.assign({},this.config),{location:""}),At)})}put(e,At,kt){return __awaiter$24(this,void 0,void 0,function*(){return yield this.db.put(String(e),At,kt),CID.parse(e.toString())})}get(e,At){return __awaiter$24(this,void 0,void 0,function*(){return yield this.db.get(String(e),At)})}has(e,At){return __awaiter$24(this,void 0,void 0,function*(){return this.db.has(String(e),At)})}delete(e,At){return __awaiter$24(this,void 0,void 0,function*(){return this.db.delete(String(e),At)})}isEmpty(e){return __awaiter$24(this,void 0,void 0,function*(){return this.db.isEmpty(e)})}putMany(e,At){return __asyncGenerator$2(this,arguments,function*(){var Bt,Nt,jt,Lt;try{for(var er=!0,tr=__asyncValues$6(e),zt;zt=yield __await$2(tr.next()),Bt=zt.done,!Bt;er=!0){Lt=zt.value,er=!1;const rr=Lt;yield __await$2(this.put(rr.cid,rr.block,At)),yield yield __await$2(rr.cid)}}catch(rr){Nt={error:rr}}finally{try{!er&&!Bt&&(jt=tr.return)&&(yield __await$2(jt.call(tr)))}finally{if(Nt)throw Nt.error}}})}getMany(e,At){return __asyncGenerator$2(this,arguments,function*(){var Bt,Nt,jt,Lt;try{for(var er=!0,tr=__asyncValues$6(e),zt;zt=yield __await$2(tr.next()),Bt=zt.done,!Bt;er=!0){Lt=zt.value,er=!1;const rr=Lt;yield yield __await$2({cid:rr,block:yield __await$2(this.get(rr,At))})}}catch(rr){Nt={error:rr}}finally{try{!er&&!Bt&&(jt=tr.return)&&(yield __await$2(jt.call(tr)))}finally{if(Nt)throw Nt.error}}})}getAll(e){return __asyncGenerator$2(this,arguments,function*(){var kt,Bt,Nt,jt;const Lt=this.db.iterator({keys:!0,keyEncoding:"buffer"},e);try{for(var er=!0,tr=__asyncValues$6(Lt),zt;zt=yield __await$2(tr.next()),kt=zt.done,!kt;er=!0){jt=zt.value,er=!1;const[rr,nr]=jt;yield yield __await$2({cid:CID.decode(rr),block:nr})}}catch(rr){Bt={error:rr}}finally{try{!er&&!kt&&(Nt=tr.return)&&(yield __await$2(Nt.call(tr)))}finally{if(Bt)throw Bt.error}}})}deleteMany(e,At){return __asyncGenerator$2(this,arguments,function*(){var Bt,Nt,jt,Lt;try{for(var er=!0,tr=__asyncValues$6(e),zt;zt=yield __await$2(tr.next()),Bt=zt.done,!Bt;er=!0){Lt=zt.value,er=!1;const rr=Lt;yield __await$2(this.delete(rr,At)),yield yield __await$2(rr)}}catch(rr){Nt={error:rr}}finally{try{!er&&!Bt&&(jt=tr.return)&&(yield __await$2(jt.call(tr)))}finally{if(Nt)throw Nt.error}}})}clear(){return __awaiter$24(this,void 0,void 0,function*(){return this.db.clear()})}}function isAsyncIterable$5(xt){return xt[Symbol.asyncIterator]!=null}function last(xt){if(isAsyncIterable$5(xt))return(async()=>{let At;for await(const kt of xt)At=kt;return At})();let e;for(const At of xt)e=At;return e}const code=0,name="identity",encode$1=coerce$3,digest=xt=>create$2(code,encode$1(xt)),identity={code,name,encode:encode$1,digest},resolve$3=async(xt,e,At,kt,Bt,Nt,jt,Lt)=>{const er=await jt.get(xt,Lt),tr=decode$b(er);let zt=tr,rr=At;for(;kt.length>0;){const nr=kt[0];if(nr in zt){kt.shift(),rr=`${rr}/${nr}`;const ir=CID.asCID(zt[nr]);if(ir!=null)return{entry:{type:"object",name:e,path:At,cid:xt,node:er,depth:Nt,size:BigInt(er.length),content:async function*(){yield tr}},next:{cid:ir,name:nr,path:rr,toResolve:kt}};zt=zt[nr]}else throw errCode$1(new Error(`No property named ${nr} found in cbor node ${xt}`),"ERR_NO_PROP")}return{entry:{type:"object",name:e,path:At,cid:xt,node:er,depth:Nt,size:BigInt(er.length),content:async function*(){yield tr}}}};function extractDataFromBlock(xt,e,At,kt){const Bt=BigInt(xt.length),Nt=BigInt(e+Bt);return At>=Nt||kt<e?new Uint8Array(0):(kt>=e&&kt<Nt&&(xt=xt.subarray(0,Number(kt-e))),At>=e&&At<Nt&&(xt=xt.subarray(Number(At-e))),xt)}const validateOffsetAndLength=(xt,e=0,At=xt)=>{const kt=BigInt(xt),Bt=BigInt(e??0);let Nt=BigInt(At);if(Nt!==kt&&(Nt=Bt+Nt),Nt>kt&&(Nt=kt),Bt<0n)throw errCode$1(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(Bt>kt)throw errCode$1(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(Nt<0n)throw errCode$1(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(Nt>kt)throw errCode$1(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:Bt,end:Nt}},rawContent$1=xt=>{async function*e(At={}){var jt;const{start:kt,end:Bt}=validateOffsetAndLength(xt.length,At.offset,At.length),Nt=extractDataFromBlock(xt,0n,kt,Bt);(jt=At.onProgress)==null||jt.call(At,new CustomProgressEvent("unixfs:exporter:progress:identity",{bytesRead:BigInt(Nt.byteLength),totalBytes:Bt-kt,fileSize:BigInt(xt.byteLength)})),yield Nt}return e},resolve$2=async(xt,e,At,kt,Bt,Nt,jt,Lt)=>{if(kt.length>0)throw errCode$1(new Error(`No link named ${At} found in raw node ${xt}`),"ERR_NOT_FOUND");const er=decode$m(xt.multihash.bytes);return{entry:{type:"identity",name:e,path:At,cid:xt,content:rawContent$1(er.digest),depth:Nt,size:BigInt(er.digest.length),node:er.digest}}},rawContent=xt=>{async function*e(At={}){var jt;const{start:kt,end:Bt}=validateOffsetAndLength(xt.length,At.offset,At.length),Nt=extractDataFromBlock(xt,0n,kt,Bt);(jt=At.onProgress)==null||jt.call(At,new CustomProgressEvent("unixfs:exporter:progress:raw",{bytesRead:BigInt(Nt.byteLength),totalBytes:Bt-kt,fileSize:BigInt(xt.byteLength)})),yield Nt}return e},resolve$1=async(xt,e,At,kt,Bt,Nt,jt,Lt)=>{if(kt.length>0)throw errCode$1(new Error(`No link named ${At} found in raw node ${xt}`),"ERR_NOT_FOUND");const er=await jt.get(xt,Lt);return{entry:{type:"raw",name:e,path:At,cid:xt,content:rawContent(er),depth:Nt,size:BigInt(er.length),node:er}}},hashFn=async function(xt){return(await murmur3128.encode(xt)).slice(0,8).reverse()},addLinksToHamtBucket=async(xt,e,At)=>{await Promise.all(xt.map(async kt=>{if(kt.Name==null)throw new Error("Unexpected Link without a Name");if(kt.Name.length===2){const Bt=parseInt(kt.Name,16);e._putObjectAt(Bt,new Bucket({hash:At._options.hash,bits:At._options.bits},e,Bt));return}await At.put(kt.Name.substring(2),!0)}))},toPrefix=xt=>xt.toString(16).toUpperCase().padStart(2,"0").substring(0,2),toBucketPath=xt=>{let e=xt.bucket;const At=[];for(;e._parent!=null;)At.push(e),e=e._parent;return At.push(e),At.reverse()},findShardCid=async(xt,e,At,kt,Bt)=>{if(kt==null){const zt=createHAMT({hashFn});kt={rootBucket:zt,hamtDepth:1,lastBucket:zt}}await addLinksToHamtBucket(xt.Links,kt.lastBucket,kt.rootBucket);const Nt=await kt.rootBucket._findNewBucketAndPos(e);let jt=toPrefix(Nt.pos);const Lt=toBucketPath(Nt);Lt.length>kt.hamtDepth&&(kt.lastBucket=Lt[kt.hamtDepth],jt=toPrefix(kt.lastBucket._posAtParent));const er=xt.Links.find(zt=>{if(zt.Name==null)return!1;const rr=zt.Name.substring(0,2),nr=zt.Name.substring(2);return!(rr!==jt||nr!==""&&nr!==e)});if(er==null)return;if(er.Name!=null&&er.Name.substring(2)===e)return er.Hash;kt.hamtDepth++;const tr=await At.get(er.Hash,Bt);return xt=decode$a(tr),findShardCid(xt,e,At,kt,Bt)};function peekable(xt){const[e,At]=xt[Symbol.asyncIterator]!=null?[xt[Symbol.asyncIterator](),Symbol.asyncIterator]:[xt[Symbol.iterator](),Symbol.iterator],kt=[];return{peek:()=>e.next(),push:Bt=>{kt.push(Bt)},next:()=>kt.length>0?{done:!1,value:kt.shift()}:e.next(),[At](){return this}}}function isAsyncIterable$4(xt){return xt[Symbol.asyncIterator]!=null}function filter(xt,e){let At=0;if(isAsyncIterable$4(xt))return async function*(){for await(const er of xt)await e(er,At++)&&(yield er)}();const kt=peekable(xt),{value:Bt,done:Nt}=kt.next();if(Nt===!0)return function*(){}();const jt=e(Bt,At++);if(typeof jt.then=="function")return async function*(){await jt&&(yield Bt);for await(const er of kt)await e(er,At++)&&(yield er)}();const Lt=e;return function*(){jt===!0&&(yield Bt);for(const er of kt)Lt(er,At++)&&(yield er)}()}function isAsyncIterable$3(xt){return xt[Symbol.asyncIterator]!=null}function map(xt,e){let At=0;if(isAsyncIterable$3(xt))return async function*(){for await(const er of xt)yield e(er,At++)}();const kt=peekable(xt),{value:Bt,done:Nt}=kt.next();if(Nt===!0)return function*(){}();const jt=e(Bt,At++);if(typeof jt.then=="function")return async function*(){yield await jt;for await(const er of kt)yield e(er,At++)}();const Lt=e;return function*(){yield jt;for(const er of kt)yield Lt(er,At++)}()}function pDefer(){const xt={};return xt.promise=new Promise((e,At)=>{xt.resolve=e,xt.reject=At}),xt}const CustomEvent$1=globalThis.CustomEvent??Event;async function*parallel(xt,e={}){let At=e.concurrency??1/0;At<1&&(At=1/0);const kt=e.ordered==null?!1:e.ordered,Bt=new EventTarget,Nt=[];let jt=pDefer(),Lt=pDefer(),er=!1,tr,zt=!1;Bt.addEventListener("task-complete",()=>{Lt.resolve()}),Promise.resolve().then(async()=>{try{for await(const ar of xt){if(Nt.length===At&&(jt=pDefer(),await jt.promise),zt)break;const dr={done:!1};Nt.push(dr),ar().then(ur=>{dr.done=!0,dr.ok=!0,dr.value=ur,Bt.dispatchEvent(new CustomEvent$1("task-complete"))},ur=>{dr.done=!0,dr.err=ur,Bt.dispatchEvent(new CustomEvent$1("task-complete"))})}er=!0,Bt.dispatchEvent(new CustomEvent$1("task-complete"))}catch(ar){tr=ar,Bt.dispatchEvent(new CustomEvent$1("task-complete"))}});function rr(){var ar;return kt?(ar=Nt[0])==null?void 0:ar.done:!!Nt.find(dr=>dr.done)}function*nr(){for(;Nt.length>0&&Nt[0].done;){const ar=Nt[0];if(Nt.shift(),ar.ok)yield ar.value;else throw zt=!0,jt.resolve(),ar.err;jt.resolve()}}function*ir(){for(;rr();)for(let ar=0;ar<Nt.length;ar++)if(Nt[ar].done){const dr=Nt[ar];if(Nt.splice(ar,1),ar--,dr.ok)yield dr.value;else throw zt=!0,jt.resolve(),dr.err;jt.resolve()}}for(;;){if(rr()||(Lt=pDefer(),await Lt.promise),tr!=null)throw tr;if(kt?yield*nr():yield*ir(),er&&Nt.length===0)break}}class FixedFIFO{constructor(e){wn(this,"buffer");wn(this,"mask");wn(this,"top");wn(this,"btm");wn(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class FIFO{constructor(e={}){wn(this,"size");wn(this,"hwm");wn(this,"head");wn(this,"tail");this.hwm=e.splitLimit??16,this.head=new FixedFIFO(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const At=this.head;this.head=At.next=new FixedFIFO(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const At=this.tail.next;this.tail.next=null,this.tail=At,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let AbortError$2=class extends Error{constructor(At,kt){super(At??"The operation was aborted");wn(this,"type");wn(this,"code");this.type="aborted",this.code=kt??"ABORT_ERR"}};function pushable(xt={}){return _pushable(At=>{const kt=At.shift();if(kt==null)return{done:!0};if(kt.error!=null)throw kt.error;return{done:kt.done===!0,value:kt.value}},xt)}function _pushable(xt,e){e=e??{};let At=e.onEnd,kt=new FIFO,Bt,Nt,jt,Lt=pDefer();const er=async()=>{try{return kt.isEmpty()?jt?{done:!0}:await new Promise((ur,fr)=>{Nt=pr=>{Nt=null,kt.push(pr);try{ur(xt(kt))}catch(lr){fr(lr)}return Bt}}):xt(kt)}finally{kt.isEmpty()&&queueMicrotask(()=>{Lt.resolve(),Lt=pDefer()})}},tr=ur=>Nt!=null?Nt(ur):(kt.push(ur),Bt),zt=ur=>(kt=new FIFO,Nt!=null?Nt({error:ur}):(kt.push({error:ur}),Bt)),rr=ur=>{if(jt)return Bt;if((e==null?void 0:e.objectMode)!==!0&&(ur==null?void 0:ur.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return tr({done:!1,value:ur})},nr=ur=>jt?Bt:(jt=!0,ur!=null?zt(ur):tr({done:!0})),ir=()=>(kt=new FIFO,nr(),{done:!0}),ar=ur=>(nr(ur),{done:!0});if(Bt={[Symbol.asyncIterator](){return this},next:er,return:ir,throw:ar,push:rr,end:nr,get readableLength(){return kt.size},onEmpty:async ur=>{const fr=ur==null?void 0:ur.signal;if(fr==null||fr.throwIfAborted(),kt.isEmpty())return;let pr,lr;fr!=null&&(pr=new Promise((yr,br)=>{lr=()=>{br(new AbortError$2)},fr.addEventListener("abort",lr)}));try{await Promise.race([Lt.promise,pr])}finally{lr!=null&&fr!=null&&(fr==null||fr.removeEventListener("abort",lr))}}},At==null)return Bt;const dr=Bt;return Bt={[Symbol.asyncIterator](){return this},next(){return dr.next()},throw(ur){return dr.throw(ur),At!=null&&(At(ur),At=void 0),{done:!0}},return(){return dr.return(),At!=null&&(At(),At=void 0),{done:!0}},push:rr,end(ur){return dr.end(ur),At!=null&&(At(ur),At=void 0),Bt},get readableLength(){return dr.readableLength},onEmpty:ur=>dr.onEmpty(ur)},Bt}function isAsyncIterable$2(xt){return xt[Symbol.asyncIterator]!=null}function merge(...xt){const e=[];for(const At of xt)isAsyncIterable$2(At)||e.push(At);return e.length===xt.length?function*(){for(const At of e)yield*At}():async function*(){const At=pushable({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(xt.map(async kt=>{for await(const Bt of kt)At.push(Bt)})),At.end()}catch(kt){At.end(kt)}}),yield*At}()}function pipe(xt,...e){if(xt==null)throw new Error("Empty pipeline");if(isDuplex(xt)){const kt=xt;xt=()=>kt.source}else if(isIterable(xt)||isAsyncIterable$1(xt)){const kt=xt;xt=()=>kt}const At=[xt,...e];if(At.length>1&&isDuplex(At[At.length-1])&&(At[At.length-1]=At[At.length-1].sink),At.length>2)for(let kt=1;kt<At.length-1;kt++)isDuplex(At[kt])&&(At[kt]=duplexPipelineFn(At[kt]));return rawPipe(...At)}const rawPipe=(...xt)=>{let e;for(;xt.length>0;)e=xt.shift()(e);return e},isAsyncIterable$1=xt=>(xt==null?void 0:xt[Symbol.asyncIterator])!=null,isIterable=xt=>(xt==null?void 0:xt[Symbol.iterator])!=null,isDuplex=xt=>xt==null?!1:xt.sink!=null&&xt.source!=null,duplexPipelineFn=xt=>e=>{const At=xt.sink(e);if((At==null?void 0:At.then)!=null){const kt=pushable({objectMode:!0});At.then(()=>{kt.end()},jt=>{kt.end(jt)});let Bt;const Nt=xt.source;if(isAsyncIterable$1(Nt))Bt=async function*(){yield*Nt,kt.end()};else if(isIterable(Nt))Bt=function*(){yield*Nt,kt.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return merge(kt,Bt())}return xt.source},directoryContent=(xt,e,At,kt,Bt,Nt,jt)=>{async function*Lt(er={}){var nr;const tr=er.offset??0,zt=er.length??e.Links.length,rr=e.Links.slice(tr,zt);(nr=er.onProgress)==null||nr.call(er,new CustomProgressEvent("unixfs:exporter:walk:directory",{cid:xt})),yield*pipe(rr,ir=>map(ir,ar=>async()=>{const dr=ar.Name??"",ur=`${kt}/${dr}`;return(await Bt(ar.Hash,dr,ur,[],Nt+1,jt,er)).entry}),ir=>parallel(ir,{ordered:!0}),ir=>filter(ir,ar=>ar!=null))}return Lt};var eventemitter3={exports:{}};(function(xt){var e=Object.prototype.hasOwnProperty,At="~";function kt(){}Object.create&&(kt.prototype=Object.create(null),new kt().__proto__||(At=!1));function Bt(er,tr,zt){this.fn=er,this.context=tr,this.once=zt||!1}function Nt(er,tr,zt,rr,nr){if(typeof zt!="function")throw new TypeError("The listener must be a function");var ir=new Bt(zt,rr||er,nr),ar=At?At+tr:tr;return er._events[ar]?er._events[ar].fn?er._events[ar]=[er._events[ar],ir]:er._events[ar].push(ir):(er._events[ar]=ir,er._eventsCount++),er}function jt(er,tr){--er._eventsCount===0?er._events=new kt:delete er._events[tr]}function Lt(){this._events=new kt,this._eventsCount=0}Lt.prototype.eventNames=function(){var tr=[],zt,rr;if(this._eventsCount===0)return tr;for(rr in zt=this._events)e.call(zt,rr)&&tr.push(At?rr.slice(1):rr);return Object.getOwnPropertySymbols?tr.concat(Object.getOwnPropertySymbols(zt)):tr},Lt.prototype.listeners=function(tr){var zt=At?At+tr:tr,rr=this._events[zt];if(!rr)return[];if(rr.fn)return[rr.fn];for(var nr=0,ir=rr.length,ar=new Array(ir);nr<ir;nr++)ar[nr]=rr[nr].fn;return ar},Lt.prototype.listenerCount=function(tr){var zt=At?At+tr:tr,rr=this._events[zt];return rr?rr.fn?1:rr.length:0},Lt.prototype.emit=function(tr,zt,rr,nr,ir,ar){var dr=At?At+tr:tr;if(!this._events[dr])return!1;var ur=this._events[dr],fr=arguments.length,pr,lr;if(ur.fn){switch(ur.once&&this.removeListener(tr,ur.fn,void 0,!0),fr){case 1:return ur.fn.call(ur.context),!0;case 2:return ur.fn.call(ur.context,zt),!0;case 3:return ur.fn.call(ur.context,zt,rr),!0;case 4:return ur.fn.call(ur.context,zt,rr,nr),!0;case 5:return ur.fn.call(ur.context,zt,rr,nr,ir),!0;case 6:return ur.fn.call(ur.context,zt,rr,nr,ir,ar),!0}for(lr=1,pr=new Array(fr-1);lr<fr;lr++)pr[lr-1]=arguments[lr];ur.fn.apply(ur.context,pr)}else{var yr=ur.length,br;for(lr=0;lr<yr;lr++)switch(ur[lr].once&&this.removeListener(tr,ur[lr].fn,void 0,!0),fr){case 1:ur[lr].fn.call(ur[lr].context);break;case 2:ur[lr].fn.call(ur[lr].context,zt);break;case 3:ur[lr].fn.call(ur[lr].context,zt,rr);break;case 4:ur[lr].fn.call(ur[lr].context,zt,rr,nr);break;default:if(!pr)for(br=1,pr=new Array(fr-1);br<fr;br++)pr[br-1]=arguments[br];ur[lr].fn.apply(ur[lr].context,pr)}}return!0},Lt.prototype.on=function(tr,zt,rr){return Nt(this,tr,zt,rr,!1)},Lt.prototype.once=function(tr,zt,rr){return Nt(this,tr,zt,rr,!0)},Lt.prototype.removeListener=function(tr,zt,rr,nr){var ir=At?At+tr:tr;if(!this._events[ir])return this;if(!zt)return jt(this,ir),this;var ar=this._events[ir];if(ar.fn)ar.fn===zt&&(!nr||ar.once)&&(!rr||ar.context===rr)&&jt(this,ir);else{for(var dr=0,ur=[],fr=ar.length;dr<fr;dr++)(ar[dr].fn!==zt||nr&&!ar[dr].once||rr&&ar[dr].context!==rr)&&ur.push(ar[dr]);ur.length?this._events[ir]=ur.length===1?ur[0]:ur:jt(this,ir)}return this},Lt.prototype.removeAllListeners=function(tr){var zt;return tr?(zt=At?At+tr:tr,this._events[zt]&&jt(this,zt)):(this._events=new kt,this._eventsCount=0),this},Lt.prototype.off=Lt.prototype.removeListener,Lt.prototype.addListener=Lt.prototype.on,Lt.prefixed=At,Lt.EventEmitter=Lt,xt.exports=Lt})(eventemitter3);var eventemitter3Exports=eventemitter3.exports;const EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class TimeoutError extends Error{constructor(e){super(e),this.name="TimeoutError"}}let AbortError$1=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const getDOMException=xt=>globalThis.DOMException===void 0?new AbortError$1(xt):new DOMException(xt),getAbortedReason=xt=>{const e=xt.reason===void 0?getDOMException("This operation was aborted."):xt.reason;return e instanceof Error?e:getDOMException(e)};function pTimeout(xt,e,At,kt){let Bt;const Nt=new Promise((jt,Lt)=>{if(typeof e!="number"||Math.sign(e)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e===Number.POSITIVE_INFINITY){jt(xt);return}if(kt={customTimers:{setTimeout,clearTimeout},...kt},kt.signal){const{signal:er}=kt;er.aborted&&Lt(getAbortedReason(er)),er.addEventListener("abort",()=>{Lt(getAbortedReason(er))})}Bt=kt.customTimers.setTimeout.call(void 0,()=>{const er=`Promise timed out after ${e} milliseconds`,tr=At instanceof Error?At:new TimeoutError(er);typeof xt.cancel=="function"&&xt.cancel(),Lt(tr)},e),(async()=>{try{jt(await xt)}catch(er){Lt(er)}finally{kt.customTimers.clearTimeout.call(void 0,Bt)}})()});return Nt.clear=()=>{clearTimeout(Bt),Bt=void 0},Nt}function lowerBound(xt,e,At){let kt=0,Bt=xt.length;for(;Bt>0;){const Nt=Math.trunc(Bt/2);let jt=kt+Nt;At(xt[jt],e)<=0?(kt=++jt,Bt-=Nt+1):Bt=Nt}return kt}var __classPrivateFieldGet$1=function(xt,e,At,kt){if(At==="a"&&!kt)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?xt!==e||!kt:!e.has(xt))throw new TypeError("Cannot read private member from an object whose class did not declare it");return At==="m"?kt:At==="a"?kt.call(xt):kt?kt.value:e.get(xt)},_PriorityQueue_queue;class PriorityQueue{constructor(){_PriorityQueue_queue.set(this,[])}enqueue(e,At){At={priority:0,...At};const kt={priority:At.priority,run:e};if(this.size&&__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f")[this.size-1].priority>=At.priority){__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").push(kt);return}const Bt=lowerBound(__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f"),kt,(Nt,jt)=>jt.priority-Nt.priority);__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").splice(Bt,0,kt)}dequeue(){const e=__classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").shift();return e==null?void 0:e.run}filter(e){return __classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").filter(At=>At.priority===e.priority).map(At=>At.run)}get size(){return __classPrivateFieldGet$1(this,_PriorityQueue_queue,"f").length}}_PriorityQueue_queue=new WeakMap;var __classPrivateFieldSet=function(xt,e,At,kt,Bt){if(kt==="m")throw new TypeError("Private method is not writable");if(kt==="a"&&!Bt)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?xt!==e||!Bt:!e.has(xt))throw new TypeError("Cannot write private member to an object whose class did not declare it");return kt==="a"?Bt.call(xt,At):Bt?Bt.value=At:e.set(xt,At),At},__classPrivateFieldGet=function(xt,e,At,kt){if(At==="a"&&!kt)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?xt!==e||!kt:!e.has(xt))throw new TypeError("Cannot read private member from an object whose class did not declare it");return At==="m"?kt:At==="a"?kt.call(xt):kt?kt.value:e.get(xt)},_PQueue_instances,_PQueue_carryoverConcurrencyCount,_PQueue_isIntervalIgnored,_PQueue_intervalCount,_PQueue_intervalCap,_PQueue_interval,_PQueue_intervalEnd,_PQueue_intervalId,_PQueue_timeoutId,_PQueue_queue,_PQueue_queueClass,_PQueue_pending,_PQueue_concurrency,_PQueue_isPaused,_PQueue_throwOnTimeout,_PQueue_doesIntervalAllowAnother_get,_PQueue_doesConcurrentAllowAnother_get,_PQueue_next,_PQueue_onResumeInterval,_PQueue_isIntervalPaused_get,_PQueue_tryToStartAnother,_PQueue_initializeIntervalIfNeeded,_PQueue_onInterval,_PQueue_processQueue,_PQueue_throwOnAbort,_PQueue_onEvent;class AbortError extends Error{}class PQueue extends EventEmitter{constructor(e){var At,kt,Bt,Nt;if(super(),_PQueue_instances.add(this),_PQueue_carryoverConcurrencyCount.set(this,void 0),_PQueue_isIntervalIgnored.set(this,void 0),_PQueue_intervalCount.set(this,0),_PQueue_intervalCap.set(this,void 0),_PQueue_interval.set(this,void 0),_PQueue_intervalEnd.set(this,0),_PQueue_intervalId.set(this,void 0),_PQueue_timeoutId.set(this,void 0),_PQueue_queue.set(this,void 0),_PQueue_queueClass.set(this,void 0),_PQueue_pending.set(this,0),_PQueue_concurrency.set(this,void 0),_PQueue_isPaused.set(this,void 0),_PQueue_throwOnTimeout.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:PriorityQueue,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(kt=(At=e.intervalCap)===null||At===void 0?void 0:At.toString())!==null&&kt!==void 0?kt:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(Nt=(Bt=e.interval)===null||Bt===void 0?void 0:Bt.toString())!==null&&Nt!==void 0?Nt:""}\` (${typeof e.interval})`);__classPrivateFieldSet(this,_PQueue_carryoverConcurrencyCount,e.carryoverConcurrencyCount,"f"),__classPrivateFieldSet(this,_PQueue_isIntervalIgnored,e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,"f"),__classPrivateFieldSet(this,_PQueue_intervalCap,e.intervalCap,"f"),__classPrivateFieldSet(this,_PQueue_interval,e.interval,"f"),__classPrivateFieldSet(this,_PQueue_queue,new e.queueClass,"f"),__classPrivateFieldSet(this,_PQueue_queueClass,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,__classPrivateFieldSet(this,_PQueue_throwOnTimeout,e.throwOnTimeout===!0,"f"),__classPrivateFieldSet(this,_PQueue_isPaused,e.autoStart===!1,"f")}get concurrency(){return __classPrivateFieldGet(this,_PQueue_concurrency,"f")}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);__classPrivateFieldSet(this,_PQueue_concurrency,e,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)}async add(e,At={}){return At={timeout:this.timeout,throwOnTimeout:__classPrivateFieldGet(this,_PQueue_throwOnTimeout,"f"),...At},new Promise((kt,Bt)=>{__classPrivateFieldGet(this,_PQueue_queue,"f").enqueue(async()=>{var Nt,jt,Lt;__classPrivateFieldSet(this,_PQueue_pending,(jt=__classPrivateFieldGet(this,_PQueue_pending,"f"),jt++,jt),"f"),__classPrivateFieldSet(this,_PQueue_intervalCount,(Lt=__classPrivateFieldGet(this,_PQueue_intervalCount,"f"),Lt++,Lt),"f");try{if(!((Nt=At.signal)===null||Nt===void 0)&&Nt.aborted)throw new AbortError("The task was aborted.");let er=e({signal:At.signal});At.timeout&&(er=pTimeout(Promise.resolve(er),At.timeout)),At.signal&&(er=Promise.race([er,__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_throwOnAbort).call(this,At.signal)]));const tr=await er;kt(tr),this.emit("completed",tr)}catch(er){if(er instanceof TimeoutError&&!At.throwOnTimeout){kt();return}Bt(er),this.emit("error",er)}finally{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_next).call(this)}},At),this.emit("add"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this)})}async addAll(e,At){return Promise.all(e.map(async kt=>this.add(kt,At)))}start(){return __classPrivateFieldGet(this,_PQueue_isPaused,"f")?(__classPrivateFieldSet(this,_PQueue_isPaused,!1,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this),this):this}pause(){__classPrivateFieldSet(this,_PQueue_isPaused,!0,"f")}clear(){__classPrivateFieldSet(this,_PQueue_queue,new(__classPrivateFieldGet(this,_PQueue_queueClass,"f")),"f")}async onEmpty(){__classPrivateFieldGet(this,_PQueue_queue,"f").size!==0&&await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"empty")}async onSizeLessThan(e){__classPrivateFieldGet(this,_PQueue_queue,"f").size<e||await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"next",()=>__classPrivateFieldGet(this,_PQueue_queue,"f").size<e)}async onIdle(){__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&__classPrivateFieldGet(this,_PQueue_queue,"f").size===0||await __classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onEvent).call(this,"idle")}get size(){return __classPrivateFieldGet(this,_PQueue_queue,"f").size}sizeBy(e){return __classPrivateFieldGet(this,_PQueue_queue,"f").filter(e).length}get pending(){return __classPrivateFieldGet(this,_PQueue_pending,"f")}get isPaused(){return __classPrivateFieldGet(this,_PQueue_isPaused,"f")}}_PQueue_carryoverConcurrencyCount=new WeakMap,_PQueue_isIntervalIgnored=new WeakMap,_PQueue_intervalCount=new WeakMap,_PQueue_intervalCap=new WeakMap,_PQueue_interval=new WeakMap,_PQueue_intervalEnd=new WeakMap,_PQueue_intervalId=new WeakMap,_PQueue_timeoutId=new WeakMap,_PQueue_queue=new WeakMap,_PQueue_queueClass=new WeakMap,_PQueue_pending=new WeakMap,_PQueue_concurrency=new WeakMap,_PQueue_isPaused=new WeakMap,_PQueue_throwOnTimeout=new WeakMap,_PQueue_instances=new WeakSet,_PQueue_doesIntervalAllowAnother_get=function xt(){return __classPrivateFieldGet(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet(this,_PQueue_intervalCount,"f")<__classPrivateFieldGet(this,_PQueue_intervalCap,"f")},_PQueue_doesConcurrentAllowAnother_get=function xt(){return __classPrivateFieldGet(this,_PQueue_pending,"f")<__classPrivateFieldGet(this,_PQueue_concurrency,"f")},_PQueue_next=function xt(){var e;__classPrivateFieldSet(this,_PQueue_pending,(e=__classPrivateFieldGet(this,_PQueue_pending,"f"),e--,e),"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this),this.emit("next")},_PQueue_onResumeInterval=function xt(){__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onInterval).call(this),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),__classPrivateFieldSet(this,_PQueue_timeoutId,void 0,"f")},_PQueue_isIntervalPaused_get=function xt(){const e=Date.now();if(__classPrivateFieldGet(this,_PQueue_intervalId,"f")===void 0){const At=__classPrivateFieldGet(this,_PQueue_intervalEnd,"f")-e;if(At<0)__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet(this,_PQueue_pending,"f"):0,"f");else return __classPrivateFieldGet(this,_PQueue_timeoutId,"f")===void 0&&__classPrivateFieldSet(this,_PQueue_timeoutId,setTimeout(()=>{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onResumeInterval).call(this)},At),"f"),!0}return!1},_PQueue_tryToStartAnother=function xt(){if(__classPrivateFieldGet(this,_PQueue_queue,"f").size===0)return __classPrivateFieldGet(this,_PQueue_intervalId,"f")&&clearInterval(__classPrivateFieldGet(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f"),this.emit("empty"),__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&this.emit("idle"),!1;if(!__classPrivateFieldGet(this,_PQueue_isPaused,"f")){const e=!__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_isIntervalPaused_get);if(__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_doesIntervalAllowAnother_get)&&__classPrivateFieldGet(this,_PQueue_instances,"a",_PQueue_doesConcurrentAllowAnother_get)){const At=__classPrivateFieldGet(this,_PQueue_queue,"f").dequeue();return At?(this.emit("active"),At(),e&&__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_initializeIntervalIfNeeded).call(this),!0):!1}}return!1},_PQueue_initializeIntervalIfNeeded=function xt(){__classPrivateFieldGet(this,_PQueue_isIntervalIgnored,"f")||__classPrivateFieldGet(this,_PQueue_intervalId,"f")!==void 0||(__classPrivateFieldSet(this,_PQueue_intervalId,setInterval(()=>{__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_onInterval).call(this)},__classPrivateFieldGet(this,_PQueue_interval,"f")),"f"),__classPrivateFieldSet(this,_PQueue_intervalEnd,Date.now()+__classPrivateFieldGet(this,_PQueue_interval,"f"),"f"))},_PQueue_onInterval=function xt(){__classPrivateFieldGet(this,_PQueue_intervalCount,"f")===0&&__classPrivateFieldGet(this,_PQueue_pending,"f")===0&&__classPrivateFieldGet(this,_PQueue_intervalId,"f")&&(clearInterval(__classPrivateFieldGet(this,_PQueue_intervalId,"f")),__classPrivateFieldSet(this,_PQueue_intervalId,void 0,"f")),__classPrivateFieldSet(this,_PQueue_intervalCount,__classPrivateFieldGet(this,_PQueue_carryoverConcurrencyCount,"f")?__classPrivateFieldGet(this,_PQueue_pending,"f"):0,"f"),__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_processQueue).call(this)},_PQueue_processQueue=function xt(){for(;__classPrivateFieldGet(this,_PQueue_instances,"m",_PQueue_tryToStartAnother).call(this););},_PQueue_throwOnAbort=async function xt(e){return new Promise((At,kt)=>{e.addEventListener("abort",()=>{kt(new AbortError("The task was aborted."))},{once:!0})})},_PQueue_onEvent=async function xt(e,At){return new Promise(kt=>{const Bt=()=>{At&&!At()||(this.off(e,Bt),kt())};this.on(e,Bt)})};async function walkDAG(xt,e,At,kt,Bt,Nt,jt){if(e instanceof Uint8Array){const tr=extractDataFromBlock(e,kt,Bt,Nt);At.push(tr);return}if(e.Data==null)throw errCode$1(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let Lt;try{Lt=UnixFS.unmarshal(e.Data)}catch(tr){throw errCode$1(tr,"ERR_NOT_UNIXFS")}if(Lt.data!=null){const tr=Lt.data,zt=extractDataFromBlock(tr,kt,Bt,Nt);At.push(zt),kt+=BigInt(zt.byteLength)}const er=[];if(e.Links.length!==Lt.blockSizes.length)throw errCode$1(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let tr=0;tr<e.Links.length;tr++){const zt=e.Links[tr],rr=kt,nr=rr+Lt.blockSizes[tr];if((Bt>=rr&&Bt<nr||Nt>=rr&&Nt<=nr||Bt<rr&&Nt>nr)&&er.push({link:zt,blockStart:kt}),kt=nr,kt>Nt)break}await pipe(er,tr=>map(tr,zt=>async()=>{const rr=await xt.get(zt.link.Hash,jt);return{...zt,block:rr}}),tr=>parallel(tr,{ordered:!0}),async tr=>{for await(const{link:zt,block:rr,blockStart:nr}of tr){let ir;switch(zt.Hash.code){case code$4:ir=decode$a(rr);break;case code$3:ir=rr;break;default:At.end(errCode$1(new Error(`Unsupported codec: ${zt.Hash.code}`),"ERR_NOT_UNIXFS"));return}const ar=new PQueue({concurrency:1});ar.on("error",dr=>{At.end(dr)}),ar.add(async()=>{var dr;(dr=jt.onProgress)==null||dr.call(jt,new CustomProgressEvent("unixfs:exporter:walk:file",{cid:zt.Hash})),await walkDAG(xt,ir,At,nr,Bt,Nt,jt)}),await ar.onIdle()}}),kt>=Nt&&At.end()}const fileContent=(xt,e,At,kt,Bt,Nt,jt)=>{async function*Lt(er={}){var dr,ur;const tr=At.fileSize();if(tr===void 0)throw new Error("File was a directory");const{start:zt,end:rr}=validateOffsetAndLength(tr,er.offset,er.length);if(rr===0n)return;let nr=0n;const ir=rr-zt,ar=pushable();(dr=er.onProgress)==null||dr.call(er,new CustomProgressEvent("unixfs:exporter:walk:file",{cid:xt})),walkDAG(jt,e,ar,0n,zt,rr,er).catch(fr=>{ar.end(fr)});for await(const fr of ar)if(fr!=null){if(nr+=BigInt(fr.byteLength),nr>ir)throw ar.end(),errCode$1(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");nr===ir&&ar.end(),(ur=er.onProgress)==null||ur.call(er,new CustomProgressEvent("unixfs:exporter:progress:unixfs:file",{bytesRead:nr,totalBytes:ir,fileSize:tr})),yield fr}if(nr<ir)throw errCode$1(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")}return Lt},hamtShardedDirectoryContent=(xt,e,At,kt,Bt,Nt,jt)=>{function Lt(er={}){var tr;return(tr=er.onProgress)==null||tr.call(er,new CustomProgressEvent("unixfs:exporter:walk:hamt-sharded-directory",{cid:xt})),listDirectory(e,kt,Bt,Nt,jt,er)}return Lt};async function*listDirectory(xt,e,At,kt,Bt,Nt){const jt=xt.Links,Lt=pipe(jt,er=>map(er,tr=>async()=>{var rr;const zt=tr.Name!=null?tr.Name.substring(2):null;if(zt!=null&&zt!==""){const nr=await At(tr.Hash,zt,`${e}/${zt}`,[],kt+1,Bt,Nt);return{entries:nr.entry==null?[]:[nr.entry]}}else{const nr=await Bt.get(tr.Hash,Nt);return xt=decode$a(nr),(rr=Nt.onProgress)==null||rr.call(Nt,new CustomProgressEvent("unixfs:exporter:walk:hamt-sharded-directory",{cid:tr.Hash})),{entries:listDirectory(xt,e,At,kt,Bt,Nt)}}}),er=>parallel(er,{ordered:!0}));for await(const{entries:er}of Lt)yield*er}const findLinkCid=(xt,e)=>{const At=xt.Links.find(kt=>kt.Name===e);return At==null?void 0:At.Hash},contentExporters={raw:fileContent,file:fileContent,directory:directoryContent,"hamt-sharded-directory":hamtShardedDirectoryContent,metadata:(xt,e,At,kt,Bt,Nt,jt)=>()=>[],symlink:(xt,e,At,kt,Bt,Nt,jt)=>()=>[]},unixFsResolver=async(xt,e,At,kt,Bt,Nt,jt,Lt)=>{const er=await jt.get(xt,Lt),tr=decode$a(er);let zt,rr;if(e==null&&(e=xt.toString()),tr.Data==null)throw errCode$1(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{zt=UnixFS.unmarshal(tr.Data)}catch(ir){throw errCode$1(ir,"ERR_NOT_UNIXFS")}if(At==null&&(At=e),kt.length>0){let ir;if((zt==null?void 0:zt.type)==="hamt-sharded-directory"?ir=await findShardCid(tr,kt[0],jt):ir=findLinkCid(tr,kt[0]),ir==null)throw errCode$1(new Error("file does not exist"),"ERR_NOT_FOUND");const ar=kt.shift(),dr=`${At}/${ar}`;rr={cid:ir,toResolve:kt,name:ar??"",path:dr}}const nr=contentExporters[zt.type](xt,tr,zt,At,Bt,Nt,jt);if(nr==null)throw errCode$1(new Error("could not find content exporter"),"ERR_NOT_FOUND");return zt.isDirectory()?{entry:{type:"directory",name:e,path:At,cid:xt,content:nr,unixfs:zt,depth:Nt,node:tr,size:zt.fileSize()},next:rr}:{entry:{type:"file",name:e,path:At,cid:xt,content:nr,unixfs:zt,depth:Nt,node:tr,size:zt.fileSize()},next:rr}},resolvers={[code$4]:unixFsResolver,[code$3]:resolve$1,[code$5]:resolve$3,[identity.code]:resolve$2},resolve=async(xt,e,At,kt,Bt,Nt,jt)=>{const Lt=resolvers[xt.code];if(Lt==null)throw errCode$1(new Error(`No resolver for code ${xt.code}`),"ERR_NO_RESOLVER");return Lt(xt,e,At,kt,resolve,Bt,Nt,jt)},toPathComponents=(xt="")=>(xt.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),cidAndRest=xt=>{if(xt instanceof Uint8Array)return{cid:CID.decode(xt),toResolve:[]};const e=CID.asCID(xt);if(e!=null)return{cid:e,toResolve:[]};if(typeof xt=="string"){xt.indexOf("/ipfs/")===0&&(xt=xt.substring(6));const At=toPathComponents(xt);return{cid:CID.parse(At[0]),toResolve:At.slice(1)}}throw errCode$1(new Error(`Unknown path type ${xt}`),"ERR_BAD_PATH")};async function*walkPath(xt,e,At={}){let{cid:kt,toResolve:Bt}=cidAndRest(xt),Nt=kt.toString(),jt=Nt;const Lt=Bt.length;for(;;){const er=await resolve(kt,Nt,jt,Bt,Lt,e,At);if(er.entry==null&&er.next==null)throw errCode$1(new Error(`Could not resolve ${xt}`),"ERR_NOT_FOUND");if(er.entry!=null&&(yield er.entry),er.next==null)return;Bt=er.next.toResolve,kt=er.next.cid,Nt=er.next.name,jt=er.next.path}}async function exporter(xt,e,At={}){const kt=await last(walkPath(xt,e,At));if(kt==null)throw errCode$1(new Error(`Could not resolve ${xt}`),"ERR_NOT_FOUND");return kt}var __awaiter$23=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues$5=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}};class DataStoreLevel{constructor(e={}){this.config=Object.assign({blockstoreLocation:"DATASTORE",createLevelDatabase},e),this.blockstore=new BlockstoreLevel({location:this.config.blockstoreLocation,createLevelDatabase:this.config.createLevelDatabase})}open(){return __awaiter$23(this,void 0,void 0,function*(){yield this.blockstore.open()})}close(){return __awaiter$23(this,void 0,void 0,function*(){yield this.blockstore.close()})}put(e,At,kt,Bt){var Nt,jt,Lt,er,tr,zt;return __awaiter$23(this,void 0,void 0,function*(){const rr=yield this.getBlockstoreForStoringData(e,At,kt),nr=importer([{content:Bt}],rr,{cidVersion:1});let ir;try{for(var ar=!0,dr=__asyncValues$5(nr),ur;ur=yield dr.next(),Nt=ur.done,!Nt;ar=!0)er=ur.value,ar=!1,ir=er}catch(fr){jt={error:fr}}finally{try{!ar&&!Nt&&(Lt=dr.return)&&(yield Lt.call(dr))}finally{if(jt)throw jt.error}}return{dataSize:Number((zt=(tr=ir.unixfs)===null||tr===void 0?void 0:tr.fileSize())!==null&&zt!==void 0?zt:ir.size)}})}get(e,At,kt){return __awaiter$23(this,void 0,void 0,function*(){const Bt=yield this.getBlockstoreForStoringData(e,At,kt);if(!(yield Bt.has(kt)))return;const jt=yield exporter(kt,Bt),Lt=jt.content(),er=new browserExports$1.Readable({read(){return __awaiter$23(this,void 0,void 0,function*(){const zt=yield Lt.next();zt.done?this.push(null):this.push(zt.value)})}});let tr=jt.size;return(jt.type==="file"||jt.type==="directory")&&(tr=jt.unixfs.fileSize()),{dataSize:Number(tr),dataStream:er}})}delete(e,At,kt){return __awaiter$23(this,void 0,void 0,function*(){yield(yield this.getBlockstoreForStoringData(e,At,kt)).clear()})}clear(){return __awaiter$23(this,void 0,void 0,function*(){yield this.blockstore.clear()})}getBlockstoreForStoringData(e,At,kt){return __awaiter$23(this,void 0,void 0,function*(){return yield(yield(yield(yield this.blockstore.partition("data")).partition(e)).partition(At)).partition(kt)})}}var __awaiter$22=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues$4=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}},__await$1=function(xt){return this instanceof __await$1?(this.v=xt,this):new __await$1(xt)},__asyncGenerator$1=function(xt,e,At){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var kt=At.apply(xt,e||[]),Bt,Nt=[];return Bt={},jt("next"),jt("throw"),jt("return"),Bt[Symbol.asyncIterator]=function(){return this},Bt;function jt(nr){kt[nr]&&(Bt[nr]=function(ir){return new Promise(function(ar,dr){Nt.push([nr,ir,ar,dr])>1||Lt(nr,ir)})})}function Lt(nr,ir){try{er(kt[nr](ir))}catch(ar){rr(Nt[0][3],ar)}}function er(nr){nr.value instanceof __await$1?Promise.resolve(nr.value.v).then(tr,zt):rr(Nt[0][2],nr)}function tr(nr){Lt("next",nr)}function zt(nr){Lt("throw",nr)}function rr(nr,ir){nr(ir),Nt.shift(),Nt.length&&Lt(Nt[0][0],Nt[0][1])}};const INDEX_SUBLEVEL_NAME="index";class IndexLevel{constructor(e){this.config=Object.assign({createLevelDatabase},e),this.db=new LevelWrapper({location:this.config.location,createLevelDatabase:this.config.createLevelDatabase,keyEncoding:"utf8"})}open(){return __awaiter$22(this,void 0,void 0,function*(){yield this.db.open()})}close(){return __awaiter$22(this,void 0,void 0,function*(){yield this.db.close()})}clear(){return __awaiter$22(this,void 0,void 0,function*(){yield this.db.clear()})}put(e,At,kt,Bt){return __awaiter$22(this,void 0,void 0,function*(){if(isEmptyObject$1(kt))throw new DwnError(DwnErrorCode.IndexMissingIndexableProperty,"Index must include at least one valid indexable property");const Nt={messageCid:At,indexes:kt},jt=[];for(const zt in kt){const rr=kt[zt];if(Array.isArray(rr))for(const nr of rr){const ir=this.createPutIndexedItemOperation(e,Nt,zt,nr);jt.push(ir)}else{const nr=this.createPutIndexedItemOperation(e,Nt,zt,rr);jt.push(nr)}}const Lt=this.createOperationForIndexesLookupPartition(e,{type:"put",key:At,value:JSON.stringify(kt)});jt.push(Lt);const er=yield Promise.all(jt);yield(yield this.db.partition(e)).batch(er,Bt)})}delete(e,At,kt){return __awaiter$22(this,void 0,void 0,function*(){const Bt=[],Nt=yield this.getIndexes(e,At);if(Nt===void 0)return;const jt=this.createOperationForIndexesLookupPartition(e,{type:"del",key:At});Bt.push(jt);for(const tr in Nt){const zt=Nt[tr];if(Array.isArray(zt))for(const rr of zt){const nr=this.createDeleteIndexedItemOperation(e,At,tr,rr);Bt.push(nr)}else{const rr=this.createDeleteIndexedItemOperation(e,At,tr,zt);Bt.push(rr)}}const Lt=yield Promise.all(Bt);yield(yield this.db.partition(e)).batch(Lt,kt)})}createPutIndexedItemOperation(e,At,kt,Bt){return __awaiter$22(this,void 0,void 0,function*(){const{messageCid:Nt}=At,jt=IndexLevel.keySegmentJoin(IndexLevel.encodeValue(Bt),Nt);return this.createOperationForIndexPartition(e,kt,{type:"put",key:jt,value:JSON.stringify(At)})})}createDeleteIndexedItemOperation(e,At,kt,Bt){return __awaiter$22(this,void 0,void 0,function*(){const Nt=IndexLevel.keySegmentJoin(IndexLevel.encodeValue(Bt),At);return this.createOperationForIndexPartition(e,kt,{type:"del",key:Nt})})}createOperationForIndexPartition(e,At,kt){return __awaiter$22(this,void 0,void 0,function*(){const Bt=yield this.db.partition(e),Nt=IndexLevel.getIndexPartitionName(At);return Bt.createPartitionOperation(Nt,kt)})}createOperationForIndexesLookupPartition(e,At){return __awaiter$22(this,void 0,void 0,function*(){return(yield this.db.partition(e)).createPartitionOperation(INDEX_SUBLEVEL_NAME,At)})}static getIndexPartitionName(e){return`__${e}__`}getIndexPartition(e,At){return __awaiter$22(this,void 0,void 0,function*(){const kt=IndexLevel.getIndexPartitionName(At);return(yield this.db.partition(e)).partition(kt)})}getIndexesLookupPartition(e){return __awaiter$22(this,void 0,void 0,function*(){return(yield this.db.partition(e)).partition(INDEX_SUBLEVEL_NAME)})}query(e,At,kt,Bt){return __awaiter$22(this,void 0,void 0,function*(){return IndexLevel.shouldQueryWithInMemoryPaging(At,kt)?this.queryWithInMemoryPaging(e,At,kt,Bt):this.queryWithIteratorPaging(e,At,kt,Bt)})}queryWithIteratorPaging(e,At,kt,Bt){var Nt,jt,Lt,er;return __awaiter$22(this,void 0,void 0,function*(){const{cursor:tr,limit:zt}=kt,rr=tr?this.createStartingKeyFromCursor(tr):"",nr=[];try{for(var ir=!0,ar=__asyncValues$4(this.getIndexIterator(e,rr,kt,Bt)),dr;dr=yield ar.next(),Nt=dr.done,!Nt;ir=!0){er=dr.value,ir=!1;const ur=er;if(zt!==void 0&&zt===nr.length)break;const{indexes:fr}=ur;FilterUtility.matchAnyFilter(fr,At)&&nr.push(ur)}}catch(ur){jt={error:ur}}finally{try{!ir&&!Nt&&(Lt=ar.return)&&(yield Lt.call(ar))}finally{if(jt)throw jt.error}}return nr})}getIndexIterator(e,At,kt,Bt){return __asyncGenerator$1(this,arguments,function*(){var jt,Lt,er,tr;const{sortProperty:zt,sortDirection:rr=SortDirection.Ascending,cursor:nr}=kt,ir={gt:At};rr===SortDirection.Descending&&(ir.reverse=!0,nr!==void 0&&(ir.lt=At,delete ir.gt));const ar=yield __await$1(this.getIndexPartition(e,zt));try{for(var dr=!0,ur=__asyncValues$4(ar.iterator(ir,Bt)),fr;fr=yield __await$1(ur.next()),jt=fr.done,!jt;dr=!0){tr=fr.value,dr=!1;const[pr,lr]=tr,{indexes:yr,messageCid:br}=JSON.parse(lr);yield yield __await$1({indexes:yr,messageCid:br})}}catch(pr){Lt={error:pr}}finally{try{!dr&&!jt&&(er=ur.return)&&(yield __await$1(er.call(ur)))}finally{if(Lt)throw Lt.error}}})}createStartingKeyFromCursor(e){const{messageCid:At,value:kt}=e;return IndexLevel.keySegmentJoin(IndexLevel.encodeValue(kt),At)}static createCursorFromLastArrayItem(e,At){if(e.length>0)return this.createCursorFromItem(e.at(-1),At)}static createCursorFromItem(e,At){const{messageCid:kt,indexes:Bt}=e,Nt=Bt[At];if(Nt===void 0)throw new DwnError(DwnErrorCode.IndexInvalidCursorSortProperty,`the sort property '${At}' is not defined within the given item.`);if(typeof Nt=="boolean"||Array.isArray(Nt))throw new DwnError(DwnErrorCode.IndexInvalidCursorValueType,`only string or number values are supported for cursors, a(n) ${typeof Nt} was given.`);return{messageCid:kt,value:Nt}}queryWithInMemoryPaging(e,At,kt,Bt){return __awaiter$22(this,void 0,void 0,function*(){const{sortProperty:Nt,sortDirection:jt=SortDirection.Ascending,cursor:Lt,limit:er}=kt,tr=Lt?this.createStartingKeyFromCursor(Lt):void 0,zt=new Map;At.length===0&&(At=[{}]);try{yield Promise.all(At.map(ar=>this.executeSingleFilterQuery(e,ar,Nt,zt,Bt)))}catch(ar){if(ar.code===DwnErrorCode.IndexInvalidSortPropertyInMemory)return[]}const rr=[...zt.values()].sort((ar,dr)=>this.sortItems(ar,dr,Nt,jt)),nr=tr!==void 0?this.findCursorStartingIndex(rr,jt,Nt,tr):0;if(nr<0)return[];const ir=er!==void 0?nr+er:void 0;return rr.slice(nr,ir)})}executeSingleFilterQuery(e,At,kt,Bt,Nt){return __awaiter$22(this,void 0,void 0,function*(){const jt=[];if(isEmptyObject$1(At)){const er=this.getAllItems(e,kt);jt.push(er)}const Lt=FilterSelector.reduceFilter(At);for(const er in Lt){const tr=Lt[er];if(FilterUtility.isEqualFilter(tr)){const zt=this.filterExactMatches(e,er,tr,Nt);jt.push(zt)}else if(FilterUtility.isOneOfFilter(tr))for(const zt of new Set(tr)){const rr=this.filterExactMatches(e,er,zt,Nt);jt.push(rr)}else if(FilterUtility.isRangeFilter(tr)){const zt=this.filterRangeMatches(e,er,tr,Nt);jt.push(zt)}}for(const er of jt){const tr=yield er;for(const zt of tr)if(!(Bt.has(zt.messageCid)||!FilterUtility.matchFilter(zt.indexes,At))){if(zt.indexes[kt]===void 0)throw new DwnError(DwnErrorCode.IndexInvalidSortPropertyInMemory,`invalid sort property ${kt}`);Bt.set(zt.messageCid,zt)}}})}getAllItems(e,At){var kt,Bt,Nt,jt;return __awaiter$22(this,void 0,void 0,function*(){const Lt=yield this.getIndexPartition(e,At),er=[];try{for(var tr=!0,zt=__asyncValues$4(Lt.iterator()),rr;rr=yield zt.next(),kt=rr.done,!kt;tr=!0){jt=rr.value,tr=!1;const[nr,ir]=jt;er.push(JSON.parse(ir))}}catch(nr){Bt={error:nr}}finally{try{!tr&&!kt&&(Nt=zt.return)&&(yield Nt.call(zt))}finally{if(Bt)throw Bt.error}}return er})}filterExactMatches(e,At,kt,Bt){var Nt,jt,Lt,er;return __awaiter$22(this,void 0,void 0,function*(){const tr=IndexLevel.keySegmentJoin(IndexLevel.encodeValue(kt)),zt={gt:tr},rr=yield this.getIndexPartition(e,At),nr=[];try{for(var ir=!0,ar=__asyncValues$4(rr.iterator(zt,Bt)),dr;dr=yield ar.next(),Nt=dr.done,!Nt;ir=!0){er=dr.value,ir=!1;const[ur,fr]=er;if(!ur.startsWith(tr))break;nr.push(JSON.parse(fr))}}catch(ur){jt={error:ur}}finally{try{!ir&&!Nt&&(Lt=ar.return)&&(yield Lt.call(ar))}finally{if(jt)throw jt.error}}return nr})}filterRangeMatches(e,At,kt,Bt){var Nt,jt,Lt,er;return __awaiter$22(this,void 0,void 0,function*(){const tr={};for(const dr in kt){const ur=dr;tr[ur]=IndexLevel.encodeValue(kt[ur])}tr.gt===void 0&&tr.gte===void 0&&(tr.reverse=!0);const zt=[],rr=yield this.getIndexPartition(e,At);try{for(var nr=!0,ir=__asyncValues$4(rr.iterator(tr,Bt)),ar;ar=yield ir.next(),Nt=ar.done,!Nt;nr=!0){er=ar.value,nr=!1;const[dr,ur]=er;"gt"in kt&&this.extractIndexValueFromKey(dr)===IndexLevel.encodeValue(kt.gt)||zt.push(JSON.parse(ur))}}catch(dr){jt={error:dr}}finally{try{!nr&&!Nt&&(Lt=ir.return)&&(yield Lt.call(ir))}finally{if(jt)throw jt.error}}if("lte"in kt)for(const dr of yield this.filterExactMatches(e,At,kt.lte,Bt))zt.push(dr);return zt})}sortItems(e,At,kt,Bt){const Nt=e.indexes[kt],jt=At.indexes[kt],Lt=IndexLevel.encodeValue(Nt)+e.messageCid,er=IndexLevel.encodeValue(jt)+At.messageCid;return Bt===SortDirection.Ascending?lexicographicalCompare(Lt,er):lexicographicalCompare(er,Lt)}findCursorStartingIndex(e,At,kt,Bt){const Nt=jt=>{const{messageCid:Lt,indexes:er}=jt,tr=er[kt],zt=IndexLevel.keySegmentJoin(IndexLevel.encodeValue(tr),Lt);return At===SortDirection.Ascending?zt>Bt:zt<Bt};return e.findIndex(Nt)}getIndexes(e,At){return __awaiter$22(this,void 0,void 0,function*(){const Bt=yield(yield this.getIndexesLookupPartition(e)).get(At);if(Bt!==void 0)return JSON.parse(Bt)})}extractIndexValueFromKey(e){const[At]=e.split(IndexLevel.delimiter);return At}static keySegmentJoin(...e){return e.join(IndexLevel.delimiter)}static encodeNumberValue(e){const At=Number.MAX_SAFE_INTEGER,kt="!",Bt=String(Number.MAX_SAFE_INTEGER).length,Nt=e<0?kt:"",jt=e<0?At:0;return Nt+String(e+jt).padStart(Bt,"0")}static encodeValue(e){switch(typeof e){case"number":return this.encodeNumberValue(e);default:return JSON.stringify(e)}}static shouldQueryWithInMemoryPaging(e,At){for(const kt of e)if(!IndexLevel.isFilterConcise(kt,At))return!1;return!0}static isFilterConcise(e,At){return e.recordId!==void 0?!0:At.cursor!==void 0?!1:e.protocolPath!==void 0||e.contextId!==void 0||e.parentId!==void 0||e.schema!==void 0}}IndexLevel.delimiter="\0";function assertError(xt){if(!isError(xt))throw new Error("Parameter was not an error")}function isError(xt){return objectToString(xt)==="[object Error]"||xt instanceof Error}function objectToString(xt){return Object.prototype.toString.call(xt)}function parseArguments(xt){let e,At="";if(xt.length===0)e={};else if(isError(xt[0]))e={cause:xt[0]},At=xt.slice(1).join(" ")||"";else if(xt[0]&&typeof xt[0]=="object")e=Object.assign({},xt[0]),At=xt.slice(1).join(" ")||"";else if(typeof xt[0]=="string")e={},At=At=xt.join(" ")||"";else throw new Error("Invalid arguments passed to Layerr");return{options:e,shortMessage:At}}class Layerr extends Error{constructor(e,At){const kt=[...arguments],{options:Bt,shortMessage:Nt}=parseArguments(kt);let jt=Nt;if(Bt.cause&&(jt=`${jt}: ${Bt.cause.message}`),super(jt),this.message=jt,Bt.name&&typeof Bt.name=="string"?this.name=Bt.name:this.name="Layerr",Bt.cause&&Object.defineProperty(this,"_cause",{value:Bt.cause}),Object.defineProperty(this,"_info",{value:{}}),Bt.info&&typeof Bt.info=="object"&&Object.assign(this._info,Bt.info),Error.captureStackTrace){const Lt=Bt.constructorOpt||this.constructor;Error.captureStackTrace(this,Lt)}}static cause(e){return assertError(e),e._cause&&isError(e._cause)?e._cause:null}static fullStack(e){assertError(e);const At=Layerr.cause(e);return At?`${e.stack}
caused by: ${Layerr.fullStack(At)}`:e.stack}static info(e){assertError(e);const At={},kt=Layerr.cause(e);return kt&&Object.assign(At,Layerr.info(kt)),e._info&&Object.assign(At,e._info),At}cause(){return Layerr.cause(this)}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e=`${e}: ${this.message}`),e}}const ENCODING="0123456789ABCDEFGHJKMNPQRSTVWXYZ",ENCODING_LEN=32,TIME_MAX=0xffffffffffff,TIME_LEN=10,RANDOM_LEN=16,ERROR_INFO=Object.freeze({source:"ulid"});function detectPRNG(xt){const e=detectRoot(),At=e&&(e.crypto||e.msCrypto)||null;if(typeof(At==null?void 0:At.getRandomValues)=="function")return()=>{const kt=new Uint8Array(1);return At.getRandomValues(kt),kt[0]/255};if(typeof(At==null?void 0:At.randomBytes)=="function")return()=>At.randomBytes(1).readUInt8()/255;throw new Layerr({info:{code:"PRNG_DETECT",...ERROR_INFO}},"Failed to find a reliable PRNG")}function detectRoot(){return inWebWorker()?self:typeof window<"u"?window:typeof globalThis<"u"||typeof globalThis<"u"?globalThis:null}function encodeRandom(xt,e){let At="";for(;xt>0;xt--)At=randomChar(e)+At;return At}function encodeTime(xt,e){if(isNaN(xt))throw new Layerr({info:{code:"ENC_TIME_NAN",...ERROR_INFO}},`Time must be a number: ${xt}`);if(xt>TIME_MAX)throw new Layerr({info:{code:"ENC_TIME_SIZE_EXCEED",...ERROR_INFO}},`Cannot encode a time larger than ${TIME_MAX}: ${xt}`);if(xt<0)throw new Layerr({info:{code:"ENC_TIME_NEG",...ERROR_INFO}},`Time must be positive: ${xt}`);if(Number.isInteger(xt)===!1)throw new Layerr({info:{code:"ENC_TIME_TYPE",...ERROR_INFO}},`Time must be an integer: ${xt}`);let At,kt="";for(let Bt=e;Bt>0;Bt--)At=xt%ENCODING_LEN,kt=ENCODING.charAt(At)+kt,xt=(xt-At)/ENCODING_LEN;return kt}function incrementBase32(xt){let e,At=xt.length,kt,Bt,Nt=xt;const jt=ENCODING_LEN-1;for(;!e&&At-->=0;){if(kt=Nt[At],Bt=ENCODING.indexOf(kt),Bt===-1)throw new Layerr({info:{code:"B32_INC_ENC",...ERROR_INFO}},"Incorrectly encoded string");if(Bt===jt){Nt=replaceCharAt(Nt,At,ENCODING[0]);continue}e=replaceCharAt(Nt,At,ENCODING[Bt+1])}if(typeof e=="string")return e;throw new Layerr({info:{code:"B32_INC_INVALID",...ERROR_INFO}},"Failed incrementing string")}function inWebWorker(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function monotonicFactory(xt){const e=detectPRNG();let At=0,kt;return function(Nt){const jt=isNaN(Nt)?Date.now():Nt;if(jt<=At){const er=kt=incrementBase32(kt);return encodeTime(At,TIME_LEN)+er}At=jt;const Lt=kt=encodeRandom(RANDOM_LEN,e);return encodeTime(jt,TIME_LEN)+Lt}}function randomChar(xt){let e=Math.floor(xt()*ENCODING_LEN);return e===ENCODING_LEN&&(e=ENCODING_LEN-1),ENCODING.charAt(e)}function replaceCharAt(xt,e,At){return e>xt.length-1?xt:xt.substr(0,e)+At+xt.substr(e+1)}var __awaiter$21=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class EventLogLevel{constructor(e){this.index=new IndexLevel(Object.assign({location:"EVENTLOG",createLevelDatabase},e)),this.ulidFactory=monotonicFactory()}open(){return __awaiter$21(this,void 0,void 0,function*(){return this.index.open()})}close(){return __awaiter$21(this,void 0,void 0,function*(){return this.index.close()})}clear(){return __awaiter$21(this,void 0,void 0,function*(){return this.index.clear()})}append(e,At,kt){return __awaiter$21(this,void 0,void 0,function*(){const Bt=this.ulidFactory();yield this.index.put(e,At,Object.assign(Object.assign({},kt),{watermark:Bt}))})}queryEvents(e,At,kt){return __awaiter$21(this,void 0,void 0,function*(){const Bt=yield this.index.query(e,At,{sortProperty:"watermark",cursor:kt});return{events:Bt.map(({messageCid:Nt})=>Nt),cursor:IndexLevel.createCursorFromLastArrayItem(Bt,"watermark")}})}getEvents(e,At){return __awaiter$21(this,void 0,void 0,function*(){return this.queryEvents(e,[],At)})}deleteEventsByCid(e,At){return __awaiter$21(this,void 0,void 0,function*(){const kt=[];for(const Bt of At)kt.push(this.index.delete(e,Bt));yield Promise.all(kt)})}}function readonly({enumerable:xt=!0,configurable:e=!1}={}){return{enumerable:xt,configurable:e,writable:!1}}function*linksWithin(xt,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[At,kt]of e.entries()){const Bt=[...xt,At],Nt=CID.asCID(kt);Nt?yield[Bt.join("/"),Nt]:typeof kt=="object"&&(yield*links(kt,Bt))}else{const At=CID.asCID(e);At?yield[xt.join("/"),At]:yield*links(e,xt)}}function*links(xt,e){if(xt==null||xt instanceof Uint8Array)return;const At=CID.asCID(xt);At&&(yield[e.join("/"),At]);for(const[kt,Bt]of Object.entries(xt)){const Nt=[...e,kt];yield*linksWithin(Nt,Bt)}}function*treeWithin(xt,e){if(Array.isArray(e))for(const[At,kt]of e.entries()){const Bt=[...xt,At];yield Bt.join("/"),typeof kt=="object"&&!CID.asCID(kt)&&(yield*tree(kt,Bt))}else yield*tree(e,xt)}function*tree(xt,e){if(!(xt==null||typeof xt!="object"))for(const[At,kt]of Object.entries(xt)){const Bt=[...e,At];yield Bt.join("/"),kt!=null&&!(kt instanceof Uint8Array)&&typeof kt=="object"&&!CID.asCID(kt)&&(yield*treeWithin(Bt,kt))}}function get(xt,e){let At=xt;for(const[kt,Bt]of e.entries()){if(At=At[Bt],At==null)throw new Error(`Object has no property at ${e.slice(0,kt+1).map(jt=>`[${JSON.stringify(jt)}]`).join("")}`);const Nt=CID.asCID(At);if(Nt)return{value:Nt,remaining:e.slice(kt+1).join("/")}}return{value:At}}class Block{constructor({cid:e,bytes:At,value:kt}){if(!e||!At||typeof kt>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=At,this.value=kt,this.asBlock=this,Object.defineProperties(this,{cid:readonly(),bytes:readonly(),value:readonly(),asBlock:readonly()})}links(){return links(this.value,[])}tree(){return tree(this.value,[])}get(e="/"){return get(this.value,e.split("/").filter(Boolean))}}async function encode({value:xt,codec:e,hasher:At}){if(typeof xt>"u")throw new Error('Missing required argument "value"');if(!e||!At)throw new Error("Missing required argument: codec or hasher");const kt=e.encode(xt),Bt=await At.digest(kt),Nt=CID.create(1,e.code,Bt);return new Block({value:xt,bytes:kt,cid:Nt})}async function decode({bytes:xt,codec:e,hasher:At}){if(!xt)throw new Error('Missing required argument "bytes"');if(!e||!At)throw new Error("Missing required argument: codec or hasher");const kt=e.decode(xt),Bt=await At.digest(xt),Nt=CID.create(1,e.code,Bt);return new Block({value:kt,bytes:xt,cid:Nt})}var __awaiter$20=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class MessageStoreLevel{constructor(e={}){this.config=Object.assign({blockstoreLocation:"MESSAGESTORE",indexLocation:"INDEX",createLevelDatabase},e),this.blockstore=new BlockstoreLevel({location:this.config.blockstoreLocation,createLevelDatabase:this.config.createLevelDatabase}),this.index=new IndexLevel({location:this.config.indexLocation,createLevelDatabase:this.config.createLevelDatabase})}open(){return __awaiter$20(this,void 0,void 0,function*(){yield this.blockstore.open(),yield this.index.open()})}close(){return __awaiter$20(this,void 0,void 0,function*(){yield this.blockstore.close(),yield this.index.close()})}get(e,At,kt){var Bt;return __awaiter$20(this,void 0,void 0,function*(){(Bt=kt==null?void 0:kt.signal)===null||Bt===void 0||Bt.throwIfAborted();const Nt=yield executeUnlessAborted(this.blockstore.partition(e),kt==null?void 0:kt.signal),jt=CID.parse(At),Lt=yield Nt.get(jt,kt);return Lt?(yield executeUnlessAborted(decode({bytes:Lt,codec:cbor,hasher:sha256$7}),kt==null?void 0:kt.signal)).value:void 0})}query(e,At,kt,Bt,Nt){var jt;return __awaiter$20(this,void 0,void 0,function*(){(jt=Nt==null?void 0:Nt.signal)===null||jt===void 0||jt.throwIfAborted();const Lt=MessageStoreLevel.buildQueryOptions(kt,Bt),er=yield this.index.query(e,At,Lt,Nt);let tr;(Bt==null?void 0:Bt.limit)!==void 0&&Bt.limit<er.length&&(er.splice(-1),tr=IndexLevel.createCursorFromLastArrayItem(er,Lt.sortProperty));const zt=[];for(let rr=0;rr<er.length;rr++){const{messageCid:nr}=er[rr],ir=yield this.get(e,nr,Nt);ir&&zt.push(ir)}return{messages:zt,cursor:tr}})}static buildQueryOptions(e={},At={}){let{limit:kt,cursor:Bt}=At;const{dateCreated:Nt,datePublished:jt,messageTimestamp:Lt}=e;let er=SortDirection.Ascending,tr="messageTimestamp";return Nt!==void 0?tr="dateCreated":jt!==void 0?tr="datePublished":Lt!==void 0&&(tr="messageTimestamp"),e[tr]!==void 0&&(er=e[tr]),kt!==void 0&&kt>0&&(kt=kt+1),{sortDirection:er,sortProperty:tr,limit:kt,cursor:Bt}}delete(e,At,kt){var Bt;return __awaiter$20(this,void 0,void 0,function*(){(Bt=kt==null?void 0:kt.signal)===null||Bt===void 0||Bt.throwIfAborted();const Nt=yield executeUnlessAborted(this.blockstore.partition(e),kt==null?void 0:kt.signal),jt=CID.parse(At);yield Nt.delete(jt,kt),yield this.index.delete(e,At,kt)})}put(e,At,kt,Bt){var Nt;return __awaiter$20(this,void 0,void 0,function*(){(Nt=Bt==null?void 0:Bt.signal)===null||Nt===void 0||Nt.throwIfAborted();const jt=yield executeUnlessAborted(this.blockstore.partition(e),Bt==null?void 0:Bt.signal),Lt=yield executeUnlessAborted(encode({value:At,codec:cbor,hasher:sha256$7}),Bt==null?void 0:Bt.signal),er=Cid.parseCid(yield Message.getCid(At));yield jt.put(er,Lt.bytes,Bt);const tr=er.toString();yield this.index.put(e,tr,kt,Bt)})}clear(){return __awaiter$20(this,void 0,void 0,function*(){yield this.blockstore.clear(),yield this.index.clear()})}}var __awaiter$1$=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues$3=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}};class ResumableTaskStoreLevel{constructor(e){this.config=Object.assign({location:"RESUMABLE-TASK-STORE",createLevelDatabase},e),this.db=new LevelWrapper({location:this.config.location,createLevelDatabase:this.config.createLevelDatabase,keyEncoding:"utf8"})}open(){return __awaiter$1$(this,void 0,void 0,function*(){yield this.db.open()})}close(){return __awaiter$1$(this,void 0,void 0,function*(){yield this.db.close()})}register(e,At){return __awaiter$1$(this,void 0,void 0,function*(){const kt=yield Cid.computeCid(e),Bt={id:kt,timeout:Date.now()+At*1e3,retryCount:0,task:e};return yield this.db.put(kt,JSON.stringify(Bt)),Bt})}grab(e){var At,kt,Bt,Nt;return __awaiter$1$(this,void 0,void 0,function*(){const jt=[];try{for(var Lt=!0,er=__asyncValues$3(this.db.iterator()),tr;tr=yield er.next(),At=tr.done,!At;Lt=!0){Nt=tr.value,Lt=!1;const[zt,rr]=Nt,nr=JSON.parse(rr);if(Date.now()>=nr.timeout&&(nr.timeout=Date.now()+ResumableTaskStoreLevel.taskTimeoutInSeconds*1e3,nr.retryCount++,yield this.db.put(nr.id,JSON.stringify(nr)),jt.push(nr)),jt.length>=e)break}}catch(zt){kt={error:zt}}finally{try{!Lt&&!At&&(Bt=er.return)&&(yield Bt.call(er))}finally{if(kt)throw kt.error}}return jt})}read(e){return __awaiter$1$(this,void 0,void 0,function*(){const At=yield this.db.get(e);if(At)return JSON.parse(At)})}extend(e,At){return __awaiter$1$(this,void 0,void 0,function*(){const kt=yield this.db.get(e);if(kt){const Bt=JSON.parse(kt);Bt.timeout=Date.now()+At*1e3,yield this.db.put(Bt.id,JSON.stringify(Bt))}})}delete(e){return __awaiter$1$(this,void 0,void 0,function*(){return this.db.delete(e)})}clear(){return __awaiter$1$(this,void 0,void 0,function*(){yield this.db.clear()})}}ResumableTaskStoreLevel.taskTimeoutInSeconds=60;var DwnInterface$1;(function(xt){xt.MessagesQuery="MessagesQuery",xt.MessagesRead="MessagesRead",xt.MessagesSubscribe="MessagesSubscribe",xt.ProtocolsConfigure="ProtocolsConfigure",xt.ProtocolsQuery="ProtocolsQuery",xt.RecordsDelete="RecordsDelete",xt.RecordsQuery="RecordsQuery",xt.RecordsRead="RecordsRead",xt.RecordsSubscribe="RecordsSubscribe",xt.RecordsWrite="RecordsWrite"})(DwnInterface$1||(DwnInterface$1={}));const dwnMessageConstructors$1={[DwnInterface$1.MessagesQuery]:MessagesQuery,[DwnInterface$1.MessagesRead]:MessagesRead,[DwnInterface$1.MessagesSubscribe]:MessagesSubscribe,[DwnInterface$1.ProtocolsConfigure]:ProtocolsConfigure,[DwnInterface$1.ProtocolsQuery]:ProtocolsQuery,[DwnInterface$1.RecordsDelete]:RecordsDelete,[DwnInterface$1.RecordsQuery]:RecordsQuery,[DwnInterface$1.RecordsRead]:RecordsRead,[DwnInterface$1.RecordsSubscribe]:RecordsSubscribe,[DwnInterface$1.RecordsWrite]:RecordsWrite};var DidVerificationRelationship$1;(function(xt){xt.authentication="authentication",xt.assertionMethod="assertionMethod",xt.keyAgreement="keyAgreement",xt.capabilityInvocation="capabilityInvocation",xt.capabilityDelegation="capabilityDelegation"})(DidVerificationRelationship$1||(DidVerificationRelationship$1={}));const EMPTY_DID_RESOLUTION_RESULT$1={"@context":"https://w3id.org/did-resolution/v1",didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};let Did$1=class xl{constructor({method:e,id:At,path:kt,query:Bt,fragment:Nt,params:jt}){this.uri=`did:${e}:${At}`,this.method=e,this.id=At,this.path=kt,this.query=Bt,this.fragment=Nt,this.params=jt}static parse(e){if(!e)return null;const At=xl.DID_URI_PATTERN.exec(e);if(!At||!At.groups)return null;const{method:kt,id:Bt,path:Nt,query:jt,fragment:Lt}=At.groups,er={uri:`did:${kt}:${Bt}`,method:kt,id:Bt};if(Nt&&(er.path=Nt),jt&&(er.query=jt.slice(1)),Lt&&(er.fragment=Lt.slice(1)),jt){const tr={},zt=jt.slice(1).split("&");for(const rr of zt){const[nr,ir]=rr.split("=");tr[nr]=ir}er.params=tr}return er}};Did$1.METHOD_PATTERN="([a-z0-9]+)";Did$1.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})";Did$1.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${Did$1.PCT_ENCODED_PATTERN})`;Did$1.METHOD_ID_PATTERN=`((?:${Did$1.ID_CHAR_PATTERN}*:)*(${Did$1.ID_CHAR_PATTERN}+))`;Did$1.PATH_PATTERN="(/[^#?]*)?";Did$1.QUERY_PATTERN="([?][^#]*)?";Did$1.FRAGMENT_PATTERN="(#.*)?";Did$1.DID_URI_PATTERN=new RegExp(`^did:(?<method>${Did$1.METHOD_PATTERN}):(?<id>${Did$1.METHOD_ID_PATTERN})(?<path>${Did$1.PATH_PATTERN})(?<query>${Did$1.QUERY_PATTERN})(?<fragment>${Did$1.FRAGMENT_PATTERN})$`);let DidError$1=class Il extends Error{constructor(e,At){super(`${e}: ${At}`),this.code=e,this.name="DidError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Il)}};var DidErrorCode$1;(function(xt){xt.InvalidDid="invalidDid",xt.MethodNotSupported="methodNotSupported",xt.InternalError="internalError",xt.InvalidDidDocument="invalidDidDocument",xt.InvalidDidDocumentLength="invalidDidDocumentLength",xt.InvalidDidUrl="invalidDidUrl",xt.InvalidPreviousDidProof="invalidPreviousDidProof",xt.InvalidPublicKey="invalidPublicKey",xt.InvalidPublicKeyLength="invalidPublicKeyLength",xt.InvalidPublicKeyType="invalidPublicKeyType",xt.InvalidSignature="invalidSignature",xt.NotFound="notFound",xt.RepresentationNotSupported="representationNotSupported",xt.UnsupportedPublicKeyType="unsupportedPublicKeyType"})(DidErrorCode$1||(DidErrorCode$1={}));function isArrayBufferSlice(xt){return xt.byteOffset!==0||xt.byteLength!==xt.buffer.byteLength}function isAsyncIterable(xt){return typeof xt!="object"||xt===null?!1:typeof xt[Symbol.asyncIterator]=="function"}function universalTypeOf(xt){const At=Object.prototype.toString.call(xt).match(/\s([a-zA-Z0-9]+)/),[kt,Bt]=At;return Bt}var __awaiter$1_=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues$2=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}};const textEncoder=new TextEncoder,textDecoder=new TextDecoder;class Convert{constructor(e,At){this.data=e,this.format=At}static arrayBuffer(e){return new Convert(e,"ArrayBuffer")}static asyncIterable(e){if(!isAsyncIterable(e))throw new TypeError("Input must be of type AsyncIterable.");return new Convert(e,"AsyncIterable")}static base32Z(e){return new Convert(e,"Base32Z")}static base58Btc(e){return new Convert(e,"Base58Btc")}static base64Url(e){return new Convert(e,"Base64Url")}static bufferSource(e){return new Convert(e,"BufferSource")}static hex(e){if(typeof e!="string")throw new TypeError("Hex input must be a string.");if(e.length%2!==0)throw new TypeError("Hex input must have an even number of characters.");return new Convert(e,"Hex")}static multibase(e){return new Convert(e,"Multibase")}static object(e){return new Convert(e,"Object")}static string(e){return new Convert(e,"String")}static uint8Array(e){return new Convert(e,"Uint8Array")}toArrayBuffer(){switch(this.format){case"Base58Btc":return base58btc.baseDecode(this.data).buffer;case"Base64Url":return base64url.baseDecode(this.data).buffer;case"BufferSource":{if(universalTypeOf(this.data)==="ArrayBuffer")return this.data;if(ArrayBuffer.isView(this.data))return isArrayBufferSlice(this.data)?this.data.buffer.slice(this.data.byteOffset,this.data.byteOffset+this.data.byteLength):this.data.buffer;throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":return this.toUint8Array().buffer;case"String":return this.toUint8Array().buffer;case"Uint8Array":return this.data.buffer;default:throw new TypeError(`Conversion from ${this.format} to ArrayBuffer is not supported.`)}}toArrayBufferAsync(){return __awaiter$1_(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":return yield(yield this.toBlobAsync()).arrayBuffer();default:throw new TypeError(`Asynchronous conversion from ${this.format} to ArrayBuffer is not supported.`)}})}toBase32Z(){switch(this.format){case"Uint8Array":return base32z.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Z is not supported.`)}}toBase58Btc(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return base58btc.baseEncode(e)}case"Multibase":return this.data.substring(1);case"Uint8Array":return base58btc.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base58Btc is not supported.`)}}toBase64Url(){switch(this.format){case"ArrayBuffer":{const e=new Uint8Array(this.data);return base64url.baseEncode(e)}case"BufferSource":{const e=this.toUint8Array();return base64url.baseEncode(e)}case"Object":{const e=JSON.stringify(this.data),At=textEncoder.encode(e);return base64url.baseEncode(At)}case"String":{const e=textEncoder.encode(this.data);return base64url.baseEncode(e)}case"Uint8Array":return base64url.baseEncode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Base64Url is not supported.`)}}toBlobAsync(){return __awaiter$1_(this,void 0,void 0,function*(){var e,At,kt,Bt;switch(this.format){case"AsyncIterable":{const er=[];try{for(var Nt=!0,jt=__asyncValues$2(this.data),Lt;Lt=yield jt.next(),e=Lt.done,!e;Nt=!0){Bt=Lt.value,Nt=!1;const zt=Bt;er.push(zt)}}catch(zt){At={error:zt}}finally{try{!Nt&&!e&&(kt=jt.return)&&(yield kt.call(jt))}finally{if(At)throw At.error}}return new Blob(er)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Blob is not supported.`)}})}toHex(){const e=Array.from({length:256},(At,kt)=>kt.toString(16).padStart(2,"0"));switch(this.format){case"ArrayBuffer":{const At=this.toUint8Array();return Convert.uint8Array(At).toHex()}case"Base64Url":{const At=this.toUint8Array();return Convert.uint8Array(At).toHex()}case"Uint8Array":{let At="";for(let kt=0;kt<this.data.length;kt++)At+=e[this.data[kt]];return At}default:throw new TypeError(`Conversion from ${this.format} to Hex is not supported.`)}}toMultibase(){switch(this.format){case"Base58Btc":return`z${this.data}`;default:throw new TypeError(`Conversion from ${this.format} to Multibase is not supported.`)}}toObject(){switch(this.format){case"Base64Url":{const e=base64url.baseDecode(this.data),At=textDecoder.decode(e);return JSON.parse(At)}case"String":return JSON.parse(this.data);case"Uint8Array":{const e=textDecoder.decode(this.data);return JSON.parse(e)}default:throw new TypeError(`Conversion from ${this.format} to Object is not supported.`)}}toObjectAsync(){return __awaiter$1_(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toStringAsync();return JSON.parse(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Object is not supported.`)}})}toString(){switch(this.format){case"ArrayBuffer":return textDecoder.decode(this.data);case"Base64Url":{const e=base64url.baseDecode(this.data);return textDecoder.decode(e)}case"Object":return JSON.stringify(this.data);case"Uint8Array":return textDecoder.decode(this.data);default:throw new TypeError(`Conversion from ${this.format} to String is not supported.`)}}toStringAsync(){return __awaiter$1_(this,void 0,void 0,function*(){var e,At,kt,Bt;switch(this.format){case"AsyncIterable":{let er="";try{for(var Nt=!0,jt=__asyncValues$2(this.data),Lt;Lt=yield jt.next(),e=Lt.done,!e;Nt=!0){Bt=Lt.value,Nt=!1;const tr=Bt;typeof tr=="string"?er+=tr:er+=textDecoder.decode(tr,{stream:!0})}}catch(tr){At={error:tr}}finally{try{!Nt&&!e&&(kt=jt.return)&&(yield kt.call(jt))}finally{if(At)throw At.error}}return er+=textDecoder.decode(void 0,{stream:!1}),er}default:throw new TypeError(`Asynchronous conversion from ${this.format} to String is not supported.`)}})}toUint8Array(){switch(this.format){case"ArrayBuffer":return new Uint8Array(this.data);case"Base32Z":return base32z.baseDecode(this.data);case"Base58Btc":return base58btc.baseDecode(this.data);case"Base64Url":return base64url.baseDecode(this.data);case"BufferSource":{const e=universalTypeOf(this.data);if(e==="Uint8Array")return this.data;if(e==="ArrayBuffer")return new Uint8Array(this.data);if(ArrayBuffer.isView(this.data))return new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength);throw new TypeError(`${this.format} value is not of type: ArrayBuffer, DataView, or TypedArray.`)}case"Hex":{const e=new Uint8Array(this.data.length/2);for(let At=0;At<this.data.length;At+=2){const kt=parseInt(this.data.substring(At,At+2),16);if(isNaN(kt))throw new TypeError("Input is not a valid hexadecimal string.");e[At/2]=kt}return e}case"Object":{const e=JSON.stringify(this.data);return textEncoder.encode(e)}case"String":return textEncoder.encode(this.data);default:throw new TypeError(`Conversion from ${this.format} to Uint8Array is not supported.`)}}toUint8ArrayAsync(){return __awaiter$1_(this,void 0,void 0,function*(){switch(this.format){case"AsyncIterable":{const e=yield this.toArrayBufferAsync();return new Uint8Array(e)}default:throw new TypeError(`Asynchronous conversion from ${this.format} to Uint8Array is not supported.`)}})}}class Multicodec{static addPrefix(e){var At;let{code:kt,data:Bt,name:Nt}=e;if(!(Nt?!kt:kt))throw new Error("Either 'name' or 'code' must be defined, but not both.");if(kt=Multicodec.codeToName.has(kt)?kt:Multicodec.nameToCode.get(Nt),kt===void 0)throw new Error(`Unsupported multicodec: ${(At=e.name)!==null&&At!==void 0?At:e.code}`);const jt=encodingLength$4(kt),Lt=new Uint8Array(jt+Bt.byteLength);return Lt.set(Bt,jt),encodeTo(kt,Lt),Lt}static getCodeFromData(e){const{prefixedData:At}=e,[kt,Bt]=decode$5(At);return kt}static getCodeFromName(e){const{name:At}=e,kt=Multicodec.nameToCode.get(At);if(kt===void 0)throw new Error(`Unsupported multicodec: ${At}`);return kt}static getNameFromCode(e){const{code:At}=e,kt=Multicodec.codeToName.get(At);if(kt===void 0)throw new Error(`Unsupported multicodec: ${At}`);return kt}static registerCodec(e){Multicodec.codeToName.set(e.code,e.name),Multicodec.nameToCode.set(e.name,e.code)}static removePrefix(e){const{prefixedData:At}=e,[kt,Bt]=decode$5(At),Nt=Multicodec.codeToName.get(kt);if(Nt===void 0)throw new Error(`Unsupported multicodec: ${kt}`);return{code:kt,data:At.slice(Bt),name:Nt}}}Multicodec.codeToName=new Map;Multicodec.nameToCode=new Map;Multicodec.registerCodec({code:237,name:"ed25519-pub"});Multicodec.registerCodec({code:4864,name:"ed25519-priv"});Multicodec.registerCodec({code:236,name:"x25519-pub"});Multicodec.registerCodec({code:4866,name:"x25519-priv"});Multicodec.registerCodec({code:231,name:"secp256k1-pub"});Multicodec.registerCodec({code:4865,name:"secp256k1-priv"});function isEmptyObject(xt){return typeof xt!="object"||xt===null||Object.getOwnPropertySymbols(xt).length>0?!1:Object.keys(xt).length===0}function removeUndefinedProperties(xt){Object.keys(xt).forEach(e=>{xt[e]===void 0?delete xt[e]:typeof xt[e]=="object"&&removeUndefinedProperties(xt[e])})}var __awaiter$1Z=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class LevelStore{constructor({db:e,location:At="DATASTORE"}={}){this.store=e??new Level$1(At)}clear(){return __awaiter$1Z(this,void 0,void 0,function*(){yield this.store.clear()})}close(){return __awaiter$1Z(this,void 0,void 0,function*(){yield this.store.close()})}delete(e){return __awaiter$1Z(this,void 0,void 0,function*(){yield this.store.del(e)})}get(e){return __awaiter$1Z(this,void 0,void 0,function*(){try{return yield this.store.get(e)}catch(At){if(At.notFound)return;throw At}})}set(e,At){return __awaiter$1Z(this,void 0,void 0,function*(){yield this.store.put(e,At)})}}class MemoryStore{constructor(){this.store=new Map}clear(){return __awaiter$1Z(this,void 0,void 0,function*(){this.store.clear()})}close(){return __awaiter$1Z(this,void 0,void 0,function*(){})}delete(e){return __awaiter$1Z(this,void 0,void 0,function*(){return this.store.delete(e)})}get(e){return __awaiter$1Z(this,void 0,void 0,function*(){return this.store.get(e)})}has(e){return __awaiter$1Z(this,void 0,void 0,function*(){return this.store.has(e)})}list(){return __awaiter$1Z(this,void 0,void 0,function*(){return Array.from(this.store.values())})}set(e,At){return __awaiter$1Z(this,void 0,void 0,function*(){this.store.set(e,At)})}}var __awaiter$1Y=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__await=function(xt){return this instanceof __await?(this.v=xt,this):new __await(xt)},__asyncGenerator=function(xt,e,At){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var kt=At.apply(xt,e||[]),Bt,Nt=[];return Bt={},Lt("next"),Lt("throw"),Lt("return",jt),Bt[Symbol.asyncIterator]=function(){return this},Bt;function jt(ir){return function(ar){return Promise.resolve(ar).then(ir,rr)}}function Lt(ir,ar){kt[ir]&&(Bt[ir]=function(dr){return new Promise(function(ur,fr){Nt.push([ir,dr,ur,fr])>1||er(ir,dr)})},ar&&(Bt[ir]=ar(Bt[ir])))}function er(ir,ar){try{tr(kt[ir](ar))}catch(dr){nr(Nt[0][3],dr)}}function tr(ir){ir.value instanceof __await?Promise.resolve(ir.value.v).then(zt,rr):nr(Nt[0][2],ir)}function zt(ir){er("next",ir)}function rr(ir){er("throw",ir)}function nr(ir,ar){ir(ar),Nt.shift(),Nt.length&&er(Nt[0][0],Nt[0][1])}};class Stream{static asAsyncIterator(e){return __asyncGenerator(this,arguments,function*(){const kt=e.getReader();try{for(;;){const{done:Bt,value:Nt}=yield __await(kt.read());if(Bt)break;yield yield __await(Nt)}}finally{kt.releaseLock()}})}static consumeToArrayBuffer(e){return __awaiter$1Y(this,arguments,void 0,function*({readableStream:At}){const kt=Stream.asAsyncIterator(At);return yield Convert.asyncIterable(kt).toArrayBufferAsync()})}static consumeToBlob(e){return __awaiter$1Y(this,arguments,void 0,function*({readableStream:At}){const kt=Stream.asAsyncIterator(At);return yield Convert.asyncIterable(kt).toBlobAsync()})}static consumeToBytes(e){return __awaiter$1Y(this,arguments,void 0,function*({readableStream:At}){const kt=Stream.asAsyncIterator(At);return yield Convert.asyncIterable(kt).toUint8ArrayAsync()})}static consumeToJson(e){return __awaiter$1Y(this,arguments,void 0,function*({readableStream:At}){const kt=Stream.asAsyncIterator(At);return yield Convert.asyncIterable(kt).toObjectAsync()})}static consumeToText(e){return __awaiter$1Y(this,arguments,void 0,function*({readableStream:At}){const kt=Stream.asAsyncIterator(At);return yield Convert.asyncIterable(kt).toStringAsync()})}static generateByteStream({streamLength:e,chunkLength:At,fillValue:kt}){let Bt=e??1/0,Nt;function jt(){const Lt=Math.min(Bt,At??1/0);Bt-=Lt;let er;if(typeof kt=="number")er=new Uint8Array(Lt).fill(kt);else if(Array.isArray(kt)){er=new Uint8Array(Lt);const[tr,zt]=kt,rr=zt-tr+1;for(let nr=0;nr<Lt;nr++)er[nr]=Math.floor(Math.random()*rr)+tr}else er=new Uint8Array(Lt);Nt.enqueue(er),Bt<=0&&Nt.close()}return new ReadableStream({start(Lt){Nt=Lt,jt()},pull(){jt()}})}static isReadable({readableStream:e}){if(!Stream.isReadableStream(e)||e.locked)return!1;try{return e.getReader().releaseLock(),!0}catch{return!1}}static isReadableStream(e){return typeof e=="object"&&e!==null&&"getReader"in e&&typeof e.getReader=="function"}static isStream(e){return Stream.isReadableStream(e)||Stream.isWritableStream(e)||Stream.isTransformStream(e)}static isTransformStream(e){return typeof e=="object"&&e!==null&&"readable"in e&&typeof e.readable=="object"&&"writable"in e&&typeof e.writable=="object"}static isWritableStream(e){return typeof e=="object"&&e!==null&&"getWriter"in e&&typeof e.getWriter=="function"&&"abort"in e&&typeof e.abort=="function"}}var __awaiter$1X=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class NodeStream{static consumeToArrayBuffer(e){return __awaiter$1X(this,arguments,void 0,function*({readable:At}){return yield Convert.asyncIterable(At).toArrayBufferAsync()})}static consumeToBlob(e){return __awaiter$1X(this,arguments,void 0,function*({readable:At}){return yield Convert.asyncIterable(At).toBlobAsync()})}static consumeToBytes(e){return __awaiter$1X(this,arguments,void 0,function*({readable:At}){return yield Convert.asyncIterable(At).toUint8ArrayAsync()})}static consumeToJson(e){return __awaiter$1X(this,arguments,void 0,function*({readable:At}){return yield Convert.asyncIterable(At).toObjectAsync()})}static consumeToText(e){return __awaiter$1X(this,arguments,void 0,function*({readable:At}){return yield Convert.asyncIterable(At).toStringAsync()})}static fromWebReadable({readableStream:e,readableOptions:At}){if(!Stream.isReadableStream(e))throw new TypeError("NodeStream.fromWebReadable: 'readableStream' is not a Web ReadableStream.");const kt=e.getReader();let Bt=!1;const Nt=new browserExports$1.Readable(Object.assign(Object.assign({},At),{read:function(){kt.read().then(({done:jt,value:Lt})=>{if(jt)this.push(null);else if(!this.push(Lt))return}).catch(jt=>{this.destroy(jt)})},destroy:function(jt,Lt){function er(){Lt(jt)}if(!Bt){kt.cancel(jt).then(er).catch(er);return}er()}}));return kt.closed.then(()=>{Bt=!0}).catch(jt=>{Bt=!0,Nt.destroy(jt)}),Nt}static isDestroyed({stream:e}){if(!NodeStream.isStream(e))throw new TypeError("NodeStream.isDestroyed: 'stream' is not a Node stream.");const At="_writableState"in e?e._writableState:void 0,kt=e._readableState,Bt=At||kt;return!!(e.destroyed||Bt.destroyed)}static isReadable({readable:e}){return NodeStream.isReadableStream(e)?e.readable&&typeof e._readableState.ended=="boolean"&&!e._readableState.ended&&typeof e._readableState.endEmitted=="boolean"&&!e._readableState.endEmitted&&!e.destroyed&&!e.isPaused():!1}static isReadableStream(e){return typeof e=="object"&&e!==null&&"pipe"in e&&typeof e.pipe=="function"&&"on"in e&&typeof e.on=="function"&&!("_writableState"in e)&&"_readableState"in e}static isStream(e){return typeof e=="object"&&e!==null&&("_readableState"in e||"_writableState"in e)}static toWebReadable({readable:e}){if(!NodeStream.isReadableStream(e))throw new TypeError("NodeStream.toWebReadable: 'readable' is not a Node Readable stream.");if(NodeStream.isDestroyed({stream:e})){const At=new ReadableStream;return At.cancel(),At}return new ReadableStream({start(At){e.on("data",kt=>{At.enqueue(kt)}),e.on("end",()=>{At.close()}),e.on("error",kt=>{At.error(kt)})},cancel(){e.destroy()}})}}var __awaiter$1W=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let Sha256$1=class{static digest(e){return __awaiter$1W(this,arguments,void 0,function*({data:At}){return sha256$5(At)})}},CryptoAlgorithm$1=class{};var __awaiter$1V=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let Sha2Algorithm$1=class extends CryptoAlgorithm$1{digest(e){return __awaiter$1V(this,arguments,void 0,function*({algorithm:At,data:kt}){switch(At){case"SHA-256":return yield Sha256$1.digest({data:kt})}})}};function canonicalize$1(xt){const e=kt=>{if(kt!==null&&typeof kt=="object"&&!Array.isArray(kt)){const Bt=Object.keys(kt).sort(),Nt={};for(const jt of Bt)Nt[jt]=e(kt[jt]);return Nt}return kt},At=e(xt);return JSON.stringify(At)}var __awaiter$1U=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const KEY_URI_PREFIX_JWK$1="urn:jwk:";function computeJwkThumbprint$1(xt){return __awaiter$1U(this,arguments,void 0,function*({jwk:e}){const At=e.kty;let kt;if(At==="EC")kt={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(At==="oct")kt={k:e.k,kty:e.kty};else if(At==="OKP")kt={crv:e.crv,kty:e.kty,x:e.x};else if(At==="RSA")kt={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${At}`);removeUndefinedProperties(kt);const Bt=canonicalize$1(kt),Nt=Convert.string(Bt).toUint8Array(),jt=yield Sha256$1.digest({data:Nt});return Convert.uint8Array(jt).toBase64Url()})}function isEcPrivateJwk$1(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"crv"in xt&&"x"in xt&&"d"in xt)||xt.kty!=="EC"||typeof xt.d!="string"||typeof xt.x!="string")}function isEcPublicJwk$1(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"crv"in xt&&"x"in xt)||"d"in xt||xt.kty!=="EC"||typeof xt.x!="string")}function isOctPrivateJwk(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"k"in xt)||xt.kty!=="oct"||typeof xt.k!="string")}function isOkpPrivateJwk$1(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"crv"in xt&&"x"in xt&&"d"in xt)||xt.kty!=="OKP"||typeof xt.d!="string"||typeof xt.x!="string")}function isOkpPublicJwk$1(xt){return!(!xt||typeof xt!="object"||"d"in xt||!("kty"in xt&&"crv"in xt&&"x"in xt)||xt.kty!=="OKP"||typeof xt.x!="string")}function isPrivateJwk$1(xt){if(!xt||typeof xt!="object")return!1;switch(xt.kty){case"EC":case"OKP":case"RSA":return"d"in xt;case"oct":return"k"in xt;default:return!1}}var __awaiter$1T=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$w=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let Secp256k1$1=class Go{static adjustSignatureToLowS(e){return __awaiter$1T(this,arguments,void 0,function*({signature:At}){const kt=secp256k1.Signature.fromCompact(At);return kt.hasHighS()?kt.normalizeS().toCompactRawBytes():At})}static bytesToPrivateKey(e){return __awaiter$1T(this,arguments,void 0,function*({privateKeyBytes:At}){const kt=yield Go.getCurvePoint({keyBytes:At}),Bt={kty:"EC",crv:"secp256k1",d:Convert.uint8Array(At).toBase64Url(),x:Convert.uint8Array(kt.x).toBase64Url(),y:Convert.uint8Array(kt.y).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}),Bt})}static bytesToPublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({publicKeyBytes:At}){const kt=yield Go.getCurvePoint({keyBytes:At}),Bt={kty:"EC",crv:"secp256k1",x:Convert.uint8Array(kt.x).toBase64Url(),y:Convert.uint8Array(kt.y).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}),Bt})}static compressPublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({publicKeyBytes:At}){return secp256k1.ProjectivePoint.fromHex(At).toRawBytes(!0)})}static computePublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({key:At}){const kt=yield Go.privateKeyToBytes({privateKey:At}),Bt=yield Go.getCurvePoint({keyBytes:kt}),Nt={kty:"EC",crv:"secp256k1",x:Convert.uint8Array(Bt.x).toBase64Url(),y:Convert.uint8Array(Bt.y).toBase64Url()};return Nt.kid=yield computeJwkThumbprint$1({jwk:Nt}),Nt})}static convertDerToCompactSignature(e){return __awaiter$1T(this,arguments,void 0,function*({derSignature:At}){return secp256k1.Signature.fromDER(At).toCompactRawBytes()})}static decompressPublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({publicKeyBytes:At}){return secp256k1.ProjectivePoint.fromHex(At).toRawBytes(!1)})}static generateKey(){return __awaiter$1T(this,void 0,void 0,function*(){const e=secp256k1.utils.randomPrivateKey(),At=yield Go.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint$1({jwk:At}),At})}static getPublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({key:At}){var kt;if(!(isEcPrivateJwk$1(At)&&At.crv==="secp256k1"))throw new Error("Secp256k1: The provided key is not a secp256k1 private JWK.");let Bt=__rest$w(At,["d"]);return(kt=Bt.kid)!==null&&kt!==void 0||(Bt.kid=yield computeJwkThumbprint$1({jwk:Bt})),Bt})}static privateKeyToBytes(e){return __awaiter$1T(this,arguments,void 0,function*({privateKey:At}){if(!isEcPrivateJwk$1(At))throw new Error("Secp256k1: The provided key is not a valid EC private key.");return Convert.base64Url(At.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1T(this,arguments,void 0,function*({publicKey:At}){if(!(isEcPublicJwk$1(At)&&At.y))throw new Error("Secp256k1: The provided key is not a valid EC public key.");const kt=new Uint8Array([4]),Bt=Convert.base64Url(At.x).toUint8Array(),Nt=Convert.base64Url(At.y).toUint8Array();return new Uint8Array([...kt,...Bt,...Nt])})}static sharedSecret(e){return __awaiter$1T(this,arguments,void 0,function*({privateKeyA:At,publicKeyB:kt}){if("x"in At&&"x"in kt&&At.x===kt.x)throw new Error("Secp256k1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const Bt=yield Go.privateKeyToBytes({privateKey:At}),Nt=yield Go.publicKeyToBytes({publicKey:kt});return secp256k1.getSharedSecret(Bt,Nt,!0).slice(1)})}static sign(e){return __awaiter$1T(this,arguments,void 0,function*({data:At,key:kt}){const Bt=yield Go.privateKeyToBytes({privateKey:kt}),Nt=sha256$5(At);return secp256k1.sign(Nt,Bt).toCompactRawBytes()})}static validatePrivateKey(e){return __awaiter$1T(this,arguments,void 0,function*({privateKeyBytes:At}){return secp256k1.utils.isValidPrivateKey(At)})}static validatePublicKey(e){return __awaiter$1T(this,arguments,void 0,function*({publicKeyBytes:At}){try{secp256k1.ProjectivePoint.fromHex(At).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$1T(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){const Nt=yield Go.publicKeyToBytes({publicKey:At}),jt=sha256$5(Bt);return secp256k1.verify(kt,jt,Nt,{lowS:!1})})}static getCurvePoint(e){return __awaiter$1T(this,arguments,void 0,function*({keyBytes:At}){At.byteLength===32&&(At=secp256k1.getPublicKey(At));const kt=secp256k1.ProjectivePoint.fromHex(At),Bt=numberToBytesBE(kt.x,32),Nt=numberToBytesBE(kt.y,32);return{x:Bt,y:Nt}})}};var __awaiter$1S=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$v=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let Secp256r1$1=class zo{static adjustSignatureToLowS(e){return __awaiter$1S(this,arguments,void 0,function*({signature:At}){const kt=secp256r1.Signature.fromCompact(At);return kt.hasHighS()?kt.normalizeS().toCompactRawBytes():At})}static bytesToPrivateKey(e){return __awaiter$1S(this,arguments,void 0,function*({privateKeyBytes:At}){const kt=yield zo.getCurvePoint({keyBytes:At}),Bt={kty:"EC",crv:"P-256",d:Convert.uint8Array(At).toBase64Url(),x:Convert.uint8Array(kt.x).toBase64Url(),y:Convert.uint8Array(kt.y).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}),Bt})}static bytesToPublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({publicKeyBytes:At}){const kt=yield zo.getCurvePoint({keyBytes:At}),Bt={kty:"EC",crv:"P-256",x:Convert.uint8Array(kt.x).toBase64Url(),y:Convert.uint8Array(kt.y).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}),Bt})}static compressPublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({publicKeyBytes:At}){return secp256r1.ProjectivePoint.fromHex(At).toRawBytes(!0)})}static computePublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({key:At}){const kt=yield zo.privateKeyToBytes({privateKey:At}),Bt=yield zo.getCurvePoint({keyBytes:kt}),Nt={kty:"EC",crv:"P-256",x:Convert.uint8Array(Bt.x).toBase64Url(),y:Convert.uint8Array(Bt.y).toBase64Url()};return Nt.kid=yield computeJwkThumbprint$1({jwk:Nt}),Nt})}static convertDerToCompactSignature(e){return __awaiter$1S(this,arguments,void 0,function*({derSignature:At}){return secp256r1.Signature.fromDER(At).toCompactRawBytes()})}static decompressPublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({publicKeyBytes:At}){return secp256r1.ProjectivePoint.fromHex(At).toRawBytes(!1)})}static generateKey(){return __awaiter$1S(this,void 0,void 0,function*(){const e=secp256r1.utils.randomPrivateKey(),At=yield zo.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint$1({jwk:At}),At})}static getPublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({key:At}){var kt;if(!(isEcPrivateJwk$1(At)&&At.crv==="P-256"))throw new Error("Secp256r1: The provided key is not a 'P-256' private JWK.");let Bt=__rest$v(At,["d"]);return(kt=Bt.kid)!==null&&kt!==void 0||(Bt.kid=yield computeJwkThumbprint$1({jwk:Bt})),Bt})}static privateKeyToBytes(e){return __awaiter$1S(this,arguments,void 0,function*({privateKey:At}){if(!isEcPrivateJwk$1(At))throw new Error("Secp256r1: The provided key is not a valid EC private key.");return Convert.base64Url(At.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1S(this,arguments,void 0,function*({publicKey:At}){if(!(isEcPublicJwk$1(At)&&At.y))throw new Error("Secp256r1: The provided key is not a valid EC public key.");const kt=new Uint8Array([4]),Bt=Convert.base64Url(At.x).toUint8Array(),Nt=Convert.base64Url(At.y).toUint8Array();return new Uint8Array([...kt,...Bt,...Nt])})}static sharedSecret(e){return __awaiter$1S(this,arguments,void 0,function*({privateKeyA:At,publicKeyB:kt}){if("x"in At&&"x"in kt&&At.x===kt.x)throw new Error("Secp256r1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const Bt=yield zo.privateKeyToBytes({privateKey:At}),Nt=yield zo.publicKeyToBytes({publicKey:kt});return secp256r1.getSharedSecret(Bt,Nt,!0).slice(1)})}static sign(e){return __awaiter$1S(this,arguments,void 0,function*({data:At,key:kt}){const Bt=yield zo.privateKeyToBytes({privateKey:kt}),Nt=sha256$5(At);return secp256r1.sign(Nt,Bt).toCompactRawBytes()})}static validatePrivateKey(e){return __awaiter$1S(this,arguments,void 0,function*({privateKeyBytes:At}){return secp256r1.utils.isValidPrivateKey(At)})}static validatePublicKey(e){return __awaiter$1S(this,arguments,void 0,function*({publicKeyBytes:At}){try{secp256r1.ProjectivePoint.fromHex(At).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$1S(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){const Nt=yield zo.publicKeyToBytes({publicKey:At}),jt=sha256$5(Bt);return secp256r1.verify(kt,jt,Nt,{lowS:!1})})}static getCurvePoint(e){return __awaiter$1S(this,arguments,void 0,function*({keyBytes:At}){At.byteLength===32&&(At=secp256r1.getPublicKey(At));const kt=secp256r1.ProjectivePoint.fromHex(At),Bt=numberToBytesBE(kt.x,32),Nt=numberToBytesBE(kt.y,32);return{x:Bt,y:Nt}})}};var __awaiter$1R=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let EcdsaAlgorithm$3=class extends CryptoAlgorithm$1{computePublicKey(e){return __awaiter$1R(this,arguments,void 0,function*({key:At}){if(!isEcPrivateJwk$1(At))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(At.crv){case"secp256k1":{const kt=yield Secp256k1$1.computePublicKey({key:At});return kt.alg="ES256K",kt}case"P-256":{const kt=yield Secp256r1$1.computePublicKey({key:At});return kt.alg="ES256",kt}default:throw new Error(`Unsupported curve: ${At.crv}`)}})}generateKey(e){return __awaiter$1R(this,arguments,void 0,function*({algorithm:At}){switch(At){case"ES256K":case"secp256k1":{const kt=yield Secp256k1$1.generateKey();return kt.alg="ES256K",kt}case"ES256":case"secp256r1":{const kt=yield Secp256r1$1.generateKey();return kt.alg="ES256",kt}}})}getPublicKey(e){return __awaiter$1R(this,arguments,void 0,function*({key:At}){if(!isEcPrivateJwk$1(At))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(At.crv){case"secp256k1":{const kt=yield Secp256k1$1.getPublicKey({key:At});return kt.alg="ES256K",kt}case"P-256":{const kt=yield Secp256r1$1.getPublicKey({key:At});return kt.alg="ES256",kt}default:throw new Error(`Unsupported curve: ${At.crv}`)}})}sign(e){return __awaiter$1R(this,arguments,void 0,function*({key:At,data:kt}){if(!isEcPrivateJwk$1(At))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(At.crv){case"secp256k1":return yield Secp256k1$1.sign({key:At,data:kt});case"P-256":return yield Secp256r1$1.sign({key:At,data:kt});default:throw new Error(`Unsupported curve: ${At.crv}`)}})}verify(e){return __awaiter$1R(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){if(!isEcPublicJwk$1(At))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(At.crv){case"secp256k1":return yield Secp256k1$1.verify({key:At,signature:kt,data:Bt});case"P-256":return yield Secp256r1$1.verify({key:At,signature:kt,data:Bt});default:throw new Error(`Unsupported curve: ${At.crv}`)}})}};var __awaiter$1Q=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$u=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let Ed25519$1=class os{static bytesToPrivateKey(e){return __awaiter$1Q(this,arguments,void 0,function*({privateKeyBytes:At}){const kt=ed25519.getPublicKey(At),Bt={crv:"Ed25519",d:Convert.uint8Array(At).toBase64Url(),kty:"OKP",x:Convert.uint8Array(kt).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}),Bt})}static bytesToPublicKey(e){return __awaiter$1Q(this,arguments,void 0,function*({publicKeyBytes:At}){const kt={kty:"OKP",crv:"Ed25519",x:Convert.uint8Array(At).toBase64Url()};return kt.kid=yield computeJwkThumbprint$1({jwk:kt}),kt})}static computePublicKey(e){return __awaiter$1Q(this,arguments,void 0,function*({key:At}){const kt=yield os.privateKeyToBytes({privateKey:At}),Bt=ed25519.getPublicKey(kt),Nt={kty:"OKP",crv:"Ed25519",x:Convert.uint8Array(Bt).toBase64Url()};return Nt.kid=yield computeJwkThumbprint$1({jwk:Nt}),Nt})}static convertPrivateKeyToX25519(e){return __awaiter$1Q(this,arguments,void 0,function*({privateKey:At}){const kt=yield os.privateKeyToBytes({privateKey:At}),Bt=edwardsToMontgomeryPriv(kt),Nt=x25519.getPublicKey(Bt),jt={kty:"OKP",crv:"X25519",d:Convert.uint8Array(Bt).toBase64Url(),x:Convert.uint8Array(Nt).toBase64Url()};return jt.kid=yield computeJwkThumbprint$1({jwk:jt}),jt})}static convertPublicKeyToX25519(e){return __awaiter$1Q(this,arguments,void 0,function*({publicKey:At}){const kt=yield os.publicKeyToBytes({publicKey:At});if(!(yield os.validatePublicKey({publicKeyBytes:kt})))throw new Error("Ed25519: Invalid public key.");const Nt=edwardsToMontgomeryPub(kt),jt={kty:"OKP",crv:"X25519",x:Convert.uint8Array(Nt).toBase64Url()};return jt.kid=yield computeJwkThumbprint$1({jwk:jt}),jt})}static generateKey(){return __awaiter$1Q(this,void 0,void 0,function*(){const e=ed25519.utils.randomPrivateKey(),At=yield os.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint$1({jwk:At}),At})}static getPublicKey(e){return __awaiter$1Q(this,arguments,void 0,function*({key:At}){var kt;if(!(isOkpPrivateJwk$1(At)&&At.crv==="Ed25519"))throw new Error("Ed25519: The provided key is not an Ed25519 private JWK.");let Bt=__rest$u(At,["d"]);return(kt=Bt.kid)!==null&&kt!==void 0||(Bt.kid=yield computeJwkThumbprint$1({jwk:Bt})),Bt})}static privateKeyToBytes(e){return __awaiter$1Q(this,arguments,void 0,function*({privateKey:At}){if(!isOkpPrivateJwk$1(At))throw new Error("Ed25519: The provided key is not a valid OKP private key.");return Convert.base64Url(At.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1Q(this,arguments,void 0,function*({publicKey:At}){if(!isOkpPublicJwk$1(At))throw new Error("Ed25519: The provided key is not a valid OKP public key.");return Convert.base64Url(At.x).toUint8Array()})}static sign(e){return __awaiter$1Q(this,arguments,void 0,function*({key:At,data:kt}){const Bt=yield os.privateKeyToBytes({privateKey:At});return ed25519.sign(kt,Bt)})}static validatePublicKey(e){return __awaiter$1Q(this,arguments,void 0,function*({publicKeyBytes:At}){try{ed25519.ExtendedPoint.fromHex(At).assertValidity()}catch{return!1}return!0})}static verify(e){return __awaiter$1Q(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){const Nt=yield os.publicKeyToBytes({publicKey:At});return ed25519.verify(kt,Bt,Nt)})}};var __awaiter$1P=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let EdDsaAlgorithm$3=class extends CryptoAlgorithm$1{computePublicKey(e){return __awaiter$1P(this,arguments,void 0,function*({key:At}){if(!isOkpPrivateJwk$1(At))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(At.crv){case"Ed25519":{const kt=yield Ed25519$1.computePublicKey({key:At});return kt.alg="EdDSA",kt}default:throw new Error(`Unsupported curve: ${At.crv}`)}})}generateKey(e){return __awaiter$1P(this,arguments,void 0,function*({algorithm:At}){switch(At){case"Ed25519":{const kt=yield Ed25519$1.generateKey();return kt.alg="EdDSA",kt}}})}getPublicKey(e){return __awaiter$1P(this,arguments,void 0,function*({key:At}){if(!isOkpPrivateJwk$1(At))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(At.crv){case"Ed25519":{const kt=yield Ed25519$1.getPublicKey({key:At});return kt.alg="EdDSA",kt}default:throw new Error(`Unsupported curve: ${At.crv}`)}})}sign(e){return __awaiter$1P(this,arguments,void 0,function*({key:At,data:kt}){if(!isOkpPrivateJwk$1(At))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(At.crv){case"Ed25519":return yield Ed25519$1.sign({key:At,data:kt});default:throw new Error(`Unsupported curve: ${At.crv}`)}})}verify(e){return __awaiter$1P(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){if(!isOkpPublicJwk$1(At))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(At.crv){case"Ed25519":return yield Ed25519$1.verify({key:At,signature:kt,data:Bt});default:throw new Error(`Unsupported curve: ${At.crv}`)}})}};var __awaiter$1O=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const supportedAlgorithms$5={Ed25519:{implementation:EdDsaAlgorithm$3,names:["Ed25519"]},secp256k1:{implementation:EcdsaAlgorithm$3,names:["ES256K","secp256k1"]},secp256r1:{implementation:EcdsaAlgorithm$3,names:["ES256","secp256r1"]},"SHA-256":{implementation:Sha2Algorithm$1,names:["SHA-256"]}};let LocalKeyManager$3=class{constructor(e){var At;this._algorithmInstances=new Map,this._keyStore=(At=e==null?void 0:e.keyStore)!==null&&At!==void 0?At:new MemoryStore}digest(e){return __awaiter$1O(this,arguments,void 0,function*({algorithm:At,data:kt}){return yield this.getAlgorithm({algorithm:At}).digest({algorithm:At,data:kt})})}exportKey(e){return __awaiter$1O(this,arguments,void 0,function*({keyUri:At}){return yield this.getPrivateKey({keyUri:At})})}generateKey(e){return __awaiter$1O(this,arguments,void 0,function*({algorithm:At}){const Bt=yield this.getAlgorithm({algorithm:At}).generateKey({algorithm:At});if((Bt==null?void 0:Bt.kid)===void 0)throw new Error("Generated key is missing a required property: kid");const Nt=`${KEY_URI_PREFIX_JWK$1}${Bt.kid}`;return yield this._keyStore.set(Nt,Bt),Nt})}getKeyUri(e){return __awaiter$1O(this,arguments,void 0,function*({key:At}){const kt=yield computeJwkThumbprint$1({jwk:At});return`${KEY_URI_PREFIX_JWK$1}${kt}`})}getPublicKey(e){return __awaiter$1O(this,arguments,void 0,function*({keyUri:At}){const kt=yield this.getPrivateKey({keyUri:At}),Bt=this.getAlgorithmName({key:kt});return yield this.getAlgorithm({algorithm:Bt}).getPublicKey({key:kt})})}importKey(e){return __awaiter$1O(this,arguments,void 0,function*({key:At}){var kt;if(!isPrivateJwk$1(At))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const Bt=structuredClone(At);(kt=Bt.kid)!==null&&kt!==void 0||(Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}));const Nt=yield this.getKeyUri({key:Bt});return yield this._keyStore.set(Nt,Bt),Nt})}sign(e){return __awaiter$1O(this,arguments,void 0,function*({keyUri:At,data:kt}){const Bt=yield this.getPrivateKey({keyUri:At}),Nt=this.getAlgorithmName({key:Bt});return this.getAlgorithm({algorithm:Nt}).sign({data:kt,key:Bt})})}verify(e){return __awaiter$1O(this,arguments,void 0,function*({key:At,signature:kt,data:Bt}){const Nt=this.getAlgorithmName({key:At});return this.getAlgorithm({algorithm:Nt}).verify({key:At,signature:kt,data:Bt})})}getAlgorithm({algorithm:e}){var At;const kt=(At=supportedAlgorithms$5[e])===null||At===void 0?void 0:At.implementation;if(!kt)throw new Error(`Algorithm not supported: ${e}`);return this._algorithmInstances.has(kt)||this._algorithmInstances.set(kt,new kt),this._algorithmInstances.get(kt)}getAlgorithmName({key:e}){const At=e.alg,kt=e.crv;for(const Bt in supportedAlgorithms$5){const Nt=supportedAlgorithms$5[Bt];if(At&&Nt.names.includes(At))return Bt;if(kt&&Nt.names.includes(kt))return Bt}throw new Error(`Unable to determine algorithm based on provided input: alg=${At}, crv=${kt}`)}getPrivateKey(e){return __awaiter$1O(this,arguments,void 0,function*({keyUri:At}){const kt=yield this._keyStore.get(At);if(!kt)throw new Error(`Key not found: ${At}`);return kt})}};function getJoseSignatureAlgorithmFromPublicKey$1(xt){const e={Ed25519:"EdDSA","P-256":"ES256","P-384":"ES384","P-521":"ES512",secp256k1:"ES256K"};if(xt.alg&&Object.values(e).includes(xt.alg))return xt.alg;if(xt.crv&&Object.keys(e).includes(xt.crv))return e[xt.crv];throw new Error(`Unable to determine algorithm based on provided input: alg=${xt.alg}, crv=${xt.crv}. Supported 'alg' values: ${Object.values(e).join(", ")}. Supported 'crv' values: ${Object.keys(e).join(", ")}.`)}function randomBytes(xt){return randomBytes$7(xt)}function randomUuid(){return crypto$7.randomUUID()}function randomPin({length:xt}){if(3>xt||xt>10)throw new Error("randomPin() can securely generate a PIN between 3 to 10 digits.");const e=Math.pow(10,xt)-1;let At;if(xt<=6){const kt=Math.pow(10,xt);do{const Bt=randomBytes(Math.ceil(xt/2));At=new DataView(Bt.buffer).getUint16(0,!1)%kt}while(At>e)}else{const kt=Math.pow(10,10);do{const Bt=randomBytes(4);At=new DataView(Bt.buffer).getUint32(0,!1)%kt}while(At>e)}return At.toString().padStart(xt,"0")}const CryptoUtils={randomPin,randomUuid,randomBytes,getJoseSignatureAlgorithmFromPublicKey:getJoseSignatureAlgorithmFromPublicKey$1};var __awaiter$1N=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$t=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const AES_GCM_IV_LENGTH=96,AES_KEY_LENGTHS$2=[128,192,256],AES_GCM_TAG_LENGTHS=[96,104,112,120,128];class AesGcm{static bytesToPrivateKey(e){return __awaiter$1N(this,arguments,void 0,function*({privateKeyBytes:At}){const kt={k:Convert.uint8Array(At).toBase64Url(),kty:"oct"};return kt.kid=yield computeJwkThumbprint$1({jwk:kt}),kt})}static decrypt(e){return __awaiter$1N(this,arguments,void 0,function*({key:At,data:kt,iv:Bt,additionalData:Nt,tagLength:jt}){if(Bt.byteLength!==AES_GCM_IV_LENGTH/8)throw new TypeError(`The initialization vector must be ${AES_GCM_IV_LENGTH} bits in length`);if(jt&&!AES_GCM_TAG_LENGTHS.includes(jt))throw new RangeError(`The tag length is invalid: Must be ${AES_GCM_TAG_LENGTHS.join(", ")} bits`);const Lt=getWebcryptoSubtle(),er=yield Lt.importKey("jwk",At,{name:"AES-GCM"},!0,["decrypt"]),tr=Object.assign(Object.assign({name:"AES-GCM",iv:Bt},jt&&{tagLength:jt}),Nt&&{additionalData:Nt}),zt=yield Lt.decrypt(tr,er,kt);return new Uint8Array(zt)})}static encrypt(e){return __awaiter$1N(this,arguments,void 0,function*({data:At,iv:kt,key:Bt,additionalData:Nt,tagLength:jt}){if(kt.byteLength!==AES_GCM_IV_LENGTH/8)throw new TypeError(`The initialization vector must be ${AES_GCM_IV_LENGTH} bits in length`);if(jt&&!AES_GCM_TAG_LENGTHS.includes(jt))throw new RangeError(`The tag length is invalid: Must be ${AES_GCM_TAG_LENGTHS.join(", ")} bits`);const Lt=getWebcryptoSubtle(),er=yield Lt.importKey("jwk",Bt,{name:"AES-GCM"},!0,["encrypt"]),tr=Object.assign(Object.assign({name:"AES-GCM",iv:kt},jt&&{tagLength:jt}),Nt&&{additionalData:Nt}),zt=yield Lt.encrypt(tr,er,At);return new Uint8Array(zt)})}static generateKey(e){return __awaiter$1N(this,arguments,void 0,function*({length:At}){if(!AES_KEY_LENGTHS$2.includes(At))throw new RangeError(`The key length is invalid: Must be ${AES_KEY_LENGTHS$2.join(", ")} bits`);const kt=getWebcryptoSubtle(),Bt=yield kt.generateKey({name:"AES-GCM",length:At},!0,["encrypt"]),Nt=yield kt.exportKey("jwk",Bt),jt=__rest$t(Nt,["ext","key_ops"]);return jt.kid=yield computeJwkThumbprint$1({jwk:jt}),jt})}static privateKeyToBytes(e){return __awaiter$1N(this,arguments,void 0,function*({privateKey:At}){if(!isOctPrivateJwk(At))throw new Error("AesGcm: The provided key is not a valid oct private key.");return Convert.base64Url(At.k).toUint8Array()})}}var __awaiter$1M=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let AesGcmAlgorithm$2=class extends CryptoAlgorithm$1{decrypt(e){return __awaiter$1M(this,void 0,void 0,function*(){return AesGcm.decrypt(e)})}encrypt(e){return __awaiter$1M(this,void 0,void 0,function*(){return AesGcm.encrypt(e)})}generateKey(e){return __awaiter$1M(this,arguments,void 0,function*({algorithm:At}){const kt={A128GCM:128,A192GCM:192,A256GCM:256}[At],Bt=yield AesGcm.generateKey({length:kt});return Bt.alg=At,Bt})}};var __awaiter$1L=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$s=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let X25519$1=class Os{static bytesToPrivateKey(e){return __awaiter$1L(this,arguments,void 0,function*({privateKeyBytes:At}){const kt=x25519.getPublicKey(At),Bt={kty:"OKP",crv:"X25519",d:Convert.uint8Array(At).toBase64Url(),x:Convert.uint8Array(kt).toBase64Url()};return Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}),Bt})}static bytesToPublicKey(e){return __awaiter$1L(this,arguments,void 0,function*({publicKeyBytes:At}){const kt={kty:"OKP",crv:"X25519",x:Convert.uint8Array(At).toBase64Url()};return kt.kid=yield computeJwkThumbprint$1({jwk:kt}),kt})}static computePublicKey(e){return __awaiter$1L(this,arguments,void 0,function*({key:At}){const kt=yield Os.privateKeyToBytes({privateKey:At}),Bt=x25519.getPublicKey(kt),Nt={kty:"OKP",crv:"X25519",x:Convert.uint8Array(Bt).toBase64Url()};return Nt.kid=yield computeJwkThumbprint$1({jwk:Nt}),Nt})}static generateKey(){return __awaiter$1L(this,void 0,void 0,function*(){const e=x25519.utils.randomPrivateKey(),At=yield Os.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint$1({jwk:At}),At})}static getPublicKey(e){return __awaiter$1L(this,arguments,void 0,function*({key:At}){var kt;if(!(isOkpPrivateJwk$1(At)&&At.crv==="X25519"))throw new Error("X25519: The provided key is not an X25519 private JWK.");let Bt=__rest$s(At,["d"]);return(kt=Bt.kid)!==null&&kt!==void 0||(Bt.kid=yield computeJwkThumbprint$1({jwk:Bt})),Bt})}static privateKeyToBytes(e){return __awaiter$1L(this,arguments,void 0,function*({privateKey:At}){if(!isOkpPrivateJwk$1(At))throw new Error("X25519: The provided key is not a valid OKP private key.");return Convert.base64Url(At.d).toUint8Array()})}static publicKeyToBytes(e){return __awaiter$1L(this,arguments,void 0,function*({publicKey:At}){if(!isOkpPublicJwk$1(At))throw new Error("X25519: The provided key is not a valid OKP public key.");return Convert.base64Url(At.x).toUint8Array()})}static sharedSecret(e){return __awaiter$1L(this,arguments,void 0,function*({privateKeyA:At,publicKeyB:kt}){if("x"in At&&"x"in kt&&At.x===kt.x)throw new Error("X25519: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const Bt=yield Os.privateKeyToBytes({privateKey:At}),Nt=yield Os.publicKeyToBytes({publicKey:kt});return x25519.getSharedSecret(Bt,Nt)})}};function extractDidFragment$1(xt){if(typeof xt=="string"&&xt.length!==0)return xt.split("#").pop()}function getVerificationMethods$1({didDocument:xt}){var e,At;if(!xt)throw new TypeError("Required parameter missing: 'didDocument'");const kt=[];return kt.push(...(At=(e=xt.verificationMethod)===null||e===void 0?void 0:e.filter(isDidVerificationMethod$1))!==null&&At!==void 0?At:[]),Object.keys(DidVerificationRelationship$1).forEach(Bt=>{var Nt,jt;kt.push(...(jt=(Nt=xt[Bt])===null||Nt===void 0?void 0:Nt.filter(isDidVerificationMethod$1))!==null&&jt!==void 0?jt:[])}),kt}function getVerificationMethodTypes$1({didDocument:xt}){const At=getVerificationMethods$1({didDocument:xt}).map(kt=>kt.type);return[...new Set(At)]}function getVerificationRelationshipsById$1({didDocument:xt,methodId:e}){const At=[];return Object.keys(DidVerificationRelationship$1).forEach(kt=>{if(Array.isArray(xt[kt])){const Bt=xt[kt],Nt=extractDidFragment$1(e);Bt.some(Lt=>{const er=extractDidFragment$1(Lt)===Nt,tr=isDidVerificationMethod$1(Lt)&&extractDidFragment$1(Lt.id)===Nt;return er||tr})&&At.push(kt)}}),At}function isDidService(xt){return!xt||typeof xt!="object"||xt===null?!1:"id"in xt&&"type"in xt&&"serviceEndpoint"in xt}function isDwnDidService(xt){if(!isDidService(xt)||xt.type!=="DecentralizedWebNode"||!("enc"in xt&&"sig"in xt))return!1;const e=At=>typeof At=="string"||Array.isArray(At)&&At.every(kt=>typeof kt=="string");return e(xt.enc)&&e(xt.sig)}function isDidVerificationMethod$1(xt){return!(!xt||typeof xt!="object"||xt===null||!("id"in xt&&"type"in xt&&"controller"in xt)||typeof xt.id!="string"||typeof xt.type!="string"||typeof xt.controller!="string")}function keyBytesToMultibaseId$1({keyBytes:xt,multicodecCode:e,multicodecName:At}){const kt=Multicodec.addPrefix({code:e,data:xt,name:At}),Bt=Convert.uint8Array(kt).toBase58Btc();return Convert.base58Btc(Bt).toMultibase()}function multibaseIdToKeyBytes$1({multibaseKeyId:xt}){try{const e=Convert.multibase(xt).toBase58Btc(),At=Convert.base58Btc(e).toUint8Array(),{code:kt,data:Bt,name:Nt}=Multicodec.removePrefix({prefixedData:At});return{keyBytes:Bt,multicodecCode:kt,multicodecName:Nt}}catch{throw new DidError$1(DidErrorCode$1.InvalidDid,`Invalid multibase identifier: ${xt}`)}}var __awaiter$1K=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let BearerDid$1=class Al{constructor({uri:e,document:At,metadata:kt,keyManager:Bt}){this.uri=e,this.document=At,this.metadata=kt,this.keyManager=Bt}export(){return __awaiter$1K(this,void 0,void 0,function*(){if(!(Array.isArray(this.document.verificationMethod)&&this.document.verificationMethod.length>0))throw new Error(`DID document for '${this.uri}' is missing verification methods`);let e={uri:this.uri,document:this.document,metadata:this.metadata};if("exportKey"in this.keyManager&&typeof this.keyManager.exportKey=="function"){const At=[];for(let kt of this.document.verificationMethod){if(!kt.publicKeyJwk)throw new Error(`Verification method '${kt.id}' does not contain a public key in JWK format`);const Bt=yield this.keyManager.getKeyUri({key:kt.publicKeyJwk}),Nt=yield this.keyManager.exportKey({keyUri:Bt});At.push(Object.assign({},Nt))}e.privateKeys=At}return e})}getSigner(e){return __awaiter$1K(this,void 0,void 0,function*(){var At;const kt=(At=this.document.verificationMethod)===null||At===void 0?void 0:At.find(er=>{var tr,zt;return extractDidFragment$1(er.id)===((tr=extractDidFragment$1(e==null?void 0:e.methodId))!==null&&tr!==void 0?tr:extractDidFragment$1((zt=this.document.assertionMethod)===null||zt===void 0?void 0:zt[0]))});if(!(kt&&kt.publicKeyJwk))throw new DidError$1(DidErrorCode$1.InternalError,"A verification method intended for signing could not be determined from the DID Document");const Bt=yield this.keyManager.getKeyUri({key:kt.publicKeyJwk}),Nt=yield this.keyManager.getPublicKey({keyUri:Bt}),jt=this.keyManager;return{algorithm:CryptoUtils.getJoseSignatureAlgorithmFromPublicKey(Nt),keyId:kt.id,sign(er){return __awaiter$1K(this,arguments,void 0,function*({data:tr}){return yield jt.sign({data:tr,keyUri:Bt})})},verify(er){return __awaiter$1K(this,arguments,void 0,function*({data:tr,signature:zt}){return yield jt.verify({data:tr,key:Nt,signature:zt})})}}})}static import(e){return __awaiter$1K(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager$3}){var Bt;const Nt=getVerificationMethods$1({didDocument:At.document});if(Nt.length===0)throw new DidError$1(DidErrorCode$1.InvalidDidDocument,"At least one verification method is required but 0 were given");for(let Lt of(Bt=At.privateKeys)!==null&&Bt!==void 0?Bt:[])yield kt.importKey({key:Lt});for(let Lt of Nt){if(!Lt.publicKeyJwk)throw new Error(`Verification method '${Lt.id}' does not contain a public key in JWK format`);const er=yield kt.getKeyUri({key:Lt.publicKeyJwk});yield kt.getPublicKey({keyUri:er})}return new Al({uri:At.uri,document:At.document,metadata:At.metadata,keyManager:kt})})}};var __awaiter$1J=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DidMethod$1=class{static getSigningMethod(e){return __awaiter$1J(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement getSigningMethod()")})}static resolve(e,At){return __awaiter$1J(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement resolve()")})}};var __awaiter$1I=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$r=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const DEFAULT_GATEWAY_URI$3="https://diddht.tbddev.org",DID_DHT_SPECIFICATION_VERSION$1=0,DNS_RECORD_TTL$1=7200,PROPERTY_SEPARATOR$1=";",VALUE_SEPARATOR$1=",";var DidDhtRegisteredDidType$1;(function(xt){xt[xt.Discoverable=0]="Discoverable",xt[xt.Organization=1]="Organization",xt[xt.Government=2]="Government",xt[xt.Corporation=3]="Corporation",xt[xt.LocalBusiness=4]="LocalBusiness",xt[xt.SoftwarePackage=5]="SoftwarePackage",xt[xt.WebApp=6]="WebApp",xt[xt.FinancialInstitution=7]="FinancialInstitution"})(DidDhtRegisteredDidType$1||(DidDhtRegisteredDidType$1={}));var DidDhtRegisteredKeyType$1;(function(xt){xt[xt.Ed25519=0]="Ed25519",xt[xt.secp256k1=1]="secp256k1",xt[xt.secp256r1=2]="secp256r1",xt[xt.X25519=3]="X25519"})(DidDhtRegisteredKeyType$1||(DidDhtRegisteredKeyType$1={}));var DidDhtVerificationRelationship$1;(function(xt){xt.authentication="auth",xt.assertionMethod="asm",xt.capabilityDelegation="del",xt.capabilityInvocation="inv",xt.keyAgreement="agm"})(DidDhtVerificationRelationship$1||(DidDhtVerificationRelationship$1={}));const AlgorithmToKeyTypeMap$5={Ed25519:DidDhtRegisteredKeyType$1.Ed25519,ES256K:DidDhtRegisteredKeyType$1.secp256k1,ES256:DidDhtRegisteredKeyType$1.secp256r1,"P-256":DidDhtRegisteredKeyType$1.secp256r1,secp256k1:DidDhtRegisteredKeyType$1.secp256k1,secp256r1:DidDhtRegisteredKeyType$1.secp256r1,X25519:DidDhtRegisteredKeyType$1.X25519},KeyTypeToDefaultAlgorithmMap$1={[DidDhtRegisteredKeyType$1.Ed25519]:"EdDSA",[DidDhtRegisteredKeyType$1.secp256k1]:"ES256K",[DidDhtRegisteredKeyType$1.secp256r1]:"ES256",[DidDhtRegisteredKeyType$1.X25519]:"ECDH-ES+A256KW"};let DidDht$1=class na extends DidMethod$1{static create(){return __awaiter$1I(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$3,options:At={}}={}){var kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir;if(!((kt=At.verificationMethods)===null||kt===void 0)&&kt.some(br=>!(br.algorithm in AlgorithmToKeyTypeMap$5)))throw new Error("One or more verification method algorithms are not supported");const ar=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt.filter(br=>"id"in br).map(br=>br.id);if(ar&&ar.length!==new Set(ar).size)throw new Error("One or more verification method IDs are not unique");if(!((Nt=At.services)===null||Nt===void 0)&&Nt.some(br=>!br.id||!br.type||!br.serviceEndpoint))throw new Error("One or more services are missing required properties");const dr=yield e.generateKey({algorithm:"Ed25519"}),ur=yield e.getPublicKey({keyUri:dr}),fr=yield DidDhtUtils$1.identityKeyToIdentifier({identityKey:ur}),pr=Object.assign(Object.assign({id:fr},At.alsoKnownAs&&{alsoKnownAs:At.alsoKnownAs}),At.controllers&&{controller:At.controllers}),lr=[...(jt=At.verificationMethods)!==null&&jt!==void 0?jt:[]];lr!=null&&lr.some(br=>{var Ar;return((Ar=br.id)===null||Ar===void 0?void 0:Ar.split("#").pop())==="0"})||lr.unshift({algorithm:"Ed25519",id:"0",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]});for(const br of lr){const Ar=br.id&&br.id.split("#").pop()==="0"?dr:yield e.generateKey({algorithm:br.algorithm}),Pr=yield e.getPublicKey({keyUri:Ar});let kr=(er=(Lt=br.id)!==null&&Lt!==void 0?Lt:Pr.kid)!==null&&er!==void 0?er:yield computeJwkThumbprint$1({jwk:Pr});kr=`${fr}#${extractDidFragment$1(kr)}`,(tr=pr.verificationMethod)!==null&&tr!==void 0||(pr.verificationMethod=[]),pr.verificationMethod.push({id:kr,type:"JsonWebKey",controller:(zt=br.controller)!==null&&zt!==void 0?zt:fr,publicKeyJwk:Pr});for(const Ur of(rr=br.purposes)!==null&&rr!==void 0?rr:[])pr[Ur]||(pr[Ur]=[]),pr[Ur].push(kr)}(nr=At.services)===null||nr===void 0||nr.forEach(br=>{var Ar;(Ar=pr.service)!==null&&Ar!==void 0||(pr.service=[]),br.id=`${fr}#${br.id.split("#").pop()}`,pr.service.push(br)});const yr=new BearerDid$1({uri:fr,document:pr,metadata:Object.assign({published:!1},At.types&&{types:At.types}),keyManager:e});if(!((ir=At.publish)!==null&&ir!==void 0)||ir){const br=yield na.publish({did:yr,gatewayUri:At.gatewayUri});yr.metadata=br.didDocumentMetadata}return yr})}static import(e){return __awaiter$1I(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager$3}){var Bt;const Nt=Did$1.parse(At.uri);if((Nt==null?void 0:Nt.method)!==na.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,"Method not supported");const jt=yield BearerDid$1.import({portableDid:At,keyManager:kt});if(!(!((Bt=jt.document.verificationMethod)===null||Bt===void 0)&&Bt.some(Lt=>{var er;return((er=Lt.id)===null||er===void 0?void 0:er.split("#").pop())==="0"})))throw new DidError$1(DidErrorCode$1.InvalidDidDocument,"DID document must contain an Identity Key");return jt})}static getSigningMethod(e){return __awaiter$1I(this,arguments,void 0,function*({didDocument:At,methodId:kt="#0"}){var Bt;const Nt=Did$1.parse(At.id);if(Nt&&Nt.method!==this.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${Nt.method}`);const jt=(Bt=At.verificationMethod)===null||Bt===void 0?void 0:Bt.find(Lt=>{var er,tr;return extractDidFragment$1(Lt.id)===((er=extractDidFragment$1(kt))!==null&&er!==void 0?er:extractDidFragment$1((tr=At.assertionMethod)===null||tr===void 0?void 0:tr[0]))});if(!(jt&&jt.publicKeyJwk))throw new DidError$1(DidErrorCode$1.InternalError,"A verification method intended for signing could not be determined from the DID Document");return jt})}static publish(e){return __awaiter$1I(this,arguments,void 0,function*({did:At,gatewayUri:kt=DEFAULT_GATEWAY_URI$3}){return yield DidDhtDocument$1.put({did:At,gatewayUri:kt})})}static resolve(e){return __awaiter$1I(this,arguments,void 0,function*(At,kt={}){var Bt;const Nt=(Bt=kt==null?void 0:kt.gatewayUri)!==null&&Bt!==void 0?Bt:DEFAULT_GATEWAY_URI$3;try{yield DidDhtUtils$1.identifierToIdentityKey({didUri:At});const{didDocument:jt,didDocumentMetadata:Lt}=yield DidDhtDocument$1.get({didUri:At,gatewayUri:Nt});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didDocument:jt,didDocumentMetadata:Lt})}catch(jt){if(!(jt instanceof DidError$1))throw new Error(jt);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:Object.assign({error:jt.code},jt.message&&{errorMessage:jt.message})})}})}};DidDht$1.methodName="dht";let DidDhtDocument$1=class ls{static get(e){return __awaiter$1I(this,arguments,void 0,function*({didUri:At,gatewayUri:kt}){const Bt=DidDhtUtils$1.identifierToIdentityKeyBytes({didUri:At}),Nt=yield ls.pkarrGet({gatewayUri:kt,publicKeyBytes:Bt}),jt=yield DidDhtUtils$1.parseBep44GetMessage({bep44Message:Nt}),Lt=yield ls.fromDnsPacket({didUri:At,dnsPacket:jt});return Lt.didDocumentMetadata.versionId=Nt.seq.toString(),Lt})}static put(e){return __awaiter$1I(this,arguments,void 0,function*({did:At,gatewayUri:kt}){const Bt=yield ls.toDnsPacket({didDocument:At.document,didMetadata:At.metadata,authoritativeGatewayUris:[kt]}),Nt=yield DidDhtUtils$1.createBep44PutMessage({dnsPacket:Bt,publicKeyBytes:DidDhtUtils$1.identifierToIdentityKeyBytes({didUri:At.uri}),signer:yield At.getSigner({methodId:"0"})}),jt=yield ls.pkarrPut({gatewayUri:kt,bep44Message:Nt});return{didDocument:At.document,didDocumentMetadata:Object.assign(Object.assign({},At.metadata),{published:jt,versionId:Nt.seq.toString()}),didRegistrationMetadata:{}}})}static pkarrGet(e){return __awaiter$1I(this,arguments,void 0,function*({gatewayUri:At,publicKeyBytes:kt}){const Bt=Convert.uint8Array(kt).toBase32Z(),Nt=new URL(Bt,At).href;let jt;try{if(jt=yield fetch(Nt,{method:"GET"}),!jt.ok)throw new DidError$1(DidErrorCode$1.NotFound,`Pkarr record not found for: ${Bt}`)}catch(tr){throw tr instanceof DidError$1?tr:new DidError$1(DidErrorCode$1.InternalError,`Failed to fetch Pkarr record: ${tr.message}`)}const Lt=yield jt.arrayBuffer();if(!Lt)throw new DidError$1(DidErrorCode$1.NotFound,`Pkarr record not found for: ${Bt}`);if(Lt.byteLength<72)throw new DidError$1(DidErrorCode$1.InvalidDidDocumentLength,`Pkarr response must be at least 72 bytes but got: ${Lt.byteLength}`);if(Lt.byteLength>1072)throw new DidError$1(DidErrorCode$1.InvalidDidDocumentLength,`Pkarr response exceeds 1000 byte limit: ${Lt.byteLength}`);return{k:kt,seq:Number(new DataView(Lt).getBigUint64(64)),sig:new Uint8Array(Lt,0,64),v:new Uint8Array(Lt,72)}})}static pkarrPut(e){return __awaiter$1I(this,arguments,void 0,function*({gatewayUri:At,bep44Message:kt}){const Bt=Convert.uint8Array(kt.k).toBase32Z(),Nt=new URL(Bt,At).href,jt=new Uint8Array(kt.v.length+72);jt.set(kt.sig,0),new DataView(jt.buffer).setBigUint64(kt.sig.length,BigInt(kt.seq)),jt.set(kt.v,kt.sig.length+8);let Lt;try{Lt=yield fetch(Nt,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:jt})}catch(er){throw new DidError$1(DidErrorCode$1.InternalError,`Failed to put Pkarr record for identifier ${Bt}: ${er.message}`)}return Lt.ok})}static fromDnsPacket(e){return __awaiter$1I(this,arguments,void 0,function*({didUri:At,dnsPacket:kt}){var Bt,Nt,jt;const Lt={id:At},er={published:!0},tr=new Map;for(const zt of(Bt=kt==null?void 0:kt.answers)!==null&&Bt!==void 0?Bt:[]){if(zt.type!=="TXT")continue;const rr=zt.name.split(".")[0].substring(1);switch(!0){case rr.startsWith("aka"):{const nr=DidDhtUtils$1.parseTxtDataToString(zt.data);Lt.alsoKnownAs=nr.split(VALUE_SEPARATOR$1);break}case rr.startsWith("cnt"):{const nr=DidDhtUtils$1.parseTxtDataToString(zt.data);Lt.controller=nr.includes(VALUE_SEPARATOR$1)?nr.split(VALUE_SEPARATOR$1):nr;break}case rr.startsWith("k"):{const{id:nr,t:ir,k:ar,c:dr,a:ur}=DidDhtUtils$1.parseTxtDataToObject(zt.data),fr=Convert.base64Url(ar).toUint8Array(),pr=DidDhtRegisteredKeyType$1[Number(ir)];let lr=yield DidDhtUtils$1.keyConverter(pr).bytesToPublicKey({publicKeyBytes:fr});lr.alg=ur||KeyTypeToDefaultAlgorithmMap$1[Number(ir)];const yr=rr==="k0"?"0":nr!==void 0?nr:yield computeJwkThumbprint$1({jwk:lr});(Nt=Lt.verificationMethod)!==null&&Nt!==void 0||(Lt.verificationMethod=[]);const br=`${At}#${yr}`;Lt.verificationMethod.push({id:br,type:"JsonWebKey",controller:dr??At,publicKeyJwk:lr}),tr.set(rr,br);break}case rr.startsWith("s"):{const nr=DidDhtUtils$1.parseTxtDataToObject(zt.data),{id:ir,t:ar,se:dr}=nr,ur=__rest$r(nr,["id","t","se"]),fr=dr.includes(VALUE_SEPARATOR$1)?dr.split(VALUE_SEPARATOR$1):[dr],pr=Object.fromEntries(Object.entries(ur).map(([lr,yr])=>[lr,yr.includes(VALUE_SEPARATOR$1)?yr.split(VALUE_SEPARATOR$1):yr]));(jt=Lt.service)!==null&&jt!==void 0||(Lt.service=[]),Lt.service.push(Object.assign(Object.assign({},pr),{id:`${At}#${ir}`,type:ar,serviceEndpoint:fr}));break}case rr.startsWith("typ"):{const{id:nr}=DidDhtUtils$1.parseTxtDataToObject(zt.data);er.types=nr.split(VALUE_SEPARATOR$1).map(ir=>Number(ir));break}case rr.startsWith("did"):{const nr=pr=>pr.split(VALUE_SEPARATOR$1).map(lr=>tr.get(lr)).filter(lr=>typeof lr=="string"),{auth:ir,asm:ar,del:dr,inv:ur,agm:fr}=DidDhtUtils$1.parseTxtDataToObject(zt.data);ir&&(Lt.authentication=nr(ir)),ar&&(Lt.assertionMethod=nr(ar)),dr&&(Lt.capabilityDelegation=nr(dr)),ur&&(Lt.capabilityInvocation=nr(ur)),fr&&(Lt.keyAgreement=nr(fr));break}}}return{didDocument:Lt,didDocumentMetadata:er,didResolutionMetadata:{}}})}static toDnsPacket(e){return __awaiter$1I(this,arguments,void 0,function*({didDocument:At,didMetadata:kt,authoritativeGatewayUris:Bt,previousDidProof:Nt}){var jt,Lt,er,tr,zt;const rr=[],nr=[],ir=new Map,ar=[],dr=[];if(Nt!==void 0){const{signature:pr,previousDid:lr}=Nt;yield DidDhtUtils$1.validatePreviousDidProof({newDid:At.id,previousDidProof:Nt}),rr.push({type:"TXT",name:"_prv._did.",ttl:DNS_RECORD_TTL$1,data:`id=${lr};s=${pr}`})}if(At.alsoKnownAs&&rr.push({type:"TXT",name:"_aka._did.",ttl:DNS_RECORD_TTL$1,data:At.alsoKnownAs.join(VALUE_SEPARATOR$1)}),At.controller){const pr=Array.isArray(At.controller)?At.controller.join(VALUE_SEPARATOR$1):At.controller;rr.push({type:"TXT",name:"_cnt._did.",ttl:DNS_RECORD_TTL$1,data:pr})}for(const[pr,lr]of(Lt=(jt=At.verificationMethod)===null||jt===void 0?void 0:jt.entries())!==null&&Lt!==void 0?Lt:[]){const yr=`k${pr}`;dr.push(yr);let br=lr.id.split("#").pop();ir.set(br,yr);const Ar=lr.publicKeyJwk;if(!(Ar!=null&&Ar.crv&&Ar.crv in AlgorithmToKeyTypeMap$5))throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Verification method '${lr.id}' contains an unsupported key type: ${(er=Ar==null?void 0:Ar.crv)!==null&&er!==void 0?er:"undefined"}`);const Pr=DidDhtRegisteredKeyType$1[Ar.crv],kr=yield DidDhtUtils$1.keyConverter(Ar.crv).publicKeyToBytes({publicKey:Ar}),Ur=Convert.uint8Array(kr).toBase64Url(),Hr=[`t=${Pr}`,`k=${Ur}`];br!=="0"&&(yield computeJwkThumbprint$1({jwk:Ar}))!==br&&Hr.unshift(`id=${br}`),Ar.alg!==KeyTypeToDefaultAlgorithmMap$1[Pr]&&Hr.push(`a=${Ar.alg}`),lr.controller!==At.id&&Hr.push(`c=${lr.controller}`),rr.push({type:"TXT",name:`_${yr}._did.`,ttl:DNS_RECORD_TTL$1,data:Hr.join(PROPERTY_SEPARATOR$1)})}(tr=At.service)===null||tr===void 0||tr.forEach((pr,lr)=>{const yr=`s${lr}`;ar.push(yr);let{id:br,type:Ar,serviceEndpoint:Pr}=pr,kr=__rest$r(pr,["id","type","serviceEndpoint"]);br=extractDidFragment$1(br),Pr=Array.isArray(Pr)?Pr.join(","):Pr;const Hr=Object.entries(Object.assign({id:br,t:Ar,se:Pr},kr)).map(([Sr,_r])=>`${Sr}=${_r}`).join(PROPERTY_SEPARATOR$1),Lr=DidDhtUtils$1.chunkDataIfNeeded(Hr);rr.push({type:"TXT",name:`_${yr}._did.`,ttl:DNS_RECORD_TTL$1,data:Lr})});const ur=[`v=${DID_DHT_SPECIFICATION_VERSION$1}`];if(dr.length&&ur.push(`vm=${dr.join(VALUE_SEPARATOR$1)}`),Object.keys(DidVerificationRelationship$1).forEach(pr=>{var lr;const yr=(lr=At[pr])===null||lr===void 0?void 0:lr.map(br=>ir.get(br.split("#").pop()));if(yr){const br=DidDhtVerificationRelationship$1[pr];ur.push(`${br}=${yr.join(VALUE_SEPARATOR$1)}`)}}),ar.length&&ur.push(`svc=${ar.join(VALUE_SEPARATOR$1)}`),!((zt=kt.types)===null||zt===void 0)&&zt.length){const lr=kt.types.map(yr=>typeof yr=="string"?DidDhtRegisteredDidType$1[yr]:yr);rr.push({type:"TXT",name:"_typ._did.",ttl:DNS_RECORD_TTL$1,data:`id=${lr.join(VALUE_SEPARATOR$1)}`})}rr.push({type:"TXT",name:"_did."+ls.getUniqueDidSuffix(At.id)+".",ttl:DNS_RECORD_TTL$1,data:ur.join(PROPERTY_SEPARATOR$1)});for(const pr of Bt||[])nr.push({type:"NS",name:"_did."+ls.getUniqueDidSuffix(At.id)+".",ttl:DNS_RECORD_TTL$1,data:pr+"."});return{id:0,type:"response",flags:AUTHORITATIVE_ANSWER,answers:[...rr,...nr]}})}static getUniqueDidSuffix(e){return e.split(":")[2]}},DidDhtUtils$1=class Hs{static createBep44PutMessage(e){return __awaiter$1I(this,arguments,void 0,function*({dnsPacket:At,publicKeyBytes:kt,signer:Bt}){const Nt=Math.ceil(Date.now()/1e3),jt=encode$2(At),Lt=bencode.encode({seq:Nt,v:jt}).subarray(1,-1);if(Lt.length>1e3)throw new DidError$1(DidErrorCode$1.InvalidDidDocumentLength,`DNS packet exceeds the 1000 byte maximum size: ${Lt.length} bytes`);const er=yield Bt.sign({data:Lt});return{k:kt,seq:Nt,sig:er,v:jt}})}static identifierToIdentityKey(e){return __awaiter$1I(this,arguments,void 0,function*({didUri:At}){let kt=Hs.identifierToIdentityKeyBytes({didUri:At});return yield Ed25519$1.bytesToPublicKey({publicKeyBytes:kt})})}static identifierToIdentityKeyBytes({didUri:e}){const At=Did$1.parse(e);if(!At)throw new DidError$1(DidErrorCode$1.InvalidDid,`Invalid DID URI: ${e}`);if(At.method!==DidDht$1.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${At.method}`);let kt;try{kt=Convert.base32Z(At.id).toUint8Array()}catch{throw new DidError$1(DidErrorCode$1.InvalidPublicKey,"Failed to decode method-specific identifier")}if(kt.length!==32)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyLength,`Invalid public key length: ${kt.length}`);return kt}static identityKeyToIdentifier(e){return __awaiter$1I(this,arguments,void 0,function*({identityKey:At}){const kt=yield Ed25519$1.publicKeyToBytes({publicKey:At}),Bt=Convert.uint8Array(kt).toBase32Z();return`did:${DidDht$1.methodName}:${Bt}`})}static keyConverter(e){const kt={Ed25519:Ed25519$1,"P-256":{publicKeyToBytes:Bt=>__awaiter$1I(this,[Bt],void 0,function*({publicKey:Nt}){const jt=yield Secp256r1$1.publicKeyToBytes({publicKey:Nt});return yield Secp256r1$1.compressPublicKey({publicKeyBytes:jt})}),bytesToPublicKey:Secp256r1$1.bytesToPublicKey,privateKeyToBytes:Secp256r1$1.privateKeyToBytes,bytesToPrivateKey:Secp256r1$1.bytesToPrivateKey},secp256k1:{publicKeyToBytes:Bt=>__awaiter$1I(this,[Bt],void 0,function*({publicKey:Nt}){const jt=yield Secp256k1$1.publicKeyToBytes({publicKey:Nt});return yield Secp256k1$1.compressPublicKey({publicKeyBytes:jt})}),bytesToPublicKey:Secp256k1$1.bytesToPublicKey,privateKeyToBytes:Secp256k1$1.privateKeyToBytes,bytesToPrivateKey:Secp256k1$1.bytesToPrivateKey},X25519:X25519$1}[e];if(!kt)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Unsupported curve: ${e}`);return kt}static parseBep44GetMessage(e){return __awaiter$1I(this,arguments,void 0,function*({bep44Message:At}){const kt=yield Ed25519$1.bytesToPublicKey({publicKeyBytes:At.k}),Bt=bencode.encode({seq:At.seq,v:At.v}).subarray(1,-1);if(!(yield Ed25519$1.verify({key:kt,signature:At.sig,data:Bt})))throw new DidError$1(DidErrorCode$1.InvalidSignature,"Invalid signature for DHT BEP44 message");return decode$1(At.v)})}static parseTxtDataToObject(e){return this.parseTxtDataToString(e).split(PROPERTY_SEPARATOR$1).reduce((At,kt)=>{const[Bt,Nt]=kt.split("=");return At[Bt]=Nt,At},{})}static parseTxtDataToString(e){if(typeof e=="string")return e;if(e instanceof Uint8Array)return Convert.uint8Array(e).toString();if(Array.isArray(e))return e.map(At=>this.parseTxtDataToString(At)).join("");throw new DidError$1(DidErrorCode$1.InternalError,"Pkarr returned DNS TXT record with invalid data type")}static validatePreviousDidProof(e){return __awaiter$1I(this,arguments,void 0,function*({newDid:At,previousDidProof:kt}){const Bt=yield Hs.identifierToIdentityKey({didUri:kt.previousDid}),Nt=Hs.identifierToIdentityKeyBytes({didUri:At}),jt=Convert.base64Url(kt.signature).toUint8Array();if(!(yield Ed25519$1.verify({key:Bt,data:Nt,signature:jt})))throw new DidError$1(DidErrorCode$1.InvalidPreviousDidProof,"The previous DID proof is invalid.")})}static chunkDataIfNeeded(e){if(e.length<=255)return e;const At=[];for(let kt=0;kt<e.length;kt+=255)At.push(e.slice(kt,kt+255));return At}};var __awaiter$1H=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},DidIonRegisteredKeyType$1;(function(xt){xt.Ed25519="Ed25519",xt.secp256k1="secp256k1",xt.secp256r1="secp256r1",xt.X25519="X25519"})(DidIonRegisteredKeyType$1||(DidIonRegisteredKeyType$1={}));const AlgorithmToKeyTypeMap$4={Ed25519:DidIonRegisteredKeyType$1.Ed25519,ES256K:DidIonRegisteredKeyType$1.secp256k1,ES256:DidIonRegisteredKeyType$1.secp256r1,"P-256":DidIonRegisteredKeyType$1.secp256r1,secp256k1:DidIonRegisteredKeyType$1.secp256k1,secp256r1:DidIonRegisteredKeyType$1.secp256r1},DEFAULT_GATEWAY_URI$2="https://ion.tbd.engineering";let DidIon$1=class Ms extends DidMethod$1{static create(){return __awaiter$1H(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$3,options:At={}}={}){var kt,Bt,Nt,jt,Lt,er,tr;if(!((kt=At.verificationMethods)===null||kt===void 0)&&kt.some(br=>!(br.algorithm in AlgorithmToKeyTypeMap$4)))throw new Error("One or more verification method algorithms are not supported");const zt=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt.filter(br=>"id"in br).map(br=>br.id);if(zt&&zt.length!==new Set(zt).size)throw new Error("One or more verification method IDs are not unique");if(!((Nt=At.services)===null||Nt===void 0)&&Nt.some(br=>!br.id||!br.type||!br.serviceEndpoint))throw new Error("One or more services are missing required properties");const rr={algorithm:"Ed25519",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]},nr=[];for(const br of(jt=At.verificationMethods)!==null&&jt!==void 0?jt:[rr]){const Ar=yield e.generateKey({algorithm:br.algorithm}),Pr=yield e.getPublicKey({keyUri:Ar});nr.push({id:br.id,publicKeyJwk:Pr,purposes:(Lt=br.purposes)!==null&&Lt!==void 0?Lt:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]})}const ir=yield e.generateKey({algorithm:DidIonRegisteredKeyType$1.secp256k1}),ar=yield e.getPublicKey({keyUri:ir}),dr=yield e.generateKey({algorithm:DidIonRegisteredKeyType$1.secp256k1}),ur=yield e.getPublicKey({keyUri:dr}),fr=yield DidIonUtils$1.computeLongFormDidUri({recoveryKey:ar,updateKey:ur,services:(er=At.services)!==null&&er!==void 0?er:[],verificationMethods:nr}),{didDocument:pr,didResolutionMetadata:lr}=yield Ms.resolve(fr,{gatewayUri:At.gatewayUri});if(pr===null)throw new Error(`Unable to resolve DID during creation: ${lr==null?void 0:lr.error}`);const yr=new BearerDid$1({uri:fr,document:pr,metadata:{published:!1,canonicalId:fr.split(":",3).join(":"),recoveryKey:ar,updateKey:ur},keyManager:e});if(!((tr=At.publish)!==null&&tr!==void 0)||tr){const br=yield Ms.publish({did:yr,gatewayUri:At.gatewayUri});yr.metadata=br.didDocumentMetadata}return yr})}static getSigningMethod(e){return __awaiter$1H(this,arguments,void 0,function*({didDocument:At,methodId:kt}){var Bt;const Nt=Did$1.parse(At.id);if(Nt&&Nt.method!==this.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${Nt.method}`);const jt=(Bt=At.verificationMethod)===null||Bt===void 0?void 0:Bt.find(Lt=>{var er;return Lt.id===(kt??((er=At.assertionMethod)===null||er===void 0?void 0:er[0]))});if(!(jt&&jt.publicKeyJwk))throw new DidError$1(DidErrorCode$1.InternalError,"A verification method intended for signing could not be determined from the DID Document");return jt})}static import(e){return __awaiter$1H(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager$3}){const Bt=Did$1.parse(At.uri);if((Bt==null?void 0:Bt.method)!==Ms.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,"Method not supported");return yield BearerDid$1.import({portableDid:At,keyManager:kt})})}static publish(e){return __awaiter$1H(this,arguments,void 0,function*({did:At,gatewayUri:kt=DEFAULT_GATEWAY_URI$2}){var Bt,Nt,jt;const Lt=(Nt=(Bt=At.document.verificationMethod)===null||Bt===void 0?void 0:Bt.map(zt=>({id:zt.id,publicKeyJwk:zt.publicKeyJwk,purposes:getVerificationRelationshipsById$1({didDocument:At.document,methodId:zt.id})})))!==null&&Nt!==void 0?Nt:[],er=yield DidIonUtils$1.createIonDocument({services:(jt=At.document.service)!==null&&jt!==void 0?jt:[],verificationMethods:Lt}),tr=yield DidIonUtils$1.constructCreateRequest({ionDocument:er,recoveryKey:At.metadata.recoveryKey,updateKey:At.metadata.updateKey});try{const zt=DidIonUtils$1.appendPathToUrl({baseUrl:kt,path:"/operations"}),rr=yield fetch(zt,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(tr)});return{didDocument:At.document,didDocumentMetadata:Object.assign(Object.assign({},At.metadata),{published:rr.ok}),didRegistrationMetadata:{}}}catch{return{didDocument:null,didDocumentMetadata:{published:!1},didRegistrationMetadata:{error:DidErrorCode$1.InternalError,errorMessage:`Failed to publish DID document for: ${At.uri}`}}}})}static resolve(e){return __awaiter$1H(this,arguments,void 0,function*(At,kt={}){var Bt,Nt;const jt=Did$1.parse(At);if(!jt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"invalidDid"}});if(jt.method!==Ms.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"methodNotSupported"}});const Lt=(Bt=kt==null?void 0:kt.gatewayUri)!==null&&Bt!==void 0?Bt:DEFAULT_GATEWAY_URI$2;try{const er=DidIonUtils$1.appendPathToUrl({baseUrl:Lt,path:`/identifiers/${At}`}),tr=yield fetch(er);if(!tr.ok)throw new DidError$1(DidErrorCode$1.NotFound,`Unable to find DID document for: ${At}`);const{didDocument:zt,didDocumentMetadata:rr}=yield tr.json();return Object.assign(Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),zt&&{didDocument:zt}),{didDocumentMetadata:Object.assign({published:(Nt=rr==null?void 0:rr.method)===null||Nt===void 0?void 0:Nt.published},rr)})}catch(er){if(!(er instanceof DidError$1))throw new Error(er);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:Object.assign({error:er.code},er.message&&{errorMessage:er.message})})}})}};DidIon$1.methodName="ion";let DidIonUtils$1=class us{static appendPathToUrl({baseUrl:e,path:At}){const kt=new URL(e);return kt.pathname=kt.pathname.endsWith("/")?kt.pathname:kt.pathname+"/",kt.pathname+=At.startsWith("/")?At.substring(1):At,kt.toString()}static computeLongFormDidUri(e){return __awaiter$1H(this,arguments,void 0,function*({recoveryKey:At,updateKey:kt,services:Bt,verificationMethods:Nt}){const jt=yield us.createIonDocument({services:Bt,verificationMethods:Nt}),Lt=us.normalizeJwk(At),er=us.normalizeJwk(kt);return yield IonDid.createLongFormDid({document:jt,recoveryKey:Lt,updateKey:er})})}static constructCreateRequest(e){return __awaiter$1H(this,arguments,void 0,function*({ionDocument:At,recoveryKey:kt,updateKey:Bt}){return yield IonRequest.createCreateRequest({document:At,recoveryKey:us.normalizeJwk(kt),updateKey:us.normalizeJwk(Bt)})})}static createIonDocument(e){return __awaiter$1H(this,arguments,void 0,function*({services:At,verificationMethods:kt}){var Bt,Nt;const jt=[];for(const tr of kt){let zt=(Nt=(Bt=tr.id)!==null&&Bt!==void 0?Bt:tr.publicKeyJwk.kid)!==null&&Nt!==void 0?Nt:yield computeJwkThumbprint$1({jwk:tr.publicKeyJwk});zt=`${zt.split("#").pop()}`;const rr={id:zt,publicKeyJwk:us.normalizeJwk(tr.publicKeyJwk),purposes:tr.purposes,type:"JsonWebKey2020"};jt.push(rr)}const Lt=At.map(tr=>Object.assign(Object.assign({},tr),{id:`${tr.id.split("#").pop()}`}));return{publicKeys:jt,services:Lt}})}static normalizeJwk(e){const At=e.kty;let kt;if(At==="EC")kt={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(At==="oct")kt={k:e.k,kty:e.kty};else if(At==="OKP")kt={crv:e.crv,kty:e.kty,x:e.x};else if(At==="RSA")kt={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${At}`);return kt}};var __awaiter$1G=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DidJwk$1=class Bs extends DidMethod$1{static create(){return __awaiter$1G(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$3,options:At={}}={}){var kt,Bt,Nt,jt;if(At.algorithm&&At.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(At.verificationMethods&&At.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Lt=(jt=(kt=At.algorithm)!==null&&kt!==void 0?kt:(Nt=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt[0])===null||Nt===void 0?void 0:Nt.algorithm)!==null&&jt!==void 0?jt:"Ed25519",er=yield e.generateKey({algorithm:Lt}),tr=yield e.getPublicKey({keyUri:er}),zt=Convert.object(tr).toBase64Url(),rr=`did:${Bs.methodName}:${zt}`,ir=(yield Bs.resolve(rr)).didDocument;return new BearerDid$1({uri:rr,document:ir,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$1G(this,arguments,void 0,function*({didDocument:At}){var kt;const Bt=Did$1.parse(At.id);if(Bt&&Bt.method!==this.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${Bt.method}`);const[Nt]=(kt=At.verificationMethod)!==null&&kt!==void 0?kt:[];if(!(Nt&&Nt.publicKeyJwk))throw new DidError$1(DidErrorCode$1.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Nt})}static import(e){return __awaiter$1G(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager$3}){const Bt=Did$1.parse(At.uri);if((Bt==null?void 0:Bt.method)!==Bs.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,"Method not supported");const Nt=yield BearerDid$1.import({portableDid:At,keyManager:kt});if(Nt.document.verificationMethod.length!==1)throw new DidError$1(DidErrorCode$1.InvalidDidDocument,"DID document must contain exactly one verification method");return Nt})}static resolve(e,At){return __awaiter$1G(this,void 0,void 0,function*(){const kt=Did$1.parse(e);let Bt;try{Bt=Convert.base64Url(kt.id).toObject()}catch{}if(!kt||!Bt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"invalidDid"}});if(kt.method!==Bs.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"methodNotSupported"}});const Nt={"@context":["https://www.w3.org/ns/did/v1"],id:kt.uri},jt=`${Nt.id}#0`;switch(Nt.verificationMethod=[{id:jt,type:"JsonWebKey",controller:Nt.id,publicKeyJwk:Bt}],Nt.authentication=[jt],Nt.assertionMethod=[jt],Nt.capabilityInvocation=[jt],Nt.capabilityDelegation=[jt],Nt.keyAgreement=[jt],Bt.use){case"sig":{delete Nt.keyAgreement;break}case"enc":{delete Nt.authentication,delete Nt.assertionMethod,delete Nt.capabilityInvocation,delete Nt.capabilityDelegation;break}}return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didDocument:Nt})})}};DidJwk$1.methodName="jwk";var __awaiter$1F=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},DidKeyRegisteredKeyType$1;(function(xt){xt.Ed25519="Ed25519",xt.secp256k1="secp256k1",xt.secp256r1="secp256r1",xt.X25519="X25519"})(DidKeyRegisteredKeyType$1||(DidKeyRegisteredKeyType$1={}));const DidKeyVerificationMethodType$1={Ed25519VerificationKey2020:"https://w3id.org/security/suites/ed25519-2020/v1",JsonWebKey2020:"https://w3id.org/security/suites/jws-2020/v1",X25519KeyAgreementKey2020:"https://w3id.org/security/suites/x25519-2020/v1"},AlgorithmToKeyTypeMap$3={Ed25519:DidKeyRegisteredKeyType$1.Ed25519,ES256K:DidKeyRegisteredKeyType$1.secp256k1,ES256:DidKeyRegisteredKeyType$1.secp256r1,"P-256":DidKeyRegisteredKeyType$1.secp256r1,secp256k1:DidKeyRegisteredKeyType$1.secp256k1,secp256r1:DidKeyRegisteredKeyType$1.secp256r1,X25519:DidKeyRegisteredKeyType$1.X25519};let DidKey$1=class Vo extends DidMethod$1{static create(){return __awaiter$1F(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager$3,options:At={}}={}){var kt,Bt,Nt,jt;if(At.algorithm&&At.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(At.verificationMethods&&At.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Lt=(jt=(kt=At.algorithm)!==null&&kt!==void 0?kt:(Nt=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt[0])===null||Nt===void 0?void 0:Nt.algorithm)!==null&&jt!==void 0?jt:"Ed25519",er=yield e.generateKey({algorithm:Lt}),tr=yield e.getPublicKey({keyUri:er}),zt=yield DidKeyUtils$1.publicKeyToMultibaseId({publicKey:tr}),rr=`did:${Vo.methodName}:${zt}`,ir=(yield Vo.resolve(rr,At)).didDocument;return new BearerDid$1({uri:rr,document:ir,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$1F(this,arguments,void 0,function*({didDocument:At}){var kt;const Bt=Did$1.parse(At.id);if(Bt&&Bt.method!==this.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${Bt.method}`);const[Nt]=At.assertionMethod||[],jt=(kt=At.verificationMethod)===null||kt===void 0?void 0:kt.find(Lt=>Lt.id===Nt);if(!(jt&&jt.publicKeyJwk))throw new DidError$1(DidErrorCode$1.InternalError,"A verification method intended for signing could not be determined from the DID Document");return jt})}static import(e){return __awaiter$1F(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager$3}){const Bt=Did$1.parse(At.uri);if((Bt==null?void 0:Bt.method)!==Vo.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,"Method not supported");const Nt=yield BearerDid$1.import({portableDid:At,keyManager:kt});if(Nt.document.verificationMethod.length!==1)throw new DidError$1(DidErrorCode$1.InvalidDidDocument,"DID document must contain exactly one verification method");return Nt})}static resolve(e,At){return __awaiter$1F(this,void 0,void 0,function*(){try{const kt=yield Vo.createDocument({didUri:e,options:At});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didDocument:kt})}catch(kt){if(!(kt instanceof DidError$1))throw new Error(kt);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:Object.assign({error:kt.code},kt.message&&{errorMessage:kt.message})})}})}static createDocument(e){return __awaiter$1F(this,arguments,void 0,function*({didUri:At,options:kt={}}){const{defaultContext:Bt="https://www.w3.org/ns/did/v1",enableEncryptionKeyDerivation:Nt=!1,enableExperimentalPublicKeyTypes:jt=!1,publicKeyFormat:Lt="JsonWebKey2020"}=kt,er={id:""},tr=Did$1.parse(At);if(!tr)throw new DidError$1(DidErrorCode$1.InvalidDid,`Invalid DID URI: ${At}`);const zt=tr.id;if(tr.method!==Vo.methodName)throw new DidError$1(DidErrorCode$1.MethodNotSupported,`Method not supported: ${tr.method}`);if(!Vo.validateIdentifier(tr))throw new DidError$1(DidErrorCode$1.InvalidDid,`Invalid DID URI: ${At}`);const rr=yield Vo.createSignatureMethod({didUri:At,multibaseValue:zt,options:{enableExperimentalPublicKeyTypes:jt,publicKeyFormat:Lt}});if(er.id=tr.uri,er.verificationMethod=[rr],er.authentication=[rr.id],er.assertionMethod=[rr.id],er.capabilityInvocation=[rr.id],er.capabilityDelegation=[rr.id],Nt===!0){const ar=Lt==="Ed25519VerificationKey2020"?"X25519KeyAgreementKey2020":"JsonWebKey2020",dr=yield this.createEncryptionMethod({didUri:At,multibaseValue:zt,options:{enableExperimentalPublicKeyTypes:jt,publicKeyFormat:ar}});er.verificationMethod.push(dr),er.keyAgreement=[dr.id]}const nr=[Bt];return getVerificationMethodTypes$1({didDocument:er}).forEach(ar=>{const dr=DidKeyVerificationMethodType$1[ar];nr.push(dr)}),er["@context"]=nr,er})}static createEncryptionMethod(e){return __awaiter$1F(this,arguments,void 0,function*({didUri:At,multibaseValue:kt,options:Bt}){const{enableExperimentalPublicKeyTypes:Nt,publicKeyFormat:jt}=Bt,Lt={id:"",type:"",controller:""},{keyBytes:er,multicodecCode:tr}=yield Vo.deriveEncryptionKey({multibaseValue:kt}),zt=er.byteLength,rr=DidKeyUtils$1.MULTICODEC_PUBLIC_KEY_LENGTH[tr];if(zt!==rr)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyLength,`Expected ${zt} bytes. Actual: ${rr}`);const nr=keyBytesToMultibaseId$1({keyBytes:er,multicodecCode:tr});Lt.id=`${At}#${nr}`;try{new URL(Lt.id)}catch{throw new DidError$1(DidErrorCode$1.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(jt in DidKeyVerificationMethodType$1))throw new DidError$1(DidErrorCode$1.UnsupportedPublicKeyType,`Unsupported format: ${jt}`);if(Nt===!1&&!["Multikey","JsonWebKey2020","X25519KeyAgreementKey2020"].includes(jt))throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Specified '${jt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Lt.type=jt,Lt.controller=At,jt==="X25519KeyAgreementKey2020"&&(Lt.publicKeyMultibase=nr),jt==="JsonWebKey2020"){const{crv:ar}=yield DidKeyUtils$1.multicodecToJwk({code:tr});Lt.publicKeyJwk=yield DidKeyUtils$1.keyConverter(ar).bytesToPublicKey({publicKeyBytes:er})}return Lt})}static createSignatureMethod(e){return __awaiter$1F(this,arguments,void 0,function*({didUri:At,multibaseValue:kt,options:Bt}){const{enableExperimentalPublicKeyTypes:Nt,publicKeyFormat:jt}=Bt,Lt={id:"",type:"",controller:""},{keyBytes:er,multicodecCode:tr,multicodecName:zt}=multibaseIdToKeyBytes$1({multibaseKeyId:kt}),rr=er.byteLength,nr=DidKeyUtils$1.MULTICODEC_PUBLIC_KEY_LENGTH[tr];if(rr!==nr)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyLength,`Expected ${rr} bytes. Actual: ${nr}`);let ir=!1;switch(zt){case"secp256k1-pub":ir=yield Secp256k1$1.validatePublicKey({publicKeyBytes:er});break;case"ed25519-pub":ir=yield Ed25519$1.validatePublicKey({publicKeyBytes:er});break;case"x25519-pub":ir=!0;break}if(!ir)throw new DidError$1(DidErrorCode$1.InvalidPublicKey,"Invalid public key detected.");Lt.id=`${At}#${kt}`;try{new URL(Lt.id)}catch{throw new DidError$1(DidErrorCode$1.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(jt in DidKeyVerificationMethodType$1))throw new DidError$1(DidErrorCode$1.UnsupportedPublicKeyType,`Unsupported format: ${jt}`);if(Nt===!1&&!["Multikey","JsonWebKey2020","Ed25519VerificationKey2020"].includes(jt))throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Specified '${jt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Lt.type=jt,Lt.controller=At,jt==="Ed25519VerificationKey2020"&&(Lt.publicKeyMultibase=kt),jt==="JsonWebKey2020"){const{crv:dr}=yield DidKeyUtils$1.multicodecToJwk({code:tr});Lt.publicKeyJwk=yield DidKeyUtils$1.keyConverter(dr).bytesToPublicKey({publicKeyBytes:er})}return Lt})}static deriveEncryptionKey(e){return __awaiter$1F(this,arguments,void 0,function*({multibaseValue:At}){let kt={keyBytes:new Uint8Array,multicodecCode:0};const{keyBytes:Bt,multicodecCode:Nt}=multibaseIdToKeyBytes$1({multibaseKeyId:At});if(Nt===237){const jt=yield DidKeyUtils$1.keyConverter("Ed25519").bytesToPublicKey({publicKeyBytes:Bt}),Lt=yield Ed25519$1.convertPublicKeyToX25519({publicKey:jt});kt={keyBytes:yield DidKeyUtils$1.keyConverter("Ed25519").publicKeyToBytes({publicKey:Lt}),multicodecCode:236}}return kt})}static validateIdentifier(e){const{method:At,id:kt}=e,[Bt]=e.uri.split(":",1);return Bt==="did"&&At==="key"&&Number("1")>0&&universalTypeOf(kt)==="String"&&kt.startsWith("z")}};DidKey$1.methodName="key";let DidKeyUtils$1=class _s{static jwkToMulticodec(e){return __awaiter$1F(this,arguments,void 0,function*({jwk:At}){const kt=[];At.crv&&(kt.push(At.crv),At.d?kt.push("private"):kt.push("public"));const Bt=kt.join(":"),Nt=_s.JWK_TO_MULTICODEC[Bt];if(Nt===void 0)throw new Error(`Unsupported JWK to Multicodec conversion: '${Bt}'`);return{code:Multicodec.getCodeFromName({name:Nt}),name:Nt}})}static keyCompressor(e){const kt={"P-256":Secp256r1$1.compressPublicKey,secp256k1:Secp256k1$1.compressPublicKey}[e];if(!kt)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Unsupported curve: ${e}`);return kt}static keyConverter(e){const kt={Ed25519:Ed25519$1,"P-256":Secp256r1$1,secp256k1:Secp256k1$1,X25519:X25519$1}[e];if(!kt)throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Unsupported curve: ${e}`);return kt}static multicodecToJwk(e){return __awaiter$1F(this,arguments,void 0,function*({code:At,name:kt}){if(!(kt?!At:At))throw new Error("Either 'name' or 'code' must be defined, but not both.");kt=kt===void 0?Multicodec.getNameFromCode({code:At}):kt;const Bt=kt,Nt=_s.MULTICODEC_TO_JWK[Bt];if(Nt===void 0)throw new Error("Unsupported Multicodec to JWK conversion");return Object.assign({},Nt)})}static publicKeyToMultibaseId(e){return __awaiter$1F(this,arguments,void 0,function*({publicKey:At}){var kt;if(!(At!=null&&At.crv&&At.crv in AlgorithmToKeyTypeMap$3))throw new DidError$1(DidErrorCode$1.InvalidPublicKeyType,`Public key contains an unsupported key type: ${(kt=At==null?void 0:At.crv)!==null&&kt!==void 0?kt:"undefined"}`);let Bt=yield _s.keyConverter(At.crv).publicKeyToBytes({publicKey:At});/^(secp256k1|P-256|P-384|P-521)$/.test(At.crv)&&(Bt=yield _s.keyCompressor(At.crv)({publicKeyBytes:Bt}));const{name:Nt}=yield _s.jwkToMulticodec({jwk:At});return keyBytesToMultibaseId$1({keyBytes:Bt,multicodecName:Nt})})}};DidKeyUtils$1.JWK_TO_MULTICODEC={"Ed25519:public":"ed25519-pub","Ed25519:private":"ed25519-priv","secp256k1:public":"secp256k1-pub","secp256k1:private":"secp256k1-priv","X25519:public":"x25519-pub","X25519:private":"x25519-priv"};DidKeyUtils$1.MULTICODEC_PUBLIC_KEY_LENGTH={231:33,236:32,237:32};DidKeyUtils$1.MULTICODEC_TO_JWK={"ed25519-pub":{crv:"Ed25519",kty:"OKP",x:""},"ed25519-priv":{crv:"Ed25519",kty:"OKP",x:"",d:""},"secp256k1-pub":{crv:"secp256k1",kty:"EC",x:"",y:""},"secp256k1-priv":{crv:"secp256k1",kty:"EC",x:"",y:"",d:""},"x25519-pub":{crv:"X25519",kty:"OKP",x:""},"x25519-priv":{crv:"X25519",kty:"OKP",x:"",d:""}};var __awaiter$1E=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DidWeb$1=class Dl extends DidMethod$1{static resolve(e,At){return __awaiter$1E(this,void 0,void 0,function*(){const kt=Did$1.parse(e);if(!kt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"invalidDid"}});if(kt.method!==Dl.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"methodNotSupported"}});let Bt=`https://${kt.id.replace(/:/g,"/")}`;Bt=decodeURIComponent(Bt);const Nt=kt.id.includes(":")?`${Bt}/did.json`:`${Bt}/.well-known/did.json`;try{const jt=yield fetch(Nt);if(!jt.ok)throw new Error("HTTP error status code returned");const Lt=yield jt.json();return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didDocument:Lt})}catch{return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:"notFound"}})}})}};DidWeb$1.methodName="web";var __awaiter$1D=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class DidResolverCacheLevel{constructor({db:e,location:At="DATA/DID_RESOLVERCACHE",ttl:kt="15m"}={}){this.cache=e??new Level$1(At),this.ttl=ms$1(kt)}get(e){return __awaiter$1D(this,void 0,void 0,function*(){try{const At=yield this.cache.get(e),kt=JSON.parse(At);if(Date.now()>=kt.ttlMillis){this.cache.nextTick(()=>this.cache.del(e));return}else return kt.value}catch(At){if(At.notFound)return;throw At}})}set(e,At){const kt={ttlMillis:Date.now()+this.ttl,value:At},Bt=JSON.stringify(kt);return this.cache.put(e,Bt)}delete(e){return this.cache.del(e)}clear(){return this.cache.clear()}close(){return this.cache.close()}}const DidResolverCacheNoop={get:function(xt){return null},set:function(xt,e){return null},delete:function(xt){return null},clear:function(){return null},close:function(){return null}};var __awaiter$1C=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class UniversalResolver{constructor({cache:e,didResolvers:At}){this.didResolvers=new Map,this.cache=e||DidResolverCacheNoop;for(const kt of At)this.didResolvers.set(kt.methodName,kt)}resolve(e,At){return __awaiter$1C(this,void 0,void 0,function*(){const kt=Did$1.parse(e);if(!kt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:DidErrorCode$1.InvalidDid,errorMessage:`Invalid DID URI: ${e}`}});const Bt=this.didResolvers.get(kt.method);if(!Bt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT$1),{didResolutionMetadata:{error:DidErrorCode$1.MethodNotSupported,errorMessage:`Method not supported: ${kt.method}`}});const Nt=yield this.cache.get(kt.uri);if(Nt)return Nt;{const jt=yield Bt.resolve(kt.uri,At);return jt.didResolutionMetadata.error||(yield this.cache.set(kt.uri,jt)),jt}})}dereference(e,At){return __awaiter$1C(this,void 0,void 0,function*(){const kt=Did$1.parse(e);if(!kt)return{dereferencingMetadata:{error:DidErrorCode$1.InvalidDidUrl},contentStream:null,contentMetadata:{}};const{didDocument:Bt,didResolutionMetadata:Nt,didDocumentMetadata:jt}=yield this.resolve(kt.uri);if(!Bt)return{dereferencingMetadata:{error:Nt.error},contentStream:null,contentMetadata:{}};if(!kt.fragment||kt.query)return{dereferencingMetadata:{contentType:"application/did+json"},contentStream:Bt,contentMetadata:jt};const{service:Lt=[],verificationMethod:er=[]}=Bt,tr=new Set([e,kt.fragment,`#${kt.fragment}`]);let zt;for(let rr of er)if(tr.has(rr.id)){zt=rr;break}for(let rr of Lt)if(tr.has(rr.id)){zt=rr;break}return zt?{dereferencingMetadata:{contentType:"application/did+json"},contentStream:zt,contentMetadata:Nt}:{dereferencingMetadata:{error:DidErrorCode$1.NotFound},contentStream:null,contentMetadata:{}}})}}var __awaiter$1B=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let AgentDidResolverCache$1=class extends DidResolverCacheLevel{constructor({agent:e,db:At,location:kt,ttl:Bt}){super({db:At,location:kt,ttl:Bt}),this._resolving=new Map,this._agent=e}get agent(){if(!this._agent)throw new Error("Agent not initialized");return this._agent}set agent(e){this._agent=e}get(e){return __awaiter$1B(this,void 0,void 0,function*(){try{const At=yield this.cache.get(e),kt=JSON.parse(At);if(!this._resolving.has(e)&&Date.now()>=kt.ttlMillis)if(this._resolving.set(e,!0),this.agent.agentDid.uri===e||typeof(yield this.agent.identity.get({didUri:e}))<"u")try{const Bt=yield this.agent.did.resolve(e);Bt.didResolutionMetadata.error||this.set(e,Bt)}finally{this._resolving.delete(e)}else this._resolving.delete(e),this.cache.nextTick(()=>this.cache.del(e));return kt.value}catch(At){if(At.notFound)return;throw At}})}};var __awaiter$1A=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let BearerIdentity$1=class{constructor({did:e,metadata:At}){this.did=e,this.metadata=At}export(){return __awaiter$1A(this,void 0,void 0,function*(){return{portableDid:yield this.did.export(),metadata:this.metadata}})}};var __awaiter$1z=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let Hkdf$1=class{static deriveKeyBytes({baseKeyBytes:e,length:At,hash:kt,salt:Bt,info:Nt=new Uint8Array}){return __awaiter$1z(this,void 0,void 0,function*(){const Lt=yield getWebcryptoSubtle().importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]);Bt=typeof Bt=="string"?Convert.string(Bt).toUint8Array():Bt,Nt=typeof Nt=="string"?Convert.string(Nt).toUint8Array():Nt;const er=yield crypto.subtle.deriveBits({name:"HKDF",hash:kt,salt:Bt,info:Nt},Lt,At);return new Uint8Array(er)})}};var __awaiter$1y=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$q=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let HkdfAlgorithm$1=class extends CryptoAlgorithm$1{deriveKeyBytes(e){var{algorithm:At}=e,kt=__rest$q(e,["algorithm"]);return __awaiter$1y(this,void 0,void 0,function*(){const Bt={"HKDF-256":"SHA-256","HKDF-384":"SHA-384","HKDF-512":"SHA-512"}[At];return yield Hkdf$1.deriveKeyBytes(Object.assign(Object.assign({},kt),{hash:Bt}))})}},CryptoError$1=class Pl extends Error{constructor(e,At){super(At),this.code=e,this.name="CryptoError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Pl)}};var CryptoErrorCode$1;(function(xt){xt.AlgorithmNotSupported="algorithmNotSupported",xt.EncodingError="encodingError",xt.InvalidJwe="invalidJwe",xt.InvalidJwk="invalidJwk",xt.OperationNotSupported="operationNotSupported"})(CryptoErrorCode$1||(CryptoErrorCode$1={}));var __awaiter$1x=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let EcdsaAlgorithm$2=class extends CryptoAlgorithm$1{bytesToPrivateKey({algorithm:e,privateKeyBytes:At}){return __awaiter$1x(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const kt=yield Secp256k1$1.bytesToPrivateKey({privateKeyBytes:At});return kt.alg="EdDSA",kt}case"ES256":case"secp256r1":{const kt=yield Secp256r1$1.bytesToPrivateKey({privateKeyBytes:At});return kt.alg="EdDSA",kt}default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}bytesToPublicKey({algorithm:e,publicKeyBytes:At}){return __awaiter$1x(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const kt=yield Secp256k1$1.bytesToPublicKey({publicKeyBytes:At});return kt.alg="EdDSA",kt}case"ES256":case"secp256r1":{const kt=yield Secp256r1$1.bytesToPublicKey({publicKeyBytes:At});return kt.alg="EdDSA",kt}default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}computePublicKey({key:e}){return __awaiter$1x(this,void 0,void 0,function*(){if(!isEcPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const At=yield Secp256k1$1.computePublicKey({key:e});return At.alg="ES256K",At}case"P-256":{const At=yield Secp256r1$1.computePublicKey({key:e});return At.alg="ES256",At}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}generateKey({algorithm:e}){return __awaiter$1x(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const At=yield Secp256k1$1.generateKey();return At.alg="ES256K",At}case"ES256":case"secp256r1":{const At=yield Secp256r1$1.generateKey();return At.alg="ES256",At}}})}getPublicKey({key:e}){return __awaiter$1x(this,void 0,void 0,function*(){if(!isEcPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const At=yield Secp256k1$1.getPublicKey({key:e});return At.alg="ES256K",At}case"P-256":{const At=yield Secp256r1$1.getPublicKey({key:e});return At.alg="ES256",At}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}privateKeyToBytes({privateKey:e}){return __awaiter$1x(this,void 0,void 0,function*(){switch(e.crv){case"secp256k1":return yield Secp256k1$1.privateKeyToBytes({privateKey:e});case"P-256":return yield Secp256r1$1.privateKeyToBytes({privateKey:e});default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}publicKeyToBytes({publicKey:e}){return __awaiter$1x(this,void 0,void 0,function*(){switch(e.crv){case"secp256k1":return yield Secp256k1$1.publicKeyToBytes({publicKey:e});case"P-256":return yield Secp256r1$1.publicKeyToBytes({publicKey:e});default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}sign({key:e,data:At}){return __awaiter$1x(this,void 0,void 0,function*(){if(!isEcPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":return yield Secp256k1$1.sign({key:e,data:At});case"P-256":return yield Secp256r1$1.sign({key:e,data:At});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}verify({key:e,signature:At,data:kt}){return __awaiter$1x(this,void 0,void 0,function*(){if(!isEcPublicJwk$1(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(e.crv){case"secp256k1":return yield Secp256k1$1.verify({key:e,signature:At,data:kt});case"P-256":return yield Secp256r1$1.verify({key:e,signature:At,data:kt});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}};var __awaiter$1w=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let EdDsaAlgorithm$2=class extends CryptoAlgorithm$1{bytesToPrivateKey({algorithm:e,privateKeyBytes:At}){return __awaiter$1w(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const kt=yield Ed25519$1.bytesToPrivateKey({privateKeyBytes:At});return kt.alg="EdDSA",kt}default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}bytesToPublicKey({algorithm:e,publicKeyBytes:At}){return __awaiter$1w(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const kt=yield Ed25519$1.bytesToPublicKey({publicKeyBytes:At});return kt.alg="EdDSA",kt}default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}computePublicKey({key:e}){return __awaiter$1w(this,void 0,void 0,function*(){if(!isOkpPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const At=yield Ed25519$1.computePublicKey({key:e});return At.alg="EdDSA",At}default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}generateKey({algorithm:e}){return __awaiter$1w(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const At=yield Ed25519$1.generateKey();return At.alg="EdDSA",At}}})}getPublicKey({key:e}){return __awaiter$1w(this,void 0,void 0,function*(){if(!isOkpPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const At=yield Ed25519$1.getPublicKey({key:e});return At.alg="EdDSA",At}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}privateKeyToBytes({privateKey:e}){return __awaiter$1w(this,void 0,void 0,function*(){switch(e.crv){case"Ed25519":return yield Ed25519$1.privateKeyToBytes({privateKey:e});default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}publicKeyToBytes({publicKey:e}){return __awaiter$1w(this,void 0,void 0,function*(){switch(e.crv){case"Ed25519":return yield Ed25519$1.publicKeyToBytes({publicKey:e});default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}sign({key:e,data:At}){return __awaiter$1w(this,void 0,void 0,function*(){if(!isOkpPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":return yield Ed25519$1.sign({key:e,data:At});default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}verify({key:e,signature:At,data:kt}){return __awaiter$1w(this,void 0,void 0,function*(){if(!isOkpPublicJwk$1(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(e.crv){case"Ed25519":return yield Ed25519$1.verify({key:e,signature:At,data:kt});default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}};var __awaiter$1v=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$p=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const AES_KEY_LENGTHS$1=[128,192,256];let AesKw$1=class{static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$1v(this,void 0,void 0,function*(){const At={k:Convert.uint8Array(e).toBase64Url(),kty:"oct"};At.kid=yield computeJwkThumbprint$1({jwk:At});const kt=e.length*8;return At.alg={128:"A128KW",192:"A192KW",256:"A256KW"}[kt],At})}static generateKey({length:e}){return __awaiter$1v(this,void 0,void 0,function*(){if(!AES_KEY_LENGTHS$1.includes(e))throw new RangeError(`The key length is invalid: Must be ${AES_KEY_LENGTHS$1.join(", ")} bits`);const At=getWebcryptoSubtle(),kt=yield At.generateKey({name:"AES-KW",length:e},!0,["wrapKey","unwrapKey"]),Bt=yield At.exportKey("jwk",kt),Nt=__rest$p(Bt,["ext","key_ops"]);return Nt.kid=yield computeJwkThumbprint$1({jwk:Nt}),Nt})}static privateKeyToBytes({privateKey:e}){return __awaiter$1v(this,void 0,void 0,function*(){if(!isOctPrivateJwk(e))throw new Error("AesKw: The provided key is not a valid oct private key.");return Convert.base64Url(e.k).toUint8Array()})}static unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:At,decryptionKey:kt}){return __awaiter$1v(this,void 0,void 0,function*(){if(!("alg"in kt&&kt.alg))throw new CryptoError$1(CryptoErrorCode$1.InvalidJwk,"The decryption key is missing the 'alg' property.");if(!["A128KW","A192KW","A256KW"].includes(kt.alg))throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`The 'decryptionKey' algorithm is not supported: ${kt.alg}`);const Bt=getWebcryptoSubtle(),Nt=yield Bt.importKey("jwk",kt,{name:"AES-KW"},!0,["unwrapKey"]),jt={A128KW:"AES-KW",A192KW:"AES-KW",A256KW:"AES-KW",A128GCM:"AES-GCM",A192GCM:"AES-GCM",A256GCM:"AES-GCM"}[At];if(!jt)throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`The 'wrappedKeyAlgorithm' is not supported: ${At}`);const Lt=yield Bt.unwrapKey("raw",e.buffer,Nt,"AES-KW",{name:jt},!0,["unwrapKey"]),er=yield Bt.exportKey("jwk",Lt),zt=__rest$p(er,["ext","key_ops"]);return zt.kid=yield computeJwkThumbprint$1({jwk:zt}),zt})}static wrapKey({unwrappedKey:e,encryptionKey:At}){return __awaiter$1v(this,void 0,void 0,function*(){if(!("alg"in At&&At.alg))throw new CryptoError$1(CryptoErrorCode$1.InvalidJwk,"The encryption key is missing the 'alg' property.");if(!["A128KW","A192KW","A256KW"].includes(At.alg))throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`The 'encryptionKey' algorithm is not supported: ${At.alg}`);if(!("alg"in e&&e.alg))throw new CryptoError$1(CryptoErrorCode$1.InvalidJwk,"The private key to wrap is missing the 'alg' property.");const kt=getWebcryptoSubtle(),Bt=yield kt.importKey("jwk",At,{name:"AES-KW"},!0,["wrapKey"]),Nt={A128KW:"AES-KW",A192KW:"AES-KW",A256KW:"AES-KW",A128GCM:"AES-GCM",A192GCM:"AES-GCM",A256GCM:"AES-GCM"}[e.alg];if(!Nt)throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`The 'unwrappedKey' algorithm is not supported: ${e.alg}`);const jt=yield kt.importKey("jwk",e,{name:Nt},!0,["unwrapKey"]),Lt=yield kt.wrapKey("raw",jt,Bt,"AES-KW");return new Uint8Array(Lt)})}};var __awaiter$1u=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let AesKwAlgorithm$1=class extends CryptoAlgorithm$1{bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$1u(this,void 0,void 0,function*(){const At=yield AesKw$1.bytesToPrivateKey({privateKeyBytes:e});return At.alg={16:"A128KW",24:"A192KW",32:"A256KW"}[e.length],At})}generateKey({algorithm:e}){return __awaiter$1u(this,void 0,void 0,function*(){const At={A128KW:128,A192KW:192,A256KW:256}[e],kt=yield AesKw$1.generateKey({length:At});return kt.alg=e,kt})}privateKeyToBytes({privateKey:e}){return __awaiter$1u(this,void 0,void 0,function*(){return yield AesKw$1.privateKeyToBytes({privateKey:e})})}unwrapKey(e){return __awaiter$1u(this,void 0,void 0,function*(){return yield AesKw$1.unwrapKey(e)})}wrapKey(e){return __awaiter$1u(this,void 0,void 0,function*(){return AesKw$1.wrapKey(e)})}};var __awaiter$1t=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let Pbkdf2$1=class{static deriveKeyBytes({baseKeyBytes:e,hash:At,salt:kt,iterations:Bt,length:Nt}){return __awaiter$1t(this,void 0,void 0,function*(){const jt=getWebcryptoSubtle(),Lt=yield jt.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]),er=yield jt.deriveBits({name:"PBKDF2",hash:At,salt:kt,iterations:Bt},Lt,Nt);return new Uint8Array(er)})}};var __awaiter$1s=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$o=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let Pbkdf2Algorithm$1=class extends CryptoAlgorithm$1{deriveKeyBytes(e){var{algorithm:At}=e,kt=__rest$o(e,["algorithm"]);return __awaiter$1s(this,void 0,void 0,function*(){const[,Bt]=At.split(/[-+]/),Nt={HS256:"SHA-256",HS384:"SHA-384",HS512:"SHA-512"}[Bt];return yield Pbkdf2$1.deriveKeyBytes(Object.assign(Object.assign({},kt),{hash:Nt}))})}};var __awaiter$1r=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let AesGcmAlgorithm$1=class extends CryptoAlgorithm$1{bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$1r(this,void 0,void 0,function*(){const At=yield AesGcm.bytesToPrivateKey({privateKeyBytes:e});return At.alg={16:"A128GCM",24:"A192GCM",32:"A256GCM"}[e.length],At})}decrypt(e){return __awaiter$1r(this,void 0,void 0,function*(){return AesGcm.decrypt(e)})}encrypt(e){return __awaiter$1r(this,void 0,void 0,function*(){return AesGcm.encrypt(e)})}generateKey({algorithm:e}){return __awaiter$1r(this,void 0,void 0,function*(){const At={A128GCM:128,A192GCM:192,A256GCM:256}[e],kt=yield AesGcm.generateKey({length:At});return kt.alg=e,kt})}privateKeyToBytes({privateKey:e}){return __awaiter$1r(this,void 0,void 0,function*(){return yield AesGcm.privateKeyToBytes({privateKey:e})})}};var __awaiter$1q=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const supportedAlgorithms$4={"AES-GCM":{implementation:AesGcmAlgorithm$1,names:["A128GCM","A192GCM","A256GCM"],operations:["bytesToPrivateKey","decrypt","encrypt","generateKey"]},"AES-KW":{implementation:AesKwAlgorithm$1,names:["A128KW","A192KW","A256KW"],operations:["bytesToPrivateKey","generateKey","privateKeyToBytes","wrapKey","unwrapKey"]},Ed25519:{implementation:EdDsaAlgorithm$2,names:["Ed25519"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},HKDF:{implementation:HkdfAlgorithm$1,names:["HKDF-256","HKDF-384","HKDF-512"],operations:["deriveKey","deriveKeyBytes"]},PBKDF2:{implementation:Pbkdf2Algorithm$1,names:["PBES2-HS256+A128KW","PBES2-HS384+A192KW","PBES2-HS512+A256KW"],operations:["deriveKey","deriveKeyBytes"]},secp256k1:{implementation:EcdsaAlgorithm$2,names:["ES256K","secp256k1"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},secp256r1:{implementation:EcdsaAlgorithm$2,names:["ES256","secp256r1"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},"SHA-256":{implementation:Sha2Algorithm$1,names:["SHA-256"],operations:["digest"]}};let AgentCryptoApi$1=class{constructor(){this._algorithmInstances=new Map}bytesToPrivateKey({algorithm:e,privateKeyBytes:At}){return __awaiter$1q(this,void 0,void 0,function*(){const kt=this.getAlgorithmName({algorithm:e});return yield this.getAlgorithm({algorithm:kt}).bytesToPrivateKey({algorithm:e,privateKeyBytes:At})})}bytesToPublicKey({algorithm:e,publicKeyBytes:At}){return __awaiter$1q(this,void 0,void 0,function*(){const kt=this.getAlgorithmName({algorithm:e});return yield this.getAlgorithm({algorithm:kt}).bytesToPublicKey({algorithm:e,publicKeyBytes:At})})}decrypt(e){return __awaiter$1q(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e.key});return yield this.getAlgorithm({algorithm:At}).decrypt(e)})}deriveKey(e){var At,kt;return __awaiter$1q(this,void 0,void 0,function*(){const Bt=this.getAlgorithmName({algorithm:e.algorithm}),Nt=this.getAlgorithm({algorithm:Bt});let jt;switch(e.algorithm){case"HKDF-256":case"HKDF-384":case"HKDF-512":{jt=e.derivedKeyAlgorithm;break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{jt=e.algorithm.split(/[-+]/)[2];break}default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`The specified "algorithm" is not supported: ${e.algorithm}`)}const Lt=+((kt=(At=jt.match(/\d+/))===null||At===void 0?void 0:At[0])!==null&&kt!==void 0?kt:-1);if(Lt===-1)throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`The derived key algorithm" is not supported: ${jt}`);const er=yield Nt.deriveKeyBytes(Object.assign(Object.assign({},e),{length:Lt}));return yield this.bytesToPrivateKey({algorithm:jt,privateKeyBytes:er})})}deriveKeyBytes(e){return __awaiter$1q(this,void 0,void 0,function*(){const At=this.getAlgorithmName({algorithm:e.algorithm});return yield this.getAlgorithm({algorithm:At}).deriveKeyBytes(e)})}digest({algorithm:e,data:At}){return __awaiter$1q(this,void 0,void 0,function*(){return yield this.getAlgorithm({algorithm:e}).digest({algorithm:e,data:At})})}encrypt(e){return __awaiter$1q(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e.key});return yield this.getAlgorithm({algorithm:At}).encrypt(e)})}generateKey(e){var At;return __awaiter$1q(this,void 0,void 0,function*(){const kt=this.getAlgorithmName({algorithm:e.algorithm}),Nt=yield this.getAlgorithm({algorithm:kt}).generateKey({algorithm:e.algorithm});return(At=Nt.kid)!==null&&At!==void 0||(Nt.kid=yield computeJwkThumbprint$1({jwk:Nt})),Nt})}getKeyUri(e){return __awaiter$1q(this,void 0,void 0,function*(){throw new Error("Method not implemented.")})}getPublicKey({key:e}){return __awaiter$1q(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:At}).getPublicKey({key:e})})}privateKeyToBytes({privateKey:e}){return __awaiter$1q(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:At}).privateKeyToBytes({privateKey:e})})}publicKeyToBytes({publicKey:e}){return __awaiter$1q(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:At}).publicKeyToBytes({publicKey:e})})}sign({key:e,data:At}){return __awaiter$1q(this,void 0,void 0,function*(){const kt=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:kt}).sign({data:At,key:e})})}unwrapKey(e){return __awaiter$1q(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e.decryptionKey});return yield this.getAlgorithm({algorithm:At}).unwrapKey(e)})}verify({key:e,signature:At,data:kt}){return __awaiter$1q(this,void 0,void 0,function*(){const Bt=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:Bt}).verify({key:e,signature:At,data:kt})})}wrapKey(e){return __awaiter$1q(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e.encryptionKey});return yield this.getAlgorithm({algorithm:At}).wrapKey(e)})}getAlgorithm({algorithm:e}){var At;const kt=(At=supportedAlgorithms$4[e])===null||At===void 0?void 0:At.implementation;if(!kt)throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Algorithm not supported: ${e}`);return this._algorithmInstances.has(kt)||this._algorithmInstances.set(kt,new kt),this._algorithmInstances.get(kt)}getAlgorithmName({algorithm:e,key:At}){var kt;const Bt=(kt=At==null?void 0:At.alg)!==null&&kt!==void 0?kt:e,Nt=At==null?void 0:At.crv;for(const jt of Object.keys(supportedAlgorithms$4)){const Lt=supportedAlgorithms$4[jt].names;if(Bt&&Lt.includes(Bt))return jt;if(Nt&&Lt.includes(Nt))return jt}throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Algorithm not supported based on provided input: alg=${Bt}, crv=${Nt}. Please check the documentation for the list of supported algorithms.`)}};const IdentityProtocolDefinition$1={protocol:"http://identity.foundation/protocols/web5/identity-store",published:!1,types:{portableDid:{schema:"https://identity.foundation/schemas/web5/portable-did",dataFormats:["application/json"]},identityMetadata:{schema:"https://identity.foundation/schemas/web5/identity-metadata",dataFormats:["application/json"]}},structure:{portableDid:{},identityMetadata:{}}},JwkProtocolDefinition$1={protocol:"http://identity.foundation/protocols/web5/jwk-store",published:!1,types:{privateJwk:{schema:"https://identity.foundation/schemas/web5/private-jwk",dataFormats:["application/json"]}},structure:{privateJwk:{}}};function isPortableDid$1(xt){return!(!xt||typeof xt!="object"||xt===null)&&"uri"in xt&&"document"in xt&&"metadata"in xt&&(!("keyManager"in xt)||xt.keyManager===void 0)}var __awaiter$1p=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$n=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const TENANT_SEPARATOR$1="^";let DeterministicKeyGenerator$1=class extends LocalKeyManager$3{constructor(){super(),this._predefinedKeys=new Map,this._keyGenerator=this._predefinedKeys.keys()}addPredefinedKeys({privateKeys:e}){var At;return __awaiter$1p(this,void 0,void 0,function*(){const kt={};for(const Bt of e){(At=Bt.kid)!==null&&At!==void 0||(Bt.kid=yield computeJwkThumbprint$1({jwk:Bt}));const Nt=yield this.getKeyUri({key:Bt});kt[Nt]=Bt}this._predefinedKeys=new Map(Object.entries(kt)),this._keyGenerator=this._predefinedKeys.keys()})}exportKey({keyUri:e}){return __awaiter$1p(this,void 0,void 0,function*(){const At=this._predefinedKeys.get(e);if(!At)throw new Error(`DeterministicKeyGenerator.exportKey: Key not found: ${e}`);return At})}generateKey(e){return __awaiter$1p(this,void 0,void 0,function*(){const{value:At,done:kt}=this._keyGenerator.next();if(kt)throw new Error("Ran out of predefined keys");return At})}getPublicKey({keyUri:e}){return __awaiter$1p(this,void 0,void 0,function*(){const At=this._predefinedKeys.get(e);if(!At)throw new Error(`DeterministicKeyGenerator.getPublicKey: Key not found: ${e}`);return __rest$n(At,["d"])})}sign({keyUri:e,data:At}){return __awaiter$1p(this,void 0,void 0,function*(){const kt=this._predefinedKeys.get(e);if(!kt)throw new Error(`DeterministicKeyGenerator.sign: Key not found: ${e}`);return yield Ed25519$1.sign({data:At,key:kt})})}};function getDataStoreTenant$1({agent:xt,tenant:e,didUri:At}){return __awaiter$1p(this,void 0,void 0,function*(){if(e)return e;if(xt.agentDid)return xt.agentDid.uri;if(!At)throw new Error("Failed to determine tenant DID: 'agent.agentDid', 'tenant', and 'didUri' are undefined");return At})}var __awaiter$1o=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DwnDataStore$1=class{constructor(){this.name="DwnDataStore",this._cache=new TtlCache({ttl:ms$1("15 minutes"),max:100}),this._index=new TtlCache({ttl:ms$1("21 days"),max:1e3}),this._protocolInitializedCache=new TtlCache({ttl:ms$1("21 days"),max:1e3}),this._recordProperties={dataFormat:"application/json"}}delete({id:e,agent:At,tenant:kt}){return __awaiter$1o(this,void 0,void 0,function*(){const Bt=yield getDataStoreTenant$1({agent:At,tenant:kt,didUri:e});let Nt=yield this.lookupRecordId({id:e,tenantDid:Bt,agent:At});if(!Nt)return!1;const{reply:{status:jt}}=yield At.dwn.processRequest({author:Bt,target:Bt,messageType:DwnInterface$1.RecordsDelete,messageParams:{recordId:Nt}});if(jt.code===202)return this._index.delete(`${Bt}${TENANT_SEPARATOR$1}${e}`),this._cache.delete(Nt),!0;throw new Error(`${this.name}: Failed to delete '${e}' from store: (${jt.code}) ${jt.detail}`)})}get({id:e,agent:At,tenant:kt,useCache:Bt=!1}){return __awaiter$1o(this,void 0,void 0,function*(){const Nt=yield getDataStoreTenant$1({agent:At,tenant:kt,didUri:e});let jt=yield this.lookupRecordId({id:e,tenantDid:Nt,agent:At});if(jt)return yield this.getRecord({recordId:jt,tenantDid:Nt,agent:At,useCache:Bt})})}list({agent:e,tenant:At}){return __awaiter$1o(this,void 0,void 0,function*(){const kt=yield getDataStoreTenant$1({tenant:At,agent:e});return yield this.getAllRecords({agent:e,tenantDid:kt})})}set({id:e,data:At,tenant:kt,agent:Bt,preventDuplicates:Nt=!0,useCache:jt=!1}){return __awaiter$1o(this,void 0,void 0,function*(){const Lt=yield getDataStoreTenant$1({agent:Bt,tenant:kt,didUri:e});if(yield this.initialize({tenant:Lt,agent:Bt}),Nt&&(yield this.lookupRecordId({id:e,tenantDid:Lt,agent:Bt})))throw new Error(`${this.name}: Import failed due to duplicate entry for: ${e}`);const er=Convert.object(At).toUint8Array(),{message:tr,reply:{status:zt}}=yield Bt.dwn.processRequest({author:Lt,target:Lt,messageType:DwnInterface$1.RecordsWrite,messageParams:Object.assign({},this._recordProperties),dataStream:new Blob([er],{type:"application/json"})});if(!(tr&&zt.code===202))throw new Error(`${this.name}: Failed to write data to store for ${e}: ${zt.detail}`);this._index.set(`${Lt}${TENANT_SEPARATOR$1}${e}`,tr.recordId),jt&&this._cache.set(tr.recordId,At)})}initialize({tenant:e,agent:At}){return __awaiter$1o(this,void 0,void 0,function*(){const kt=yield getDataStoreTenant$1({agent:At,tenant:e});if(this._protocolInitializedCache.has(kt))return;const{reply:{status:Bt,entries:Nt}}=yield At.dwn.processRequest({author:kt,target:kt,messageType:DwnInterface$1.ProtocolsQuery,messageParams:{filter:{protocol:this._recordProtocolDefinition.protocol}}});if(Bt.code!==200)throw new Error(`Failed to query for protocols: ${Bt.code} - ${Bt.detail}`);(Nt==null?void 0:Nt.length)===0&&(yield this.installProtocol(kt,At)),this._protocolInitializedCache.set(kt,!0)})}getAllRecords(e){return __awaiter$1o(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DwnDataStore must implement getAllRecords()")})}getRecord({recordId:e,tenantDid:At,agent:kt,useCache:Bt}){var Nt;return __awaiter$1o(this,void 0,void 0,function*(){if(Bt){const er=this._cache.get(e);if(er)return er}const{reply:jt}=yield kt.dwn.processRequest({author:At,target:At,messageType:DwnInterface$1.RecordsRead,messageParams:{filter:{recordId:e}}});if(!(!((Nt=jt.record)===null||Nt===void 0)&&Nt.data))throw new Error(`${this.name}: Failed to read data from DWN for: ${e}`);const Lt=yield NodeStream.consumeToJson({readable:jt.record.data});return Bt&&this._cache.set(e,Lt),Lt})}installProtocol(e,At){return __awaiter$1o(this,void 0,void 0,function*(){const{reply:{status:kt}}=yield At.dwn.processRequest({author:e,target:e,messageType:DwnInterface$1.ProtocolsConfigure,messageParams:{definition:this._recordProtocolDefinition}});if(kt.code!==202)throw new Error(`Failed to install protocol: ${kt.code} - ${kt.detail}`)})}lookupRecordId({id:e,tenantDid:At,agent:kt}){return __awaiter$1o(this,void 0,void 0,function*(){let Bt=this._index.get(`${At}${TENANT_SEPARATOR$1}${e}`,{updateAgeOnGet:!0});return Bt||(yield this.getAllRecords({agent:kt,tenantDid:At}),Bt=this._index.get(`${At}${TENANT_SEPARATOR$1}${e}`)),Bt})}},InMemoryDataStore$1=class{constructor(){this.name="InMemoryDataStore",this.store=new Map}delete({id:e,agent:At,tenant:kt}){return __awaiter$1o(this,void 0,void 0,function*(){const Bt=yield getDataStoreTenant$1({agent:At,tenant:kt,didUri:e});return this.store.has(`${Bt}${TENANT_SEPARATOR$1}${e}`)?(this.store.delete(`${Bt}${TENANT_SEPARATOR$1}${e}`),!0):!1})}get({id:e,agent:At,tenant:kt}){return __awaiter$1o(this,void 0,void 0,function*(){const Bt=yield getDataStoreTenant$1({agent:At,tenant:kt,didUri:e});return this.store.get(`${Bt}${TENANT_SEPARATOR$1}${e}`)})}list({agent:e,tenant:At}){return __awaiter$1o(this,void 0,void 0,function*(){const kt=yield getDataStoreTenant$1({tenant:At,agent:e}),Bt=[];for(const[Nt,jt]of this.store.entries())Nt.startsWith(`${kt}${TENANT_SEPARATOR$1}`)&&Bt.push(jt);return Bt})}set({id:e,data:At,tenant:kt,agent:Bt,preventDuplicates:Nt}){return __awaiter$1o(this,void 0,void 0,function*(){const jt=yield getDataStoreTenant$1({agent:Bt,tenant:kt,didUri:e});if(Nt&&this.store.has(`${jt}${TENANT_SEPARATOR$1}${e}`))throw new Error(`${this.name}: Import failed due to duplicate entry for: ${e}`);const Lt=structuredClone(At);this.store.set(`${jt}${TENANT_SEPARATOR$1}${e}`,Lt)})}};var __awaiter$1n=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DwnDidStore$1=class extends DwnDataStore$1{constructor(){super(...arguments),this.name="DwnDidStore",this._recordProtocolDefinition=IdentityProtocolDefinition$1,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"portableDid",schema:this._recordProtocolDefinition.types.portableDid.schema}}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$1n(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$1n(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$1n(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$1n(this,void 0,void 0,function*(){return yield At.set.call(this,e)})}getAllRecords({agent:e,tenantDid:At}){var kt;return __awaiter$1n(this,void 0,void 0,function*(){this._index.clear();const{reply:Bt}=yield e.dwn.processRequest({author:At,target:At,messageType:DwnInterface$1.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let Nt=[];for(const jt of(kt=Bt.entries)!==null&&kt!==void 0?kt:[]){if(!jt.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const Lt=Convert.base64Url(jt.encodedData).toObject();if(isPortableDid$1(Lt)){const er=`${At}${TENANT_SEPARATOR$1}${Lt.uri}`;this._index.set(er,jt.recordId),this._cache.set(jt.recordId,Lt),Nt.push(Lt)}}return Nt})}},InMemoryDidStore$1=class extends InMemoryDataStore$1{constructor(){super(...arguments),this.name="InMemoryDidStore"}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$1n(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$1n(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$1n(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$1n(this,void 0,void 0,function*(){return yield At.set.call(this,e)})}};var __awaiter$1m=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},DidInterface$1;(function(xt){xt.Create="Create",xt.Resolve="Resolve"})(DidInterface$1||(DidInterface$1={}));function isDidRequest$1(xt,e){return xt.messageType===e}let AgentDidApi$1=class extends UniversalResolver{constructor({agent:e,didMethods:At,resolverCache:kt,store:Bt}){if(!At)throw new TypeError("AgentDidApi: Required parameter missing: 'didMethods'");super({didResolvers:At,cache:kt??new AgentDidResolverCache$1({agent:e,location:"DATA/AGENT/DID_CACHE"})}),this._didMethods=new Map,this._agent=e,this._store=Bt??new InMemoryDidStore$1;for(const Nt of At)this._didMethods.set(Nt.methodName,Nt)}get agent(){if(this._agent===void 0)throw new Error("AgentDidApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,"agent"in this.cache&&(this.cache.agent=e)}create({method:e,tenant:At,options:kt,store:Bt}){return __awaiter$1m(this,void 0,void 0,function*(){const jt=yield this.getMethod(e).create({keyManager:this.agent.keyManager,options:kt});if(Bt??!0){const{uri:Lt,document:er,metadata:tr}=jt,zt={uri:Lt,document:er,metadata:tr};yield this._store.set({id:zt.uri,data:zt,agent:this.agent,tenant:At??zt.uri,preventDuplicates:!1,useCache:!0})}return jt})}export({didUri:e,tenant:At}){return __awaiter$1m(this,void 0,void 0,function*(){const kt=yield this.get({didUri:e,tenant:At});if(!kt)throw new Error(`AgentDidApi: Failed to export due to DID not found: ${e}`);return yield kt.export()})}get({didUri:e,tenant:At}){return __awaiter$1m(this,void 0,void 0,function*(){const kt=yield this._store.get({id:e,agent:this.agent,tenant:At,useCache:!0});return kt?yield BearerDid$1.import({portableDid:kt,keyManager:this.agent.keyManager}):void 0})}getSigningMethod({didUri:e,methodId:At}){return __awaiter$1m(this,void 0,void 0,function*(){const kt=Did$1.parse(e);if(!kt)throw new Error(`Invalid DID URI: ${e}`);const Bt=this.getMethod(kt.method),{didDocument:Nt,didResolutionMetadata:jt}=yield this.resolve(e);if(!Nt)throw new Error(`DID resolution failed for '${e}': ${JSON.stringify(jt)}`);return yield Bt.getSigningMethod({didDocument:Nt,methodId:At})})}import({portableDid:e,tenant:At}){return __awaiter$1m(this,void 0,void 0,function*(){const kt=yield BearerDid$1.import({keyManager:this.agent.keyManager,portableDid:e}),{uri:Bt,document:Nt,metadata:jt}=kt,Lt={uri:Bt,document:Nt,metadata:jt};return yield this._store.set({id:Lt.uri,data:Lt,agent:this.agent,tenant:At??Lt.uri,preventDuplicates:!0,useCache:!0}),kt})}delete({didUri:e,tenant:At,deleteKey:kt=!0}){return __awaiter$1m(this,void 0,void 0,function*(){const Bt=yield this._store.get({id:e,agent:this.agent,tenant:At,useCache:!1});if(!Bt)throw new Error("AgentDidApi: Could not delete, DID not found");yield this._store.delete({id:e,agent:this.agent,tenant:At}),kt&&(yield this.deleteKeys({portableDid:Bt}))})}deleteKeys({portableDid:e}){return __awaiter$1m(this,void 0,void 0,function*(){for(const At of e.document.verificationMethod||[]){if(!At.publicKeyJwk)continue;const kt=yield this.agent.keyManager.getKeyUri({key:At.publicKeyJwk});yield this.agent.keyManager.deleteKey({keyUri:kt})}})}processRequest(e){var At;return __awaiter$1m(this,void 0,void 0,function*(){if(isDidRequest$1(e,DidInterface$1.Create))try{const kt=yield this.create(Object.assign({},e.messageParams));return{result:{uri:kt.uri,document:kt.document,metadata:kt.metadata},ok:!0,status:{code:201,message:"Created"}}}catch(kt){return{ok:!1,status:{code:500,message:(At=kt.message)!==null&&At!==void 0?At:"Unknown error occurred"}}}if(isDidRequest$1(e,DidInterface$1.Resolve)){const{didUri:kt,options:Bt}=e.messageParams;return{result:yield this.resolve(kt,Bt),ok:!0,status:{code:200,message:"OK"}}}throw new Error(`AgentDidApi: Unsupported request type: ${e.messageType}`)})}getMethod(e){const At=this._didMethods.get(e);if(At===void 0)throw new Error(`DID Method not supported: ${e}`);return At}};var lib={};Object.defineProperty(lib,"__esModule",{value:!0});var ReadableWebToNodeStream_1=lib.ReadableWebToNodeStream=void 0;const readable_stream_1=readableBrowserExports$1;class ReadableWebToNodeStream extends readable_stream_1.Readable{constructor(e){super(),this.bytesRead=0,this.released=!1,this.reader=e.getReader()}async _read(){if(this.released){this.push(null);return}this.pendingRead=this.reader.read();const e=await this.pendingRead;delete this.pendingRead,e.done||this.released?this.push(null):(this.bytesRead+=e.value.length,this.push(e.value))}async waitForReadToComplete(){this.pendingRead&&await this.pendingRead}async close(){await this.syncAndRelease()}async syncAndRelease(){this.released=!0,await this.waitForReadToComplete(),await this.reader.releaseLock()}}ReadableWebToNodeStream_1=lib.ReadableWebToNodeStream=ReadableWebToNodeStream;var __awaiter$1l=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function blobToIsomorphicNodeReadable$1(xt){return webReadableToIsomorphicNodeReadable$1(xt.stream())}function getDwnServiceEndpointUrls$1(xt,e){return __awaiter$1l(this,void 0,void 0,function*(){const At=yield e.dereference(`${xt}#dwn`);if(At.dereferencingMetadata.error)throw new Error(`Failed to dereference '${xt}#dwn': ${At.dereferencingMetadata.error}`);if(isDwnDidService(At.contentStream)){const{serviceEndpoint:kt}=At.contentStream,Bt=typeof kt=="string"?[kt]:Array.isArray(kt)&&kt.every(Nt=>typeof Nt=="string")?kt:[];if(Bt.length>0)return Bt}return[]})}function getRecordAuthor(xt){return Message.getAuthor(xt)}function isRecordsWrite$1(xt){return!xt||typeof xt!="object"||xt===null?!1:"message"in xt&&typeof xt.message=="object"&&xt.message!==null&&"descriptor"in xt.message&&typeof xt.message.descriptor=="object"&&xt.message.descriptor!==null&&"interface"in xt.message.descriptor&&xt.message.descriptor.interface===DwnInterfaceName.Records&&"method"in xt.message.descriptor&&xt.message.descriptor.method===DwnMethodName.Write}function getRecordMessageCid(xt){return Message.getCid(xt)}function getPaginationCursor(xt,e){return __awaiter$1l(this,void 0,void 0,function*(){const At=e===DateSort.CreatedAscending||e===DateSort.CreatedDescending?xt.descriptor.dateCreated:xt.descriptor.datePublished;if(At===void 0)throw new Error("The dateCreated or datePublished property is missing from the record descriptor.");return{messageCid:yield getRecordMessageCid(xt),value:At}})}function webReadableToIsomorphicNodeReadable$1(xt){return new ReadableWebToNodeStream_1(xt)}function pollWithTtl$1(xt,e=3e3,At=3e5,kt){const Bt=Date.now()+At;let Nt=null,jt=!0;return new Promise((Lt,er)=>{function tr(){return __awaiter$1l(this,void 0,void 0,function*(){if(!jt)return;const zt=Bt-Date.now();if(zt<=0){jt=!1,console.log("Polling stopped: TTL reached"),Lt(null);return}console.log(`Polling... (Remaining time: ${Math.ceil(zt/1e3)}s)`);try{const rr=yield xt();if(rr.ok){jt=!1,Nt!==null&&clearTimeout(Nt),console.log("Polling stopped: Success condition met"),Lt(rr);return}}catch(rr){console.error("Error fetching data:",rr),er(rr)}jt&&(Nt=setTimeout(tr,e))})}tr()})}function concatenateUrl$1(xt,e){return xt.endsWith("/")&&(xt=xt.slice(0,-1)),e.startsWith("/")&&(e=e.slice(1)),`${xt}/${e}`}var __awaiter$1k=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function isDwnRequest$1(xt,e){return xt.messageType===e}function isDwnMessage(xt,e){return e.descriptor.interface+e.descriptor.method===xt}function isRecordsType$1(xt){return xt===DwnInterface$1.RecordsDelete||xt===DwnInterface$1.RecordsQuery||xt===DwnInterface$1.RecordsRead||xt===DwnInterface$1.RecordsSubscribe||xt===DwnInterface$1.RecordsWrite}function isRecordPermissionScope$1(xt){return xt.interface===DwnInterfaceName.Records}let AgentDwnApi$1=class{constructor({agent:e,dwn:At}){this._agent=e,this._dwn=At}get agent(){if(this._agent===void 0)throw new Error("AgentDwnApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}get node(){return this._dwn}static createDwn({dataPath:e,dataStore:At,didResolver:kt,eventLog:Bt,eventStream:Nt,messageStore:jt,tenantGate:Lt,resumableTaskStore:er}){return __awaiter$1k(this,void 0,void 0,function*(){return At??(At=new DataStoreLevel({blockstoreLocation:`${e}/DWN_DATASTORE`})),kt??(kt=new UniversalResolver({didResolvers:[DidDht$1,DidJwk$1],cache:new DidResolverCacheLevel({location:`${e}/DID_RESOLVERCACHE`})})),Bt??(Bt=new EventLogLevel({location:`${e}/DWN_EVENTLOG`})),jt??(jt=new MessageStoreLevel({blockstoreLocation:`${e}/DWN_MESSAGESTORE`,indexLocation:`${e}/DWN_MESSAGEINDEX`})),er??(er=new ResumableTaskStoreLevel({location:`${e}/DWN_RESUMABLETASKSTORE`})),yield Dwn.create({dataStore:At,didResolver:kt,eventLog:Bt,eventStream:Nt,messageStore:jt,tenantGate:Lt,resumableTaskStore:er})})}processRequest(e){return __awaiter$1k(this,void 0,void 0,function*(){const{message:At,dataStream:kt}=yield this.constructDwnMessage({request:e}),{subscriptionHandler:Bt}=e;return{reply:e.store!==!1?yield this._dwn.processMessage(e.target,At,{dataStream:kt,subscriptionHandler:Bt}):{status:{code:202,detail:"Accepted"}},message:At,messageCid:yield Message.getCid(At)}})}sendRequest(e){return __awaiter$1k(this,void 0,void 0,function*(){const At=yield getDwnServiceEndpointUrls$1(e.target,this.agent.did);if(At.length===0)throw new Error(`AgentDwnApi: DID Service is missing or malformed: ${e.target}#dwn`);let kt,Bt,Nt,jt;if("messageCid"in e)({message:Bt,data:Nt}=yield this.getDwnMessage({author:e.author,messageCid:e.messageCid,messageType:e.messageType})),kt=e.messageCid;else{if({message:Bt}=yield this.constructDwnMessage({request:e}),e.dataStream&&!(e.dataStream instanceof Blob))throw new Error("AgentDwnApi: DataStream must be provided as a Blob");Nt=e.dataStream,jt=e.subscriptionHandler}const Lt=yield this.sendDwnRpcRequest({targetDid:e.target,dwnEndpointUrls:At,message:Bt,data:Nt,subscriptionHandler:jt});return kt??(kt=yield Message.getCid(Bt)),{reply:Lt,message:Bt,messageCid:kt}})}sendDwnRpcRequest({targetDid:e,dwnEndpointUrls:At,message:kt,data:Bt,subscriptionHandler:Nt}){return __awaiter$1k(this,void 0,void 0,function*(){const jt=[];if(kt.descriptor.method===DwnMethodName.Subscribe&&Nt===void 0)throw new Error("AgentDwnApi: Subscription handler is required for subscription requests.");for(let Lt of At)try{if(Nt!==void 0){if(!(yield this.agent.rpc.getServerInfo(Lt)).webSocketSupport){jt.push({url:Lt,message:"WebSocket support is not enabled on the server."});continue}const zt=new URL(Lt);zt.protocol=zt.protocol==="http:"?"ws:":"wss:",Lt=zt.toString()}return yield this.agent.rpc.sendDwnRequest({dwnUrl:Lt,targetDid:e,message:kt,data:Bt,subscriptionHandler:Nt})}catch(er){jt.push({url:Lt,message:er instanceof Error?er.message:"Unknown error"})}throw new Error(`Failed to send DWN RPC request: ${JSON.stringify(jt)}`)})}constructDwnMessage({request:e}){var At;return __awaiter$1k(this,void 0,void 0,function*(){if(e.granteeDid&&!this.hasGrantParams(e.messageParams))throw new Error("AgentDwnApi: Requested to sign with a permission but no grant messageParams were provided in the request");const kt=e.rawMessage;let Bt;if(isDwnRequest$1(e,DwnInterface$1.RecordsWrite)){const Lt=e.messageParams;if(e.dataStream&&!(Lt!=null&&Lt.data)){const{dataStream:er}=e;let tr;if(er instanceof Blob)tr=blobToIsomorphicNodeReadable$1(er),Bt=blobToIsomorphicNodeReadable$1(er);else if(er instanceof ReadableStream){const[zt,rr]=er.tee();tr=webReadableToIsomorphicNodeReadable$1(zt),Bt=webReadableToIsomorphicNodeReadable$1(rr)}kt||(Lt.dataCid=yield Cid.computeDagPbCidFromStream(tr),(At=Lt.dataSize)!==null&&At!==void 0||(Lt.dataSize=tr.bytesRead))}}let Nt;const jt=dwnMessageConstructors$1[e.messageType];if(kt){if(Nt=yield jt.parse(kt),isRecordsWrite$1(Nt)&&e.signAsOwner){const Lt=yield this.getSigner(e.author);yield Nt.signAsOwner(Lt)}else if(e.granteeDid&&isRecordsWrite$1(Nt)&&e.signAsOwnerDelegate){const Lt=yield this.getSigner(e.granteeDid),er=e.messageParams;yield Nt.signAsOwnerDelegate(Lt,er.delegatedGrant)}}else{const Lt=e.granteeDid?yield this.getSigner(e.granteeDid):yield this.getSigner(e.author);Nt=yield jt.create(Object.assign(Object.assign({},e.messageParams),{signer:Lt}))}return{message:Nt.message,dataStream:Bt}})}hasGrantParams(e){return e!==void 0&&("permissionGrantId"in e&&e.permissionGrantId!==void 0||"delegatedGrant"in e&&e.delegatedGrant!==void 0)}getSigner(e){return __awaiter$1k(this,void 0,void 0,function*(){if(e===this.agent.agentDid.uri){const At=yield this.agent.agentDid.getSigner();return{algorithm:At.algorithm,keyId:At.keyId,sign:kt=>__awaiter$1k(this,void 0,void 0,function*(){return yield At.sign({data:kt})})}}else try{const At=yield this.agent.did.getSigningMethod({didUri:e});if(!At.publicKeyJwk)throw new Error(`Verification method '${At.id}' does not contain a public key in JWK format`);const kt=yield this.agent.keyManager.getKeyUri({key:At.publicKeyJwk}),Bt=yield this.agent.keyManager.getPublicKey({keyUri:kt}),Nt=this.agent.keyManager;return{algorithm:CryptoUtils.getJoseSignatureAlgorithmFromPublicKey(Bt),keyId:At.id,sign:jt=>__awaiter$1k(this,void 0,void 0,function*(){return yield Nt.sign({data:jt,keyUri:kt})})}}catch(At){throw new Error(`AgentDwnApi: Unable to get signer for author '${e}': ${At.message}`)}})}getDwnMessage({author:e,messageCid:At}){return __awaiter$1k(this,void 0,void 0,function*(){const kt=yield this.getSigner(e),Bt=yield dwnMessageConstructors$1[DwnInterface$1.MessagesRead].create({messageCid:At,signer:kt}),Nt=yield this._dwn.processMessage(e,Bt.message);if(Nt.status.code!==200)throw new Error(`AgentDwnApi: Failed to read message, response status: ${Nt.status.code} - ${Nt.status.detail}`);const jt=Nt.entry;let er={message:jt.message};if(isRecordsWrite$1(jt)&&jt.data){const tr=yield NodeStream.consumeToBytes({readable:jt.data});er.data=new Blob([tr],{type:jt.message.descriptor.dataFormat})}return er})}};var __awaiter$1j=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class DwnRegistrar{static registerTenant(e,At){return __awaiter$1j(this,void 0,void 0,function*(){const kt=concatenateUrl$1(e,"registration"),Bt=concatenateUrl$1(kt,"terms-of-service"),Nt=concatenateUrl$1(kt,"proof-of-work"),jt=yield fetch(Bt,{method:"GET"});if(jt.status!==200){const dr=jt.status,ur=jt.statusText,fr=yield jt.text();throw new Error(`Failed fetching terms-of-service: ${dr} ${ur}: ${fr}`)}const Lt=yield jt.text(),er=yield fetch(Nt,{method:"GET"}),{challengeNonce:tr,maximumAllowedHashValue:zt}=yield er.json(),rr={did:At,termsOfServiceHash:yield DwnRegistrar.hashAsHexString(Lt)},nr=yield DwnRegistrar.findQualifiedResponseNonce({challengeNonce:tr,maximumAllowedHashValue:zt,requestData:JSON.stringify(rr)}),ar=yield fetch(kt,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({registrationData:rr,proofOfWork:{challengeNonce:tr,responseNonce:nr}})});if(ar.status!==200){const dr=ar.status,ur=ar.statusText,fr=yield ar.text();throw new Error(`Registration failed: ${dr} ${ur}: ${fr}`)}})}static hashAsHexString(e){return __awaiter$1j(this,void 0,void 0,function*(){const At=yield Sha256$1.digest({data:Convert.string(e).toUint8Array()});return Convert.uint8Array(At).toHex()})}static findQualifiedResponseNonce(e){return __awaiter$1j(this,void 0,void 0,function*(){const At=Date.now(),{maximumAllowedHashValue:kt,challengeNonce:Bt,requestData:Nt}=e,jt=BigInt(`0x${kt}`);let Lt=1,er,tr=!1;do{er=yield this.generateNonce();const zt=yield DwnRegistrar.hashAsHexString(Bt+er+Nt);tr=BigInt(`0x${zt}`)<=jt,Lt++}while(!tr);return console.log(`iterations: ${Lt}, time lapsed: ${Date.now()-At} ms`),er})}static generateNonce(){return __awaiter$1j(this,void 0,void 0,function*(){const e=CryptoUtils.randomBytes(32);return Convert.uint8Array(e).toHex().toUpperCase()})}}const Rho=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),Id=Uint8Array.from({length:16},(xt,e)=>e),Pi=Id.map(xt=>(9*xt+5)%16);let idxL=[Id],idxR=[Pi];for(let xt=0;xt<4;xt++)for(let e of[idxL,idxR])e.push(e[xt].map(At=>Rho[At]));const shifts=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(xt=>new Uint8Array(xt)),shiftsL=idxL.map((xt,e)=>xt.map(At=>shifts[e][At])),shiftsR=idxR.map((xt,e)=>xt.map(At=>shifts[e][At])),Kl=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),Kr=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),rotl=(xt,e)=>xt<<e|xt>>>32-e;function f(xt,e,At,kt){return xt===0?e^At^kt:xt===1?e&At|~e&kt:xt===2?(e|~At)^kt:xt===3?e&kt|At&~kt:e^(At|~kt)}const BUF=new Uint32Array(16);class RIPEMD160 extends SHA2{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:At,h2:kt,h3:Bt,h4:Nt}=this;return[e,At,kt,Bt,Nt]}set(e,At,kt,Bt,Nt){this.h0=e|0,this.h1=At|0,this.h2=kt|0,this.h3=Bt|0,this.h4=Nt|0}process(e,At){for(let ir=0;ir<16;ir++,At+=4)BUF[ir]=e.getUint32(At,!0);let kt=this.h0|0,Bt=kt,Nt=this.h1|0,jt=Nt,Lt=this.h2|0,er=Lt,tr=this.h3|0,zt=tr,rr=this.h4|0,nr=rr;for(let ir=0;ir<5;ir++){const ar=4-ir,dr=Kl[ir],ur=Kr[ir],fr=idxL[ir],pr=idxR[ir],lr=shiftsL[ir],yr=shiftsR[ir];for(let br=0;br<16;br++){const Ar=rotl(kt+f(ir,Nt,Lt,tr)+BUF[fr[br]]+dr,lr[br])+rr|0;kt=rr,rr=tr,tr=rotl(Lt,10)|0,Lt=Nt,Nt=Ar}for(let br=0;br<16;br++){const Ar=rotl(Bt+f(ar,jt,er,zt)+BUF[pr[br]]+ur,yr[br])+nr|0;Bt=nr,nr=zt,zt=rotl(er,10)|0,er=jt,jt=Ar}}this.set(this.h1+Lt+zt|0,this.h2+tr+nr|0,this.h3+rr+Bt|0,this.h4+kt+jt|0,this.h0+Nt+er|0)}roundClean(){BUF.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const ripemd160=wrapConstructor(()=>new RIPEMD160);/*! micro-ed25519-hdkey - MIT License (c) 2022 Paul Miller (paulmillr.com) */const MASTER_SECRET=utf8ToBytes$2("ed25519 seed"),HARDENED_OFFSET=2147483648,ZERO=new Uint8Array([0]);function ensureBytes$1(xt,...e){return typeof xt=="string"&&(xt=hexToBytes$1(xt)),bytes$1(xt,...e),xt}const hash160=xt=>ripemd160(sha256(xt)),fromU32=xt=>createView(xt).getUint32(0,!1),toU32=xt=>{if(!Number.isSafeInteger(xt)||xt<0||xt>2**32-1)throw new Error(`Invalid number=${xt}. Should be from 0 to 2 ** 32 - 1`);const e=new Uint8Array(4);return createView(e).setUint32(0,xt,!1),e};class HDKey{get publicKeyRaw(){return ed25519.getPublicKey(this.privateKey)}get publicKey(){return concatBytes$1(ZERO,this.publicKeyRaw)}get pubHash(){return hash160(this.publicKey)}get fingerprint(){return fromU32(this.pubHash)}get fingerprintHex(){return bytesToHex$1(toU32(this.fingerprint))}get parentFingerprintHex(){return bytesToHex$1(toU32(this.parentFingerprint))}static fromMasterSeed(e){if(e=ensureBytes$1(e),8*e.length<128||8*e.length>512)throw new Error(`HDKey: wrong seed length=${e.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const At=hmac(sha512,MASTER_SECRET,e);return new HDKey({privateKey:At.slice(0,32),chainCode:At.slice(32)})}constructor(e){if(this.depth=0,this.index=0,this.parentFingerprint=0,!e||typeof e!="object")throw new Error("HDKey.constructor must not be called directly");if(bytes$1(e.privateKey,32),bytes$1(e.chainCode,32),this.depth=e.depth||0,this.index=e.index||0,this.parentFingerprint=e.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");this.chainCode=e.chainCode,this.privateKey=e.privateKey}derive(e,At=!1){if(!/^[mM]'?/.test(e))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(e))return this;const kt=e.replace(/^[mM]'?\//,"").split("/");let Bt=this;for(const Nt of kt){const jt=/^(\d+)('?)$/.exec(Nt);if(!jt||jt.length!==3)throw new Error(`Invalid child index: ${Nt}`);let Lt=+jt[1];if(!Number.isSafeInteger(Lt)||Lt>=HARDENED_OFFSET)throw new Error("Invalid index");(At||jt[2]==="'")&&(Lt+=HARDENED_OFFSET),Bt=Bt.deriveChild(Lt)}return Bt}deriveChild(e){if(e<HARDENED_OFFSET)throw new Error(`Non-hardened child derivation not possible for Ed25519 (index=${e})`);const At=concatBytes$1(ZERO,this.privateKey,toU32(e)),kt=hmac(sha512,this.chainCode,At);return new HDKey({chainCode:kt.slice(32),depth:this.depth+1,parentFingerprint:this.fingerprint,index:e,privateKey:kt.slice(0,32)})}sign(e){return ed25519.sign(e,this.privateKey)}verify(e,At){return At=ensureBytes$1(At,64),ed25519.verify(At,e,this.publicKeyRaw)}}const wordlist=`abandon
ability
able
about
above
absent
absorb
abstract
absurd
abuse
access
accident
account
accuse
achieve
acid
acoustic
acquire
across
act
action
actor
actress
actual
adapt
add
addict
address
adjust
admit
adult
advance
advice
aerobic
affair
afford
afraid
again
age
agent
agree
ahead
aim
air
airport
aisle
alarm
album
alcohol
alert
alien
all
alley
allow
almost
alone
alpha
already
also
alter
always
amateur
amazing
among
amount
amused
analyst
anchor
ancient
anger
angle
angry
animal
ankle
announce
annual
another
answer
antenna
antique
anxiety
any
apart
apology
appear
apple
approve
april
arch
arctic
area
arena
argue
arm
armed
armor
army
around
arrange
arrest
arrive
arrow
art
artefact
artist
artwork
ask
aspect
assault
asset
assist
assume
asthma
athlete
atom
attack
attend
attitude
attract
auction
audit
august
aunt
author
auto
autumn
average
avocado
avoid
awake
aware
away
awesome
awful
awkward
axis
baby
bachelor
bacon
badge
bag
balance
balcony
ball
bamboo
banana
banner
bar
barely
bargain
barrel
base
basic
basket
battle
beach
bean
beauty
because
become
beef
before
begin
behave
behind
believe
below
belt
bench
benefit
best
betray
better
between
beyond
bicycle
bid
bike
bind
biology
bird
birth
bitter
black
blade
blame
blanket
blast
bleak
bless
blind
blood
blossom
blouse
blue
blur
blush
board
boat
body
boil
bomb
bone
bonus
book
boost
border
boring
borrow
boss
bottom
bounce
box
boy
bracket
brain
brand
brass
brave
bread
breeze
brick
bridge
brief
bright
bring
brisk
broccoli
broken
bronze
broom
brother
brown
brush
bubble
buddy
budget
buffalo
build
bulb
bulk
bullet
bundle
bunker
burden
burger
burst
bus
business
busy
butter
buyer
buzz
cabbage
cabin
cable
cactus
cage
cake
call
calm
camera
camp
can
canal
cancel
candy
cannon
canoe
canvas
canyon
capable
capital
captain
car
carbon
card
cargo
carpet
carry
cart
case
cash
casino
castle
casual
cat
catalog
catch
category
cattle
caught
cause
caution
cave
ceiling
celery
cement
census
century
cereal
certain
chair
chalk
champion
change
chaos
chapter
charge
chase
chat
cheap
check
cheese
chef
cherry
chest
chicken
chief
child
chimney
choice
choose
chronic
chuckle
chunk
churn
cigar
cinnamon
circle
citizen
city
civil
claim
clap
clarify
claw
clay
clean
clerk
clever
click
client
cliff
climb
clinic
clip
clock
clog
close
cloth
cloud
clown
club
clump
cluster
clutch
coach
coast
coconut
code
coffee
coil
coin
collect
color
column
combine
come
comfort
comic
common
company
concert
conduct
confirm
congress
connect
consider
control
convince
cook
cool
copper
copy
coral
core
corn
correct
cost
cotton
couch
country
couple
course
cousin
cover
coyote
crack
cradle
craft
cram
crane
crash
crater
crawl
crazy
cream
credit
creek
crew
cricket
crime
crisp
critic
crop
cross
crouch
crowd
crucial
cruel
cruise
crumble
crunch
crush
cry
crystal
cube
culture
cup
cupboard
curious
current
curtain
curve
cushion
custom
cute
cycle
dad
damage
damp
dance
danger
daring
dash
daughter
dawn
day
deal
debate
debris
decade
december
decide
decline
decorate
decrease
deer
defense
define
defy
degree
delay
deliver
demand
demise
denial
dentist
deny
depart
depend
deposit
depth
deputy
derive
describe
desert
design
desk
despair
destroy
detail
detect
develop
device
devote
diagram
dial
diamond
diary
dice
diesel
diet
differ
digital
dignity
dilemma
dinner
dinosaur
direct
dirt
disagree
discover
disease
dish
dismiss
disorder
display
distance
divert
divide
divorce
dizzy
doctor
document
dog
doll
dolphin
domain
donate
donkey
donor
door
dose
double
dove
draft
dragon
drama
drastic
draw
dream
dress
drift
drill
drink
drip
drive
drop
drum
dry
duck
dumb
dune
during
dust
dutch
duty
dwarf
dynamic
eager
eagle
early
earn
earth
easily
east
easy
echo
ecology
economy
edge
edit
educate
effort
egg
eight
either
elbow
elder
electric
elegant
element
elephant
elevator
elite
else
embark
embody
embrace
emerge
emotion
employ
empower
empty
enable
enact
end
endless
endorse
enemy
energy
enforce
engage
engine
enhance
enjoy
enlist
enough
enrich
enroll
ensure
enter
entire
entry
envelope
episode
equal
equip
era
erase
erode
erosion
error
erupt
escape
essay
essence
estate
eternal
ethics
evidence
evil
evoke
evolve
exact
example
excess
exchange
excite
exclude
excuse
execute
exercise
exhaust
exhibit
exile
exist
exit
exotic
expand
expect
expire
explain
expose
express
extend
extra
eye
eyebrow
fabric
face
faculty
fade
faint
faith
fall
false
fame
family
famous
fan
fancy
fantasy
farm
fashion
fat
fatal
father
fatigue
fault
favorite
feature
february
federal
fee
feed
feel
female
fence
festival
fetch
fever
few
fiber
fiction
field
figure
file
film
filter
final
find
fine
finger
finish
fire
firm
first
fiscal
fish
fit
fitness
fix
flag
flame
flash
flat
flavor
flee
flight
flip
float
flock
floor
flower
fluid
flush
fly
foam
focus
fog
foil
fold
follow
food
foot
force
forest
forget
fork
fortune
forum
forward
fossil
foster
found
fox
fragile
frame
frequent
fresh
friend
fringe
frog
front
frost
frown
frozen
fruit
fuel
fun
funny
furnace
fury
future
gadget
gain
galaxy
gallery
game
gap
garage
garbage
garden
garlic
garment
gas
gasp
gate
gather
gauge
gaze
general
genius
genre
gentle
genuine
gesture
ghost
giant
gift
giggle
ginger
giraffe
girl
give
glad
glance
glare
glass
glide
glimpse
globe
gloom
glory
glove
glow
glue
goat
goddess
gold
good
goose
gorilla
gospel
gossip
govern
gown
grab
grace
grain
grant
grape
grass
gravity
great
green
grid
grief
grit
grocery
group
grow
grunt
guard
guess
guide
guilt
guitar
gun
gym
habit
hair
half
hammer
hamster
hand
happy
harbor
hard
harsh
harvest
hat
have
hawk
hazard
head
health
heart
heavy
hedgehog
height
hello
helmet
help
hen
hero
hidden
high
hill
hint
hip
hire
history
hobby
hockey
hold
hole
holiday
hollow
home
honey
hood
hope
horn
horror
horse
hospital
host
hotel
hour
hover
hub
huge
human
humble
humor
hundred
hungry
hunt
hurdle
hurry
hurt
husband
hybrid
ice
icon
idea
identify
idle
ignore
ill
illegal
illness
image
imitate
immense
immune
impact
impose
improve
impulse
inch
include
income
increase
index
indicate
indoor
industry
infant
inflict
inform
inhale
inherit
initial
inject
injury
inmate
inner
innocent
input
inquiry
insane
insect
inside
inspire
install
intact
interest
into
invest
invite
involve
iron
island
isolate
issue
item
ivory
jacket
jaguar
jar
jazz
jealous
jeans
jelly
jewel
job
join
joke
journey
joy
judge
juice
jump
jungle
junior
junk
just
kangaroo
keen
keep
ketchup
key
kick
kid
kidney
kind
kingdom
kiss
kit
kitchen
kite
kitten
kiwi
knee
knife
knock
know
lab
label
labor
ladder
lady
lake
lamp
language
laptop
large
later
latin
laugh
laundry
lava
law
lawn
lawsuit
layer
lazy
leader
leaf
learn
leave
lecture
left
leg
legal
legend
leisure
lemon
lend
length
lens
leopard
lesson
letter
level
liar
liberty
library
license
life
lift
light
like
limb
limit
link
lion
liquid
list
little
live
lizard
load
loan
lobster
local
lock
logic
lonely
long
loop
lottery
loud
lounge
love
loyal
lucky
luggage
lumber
lunar
lunch
luxury
lyrics
machine
mad
magic
magnet
maid
mail
main
major
make
mammal
man
manage
mandate
mango
mansion
manual
maple
marble
march
margin
marine
market
marriage
mask
mass
master
match
material
math
matrix
matter
maximum
maze
meadow
mean
measure
meat
mechanic
medal
media
melody
melt
member
memory
mention
menu
mercy
merge
merit
merry
mesh
message
metal
method
middle
midnight
milk
million
mimic
mind
minimum
minor
minute
miracle
mirror
misery
miss
mistake
mix
mixed
mixture
mobile
model
modify
mom
moment
monitor
monkey
monster
month
moon
moral
more
morning
mosquito
mother
motion
motor
mountain
mouse
move
movie
much
muffin
mule
multiply
muscle
museum
mushroom
music
must
mutual
myself
mystery
myth
naive
name
napkin
narrow
nasty
nation
nature
near
neck
need
negative
neglect
neither
nephew
nerve
nest
net
network
neutral
never
news
next
nice
night
noble
noise
nominee
noodle
normal
north
nose
notable
note
nothing
notice
novel
now
nuclear
number
nurse
nut
oak
obey
object
oblige
obscure
observe
obtain
obvious
occur
ocean
october
odor
off
offer
office
often
oil
okay
old
olive
olympic
omit
once
one
onion
online
only
open
opera
opinion
oppose
option
orange
orbit
orchard
order
ordinary
organ
orient
original
orphan
ostrich
other
outdoor
outer
output
outside
oval
oven
over
own
owner
oxygen
oyster
ozone
pact
paddle
page
pair
palace
palm
panda
panel
panic
panther
paper
parade
parent
park
parrot
party
pass
patch
path
patient
patrol
pattern
pause
pave
payment
peace
peanut
pear
peasant
pelican
pen
penalty
pencil
people
pepper
perfect
permit
person
pet
phone
photo
phrase
physical
piano
picnic
picture
piece
pig
pigeon
pill
pilot
pink
pioneer
pipe
pistol
pitch
pizza
place
planet
plastic
plate
play
please
pledge
pluck
plug
plunge
poem
poet
point
polar
pole
police
pond
pony
pool
popular
portion
position
possible
post
potato
pottery
poverty
powder
power
practice
praise
predict
prefer
prepare
present
pretty
prevent
price
pride
primary
print
priority
prison
private
prize
problem
process
produce
profit
program
project
promote
proof
property
prosper
protect
proud
provide
public
pudding
pull
pulp
pulse
pumpkin
punch
pupil
puppy
purchase
purity
purpose
purse
push
put
puzzle
pyramid
quality
quantum
quarter
question
quick
quit
quiz
quote
rabbit
raccoon
race
rack
radar
radio
rail
rain
raise
rally
ramp
ranch
random
range
rapid
rare
rate
rather
raven
raw
razor
ready
real
reason
rebel
rebuild
recall
receive
recipe
record
recycle
reduce
reflect
reform
refuse
region
regret
regular
reject
relax
release
relief
rely
remain
remember
remind
remove
render
renew
rent
reopen
repair
repeat
replace
report
require
rescue
resemble
resist
resource
response
result
retire
retreat
return
reunion
reveal
review
reward
rhythm
rib
ribbon
rice
rich
ride
ridge
rifle
right
rigid
ring
riot
ripple
risk
ritual
rival
river
road
roast
robot
robust
rocket
romance
roof
rookie
room
rose
rotate
rough
round
route
royal
rubber
rude
rug
rule
run
runway
rural
sad
saddle
sadness
safe
sail
salad
salmon
salon
salt
salute
same
sample
sand
satisfy
satoshi
sauce
sausage
save
say
scale
scan
scare
scatter
scene
scheme
school
science
scissors
scorpion
scout
scrap
screen
script
scrub
sea
search
season
seat
second
secret
section
security
seed
seek
segment
select
sell
seminar
senior
sense
sentence
series
service
session
settle
setup
seven
shadow
shaft
shallow
share
shed
shell
sheriff
shield
shift
shine
ship
shiver
shock
shoe
shoot
shop
short
shoulder
shove
shrimp
shrug
shuffle
shy
sibling
sick
side
siege
sight
sign
silent
silk
silly
silver
similar
simple
since
sing
siren
sister
situate
six
size
skate
sketch
ski
skill
skin
skirt
skull
slab
slam
sleep
slender
slice
slide
slight
slim
slogan
slot
slow
slush
small
smart
smile
smoke
smooth
snack
snake
snap
sniff
snow
soap
soccer
social
sock
soda
soft
solar
soldier
solid
solution
solve
someone
song
soon
sorry
sort
soul
sound
soup
source
south
space
spare
spatial
spawn
speak
special
speed
spell
spend
sphere
spice
spider
spike
spin
spirit
split
spoil
sponsor
spoon
sport
spot
spray
spread
spring
spy
square
squeeze
squirrel
stable
stadium
staff
stage
stairs
stamp
stand
start
state
stay
steak
steel
stem
step
stereo
stick
still
sting
stock
stomach
stone
stool
story
stove
strategy
street
strike
strong
struggle
student
stuff
stumble
style
subject
submit
subway
success
such
sudden
suffer
sugar
suggest
suit
summer
sun
sunny
sunset
super
supply
supreme
sure
surface
surge
surprise
surround
survey
suspect
sustain
swallow
swamp
swap
swarm
swear
sweet
swift
swim
swing
switch
sword
symbol
symptom
syrup
system
table
tackle
tag
tail
talent
talk
tank
tape
target
task
taste
tattoo
taxi
teach
team
tell
ten
tenant
tennis
tent
term
test
text
thank
that
theme
then
theory
there
they
thing
this
thought
three
thrive
throw
thumb
thunder
ticket
tide
tiger
tilt
timber
time
tiny
tip
tired
tissue
title
toast
tobacco
today
toddler
toe
together
toilet
token
tomato
tomorrow
tone
tongue
tonight
tool
tooth
top
topic
topple
torch
tornado
tortoise
toss
total
tourist
toward
tower
town
toy
track
trade
traffic
tragic
train
transfer
trap
trash
travel
tray
treat
tree
trend
trial
tribe
trick
trigger
trim
trip
trophy
trouble
truck
true
truly
trumpet
trust
truth
try
tube
tuition
tumble
tuna
tunnel
turkey
turn
turtle
twelve
twenty
twice
twin
twist
two
type
typical
ugly
umbrella
unable
unaware
uncle
uncover
under
undo
unfair
unfold
unhappy
uniform
unique
unit
universe
unknown
unlock
until
unusual
unveil
update
upgrade
uphold
upon
upper
upset
urban
urge
usage
use
used
useful
useless
usual
utility
vacant
vacuum
vague
valid
valley
valve
van
vanish
vapor
various
vast
vault
vehicle
velvet
vendor
venture
venue
verb
verify
version
very
vessel
veteran
viable
vibrant
vicious
victory
video
view
village
vintage
violin
virtual
virus
visa
visit
visual
vital
vivid
vocal
voice
void
volcano
volume
vote
voyage
wage
wagon
wait
walk
wall
walnut
want
warfare
warm
warrior
wash
wasp
waste
water
wave
way
wealth
weapon
wear
weasel
weather
web
wedding
weekend
weird
welcome
west
wet
whale
what
wheat
wheel
when
where
whip
whisper
wide
width
wife
wild
will
win
window
wine
wing
wink
winner
winter
wire
wisdom
wise
wish
witness
wolf
woman
wonder
wood
wool
word
work
world
worry
worth
wrap
wreck
wrestle
wrist
write
wrong
yard
year
yellow
you
young
youth
zebra
zero
zone
zoo`.split(`
`);function pbkdf2Init(xt,e,At,kt){hash(xt);const Bt=checkOpts({dkLen:32,asyncTick:10},kt),{c:Nt,dkLen:jt,asyncTick:Lt}=Bt;if(number(Nt),number(jt),number(Lt),Nt<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const er=toBytes$1(e),tr=toBytes$1(At),zt=new Uint8Array(jt),rr=hmac.create(xt,er),nr=rr._cloneInto().update(tr);return{c:Nt,dkLen:jt,asyncTick:Lt,DK:zt,PRF:rr,PRFSalt:nr}}function pbkdf2Output(xt,e,At,kt,Bt){return xt.destroy(),e.destroy(),kt&&kt.destroy(),Bt.fill(0),At}async function pbkdf2Async(xt,e,At,kt){const{c:Bt,dkLen:Nt,asyncTick:jt,DK:Lt,PRF:er,PRFSalt:tr}=pbkdf2Init(xt,e,At,kt);let zt;const rr=new Uint8Array(4),nr=createView(rr),ir=new Uint8Array(er.outputLen);for(let ar=1,dr=0;dr<Nt;ar++,dr+=er.outputLen){const ur=Lt.subarray(dr,dr+er.outputLen);nr.setInt32(0,ar,!1),(zt=tr._cloneInto(zt)).update(rr).digestInto(ir),ur.set(ir.subarray(0,ur.length)),await asyncLoop(Bt-1,jt,()=>{er._cloneInto(zt).update(ir).digestInto(ir);for(let fr=0;fr<ur.length;fr++)ur[fr]^=ir[fr]})}return pbkdf2Output(er,tr,Lt,zt,ir)}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes$2(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}function chain(...xt){const e=Nt=>Nt,At=(Nt,jt)=>Lt=>Nt(jt(Lt)),kt=xt.map(Nt=>Nt.encode).reduceRight(At,e),Bt=xt.map(Nt=>Nt.decode).reduce(At,e);return{encode:kt,decode:Bt}}function alphabet(xt){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(At=>{if(At<0||At>=xt.length)throw new Error(`Digit index outside alphabet: ${At} (alphabet: ${xt.length})`);return xt[At]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(At=>{if(typeof At!="string")throw new Error(`alphabet.decode: not string element=${At}`);const kt=xt.indexOf(At);if(kt===-1)throw new Error(`Unknown letter: "${At}". Allowed: ${xt}`);return kt})}}}function join(xt=""){if(typeof xt!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let At of e)if(typeof At!="string")throw new Error(`join.encode: non-string input=${At}`);return e.join(xt)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(xt)}}}function padding(xt,e="="){if(typeof e!="string")throw new Error("padding chr should be string");return{encode(At){if(!Array.isArray(At)||At.length&&typeof At[0]!="string")throw new Error("padding.encode input should be array of strings");for(let kt of At)if(typeof kt!="string")throw new Error(`padding.encode: non-string input=${kt}`);for(;At.length*xt%8;)At.push(e);return At},decode(At){if(!Array.isArray(At)||At.length&&typeof At[0]!="string")throw new Error("padding.encode input should be array of strings");for(let Bt of At)if(typeof Bt!="string")throw new Error(`padding.decode: non-string input=${Bt}`);let kt=At.length;if(kt*xt%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;kt>0&&At[kt-1]===e;kt--)if(!((kt-1)*xt%8))throw new Error("Invalid padding: string has too much padding");return At.slice(0,kt)}}}function convertRadix(xt,e,At){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(At<2)throw new Error(`convertRadix: wrong to=${At}, base cannot be less than 2`);if(!Array.isArray(xt))throw new Error("convertRadix: data should be array");if(!xt.length)return[];let kt=0;const Bt=[],Nt=Array.from(xt);for(Nt.forEach(jt=>{if(jt<0||jt>=e)throw new Error(`Wrong integer: ${jt}`)});;){let jt=0,Lt=!0;for(let er=kt;er<Nt.length;er++){const tr=Nt[er],zt=e*jt+tr;if(!Number.isSafeInteger(zt)||e*jt/e!==jt||zt-tr!==e*jt)throw new Error("convertRadix: carry overflow");jt=zt%At;const rr=Math.floor(zt/At);if(Nt[er]=rr,!Number.isSafeInteger(rr)||rr*At+jt!==zt)throw new Error("convertRadix: carry overflow");if(Lt)rr?Lt=!1:kt=er;else continue}if(Bt.push(jt),Lt)break}for(let jt=0;jt<xt.length-1&&xt[jt]===0;jt++)Bt.push(0);return Bt.reverse()}const gcd=(xt,e)=>e?gcd(e,xt%e):xt,radix2carry=(xt,e)=>xt+(e-gcd(xt,e));function convertRadix2(xt,e,At,kt){if(!Array.isArray(xt))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(At<=0||At>32)throw new Error(`convertRadix2: wrong to=${At}`);if(radix2carry(e,At)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${At} carryBits=${radix2carry(e,At)}`);let Bt=0,Nt=0;const jt=2**At-1,Lt=[];for(const er of xt){if(er>=2**e)throw new Error(`convertRadix2: invalid data word=${er} from=${e}`);if(Bt=Bt<<e|er,Nt+e>32)throw new Error(`convertRadix2: carry overflow pos=${Nt} from=${e}`);for(Nt+=e;Nt>=At;Nt-=At)Lt.push((Bt>>Nt-At&jt)>>>0);Bt&=2**Nt-1}if(Bt=Bt<<At-Nt&jt,!kt&&Nt>=e)throw new Error("Excess padding");if(!kt&&Bt)throw new Error(`Non-zero padding: ${Bt}`);return kt&&Nt>0&&Lt.push(Bt>>>0),Lt}function radix(xt){return{encode:e=>{if(!isBytes$2(e))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(e),2**8,xt)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of numbers");return Uint8Array.from(convertRadix(e,xt,2**8))}}}function radix2(xt,e=!1){if(xt<=0||xt>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,xt)>32||radix2carry(xt,8)>32)throw new Error("radix2: carry overflow");return{encode:At=>{if(!isBytes$2(At))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(At),8,xt,!e)},decode:At=>{if(!Array.isArray(At)||At.length&&typeof At[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(convertRadix2(At,xt,8,e))}}}function checksum(xt,e){if(typeof e!="function")throw new Error("checksum fn should be function");return{encode(At){if(!isBytes$2(At))throw new Error("checksum.encode: input should be Uint8Array");const kt=e(At).slice(0,xt),Bt=new Uint8Array(At.length+xt);return Bt.set(At),Bt.set(kt,At.length),Bt},decode(At){if(!isBytes$2(At))throw new Error("checksum.decode: input should be Uint8Array");const kt=At.slice(0,-xt),Bt=e(kt).slice(0,xt),Nt=At.slice(-xt);for(let jt=0;jt<xt;jt++)if(Bt[jt]!==Nt[jt])throw new Error("Invalid checksum");return kt}}}const utils={alphabet,chain,checksum,convertRadix,convertRadix2,radix,radix2,join,padding};/*! scure-bip39 - MIT License (c) 2022 Patricio Palladino, Paul Miller (paulmillr.com) */const isJapanese=xt=>xt[0]==="あいこくしん";function nfkd(xt){if(typeof xt!="string")throw new TypeError(`Invalid mnemonic type: ${typeof xt}`);return xt.normalize("NFKD")}function normalize(xt){const e=nfkd(xt),At=e.split(" ");if(![12,15,18,21,24].includes(At.length))throw new Error("Invalid mnemonic");return{nfkd:e,words:At}}function assertEntropy(xt){bytes$1(xt,16,20,24,28,32)}function generateMnemonic(xt,e=128){if(number(e),e%32!==0||e>256)throw new TypeError("Invalid entropy");return entropyToMnemonic(randomBytes$2(e/8),xt)}const calcChecksum=xt=>{const e=8-xt.length/4;return new Uint8Array([sha256(xt)[0]>>e<<e])};function getCoder(xt){if(!Array.isArray(xt)||xt.length!==2048||typeof xt[0]!="string")throw new Error("Wordlist: expected array of 2048 strings");return xt.forEach(e=>{if(typeof e!="string")throw new Error(`Wordlist: non-string element: ${e}`)}),utils.chain(utils.checksum(1,calcChecksum),utils.radix2(11,!0),utils.alphabet(xt))}function mnemonicToEntropy(xt,e){const{words:At}=normalize(xt),kt=getCoder(e).decode(At);return assertEntropy(kt),kt}function entropyToMnemonic(xt,e){return assertEntropy(xt),getCoder(e).encode(xt).join(isJapanese(e)?"　":" ")}function validateMnemonic(xt,e){try{mnemonicToEntropy(xt,e)}catch{return!1}return!0}const salt=xt=>nfkd(`mnemonic${xt}`);function mnemonicToSeed(xt,e=""){return pbkdf2Async(sha512,normalize(xt).nfkd,salt(e),{c:2048,dkLen:64})}var __awaiter$1i=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DwnKeyStore$1=class extends DwnDataStore$1{constructor(){super(...arguments),this.name="DwnKeyStore",this._recordProtocolDefinition=JwkProtocolDefinition$1,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"privateJwk",schema:this._recordProtocolDefinition.types.privateJwk.schema}}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$1i(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$1i(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$1i(this,void 0,void 0,function*(){yield At.set.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$1i(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}getAllRecords({agent:e,tenantDid:At}){var kt;return __awaiter$1i(this,void 0,void 0,function*(){this._index.clear();const{reply:Bt}=yield e.dwn.processRequest({author:At,target:At,messageType:DwnInterface$1.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let Nt=[];for(const jt of(kt=Bt.entries)!==null&&kt!==void 0?kt:[]){if(!jt.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const Lt=Convert.base64Url(jt.encodedData).toObject();if(isPrivateJwk$1(Lt)){const er=`${At}${TENANT_SEPARATOR$1}${KEY_URI_PREFIX_JWK$1}${Lt.kid}`;this._index.set(er,jt.recordId),this._cache.set(jt.recordId,Lt),Nt.push(Lt)}}return Nt})}},InMemoryKeyStore$1=class extends InMemoryDataStore$1{constructor(){super(...arguments),this.name="InMemoryKeyStore"}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$1i(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$1i(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$1i(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$1i(this,void 0,void 0,function*(){return yield At.set.call(this,e)})}};var __awaiter$1h=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$m=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const supportedAlgorithms$3={"AES-GCM":{implementation:AesGcmAlgorithm$2,names:["A128GCM","A192GCM","A256GCM"]},"AES-KW":{implementation:AesKwAlgorithm$1,names:["A128KW","A192KW","A256KW"]},Ed25519:{implementation:EdDsaAlgorithm$3,names:["Ed25519"]},secp256k1:{implementation:EcdsaAlgorithm$3,names:["ES256K","secp256k1"]},secp256r1:{implementation:EcdsaAlgorithm$3,names:["ES256","secp256r1"]},"SHA-256":{implementation:Sha2Algorithm$1,names:["SHA-256"]}};let LocalKeyManager$2=class{constructor({agent:e,keyStore:At}={}){this._algorithmInstances=new Map,this._agent=e,this._keyStore=At??new InMemoryKeyStore$1}get agent(){if(this._agent===void 0)throw new Error("LocalKeyManager: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}decrypt(e){var{keyUri:At}=e,kt=__rest$m(e,["keyUri"]);return __awaiter$1h(this,void 0,void 0,function*(){const Bt=yield this.getPrivateKey({keyUri:At}),Nt=this.getAlgorithmName({key:Bt});return yield this.getAlgorithm({algorithm:Nt}).decrypt(Object.assign({key:Bt},kt))})}digest(e){throw new Error("Method not implemented.")}encrypt(e){var{keyUri:At}=e,kt=__rest$m(e,["keyUri"]);return __awaiter$1h(this,void 0,void 0,function*(){const Bt=yield this.getPrivateKey({keyUri:At}),Nt=this.getAlgorithmName({key:Bt});return yield this.getAlgorithm({algorithm:Nt}).encrypt(Object.assign({key:Bt},kt))})}exportKey({keyUri:e}){return __awaiter$1h(this,void 0,void 0,function*(){return yield this.getPrivateKey({keyUri:e})})}generateKey({algorithm:e}){var At;return __awaiter$1h(this,void 0,void 0,function*(){const kt=this.getAlgorithmName({key:{alg:e}}),Nt=yield this.getAlgorithm({algorithm:kt}).generateKey({algorithm:e});(At=Nt.kid)!==null&&At!==void 0||(Nt.kid=yield computeJwkThumbprint$1({jwk:Nt}));const jt=yield this.getKeyUri({key:Nt});return yield this._keyStore.set({id:jt,data:Nt,agent:this.agent,preventDuplicates:!1,useCache:!0}),jt})}getKeyUri({key:e}){return __awaiter$1h(this,void 0,void 0,function*(){const At=yield computeJwkThumbprint$1({jwk:e});return`${KEY_URI_PREFIX_JWK$1}${At}`})}getPublicKey({keyUri:e}){return __awaiter$1h(this,void 0,void 0,function*(){const At=yield this.getPrivateKey({keyUri:e}),kt=this.getAlgorithmName({key:At});return yield this.getAlgorithm({algorithm:kt}).getPublicKey({key:At})})}importKey({key:e}){var At;return __awaiter$1h(this,void 0,void 0,function*(){if(!isPrivateJwk$1(e))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const kt=structuredClone(e);(At=kt.kid)!==null&&At!==void 0||(kt.kid=yield computeJwkThumbprint$1({jwk:kt}));const Bt=yield this.getKeyUri({key:kt});return yield this._keyStore.set({id:Bt,data:kt,agent:this.agent,preventDuplicates:!0,useCache:!0}),Bt})}sign({keyUri:e,data:At}){return __awaiter$1h(this,void 0,void 0,function*(){const kt=yield this.getPrivateKey({keyUri:e}),Bt=this.getAlgorithmName({key:kt});return this.getAlgorithm({algorithm:Bt}).sign({data:At,key:kt})})}unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:At,decryptionKeyUri:kt}){return __awaiter$1h(this,void 0,void 0,function*(){const Bt=yield this.getPrivateKey({keyUri:kt}),Nt=this.getAlgorithmName({key:Bt});return yield this.getAlgorithm({algorithm:Nt}).unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:At,decryptionKey:Bt})})}verify({key:e,signature:At,data:kt}){return __awaiter$1h(this,void 0,void 0,function*(){const Bt=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:Bt}).verify({key:e,signature:At,data:kt})})}wrapKey({unwrappedKey:e,encryptionKeyUri:At}){return __awaiter$1h(this,void 0,void 0,function*(){const kt=yield this.getPrivateKey({keyUri:At}),Bt=this.getAlgorithmName({key:kt});return yield this.getAlgorithm({algorithm:Bt}).wrapKey({unwrappedKey:e,encryptionKey:kt})})}deleteKey({keyUri:e}){return __awaiter$1h(this,void 0,void 0,function*(){if(!(yield this._keyStore.get({id:e,agent:this.agent,useCache:!0})))throw new Error(`Key not found: ${e}`);yield this._keyStore.delete({id:e,agent:this.agent})})}getAlgorithm({algorithm:e}){var At;const kt=(At=supportedAlgorithms$3[e])===null||At===void 0?void 0:At.implementation;if(!kt)throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Algorithm not supported: ${e}`);return this._algorithmInstances.has(kt)||this._algorithmInstances.set(kt,new kt),this._algorithmInstances.get(kt)}getAlgorithmName({key:e}){const At=e.alg,kt=e.crv;for(const Bt of Object.keys(supportedAlgorithms$3)){const Nt=supportedAlgorithms$3[Bt].names;if(At&&Nt.includes(At))return Bt;if(kt&&Nt.includes(kt))return Bt}throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Algorithm not supported based on provided input: alg=${At}, crv=${kt}. Please check the documentation for the list of supported algorithms.`)}getPrivateKey({keyUri:e}){return __awaiter$1h(this,void 0,void 0,function*(){const At=yield this._keyStore.get({id:e,agent:this.agent,useCache:!0});if(!At)throw new Error(`Key not found: ${e}`);return At})}};var __awaiter$1g=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function isValidJweHeader$1(xt){return typeof xt=="object"&&xt!==null&&"alg"in xt&&xt.alg!==void 0&&"enc"in xt&&xt.enc!==void 0}let JweKeyManagement$1=class{static decrypt({key:e,encryptedKey:At,joseHeader:kt,crypto:Bt}){return __awaiter$1g(this,void 0,void 0,function*(){switch(kt.alg){case"dir":{if(At!==void 0)throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'JWE "encrypted_key" is not allowed when using "dir" (Direct Encryption Mode).');if(e instanceof Uint8Array)throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'Key management "key" must be a Key URI or JWK when using "dir" (Direct Encryption Mode).');return e}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(typeof kt.p2c!="number")throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'JOSE Header "p2c" (PBES2 Count) is missing or not a number.');if(typeof kt.p2s!="string")throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'JOSE Header "p2s" (PBES2 salt) is missing or not a string.');if(!(e instanceof Uint8Array))throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'Key management "key" must be a Uint8Array when using "PBES2" (Key Encryption Mode).');if(At===void 0)throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'JWE "encrypted_key" is required when using "PBES2" (Key Encryption Mode).');let Nt;try{Nt=new Uint8Array([...Convert.string(kt.alg).toUint8Array(),0,...Convert.base64Url(kt.p2s).toUint8Array()])}catch{throw new CryptoError$1(CryptoErrorCode$1.EncodingError,'Failed to decode the JOSE Header "p2s" (PBES2 salt) value.')}const jt=yield Bt.deriveKey({algorithm:kt.alg,baseKeyBytes:e,iterations:kt.p2c,salt:Nt});if(!(jt.alg&&["A128KW","A192KW","A256KW"].includes(jt.alg)))throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Unsupported Key Encryption Algorithm (alg) value: ${jt.alg}`);return yield Bt.unwrapKey({decryptionKey:jt,wrappedKeyBytes:At,wrappedKeyAlgorithm:kt.enc})}default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Unsupported "alg" (Algorithm) Header Parameter value: ${kt.alg}`)}})}static encrypt({key:e,joseHeader:At,crypto:kt}){return __awaiter$1g(this,void 0,void 0,function*(){let Bt,Nt;switch(At.alg){case"dir":{if(Nt!==void 0)throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'JWE "encrypted_key" is not allowed when using "dir" (Direct Encryption Mode).');if(e instanceof Uint8Array)throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'Key management "key" must be a Key URI or JWK when using "dir" (Direct Encryption Mode).');Bt=e;break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(typeof At.p2c!="number")throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'JOSE Header "p2c" (PBES2 Count) is missing or not a number.');if(typeof At.p2s!="string")throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'JOSE Header "p2s" (PBES2 salt) is missing or not a string.');if(!(e instanceof Uint8Array))throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'Key management "key" must be a Uint8Array when using "PBES2" (Key Encryption Mode).');Bt=yield kt.generateKey({algorithm:At.enc});let jt;try{jt=new Uint8Array([...Convert.string(At.alg).toUint8Array(),0,...Convert.base64Url(At.p2s).toUint8Array()])}catch{throw new CryptoError$1(CryptoErrorCode$1.EncodingError,'Failed to decode the JOSE Header "p2s" (PBES2 salt) value.')}const Lt=yield kt.deriveKey({algorithm:At.alg,baseKeyBytes:e,iterations:At.p2c,salt:jt});Nt=yield kt.wrapKey({encryptionKey:Lt,unwrappedKey:Bt});break}default:throw new CryptoError$1(CryptoErrorCode$1.AlgorithmNotSupported,`Unsupported "alg" (Algorithm) Header Parameter value: ${At.alg}`)}return{cek:Bt,encryptedKey:Nt}})}};function isCipher$1(xt){return xt!==null&&typeof xt=="object"&&"encrypt"in xt&&typeof xt.encrypt=="function"&&"decrypt"in xt&&typeof xt.decrypt=="function"}function hasDuplicateProperties$1(...xt){const e=new Set,At=xt.filter(Boolean);for(const kt of At)for(const Bt in kt){if(e.has(Bt))return!0;e.add(Bt)}return!1}var __awaiter$1f=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function decodeHeaderParam$1(xt,e){if(e!==void 0)try{if(typeof e!="string")throw new Error;return Convert.base64Url(e).toUint8Array()}catch{throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,`Failed to decode the JWE Header parameter '${xt}' from Base64 URL format to Uint8Array. Ensure the value is properly encoded in Base64 URL format without padding.`)}}let FlattenedJwe$1=class Rl{constructor(e){this.ciphertext="",Object.assign(this,e)}static decrypt({jwe:e,key:At,keyManager:kt=new LocalKeyManager$3,crypto:Bt=new AgentCryptoApi$1,options:Nt={}}){var jt,Lt;return __awaiter$1f(this,void 0,void 0,function*(){if(!isCipher$1(Bt))throw new CryptoError$1(CryptoErrorCode$1.OperationNotSupported,'Crypto API does not support the "encrypt" operation.');if(!isCipher$1(kt))throw new CryptoError$1(CryptoErrorCode$1.OperationNotSupported,'Key Manager does not support the "decrypt" operation.');if(!e.protected&&!e.header&&!e.unprotected)throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'JWE is missing the required JOSE header parameters. Please provide at least one of the following: "protected", "header", or "unprotected"');if(typeof e.ciphertext!="string")throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,"JWE Ciphertext is missing or not a string.");let er;if(e.protected)try{er=Convert.base64Url(e.protected).toObject()}catch{throw new Error("JWE Protected Header is invalid")}if(hasDuplicateProperties$1(er,e.header,e.unprotected))throw new Error('Duplicate properties detected. Please ensure that each parameter is defined only once across the JWE "header", "protected", and "unprotected" objects.');const tr=Object.assign(Object.assign(Object.assign({},er),e.header),e.unprotected);if(!isValidJweHeader$1(tr))throw new Error('JWE Header is missing required "alg" (Algorithm) and/or "enc" (Encryption) Header Parameters');if(Array.isArray(Nt.allowedAlgValues)&&!Nt.allowedAlgValues.includes(tr.alg))throw new Error(`"alg" (Algorithm) Header Parameter value not allowed: ${tr.alg}`);if(Array.isArray(Nt.allowedEncValues)&&!Nt.allowedEncValues.includes(tr.enc))throw new Error(`"enc" (Encryption Algorithm) Header Parameter value not allowed: ${tr.enc}`);let zt;try{const ur=e.encrypted_key?Convert.base64Url(e.encrypted_key).toUint8Array():void 0;zt=yield JweKeyManagement$1.decrypt({key:At,encryptedKey:ur,joseHeader:tr,keyManager:kt,crypto:Bt})}catch(ur){if(ur instanceof CryptoError$1&&(ur.code===CryptoErrorCode$1.InvalidJwe||ur.code===CryptoErrorCode$1.AlgorithmNotSupported))throw ur;zt=typeof At=="string"?yield kt.generateKey({algorithm:tr.enc}):yield Bt.generateKey({algorithm:tr.enc})}const rr=decodeHeaderParam$1("iv",e.iv),nr=decodeHeaderParam$1("tag",e.tag),ir=nr!==void 0?new Uint8Array([...Convert.base64Url(e.ciphertext).toUint8Array(),...nr??[]]):Convert.base64Url(e.ciphertext).toUint8Array(),ar=e.aad!==void 0?new Uint8Array([...Convert.string((jt=e.protected)!==null&&jt!==void 0?jt:"").toUint8Array(),...Convert.string(".").toUint8Array(),...Convert.string(e.aad).toUint8Array()]):Convert.string((Lt=e.protected)!==null&&Lt!==void 0?Lt:"").toUint8Array();return{plaintext:typeof zt=="string"?yield kt.decrypt({keyUri:zt,data:ir,iv:rr,additionalData:ar}):yield Bt.decrypt({key:zt,data:ir,iv:rr,additionalData:ar}),protectedHeader:er,additionalAuthenticatedData:decodeHeaderParam$1("aad",e.aad),sharedUnprotectedHeader:e.unprotected,unprotectedHeader:e.header}})}static encrypt({key:e,plaintext:At,additionalAuthenticatedData:kt,protectedHeader:Bt,sharedUnprotectedHeader:Nt,unprotectedHeader:jt,keyManager:Lt=new LocalKeyManager$3,crypto:er=new AgentCryptoApi$1}){return __awaiter$1f(this,void 0,void 0,function*(){if(!isCipher$1(er))throw new CryptoError$1(CryptoErrorCode$1.OperationNotSupported,'Crypto API does not support the "encrypt" operation.');if(!isCipher$1(Lt))throw new CryptoError$1(CryptoErrorCode$1.OperationNotSupported,'Key Manager does not support the "decrypt" operation.');if(!Bt&&!Nt&&!jt)throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,'JWE is missing the required JOSE header parameters. Please provide at least one of the following: "protectedHeader", "sharedUnprotectedHeader", or "unprotectedHeader"');if(!(At instanceof Uint8Array))throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,"Plaintext is missing or not a byte array.");if(hasDuplicateProperties$1(Bt,Nt,jt))throw new Error('Duplicate properties detected. Please ensure that each parameter is defined only once across the JWE "protectedHeader", "sharedUnprotectedHeader", and "unprotectedHeader" objects.');const tr=Object.assign(Object.assign(Object.assign({},Bt),Nt),jt);if(!isValidJweHeader$1(tr))throw new Error('JWE Header is missing required "alg" (Algorithm) and/or "enc" (Encryption) Header Parameters');const{cek:zt,encryptedKey:rr}=yield JweKeyManagement$1.encrypt({key:e,joseHeader:tr,keyManager:Lt,crypto:er});let nr;switch(tr.enc){case"A128GCM":case"A192GCM":case"A256GCM":nr=CryptoUtils.randomBytes(12);break;default:nr=new Uint8Array(0)}const ir=Bt?Convert.object(Bt).toBase64Url():"";let ar,dr;kt?(dr=Convert.uint8Array(kt).toBase64Url(),ar=Convert.string(ir+"."+dr).toUint8Array()):ar=Convert.string(ir).toUint8Array();const ur=typeof zt=="string"?yield Lt.encrypt({keyUri:zt,data:At,iv:nr,additionalData:ar}):yield er.encrypt({key:zt,data:At,iv:nr,additionalData:ar}),fr=ur.slice(0,-16),pr=ur.slice(-16),lr=new Rl({ciphertext:Convert.uint8Array(fr).toBase64Url()});return rr&&(lr.encrypted_key=Convert.uint8Array(rr).toBase64Url()),Bt&&(lr.protected=ir),Nt&&(lr.unprotected=Nt),jt&&(lr.header=jt),nr&&(lr.iv=Convert.uint8Array(nr).toBase64Url()),dr&&(lr.aad=dr),pr&&(lr.tag=Convert.uint8Array(pr).toBase64Url()),lr})}};var __awaiter$1e=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let CompactJwe$1=class{static decrypt({jwe:e,key:At,keyManager:kt=new LocalKeyManager$3,crypto:Bt=new AgentCryptoApi$1,options:Nt={}}){return __awaiter$1e(this,void 0,void 0,function*(){if(typeof e!="string")throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,"Invalid JWE format. JWE must be a string.");const{0:jt,1:Lt,2:er,3:tr,4:zt,length:rr}=e.split(".");if(rr!==5)throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,"Invalid JWE format. JWE must have 5 parts.");const nr=yield FlattenedJwe$1.decrypt({jwe:{ciphertext:tr,encrypted_key:Lt||void 0,iv:er||void 0,protected:jt,tag:zt||void 0},key:At,keyManager:kt,crypto:Bt,options:Nt});if(!isValidJweHeader$1(nr.protectedHeader))throw new CryptoError$1(CryptoErrorCode$1.InvalidJwe,"Decrypt operation failed due to missing or malformed JWE Protected Header");return{plaintext:nr.plaintext,protectedHeader:nr.protectedHeader}})}static encrypt({plaintext:e,protectedHeader:At,key:kt,keyManager:Bt=new LocalKeyManager$3,crypto:Nt=new AgentCryptoApi$1,options:jt={}}){return __awaiter$1e(this,void 0,void 0,function*(){const Lt=yield FlattenedJwe$1.encrypt({plaintext:e,protectedHeader:At,key:kt,keyManager:Bt,crypto:Nt,options:jt});return[Lt.protected,Lt.encrypted_key,Lt.iv,Lt.ciphertext,Lt.tag].join(".")})}};var __awaiter$1d=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function isEmptyString$1(xt){return typeof xt!="string"||xt.trim().length===0}function isIdentityVaultBackup$1(xt){return typeof xt=="object"&&xt!==null&&"dateCreated"in xt&&typeof xt.dateCreated=="string"&&"size"in xt&&typeof xt.size=="number"&&"data"in xt&&typeof xt.data=="string"}function isIdentityVaultStatus$1(xt){return typeof xt=="object"&&xt!==null&&"initialized"in xt&&typeof xt.initialized=="boolean"&&"lastBackup"in xt&&"lastRestore"in xt}let HdIdentityVault$1=class{constructor({keyDerivationWorkFactor:e,store:At}={}){this.crypto=new AgentCryptoApi$1,this._keyDerivationWorkFactor=e??21e4,this._store=At??new MemoryStore}backup(){return __awaiter$1d(this,void 0,void 0,function*(){if(this.isLocked()||(yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Unable to proceed with the backup operation because the identity vault has not been initialized and unlocked. Please ensure the vault is properly initialized with a secure password before attempting to backup its contents.");const e={did:yield this.getStoredDid(),contentEncryptionKey:yield this.getStoredContentEncryptionKey(),status:yield this.getStatus()},At=Convert.object(e).toBase64Url(),kt={data:At,dateCreated:new Date().toISOString(),size:At.length};return yield this.setStatus({lastBackup:kt.dateCreated}),kt})}changePassword({oldPassword:e,newPassword:At}){return __awaiter$1d(this,void 0,void 0,function*(){if((yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Unable to proceed with the change password operation because the identity vault has not been initialized. Please ensure the vault is properly initialized with a secure password before trying again.");yield this.lock();const kt=yield this.getStoredContentEncryptionKey();let Bt,Nt;try{let Lt;({plaintext:Lt,protectedHeader:Bt}=yield CompactJwe$1.decrypt({jwe:kt,key:Convert.string(e).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$2})),Nt=Convert.uint8Array(Lt).toObject()}catch{throw new Error("HdIdentityVault: Unable to change the vault password due to an incorrectly entered old password.")}const jt=yield CompactJwe$1.encrypt({key:Convert.string(At).toUint8Array(),protectedHeader:Bt,plaintext:Convert.object(Nt).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$2});yield this._store.set("contentEncryptionKey",jt),this._contentEncryptionKey=Nt})}getDid(){return __awaiter$1d(this,void 0,void 0,function*(){if(this.isLocked())throw new Error("HdIdentityVault: Vault has not been initialized and unlocked.");const e=yield this.getStoredDid(),{plaintext:At}=yield CompactJwe$1.decrypt({jwe:e,key:this._contentEncryptionKey,crypto:this.crypto,keyManager:new LocalKeyManager$2}),kt=Convert.uint8Array(At).toObject();if(!isPortableDid$1(kt))throw new Error("HdIdentityVault: Unable to decode malformed DID in identity vault");return yield BearerDid$1.import({portableDid:kt})})}getStatus(){return __awaiter$1d(this,void 0,void 0,function*(){const e=yield this._store.get("vaultStatus");if(!e)return{initialized:!1,lastBackup:null,lastRestore:null};const At=Convert.string(e).toObject();if(!isIdentityVaultStatus$1(At))throw new Error("HdIdentityVault: Invalid IdentityVaultStatus object in store");return At})}initialize({password:e,recoveryPhrase:At,dwnEndpoints:kt}){return __awaiter$1d(this,void 0,void 0,function*(){if(yield this.isInitialized())throw new Error("HdIdentityVault: Vault has already been initialized.");if(isEmptyString$1(e))throw new Error(`HdIdentityVault: The password is required and cannot be blank. Please provide a ' +
        'valid, non-empty password.`);if(At&&isEmptyString$1(At))throw new Error(`HdIdentityVault: The password is required and cannot be blank. Please provide a ' +
        'valid, non-empty password.`);if(At??(At=generateMnemonic(wordlist,128)),!validateMnemonic(At,wordlist))throw new Error("HdIdentityVault: The provided recovery phrase is invalid. Please ensure that the recovery phrase is a correctly formatted series of 12 words.");const Bt=yield mnemonicToSeed(At),Nt=HDKey.fromMasterSeed(Bt),jt=Nt.derive("m/44'/0'/0'/0'/0'"),Lt=yield this.crypto.deriveKey({algorithm:"HKDF-512",baseKeyBytes:jt.privateKey,salt:"",info:"vault_cek",derivedKeyAlgorithm:"A256GCM"}),er=yield this.crypto.deriveKeyBytes({algorithm:"HKDF-512",baseKeyBytes:jt.publicKey,salt:"",info:"vault_unlock_salt",length:256}),tr={alg:"PBES2-HS512+A256KW",enc:"A256GCM",cty:"text/plain",p2c:this._keyDerivationWorkFactor,p2s:Convert.uint8Array(er).toBase64Url()},zt=yield CompactJwe$1.encrypt({key:Convert.string(e).toUint8Array(),protectedHeader:tr,plaintext:Convert.object(Lt).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$2});yield this._store.set("contentEncryptionKey",zt);const rr=Nt.derive("m/44'/0'/1708523827'/0'/0'"),nr=yield this.crypto.bytesToPrivateKey({algorithm:"Ed25519",privateKeyBytes:rr.privateKey});let ir=Nt.derive("m/44'/0'/1708523827'/0'/1'");const ar=yield this.crypto.bytesToPrivateKey({algorithm:"Ed25519",privateKeyBytes:ir.privateKey}),dr=new DeterministicKeyGenerator$1;yield dr.addPredefinedKeys({privateKeys:[nr,ar]});const ur={verificationMethods:[{algorithm:"Ed25519",id:"sig",purposes:["assertionMethod","authentication"]}]};kt&&kt.length&&(ur.services=[{id:"dwn",type:"DecentralizedWebNode",serviceEndpoint:kt,enc:"#enc",sig:"#sig"}]);const pr=yield(yield DidDht$1.create({keyManager:dr,options:ur})).export(),lr={alg:"dir",enc:"A256GCM",cty:"json"},yr=yield CompactJwe$1.encrypt({key:Lt,plaintext:Convert.object(pr).toUint8Array(),protectedHeader:lr,crypto:this.crypto,keyManager:new LocalKeyManager$2});return yield this._store.set("did",yr),this._contentEncryptionKey=Lt,yield this.setStatus({initialized:!0}),At})}isInitialized(){return __awaiter$1d(this,void 0,void 0,function*(){return this.getStatus().then(({initialized:e})=>e)})}isLocked(){return!this._contentEncryptionKey}lock(){return __awaiter$1d(this,void 0,void 0,function*(){if((yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Lock operation failed. Vault has not been initialized.");this._contentEncryptionKey&&(this._contentEncryptionKey.k=""),this._contentEncryptionKey=void 0})}restore({backup:e,password:At}){return __awaiter$1d(this,void 0,void 0,function*(){if(!isIdentityVaultBackup$1(e))throw new Error("HdIdentityVault: Restore operation failed due to invalid backup object.");let kt,Bt,Nt;try{Nt=yield this.getStoredDid(),Bt=yield this.getStoredContentEncryptionKey(),kt=yield this.getStatus()}catch{throw new Error("HdIdentityVault: The restore operation cannot proceed because the existing vault contents are missing or inaccessible. If the problem persists consider re-initializing the vault and retrying the restore.")}try{const jt=Convert.base64Url(e.data).toObject();yield this._store.set("did",jt.did),yield this._store.set("contentEncryptionKey",jt.contentEncryptionKey),yield this.setStatus(jt.status),yield this.unlock({password:At})}catch{throw yield this.setStatus(kt),yield this._store.set("contentEncryptionKey",Bt),yield this._store.set("did",Nt),new Error("HdIdentityVault: Restore operation failed due to invalid backup data or an incorrect password. Please verify the password is correct for the provided backup and try again.")}yield this.setStatus({lastRestore:new Date().toISOString()})})}unlock({password:e}){return __awaiter$1d(this,void 0,void 0,function*(){yield this.lock();const At=yield this.getStoredContentEncryptionKey();try{const{plaintext:kt}=yield CompactJwe$1.decrypt({jwe:At,key:Convert.string(e).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$2}),Bt=Convert.uint8Array(kt).toObject();this._contentEncryptionKey=Bt}catch{throw new Error("HdIdentityVault: Unable to unlock the vault due to an incorrect password.")}})}getStoredDid(){return __awaiter$1d(this,void 0,void 0,function*(){const e=yield this._store.get("did");if(!e)throw new Error("HdIdentityVault: Unable to retrieve the DID record from the vault. Please check the vault status and if the problem persists consider re-initializing the vault and restoring the contents from a previous backup.");return e})}getStoredContentEncryptionKey(){return __awaiter$1d(this,void 0,void 0,function*(){const e=yield this._store.get("contentEncryptionKey");if(!e)throw new Error("HdIdentityVault: Unable to retrieve the Content Encryption Key record from the vault. Please check the vault status and if the problem persists consider re-initializing the vault and restoring the contents from a previous backup.");return e})}setStatus({initialized:e,lastBackup:At,lastRestore:kt}){return __awaiter$1d(this,void 0,void 0,function*(){let Bt=yield this.getStatus();return Bt.initialized=e??Bt.initialized,Bt.lastBackup=At??Bt.lastBackup,Bt.lastRestore=kt??Bt.lastRestore,yield this._store.set("vaultStatus",JSON.stringify(Bt)),!0})}};var __awaiter$1c=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function isIdentityMetadata$1(xt){return!(!xt||typeof xt!="object"||xt===null)&&"name"in xt}let DwnIdentityStore$1=class extends DwnDataStore$1{constructor(){super(...arguments),this.name="DwnIdentityStore",this._recordProtocolDefinition=IdentityProtocolDefinition$1,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"identityMetadata",schema:this._recordProtocolDefinition.types.identityMetadata.schema}}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$1c(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$1c(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$1c(this,void 0,void 0,function*(){return yield At.set.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$1c(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}getAllRecords({agent:e,tenantDid:At}){var kt;return __awaiter$1c(this,void 0,void 0,function*(){this._index.clear();const{reply:Bt}=yield e.dwn.processRequest({author:At,target:At,messageType:DwnInterface$1.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let Nt=[];for(const jt of(kt=Bt.entries)!==null&&kt!==void 0?kt:[]){if(!jt.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const Lt=Convert.base64Url(jt.encodedData).toObject();if(isIdentityMetadata$1(Lt)){const er=`${At}${TENANT_SEPARATOR$1}${Lt.uri}`;this._index.set(er,jt.recordId),this._cache.set(jt.recordId,Lt),Nt.push(Lt)}}return Nt})}},InMemoryIdentityStore$1=class extends InMemoryDataStore$1{constructor(){super(...arguments),this.name="InMemoryIdentityStore"}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$1c(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$1c(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$1c(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$1c(this,void 0,void 0,function*(){return yield At.set.call(this,e)})}};var __awaiter$1b=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let AgentIdentityApi$1=class{constructor({agent:e,store:At}={}){this._agent=e,this._store=At??new InMemoryIdentityStore$1}get agent(){if(this._agent===void 0)throw new Error("AgentIdentityApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}create({metadata:e,didMethod:At="dht",didOptions:kt,store:Bt,tenant:Nt}){return __awaiter$1b(this,void 0,void 0,function*(){const jt=yield this.agent.did.create({method:At,options:kt,store:Bt,tenant:Nt}),Lt=new BearerIdentity$1({did:jt,metadata:Object.assign(Object.assign({},e),{uri:jt.uri,tenant:Nt??jt.uri})});return(Bt??!0)&&(yield this._store.set({id:Lt.did.uri,data:Lt.metadata,agent:this.agent,tenant:Lt.metadata.tenant,preventDuplicates:!1,useCache:!0})),Lt})}export({didUri:e,tenant:At}){return __awaiter$1b(this,void 0,void 0,function*(){const kt=yield this.get({didUri:e,tenant:At});if(!kt)throw new Error(`AgentIdentityApi: Failed to export due to Identity not found: ${e}`);return yield kt.export()})}get({didUri:e,tenant:At}){return __awaiter$1b(this,void 0,void 0,function*(){const kt=yield this._store.get({id:e,agent:this.agent,tenant:At,useCache:!0});if(!kt)return;const Bt=yield this.agent.did.get({didUri:e,tenant:kt.tenant});if(!Bt)throw new Error(`AgentIdentityApi: Identity is present in the store but DID is missing: ${e}`);return new BearerIdentity$1({did:Bt,metadata:kt})})}import({portableIdentity:e}){return __awaiter$1b(this,void 0,void 0,function*(){const At=yield this.agent.did.import({portableDid:e.portableDid,tenant:e.metadata.tenant});if(!At)throw new Error(`AgentIdentityApi: Failed to import Identity: ${e.metadata.uri}`);const kt=new BearerIdentity$1({did:At,metadata:e.metadata});return yield this._store.set({id:kt.did.uri,data:kt.metadata,agent:this.agent,tenant:kt.metadata.tenant,preventDuplicates:!0,useCache:!0}),kt})}list({tenant:e}={}){return __awaiter$1b(this,void 0,void 0,function*(){const At=yield this._store.list({agent:this.agent,tenant:e});return(yield Promise.all(At.map(Bt=>__awaiter$1b(this,void 0,void 0,function*(){return this.get({didUri:Bt.uri,tenant:Bt.tenant})})))).filter(Bt=>typeof Bt<"u")})}manage({portableIdentity:e}){return __awaiter$1b(this,void 0,void 0,function*(){const At=yield this.agent.did.get({didUri:e.metadata.uri,tenant:e.metadata.tenant});if(!At)throw new Error(`AgentIdentityApi: Failed to manage Identity: ${e.metadata.uri}`);const kt=new BearerIdentity$1({did:At,metadata:e.metadata});return yield this._store.set({id:kt.did.uri,data:kt.metadata,agent:this.agent,preventDuplicates:!0,useCache:!0}),kt})}delete({didUri:e,tenant:At}){return __awaiter$1b(this,void 0,void 0,function*(){if(!(yield this._store.get({id:e,agent:this.agent,tenant:At,useCache:!0})))throw new Error(`AgentIdentityApi: Failed to purge due to Identity not found: ${e}`);yield this._store.delete({id:e,agent:this.agent,tenant:At})})}connectedIdentity({connectedDid:e}={}){return __awaiter$1b(this,void 0,void 0,function*(){const At=yield this.list();if(!(At.length<1))return e?At.find(kt=>kt.metadata.connectedDid===e):At.find(kt=>kt.metadata.connectedDid!==void 0)})}};var __awaiter$1a=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$l=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};let AgentPermissionsApi$1=class Cl{get agent(){if(!this._agent)throw new Error("AgentPermissionsApi: Agent is not set");return this._agent}set agent(e){this._agent=e}constructor({agent:e}={}){this._cachedPermissions=new TtlCache({ttl:60*1e3}),this._agent=e}getPermissionForRequest({connectedDid:e,delegateDid:At,delegate:kt,messageType:Bt,protocol:Nt,cached:jt=!1}){return __awaiter$1a(this,void 0,void 0,function*(){const Lt=[e,At,Bt,Nt].join("~"),er=jt?this._cachedPermissions.get(Lt):void 0;if(er)return er;const tr=yield this.fetchGrants({author:At,target:At,grantor:e,grantee:At}),zt=yield Cl.matchGrantFromArray(e,At,{messageType:Bt,protocol:Nt},tr,kt);if(!zt)throw new Error(`CachedPermissions: No permissions found for ${Bt}: ${Nt}`);return this._cachedPermissions.set(Lt,zt),zt})}fetchGrants({author:e,target:At,grantee:kt,grantor:Bt,protocol:Nt,remote:jt=!1}){return __awaiter$1a(this,void 0,void 0,function*(){const Lt=Nt?{protocol:Nt}:void 0,er={author:e,target:At,messageType:DwnInterface$1.RecordsQuery,messageParams:{filter:{author:Bt,recipient:kt,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.grantPath,tags:Lt}}},{reply:tr}=jt?yield this.agent.sendDwnRequest(er):yield this.agent.processDwnRequest(er);if(tr.status.code!==200)throw new Error(`PermissionsApi: Failed to fetch grants: ${tr.status.detail}`);const zt=[];for(const rr of tr.entries){const nr=yield PermissionGrant$1.parse(rr);zt.push({grant:nr,message:rr})}return zt})}fetchRequests({author:e,target:At,protocol:kt,remote:Bt=!1}){return __awaiter$1a(this,void 0,void 0,function*(){const Nt=kt?{protocol:kt}:void 0,jt={author:e,target:At,messageType:DwnInterface$1.RecordsQuery,messageParams:{filter:{protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.requestPath,tags:Nt}}},{reply:Lt}=Bt?yield this.agent.sendDwnRequest(jt):yield this.agent.processDwnRequest(jt);if(Lt.status.code!==200)throw new Error(`PermissionsApi: Failed to fetch requests: ${Lt.status.detail}`);const er=[];for(const tr of Lt.entries){const zt=yield PermissionRequest$1.parse(tr);er.push({request:zt,message:tr})}return er})}isGrantRevoked({author:e,target:At,grantRecordId:kt,remote:Bt=!1}){return __awaiter$1a(this,void 0,void 0,function*(){const Nt={author:e,target:At,messageType:DwnInterface$1.RecordsRead,messageParams:{filter:{parentId:kt,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.revocationPath}}},{reply:jt}=Bt?yield this.agent.sendDwnRequest(Nt):yield this.agent.processDwnRequest(Nt);if(jt.status.code===404)return!1;if(jt.status.code===200)return!0;throw new Error(`PermissionsApi: Failed to check if grant is revoked: ${jt.status.detail}`)})}createGrant(e){return __awaiter$1a(this,void 0,void 0,function*(){const{author:At,store:kt=!1,delegated:Bt=!1}=e,Nt=__rest$l(e,["author","store","delegated"]);let jt;PermissionsProtocol.hasProtocolScope(Nt.scope)&&(jt={protocol:Nt.scope.protocol});const Lt={dateExpires:Nt.dateExpires,requestId:Nt.requestId,description:Nt.description,delegated:Bt,scope:Nt.scope},er=Convert.object(Lt).toUint8Array(),tr={recipient:Nt.grantedTo,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.grantPath,dataFormat:"application/json",tags:jt},{reply:zt,message:rr}=yield this.agent.processDwnRequest({store:kt,author:At,target:At,messageType:DwnInterface$1.RecordsWrite,messageParams:tr,dataStream:new Blob([er])});if(zt.status.code!==202)throw new Error(`PermissionsApi: Failed to create grant: ${zt.status.detail}`);const nr=Object.assign(Object.assign({},rr),{encodedData:Convert.uint8Array(er).toBase64Url()});return{grant:yield PermissionGrant$1.parse(nr),message:nr}})}createRequest(e){return __awaiter$1a(this,void 0,void 0,function*(){const{author:At,store:kt=!1,delegated:Bt=!1}=e,Nt=__rest$l(e,["author","store","delegated"]);let jt;PermissionsProtocol.hasProtocolScope(Nt.scope)&&(jt={protocol:Nt.scope.protocol});const Lt={description:Nt.description,delegated:Bt,scope:Nt.scope},er=Convert.object(Lt).toUint8Array(),tr={protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.requestPath,dataFormat:"application/json",tags:jt},{reply:zt,message:rr}=yield this.agent.processDwnRequest({store:kt,author:At,target:At,messageType:DwnInterface$1.RecordsWrite,messageParams:tr,dataStream:new Blob([er])});if(zt.status.code!==202)throw new Error(`PermissionsApi: Failed to create request: ${zt.status.detail}`);const nr=Object.assign(Object.assign({},rr),{encodedData:Convert.uint8Array(er).toBase64Url()});return{request:yield PermissionRequest$1.parse(nr),message:nr}})}createRevocation(e){return __awaiter$1a(this,void 0,void 0,function*(){const{author:At,store:kt=!1,grant:Bt,description:Nt}=e,jt={description:Nt},Lt=Convert.object(jt).toUint8Array();let er;PermissionsProtocol.hasProtocolScope(Bt.scope)&&(er={protocol:Bt.scope.protocol});const tr={parentContextId:Bt.id,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.revocationPath,dataFormat:"application/json",tags:er},{reply:zt,message:rr}=yield this.agent.processDwnRequest({store:kt,author:At,target:At,messageType:DwnInterface$1.RecordsWrite,messageParams:tr,dataStream:new Blob([Lt])});if(zt.status.code!==202)throw new Error(`PermissionsApi: Failed to create revocation: ${zt.status.detail}`);return{message:Object.assign(Object.assign({},rr),{encodedData:Convert.uint8Array(Lt).toBase64Url()})}})}clear(){return __awaiter$1a(this,void 0,void 0,function*(){this._cachedPermissions.clear()})}static matchGrantFromArray(e,At,kt,Bt,Nt=!1){return __awaiter$1a(this,void 0,void 0,function*(){for(const jt of Bt){const{grant:Lt,message:er}=jt;if(Nt===!0&&Lt.delegated!==!0)continue;const{messageType:tr,protocol:zt,protocolPath:rr,contextId:nr}=kt;if(this.matchScopeFromGrant(e,At,tr,Lt,zt,rr,nr))return{grant:Lt,message:er}}})}static matchScopeFromGrant(e,At,kt,Bt,Nt,jt,Lt){if(Bt.grantee!==At||Bt.grantor!==e)return!1;const er=Bt.scope;if(er.interface+er.method===kt)if(isRecordsType$1(kt)){const zt=er;if(zt.protocol!==Nt)return!1;if(this.isUnrestrictedProtocolScope(zt)||zt.protocolPath!==void 0&&zt.protocolPath===jt||zt.contextId!==void 0&&(Lt!=null&&Lt.startsWith(zt.contextId)))return!0}else{const zt=er;return zt.protocol===void 0?!0:zt.protocol!==Nt?!1:this.isUnrestrictedProtocolScope(zt)}return!1}static isUnrestrictedProtocolScope(e){return e.contextId===void 0&&e.protocolPath===void 0}};var JsonRpcErrorCodes$1;(function(xt){xt[xt.InvalidRequest=-32600]="InvalidRequest",xt[xt.MethodNotFound=-32601]="MethodNotFound",xt[xt.InvalidParams=-32602]="InvalidParams",xt[xt.InternalError=-32603]="InternalError",xt[xt.ParseError=-32700]="ParseError",xt[xt.TransportError=-32300]="TransportError",xt[xt.BadRequest=-50400]="BadRequest",xt[xt.Unauthorized=-50401]="Unauthorized",xt[xt.Forbidden=-50403]="Forbidden",xt[xt.Conflict=-50409]="Conflict"})(JsonRpcErrorCodes$1||(JsonRpcErrorCodes$1={}));const createJsonRpcRequest$1=(xt,e,At)=>({jsonrpc:"2.0",id:xt,method:e,params:At}),createJsonRpcSubscriptionRequest$1=(xt,e,At,kt)=>({jsonrpc:"2.0",id:xt,method:`rpc.subscribe.${e}`,params:kt,subscription:{id:At}});function parseJson$1(xt){try{return JSON.parse(xt)}catch{return null}}var __awaiter$19=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let DwnServerInfoCacheMemory$1=class{constructor({ttl:e="15m"}={}){this.cache=new TtlCache({ttl:ms$1(e)})}get(e){return __awaiter$19(this,void 0,void 0,function*(){return this.cache.get(e)})}set(e,At){return __awaiter$19(this,void 0,void 0,function*(){this.cache.set(e,At)})}delete(e){return __awaiter$19(this,void 0,void 0,function*(){this.cache.delete(e)})}clear(){return __awaiter$19(this,void 0,void 0,function*(){this.cache.clear()})}close(){return __awaiter$19(this,void 0,void 0,function*(){})}};var __awaiter$18=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let HttpDwnRpcClient$1=class{constructor(e){this.serverInfoCache=e??new DwnServerInfoCacheMemory$1}get transportProtocols(){return["http:","https:"]}sendDwnRequest(e){return __awaiter$18(this,void 0,void 0,function*(){const At=CryptoUtils.randomUuid(),kt=createJsonRpcRequest$1(At,"dwn.processMessage",{target:e.targetDid,message:e.message}),Bt={method:"POST",headers:{"dwn-request":JSON.stringify(kt)}};e.data&&(Bt.headers["content-type"]="application/octet-stream",Bt.body=e.data);const Nt=yield fetch(e.dwnUrl,Bt);let jt,Lt;const{headers:er}=Nt;if(er.has("dwn-response")){const zt=parseJson$1(er.get("dwn-response"));if(zt==null)throw new Error(`failed to parse json rpc response. dwn url: ${e.dwnUrl}`);Lt=Nt.body,jt=zt}else{const zt=yield Nt.text();jt=JSON.parse(zt)}if(jt.error){const{code:zt,message:rr}=jt.error;throw new Error(`(${zt}) - ${rr}`)}const{reply:tr}=jt.result;return Lt&&tr.record?tr.record.data=Lt:Lt&&tr.entry&&(tr.entry.data=Lt),tr})}getServerInfo(e){return __awaiter$18(this,void 0,void 0,function*(){const At=yield this.serverInfoCache.get(e);if(At)return At;const kt=new URL(e);kt.pathname.endsWith("/")?kt.pathname+="info":kt.pathname+="/info";try{const Bt=yield fetch(kt.toString());if(Bt.ok){const Nt=yield Bt.json(),jt={registrationRequirements:Nt.registrationRequirements,maxFileSize:Nt.maxFileSize,webSocketSupport:Nt.webSocketSupport};return this.serverInfoCache.set(e,jt),jt}else throw new Error(`HTTP (${Bt.status}) - ${Bt.statusText}`)}catch(Bt){throw new Error(`Error encountered while processing response from ${kt.toString()}: ${Bt.message}`)}})}};var ws=null;typeof WebSocket<"u"?ws=WebSocket:typeof MozWebSocket<"u"?ws=MozWebSocket:typeof globalThis<"u"?ws=globalThis.WebSocket||globalThis.MozWebSocket:typeof window<"u"?ws=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(ws=self.WebSocket||self.MozWebSocket);const IsomorphicWebSocket=ws;var __awaiter$17=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const CONNECT_TIMEOUT$1=3e3,RESPONSE_TIMEOUT$1=3e4;let JsonRpcSocket$1=class Ol{constructor(e,At){this.socket=e,this.responseTimeout=At,this.messageHandlers=new Map}static connect(e,At={}){return __awaiter$17(this,void 0,void 0,function*(){const{connectTimeout:kt=CONNECT_TIMEOUT$1,responseTimeout:Bt=RESPONSE_TIMEOUT$1,onclose:Nt,onerror:jt}=At,Lt=new IsomorphicWebSocket(e);return Nt?Lt.onclose=Nt:Lt.onclose=()=>{console.info(`JSON RPC Socket close ${e}`)},jt?Lt.onerror=jt:Lt.onerror=er=>{console.error(`JSON RPC Socket error ${e}`,er)},new Promise((er,tr)=>{Lt.addEventListener("open",()=>{const zt=new Ol(Lt,Bt);Lt.addEventListener("message",rr=>{const nr=parseJson$1(rr.data),ir=zt.messageHandlers.get(nr.id);ir&&ir(rr)}),er(zt)}),Lt.addEventListener("error",zt=>{tr(zt)}),setTimeout(()=>tr,kt)})})}close(){this.socket.close()}request(e){return __awaiter$17(this,void 0,void 0,function*(){return new Promise((At,kt)=>{var Bt;(Bt=e.id)!==null&&Bt!==void 0||(e.id=CryptoUtils.randomUuid());const Nt=jt=>{const Lt=parseJson$1(jt.data);if(Lt.id===e.id)return this.messageHandlers.delete(e.id),At(Lt)};this.messageHandlers.set(e.id,Nt),this.send(e),setTimeout(()=>{this.messageHandlers.delete(e.id),kt(new Error("request timed out"))},this.responseTimeout)})})}subscribe(e,At){return __awaiter$17(this,void 0,void 0,function*(){if(!e.method.startsWith("rpc.subscribe."))throw new Error("subscribe rpc requests must include the `rpc.subscribe` prefix");if(!e.subscription)throw new Error("subscribe rpc requests must include subscribe options");const kt=e.subscription.id,Bt=Lt=>{const er=parseJson$1(Lt.data.toString());er.id===kt&&(er.error!==void 0&&(this.messageHandlers.delete(kt),this.closeSubscription(kt)),At(er))};this.messageHandlers.set(kt,Bt);const Nt=yield this.request(e);return Nt.error?(this.messageHandlers.delete(kt),{response:Nt}):{response:Nt,close:()=>__awaiter$17(this,void 0,void 0,function*(){this.messageHandlers.delete(kt),yield this.closeSubscription(kt)})}})}closeSubscription(e){const At=CryptoUtils.randomUuid(),kt=createJsonRpcSubscriptionRequest$1(At,"close",e,{});return this.request(kt)}send(e){this.socket.send(JSON.stringify(e))}};var __awaiter$16=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let WebSocketDwnRpcClient$1=class Es{get transportProtocols(){return["ws:","wss:"]}sendDwnRequest(e,At){return __awaiter$16(this,void 0,void 0,function*(){const kt=new URL(e.dwnUrl);if(kt.protocol!=="ws:"&&kt.protocol!=="wss:")throw new Error(`Invalid websocket protocol ${kt.protocol}`);if(!Es.connections.has(kt.host))try{const tr=yield JsonRpcSocket$1.connect(kt.toString(),At),zt=new Map;Es.connections.set(kt.host,{socket:tr,subscriptions:zt})}catch(tr){throw new Error(`Error connecting to ${kt.host}: ${tr.message}`)}const Nt=Es.connections.get(kt.host),{targetDid:jt,message:Lt,subscriptionHandler:er}=e;return er?Es.subscriptionRequest(Nt,jt,Lt,er):Es.processMessage(Nt,jt,Lt)})}static processMessage(e,At,kt){return __awaiter$16(this,void 0,void 0,function*(){const Bt=CryptoUtils.randomUuid(),Nt=createJsonRpcRequest$1(Bt,"dwn.processMessage",{target:At,message:kt}),{socket:jt}=e,Lt=yield jt.request(Nt),{error:er,result:tr}=Lt;if(er!==void 0)throw new Error(`error sending DWN request: ${er.message}`);return tr.reply})}static subscriptionRequest(e,At,kt,Bt){return __awaiter$16(this,void 0,void 0,function*(){const Nt=CryptoUtils.randomUuid(),jt=CryptoUtils.randomUuid(),Lt=createJsonRpcSubscriptionRequest$1(Nt,"dwn.processMessage",jt,{target:At,message:kt}),{socket:er,subscriptions:tr}=e,{response:zt,close:rr}=yield er.subscribe(Lt,dr=>{const{result:ur,error:fr}=dr;if(fr){const lr=tr.get(jt);lr&&lr.close(),tr.delete(jt);return}const{event:pr}=ur;Bt(pr)}),{error:nr,result:ir}=zt;if(nr)throw new Error(`could not subscribe via jsonrpc socket: ${nr.message}`);const{reply:ar}=ir;return ar.subscription&&rr&&(tr.set(jt,Object.assign(Object.assign({},ar.subscription),{close:rr})),ar.subscription.close=rr),ar})}};WebSocketDwnRpcClient$1.connections=new Map;var __awaiter$15=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},DidRpcMethod$1;(function(xt){xt.Create="did.create",xt.Resolve="did.resolve"})(DidRpcMethod$1||(DidRpcMethod$1={}));let Web5RpcClient$1=class{constructor(e=[]){this.transportClients=new Map,e=[new HttpWeb5RpcClient$1,new WebSocketWeb5RpcClient$1,...e];for(let At of e)for(let kt of At.transportProtocols)this.transportClients.set(kt,At)}get transportProtocols(){return Array.from(this.transportClients.keys())}sendDidRequest(e){return __awaiter$15(this,void 0,void 0,function*(){const At=new URL(e.url),kt=this.transportClients.get(At.protocol);if(!kt){const Bt=new Error(`no ${At.protocol} transport client available`);throw Bt.name="NO_TRANSPORT_CLIENT",Bt}return kt.sendDidRequest(e)})}sendDwnRequest(e){const At=new URL(e.dwnUrl),kt=this.transportClients.get(At.protocol);if(!kt){const Bt=new Error(`no ${At.protocol} transport client available`);throw Bt.name="NO_TRANSPORT_CLIENT",Bt}return kt.sendDwnRequest(e)}getServerInfo(e){return __awaiter$15(this,void 0,void 0,function*(){const At=new URL(e),kt=this.transportClients.get(At.protocol);if(!kt){const Bt=new Error(`no ${At.protocol} transport client available`);throw Bt.name="NO_TRANSPORT_CLIENT",Bt}return kt.getServerInfo(e)})}},HttpWeb5RpcClient$1=class extends HttpDwnRpcClient$1{sendDidRequest(e){return __awaiter$15(this,void 0,void 0,function*(){const At=CryptoUtils.randomUuid(),kt=createJsonRpcRequest$1(At,e.method,{data:e.data}),Bt=new Request(e.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(kt)});let Nt;try{const jt=yield fetch(Bt);if(jt.ok){if(Nt=yield jt.json(),Nt.error){const{code:Lt,message:er}=Nt.error;throw new Error(`JSON RPC (${Lt}) - ${er}`)}}else throw new Error(`HTTP (${jt.status}) - ${jt.statusText}`)}catch(jt){throw new Error(`Error encountered while processing response from ${e.url}: ${jt.message}`)}return Nt.result})}},WebSocketWeb5RpcClient$1=class extends WebSocketDwnRpcClient$1{sendDidRequest(e){return __awaiter$15(this,void 0,void 0,function*(){throw new Error(`not implemented for transports [${this.transportProtocols.join(", ")}]`)})}getServerInfo(e){return __awaiter$15(this,void 0,void 0,function*(){throw new Error(`not implemented for transports [${this.transportProtocols.join(", ")}]`)})}};var __awaiter$14=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let AgentSyncApi$1=class{constructor({agent:e,syncEngine:At}){this._syncEngine=At,this._agent=e}get agent(){if(this._agent===void 0)throw new Error("AgentSyncApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,this._syncEngine.agent=e}registerIdentity(e){return __awaiter$14(this,void 0,void 0,function*(){yield this._syncEngine.registerIdentity(e)})}unregisterIdentity(e){return __awaiter$14(this,void 0,void 0,function*(){yield this._syncEngine.unregisterIdentity(e)})}getIdentityOptions(e){return __awaiter$14(this,void 0,void 0,function*(){return yield this._syncEngine.getIdentityOptions(e)})}updateIdentityOptions(e){return __awaiter$14(this,void 0,void 0,function*(){yield this._syncEngine.updateIdentityOptions(e)})}sync(e){return this._syncEngine.sync(e)}startSync(e){return this._syncEngine.startSync(e)}stopSync(e){return this._syncEngine.stopSync(e)}};var __awaiter$13=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues$1=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}};let SyncEngineLevel$1=class Ss{constructor({agent:e,dataPath:At,db:kt}){this._syncLock=!1,this._agent=e,this._permissionsApi=new AgentPermissionsApi$1({agent:e}),this._db=kt||new Level(At??"DATA/AGENT/SYNC_STORE"),this._ulidFactory=monotonicFactory()}get agent(){if(this._agent===void 0)throw new Error("SyncEngineLevel: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,this._permissionsApi=new AgentPermissionsApi$1({agent:e})}clear(){return __awaiter$13(this,void 0,void 0,function*(){yield this._permissionsApi.clear(),yield this._db.clear()})}close(){return __awaiter$13(this,void 0,void 0,function*(){yield this._db.close()})}pull(){var e;return __awaiter$13(this,void 0,void 0,function*(){const At=yield this.getSyncPeerState({syncDirection:"pull"});yield this.enqueueOperations({syncDirection:"pull",syncPeerState:At});const kt=this.getPullQueue(),Bt=yield kt.iterator().all(),Nt=[],jt=new Set;for(let Lt of Bt){const[er]=Lt,{did:tr,dwnUrl:zt,messageCid:rr,delegateDid:nr,protocol:ir}=Ss.parseSyncMessageParamsKey(er);if(jt.has(zt))continue;if(yield this.messageExists(tr,rr)){Nt.push({type:"del",key:er});continue}let dr,ur;if(nr)try{dr=(yield this._permissionsApi.getPermissionForRequest({connectedDid:tr,messageType:DwnInterface$1.MessagesRead,delegateDid:nr,protocol:ir,cached:!0})).grant.id,ur=nr}catch(Pr){console.error("SyncEngineLevel: pull - Error fetching MessagesRead permission grant for delegate DID",Pr);continue}const fr=yield this.agent.processDwnRequest({store:!1,author:tr,target:tr,messageType:DwnInterface$1.MessagesRead,granteeDid:ur,messageParams:{messageCid:rr,permissionGrantId:dr}});let pr;try{pr=yield this.agent.rpc.sendDwnRequest({dwnUrl:zt,targetDid:tr,message:fr.message})}catch{jt.add(zt);continue}if(pr.status.code!==200||!(!((e=pr.entry)===null||e===void 0)&&e.message)){yield this.addMessage(tr,rr),Nt.push({type:"del",key:er});continue}const lr=pr.entry,yr=lr.message,br=isRecordsWrite$1(lr)&&lr.data?NodeStream.fromWebReadable({readableStream:lr.data}):void 0,Ar=yield this.agent.dwn.node.processMessage(tr,yr,{dataStream:br});Ss.syncMessageReplyIsSuccessful(Ar)&&(yield this.addMessage(tr,rr),Nt.push({type:"del",key:er}))}yield kt.batch(Nt)})}push(){return __awaiter$13(this,void 0,void 0,function*(){const e=yield this.getSyncPeerState({syncDirection:"push"});yield this.enqueueOperations({syncDirection:"push",syncPeerState:e});const At=this.getPushQueue(),kt=yield At.iterator().all(),Bt=[],Nt=new Set;for(let jt of kt){const[Lt]=jt,{did:er,delegateDid:tr,protocol:zt,dwnUrl:rr,messageCid:nr}=Ss.parseSyncMessageParamsKey(Lt);if(Nt.has(rr))continue;const ir=yield this.getDwnMessage({author:er,messageCid:nr,delegateDid:tr,protocol:zt});if(!ir){Bt.push({type:"del",key:Lt}),yield this.addMessage(er,nr);continue}try{const ar=yield this.agent.rpc.sendDwnRequest({dwnUrl:rr,targetDid:er,data:ir.data,message:ir.message});Ss.syncMessageReplyIsSuccessful(ar)&&(yield this.addMessage(er,nr),Bt.push({type:"del",key:Lt}))}catch{Nt.add(rr)}}yield At.batch(Bt)})}registerIdentity({did:e,options:At}){return __awaiter$13(this,void 0,void 0,function*(){const kt=this._db.sublevel("registeredIdentities");if(yield this.getIdentityOptions(e))throw new Error(`SyncEngineLevel: Identity with DID ${e} is already registered.`);At??(At={protocols:[]}),yield kt.put(e,JSON.stringify(At))})}unregisterIdentity(e){return __awaiter$13(this,void 0,void 0,function*(){const At=this._db.sublevel("registeredIdentities");if(!(yield this.getIdentityOptions(e)))throw new Error(`SyncEngineLevel: Identity with DID ${e} is not registered.`);yield At.del(e)})}getIdentityOptions(e){return __awaiter$13(this,void 0,void 0,function*(){const At=this._db.sublevel("registeredIdentities");try{const kt=yield At.get(e);if(kt)return JSON.parse(kt)}catch(kt){const Bt=kt;if(Bt.code==="LEVEL_NOT_FOUND")return;throw new Error(`SyncEngineLevel: Error reading level: ${Bt.code}.`)}})}updateIdentityOptions({did:e,options:At}){return __awaiter$13(this,void 0,void 0,function*(){const kt=this._db.sublevel("registeredIdentities");if(!(yield this.getIdentityOptions(e)))throw new Error(`SyncEngineLevel: Identity with DID ${e} is not registered.`);yield kt.put(e,JSON.stringify(At))})}sync(e){return __awaiter$13(this,void 0,void 0,function*(){if(this._syncLock)throw new Error("SyncEngineLevel: Sync operation is already in progress.");this._syncLock=!0;try{(!e||e==="push")&&(yield this.push()),(!e||e==="pull")&&(yield this.pull())}finally{this._syncLock=!1}})}startSync({interval:e}){return __awaiter$13(this,void 0,void 0,function*(){const At=ms$1(e),kt=()=>__awaiter$13(this,void 0,void 0,function*(){this._syncLock||(clearInterval(this._syncIntervalId),this._syncIntervalId=void 0,yield this.sync(),this._syncIntervalId||(this._syncIntervalId=setInterval(kt,At)))});this._syncIntervalId&&clearInterval(this._syncIntervalId),this._syncIntervalId=setInterval(kt,At),this._syncLock||(yield this.sync())})}stopSync(e=2e3){return __awaiter$13(this,void 0,void 0,function*(){let At=0;for(;this._syncLock;){if(At>=e)throw new Error(`SyncEngineLevel: Existing sync operation did not complete within ${e} milliseconds.`);At+=100,yield new Promise(kt=>setTimeout(kt,e<100?e:100))}this._syncIntervalId&&(clearInterval(this._syncIntervalId),this._syncIntervalId=void 0)})}static syncMessageReplyIsSuccessful(e){var At,kt;return e.status.code===202||e.status.code===204||e.status.code===409||((At=e.entry)===null||At===void 0?void 0:At.message.descriptor.interface)===DwnInterfaceName.Records&&((kt=e.entry)===null||kt===void 0?void 0:kt.message.descriptor.method)===DwnMethodName.Delete&&e.status.code===404}enqueueOperations({syncDirection:e,syncPeerState:At}){return __awaiter$13(this,void 0,void 0,function*(){for(let kt of At){const Bt=yield this.getDwnEventLog({did:kt.did,delegateDid:kt.delegateDid,dwnUrl:kt.dwnUrl,cursor:kt.cursor,protocol:kt.protocol,syncDirection:e}),Nt=[];for(let jt of Bt){const Lt=this._ulidFactory(),er=Ss.generateSyncMessageParamsKey(Object.assign(Object.assign({},kt),{watermark:Lt,messageCid:jt}));Nt.push({type:"put",key:er,value:""})}Nt.length>0&&(yield(e==="pull"?this.getPullQueue():this.getPushQueue()).batch(Nt))}})}static generateSyncMessageParamsKey({did:e,delegateDid:At,dwnUrl:kt,protocol:Bt,watermark:Nt,messageCid:jt}){return[e,At,kt,Bt,Nt,jt].join("~")}static parseSyncMessageParamsKey(e){const[At,kt,Bt,Nt,jt,Lt]=e.split("~");return{did:At,delegateDid:kt===""?void 0:kt,dwnUrl:Bt,watermark:jt,messageCid:Lt,protocol:Nt===""?void 0:Nt}}getDwnEventLog({did:e,delegateDid:At,dwnUrl:kt,syncDirection:Bt,cursor:Nt,protocol:jt}){var Lt;return __awaiter$13(this,void 0,void 0,function*(){let er={},tr;if(At)try{tr=(yield this._permissionsApi.getPermissionForRequest({connectedDid:e,messageType:DwnInterface$1.MessagesQuery,delegateDid:At,protocol:jt,cached:!0})).grant.id}catch(rr){return console.error("SyncEngineLevel: Error fetching MessagesQuery permission grant for delegate DID",rr),[]}if(Bt==="pull"){const rr=jt?[{protocol:jt}]:[],nr=yield this.agent.dwn.processRequest({store:!1,target:e,author:e,messageType:DwnInterface$1.MessagesQuery,granteeDid:At,messageParams:{filters:rr,cursor:Nt,permissionGrantId:tr}});try{er=yield this.agent.rpc.sendDwnRequest({dwnUrl:kt,targetDid:e,message:nr.message})}catch{}}else if(Bt==="push"){const rr=jt?[{protocol:jt}]:[];er=(yield this.agent.dwn.processRequest({author:e,target:e,messageType:DwnInterface$1.MessagesQuery,granteeDid:At,messageParams:{filters:rr,cursor:Nt,permissionGrantId:tr}})).reply}const zt=(Lt=er.entries)!==null&&Lt!==void 0?Lt:[];return er.cursor&&this.setCursor(e,kt,Bt,er.cursor,jt),zt})}getDwnMessage({author:e,delegateDid:At,protocol:kt,messageCid:Bt}){return __awaiter$13(this,void 0,void 0,function*(){let Nt;if(At)try{Nt=(yield this._permissionsApi.getPermissionForRequest({connectedDid:e,messageType:DwnInterface$1.MessagesRead,delegateDid:At,protocol:kt,cached:!0})).grant.id}catch(tr){console.error("SyncEngineLevel: push - Error fetching MessagesRead permission grant for delegate DID",tr);return}let{reply:jt}=yield this.agent.dwn.processRequest({author:e,target:e,messageType:DwnInterface$1.MessagesRead,granteeDid:At,messageParams:{messageCid:Bt,permissionGrantId:Nt}});if(jt.status.code!==200||!jt.entry)return;const Lt=jt.entry;let er={message:Lt.message};if(isRecordsWrite$1(Lt)&&Lt.data){const tr=yield NodeStream.consumeToBytes({readable:Lt.data});er.data=new Blob([tr],{type:Lt.message.descriptor.dataFormat})}return er})}getSyncPeerState({syncDirection:e}){var At,kt,Bt,Nt;return __awaiter$13(this,void 0,void 0,function*(){const jt=[];try{for(var Lt=!0,er=__asyncValues$1(this._db.sublevel("registeredIdentities").iterator()),tr;tr=yield er.next(),At=tr.done,!At;Lt=!0){Nt=tr.value,Lt=!1;const[zt,rr]=Nt,{protocols:nr,delegateDid:ir}=yield new Promise(dr=>{try{const{protocols:ur,delegateDid:fr}=JSON.parse(rr);dr({protocols:ur,delegateDid:fr})}catch{dr({protocols:[]})}}),ar=yield getDwnServiceEndpointUrls$1(zt,this.agent.did);if(ar.length!==0)for(let dr of ar)if(nr.length===0){const ur=yield this.getCursor(zt,dr,e);jt.push({did:zt,delegateDid:ir,dwnUrl:dr,cursor:ur})}else for(const ur of nr){const fr=yield this.getCursor(zt,dr,e,ur);jt.push({did:zt,delegateDid:ir,dwnUrl:dr,cursor:fr,protocol:ur})}}}catch(zt){kt={error:zt}}finally{try{!Lt&&!At&&(Bt=er.return)&&(yield Bt.call(er))}finally{if(kt)throw kt.error}}return jt})}getCursor(e,At,kt,Bt){return __awaiter$13(this,void 0,void 0,function*(){const Nt=Bt?`${e}~${At}~${kt}-${Bt}`:`${e}~${At}~${kt}`,jt=this.getCursorStore();try{const Lt=yield jt.get(Nt);if(Lt)return JSON.parse(Lt)}catch(Lt){if(Lt.notFound)return}})}setCursor(e,At,kt,Bt,Nt){return __awaiter$13(this,void 0,void 0,function*(){const jt=Nt?`${e}~${At}~${kt}-${Nt}`:`${e}~${At}~${kt}`;yield this.getCursorStore().put(jt,JSON.stringify(Bt))})}messageExists(e,At){return __awaiter$13(this,void 0,void 0,function*(){const kt=this.getMessageStore(e);try{return yield kt.get(At),!0}catch(Bt){if(Bt.notFound)return!1;throw Bt}})}addMessage(e,At){return __awaiter$13(this,void 0,void 0,function*(){return yield this.getMessageStore(e).put(At,"")})}getMessageStore(e){return this._db.sublevel("history").sublevel(e).sublevel("messages")}getCursorStore(){return this._db.sublevel("cursors")}getPushQueue(){return this._db.sublevel("pushQueue")}getPullQueue(){return this._db.sublevel("pullQueue")}};var __awaiter$12=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$k=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};function buildOidcUrl$1({baseURL:xt,endpoint:e,authParam:At,tokenParam:kt}){switch(e){case"pushedAuthorizationRequest":return concatenateUrl$1(xt,"par");case"authorize":if(!At)throw new Error("authParam must be providied when building a token URL");return concatenateUrl$1(xt,`authorize/${At}.jwt`);case"callback":return concatenateUrl$1(xt,"callback");case"token":if(!kt)throw new Error("tokenParam must be providied when building a token URL");return concatenateUrl$1(xt,`token/${kt}.jwt`);default:throw new Error(`No matches for endpoint specified: ${e}`)}}function generateCodeChallenge$1(){return __awaiter$12(this,void 0,void 0,function*(){const xt=CryptoUtils.randomBytes(32),e=yield Sha256$1.digest({data:xt}),At=Convert.uint8Array(e).toBase64Url();return{codeChallengeBytes:e,codeChallengeBase64Url:At}})}function createAuthRequest$1(xt){return __awaiter$12(this,void 0,void 0,function*(){const e=CryptoUtils.randomBytes(16),At=CryptoUtils.randomBytes(16);return Object.assign(Object.assign({},xt),{nonce:Convert.uint8Array(At).toBase64Url(),response_type:"id_token",response_mode:"direct_post",state:Convert.uint8Array(e).toBase64Url(),client_metadata:{subject_syntax_types_supported:["did:dht","did:jwk"]}})})}function encryptAuthRequest$1({jwt:xt,encryptionKey:e}){return __awaiter$12(this,void 0,void 0,function*(){const At={alg:"dir",cty:"JWT",enc:"XC20P",typ:"JWT"},kt=CryptoUtils.randomBytes(24),Bt=Convert.object(At).toUint8Array(),Nt=Convert.string(xt).toUint8Array(),Lt=xchacha20poly1305(e,kt,Bt).encrypt(Nt),er=Lt.subarray(0,-16),tr=Lt.subarray(-16);return[Convert.object(At).toBase64Url(),"",Convert.uint8Array(kt).toBase64Url(),Convert.uint8Array(er).toBase64Url(),Convert.uint8Array(tr).toBase64Url()].join(".")})}function createResponseObject$1(xt){return __awaiter$12(this,void 0,void 0,function*(){const e=Math.floor(Date.now()/1e3);return Object.assign(Object.assign({},xt),{iat:e,exp:e+600})})}function signJwt$1({did:xt,data:e}){return __awaiter$12(this,void 0,void 0,function*(){const At=Convert.object({alg:"EdDSA",kid:xt.document.verificationMethod[0].id,typ:"JWT"}).toBase64Url(),kt=Convert.object(e).toBase64Url(),Nt=yield(yield xt.getSigner()).sign({data:Convert.string(`${At}.${kt}`).toUint8Array()}),jt=Convert.uint8Array(Nt).toBase64Url();return`${At}.${kt}.${jt}`})}function verifyJwt$1({jwt:xt}){var e,At;return __awaiter$12(this,void 0,void 0,function*(){const[kt,Bt,Nt]=xt.split("."),jt=Convert.base64Url(kt).toObject();if(!jt.kid)throw new Error("OIDC: Object could not be verified due to missing 'kid' header value.");const{didDocument:Lt}=yield DidJwk$1.resolve(jt.kid.split("#")[0]);if(!Lt)throw new Error("OIDC: Object could not be verified due to Client DID resolution issue.");const{publicKeyJwk:er}=(At=(e=Lt.verificationMethod)===null||e===void 0?void 0:e.find(nr=>nr.id===jt.kid))!==null&&At!==void 0?At:{};if(!er)throw new Error("OIDC: Object could not be verified due to missing public key in DID document.");if(!(yield new EdDsaAlgorithm$3().verify({key:er,signature:Convert.base64Url(Nt).toUint8Array(),data:Convert.string(`${kt}.${Bt}`).toUint8Array()})))throw new Error("OIDC: Object failed verification due to invalid signature.");return Convert.base64Url(Bt).toObject()})}const getAuthRequest$1=(xt,e)=>__awaiter$12(void 0,void 0,void 0,function*(){const kt=yield(yield fetch(xt)).text(),Bt=decryptAuthRequest$1({jwe:kt,encryption_key:e});return yield verifyJwt$1({jwt:Bt})});function decryptAuthRequest$1({jwe:xt,encryption_key:e}){const[At,,kt,Bt,Nt]=xt.split("."),jt=Convert.base64Url(e).toUint8Array(),er=Convert.base64Url(At).toUint8Array(),tr=Convert.base64Url(kt).toUint8Array(),zt=Convert.base64Url(Bt).toUint8Array(),rr=Convert.base64Url(Nt).toUint8Array(),nr=new Uint8Array([...zt,...rr]),ar=xchacha20poly1305(jt,tr,er).decrypt(nr);return Convert.uint8Array(ar).toString()}function decryptAuthResponse$1(xt,e,At){return __awaiter$12(this,void 0,void 0,function*(){const[kt,,Bt,Nt,jt]=e.split("."),Lt=Convert.base64Url(kt).toObject(),er=yield DidJwk$1.resolve(Lt.kid.split("#")[0]),tr=yield Oidc$1.deriveSharedKey(xt,er.didDocument),zt=Object.assign(Object.assign({},Lt),{pin:At}),rr=Convert.object(zt).toUint8Array(),nr=Convert.base64Url(Bt).toUint8Array(),ir=Convert.base64Url(Nt).toUint8Array(),ar=Convert.base64Url(jt).toUint8Array(),dr=new Uint8Array([...ir,...ar]),fr=xchacha20poly1305(tr,nr,rr).decrypt(dr);return Convert.uint8Array(fr).toString()})}function deriveSharedKey$1(xt,e){var At,kt;return __awaiter$12(this,void 0,void 0,function*(){const Bt=yield xt.export(),Nt=(At=e.verificationMethod)===null||At===void 0?void 0:At[0].publicKeyJwk,jt=(kt=Bt.privateKeys)===null||kt===void 0?void 0:kt[0];Nt.alg="EdDSA";const Lt=yield Ed25519$1.convertPublicKeyToX25519({publicKey:Nt}),er=yield Ed25519$1.convertPrivateKeyToX25519({privateKey:jt}),tr=yield X25519$1.sharedSecret({privateKeyA:er,publicKeyB:Lt}),zt=yield crypto.subtle.importKey("raw",tr,{name:"HKDF"},!1,["deriveBits"]),rr=yield crypto.subtle.deriveBits({name:"HKDF",hash:"SHA-256",info:new Uint8Array,salt:new Uint8Array},zt,256);return new Uint8Array(rr)})}function encryptAuthResponse$1({jwt:xt,encryptionKey:e,delegateDidKeyId:At,randomPin:kt}){const Bt={alg:"dir",cty:"JWT",enc:"XC20P",typ:"JWT",kid:At},Nt=CryptoUtils.randomBytes(24),jt=Convert.object(Object.assign(Object.assign({},Bt),{pin:kt})).toUint8Array(),Lt=Convert.string(xt).toUint8Array(),tr=xchacha20poly1305(e,Nt,jt).encrypt(Lt),zt=tr.subarray(0,-16),rr=tr.subarray(-16);return[Convert.object(Bt).toBase64Url(),"",Convert.uint8Array(Nt).toBase64Url(),Convert.uint8Array(zt).toBase64Url(),Convert.uint8Array(rr).toBase64Url()].join(".")}function shouldUseDelegatePermission$1(xt){return isRecordPermissionScope$1(xt)?!0:xt.interface===DwnInterfaceName.Protocols&&xt.method===DwnMethodName.Configure}function createPermissionGrants$1(xt,e,At,kt){return __awaiter$12(this,void 0,void 0,function*(){const Bt=new AgentPermissionsApi$1({agent:At}),jt=(yield Promise.all(kt.map(er=>{const tr=shouldUseDelegatePermission$1(er);return Bt.createGrant({delegated:tr,store:!0,grantedTo:e.uri,scope:er,dateExpires:"2040-06-25T16:09:16.693356Z",author:xt})}))).map(er=>__awaiter$12(this,void 0,void 0,function*(){const tr=er.message,{encodedData:zt}=tr,rr=__rest$k(tr,["encodedData"]),nr=Convert.base64Url(zt).toUint8Array(),{reply:ir}=yield At.sendDwnRequest({author:xt,target:xt,messageType:DwnInterface$1.RecordsWrite,dataStream:new Blob([nr]),rawMessage:rr});if(ir.status.code!==202&&ir.status.code!==409)throw new Error(`Could not send the message. Error details: ${ir.status.detail}`);return er.message}));return yield Promise.all(jt)})}function prepareProtocol$1(xt,e,At){return __awaiter$12(this,void 0,void 0,function*(){const kt=yield e.processDwnRequest({author:xt,messageType:DwnInterface$1.ProtocolsQuery,target:xt,messageParams:{filter:{protocol:At.protocol}}});if(kt.reply.status.code!==200)throw new Error(`Could not fetch protocol: ${kt.reply.status.detail}`);if(kt.reply.entries===void 0||kt.reply.entries.length===0){const{reply:Bt,message:Nt}=yield e.sendDwnRequest({author:xt,target:xt,messageType:DwnInterface$1.ProtocolsConfigure,messageParams:{definition:At}});if(Bt.status.code!==202&&Bt.status.code!==409)throw new Error(`Could not send protocol: ${Bt.status.detail}`);yield e.processDwnRequest({author:xt,target:xt,messageType:DwnInterface$1.ProtocolsConfigure,rawMessage:Nt})}else{const Bt=kt.reply.entries[0],{reply:Nt}=yield e.sendDwnRequest({author:xt,target:xt,messageType:DwnInterface$1.ProtocolsConfigure,rawMessage:Bt});if(Nt.status.code!==202&&Nt.status.code!==409)throw new Error(`Could not send protocol: ${Nt.status.detail}`)}})}function submitAuthResponse$1(xt,e,At,kt){return __awaiter$12(this,void 0,void 0,function*(){const Bt=yield DidJwk$1.create(),Nt=yield Bt.export(),jt=e.permissionRequests.map(ar=>__awaiter$12(this,void 0,void 0,function*(){const{protocolDefinition:dr,permissionScopes:ur}=ar;if(!ur.every(lr=>"protocol"in lr&&lr.protocol===dr.protocol))throw new Error("All permission scopes must match the protocol uri they are provided with.");return yield prepareProtocol$1(xt,kt,dr),yield Oidc$1.createPermissionGrants(xt,Bt,kt,ur)})),Lt=(yield Promise.all(jt)).flat(),er=yield Oidc$1.createResponseObject({iss:xt,sub:Bt.uri,aud:e.client_id,nonce:e.nonce,delegateGrants:Lt,delegatePortableDid:Nt}),tr=yield Oidc$1.signJwt({did:Bt,data:er}),zt=yield DidJwk$1.resolve(e.client_id),rr=yield Oidc$1.deriveSharedKey(Bt,zt==null?void 0:zt.didDocument),nr=Oidc$1.encryptAuthResponse({jwt:tr,encryptionKey:rr,delegateDidKeyId:Bt.document.verificationMethod[0].id,randomPin:At}),ir=new URLSearchParams({id_token:nr,state:e.state}).toString();yield fetch(e.redirect_uri,{body:ir,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}})})}const Oidc$1={createAuthRequest:createAuthRequest$1,encryptAuthRequest:encryptAuthRequest$1,getAuthRequest:getAuthRequest$1,decryptAuthRequest:decryptAuthRequest$1,createPermissionGrants:createPermissionGrants$1,createResponseObject:createResponseObject$1,encryptAuthResponse:encryptAuthResponse$1,decryptAuthResponse:decryptAuthResponse$1,deriveSharedKey:deriveSharedKey$1,signJwt:signJwt$1,verifyJwt:verifyJwt$1,buildOidcUrl:buildOidcUrl$1,generateCodeChallenge:generateCodeChallenge$1,submitAuthResponse:submitAuthResponse$1};var __awaiter$11=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function initClient$1({connectServerUrl:xt,walletUri:e,permissionRequests:At,onWalletUriReady:kt,validatePin:Bt}){return __awaiter$11(this,void 0,void 0,function*(){const Nt=yield DidJwk$1.create(),jt=CryptoUtils.randomBytes(32),Lt=Oidc$1.buildOidcUrl({baseURL:xt,endpoint:"callback"}),er=yield Oidc$1.createAuthRequest({client_id:Nt.uri,scope:"openid did:jwk",permissionRequests:At,redirect_uri:Lt}),tr=yield Oidc$1.signJwt({did:Nt,data:er});if(!tr)throw new Error("Unable to sign requestObject");const zt=yield Oidc$1.encryptAuthRequest({jwt:tr,encryptionKey:jt}),rr=new URLSearchParams({request:zt}),nr=Oidc$1.buildOidcUrl({baseURL:xt,endpoint:"pushedAuthorizationRequest"}),ir=yield fetch(nr,{body:rr,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!ir.ok)throw new Error(`${ir.status}: ${ir.statusText}`);const ar=yield ir.json(),dr=new URL(e);dr.searchParams.set("request_uri",ar.request_uri),dr.searchParams.set("encryption_key",Convert.uint8Array(jt).toBase64Url()),kt(dr.toString());const ur=Oidc$1.buildOidcUrl({baseURL:xt,endpoint:"token",tokenParam:er.state}),fr=yield pollWithTtl$1(()=>fetch(ur));if(fr){const pr=yield fr==null?void 0:fr.text(),lr=yield Bt(),yr=yield Oidc$1.decryptAuthResponse(Nt,pr,lr),br=yield Oidc$1.verifyJwt({jwt:yr});return{delegateGrants:br.delegateGrants,delegatePortableDid:br.delegatePortableDid,connectedDid:br.iss}}})}function createPermissionRequestForProtocol$1({definition:xt,permissions:e}){const At=[];At.push({protocol:xt.protocol,interface:DwnInterfaceName.Protocols,method:DwnMethodName.Query}),At.push({protocol:xt.protocol,interface:DwnInterfaceName.Messages,method:DwnMethodName.Read},{protocol:xt.protocol,interface:DwnInterfaceName.Messages,method:DwnMethodName.Query},{protocol:xt.protocol,interface:DwnInterfaceName.Messages,method:DwnMethodName.Subscribe});for(const kt of e)switch(kt){case"write":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Write});break;case"read":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Read});break;case"delete":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Delete});break;case"query":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Query});break;case"subscribe":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Subscribe});break;case"configure":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure});break}return{protocolDefinition:xt,permissionScopes:At}}const WalletConnect$1={initClient:initClient$1,createPermissionRequestForProtocol:createPermissionRequestForProtocol$1};var __awaiter$10=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$j=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class DidApi{constructor(e){this.agent=e.agent,this.connectedDid=e.connectedDid}create(e){return __awaiter$10(this,void 0,void 0,function*(){const At=yield this.agent.processDidRequest({messageType:DidInterface$1.Create,messageParams:Object.assign({},e)}),{result:kt}=At,Bt=__rest$j(At,["result"]);return Object.assign({did:kt},Bt)})}resolve(e,At){return __awaiter$10(this,void 0,void 0,function*(){const{result:kt}=yield this.agent.processDidRequest({messageParams:{didUri:e,options:At},messageType:DidInterface$1.Resolve});return kt})}}function dataToBlob(xt,e){let At;const kt=universalTypeOf(xt);if(e==="text/plain"||kt==="String")At=new Blob([xt],{type:"text/plain"});else if(e==="application/json"||kt==="Object"){const Bt=Convert.object(xt).toUint8Array();At=new Blob([Bt],{type:"application/json"})}else if(kt==="Uint8Array"||kt==="ArrayBuffer")At=new Blob([xt],{type:"application/octet-stream"});else if(kt==="Blob")At=xt;else throw new Error("data type not supported.");return e=e||At.type||"application/octet-stream",{dataBlob:At,dataFormat:e}}class SendCache{static check(e,At){let kt=SendCache.cache.get(e);return kt?kt.has(At):!1}static set(e,At){let kt=SendCache.cache.get(e)||new Set;if(SendCache.cache.delete(e),SendCache.cache.set(e,kt),this.cache.size>SendCache.sendCacheLimit){const Bt=SendCache.cache.keys().next().value;SendCache.cache.delete(Bt)}if(kt.delete(At),kt.add(At),kt.size>SendCache.sendCacheLimit){const Bt=kt.keys().next().value;kt.delete(Bt)}}}SendCache.cache=new Map;SendCache.sendCacheLimit=100;var __awaiter$$=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$i=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class Record{get _recordsWriteDescriptor(){if(isDwnMessage(DwnInterface$1.RecordsWrite,this.rawMessage))return this._descriptor}get _immutableProperties(){return this._recordsWriteDescriptor||this._initialWrite.descriptor}get id(){return this._recordId}get contextId(){return this.deleted?this._initialWrite.contextId:this._contextId}get dateCreated(){return this._immutableProperties.dateCreated}get parentId(){return this._immutableProperties.parentId}get protocol(){return this._immutableProperties.protocol}get protocolPath(){return this._immutableProperties.protocolPath}get recipient(){return this._immutableProperties.recipient}get schema(){return this._immutableProperties.schema}get dataFormat(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.dataFormat}get dataCid(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.dataCid}get dataSize(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.dataSize}get datePublished(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.datePublished}get published(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.published}get tags(){var e;return(e=this._recordsWriteDescriptor)===null||e===void 0?void 0:e.tags}get author(){return this._author}get creator(){return this._creator}get dateModified(){return this._descriptor.messageTimestamp}get encryption(){return this._encryption}get authorization(){return this._authorization}get attestation(){return this._attestation}get protocolRole(){return this._protocolRole}get deleted(){return isDwnMessage(DwnInterface$1.RecordsDelete,this.rawMessage)}get initialWrite(){return this._initialWrite}get rawMessage(){const e=this._descriptor.interface+this._descriptor.method;let At;return e===DwnInterface$1.RecordsWrite?At=JSON.parse(JSON.stringify({contextId:this._contextId,recordId:this._recordId,descriptor:this._descriptor,attestation:this._attestation,authorization:this._authorization,encryption:this._encryption})):At=JSON.parse(JSON.stringify({descriptor:this._descriptor,authorization:this._authorization})),removeUndefinedProperties(At),At}constructor(e,At,kt){this._agent=e,this._author=At.author,this._creator=At.initialWrite?getRecordAuthor(At.initialWrite):At.author,this._connectedDid=At.connectedDid,this._delegateDid=At.delegateDid,this._permissionsApi=kt??new AgentPermissionsApi$1({agent:e}),this._remoteOrigin=At.remoteOrigin,this._attestation=At.attestation,this._authorization=At.authorization,this._contextId=At.contextId,this._descriptor=At.descriptor,this._encryption=At.encryption,this._initialWrite=At.initialWrite,this._recordId=this.isRecordsDeleteDescriptor(At.descriptor)?At.descriptor.recordId:At.recordId,this._protocolRole=At.protocolRole,At.encodedData&&(this._encodedData=typeof At.encodedData=="string"?new Blob([Convert.base64Url(At.encodedData).toUint8Array()],{type:this.dataFormat}):At.encodedData),At.data&&(this._readableStream=Stream.isReadableStream(At.data)?NodeStream.fromWebReadable({readableStream:At.data}):At.data)}get data(){const e=this;return{blob(){return __awaiter$$(this,void 0,void 0,function*(){return new Blob([yield NodeStream.consumeToBytes({readable:yield this.stream()})],{type:e.dataFormat})})},bytes(){return __awaiter$$(this,void 0,void 0,function*(){return yield NodeStream.consumeToBytes({readable:yield this.stream()})})},json(){return __awaiter$$(this,void 0,void 0,function*(){return yield NodeStream.consumeToJson({readable:yield this.stream()})})},text(){return __awaiter$$(this,void 0,void 0,function*(){return yield NodeStream.consumeToText({readable:yield this.stream()})})},stream(){return __awaiter$$(this,void 0,void 0,function*(){if(e._encodedData?e._readableStream=NodeStream.fromWebReadable({readableStream:e._encodedData.stream()}):NodeStream.isReadable({readable:e._readableStream})||(e._readableStream=e._remoteOrigin?yield e.readRecordData({target:e._remoteOrigin,isRemote:!0}):yield e.readRecordData({target:e._connectedDid,isRemote:!1})),!e._readableStream)throw new Error("Record data is not available.");return e._readableStream})},then(kt,Bt){return this.stream().then(kt,Bt)},catch(kt){return this.stream().catch(kt)}}}store(e=!1){return __awaiter$$(this,void 0,void 0,function*(){return this.processRecord({signAsOwner:e,store:!0})})}import(e=!0){return __awaiter$$(this,void 0,void 0,function*(){return this.processRecord({store:e,signAsOwner:!0})})}send(e){return __awaiter$$(this,void 0,void 0,function*(){const At=this._initialWrite;if(e??(e=this._connectedDid),At&&!Record._sendCache.check(this._recordId,e)){const Nt=Object.assign({},At);removeUndefinedProperties(Nt),yield this._agent.sendDwnRequest({messageType:DwnInterface$1.RecordsWrite,author:this._connectedDid,target:e,rawMessage:Nt}),Record._sendCache.set(this._recordId,e)}let kt;this.deleted?kt={messageType:DwnInterface$1.RecordsDelete,author:this._connectedDid,target:e,rawMessage:Object.assign({},this.rawMessage)}:kt={messageType:DwnInterface$1.RecordsWrite,author:this._connectedDid,target:e,dataStream:yield this.data.blob(),rawMessage:Object.assign({},this.rawMessage)};const{reply:Bt}=yield this._agent.sendDwnRequest(kt);return Bt})}toJSON(){return{attestation:this.attestation,author:this.author,authorization:this.authorization,contextId:this.contextId,dataCid:this.dataCid,dataFormat:this.dataFormat,dataSize:this.dataSize,dateCreated:this.dateCreated,messageTimestamp:this.dateModified,datePublished:this.datePublished,encryption:this.encryption,parentId:this.parentId,protocol:this.protocol,protocolPath:this.protocolPath,protocolRole:this.protocolRole,published:this.published,recipient:this.recipient,recordId:this.id,schema:this.schema,tags:this.tags}}toString(){let e=`Record: {
`;return e+=`  ID: ${this.id}
`,e+=this.contextId?`  Context ID: ${this.contextId}
`:"",e+=this.protocol?`  Protocol: ${this.protocol}
`:"",e+=this.schema?`  Schema: ${this.schema}
`:"",this.deleted||(e+=`  Data CID: ${this.dataCid}
`,e+=`  Data Format: ${this.dataFormat}
`,e+=`  Data Size: ${this.dataSize}
`),e+=`  Deleted: ${this.deleted}
`,e+=`  Created: ${this.dateCreated}
`,e+=`  Modified: ${this.dateModified}
`,e+="}",e}paginationCursor(e){return __awaiter$$(this,void 0,void 0,function*(){return isDwnMessage(DwnInterface$1.RecordsWrite,this.rawMessage)?getPaginationCursor(this.rawMessage,e):void 0})}update(e){var{dateModified:At,data:kt}=e,Bt=__rest$i(e,["dateModified","data"]);return __awaiter$$(this,void 0,void 0,function*(){if(this.deleted)throw new Error("Record: Cannot revive a deleted record.");const Nt=this._recordsWriteDescriptor,{parentId:jt}=Nt,Lt=__rest$i(Nt,["parentId"]),er=jt?this._contextId.split("/").slice(0,-1).join("/"):void 0;let tr=Object.assign(Object.assign(Object.assign({},Lt),Bt),{parentContextId:er,messageTimestamp:At,recordId:this._recordId});(isEmptyObject(tr.tags)||tr.tags===null)&&delete tr.tags;let zt;kt!==void 0&&(delete tr.dataCid,delete tr.dataSize,{dataBlob:zt}=dataToBlob(kt,tr.dataFormat));const rr=new Set(["data","dataCid","dataFormat","dataSize","datePublished","messageTimestamp","published","tags"]);Record.verifyPermittedMutation(Object.keys(Bt),rr),Bt.published===!1&&tr.datePublished!==void 0&&delete tr.datePublished;const nr={author:this._connectedDid,dataStream:zt,messageParams:Object.assign({},tr),messageType:DwnInterface$1.RecordsWrite,target:this._connectedDid};if(this._delegateDid){const{message:fr}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:nr.messageType});nr.messageParams.delegatedGrant=fr,nr.granteeDid=this._delegateDid}const ir=yield this._agent.processDwnRequest(nr),{message:ar,reply:{status:dr}}=ir,ur=ar;return 200<=dr.code&&dr.code<=299&&(this._initialWrite||(this._initialWrite=Object.assign({},this.rawMessage)),this._authorization=ur.authorization,this._protocolRole=Bt.protocolRole,rr.forEach(fr=>{this._descriptor[fr]=ur.descriptor[fr]}),kt!==void 0&&(this._encodedData=zt)),{status:dr}})}delete(e){return __awaiter$$(this,void 0,void 0,function*(){const{store:At=!0,signAsOwner:kt,dateModified:Bt,prune:Nt=!1}=e||{},jt=kt&&this._delegateDid===void 0,Lt=kt&&this._delegateDid!==void 0;if(this.deleted&&!this._initialWrite)throw new Error("Record: Record is in an invalid state, initial write is missing.");this._initialWrite||(this._initialWrite=Object.assign({},this.rawMessage)),yield this.processInitialWriteIfNeeded({store:At,signAsOwner:kt});let er={messageType:DwnInterface$1.RecordsDelete,author:this._connectedDid,target:this._connectedDid,signAsOwner:jt,signAsOwnerDelegate:Lt,store:At};if(this.deleted?er.rawMessage=this.rawMessage:er.messageParams={prune:Nt,recordId:this._recordId,messageTimestamp:Bt},this._delegateDid){const{message:nr}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:er.messageType});er.messageParams=Object.assign(Object.assign({},er.messageParams),{delegatedGrant:nr}),er.granteeDid=this._delegateDid}const tr=yield this._agent.processDwnRequest(er),{message:zt,reply:{status:rr}}=tr;return rr.code!==202?{status:rr}:(this._author=getRecordAuthor(zt),this._descriptor=zt.descriptor,this._authorization=zt.authorization,this._encodedData=void 0,this._encryption=void 0,this._attestation=void 0,this._contextId=void 0,{status:rr})})}processInitialWriteIfNeeded({store:e,signAsOwner:At}){return __awaiter$$(this,void 0,void 0,function*(){if(this.initialWrite&&(At&&!this._initialWriteSigned||e&&!this._initialWriteStored)){const kt=At&&this._delegateDid===void 0,Bt=At&&this._delegateDid!==void 0,Nt={messageType:DwnInterface$1.RecordsWrite,rawMessage:this.initialWrite,author:this._connectedDid,target:this._connectedDid,signAsOwner:kt,signAsOwnerDelegate:Bt,store:e};if(this._delegateDid){const{message:zt}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:Nt.messageType});Nt.messageParams=Object.assign(Object.assign({},Nt.messageParams),{delegatedGrant:zt}),Nt.granteeDid=this._delegateDid}const jt=yield this._agent.processDwnRequest(Nt),{message:Lt,reply:{status:er}}=jt,tr=Lt;200<=er.code&&er.code<=299&&(e&&(this._initialWriteStored=!0),At&&(this._initialWriteSigned=!0,this.initialWrite.authorization=tr.authorization))}})}processRecord({store:e,signAsOwner:At}){return __awaiter$$(this,void 0,void 0,function*(){const kt=At&&this._delegateDid===void 0,Bt=At&&this._delegateDid!==void 0;yield this.processInitialWriteIfNeeded({store:e,signAsOwner:At});let Nt;if(this.deleted?Nt={messageType:DwnInterface$1.RecordsDelete,rawMessage:this.rawMessage,author:this._connectedDid,target:this._connectedDid,signAsOwner:kt,signAsOwnerDelegate:Bt,store:e}:Nt={messageType:DwnInterface$1.RecordsWrite,rawMessage:this.rawMessage,author:this._connectedDid,target:this._connectedDid,dataStream:yield this.data.blob(),signAsOwner:kt,signAsOwnerDelegate:Bt,store:e},this._delegateDid){const{message:zt}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:Nt.messageType});Nt.messageParams=Object.assign(Object.assign({},Nt.messageParams),{delegatedGrant:zt}),Nt.granteeDid=this._delegateDid}const jt=yield this._agent.processDwnRequest(Nt),{message:Lt,reply:{status:er}}=jt,tr=Lt;return 200<=er.code&&er.code<=299&&At&&(this._authorization=tr.authorization),{status:er}})}readRecordData({target:e,isRemote:At}){return __awaiter$$(this,void 0,void 0,function*(){const kt={author:this._connectedDid,messageParams:{filter:{recordId:this.id}},messageType:DwnInterface$1.RecordsRead,target:e};if(this._delegateDid)try{const{message:Nt}=yield this._permissionsApi.getPermissionForRequest({connectedDid:this._connectedDid,delegateDid:this._delegateDid,protocol:this.protocol,delegate:!0,cached:!0,messageType:kt.messageType});kt.messageParams=Object.assign(Object.assign({},kt.messageParams),{delegatedGrant:Nt}),kt.granteeDid=this._delegateDid}catch{kt.author=this._delegateDid}const Bt=At?this._agent.sendDwnRequest(kt):this._agent.processDwnRequest(kt);try{const{reply:{status:Nt,record:jt}}=yield Bt;if(Nt.code!==200)throw new Error(`${Nt.code}: ${Nt.detail}`);const Lt=jt.data;return Stream.isReadableStream(Lt)?NodeStream.fromWebReadable({readableStream:Lt}):Lt}catch(Nt){throw new Error(`Error encountered while attempting to read data: ${Nt.message}`)}})}static verifyPermittedMutation(e,At){for(const kt of e)if(!At.has(kt))throw new Error(`${kt} is an immutable property. Its value cannot be changed.`)}isRecordsDeleteDescriptor(e){return e.interface+e.method===DwnInterface$1.RecordsDelete}}Record._sendCache=SendCache;var __awaiter$_=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Protocol{constructor(e,At,kt){this._agent=e,this._metadata=kt,this._protocolsConfigureMessage=At}get definition(){return this._protocolsConfigureMessage.descriptor.definition}toJSON(){return this._protocolsConfigureMessage}send(e){return __awaiter$_(this,void 0,void 0,function*(){const{reply:At}=yield this._agent.sendDwnRequest({author:this._metadata.author,messageCid:this._metadata.messageCid,messageType:DwnInterface$1.ProtocolsConfigure,target:e});return{status:At.status}})}}var __awaiter$Z=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$h=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class PermissionGrantRevocation{constructor(e,At){this._permissions=e,this._connectedDid=At.connectedDid,this._message=At.message}get author(){return getRecordAuthor(this._message)}static parse({connectedDid:e,agent:At,message:kt}){return __awaiter$Z(this,void 0,void 0,function*(){const Bt=new AgentPermissionsApi$1({agent:At});return new PermissionGrantRevocation(Bt,{connectedDid:e,message:kt})})}get agent(){return this._permissions.agent}get rawMessage(){return this._message}send(e){return __awaiter$Z(this,void 0,void 0,function*(){e??(e=this._connectedDid);const At=this._message,{encodedData:kt}=At,Bt=__rest$h(At,["encodedData"]),Nt=new Blob([Convert.base64Url(kt).toUint8Array()]),jt={messageType:DwnInterface$1.RecordsWrite,author:this._connectedDid,target:e,dataStream:Nt,rawMessage:Bt},{reply:Lt}=yield this.agent.sendDwnRequest(jt);return Lt})}store(e){return __awaiter$Z(this,void 0,void 0,function*(){const At=this.rawMessage,{encodedData:kt}=At,Bt=__rest$h(At,["encodedData"]),Nt=new Blob([Convert.base64Url(kt).toUint8Array()]),{reply:jt,message:Lt}=yield this.agent.processDwnRequest({author:this._connectedDid,target:this._connectedDid,messageType:DwnInterface$1.RecordsWrite,signAsOwner:e,rawMessage:Bt,dataStream:Nt});return this._message=Object.assign(Object.assign({},Lt),{encodedData:kt}),{status:jt.status}})}}var __awaiter$Y=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$g=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class PermissionGrant{constructor({api:e,connectedDid:At,message:kt,grant:Bt}){this._permissions=e,this._connectedDid=At,this._message=kt,this._grant=Bt}static parse(e){return __awaiter$Y(this,void 0,void 0,function*(){const At=yield PermissionGrant$1.parse(e.message),kt=new AgentPermissionsApi$1({agent:e.agent});return new PermissionGrant(Object.assign(Object.assign({},e),{grant:At,api:kt}))})}get agent(){return this._permissions.agent}get id(){return this._grant.id}get grantor(){return this._grant.grantor}get grantee(){return this._grant.grantee}get dateGranted(){return this._grant.dateGranted}get description(){return this._grant.description}get requestId(){return this._grant.requestId}get dateExpires(){return this._grant.dateExpires}get delegated(){return this._grant.delegated}get scope(){return this._grant.scope}get conditions(){return this._grant.conditions}get rawMessage(){return this._message}send(e){return __awaiter$Y(this,void 0,void 0,function*(){e??(e=this._connectedDid);const At=this._message,{encodedData:kt}=At,Bt=__rest$g(At,["encodedData"]),Nt=new Blob([Convert.base64Url(kt).toUint8Array()]),jt={messageType:DwnInterface$1.RecordsWrite,author:this._connectedDid,target:e,dataStream:Nt,rawMessage:Bt},{reply:Lt}=yield this.agent.sendDwnRequest(jt);return Lt})}store(e=!1){return __awaiter$Y(this,void 0,void 0,function*(){const At=this.rawMessage,{encodedData:kt}=At,Bt=__rest$g(At,["encodedData"]),Nt=new Blob([Convert.base64Url(kt).toUint8Array()]),{reply:jt,message:Lt}=yield this.agent.processDwnRequest({store:!0,author:this._connectedDid,target:this._connectedDid,messageType:DwnInterface$1.RecordsWrite,signAsOwner:e,rawMessage:Bt,dataStream:Nt});return this._message=Object.assign(Object.assign({},Lt),{encodedData:kt}),{status:jt.status}})}import(e=!1){return __awaiter$Y(this,void 0,void 0,function*(){const At=this.rawMessage,{encodedData:kt}=At,Bt=__rest$g(At,["encodedData"]),Nt=new Blob([Convert.base64Url(kt).toUint8Array()]),{reply:jt,message:Lt}=yield this.agent.processDwnRequest({store:e,author:this._connectedDid,target:this._connectedDid,messageType:DwnInterface$1.RecordsWrite,signAsOwner:!0,rawMessage:Bt,dataStream:Nt});return this._message=Object.assign(Object.assign({},Lt),{encodedData:kt}),{status:jt.status}})}revoke(e=!0){return __awaiter$Y(this,void 0,void 0,function*(){const At=yield this._permissions.createRevocation({store:e,author:this._connectedDid,grant:this._grant});return PermissionGrantRevocation.parse({connectedDid:this._connectedDid,agent:this.agent,message:At.message})})}isRevoked(e=!1){return this._permissions.isGrantRevoked({author:this._connectedDid,target:this.grantor,grantRecordId:this.id,remote:e})}toJSON(){return{id:this.id,grantor:this.grantor,grantee:this.grantee,dateGranted:this.dateGranted,description:this.description,requestId:this.requestId,dateExpires:this.dateExpires,delegated:this.delegated,scope:this.scope,conditions:this.conditions}}}var __awaiter$X=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$f=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class PermissionRequest{constructor({api:e,connectedDid:At,message:kt,request:Bt}){this._permissions=e,this._connectedDid=At,this._request=Bt,this._message=kt}static parse({connectedDid:e,agent:At,message:kt}){return __awaiter$X(this,void 0,void 0,function*(){const Bt=yield PermissionRequest$1.parse(kt),Nt=new AgentPermissionsApi$1({agent:At});return new PermissionRequest({api:Nt,connectedDid:e,message:kt,request:Bt})})}get agent(){return this._permissions.agent}get id(){return this._request.id}get requester(){return this._request.requester}get description(){return this._request.description}get delegated(){return this._request.delegated}get scope(){return this._request.scope}get conditions(){return this._request.conditions}get rawMessage(){return this._message}send(e){return __awaiter$X(this,void 0,void 0,function*(){e??(e=this._connectedDid);const At=this._message,{encodedData:kt}=At,Bt=__rest$f(At,["encodedData"]),Nt=new Blob([Convert.base64Url(kt).toUint8Array()]),jt={messageType:DwnInterface$1.RecordsWrite,author:this._connectedDid,target:e,dataStream:Nt,rawMessage:Bt},{reply:Lt}=yield this.agent.sendDwnRequest(jt);return Lt})}store(){return __awaiter$X(this,void 0,void 0,function*(){const e=this.rawMessage,{encodedData:At}=e,kt=__rest$f(e,["encodedData"]),Bt=new Blob([Convert.base64Url(At).toUint8Array()]),{reply:Nt,message:jt}=yield this.agent.processDwnRequest({author:this._connectedDid,target:this._connectedDid,messageType:DwnInterface$1.RecordsWrite,rawMessage:kt,dataStream:Bt});return this._message=Object.assign(Object.assign({},jt),{encodedData:At}),{status:Nt.status}})}grant(e,At=!0){return __awaiter$X(this,void 0,void 0,function*(){const{message:kt}=yield this._permissions.createGrant({requestId:this.id,grantedTo:this.requester,scope:this.scope,delegated:this.delegated,author:this._connectedDid,store:At,dateExpires:e});return PermissionGrant.parse({connectedDid:this._connectedDid,agent:this.agent,message:kt})})}toJSON(){return this._request}}var __awaiter$W=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class SubscriptionUtil{static recordSubscriptionHandler({agent:e,connectedDid:At,request:kt,delegateDid:Bt,permissionsApi:Nt}){const{subscriptionHandler:jt,from:Lt}=kt;return er=>__awaiter$W(this,void 0,void 0,function*(){const{message:tr,initialWrite:zt}=er,nr={author:getRecordAuthor(tr),connectedDid:At,remoteOrigin:Lt,initialWrite:zt},ir=new Record(e,Object.assign(Object.assign(Object.assign({},tr),nr),{delegateDid:Bt}),Nt);jt(ir)})}}var __awaiter$V=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$e=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class DwnApi{constructor(e){this.agent=e.agent,this.connectedDid=e.connectedDid,this.delegateDid=e.delegateDid,this.permissionsApi=new AgentPermissionsApi$1({agent:this.agent})}get permissions(){return{request:e=>__awaiter$V(this,void 0,void 0,function*(){var At,kt;const{message:Bt}=yield this.permissionsApi.createRequest(Object.assign(Object.assign({},e),{author:(At=this.delegateDid)!==null&&At!==void 0?At:this.connectedDid})),Nt={connectedDid:(kt=this.delegateDid)!==null&&kt!==void 0?kt:this.connectedDid,agent:this.agent,message:Bt};return yield PermissionRequest.parse(Nt)}),grant:e=>__awaiter$V(this,void 0,void 0,function*(){var At,kt;const{message:Bt}=yield this.permissionsApi.createGrant(Object.assign(Object.assign({},e),{author:(At=this.delegateDid)!==null&&At!==void 0?At:this.connectedDid})),Nt={connectedDid:(kt=this.delegateDid)!==null&&kt!==void 0?kt:this.connectedDid,agent:this.agent,message:Bt};return yield PermissionGrant.parse(Nt)}),queryRequests:(e={})=>__awaiter$V(this,void 0,void 0,function*(){var At,kt,Bt;const{from:Nt}=e,jt=__rest$e(e,["from"]),Lt=yield this.permissionsApi.fetchRequests(Object.assign(Object.assign({},jt),{author:(At=this.delegateDid)!==null&&At!==void 0?At:this.connectedDid,target:(kt=Nt??this.delegateDid)!==null&&kt!==void 0?kt:this.connectedDid,remote:Nt!==void 0})),er=[];for(const tr of Lt){const zt={connectedDid:(Bt=this.delegateDid)!==null&&Bt!==void 0?Bt:this.connectedDid,agent:this.agent,message:tr.message};er.push(yield PermissionRequest.parse(zt))}return er}),queryGrants:(e={})=>__awaiter$V(this,void 0,void 0,function*(){var At,kt,Bt;const{checkRevoked:Nt,from:jt}=e,Lt=__rest$e(e,["checkRevoked","from"]),er=jt!==void 0,tr=(At=this.delegateDid)!==null&&At!==void 0?At:this.connectedDid,zt=(kt=jt??this.delegateDid)!==null&&kt!==void 0?kt:this.connectedDid,rr=yield this.permissionsApi.fetchGrants(Object.assign(Object.assign({},Lt),{author:tr,target:zt,remote:er})),nr=[];for(const ir of rr){const ar={connectedDid:(Bt=this.delegateDid)!==null&&Bt!==void 0?Bt:this.connectedDid,agent:this.agent,message:ir.message};if(Nt){const dr=ir.grant.id;if(yield this.permissionsApi.isGrantRevoked({author:tr,target:zt,grantRecordId:dr,remote:er}))continue}nr.push(yield PermissionGrant.parse(ar))}return nr})}}get protocols(){return{configure:e=>__awaiter$V(this,void 0,void 0,function*(){const At={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface$1.ProtocolsConfigure,target:this.connectedDid};if(this.delegateDid){const{message:er}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.message.definition.protocol,delegate:!0,cached:!0,messageType:At.messageType});At.messageParams=Object.assign(Object.assign({},At.messageParams),{delegatedGrant:er}),At.granteeDid=this.delegateDid}const kt=yield this.agent.processDwnRequest(At),{message:Bt,messageCid:Nt,reply:{status:jt}}=kt,Lt={status:jt};if(jt.code<300){const er={author:this.connectedDid,messageCid:Nt};Lt.protocol=new Protocol(this.agent,Bt,er)}return Lt}),query:e=>__awaiter$V(this,void 0,void 0,function*(){const At={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface$1.ProtocolsQuery,target:e.from||this.connectedDid};if(this.delegateDid)try{const{grant:{id:er}}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.message.filter.protocol,cached:!0,messageType:At.messageType});At.messageParams=Object.assign(Object.assign({},At.messageParams),{permissionGrantId:er}),At.granteeDid=this.delegateDid}catch{At.author=this.delegateDid}let kt;e.from?kt=yield this.agent.sendDwnRequest(At):kt=yield this.agent.processDwnRequest(At);const Bt=kt.reply,{entries:Nt=[],status:jt}=Bt;return{protocols:Nt.map(er=>{const tr={author:this.connectedDid};return new Protocol(this.agent,er,tr)}),status:jt}})}}get records(){return{create:e=>__awaiter$V(this,void 0,void 0,function*(){return this.records.write(e)}),createFrom:e=>__awaiter$V(this,void 0,void 0,function*(){var At;const kt=e.record.toJSON(),{author:Bt}=kt,Nt=__rest$e(kt,["author"]);return e.data!==void 0&&(delete Nt.dataCid,delete Nt.dataSize),((At=e.message)===null||At===void 0?void 0:At.published)===!1&&Nt.datePublished!==void 0&&(delete Nt.datePublished,delete Nt.published),(!isEmptyObject(e.message)||e.author&&e.author!==Bt)&&delete Nt.recordId,this.records.write({data:e.data,message:Object.assign(Object.assign({},Nt),e.message)})}),delete:e=>__awaiter$V(this,void 0,void 0,function*(){const At={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface$1.RecordsDelete,target:e.from||this.connectedDid};if(this.delegateDid){const{message:Nt}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:At.messageType});At.messageParams=Object.assign(Object.assign({},At.messageParams),{delegatedGrant:Nt}),At.granteeDid=this.delegateDid}let kt;e.from?kt=yield this.agent.sendDwnRequest(At):kt=yield this.agent.processDwnRequest(At);const{reply:{status:Bt}}=kt;return{status:Bt}}),query:e=>__awaiter$V(this,void 0,void 0,function*(){const At={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface$1.RecordsQuery,target:e.from||this.connectedDid};if(this.delegateDid)try{const{message:tr}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:At.messageType});At.messageParams=Object.assign(Object.assign({},At.messageParams),{delegatedGrant:tr}),At.granteeDid=this.delegateDid}catch{At.author=this.delegateDid}let kt;e.from?kt=yield this.agent.sendDwnRequest(At):kt=yield this.agent.processDwnRequest(At);const Bt=kt.reply,{entries:Nt=[],status:jt,cursor:Lt}=Bt;return{records:Nt.map(tr=>{const zt=Object.assign({author:getRecordAuthor(tr),connectedDid:this.connectedDid,remoteOrigin:e.from,delegateDid:this.delegateDid},tr);return new Record(this.agent,zt,this.permissionsApi)}),status:jt,cursor:Lt}}),read:e=>__awaiter$V(this,void 0,void 0,function*(){const At={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface$1.RecordsRead,target:e.from||this.connectedDid};if(this.delegateDid)try{const{message:Lt}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:At.messageType});At.messageParams=Object.assign(Object.assign({},At.messageParams),{delegatedGrant:Lt}),At.granteeDid=this.delegateDid}catch{At.author=this.delegateDid}let kt;e.from?kt=yield this.agent.sendDwnRequest(At):kt=yield this.agent.processDwnRequest(At);const{reply:{record:Bt,status:Nt}}=kt;let jt;if(200<=Nt.code&&Nt.code<=299){const Lt=Object.assign({author:getRecordAuthor(Bt),connectedDid:this.connectedDid,remoteOrigin:e.from,delegateDid:this.delegateDid},Bt);jt=new Record(this.agent,Lt,this.permissionsApi)}return{record:jt,status:Nt}}),subscribe:e=>__awaiter$V(this,void 0,void 0,function*(){const At={author:this.connectedDid,messageParams:e.message,messageType:DwnInterface$1.RecordsSubscribe,target:e.from||this.connectedDid,subscriptionHandler:SubscriptionUtil.recordSubscriptionHandler({agent:this.agent,connectedDid:this.connectedDid,delegateDid:this.delegateDid,permissionsApi:this.permissionsApi,request:e})};if(this.delegateDid)try{const{message:Lt}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.protocol,delegate:!0,cached:!0,messageType:At.messageType});At.messageParams=Object.assign(Object.assign({},At.messageParams),{delegatedGrant:Lt}),At.granteeDid=this.delegateDid}catch{At.author=this.delegateDid}let kt;e.from?kt=yield this.agent.sendDwnRequest(At):kt=yield this.agent.processDwnRequest(At);const Bt=kt.reply,{status:Nt,subscription:jt}=Bt;return{status:Nt,subscription:jt}}),write:e=>__awaiter$V(this,void 0,void 0,function*(){var At;const{dataBlob:kt,dataFormat:Bt}=dataToBlob(e.data,(At=e.message)===null||At===void 0?void 0:At.dataFormat),Nt={store:e.store,messageType:DwnInterface$1.RecordsWrite,messageParams:Object.assign(Object.assign({},e.message),{dataFormat:Bt}),author:this.connectedDid,target:this.connectedDid,dataStream:kt};if(this.delegateDid){const{message:zt}=yield this.permissionsApi.getPermissionForRequest({connectedDid:this.connectedDid,delegateDid:this.delegateDid,protocol:e.message.protocol,delegate:!0,cached:!0,messageType:Nt.messageType});Nt.messageParams=Object.assign(Object.assign({},Nt.messageParams),{delegatedGrant:zt}),Nt.granteeDid=this.delegateDid}const jt=yield this.agent.processDwnRequest(Nt),{message:Lt,reply:{status:er}}=jt;let tr;if(200<=er.code&&er.code<=299){const zt=Object.assign({author:this.connectedDid,connectedDid:this.connectedDid,encodedData:kt,delegateDid:this.delegateDid},Lt);tr=new Record(this.agent,zt,this.permissionsApi)}return{record:tr,status:er}})}}}var __awaiter$U=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class VcApi{constructor(e){this.agent=e.agent,this.connectedDid=e.connectedDid}create(){return __awaiter$U(this,void 0,void 0,function*(){throw new Error("Not implemented.")})}}var __awaiter$T=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let Web5UserAgent$1=class Ml{constructor(e){this._agentDid=e.agentDid,this.crypto=e.cryptoApi,this.did=e.didApi,this.dwn=e.dwnApi,this.identity=e.identityApi,this.keyManager=e.keyManager,this.permissions=e.permissionsApi,this.rpc=e.rpcClient,this.sync=e.syncApi,this.vault=e.agentVault,this.did.agent=this,this.dwn.agent=this,this.identity.agent=this,this.keyManager.agent=this,this.permissions.agent=this,this.sync.agent=this}get agentDid(){if(this._agentDid===void 0)throw new Error('Web5UserAgent: The "agentDid" property is not set. Ensure the agent is properly initialized and a DID is assigned.');return this._agentDid}set agentDid(e){this._agentDid=e}static create({dataPath:e="DATA/AGENT",agentDid:At,agentVault:kt,cryptoApi:Bt,didApi:Nt,dwnApi:jt,identityApi:Lt,keyManager:er,permissionsApi:tr,rpcClient:zt,syncApi:rr}={}){return __awaiter$T(this,void 0,void 0,function*(){return kt??(kt=new HdIdentityVault$1({keyDerivationWorkFactor:21e4,store:new LevelStore({location:`${e}/VAULT_STORE`})})),Bt??(Bt=new AgentCryptoApi$1),Nt??(Nt=new AgentDidApi$1({didMethods:[DidDht$1,DidJwk$1],resolverCache:new AgentDidResolverCache$1({location:`${e}/DID_RESOLVERCACHE`}),store:new DwnDidStore$1})),jt??(jt=new AgentDwnApi$1({dwn:yield AgentDwnApi$1.createDwn({dataPath:e,didResolver:Nt})})),Lt??(Lt=new AgentIdentityApi$1({store:new DwnIdentityStore$1})),er??(er=new LocalKeyManager$2({keyStore:new DwnKeyStore$1})),tr??(tr=new AgentPermissionsApi$1),zt??(zt=new Web5RpcClient$1),rr??(rr=new AgentSyncApi$1({syncEngine:new SyncEngineLevel$1({dataPath:e})})),new Ml({agentDid:At,agentVault:kt,cryptoApi:Bt,didApi:Nt,dwnApi:jt,keyManager:er,permissionsApi:tr,identityApi:Lt,rpcClient:zt,syncApi:rr})})}firstLaunch(){return __awaiter$T(this,void 0,void 0,function*(){return(yield this.vault.isInitialized())===!1})}initialize({password:e,recoveryPhrase:At,dwnEndpoints:kt}){return __awaiter$T(this,void 0,void 0,function*(){return At=yield this.vault.initialize({password:e,recoveryPhrase:At,dwnEndpoints:kt}),At})}processDidRequest(e){return __awaiter$T(this,void 0,void 0,function*(){return this.did.processRequest(e)})}processDwnRequest(e){return __awaiter$T(this,void 0,void 0,function*(){return this.dwn.processRequest(e)})}processVcRequest(e){return __awaiter$T(this,void 0,void 0,function*(){throw new Error("Not implemented")})}sendDidRequest(e){return __awaiter$T(this,void 0,void 0,function*(){throw new Error("Not implemented")})}sendDwnRequest(e){return __awaiter$T(this,void 0,void 0,function*(){return this.dwn.sendRequest(e)})}sendVcRequest(e){return __awaiter$T(this,void 0,void 0,function*(){throw new Error("Not implemented")})}start({password:e}){return __awaiter$T(this,void 0,void 0,function*(){this.vault.isLocked()&&(yield this.vault.unlock({password:e})),this.agentDid=yield this.vault.getDid()})}};var __awaiter$S=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$d=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class Web5{constructor({agent:e,connectedDid:At,delegateDid:kt}){this.agent=e,this.did=new DidApi({agent:e,connectedDid:At}),this.dwn=new DwnApi({agent:e,connectedDid:At,delegateDid:kt}),this.vc=new VcApi({agent:e,connectedDid:At})}static connect({agent:e,agentVault:At,connectedDid:kt,password:Bt,recoveryPhrase:Nt,sync:jt,techPreview:Lt,didCreateOptions:er,registration:tr,walletConnectOptions:zt}={}){var rr,nr,ir;return __awaiter$S(this,void 0,void 0,function*(){let ar;if(e===void 0){let ur=!1;const fr=yield Web5UserAgent$1.create({agentVault:At});e=fr,Bt===void 0&&(Bt="insecure-static-phrase",console.warn("%cSECURITY WARNING:%c You have not set a password, which defaults to a static, guessable value. This significantly compromises the security of your data. Please configure a secure, unique password.","font-weight: bold; color: red;","font-weight: normal; color: inherit;"));const pr=(nr=(rr=Lt==null?void 0:Lt.dwnEndpoints)!==null&&rr!==void 0?rr:er==null?void 0:er.dwnEndpoints)!==null&&nr!==void 0?nr:["https://dwn.tbddev.org/beta"];(yield fr.firstLaunch())&&(Nt=yield fr.initialize({password:Bt,recoveryPhrase:Nt,dwnEndpoints:pr})),yield fr.start({password:Bt});const lr=yield fr.identity.connectedIdentity();let yr,br=[];if(lr)yr=lr;else if(zt){if(jt==="off")throw new Error("Sync must not be disabled when using WalletConnect");ur=!0;try{const{permissionRequests:Ar}=zt,Pr=__rest$d(zt,["permissionRequests"]),kr=Ar.map(({protocolDefinition:Sr,permissions:_r})=>WalletConnect$1.createPermissionRequestForProtocol({definition:Sr,permissions:_r??["read","write","delete","query","subscribe"]})),{delegatePortableDid:Ur,connectedDid:Hr,delegateGrants:Lr}=yield WalletConnect$1.initClient(Object.assign(Object.assign({},Pr),{permissionRequests:kr}));yr=yield fr.identity.import({portableIdentity:{portableDid:Ur,metadata:{connectedDid:Hr,name:"Default",tenant:Ur.uri,uri:Ur.uri}}}),yield fr.identity.manage({portableIdentity:yield yr.export()}),br=yield this.processConnectedGrants({agent:e,delegateDid:Ur.uri,grants:Lr})}catch(Ar){throw yield this.cleanUpIdentity({identity:yr,userAgent:fr}),new Error(`Failed to connect to wallet: ${Ar.message}`)}}else{const Ar=yield fr.identity.list();Ar.length===0?(ur=!0,yr=yield fr.identity.create({didMethod:"dht",metadata:{name:"Default"},didOptions:{services:[{id:"dwn",type:"DecentralizedWebNode",serviceEndpoint:pr,enc:"#enc",sig:"#sig"}],verificationMethods:[{algorithm:"Ed25519",id:"sig",purposes:["assertionMethod","authentication"]},{algorithm:"secp256k1",id:"enc",purposes:["keyAgreement"]}]}}),yield fr.identity.manage({portableIdentity:yield yr.export()})):yr=Ar[0]}if(kt=(ir=yr.metadata.connectedDid)!==null&&ir!==void 0?ir:yr.did.uri,ar=yr.metadata.connectedDid?yr.did.uri:void 0,tr!==void 0)try{for(const Ar of pr)(yield fr.rpc.getServerInfo(Ar)).registrationRequirements.length!==0&&(yield DwnRegistrar.registerTenant(Ar,e.agentDid.uri),yield DwnRegistrar.registerTenant(Ar,kt));tr.onSuccess()}catch(Ar){tr.onFailure(Ar)}jt!=="off"&&(ur&&(yield fr.sync.registerIdentity({did:kt,options:{delegateDid:ar,protocols:br}}),zt!==void 0&&(yield fr.sync.sync("pull"))),jt??(jt="2m"),fr.sync.startSync({interval:jt}).catch(Ar=>{console.error(`Sync failed: ${Ar}`)}))}return{web5:new Web5({agent:e,connectedDid:kt,delegateDid:ar}),did:kt,delegateDid:ar,recoveryPhrase:Nt}})}static cleanUpIdentity({identity:e,userAgent:At}){return __awaiter$S(this,void 0,void 0,function*(){try{yield At.did.delete({didUri:e.did.uri,tenant:e.metadata.tenant,deleteKey:!0})}catch(kt){console.error(`Failed to delete DID ${e.did.uri}: ${kt.message}`)}try{yield At.identity.delete({didUri:e.did.uri})}catch(kt){console.error(`Failed to delete Identity ${e.metadata.name}: ${kt.message}`)}})}static processConnectedGrants({grants:e,agent:At,delegateDid:kt}){return __awaiter$S(this,void 0,void 0,function*(){const Bt=new Set;for(const Nt of e){const jt=yield PermissionGrant.parse({connectedDid:kt,agent:At,message:Nt}),{status:Lt}=yield jt.store(!0);if(Lt.code!==202)throw new Error(`AgentDwnApi: Failed to process connected grant: ${Lt.detail}`);const er=jt.scope.protocol;er&&Bt.add(er)}return[...Bt]})}}var DwnInterface;(function(xt){xt.MessagesQuery="MessagesQuery",xt.MessagesRead="MessagesRead",xt.MessagesSubscribe="MessagesSubscribe",xt.ProtocolsConfigure="ProtocolsConfigure",xt.ProtocolsQuery="ProtocolsQuery",xt.RecordsDelete="RecordsDelete",xt.RecordsQuery="RecordsQuery",xt.RecordsRead="RecordsRead",xt.RecordsSubscribe="RecordsSubscribe",xt.RecordsWrite="RecordsWrite"})(DwnInterface||(DwnInterface={}));const dwnMessageConstructors={[DwnInterface.MessagesQuery]:MessagesQuery,[DwnInterface.MessagesRead]:MessagesRead,[DwnInterface.MessagesSubscribe]:MessagesSubscribe,[DwnInterface.ProtocolsConfigure]:ProtocolsConfigure,[DwnInterface.ProtocolsQuery]:ProtocolsQuery,[DwnInterface.RecordsDelete]:RecordsDelete,[DwnInterface.RecordsQuery]:RecordsQuery,[DwnInterface.RecordsRead]:RecordsRead,[DwnInterface.RecordsSubscribe]:RecordsSubscribe,[DwnInterface.RecordsWrite]:RecordsWrite};var __awaiter$R=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class AgentDidResolverCache extends DidResolverCacheLevel$1{constructor({agent:e,db:At,location:kt,ttl:Bt}){super({db:At,location:kt,ttl:Bt}),this._resolving=new Map,this._agent=e}get agent(){if(!this._agent)throw new Error("Agent not initialized");return this._agent}set agent(e){this._agent=e}get(e){return __awaiter$R(this,void 0,void 0,function*(){try{const At=yield this.cache.get(e),kt=JSON.parse(At);if(!this._resolving.has(e)&&Date.now()>=kt.ttlMillis)if(this._resolving.set(e,!0),this.agent.agentDid.uri===e||typeof(yield this.agent.identity.get({didUri:e}))<"u")try{const Bt=yield this.agent.did.resolve(e);Bt.didResolutionMetadata.error||this.set(e,Bt)}finally{this._resolving.delete(e)}else this._resolving.delete(e),this.cache.nextTick(()=>this.cache.del(e));return kt.value}catch(At){if(At.notFound)return;throw At}})}}var __awaiter$Q=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class BearerIdentity{constructor({did:e,metadata:At}){this.did=e,this.metadata=At}export(){return __awaiter$Q(this,void 0,void 0,function*(){return{portableDid:yield this.did.export(),metadata:this.metadata}})}}var __awaiter$P=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Hkdf{static deriveKeyBytes({baseKeyBytes:e,length:At,hash:kt,salt:Bt,info:Nt=new Uint8Array}){return __awaiter$P(this,void 0,void 0,function*(){const Lt=yield getWebcryptoSubtle().importKey("raw",e,{name:"HKDF"},!1,["deriveBits"]);Bt=typeof Bt=="string"?Convert$1.string(Bt).toUint8Array():Bt,Nt=typeof Nt=="string"?Convert$1.string(Nt).toUint8Array():Nt;const er=yield crypto.subtle.deriveBits({name:"HKDF",hash:kt,salt:Bt,info:Nt},Lt,At);return new Uint8Array(er)})}}var __awaiter$O=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$c=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class HkdfAlgorithm extends CryptoAlgorithm$2{deriveKeyBytes(e){var{algorithm:At}=e,kt=__rest$c(e,["algorithm"]);return __awaiter$O(this,void 0,void 0,function*(){const Bt={"HKDF-256":"SHA-256","HKDF-384":"SHA-384","HKDF-512":"SHA-512"}[At];return yield Hkdf.deriveKeyBytes(Object.assign(Object.assign({},kt),{hash:Bt}))})}}class CryptoError extends Error{constructor(e,At){super(At),this.code=e,this.name="CryptoError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,CryptoError)}}var CryptoErrorCode;(function(xt){xt.AlgorithmNotSupported="algorithmNotSupported",xt.EncodingError="encodingError",xt.InvalidJwe="invalidJwe",xt.InvalidJwk="invalidJwk",xt.OperationNotSupported="operationNotSupported"})(CryptoErrorCode||(CryptoErrorCode={}));var __awaiter$N=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let EcdsaAlgorithm$1=class extends CryptoAlgorithm$2{bytesToPrivateKey({algorithm:e,privateKeyBytes:At}){return __awaiter$N(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const kt=yield Secp256k1$2.bytesToPrivateKey({privateKeyBytes:At});return kt.alg="EdDSA",kt}case"ES256":case"secp256r1":{const kt=yield Secp256r1$2.bytesToPrivateKey({privateKeyBytes:At});return kt.alg="EdDSA",kt}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}bytesToPublicKey({algorithm:e,publicKeyBytes:At}){return __awaiter$N(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const kt=yield Secp256k1$2.bytesToPublicKey({publicKeyBytes:At});return kt.alg="EdDSA",kt}case"ES256":case"secp256r1":{const kt=yield Secp256r1$2.bytesToPublicKey({publicKeyBytes:At});return kt.alg="EdDSA",kt}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}computePublicKey({key:e}){return __awaiter$N(this,void 0,void 0,function*(){if(!isEcPrivateJwk$2(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const At=yield Secp256k1$2.computePublicKey({key:e});return At.alg="ES256K",At}case"P-256":{const At=yield Secp256r1$2.computePublicKey({key:e});return At.alg="ES256",At}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}generateKey({algorithm:e}){return __awaiter$N(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const At=yield Secp256k1$2.generateKey();return At.alg="ES256K",At}case"ES256":case"secp256r1":{const At=yield Secp256r1$2.generateKey();return At.alg="ES256",At}}})}getPublicKey({key:e}){return __awaiter$N(this,void 0,void 0,function*(){if(!isEcPrivateJwk$2(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const At=yield Secp256k1$2.getPublicKey({key:e});return At.alg="ES256K",At}case"P-256":{const At=yield Secp256r1$2.getPublicKey({key:e});return At.alg="ES256",At}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}privateKeyToBytes({privateKey:e}){return __awaiter$N(this,void 0,void 0,function*(){switch(e.crv){case"secp256k1":return yield Secp256k1$2.privateKeyToBytes({privateKey:e});case"P-256":return yield Secp256r1$2.privateKeyToBytes({privateKey:e});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}publicKeyToBytes({publicKey:e}){return __awaiter$N(this,void 0,void 0,function*(){switch(e.crv){case"secp256k1":return yield Secp256k1$2.publicKeyToBytes({publicKey:e});case"P-256":return yield Secp256r1$2.publicKeyToBytes({publicKey:e});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}sign({key:e,data:At}){return __awaiter$N(this,void 0,void 0,function*(){if(!isEcPrivateJwk$2(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":return yield Secp256k1$2.sign({key:e,data:At});case"P-256":return yield Secp256r1$2.sign({key:e,data:At});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}verify({key:e,signature:At,data:kt}){return __awaiter$N(this,void 0,void 0,function*(){if(!isEcPublicJwk$2(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(e.crv){case"secp256k1":return yield Secp256k1$2.verify({key:e,signature:At,data:kt});case"P-256":return yield Secp256r1$2.verify({key:e,signature:At,data:kt});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}};var __awaiter$M=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};let EdDsaAlgorithm$1=class extends CryptoAlgorithm$2{bytesToPrivateKey({algorithm:e,privateKeyBytes:At}){return __awaiter$M(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const kt=yield Ed25519$2.bytesToPrivateKey({privateKeyBytes:At});return kt.alg="EdDSA",kt}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}bytesToPublicKey({algorithm:e,publicKeyBytes:At}){return __awaiter$M(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const kt=yield Ed25519$2.bytesToPublicKey({publicKeyBytes:At});return kt.alg="EdDSA",kt}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`)}})}computePublicKey({key:e}){return __awaiter$M(this,void 0,void 0,function*(){if(!isOkpPrivateJwk$2(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const At=yield Ed25519$2.computePublicKey({key:e});return At.alg="EdDSA",At}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}generateKey({algorithm:e}){return __awaiter$M(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const At=yield Ed25519$2.generateKey();return At.alg="EdDSA",At}}})}getPublicKey({key:e}){return __awaiter$M(this,void 0,void 0,function*(){if(!isOkpPrivateJwk$2(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const At=yield Ed25519$2.getPublicKey({key:e});return At.alg="EdDSA",At}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}privateKeyToBytes({privateKey:e}){return __awaiter$M(this,void 0,void 0,function*(){switch(e.crv){case"Ed25519":return yield Ed25519$2.privateKeyToBytes({privateKey:e});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}publicKeyToBytes({publicKey:e}){return __awaiter$M(this,void 0,void 0,function*(){switch(e.crv){case"Ed25519":return yield Ed25519$2.publicKeyToBytes({publicKey:e});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}sign({key:e,data:At}){return __awaiter$M(this,void 0,void 0,function*(){if(!isOkpPrivateJwk$2(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":return yield Ed25519$2.sign({key:e,data:At});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}verify({key:e,signature:At,data:kt}){return __awaiter$M(this,void 0,void 0,function*(){if(!isOkpPublicJwk$2(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(e.crv){case"Ed25519":return yield Ed25519$2.verify({key:e,signature:At,data:kt});default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Curve not supported: ${e.crv}`)}})}};var __awaiter$L=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$b=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const AES_KEY_LENGTHS=[128,192,256];class AesKw{static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$L(this,void 0,void 0,function*(){const At={k:Convert$1.uint8Array(e).toBase64Url(),kty:"oct"};At.kid=yield computeJwkThumbprint$2({jwk:At});const kt=e.length*8;return At.alg={128:"A128KW",192:"A192KW",256:"A256KW"}[kt],At})}static generateKey({length:e}){return __awaiter$L(this,void 0,void 0,function*(){if(!AES_KEY_LENGTHS.includes(e))throw new RangeError(`The key length is invalid: Must be ${AES_KEY_LENGTHS.join(", ")} bits`);const At=getWebcryptoSubtle(),kt=yield At.generateKey({name:"AES-KW",length:e},!0,["wrapKey","unwrapKey"]),Bt=yield At.exportKey("jwk",kt),Nt=__rest$b(Bt,["ext","key_ops"]);return Nt.kid=yield computeJwkThumbprint$2({jwk:Nt}),Nt})}static privateKeyToBytes({privateKey:e}){return __awaiter$L(this,void 0,void 0,function*(){if(!isOctPrivateJwk$1(e))throw new Error("AesKw: The provided key is not a valid oct private key.");return Convert$1.base64Url(e.k).toUint8Array()})}static unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:At,decryptionKey:kt}){return __awaiter$L(this,void 0,void 0,function*(){if(!("alg"in kt&&kt.alg))throw new CryptoError(CryptoErrorCode.InvalidJwk,"The decryption key is missing the 'alg' property.");if(!["A128KW","A192KW","A256KW"].includes(kt.alg))throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The 'decryptionKey' algorithm is not supported: ${kt.alg}`);const Bt=getWebcryptoSubtle(),Nt=yield Bt.importKey("jwk",kt,{name:"AES-KW"},!0,["unwrapKey"]),jt={A128KW:"AES-KW",A192KW:"AES-KW",A256KW:"AES-KW",A128GCM:"AES-GCM",A192GCM:"AES-GCM",A256GCM:"AES-GCM"}[At];if(!jt)throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The 'wrappedKeyAlgorithm' is not supported: ${At}`);const Lt=yield Bt.unwrapKey("raw",e.buffer,Nt,"AES-KW",{name:jt},!0,["unwrapKey"]),er=yield Bt.exportKey("jwk",Lt),zt=__rest$b(er,["ext","key_ops"]);return zt.kid=yield computeJwkThumbprint$2({jwk:zt}),zt})}static wrapKey({unwrappedKey:e,encryptionKey:At}){return __awaiter$L(this,void 0,void 0,function*(){if(!("alg"in At&&At.alg))throw new CryptoError(CryptoErrorCode.InvalidJwk,"The encryption key is missing the 'alg' property.");if(!["A128KW","A192KW","A256KW"].includes(At.alg))throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The 'encryptionKey' algorithm is not supported: ${At.alg}`);if(!("alg"in e&&e.alg))throw new CryptoError(CryptoErrorCode.InvalidJwk,"The private key to wrap is missing the 'alg' property.");const kt=getWebcryptoSubtle(),Bt=yield kt.importKey("jwk",At,{name:"AES-KW"},!0,["wrapKey"]),Nt={A128KW:"AES-KW",A192KW:"AES-KW",A256KW:"AES-KW",A128GCM:"AES-GCM",A192GCM:"AES-GCM",A256GCM:"AES-GCM"}[e.alg];if(!Nt)throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The 'unwrappedKey' algorithm is not supported: ${e.alg}`);const jt=yield kt.importKey("jwk",e,{name:Nt},!0,["unwrapKey"]),Lt=yield kt.wrapKey("raw",jt,Bt,"AES-KW");return new Uint8Array(Lt)})}}var __awaiter$K=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class AesKwAlgorithm extends CryptoAlgorithm$2{bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$K(this,void 0,void 0,function*(){const At=yield AesKw.bytesToPrivateKey({privateKeyBytes:e});return At.alg={16:"A128KW",24:"A192KW",32:"A256KW"}[e.length],At})}generateKey({algorithm:e}){return __awaiter$K(this,void 0,void 0,function*(){const At={A128KW:128,A192KW:192,A256KW:256}[e],kt=yield AesKw.generateKey({length:At});return kt.alg=e,kt})}privateKeyToBytes({privateKey:e}){return __awaiter$K(this,void 0,void 0,function*(){return yield AesKw.privateKeyToBytes({privateKey:e})})}unwrapKey(e){return __awaiter$K(this,void 0,void 0,function*(){return yield AesKw.unwrapKey(e)})}wrapKey(e){return __awaiter$K(this,void 0,void 0,function*(){return AesKw.wrapKey(e)})}}var __awaiter$J=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Pbkdf2{static deriveKeyBytes({baseKeyBytes:e,hash:At,salt:kt,iterations:Bt,length:Nt}){return __awaiter$J(this,void 0,void 0,function*(){const jt=getWebcryptoSubtle(),Lt=yield jt.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]),er=yield jt.deriveBits({name:"PBKDF2",hash:At,salt:kt,iterations:Bt},Lt,Nt);return new Uint8Array(er)})}}var __awaiter$I=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$a=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class Pbkdf2Algorithm extends CryptoAlgorithm$2{deriveKeyBytes(e){var{algorithm:At}=e,kt=__rest$a(e,["algorithm"]);return __awaiter$I(this,void 0,void 0,function*(){const[,Bt]=At.split(/[-+]/),Nt={HS256:"SHA-256",HS384:"SHA-384",HS512:"SHA-512"}[Bt];return yield Pbkdf2.deriveKeyBytes(Object.assign(Object.assign({},kt),{hash:Nt}))})}}var __awaiter$H=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class AesGcmAlgorithm extends CryptoAlgorithm$2{bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$H(this,void 0,void 0,function*(){const At=yield AesGcm$1.bytesToPrivateKey({privateKeyBytes:e});return At.alg={16:"A128GCM",24:"A192GCM",32:"A256GCM"}[e.length],At})}decrypt(e){return __awaiter$H(this,void 0,void 0,function*(){return AesGcm$1.decrypt(e)})}encrypt(e){return __awaiter$H(this,void 0,void 0,function*(){return AesGcm$1.encrypt(e)})}generateKey({algorithm:e}){return __awaiter$H(this,void 0,void 0,function*(){const At={A128GCM:128,A192GCM:192,A256GCM:256}[e],kt=yield AesGcm$1.generateKey({length:At});return kt.alg=e,kt})}privateKeyToBytes({privateKey:e}){return __awaiter$H(this,void 0,void 0,function*(){return yield AesGcm$1.privateKeyToBytes({privateKey:e})})}}var __awaiter$G=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const supportedAlgorithms$2={"AES-GCM":{implementation:AesGcmAlgorithm,names:["A128GCM","A192GCM","A256GCM"],operations:["bytesToPrivateKey","decrypt","encrypt","generateKey"]},"AES-KW":{implementation:AesKwAlgorithm,names:["A128KW","A192KW","A256KW"],operations:["bytesToPrivateKey","generateKey","privateKeyToBytes","wrapKey","unwrapKey"]},Ed25519:{implementation:EdDsaAlgorithm$1,names:["Ed25519"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},HKDF:{implementation:HkdfAlgorithm,names:["HKDF-256","HKDF-384","HKDF-512"],operations:["deriveKey","deriveKeyBytes"]},PBKDF2:{implementation:Pbkdf2Algorithm,names:["PBES2-HS256+A128KW","PBES2-HS384+A192KW","PBES2-HS512+A256KW"],operations:["deriveKey","deriveKeyBytes"]},secp256k1:{implementation:EcdsaAlgorithm$1,names:["ES256K","secp256k1"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},secp256r1:{implementation:EcdsaAlgorithm$1,names:["ES256","secp256r1"],operations:["bytesToPrivateKey","bytesToPublicKey","generateKey","sign","verify"]},"SHA-256":{implementation:Sha2Algorithm$2,names:["SHA-256"],operations:["digest"]}};class AgentCryptoApi{constructor(){this._algorithmInstances=new Map}bytesToPrivateKey({algorithm:e,privateKeyBytes:At}){return __awaiter$G(this,void 0,void 0,function*(){const kt=this.getAlgorithmName({algorithm:e});return yield this.getAlgorithm({algorithm:kt}).bytesToPrivateKey({algorithm:e,privateKeyBytes:At})})}bytesToPublicKey({algorithm:e,publicKeyBytes:At}){return __awaiter$G(this,void 0,void 0,function*(){const kt=this.getAlgorithmName({algorithm:e});return yield this.getAlgorithm({algorithm:kt}).bytesToPublicKey({algorithm:e,publicKeyBytes:At})})}decrypt(e){return __awaiter$G(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e.key});return yield this.getAlgorithm({algorithm:At}).decrypt(e)})}deriveKey(e){var At,kt;return __awaiter$G(this,void 0,void 0,function*(){const Bt=this.getAlgorithmName({algorithm:e.algorithm}),Nt=this.getAlgorithm({algorithm:Bt});let jt;switch(e.algorithm){case"HKDF-256":case"HKDF-384":case"HKDF-512":{jt=e.derivedKeyAlgorithm;break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{jt=e.algorithm.split(/[-+]/)[2];break}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The specified "algorithm" is not supported: ${e.algorithm}`)}const Lt=+((kt=(At=jt.match(/\d+/))===null||At===void 0?void 0:At[0])!==null&&kt!==void 0?kt:-1);if(Lt===-1)throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`The derived key algorithm" is not supported: ${jt}`);const er=yield Nt.deriveKeyBytes(Object.assign(Object.assign({},e),{length:Lt}));return yield this.bytesToPrivateKey({algorithm:jt,privateKeyBytes:er})})}deriveKeyBytes(e){return __awaiter$G(this,void 0,void 0,function*(){const At=this.getAlgorithmName({algorithm:e.algorithm});return yield this.getAlgorithm({algorithm:At}).deriveKeyBytes(e)})}digest({algorithm:e,data:At}){return __awaiter$G(this,void 0,void 0,function*(){return yield this.getAlgorithm({algorithm:e}).digest({algorithm:e,data:At})})}encrypt(e){return __awaiter$G(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e.key});return yield this.getAlgorithm({algorithm:At}).encrypt(e)})}generateKey(e){var At;return __awaiter$G(this,void 0,void 0,function*(){const kt=this.getAlgorithmName({algorithm:e.algorithm}),Nt=yield this.getAlgorithm({algorithm:kt}).generateKey({algorithm:e.algorithm});return(At=Nt.kid)!==null&&At!==void 0||(Nt.kid=yield computeJwkThumbprint$2({jwk:Nt})),Nt})}getKeyUri(e){return __awaiter$G(this,void 0,void 0,function*(){throw new Error("Method not implemented.")})}getPublicKey({key:e}){return __awaiter$G(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:At}).getPublicKey({key:e})})}privateKeyToBytes({privateKey:e}){return __awaiter$G(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:At}).privateKeyToBytes({privateKey:e})})}publicKeyToBytes({publicKey:e}){return __awaiter$G(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e});return yield this.getAlgorithm({algorithm:At}).publicKeyToBytes({publicKey:e})})}sign({key:e,data:At}){return __awaiter$G(this,void 0,void 0,function*(){const kt=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:kt}).sign({data:At,key:e})})}unwrapKey(e){return __awaiter$G(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e.decryptionKey});return yield this.getAlgorithm({algorithm:At}).unwrapKey(e)})}verify({key:e,signature:At,data:kt}){return __awaiter$G(this,void 0,void 0,function*(){const Bt=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:Bt}).verify({key:e,signature:At,data:kt})})}wrapKey(e){return __awaiter$G(this,void 0,void 0,function*(){const At=this.getAlgorithmName({key:e.encryptionKey});return yield this.getAlgorithm({algorithm:At}).wrapKey(e)})}getAlgorithm({algorithm:e}){var At;const kt=(At=supportedAlgorithms$2[e])===null||At===void 0?void 0:At.implementation;if(!kt)throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`);return this._algorithmInstances.has(kt)||this._algorithmInstances.set(kt,new kt),this._algorithmInstances.get(kt)}getAlgorithmName({algorithm:e,key:At}){var kt;const Bt=(kt=At==null?void 0:At.alg)!==null&&kt!==void 0?kt:e,Nt=At==null?void 0:At.crv;for(const jt of Object.keys(supportedAlgorithms$2)){const Lt=supportedAlgorithms$2[jt].names;if(Bt&&Lt.includes(Bt))return jt;if(Nt&&Lt.includes(Nt))return jt}throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported based on provided input: alg=${Bt}, crv=${Nt}. Please check the documentation for the list of supported algorithms.`)}}const IdentityProtocolDefinition={protocol:"http://identity.foundation/protocols/web5/identity-store",published:!1,types:{portableDid:{schema:"https://identity.foundation/schemas/web5/portable-did",dataFormats:["application/json"]},identityMetadata:{schema:"https://identity.foundation/schemas/web5/identity-metadata",dataFormats:["application/json"]}},structure:{portableDid:{},identityMetadata:{}}},JwkProtocolDefinition={protocol:"http://identity.foundation/protocols/web5/jwk-store",published:!1,types:{privateJwk:{schema:"https://identity.foundation/schemas/web5/private-jwk",dataFormats:["application/json"]}},structure:{privateJwk:{}}};function isPortableDid(xt){return!(!xt||typeof xt!="object"||xt===null)&&"uri"in xt&&"document"in xt&&"metadata"in xt&&(!("keyManager"in xt)||xt.keyManager===void 0)}var __awaiter$F=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$9=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const TENANT_SEPARATOR="^";class DeterministicKeyGenerator extends LocalKeyManager$4{constructor(){super(),this._predefinedKeys=new Map,this._keyGenerator=this._predefinedKeys.keys()}addPredefinedKeys({privateKeys:e}){var At;return __awaiter$F(this,void 0,void 0,function*(){const kt={};for(const Bt of e){(At=Bt.kid)!==null&&At!==void 0||(Bt.kid=yield computeJwkThumbprint$2({jwk:Bt}));const Nt=yield this.getKeyUri({key:Bt});kt[Nt]=Bt}this._predefinedKeys=new Map(Object.entries(kt)),this._keyGenerator=this._predefinedKeys.keys()})}exportKey({keyUri:e}){return __awaiter$F(this,void 0,void 0,function*(){const At=this._predefinedKeys.get(e);if(!At)throw new Error(`DeterministicKeyGenerator.exportKey: Key not found: ${e}`);return At})}generateKey(e){return __awaiter$F(this,void 0,void 0,function*(){const{value:At,done:kt}=this._keyGenerator.next();if(kt)throw new Error("Ran out of predefined keys");return At})}getPublicKey({keyUri:e}){return __awaiter$F(this,void 0,void 0,function*(){const At=this._predefinedKeys.get(e);if(!At)throw new Error(`DeterministicKeyGenerator.getPublicKey: Key not found: ${e}`);return __rest$9(At,["d"])})}sign({keyUri:e,data:At}){return __awaiter$F(this,void 0,void 0,function*(){const kt=this._predefinedKeys.get(e);if(!kt)throw new Error(`DeterministicKeyGenerator.sign: Key not found: ${e}`);return yield Ed25519$2.sign({data:At,key:kt})})}}function getDataStoreTenant({agent:xt,tenant:e,didUri:At}){return __awaiter$F(this,void 0,void 0,function*(){if(e)return e;if(xt.agentDid)return xt.agentDid.uri;if(!At)throw new Error("Failed to determine tenant DID: 'agent.agentDid', 'tenant', and 'didUri' are undefined");return At})}var __awaiter$E=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class DwnDataStore{constructor(){this.name="DwnDataStore",this._cache=new TtlCache({ttl:ms$1("15 minutes"),max:100}),this._index=new TtlCache({ttl:ms$1("21 days"),max:1e3}),this._protocolInitializedCache=new TtlCache({ttl:ms$1("21 days"),max:1e3}),this._recordProperties={dataFormat:"application/json"}}delete({id:e,agent:At,tenant:kt}){return __awaiter$E(this,void 0,void 0,function*(){const Bt=yield getDataStoreTenant({agent:At,tenant:kt,didUri:e});let Nt=yield this.lookupRecordId({id:e,tenantDid:Bt,agent:At});if(!Nt)return!1;const{reply:{status:jt}}=yield At.dwn.processRequest({author:Bt,target:Bt,messageType:DwnInterface.RecordsDelete,messageParams:{recordId:Nt}});if(jt.code===202)return this._index.delete(`${Bt}${TENANT_SEPARATOR}${e}`),this._cache.delete(Nt),!0;throw new Error(`${this.name}: Failed to delete '${e}' from store: (${jt.code}) ${jt.detail}`)})}get({id:e,agent:At,tenant:kt,useCache:Bt=!1}){return __awaiter$E(this,void 0,void 0,function*(){const Nt=yield getDataStoreTenant({agent:At,tenant:kt,didUri:e});let jt=yield this.lookupRecordId({id:e,tenantDid:Nt,agent:At});if(jt)return yield this.getRecord({recordId:jt,tenantDid:Nt,agent:At,useCache:Bt})})}list({agent:e,tenant:At}){return __awaiter$E(this,void 0,void 0,function*(){const kt=yield getDataStoreTenant({tenant:At,agent:e});return yield this.getAllRecords({agent:e,tenantDid:kt})})}set({id:e,data:At,tenant:kt,agent:Bt,preventDuplicates:Nt=!0,useCache:jt=!1}){return __awaiter$E(this,void 0,void 0,function*(){const Lt=yield getDataStoreTenant({agent:Bt,tenant:kt,didUri:e});if(yield this.initialize({tenant:Lt,agent:Bt}),Nt&&(yield this.lookupRecordId({id:e,tenantDid:Lt,agent:Bt})))throw new Error(`${this.name}: Import failed due to duplicate entry for: ${e}`);const er=Convert$1.object(At).toUint8Array(),{message:tr,reply:{status:zt}}=yield Bt.dwn.processRequest({author:Lt,target:Lt,messageType:DwnInterface.RecordsWrite,messageParams:Object.assign({},this._recordProperties),dataStream:new Blob([er],{type:"application/json"})});if(!(tr&&zt.code===202))throw new Error(`${this.name}: Failed to write data to store for ${e}: ${zt.detail}`);this._index.set(`${Lt}${TENANT_SEPARATOR}${e}`,tr.recordId),jt&&this._cache.set(tr.recordId,At)})}initialize({tenant:e,agent:At}){return __awaiter$E(this,void 0,void 0,function*(){const kt=yield getDataStoreTenant({agent:At,tenant:e});if(this._protocolInitializedCache.has(kt))return;const{reply:{status:Bt,entries:Nt}}=yield At.dwn.processRequest({author:kt,target:kt,messageType:DwnInterface.ProtocolsQuery,messageParams:{filter:{protocol:this._recordProtocolDefinition.protocol}}});if(Bt.code!==200)throw new Error(`Failed to query for protocols: ${Bt.code} - ${Bt.detail}`);(Nt==null?void 0:Nt.length)===0&&(yield this.installProtocol(kt,At)),this._protocolInitializedCache.set(kt,!0)})}getAllRecords(e){return __awaiter$E(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DwnDataStore must implement getAllRecords()")})}getRecord({recordId:e,tenantDid:At,agent:kt,useCache:Bt}){var Nt;return __awaiter$E(this,void 0,void 0,function*(){if(Bt){const er=this._cache.get(e);if(er)return er}const{reply:jt}=yield kt.dwn.processRequest({author:At,target:At,messageType:DwnInterface.RecordsRead,messageParams:{filter:{recordId:e}}});if(!(!((Nt=jt.record)===null||Nt===void 0)&&Nt.data))throw new Error(`${this.name}: Failed to read data from DWN for: ${e}`);const Lt=yield NodeStream$1.consumeToJson({readable:jt.record.data});return Bt&&this._cache.set(e,Lt),Lt})}installProtocol(e,At){return __awaiter$E(this,void 0,void 0,function*(){const{reply:{status:kt}}=yield At.dwn.processRequest({author:e,target:e,messageType:DwnInterface.ProtocolsConfigure,messageParams:{definition:this._recordProtocolDefinition}});if(kt.code!==202)throw new Error(`Failed to install protocol: ${kt.code} - ${kt.detail}`)})}lookupRecordId({id:e,tenantDid:At,agent:kt}){return __awaiter$E(this,void 0,void 0,function*(){let Bt=this._index.get(`${At}${TENANT_SEPARATOR}${e}`,{updateAgeOnGet:!0});return Bt||(yield this.getAllRecords({agent:kt,tenantDid:At}),Bt=this._index.get(`${At}${TENANT_SEPARATOR}${e}`)),Bt})}}class InMemoryDataStore{constructor(){this.name="InMemoryDataStore",this.store=new Map}delete({id:e,agent:At,tenant:kt}){return __awaiter$E(this,void 0,void 0,function*(){const Bt=yield getDataStoreTenant({agent:At,tenant:kt,didUri:e});return this.store.has(`${Bt}${TENANT_SEPARATOR}${e}`)?(this.store.delete(`${Bt}${TENANT_SEPARATOR}${e}`),!0):!1})}get({id:e,agent:At,tenant:kt}){return __awaiter$E(this,void 0,void 0,function*(){const Bt=yield getDataStoreTenant({agent:At,tenant:kt,didUri:e});return this.store.get(`${Bt}${TENANT_SEPARATOR}${e}`)})}list({agent:e,tenant:At}){return __awaiter$E(this,void 0,void 0,function*(){const kt=yield getDataStoreTenant({tenant:At,agent:e}),Bt=[];for(const[Nt,jt]of this.store.entries())Nt.startsWith(`${kt}${TENANT_SEPARATOR}`)&&Bt.push(jt);return Bt})}set({id:e,data:At,tenant:kt,agent:Bt,preventDuplicates:Nt}){return __awaiter$E(this,void 0,void 0,function*(){const jt=yield getDataStoreTenant({agent:Bt,tenant:kt,didUri:e});if(Nt&&this.store.has(`${jt}${TENANT_SEPARATOR}${e}`))throw new Error(`${this.name}: Import failed due to duplicate entry for: ${e}`);const Lt=structuredClone(At);this.store.set(`${jt}${TENANT_SEPARATOR}${e}`,Lt)})}}var __awaiter$D=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class DwnDidStore extends DwnDataStore{constructor(){super(...arguments),this.name="DwnDidStore",this._recordProtocolDefinition=IdentityProtocolDefinition,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"portableDid",schema:this._recordProtocolDefinition.types.portableDid.schema}}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$D(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$D(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$D(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$D(this,void 0,void 0,function*(){return yield At.set.call(this,e)})}getAllRecords({agent:e,tenantDid:At}){var kt;return __awaiter$D(this,void 0,void 0,function*(){this._index.clear();const{reply:Bt}=yield e.dwn.processRequest({author:At,target:At,messageType:DwnInterface.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let Nt=[];for(const jt of(kt=Bt.entries)!==null&&kt!==void 0?kt:[]){if(!jt.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const Lt=Convert$1.base64Url(jt.encodedData).toObject();if(isPortableDid(Lt)){const er=`${At}${TENANT_SEPARATOR}${Lt.uri}`;this._index.set(er,jt.recordId),this._cache.set(jt.recordId,Lt),Nt.push(Lt)}}return Nt})}}class InMemoryDidStore extends InMemoryDataStore{constructor(){super(...arguments),this.name="InMemoryDidStore"}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$D(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$D(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$D(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$D(this,void 0,void 0,function*(){return yield At.set.call(this,e)})}}var __awaiter$C=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},DidInterface;(function(xt){xt.Create="Create",xt.Resolve="Resolve"})(DidInterface||(DidInterface={}));function isDidRequest(xt,e){return xt.messageType===e}class AgentDidApi extends UniversalResolver$1{constructor({agent:e,didMethods:At,resolverCache:kt,store:Bt}){if(!At)throw new TypeError("AgentDidApi: Required parameter missing: 'didMethods'");super({didResolvers:At,cache:kt??new AgentDidResolverCache({agent:e,location:"DATA/AGENT/DID_CACHE"})}),this._didMethods=new Map,this._agent=e,this._store=Bt??new InMemoryDidStore;for(const Nt of At)this._didMethods.set(Nt.methodName,Nt)}get agent(){if(this._agent===void 0)throw new Error("AgentDidApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,"agent"in this.cache&&(this.cache.agent=e)}create({method:e,tenant:At,options:kt,store:Bt}){return __awaiter$C(this,void 0,void 0,function*(){const jt=yield this.getMethod(e).create({keyManager:this.agent.keyManager,options:kt});if(Bt??!0){const{uri:Lt,document:er,metadata:tr}=jt,zt={uri:Lt,document:er,metadata:tr};yield this._store.set({id:zt.uri,data:zt,agent:this.agent,tenant:At??zt.uri,preventDuplicates:!1,useCache:!0})}return jt})}export({didUri:e,tenant:At}){return __awaiter$C(this,void 0,void 0,function*(){const kt=yield this.get({didUri:e,tenant:At});if(!kt)throw new Error(`AgentDidApi: Failed to export due to DID not found: ${e}`);return yield kt.export()})}get({didUri:e,tenant:At}){return __awaiter$C(this,void 0,void 0,function*(){const kt=yield this._store.get({id:e,agent:this.agent,tenant:At,useCache:!0});return kt?yield BearerDid$2.import({portableDid:kt,keyManager:this.agent.keyManager}):void 0})}getSigningMethod({didUri:e,methodId:At}){return __awaiter$C(this,void 0,void 0,function*(){const kt=Did$2.parse(e);if(!kt)throw new Error(`Invalid DID URI: ${e}`);const Bt=this.getMethod(kt.method),{didDocument:Nt,didResolutionMetadata:jt}=yield this.resolve(e);if(!Nt)throw new Error(`DID resolution failed for '${e}': ${JSON.stringify(jt)}`);return yield Bt.getSigningMethod({didDocument:Nt,methodId:At})})}import({portableDid:e,tenant:At}){return __awaiter$C(this,void 0,void 0,function*(){const kt=yield BearerDid$2.import({keyManager:this.agent.keyManager,portableDid:e}),{uri:Bt,document:Nt,metadata:jt}=kt,Lt={uri:Bt,document:Nt,metadata:jt};return yield this._store.set({id:Lt.uri,data:Lt,agent:this.agent,tenant:At??Lt.uri,preventDuplicates:!0,useCache:!0}),kt})}delete({didUri:e,tenant:At,deleteKey:kt=!0}){return __awaiter$C(this,void 0,void 0,function*(){const Bt=yield this._store.get({id:e,agent:this.agent,tenant:At,useCache:!1});if(!Bt)throw new Error("AgentDidApi: Could not delete, DID not found");yield this._store.delete({id:e,agent:this.agent,tenant:At}),kt&&(yield this.deleteKeys({portableDid:Bt}))})}deleteKeys({portableDid:e}){return __awaiter$C(this,void 0,void 0,function*(){for(const At of e.document.verificationMethod||[]){if(!At.publicKeyJwk)continue;const kt=yield this.agent.keyManager.getKeyUri({key:At.publicKeyJwk});yield this.agent.keyManager.deleteKey({keyUri:kt})}})}processRequest(e){var At;return __awaiter$C(this,void 0,void 0,function*(){if(isDidRequest(e,DidInterface.Create))try{const kt=yield this.create(Object.assign({},e.messageParams));return{result:{uri:kt.uri,document:kt.document,metadata:kt.metadata},ok:!0,status:{code:201,message:"Created"}}}catch(kt){return{ok:!1,status:{code:500,message:(At=kt.message)!==null&&At!==void 0?At:"Unknown error occurred"}}}if(isDidRequest(e,DidInterface.Resolve)){const{didUri:kt,options:Bt}=e.messageParams;return{result:yield this.resolve(kt,Bt),ok:!0,status:{code:200,message:"OK"}}}throw new Error(`AgentDidApi: Unsupported request type: ${e.messageType}`)})}getMethod(e){const At=this._didMethods.get(e);if(At===void 0)throw new Error(`DID Method not supported: ${e}`);return At}}var __awaiter$B=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function blobToIsomorphicNodeReadable(xt){return webReadableToIsomorphicNodeReadable(xt.stream())}function getDwnServiceEndpointUrls(xt,e){return __awaiter$B(this,void 0,void 0,function*(){const At=yield e.dereference(`${xt}#dwn`);if(At.dereferencingMetadata.error)throw new Error(`Failed to dereference '${xt}#dwn': ${At.dereferencingMetadata.error}`);if(isDwnDidService$1(At.contentStream)){const{serviceEndpoint:kt}=At.contentStream,Bt=typeof kt=="string"?[kt]:Array.isArray(kt)&&kt.every(Nt=>typeof Nt=="string")?kt:[];if(Bt.length>0)return Bt}return[]})}function isRecordsWrite(xt){return!xt||typeof xt!="object"||xt===null?!1:"message"in xt&&typeof xt.message=="object"&&xt.message!==null&&"descriptor"in xt.message&&typeof xt.message.descriptor=="object"&&xt.message.descriptor!==null&&"interface"in xt.message.descriptor&&xt.message.descriptor.interface===DwnInterfaceName.Records&&"method"in xt.message.descriptor&&xt.message.descriptor.method===DwnMethodName.Write}function webReadableToIsomorphicNodeReadable(xt){return new ReadableWebToNodeStream_1(xt)}function pollWithTtl(xt,e=3e3,At=3e5,kt){const Bt=Date.now()+At;let Nt=null,jt=!0;return new Promise((Lt,er)=>{function tr(){return __awaiter$B(this,void 0,void 0,function*(){if(!jt)return;const zt=Bt-Date.now();if(zt<=0){jt=!1,console.log("Polling stopped: TTL reached"),Lt(null);return}console.log(`Polling... (Remaining time: ${Math.ceil(zt/1e3)}s)`);try{const rr=yield xt();if(rr.ok){jt=!1,Nt!==null&&clearTimeout(Nt),console.log("Polling stopped: Success condition met"),Lt(rr);return}}catch(rr){console.error("Error fetching data:",rr),er(rr)}jt&&(Nt=setTimeout(tr,e))})}tr()})}function concatenateUrl(xt,e){return xt.endsWith("/")&&(xt=xt.slice(0,-1)),e.startsWith("/")&&(e=e.slice(1)),`${xt}/${e}`}var __awaiter$A=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function isDwnRequest(xt,e){return xt.messageType===e}function isRecordsType(xt){return xt===DwnInterface.RecordsDelete||xt===DwnInterface.RecordsQuery||xt===DwnInterface.RecordsRead||xt===DwnInterface.RecordsSubscribe||xt===DwnInterface.RecordsWrite}function isRecordPermissionScope(xt){return xt.interface===DwnInterfaceName.Records}class AgentDwnApi{constructor({agent:e,dwn:At}){this._agent=e,this._dwn=At}get agent(){if(this._agent===void 0)throw new Error("AgentDwnApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}get node(){return this._dwn}static createDwn({dataPath:e,dataStore:At,didResolver:kt,eventLog:Bt,eventStream:Nt,messageStore:jt,tenantGate:Lt,resumableTaskStore:er}){return __awaiter$A(this,void 0,void 0,function*(){return At??(At=new DataStoreLevel({blockstoreLocation:`${e}/DWN_DATASTORE`})),kt??(kt=new UniversalResolver$1({didResolvers:[DidDht$2,DidJwk$2],cache:new DidResolverCacheLevel$1({location:`${e}/DID_RESOLVERCACHE`})})),Bt??(Bt=new EventLogLevel({location:`${e}/DWN_EVENTLOG`})),jt??(jt=new MessageStoreLevel({blockstoreLocation:`${e}/DWN_MESSAGESTORE`,indexLocation:`${e}/DWN_MESSAGEINDEX`})),er??(er=new ResumableTaskStoreLevel({location:`${e}/DWN_RESUMABLETASKSTORE`})),yield Dwn.create({dataStore:At,didResolver:kt,eventLog:Bt,eventStream:Nt,messageStore:jt,tenantGate:Lt,resumableTaskStore:er})})}processRequest(e){return __awaiter$A(this,void 0,void 0,function*(){const{message:At,dataStream:kt}=yield this.constructDwnMessage({request:e}),{subscriptionHandler:Bt}=e;return{reply:e.store!==!1?yield this._dwn.processMessage(e.target,At,{dataStream:kt,subscriptionHandler:Bt}):{status:{code:202,detail:"Accepted"}},message:At,messageCid:yield Message.getCid(At)}})}sendRequest(e){return __awaiter$A(this,void 0,void 0,function*(){const At=yield getDwnServiceEndpointUrls(e.target,this.agent.did);if(At.length===0)throw new Error(`AgentDwnApi: DID Service is missing or malformed: ${e.target}#dwn`);let kt,Bt,Nt,jt;if("messageCid"in e)({message:Bt,data:Nt}=yield this.getDwnMessage({author:e.author,messageCid:e.messageCid,messageType:e.messageType})),kt=e.messageCid;else{if({message:Bt}=yield this.constructDwnMessage({request:e}),e.dataStream&&!(e.dataStream instanceof Blob))throw new Error("AgentDwnApi: DataStream must be provided as a Blob");Nt=e.dataStream,jt=e.subscriptionHandler}const Lt=yield this.sendDwnRpcRequest({targetDid:e.target,dwnEndpointUrls:At,message:Bt,data:Nt,subscriptionHandler:jt});return kt??(kt=yield Message.getCid(Bt)),{reply:Lt,message:Bt,messageCid:kt}})}sendDwnRpcRequest({targetDid:e,dwnEndpointUrls:At,message:kt,data:Bt,subscriptionHandler:Nt}){return __awaiter$A(this,void 0,void 0,function*(){const jt=[];if(kt.descriptor.method===DwnMethodName.Subscribe&&Nt===void 0)throw new Error("AgentDwnApi: Subscription handler is required for subscription requests.");for(let Lt of At)try{if(Nt!==void 0){if(!(yield this.agent.rpc.getServerInfo(Lt)).webSocketSupport){jt.push({url:Lt,message:"WebSocket support is not enabled on the server."});continue}const zt=new URL(Lt);zt.protocol=zt.protocol==="http:"?"ws:":"wss:",Lt=zt.toString()}return yield this.agent.rpc.sendDwnRequest({dwnUrl:Lt,targetDid:e,message:kt,data:Bt,subscriptionHandler:Nt})}catch(er){jt.push({url:Lt,message:er instanceof Error?er.message:"Unknown error"})}throw new Error(`Failed to send DWN RPC request: ${JSON.stringify(jt)}`)})}constructDwnMessage({request:e}){var At;return __awaiter$A(this,void 0,void 0,function*(){if(e.granteeDid&&!this.hasGrantParams(e.messageParams))throw new Error("AgentDwnApi: Requested to sign with a permission but no grant messageParams were provided in the request");const kt=e.rawMessage;let Bt;if(isDwnRequest(e,DwnInterface.RecordsWrite)){const Lt=e.messageParams;if(e.dataStream&&!(Lt!=null&&Lt.data)){const{dataStream:er}=e;let tr;if(er instanceof Blob)tr=blobToIsomorphicNodeReadable(er),Bt=blobToIsomorphicNodeReadable(er);else if(er instanceof ReadableStream){const[zt,rr]=er.tee();tr=webReadableToIsomorphicNodeReadable(zt),Bt=webReadableToIsomorphicNodeReadable(rr)}kt||(Lt.dataCid=yield Cid.computeDagPbCidFromStream(tr),(At=Lt.dataSize)!==null&&At!==void 0||(Lt.dataSize=tr.bytesRead))}}let Nt;const jt=dwnMessageConstructors[e.messageType];if(kt){if(Nt=yield jt.parse(kt),isRecordsWrite(Nt)&&e.signAsOwner){const Lt=yield this.getSigner(e.author);yield Nt.signAsOwner(Lt)}else if(e.granteeDid&&isRecordsWrite(Nt)&&e.signAsOwnerDelegate){const Lt=yield this.getSigner(e.granteeDid),er=e.messageParams;yield Nt.signAsOwnerDelegate(Lt,er.delegatedGrant)}}else{const Lt=e.granteeDid?yield this.getSigner(e.granteeDid):yield this.getSigner(e.author);Nt=yield jt.create(Object.assign(Object.assign({},e.messageParams),{signer:Lt}))}return{message:Nt.message,dataStream:Bt}})}hasGrantParams(e){return e!==void 0&&("permissionGrantId"in e&&e.permissionGrantId!==void 0||"delegatedGrant"in e&&e.delegatedGrant!==void 0)}getSigner(e){return __awaiter$A(this,void 0,void 0,function*(){if(e===this.agent.agentDid.uri){const At=yield this.agent.agentDid.getSigner();return{algorithm:At.algorithm,keyId:At.keyId,sign:kt=>__awaiter$A(this,void 0,void 0,function*(){return yield At.sign({data:kt})})}}else try{const At=yield this.agent.did.getSigningMethod({didUri:e});if(!At.publicKeyJwk)throw new Error(`Verification method '${At.id}' does not contain a public key in JWK format`);const kt=yield this.agent.keyManager.getKeyUri({key:At.publicKeyJwk}),Bt=yield this.agent.keyManager.getPublicKey({keyUri:kt}),Nt=this.agent.keyManager;return{algorithm:CryptoUtils$1.getJoseSignatureAlgorithmFromPublicKey(Bt),keyId:At.id,sign:jt=>__awaiter$A(this,void 0,void 0,function*(){return yield Nt.sign({data:jt,keyUri:kt})})}}catch(At){throw new Error(`AgentDwnApi: Unable to get signer for author '${e}': ${At.message}`)}})}getDwnMessage({author:e,messageCid:At}){return __awaiter$A(this,void 0,void 0,function*(){const kt=yield this.getSigner(e),Bt=yield dwnMessageConstructors[DwnInterface.MessagesRead].create({messageCid:At,signer:kt}),Nt=yield this._dwn.processMessage(e,Bt.message);if(Nt.status.code!==200)throw new Error(`AgentDwnApi: Failed to read message, response status: ${Nt.status.code} - ${Nt.status.detail}`);const jt=Nt.entry;let er={message:jt.message};if(isRecordsWrite(jt)&&jt.data){const tr=yield NodeStream$1.consumeToBytes({readable:jt.data});er.data=new Blob([tr],{type:jt.message.descriptor.dataFormat})}return er})}}var __awaiter$z=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class DwnKeyStore extends DwnDataStore{constructor(){super(...arguments),this.name="DwnKeyStore",this._recordProtocolDefinition=JwkProtocolDefinition,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"privateJwk",schema:this._recordProtocolDefinition.types.privateJwk.schema}}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$z(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$z(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$z(this,void 0,void 0,function*(){yield At.set.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$z(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}getAllRecords({agent:e,tenantDid:At}){var kt;return __awaiter$z(this,void 0,void 0,function*(){this._index.clear();const{reply:Bt}=yield e.dwn.processRequest({author:At,target:At,messageType:DwnInterface.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let Nt=[];for(const jt of(kt=Bt.entries)!==null&&kt!==void 0?kt:[]){if(!jt.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const Lt=Convert$1.base64Url(jt.encodedData).toObject();if(isPrivateJwk$2(Lt)){const er=`${At}${TENANT_SEPARATOR}${KEY_URI_PREFIX_JWK$2}${Lt.kid}`;this._index.set(er,jt.recordId),this._cache.set(jt.recordId,Lt),Nt.push(Lt)}}return Nt})}}class InMemoryKeyStore extends InMemoryDataStore{constructor(){super(...arguments),this.name="InMemoryKeyStore"}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$z(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$z(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$z(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$z(this,void 0,void 0,function*(){return yield At.set.call(this,e)})}}var __awaiter$y=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$8=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const supportedAlgorithms$1={"AES-GCM":{implementation:AesGcmAlgorithm$3,names:["A128GCM","A192GCM","A256GCM"]},"AES-KW":{implementation:AesKwAlgorithm,names:["A128KW","A192KW","A256KW"]},Ed25519:{implementation:EdDsaAlgorithm$4,names:["Ed25519"]},secp256k1:{implementation:EcdsaAlgorithm$4,names:["ES256K","secp256k1"]},secp256r1:{implementation:EcdsaAlgorithm$4,names:["ES256","secp256r1"]},"SHA-256":{implementation:Sha2Algorithm$2,names:["SHA-256"]}};let LocalKeyManager$1=class{constructor({agent:e,keyStore:At}={}){this._algorithmInstances=new Map,this._agent=e,this._keyStore=At??new InMemoryKeyStore}get agent(){if(this._agent===void 0)throw new Error("LocalKeyManager: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}decrypt(e){var{keyUri:At}=e,kt=__rest$8(e,["keyUri"]);return __awaiter$y(this,void 0,void 0,function*(){const Bt=yield this.getPrivateKey({keyUri:At}),Nt=this.getAlgorithmName({key:Bt});return yield this.getAlgorithm({algorithm:Nt}).decrypt(Object.assign({key:Bt},kt))})}digest(e){throw new Error("Method not implemented.")}encrypt(e){var{keyUri:At}=e,kt=__rest$8(e,["keyUri"]);return __awaiter$y(this,void 0,void 0,function*(){const Bt=yield this.getPrivateKey({keyUri:At}),Nt=this.getAlgorithmName({key:Bt});return yield this.getAlgorithm({algorithm:Nt}).encrypt(Object.assign({key:Bt},kt))})}exportKey({keyUri:e}){return __awaiter$y(this,void 0,void 0,function*(){return yield this.getPrivateKey({keyUri:e})})}generateKey({algorithm:e}){var At;return __awaiter$y(this,void 0,void 0,function*(){const kt=this.getAlgorithmName({key:{alg:e}}),Nt=yield this.getAlgorithm({algorithm:kt}).generateKey({algorithm:e});(At=Nt.kid)!==null&&At!==void 0||(Nt.kid=yield computeJwkThumbprint$2({jwk:Nt}));const jt=yield this.getKeyUri({key:Nt});return yield this._keyStore.set({id:jt,data:Nt,agent:this.agent,preventDuplicates:!1,useCache:!0}),jt})}getKeyUri({key:e}){return __awaiter$y(this,void 0,void 0,function*(){const At=yield computeJwkThumbprint$2({jwk:e});return`${KEY_URI_PREFIX_JWK$2}${At}`})}getPublicKey({keyUri:e}){return __awaiter$y(this,void 0,void 0,function*(){const At=yield this.getPrivateKey({keyUri:e}),kt=this.getAlgorithmName({key:At});return yield this.getAlgorithm({algorithm:kt}).getPublicKey({key:At})})}importKey({key:e}){var At;return __awaiter$y(this,void 0,void 0,function*(){if(!isPrivateJwk$2(e))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const kt=structuredClone(e);(At=kt.kid)!==null&&At!==void 0||(kt.kid=yield computeJwkThumbprint$2({jwk:kt}));const Bt=yield this.getKeyUri({key:kt});return yield this._keyStore.set({id:Bt,data:kt,agent:this.agent,preventDuplicates:!0,useCache:!0}),Bt})}sign({keyUri:e,data:At}){return __awaiter$y(this,void 0,void 0,function*(){const kt=yield this.getPrivateKey({keyUri:e}),Bt=this.getAlgorithmName({key:kt});return this.getAlgorithm({algorithm:Bt}).sign({data:At,key:kt})})}unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:At,decryptionKeyUri:kt}){return __awaiter$y(this,void 0,void 0,function*(){const Bt=yield this.getPrivateKey({keyUri:kt}),Nt=this.getAlgorithmName({key:Bt});return yield this.getAlgorithm({algorithm:Nt}).unwrapKey({wrappedKeyBytes:e,wrappedKeyAlgorithm:At,decryptionKey:Bt})})}verify({key:e,signature:At,data:kt}){return __awaiter$y(this,void 0,void 0,function*(){const Bt=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:Bt}).verify({key:e,signature:At,data:kt})})}wrapKey({unwrappedKey:e,encryptionKeyUri:At}){return __awaiter$y(this,void 0,void 0,function*(){const kt=yield this.getPrivateKey({keyUri:At}),Bt=this.getAlgorithmName({key:kt});return yield this.getAlgorithm({algorithm:Bt}).wrapKey({unwrappedKey:e,encryptionKey:kt})})}deleteKey({keyUri:e}){return __awaiter$y(this,void 0,void 0,function*(){if(!(yield this._keyStore.get({id:e,agent:this.agent,useCache:!0})))throw new Error(`Key not found: ${e}`);yield this._keyStore.delete({id:e,agent:this.agent})})}getAlgorithm({algorithm:e}){var At;const kt=(At=supportedAlgorithms$1[e])===null||At===void 0?void 0:At.implementation;if(!kt)throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported: ${e}`);return this._algorithmInstances.has(kt)||this._algorithmInstances.set(kt,new kt),this._algorithmInstances.get(kt)}getAlgorithmName({key:e}){const At=e.alg,kt=e.crv;for(const Bt of Object.keys(supportedAlgorithms$1)){const Nt=supportedAlgorithms$1[Bt].names;if(At&&Nt.includes(At))return Bt;if(kt&&Nt.includes(kt))return Bt}throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Algorithm not supported based on provided input: alg=${At}, crv=${kt}. Please check the documentation for the list of supported algorithms.`)}getPrivateKey({keyUri:e}){return __awaiter$y(this,void 0,void 0,function*(){const At=yield this._keyStore.get({id:e,agent:this.agent,useCache:!0});if(!At)throw new Error(`Key not found: ${e}`);return At})}};var __awaiter$x=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function isValidJweHeader(xt){return typeof xt=="object"&&xt!==null&&"alg"in xt&&xt.alg!==void 0&&"enc"in xt&&xt.enc!==void 0}class JweKeyManagement{static decrypt({key:e,encryptedKey:At,joseHeader:kt,crypto:Bt}){return __awaiter$x(this,void 0,void 0,function*(){switch(kt.alg){case"dir":{if(At!==void 0)throw new CryptoError(CryptoErrorCode.InvalidJwe,'JWE "encrypted_key" is not allowed when using "dir" (Direct Encryption Mode).');if(e instanceof Uint8Array)throw new CryptoError(CryptoErrorCode.InvalidJwe,'Key management "key" must be a Key URI or JWK when using "dir" (Direct Encryption Mode).');return e}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(typeof kt.p2c!="number")throw new CryptoError(CryptoErrorCode.InvalidJwe,'JOSE Header "p2c" (PBES2 Count) is missing or not a number.');if(typeof kt.p2s!="string")throw new CryptoError(CryptoErrorCode.InvalidJwe,'JOSE Header "p2s" (PBES2 salt) is missing or not a string.');if(!(e instanceof Uint8Array))throw new CryptoError(CryptoErrorCode.InvalidJwe,'Key management "key" must be a Uint8Array when using "PBES2" (Key Encryption Mode).');if(At===void 0)throw new CryptoError(CryptoErrorCode.InvalidJwe,'JWE "encrypted_key" is required when using "PBES2" (Key Encryption Mode).');let Nt;try{Nt=new Uint8Array([...Convert$1.string(kt.alg).toUint8Array(),0,...Convert$1.base64Url(kt.p2s).toUint8Array()])}catch{throw new CryptoError(CryptoErrorCode.EncodingError,'Failed to decode the JOSE Header "p2s" (PBES2 salt) value.')}const jt=yield Bt.deriveKey({algorithm:kt.alg,baseKeyBytes:e,iterations:kt.p2c,salt:Nt});if(!(jt.alg&&["A128KW","A192KW","A256KW"].includes(jt.alg)))throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Unsupported Key Encryption Algorithm (alg) value: ${jt.alg}`);return yield Bt.unwrapKey({decryptionKey:jt,wrappedKeyBytes:At,wrappedKeyAlgorithm:kt.enc})}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Unsupported "alg" (Algorithm) Header Parameter value: ${kt.alg}`)}})}static encrypt({key:e,joseHeader:At,crypto:kt}){return __awaiter$x(this,void 0,void 0,function*(){let Bt,Nt;switch(At.alg){case"dir":{if(Nt!==void 0)throw new CryptoError(CryptoErrorCode.InvalidJwe,'JWE "encrypted_key" is not allowed when using "dir" (Direct Encryption Mode).');if(e instanceof Uint8Array)throw new CryptoError(CryptoErrorCode.InvalidJwe,'Key management "key" must be a Key URI or JWK when using "dir" (Direct Encryption Mode).');Bt=e;break}case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{if(typeof At.p2c!="number")throw new CryptoError(CryptoErrorCode.InvalidJwe,'JOSE Header "p2c" (PBES2 Count) is missing or not a number.');if(typeof At.p2s!="string")throw new CryptoError(CryptoErrorCode.InvalidJwe,'JOSE Header "p2s" (PBES2 salt) is missing or not a string.');if(!(e instanceof Uint8Array))throw new CryptoError(CryptoErrorCode.InvalidJwe,'Key management "key" must be a Uint8Array when using "PBES2" (Key Encryption Mode).');Bt=yield kt.generateKey({algorithm:At.enc});let jt;try{jt=new Uint8Array([...Convert$1.string(At.alg).toUint8Array(),0,...Convert$1.base64Url(At.p2s).toUint8Array()])}catch{throw new CryptoError(CryptoErrorCode.EncodingError,'Failed to decode the JOSE Header "p2s" (PBES2 salt) value.')}const Lt=yield kt.deriveKey({algorithm:At.alg,baseKeyBytes:e,iterations:At.p2c,salt:jt});Nt=yield kt.wrapKey({encryptionKey:Lt,unwrappedKey:Bt});break}default:throw new CryptoError(CryptoErrorCode.AlgorithmNotSupported,`Unsupported "alg" (Algorithm) Header Parameter value: ${At.alg}`)}return{cek:Bt,encryptedKey:Nt}})}}function isCipher(xt){return xt!==null&&typeof xt=="object"&&"encrypt"in xt&&typeof xt.encrypt=="function"&&"decrypt"in xt&&typeof xt.decrypt=="function"}function hasDuplicateProperties(...xt){const e=new Set,At=xt.filter(Boolean);for(const kt of At)for(const Bt in kt){if(e.has(Bt))return!0;e.add(Bt)}return!1}var __awaiter$w=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function decodeHeaderParam(xt,e){if(e!==void 0)try{if(typeof e!="string")throw new Error;return Convert$1.base64Url(e).toUint8Array()}catch{throw new CryptoError(CryptoErrorCode.InvalidJwe,`Failed to decode the JWE Header parameter '${xt}' from Base64 URL format to Uint8Array. Ensure the value is properly encoded in Base64 URL format without padding.`)}}class FlattenedJwe{constructor(e){this.ciphertext="",Object.assign(this,e)}static decrypt({jwe:e,key:At,keyManager:kt=new LocalKeyManager$4,crypto:Bt=new AgentCryptoApi,options:Nt={}}){var jt,Lt;return __awaiter$w(this,void 0,void 0,function*(){if(!isCipher(Bt))throw new CryptoError(CryptoErrorCode.OperationNotSupported,'Crypto API does not support the "encrypt" operation.');if(!isCipher(kt))throw new CryptoError(CryptoErrorCode.OperationNotSupported,'Key Manager does not support the "decrypt" operation.');if(!e.protected&&!e.header&&!e.unprotected)throw new CryptoError(CryptoErrorCode.InvalidJwe,'JWE is missing the required JOSE header parameters. Please provide at least one of the following: "protected", "header", or "unprotected"');if(typeof e.ciphertext!="string")throw new CryptoError(CryptoErrorCode.InvalidJwe,"JWE Ciphertext is missing or not a string.");let er;if(e.protected)try{er=Convert$1.base64Url(e.protected).toObject()}catch{throw new Error("JWE Protected Header is invalid")}if(hasDuplicateProperties(er,e.header,e.unprotected))throw new Error('Duplicate properties detected. Please ensure that each parameter is defined only once across the JWE "header", "protected", and "unprotected" objects.');const tr=Object.assign(Object.assign(Object.assign({},er),e.header),e.unprotected);if(!isValidJweHeader(tr))throw new Error('JWE Header is missing required "alg" (Algorithm) and/or "enc" (Encryption) Header Parameters');if(Array.isArray(Nt.allowedAlgValues)&&!Nt.allowedAlgValues.includes(tr.alg))throw new Error(`"alg" (Algorithm) Header Parameter value not allowed: ${tr.alg}`);if(Array.isArray(Nt.allowedEncValues)&&!Nt.allowedEncValues.includes(tr.enc))throw new Error(`"enc" (Encryption Algorithm) Header Parameter value not allowed: ${tr.enc}`);let zt;try{const ur=e.encrypted_key?Convert$1.base64Url(e.encrypted_key).toUint8Array():void 0;zt=yield JweKeyManagement.decrypt({key:At,encryptedKey:ur,joseHeader:tr,keyManager:kt,crypto:Bt})}catch(ur){if(ur instanceof CryptoError&&(ur.code===CryptoErrorCode.InvalidJwe||ur.code===CryptoErrorCode.AlgorithmNotSupported))throw ur;zt=typeof At=="string"?yield kt.generateKey({algorithm:tr.enc}):yield Bt.generateKey({algorithm:tr.enc})}const rr=decodeHeaderParam("iv",e.iv),nr=decodeHeaderParam("tag",e.tag),ir=nr!==void 0?new Uint8Array([...Convert$1.base64Url(e.ciphertext).toUint8Array(),...nr??[]]):Convert$1.base64Url(e.ciphertext).toUint8Array(),ar=e.aad!==void 0?new Uint8Array([...Convert$1.string((jt=e.protected)!==null&&jt!==void 0?jt:"").toUint8Array(),...Convert$1.string(".").toUint8Array(),...Convert$1.string(e.aad).toUint8Array()]):Convert$1.string((Lt=e.protected)!==null&&Lt!==void 0?Lt:"").toUint8Array();return{plaintext:typeof zt=="string"?yield kt.decrypt({keyUri:zt,data:ir,iv:rr,additionalData:ar}):yield Bt.decrypt({key:zt,data:ir,iv:rr,additionalData:ar}),protectedHeader:er,additionalAuthenticatedData:decodeHeaderParam("aad",e.aad),sharedUnprotectedHeader:e.unprotected,unprotectedHeader:e.header}})}static encrypt({key:e,plaintext:At,additionalAuthenticatedData:kt,protectedHeader:Bt,sharedUnprotectedHeader:Nt,unprotectedHeader:jt,keyManager:Lt=new LocalKeyManager$4,crypto:er=new AgentCryptoApi}){return __awaiter$w(this,void 0,void 0,function*(){if(!isCipher(er))throw new CryptoError(CryptoErrorCode.OperationNotSupported,'Crypto API does not support the "encrypt" operation.');if(!isCipher(Lt))throw new CryptoError(CryptoErrorCode.OperationNotSupported,'Key Manager does not support the "decrypt" operation.');if(!Bt&&!Nt&&!jt)throw new CryptoError(CryptoErrorCode.InvalidJwe,'JWE is missing the required JOSE header parameters. Please provide at least one of the following: "protectedHeader", "sharedUnprotectedHeader", or "unprotectedHeader"');if(!(At instanceof Uint8Array))throw new CryptoError(CryptoErrorCode.InvalidJwe,"Plaintext is missing or not a byte array.");if(hasDuplicateProperties(Bt,Nt,jt))throw new Error('Duplicate properties detected. Please ensure that each parameter is defined only once across the JWE "protectedHeader", "sharedUnprotectedHeader", and "unprotectedHeader" objects.');const tr=Object.assign(Object.assign(Object.assign({},Bt),Nt),jt);if(!isValidJweHeader(tr))throw new Error('JWE Header is missing required "alg" (Algorithm) and/or "enc" (Encryption) Header Parameters');const{cek:zt,encryptedKey:rr}=yield JweKeyManagement.encrypt({key:e,joseHeader:tr,keyManager:Lt,crypto:er});let nr;switch(tr.enc){case"A128GCM":case"A192GCM":case"A256GCM":nr=CryptoUtils$1.randomBytes(12);break;default:nr=new Uint8Array(0)}const ir=Bt?Convert$1.object(Bt).toBase64Url():"";let ar,dr;kt?(dr=Convert$1.uint8Array(kt).toBase64Url(),ar=Convert$1.string(ir+"."+dr).toUint8Array()):ar=Convert$1.string(ir).toUint8Array();const ur=typeof zt=="string"?yield Lt.encrypt({keyUri:zt,data:At,iv:nr,additionalData:ar}):yield er.encrypt({key:zt,data:At,iv:nr,additionalData:ar}),fr=ur.slice(0,-16),pr=ur.slice(-16),lr=new FlattenedJwe({ciphertext:Convert$1.uint8Array(fr).toBase64Url()});return rr&&(lr.encrypted_key=Convert$1.uint8Array(rr).toBase64Url()),Bt&&(lr.protected=ir),Nt&&(lr.unprotected=Nt),jt&&(lr.header=jt),nr&&(lr.iv=Convert$1.uint8Array(nr).toBase64Url()),dr&&(lr.aad=dr),pr&&(lr.tag=Convert$1.uint8Array(pr).toBase64Url()),lr})}}var __awaiter$v=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class CompactJwe{static decrypt({jwe:e,key:At,keyManager:kt=new LocalKeyManager$4,crypto:Bt=new AgentCryptoApi,options:Nt={}}){return __awaiter$v(this,void 0,void 0,function*(){if(typeof e!="string")throw new CryptoError(CryptoErrorCode.InvalidJwe,"Invalid JWE format. JWE must be a string.");const{0:jt,1:Lt,2:er,3:tr,4:zt,length:rr}=e.split(".");if(rr!==5)throw new CryptoError(CryptoErrorCode.InvalidJwe,"Invalid JWE format. JWE must have 5 parts.");const nr=yield FlattenedJwe.decrypt({jwe:{ciphertext:tr,encrypted_key:Lt||void 0,iv:er||void 0,protected:jt,tag:zt||void 0},key:At,keyManager:kt,crypto:Bt,options:Nt});if(!isValidJweHeader(nr.protectedHeader))throw new CryptoError(CryptoErrorCode.InvalidJwe,"Decrypt operation failed due to missing or malformed JWE Protected Header");return{plaintext:nr.plaintext,protectedHeader:nr.protectedHeader}})}static encrypt({plaintext:e,protectedHeader:At,key:kt,keyManager:Bt=new LocalKeyManager$4,crypto:Nt=new AgentCryptoApi,options:jt={}}){return __awaiter$v(this,void 0,void 0,function*(){const Lt=yield FlattenedJwe.encrypt({plaintext:e,protectedHeader:At,key:kt,keyManager:Bt,crypto:Nt,options:jt});return[Lt.protected,Lt.encrypted_key,Lt.iv,Lt.ciphertext,Lt.tag].join(".")})}}var __awaiter$u=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function isEmptyString(xt){return typeof xt!="string"||xt.trim().length===0}function isIdentityVaultBackup(xt){return typeof xt=="object"&&xt!==null&&"dateCreated"in xt&&typeof xt.dateCreated=="string"&&"size"in xt&&typeof xt.size=="number"&&"data"in xt&&typeof xt.data=="string"}function isIdentityVaultStatus(xt){return typeof xt=="object"&&xt!==null&&"initialized"in xt&&typeof xt.initialized=="boolean"&&"lastBackup"in xt&&"lastRestore"in xt}class HdIdentityVault{constructor({keyDerivationWorkFactor:e,store:At}={}){this.crypto=new AgentCryptoApi,this._keyDerivationWorkFactor=e??21e4,this._store=At??new MemoryStore$1}backup(){return __awaiter$u(this,void 0,void 0,function*(){if(this.isLocked()||(yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Unable to proceed with the backup operation because the identity vault has not been initialized and unlocked. Please ensure the vault is properly initialized with a secure password before attempting to backup its contents.");const e={did:yield this.getStoredDid(),contentEncryptionKey:yield this.getStoredContentEncryptionKey(),status:yield this.getStatus()},At=Convert$1.object(e).toBase64Url(),kt={data:At,dateCreated:new Date().toISOString(),size:At.length};return yield this.setStatus({lastBackup:kt.dateCreated}),kt})}changePassword({oldPassword:e,newPassword:At}){return __awaiter$u(this,void 0,void 0,function*(){if((yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Unable to proceed with the change password operation because the identity vault has not been initialized. Please ensure the vault is properly initialized with a secure password before trying again.");yield this.lock();const kt=yield this.getStoredContentEncryptionKey();let Bt,Nt;try{let Lt;({plaintext:Lt,protectedHeader:Bt}=yield CompactJwe.decrypt({jwe:kt,key:Convert$1.string(e).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$1})),Nt=Convert$1.uint8Array(Lt).toObject()}catch{throw new Error("HdIdentityVault: Unable to change the vault password due to an incorrectly entered old password.")}const jt=yield CompactJwe.encrypt({key:Convert$1.string(At).toUint8Array(),protectedHeader:Bt,plaintext:Convert$1.object(Nt).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$1});yield this._store.set("contentEncryptionKey",jt),this._contentEncryptionKey=Nt})}getDid(){return __awaiter$u(this,void 0,void 0,function*(){if(this.isLocked())throw new Error("HdIdentityVault: Vault has not been initialized and unlocked.");const e=yield this.getStoredDid(),{plaintext:At}=yield CompactJwe.decrypt({jwe:e,key:this._contentEncryptionKey,crypto:this.crypto,keyManager:new LocalKeyManager$1}),kt=Convert$1.uint8Array(At).toObject();if(!isPortableDid(kt))throw new Error("HdIdentityVault: Unable to decode malformed DID in identity vault");return yield BearerDid$2.import({portableDid:kt})})}getStatus(){return __awaiter$u(this,void 0,void 0,function*(){const e=yield this._store.get("vaultStatus");if(!e)return{initialized:!1,lastBackup:null,lastRestore:null};const At=Convert$1.string(e).toObject();if(!isIdentityVaultStatus(At))throw new Error("HdIdentityVault: Invalid IdentityVaultStatus object in store");return At})}initialize({password:e,recoveryPhrase:At,dwnEndpoints:kt}){return __awaiter$u(this,void 0,void 0,function*(){if(yield this.isInitialized())throw new Error("HdIdentityVault: Vault has already been initialized.");if(isEmptyString(e))throw new Error(`HdIdentityVault: The password is required and cannot be blank. Please provide a ' +
        'valid, non-empty password.`);if(At&&isEmptyString(At))throw new Error(`HdIdentityVault: The password is required and cannot be blank. Please provide a ' +
        'valid, non-empty password.`);if(At??(At=generateMnemonic(wordlist,128)),!validateMnemonic(At,wordlist))throw new Error("HdIdentityVault: The provided recovery phrase is invalid. Please ensure that the recovery phrase is a correctly formatted series of 12 words.");const Bt=yield mnemonicToSeed(At),Nt=HDKey.fromMasterSeed(Bt),jt=Nt.derive("m/44'/0'/0'/0'/0'"),Lt=yield this.crypto.deriveKey({algorithm:"HKDF-512",baseKeyBytes:jt.privateKey,salt:"",info:"vault_cek",derivedKeyAlgorithm:"A256GCM"}),er=yield this.crypto.deriveKeyBytes({algorithm:"HKDF-512",baseKeyBytes:jt.publicKey,salt:"",info:"vault_unlock_salt",length:256}),tr={alg:"PBES2-HS512+A256KW",enc:"A256GCM",cty:"text/plain",p2c:this._keyDerivationWorkFactor,p2s:Convert$1.uint8Array(er).toBase64Url()},zt=yield CompactJwe.encrypt({key:Convert$1.string(e).toUint8Array(),protectedHeader:tr,plaintext:Convert$1.object(Lt).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$1});yield this._store.set("contentEncryptionKey",zt);const rr=Nt.derive("m/44'/0'/1708523827'/0'/0'"),nr=yield this.crypto.bytesToPrivateKey({algorithm:"Ed25519",privateKeyBytes:rr.privateKey});let ir=Nt.derive("m/44'/0'/1708523827'/0'/1'");const ar=yield this.crypto.bytesToPrivateKey({algorithm:"Ed25519",privateKeyBytes:ir.privateKey}),dr=new DeterministicKeyGenerator;yield dr.addPredefinedKeys({privateKeys:[nr,ar]});const ur={verificationMethods:[{algorithm:"Ed25519",id:"sig",purposes:["assertionMethod","authentication"]}]};kt&&kt.length&&(ur.services=[{id:"dwn",type:"DecentralizedWebNode",serviceEndpoint:kt,enc:"#enc",sig:"#sig"}]);const pr=yield(yield DidDht$2.create({keyManager:dr,options:ur})).export(),lr={alg:"dir",enc:"A256GCM",cty:"json"},yr=yield CompactJwe.encrypt({key:Lt,plaintext:Convert$1.object(pr).toUint8Array(),protectedHeader:lr,crypto:this.crypto,keyManager:new LocalKeyManager$1});return yield this._store.set("did",yr),this._contentEncryptionKey=Lt,yield this.setStatus({initialized:!0}),At})}isInitialized(){return __awaiter$u(this,void 0,void 0,function*(){return this.getStatus().then(({initialized:e})=>e)})}isLocked(){return!this._contentEncryptionKey}lock(){return __awaiter$u(this,void 0,void 0,function*(){if((yield this.isInitialized())===!1)throw new Error("HdIdentityVault: Lock operation failed. Vault has not been initialized.");this._contentEncryptionKey&&(this._contentEncryptionKey.k=""),this._contentEncryptionKey=void 0})}restore({backup:e,password:At}){return __awaiter$u(this,void 0,void 0,function*(){if(!isIdentityVaultBackup(e))throw new Error("HdIdentityVault: Restore operation failed due to invalid backup object.");let kt,Bt,Nt;try{Nt=yield this.getStoredDid(),Bt=yield this.getStoredContentEncryptionKey(),kt=yield this.getStatus()}catch{throw new Error("HdIdentityVault: The restore operation cannot proceed because the existing vault contents are missing or inaccessible. If the problem persists consider re-initializing the vault and retrying the restore.")}try{const jt=Convert$1.base64Url(e.data).toObject();yield this._store.set("did",jt.did),yield this._store.set("contentEncryptionKey",jt.contentEncryptionKey),yield this.setStatus(jt.status),yield this.unlock({password:At})}catch{throw yield this.setStatus(kt),yield this._store.set("contentEncryptionKey",Bt),yield this._store.set("did",Nt),new Error("HdIdentityVault: Restore operation failed due to invalid backup data or an incorrect password. Please verify the password is correct for the provided backup and try again.")}yield this.setStatus({lastRestore:new Date().toISOString()})})}unlock({password:e}){return __awaiter$u(this,void 0,void 0,function*(){yield this.lock();const At=yield this.getStoredContentEncryptionKey();try{const{plaintext:kt}=yield CompactJwe.decrypt({jwe:At,key:Convert$1.string(e).toUint8Array(),crypto:this.crypto,keyManager:new LocalKeyManager$1}),Bt=Convert$1.uint8Array(kt).toObject();this._contentEncryptionKey=Bt}catch{throw new Error("HdIdentityVault: Unable to unlock the vault due to an incorrect password.")}})}getStoredDid(){return __awaiter$u(this,void 0,void 0,function*(){const e=yield this._store.get("did");if(!e)throw new Error("HdIdentityVault: Unable to retrieve the DID record from the vault. Please check the vault status and if the problem persists consider re-initializing the vault and restoring the contents from a previous backup.");return e})}getStoredContentEncryptionKey(){return __awaiter$u(this,void 0,void 0,function*(){const e=yield this._store.get("contentEncryptionKey");if(!e)throw new Error("HdIdentityVault: Unable to retrieve the Content Encryption Key record from the vault. Please check the vault status and if the problem persists consider re-initializing the vault and restoring the contents from a previous backup.");return e})}setStatus({initialized:e,lastBackup:At,lastRestore:kt}){return __awaiter$u(this,void 0,void 0,function*(){let Bt=yield this.getStatus();return Bt.initialized=e??Bt.initialized,Bt.lastBackup=At??Bt.lastBackup,Bt.lastRestore=kt??Bt.lastRestore,yield this._store.set("vaultStatus",JSON.stringify(Bt)),!0})}}var __awaiter$t=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function isIdentityMetadata(xt){return!(!xt||typeof xt!="object"||xt===null)&&"name"in xt}class DwnIdentityStore extends DwnDataStore{constructor(){super(...arguments),this.name="DwnIdentityStore",this._recordProtocolDefinition=IdentityProtocolDefinition,this._recordProperties={dataFormat:"application/json",protocol:this._recordProtocolDefinition.protocol,protocolPath:"identityMetadata",schema:this._recordProtocolDefinition.types.identityMetadata.schema}}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$t(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$t(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$t(this,void 0,void 0,function*(){return yield At.set.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$t(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}getAllRecords({agent:e,tenantDid:At}){var kt;return __awaiter$t(this,void 0,void 0,function*(){this._index.clear();const{reply:Bt}=yield e.dwn.processRequest({author:At,target:At,messageType:DwnInterface.RecordsQuery,messageParams:{filter:Object.assign({},this._recordProperties)}});let Nt=[];for(const jt of(kt=Bt.entries)!==null&&kt!==void 0?kt:[]){if(!jt.encodedData)throw new Error(`${this.name}: Expected 'encodedData' to be present in the DWN query result entry`);const Lt=Convert$1.base64Url(jt.encodedData).toObject();if(isIdentityMetadata(Lt)){const er=`${At}${TENANT_SEPARATOR}${Lt.uri}`;this._index.set(er,jt.recordId),this._cache.set(jt.recordId,Lt),Nt.push(Lt)}}return Nt})}}class InMemoryIdentityStore extends InMemoryDataStore{constructor(){super(...arguments),this.name="InMemoryIdentityStore"}delete(e){const At=Object.create(null,{delete:{get:()=>super.delete}});return __awaiter$t(this,void 0,void 0,function*(){return yield At.delete.call(this,e)})}get(e){const At=Object.create(null,{get:{get:()=>super.get}});return __awaiter$t(this,void 0,void 0,function*(){return yield At.get.call(this,e)})}list(e){const At=Object.create(null,{list:{get:()=>super.list}});return __awaiter$t(this,void 0,void 0,function*(){return yield At.list.call(this,e)})}set(e){const At=Object.create(null,{set:{get:()=>super.set}});return __awaiter$t(this,void 0,void 0,function*(){return yield At.set.call(this,e)})}}var __awaiter$s=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class AgentIdentityApi{constructor({agent:e,store:At}={}){this._agent=e,this._store=At??new InMemoryIdentityStore}get agent(){if(this._agent===void 0)throw new Error("AgentIdentityApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e}create({metadata:e,didMethod:At="dht",didOptions:kt,store:Bt,tenant:Nt}){return __awaiter$s(this,void 0,void 0,function*(){const jt=yield this.agent.did.create({method:At,options:kt,store:Bt,tenant:Nt}),Lt=new BearerIdentity({did:jt,metadata:Object.assign(Object.assign({},e),{uri:jt.uri,tenant:Nt??jt.uri})});return(Bt??!0)&&(yield this._store.set({id:Lt.did.uri,data:Lt.metadata,agent:this.agent,tenant:Lt.metadata.tenant,preventDuplicates:!1,useCache:!0})),Lt})}export({didUri:e,tenant:At}){return __awaiter$s(this,void 0,void 0,function*(){const kt=yield this.get({didUri:e,tenant:At});if(!kt)throw new Error(`AgentIdentityApi: Failed to export due to Identity not found: ${e}`);return yield kt.export()})}get({didUri:e,tenant:At}){return __awaiter$s(this,void 0,void 0,function*(){const kt=yield this._store.get({id:e,agent:this.agent,tenant:At,useCache:!0});if(!kt)return;const Bt=yield this.agent.did.get({didUri:e,tenant:kt.tenant});if(!Bt)throw new Error(`AgentIdentityApi: Identity is present in the store but DID is missing: ${e}`);return new BearerIdentity({did:Bt,metadata:kt})})}import({portableIdentity:e}){return __awaiter$s(this,void 0,void 0,function*(){const At=yield this.agent.did.import({portableDid:e.portableDid,tenant:e.metadata.tenant});if(!At)throw new Error(`AgentIdentityApi: Failed to import Identity: ${e.metadata.uri}`);const kt=new BearerIdentity({did:At,metadata:e.metadata});return yield this._store.set({id:kt.did.uri,data:kt.metadata,agent:this.agent,tenant:kt.metadata.tenant,preventDuplicates:!0,useCache:!0}),kt})}list({tenant:e}={}){return __awaiter$s(this,void 0,void 0,function*(){const At=yield this._store.list({agent:this.agent,tenant:e});return(yield Promise.all(At.map(Bt=>__awaiter$s(this,void 0,void 0,function*(){return this.get({didUri:Bt.uri,tenant:Bt.tenant})})))).filter(Bt=>typeof Bt<"u")})}manage({portableIdentity:e}){return __awaiter$s(this,void 0,void 0,function*(){const At=yield this.agent.did.get({didUri:e.metadata.uri,tenant:e.metadata.tenant});if(!At)throw new Error(`AgentIdentityApi: Failed to manage Identity: ${e.metadata.uri}`);const kt=new BearerIdentity({did:At,metadata:e.metadata});return yield this._store.set({id:kt.did.uri,data:kt.metadata,agent:this.agent,preventDuplicates:!0,useCache:!0}),kt})}delete({didUri:e,tenant:At}){return __awaiter$s(this,void 0,void 0,function*(){if(!(yield this._store.get({id:e,agent:this.agent,tenant:At,useCache:!0})))throw new Error(`AgentIdentityApi: Failed to purge due to Identity not found: ${e}`);yield this._store.delete({id:e,agent:this.agent,tenant:At})})}connectedIdentity({connectedDid:e}={}){return __awaiter$s(this,void 0,void 0,function*(){const At=yield this.list();if(!(At.length<1))return e?At.find(kt=>kt.metadata.connectedDid===e):At.find(kt=>kt.metadata.connectedDid!==void 0)})}}var __awaiter$r=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$7=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class AgentPermissionsApi{get agent(){if(!this._agent)throw new Error("AgentPermissionsApi: Agent is not set");return this._agent}set agent(e){this._agent=e}constructor({agent:e}={}){this._cachedPermissions=new TtlCache({ttl:60*1e3}),this._agent=e}getPermissionForRequest({connectedDid:e,delegateDid:At,delegate:kt,messageType:Bt,protocol:Nt,cached:jt=!1}){return __awaiter$r(this,void 0,void 0,function*(){const Lt=[e,At,Bt,Nt].join("~"),er=jt?this._cachedPermissions.get(Lt):void 0;if(er)return er;const tr=yield this.fetchGrants({author:At,target:At,grantor:e,grantee:At}),zt=yield AgentPermissionsApi.matchGrantFromArray(e,At,{messageType:Bt,protocol:Nt},tr,kt);if(!zt)throw new Error(`CachedPermissions: No permissions found for ${Bt}: ${Nt}`);return this._cachedPermissions.set(Lt,zt),zt})}fetchGrants({author:e,target:At,grantee:kt,grantor:Bt,protocol:Nt,remote:jt=!1}){return __awaiter$r(this,void 0,void 0,function*(){const Lt=Nt?{protocol:Nt}:void 0,er={author:e,target:At,messageType:DwnInterface.RecordsQuery,messageParams:{filter:{author:Bt,recipient:kt,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.grantPath,tags:Lt}}},{reply:tr}=jt?yield this.agent.sendDwnRequest(er):yield this.agent.processDwnRequest(er);if(tr.status.code!==200)throw new Error(`PermissionsApi: Failed to fetch grants: ${tr.status.detail}`);const zt=[];for(const rr of tr.entries){const nr=yield PermissionGrant$1.parse(rr);zt.push({grant:nr,message:rr})}return zt})}fetchRequests({author:e,target:At,protocol:kt,remote:Bt=!1}){return __awaiter$r(this,void 0,void 0,function*(){const Nt=kt?{protocol:kt}:void 0,jt={author:e,target:At,messageType:DwnInterface.RecordsQuery,messageParams:{filter:{protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.requestPath,tags:Nt}}},{reply:Lt}=Bt?yield this.agent.sendDwnRequest(jt):yield this.agent.processDwnRequest(jt);if(Lt.status.code!==200)throw new Error(`PermissionsApi: Failed to fetch requests: ${Lt.status.detail}`);const er=[];for(const tr of Lt.entries){const zt=yield PermissionRequest$1.parse(tr);er.push({request:zt,message:tr})}return er})}isGrantRevoked({author:e,target:At,grantRecordId:kt,remote:Bt=!1}){return __awaiter$r(this,void 0,void 0,function*(){const Nt={author:e,target:At,messageType:DwnInterface.RecordsRead,messageParams:{filter:{parentId:kt,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.revocationPath}}},{reply:jt}=Bt?yield this.agent.sendDwnRequest(Nt):yield this.agent.processDwnRequest(Nt);if(jt.status.code===404)return!1;if(jt.status.code===200)return!0;throw new Error(`PermissionsApi: Failed to check if grant is revoked: ${jt.status.detail}`)})}createGrant(e){return __awaiter$r(this,void 0,void 0,function*(){const{author:At,store:kt=!1,delegated:Bt=!1}=e,Nt=__rest$7(e,["author","store","delegated"]);let jt;PermissionsProtocol.hasProtocolScope(Nt.scope)&&(jt={protocol:Nt.scope.protocol});const Lt={dateExpires:Nt.dateExpires,requestId:Nt.requestId,description:Nt.description,delegated:Bt,scope:Nt.scope},er=Convert$1.object(Lt).toUint8Array(),tr={recipient:Nt.grantedTo,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.grantPath,dataFormat:"application/json",tags:jt},{reply:zt,message:rr}=yield this.agent.processDwnRequest({store:kt,author:At,target:At,messageType:DwnInterface.RecordsWrite,messageParams:tr,dataStream:new Blob([er])});if(zt.status.code!==202)throw new Error(`PermissionsApi: Failed to create grant: ${zt.status.detail}`);const nr=Object.assign(Object.assign({},rr),{encodedData:Convert$1.uint8Array(er).toBase64Url()});return{grant:yield PermissionGrant$1.parse(nr),message:nr}})}createRequest(e){return __awaiter$r(this,void 0,void 0,function*(){const{author:At,store:kt=!1,delegated:Bt=!1}=e,Nt=__rest$7(e,["author","store","delegated"]);let jt;PermissionsProtocol.hasProtocolScope(Nt.scope)&&(jt={protocol:Nt.scope.protocol});const Lt={description:Nt.description,delegated:Bt,scope:Nt.scope},er=Convert$1.object(Lt).toUint8Array(),tr={protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.requestPath,dataFormat:"application/json",tags:jt},{reply:zt,message:rr}=yield this.agent.processDwnRequest({store:kt,author:At,target:At,messageType:DwnInterface.RecordsWrite,messageParams:tr,dataStream:new Blob([er])});if(zt.status.code!==202)throw new Error(`PermissionsApi: Failed to create request: ${zt.status.detail}`);const nr=Object.assign(Object.assign({},rr),{encodedData:Convert$1.uint8Array(er).toBase64Url()});return{request:yield PermissionRequest$1.parse(nr),message:nr}})}createRevocation(e){return __awaiter$r(this,void 0,void 0,function*(){const{author:At,store:kt=!1,grant:Bt,description:Nt}=e,jt={description:Nt},Lt=Convert$1.object(jt).toUint8Array();let er;PermissionsProtocol.hasProtocolScope(Bt.scope)&&(er={protocol:Bt.scope.protocol});const tr={parentContextId:Bt.id,protocol:PermissionsProtocol.uri,protocolPath:PermissionsProtocol.revocationPath,dataFormat:"application/json",tags:er},{reply:zt,message:rr}=yield this.agent.processDwnRequest({store:kt,author:At,target:At,messageType:DwnInterface.RecordsWrite,messageParams:tr,dataStream:new Blob([Lt])});if(zt.status.code!==202)throw new Error(`PermissionsApi: Failed to create revocation: ${zt.status.detail}`);return{message:Object.assign(Object.assign({},rr),{encodedData:Convert$1.uint8Array(Lt).toBase64Url()})}})}clear(){return __awaiter$r(this,void 0,void 0,function*(){this._cachedPermissions.clear()})}static matchGrantFromArray(e,At,kt,Bt,Nt=!1){return __awaiter$r(this,void 0,void 0,function*(){for(const jt of Bt){const{grant:Lt,message:er}=jt;if(Nt===!0&&Lt.delegated!==!0)continue;const{messageType:tr,protocol:zt,protocolPath:rr,contextId:nr}=kt;if(this.matchScopeFromGrant(e,At,tr,Lt,zt,rr,nr))return{grant:Lt,message:er}}})}static matchScopeFromGrant(e,At,kt,Bt,Nt,jt,Lt){if(Bt.grantee!==At||Bt.grantor!==e)return!1;const er=Bt.scope;if(er.interface+er.method===kt)if(isRecordsType(kt)){const zt=er;if(zt.protocol!==Nt)return!1;if(this.isUnrestrictedProtocolScope(zt)||zt.protocolPath!==void 0&&zt.protocolPath===jt||zt.contextId!==void 0&&(Lt!=null&&Lt.startsWith(zt.contextId)))return!0}else{const zt=er;return zt.protocol===void 0?!0:zt.protocol!==Nt?!1:this.isUnrestrictedProtocolScope(zt)}return!1}static isUnrestrictedProtocolScope(e){return e.contextId===void 0&&e.protocolPath===void 0}}var JsonRpcErrorCodes;(function(xt){xt[xt.InvalidRequest=-32600]="InvalidRequest",xt[xt.MethodNotFound=-32601]="MethodNotFound",xt[xt.InvalidParams=-32602]="InvalidParams",xt[xt.InternalError=-32603]="InternalError",xt[xt.ParseError=-32700]="ParseError",xt[xt.TransportError=-32300]="TransportError",xt[xt.BadRequest=-50400]="BadRequest",xt[xt.Unauthorized=-50401]="Unauthorized",xt[xt.Forbidden=-50403]="Forbidden",xt[xt.Conflict=-50409]="Conflict"})(JsonRpcErrorCodes||(JsonRpcErrorCodes={}));const createJsonRpcRequest=(xt,e,At)=>({jsonrpc:"2.0",id:xt,method:e,params:At}),createJsonRpcSubscriptionRequest=(xt,e,At,kt)=>({jsonrpc:"2.0",id:xt,method:`rpc.subscribe.${e}`,params:kt,subscription:{id:At}});function parseJson(xt){try{return JSON.parse(xt)}catch{return null}}var __awaiter$q=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class DwnServerInfoCacheMemory{constructor({ttl:e="15m"}={}){this.cache=new TtlCache({ttl:ms$1(e)})}get(e){return __awaiter$q(this,void 0,void 0,function*(){return this.cache.get(e)})}set(e,At){return __awaiter$q(this,void 0,void 0,function*(){this.cache.set(e,At)})}delete(e){return __awaiter$q(this,void 0,void 0,function*(){this.cache.delete(e)})}clear(){return __awaiter$q(this,void 0,void 0,function*(){this.cache.clear()})}close(){return __awaiter$q(this,void 0,void 0,function*(){})}}var __awaiter$p=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class HttpDwnRpcClient{constructor(e){this.serverInfoCache=e??new DwnServerInfoCacheMemory}get transportProtocols(){return["http:","https:"]}sendDwnRequest(e){return __awaiter$p(this,void 0,void 0,function*(){const At=CryptoUtils$1.randomUuid(),kt=createJsonRpcRequest(At,"dwn.processMessage",{target:e.targetDid,message:e.message}),Bt={method:"POST",headers:{"dwn-request":JSON.stringify(kt)}};e.data&&(Bt.headers["content-type"]="application/octet-stream",Bt.body=e.data);const Nt=yield fetch(e.dwnUrl,Bt);let jt,Lt;const{headers:er}=Nt;if(er.has("dwn-response")){const zt=parseJson(er.get("dwn-response"));if(zt==null)throw new Error(`failed to parse json rpc response. dwn url: ${e.dwnUrl}`);Lt=Nt.body,jt=zt}else{const zt=yield Nt.text();jt=JSON.parse(zt)}if(jt.error){const{code:zt,message:rr}=jt.error;throw new Error(`(${zt}) - ${rr}`)}const{reply:tr}=jt.result;return Lt&&tr.record?tr.record.data=Lt:Lt&&tr.entry&&(tr.entry.data=Lt),tr})}getServerInfo(e){return __awaiter$p(this,void 0,void 0,function*(){const At=yield this.serverInfoCache.get(e);if(At)return At;const kt=new URL(e);kt.pathname.endsWith("/")?kt.pathname+="info":kt.pathname+="/info";try{const Bt=yield fetch(kt.toString());if(Bt.ok){const Nt=yield Bt.json(),jt={registrationRequirements:Nt.registrationRequirements,maxFileSize:Nt.maxFileSize,webSocketSupport:Nt.webSocketSupport};return this.serverInfoCache.set(e,jt),jt}else throw new Error(`HTTP (${Bt.status}) - ${Bt.statusText}`)}catch(Bt){throw new Error(`Error encountered while processing response from ${kt.toString()}: ${Bt.message}`)}})}}var __awaiter$o=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const CONNECT_TIMEOUT=3e3,RESPONSE_TIMEOUT=3e4;class JsonRpcSocket{constructor(e,At){this.socket=e,this.responseTimeout=At,this.messageHandlers=new Map}static connect(e,At={}){return __awaiter$o(this,void 0,void 0,function*(){const{connectTimeout:kt=CONNECT_TIMEOUT,responseTimeout:Bt=RESPONSE_TIMEOUT,onclose:Nt,onerror:jt}=At,Lt=new IsomorphicWebSocket(e);return Nt?Lt.onclose=Nt:Lt.onclose=()=>{console.info(`JSON RPC Socket close ${e}`)},jt?Lt.onerror=jt:Lt.onerror=er=>{console.error(`JSON RPC Socket error ${e}`,er)},new Promise((er,tr)=>{Lt.addEventListener("open",()=>{const zt=new JsonRpcSocket(Lt,Bt);Lt.addEventListener("message",rr=>{const nr=parseJson(rr.data),ir=zt.messageHandlers.get(nr.id);ir&&ir(rr)}),er(zt)}),Lt.addEventListener("error",zt=>{tr(zt)}),setTimeout(()=>tr,kt)})})}close(){this.socket.close()}request(e){return __awaiter$o(this,void 0,void 0,function*(){return new Promise((At,kt)=>{var Bt;(Bt=e.id)!==null&&Bt!==void 0||(e.id=CryptoUtils$1.randomUuid());const Nt=jt=>{const Lt=parseJson(jt.data);if(Lt.id===e.id)return this.messageHandlers.delete(e.id),At(Lt)};this.messageHandlers.set(e.id,Nt),this.send(e),setTimeout(()=>{this.messageHandlers.delete(e.id),kt(new Error("request timed out"))},this.responseTimeout)})})}subscribe(e,At){return __awaiter$o(this,void 0,void 0,function*(){if(!e.method.startsWith("rpc.subscribe."))throw new Error("subscribe rpc requests must include the `rpc.subscribe` prefix");if(!e.subscription)throw new Error("subscribe rpc requests must include subscribe options");const kt=e.subscription.id,Bt=Lt=>{const er=parseJson(Lt.data.toString());er.id===kt&&(er.error!==void 0&&(this.messageHandlers.delete(kt),this.closeSubscription(kt)),At(er))};this.messageHandlers.set(kt,Bt);const Nt=yield this.request(e);return Nt.error?(this.messageHandlers.delete(kt),{response:Nt}):{response:Nt,close:()=>__awaiter$o(this,void 0,void 0,function*(){this.messageHandlers.delete(kt),yield this.closeSubscription(kt)})}})}closeSubscription(e){const At=CryptoUtils$1.randomUuid(),kt=createJsonRpcSubscriptionRequest(At,"close",e,{});return this.request(kt)}send(e){this.socket.send(JSON.stringify(e))}}var __awaiter$n=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class WebSocketDwnRpcClient{get transportProtocols(){return["ws:","wss:"]}sendDwnRequest(e,At){return __awaiter$n(this,void 0,void 0,function*(){const kt=new URL(e.dwnUrl);if(kt.protocol!=="ws:"&&kt.protocol!=="wss:")throw new Error(`Invalid websocket protocol ${kt.protocol}`);if(!WebSocketDwnRpcClient.connections.has(kt.host))try{const tr=yield JsonRpcSocket.connect(kt.toString(),At),zt=new Map;WebSocketDwnRpcClient.connections.set(kt.host,{socket:tr,subscriptions:zt})}catch(tr){throw new Error(`Error connecting to ${kt.host}: ${tr.message}`)}const Nt=WebSocketDwnRpcClient.connections.get(kt.host),{targetDid:jt,message:Lt,subscriptionHandler:er}=e;return er?WebSocketDwnRpcClient.subscriptionRequest(Nt,jt,Lt,er):WebSocketDwnRpcClient.processMessage(Nt,jt,Lt)})}static processMessage(e,At,kt){return __awaiter$n(this,void 0,void 0,function*(){const Bt=CryptoUtils$1.randomUuid(),Nt=createJsonRpcRequest(Bt,"dwn.processMessage",{target:At,message:kt}),{socket:jt}=e,Lt=yield jt.request(Nt),{error:er,result:tr}=Lt;if(er!==void 0)throw new Error(`error sending DWN request: ${er.message}`);return tr.reply})}static subscriptionRequest(e,At,kt,Bt){return __awaiter$n(this,void 0,void 0,function*(){const Nt=CryptoUtils$1.randomUuid(),jt=CryptoUtils$1.randomUuid(),Lt=createJsonRpcSubscriptionRequest(Nt,"dwn.processMessage",jt,{target:At,message:kt}),{socket:er,subscriptions:tr}=e,{response:zt,close:rr}=yield er.subscribe(Lt,dr=>{const{result:ur,error:fr}=dr;if(fr){const lr=tr.get(jt);lr&&lr.close(),tr.delete(jt);return}const{event:pr}=ur;Bt(pr)}),{error:nr,result:ir}=zt;if(nr)throw new Error(`could not subscribe via jsonrpc socket: ${nr.message}`);const{reply:ar}=ir;return ar.subscription&&rr&&(tr.set(jt,Object.assign(Object.assign({},ar.subscription),{close:rr})),ar.subscription.close=rr),ar})}}WebSocketDwnRpcClient.connections=new Map;var __awaiter$m=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},DidRpcMethod;(function(xt){xt.Create="did.create",xt.Resolve="did.resolve"})(DidRpcMethod||(DidRpcMethod={}));class Web5RpcClient{constructor(e=[]){this.transportClients=new Map,e=[new HttpWeb5RpcClient,new WebSocketWeb5RpcClient,...e];for(let At of e)for(let kt of At.transportProtocols)this.transportClients.set(kt,At)}get transportProtocols(){return Array.from(this.transportClients.keys())}sendDidRequest(e){return __awaiter$m(this,void 0,void 0,function*(){const At=new URL(e.url),kt=this.transportClients.get(At.protocol);if(!kt){const Bt=new Error(`no ${At.protocol} transport client available`);throw Bt.name="NO_TRANSPORT_CLIENT",Bt}return kt.sendDidRequest(e)})}sendDwnRequest(e){const At=new URL(e.dwnUrl),kt=this.transportClients.get(At.protocol);if(!kt){const Bt=new Error(`no ${At.protocol} transport client available`);throw Bt.name="NO_TRANSPORT_CLIENT",Bt}return kt.sendDwnRequest(e)}getServerInfo(e){return __awaiter$m(this,void 0,void 0,function*(){const At=new URL(e),kt=this.transportClients.get(At.protocol);if(!kt){const Bt=new Error(`no ${At.protocol} transport client available`);throw Bt.name="NO_TRANSPORT_CLIENT",Bt}return kt.getServerInfo(e)})}}class HttpWeb5RpcClient extends HttpDwnRpcClient{sendDidRequest(e){return __awaiter$m(this,void 0,void 0,function*(){const At=CryptoUtils$1.randomUuid(),kt=createJsonRpcRequest(At,e.method,{data:e.data}),Bt=new Request(e.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(kt)});let Nt;try{const jt=yield fetch(Bt);if(jt.ok){if(Nt=yield jt.json(),Nt.error){const{code:Lt,message:er}=Nt.error;throw new Error(`JSON RPC (${Lt}) - ${er}`)}}else throw new Error(`HTTP (${jt.status}) - ${jt.statusText}`)}catch(jt){throw new Error(`Error encountered while processing response from ${e.url}: ${jt.message}`)}return Nt.result})}}class WebSocketWeb5RpcClient extends WebSocketDwnRpcClient{sendDidRequest(e){return __awaiter$m(this,void 0,void 0,function*(){throw new Error(`not implemented for transports [${this.transportProtocols.join(", ")}]`)})}getServerInfo(e){return __awaiter$m(this,void 0,void 0,function*(){throw new Error(`not implemented for transports [${this.transportProtocols.join(", ")}]`)})}}var __awaiter$l=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class AgentSyncApi{constructor({agent:e,syncEngine:At}){this._syncEngine=At,this._agent=e}get agent(){if(this._agent===void 0)throw new Error("AgentSyncApi: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,this._syncEngine.agent=e}registerIdentity(e){return __awaiter$l(this,void 0,void 0,function*(){yield this._syncEngine.registerIdentity(e)})}unregisterIdentity(e){return __awaiter$l(this,void 0,void 0,function*(){yield this._syncEngine.unregisterIdentity(e)})}getIdentityOptions(e){return __awaiter$l(this,void 0,void 0,function*(){return yield this._syncEngine.getIdentityOptions(e)})}updateIdentityOptions(e){return __awaiter$l(this,void 0,void 0,function*(){yield this._syncEngine.updateIdentityOptions(e)})}sync(e){return this._syncEngine.sync(e)}startSync(e){return this._syncEngine.startSync(e)}stopSync(e){return this._syncEngine.stopSync(e)}}var __awaiter$k=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__asyncValues=function(xt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=xt[Symbol.asyncIterator],At;return e?e.call(xt):(xt=typeof __values=="function"?__values(xt):xt[Symbol.iterator](),At={},kt("next"),kt("throw"),kt("return"),At[Symbol.asyncIterator]=function(){return this},At);function kt(Nt){At[Nt]=xt[Nt]&&function(jt){return new Promise(function(Lt,er){jt=xt[Nt](jt),Bt(Lt,er,jt.done,jt.value)})}}function Bt(Nt,jt,Lt,er){Promise.resolve(er).then(function(tr){Nt({value:tr,done:Lt})},jt)}};class SyncEngineLevel{constructor({agent:e,dataPath:At,db:kt}){this._syncLock=!1,this._agent=e,this._permissionsApi=new AgentPermissionsApi({agent:e}),this._db=kt||new Level(At??"DATA/AGENT/SYNC_STORE"),this._ulidFactory=monotonicFactory()}get agent(){if(this._agent===void 0)throw new Error("SyncEngineLevel: Unable to determine agent execution context.");return this._agent}set agent(e){this._agent=e,this._permissionsApi=new AgentPermissionsApi({agent:e})}clear(){return __awaiter$k(this,void 0,void 0,function*(){yield this._permissionsApi.clear(),yield this._db.clear()})}close(){return __awaiter$k(this,void 0,void 0,function*(){yield this._db.close()})}pull(){var e;return __awaiter$k(this,void 0,void 0,function*(){const At=yield this.getSyncPeerState({syncDirection:"pull"});yield this.enqueueOperations({syncDirection:"pull",syncPeerState:At});const kt=this.getPullQueue(),Bt=yield kt.iterator().all(),Nt=[],jt=new Set;for(let Lt of Bt){const[er]=Lt,{did:tr,dwnUrl:zt,messageCid:rr,delegateDid:nr,protocol:ir}=SyncEngineLevel.parseSyncMessageParamsKey(er);if(jt.has(zt))continue;if(yield this.messageExists(tr,rr)){Nt.push({type:"del",key:er});continue}let dr,ur;if(nr)try{dr=(yield this._permissionsApi.getPermissionForRequest({connectedDid:tr,messageType:DwnInterface.MessagesRead,delegateDid:nr,protocol:ir,cached:!0})).grant.id,ur=nr}catch(Pr){console.error("SyncEngineLevel: pull - Error fetching MessagesRead permission grant for delegate DID",Pr);continue}const fr=yield this.agent.processDwnRequest({store:!1,author:tr,target:tr,messageType:DwnInterface.MessagesRead,granteeDid:ur,messageParams:{messageCid:rr,permissionGrantId:dr}});let pr;try{pr=yield this.agent.rpc.sendDwnRequest({dwnUrl:zt,targetDid:tr,message:fr.message})}catch{jt.add(zt);continue}if(pr.status.code!==200||!(!((e=pr.entry)===null||e===void 0)&&e.message)){yield this.addMessage(tr,rr),Nt.push({type:"del",key:er});continue}const lr=pr.entry,yr=lr.message,br=isRecordsWrite(lr)&&lr.data?NodeStream$1.fromWebReadable({readableStream:lr.data}):void 0,Ar=yield this.agent.dwn.node.processMessage(tr,yr,{dataStream:br});SyncEngineLevel.syncMessageReplyIsSuccessful(Ar)&&(yield this.addMessage(tr,rr),Nt.push({type:"del",key:er}))}yield kt.batch(Nt)})}push(){return __awaiter$k(this,void 0,void 0,function*(){const e=yield this.getSyncPeerState({syncDirection:"push"});yield this.enqueueOperations({syncDirection:"push",syncPeerState:e});const At=this.getPushQueue(),kt=yield At.iterator().all(),Bt=[],Nt=new Set;for(let jt of kt){const[Lt]=jt,{did:er,delegateDid:tr,protocol:zt,dwnUrl:rr,messageCid:nr}=SyncEngineLevel.parseSyncMessageParamsKey(Lt);if(Nt.has(rr))continue;const ir=yield this.getDwnMessage({author:er,messageCid:nr,delegateDid:tr,protocol:zt});if(!ir){Bt.push({type:"del",key:Lt}),yield this.addMessage(er,nr);continue}try{const ar=yield this.agent.rpc.sendDwnRequest({dwnUrl:rr,targetDid:er,data:ir.data,message:ir.message});SyncEngineLevel.syncMessageReplyIsSuccessful(ar)&&(yield this.addMessage(er,nr),Bt.push({type:"del",key:Lt}))}catch{Nt.add(rr)}}yield At.batch(Bt)})}registerIdentity({did:e,options:At}){return __awaiter$k(this,void 0,void 0,function*(){const kt=this._db.sublevel("registeredIdentities");if(yield this.getIdentityOptions(e))throw new Error(`SyncEngineLevel: Identity with DID ${e} is already registered.`);At??(At={protocols:[]}),yield kt.put(e,JSON.stringify(At))})}unregisterIdentity(e){return __awaiter$k(this,void 0,void 0,function*(){const At=this._db.sublevel("registeredIdentities");if(!(yield this.getIdentityOptions(e)))throw new Error(`SyncEngineLevel: Identity with DID ${e} is not registered.`);yield At.del(e)})}getIdentityOptions(e){return __awaiter$k(this,void 0,void 0,function*(){const At=this._db.sublevel("registeredIdentities");try{const kt=yield At.get(e);if(kt)return JSON.parse(kt)}catch(kt){const Bt=kt;if(Bt.code==="LEVEL_NOT_FOUND")return;throw new Error(`SyncEngineLevel: Error reading level: ${Bt.code}.`)}})}updateIdentityOptions({did:e,options:At}){return __awaiter$k(this,void 0,void 0,function*(){const kt=this._db.sublevel("registeredIdentities");if(!(yield this.getIdentityOptions(e)))throw new Error(`SyncEngineLevel: Identity with DID ${e} is not registered.`);yield kt.put(e,JSON.stringify(At))})}sync(e){return __awaiter$k(this,void 0,void 0,function*(){if(this._syncLock)throw new Error("SyncEngineLevel: Sync operation is already in progress.");this._syncLock=!0;try{(!e||e==="push")&&(yield this.push()),(!e||e==="pull")&&(yield this.pull())}finally{this._syncLock=!1}})}startSync({interval:e}){return __awaiter$k(this,void 0,void 0,function*(){const At=ms$1(e),kt=()=>__awaiter$k(this,void 0,void 0,function*(){this._syncLock||(clearInterval(this._syncIntervalId),this._syncIntervalId=void 0,yield this.sync(),this._syncIntervalId||(this._syncIntervalId=setInterval(kt,At)))});this._syncIntervalId&&clearInterval(this._syncIntervalId),this._syncIntervalId=setInterval(kt,At),this._syncLock||(yield this.sync())})}stopSync(e=2e3){return __awaiter$k(this,void 0,void 0,function*(){let At=0;for(;this._syncLock;){if(At>=e)throw new Error(`SyncEngineLevel: Existing sync operation did not complete within ${e} milliseconds.`);At+=100,yield new Promise(kt=>setTimeout(kt,e<100?e:100))}this._syncIntervalId&&(clearInterval(this._syncIntervalId),this._syncIntervalId=void 0)})}static syncMessageReplyIsSuccessful(e){var At,kt;return e.status.code===202||e.status.code===204||e.status.code===409||((At=e.entry)===null||At===void 0?void 0:At.message.descriptor.interface)===DwnInterfaceName.Records&&((kt=e.entry)===null||kt===void 0?void 0:kt.message.descriptor.method)===DwnMethodName.Delete&&e.status.code===404}enqueueOperations({syncDirection:e,syncPeerState:At}){return __awaiter$k(this,void 0,void 0,function*(){for(let kt of At){const Bt=yield this.getDwnEventLog({did:kt.did,delegateDid:kt.delegateDid,dwnUrl:kt.dwnUrl,cursor:kt.cursor,protocol:kt.protocol,syncDirection:e}),Nt=[];for(let jt of Bt){const Lt=this._ulidFactory(),er=SyncEngineLevel.generateSyncMessageParamsKey(Object.assign(Object.assign({},kt),{watermark:Lt,messageCid:jt}));Nt.push({type:"put",key:er,value:""})}Nt.length>0&&(yield(e==="pull"?this.getPullQueue():this.getPushQueue()).batch(Nt))}})}static generateSyncMessageParamsKey({did:e,delegateDid:At,dwnUrl:kt,protocol:Bt,watermark:Nt,messageCid:jt}){return[e,At,kt,Bt,Nt,jt].join("~")}static parseSyncMessageParamsKey(e){const[At,kt,Bt,Nt,jt,Lt]=e.split("~");return{did:At,delegateDid:kt===""?void 0:kt,dwnUrl:Bt,watermark:jt,messageCid:Lt,protocol:Nt===""?void 0:Nt}}getDwnEventLog({did:e,delegateDid:At,dwnUrl:kt,syncDirection:Bt,cursor:Nt,protocol:jt}){var Lt;return __awaiter$k(this,void 0,void 0,function*(){let er={},tr;if(At)try{tr=(yield this._permissionsApi.getPermissionForRequest({connectedDid:e,messageType:DwnInterface.MessagesQuery,delegateDid:At,protocol:jt,cached:!0})).grant.id}catch(rr){return console.error("SyncEngineLevel: Error fetching MessagesQuery permission grant for delegate DID",rr),[]}if(Bt==="pull"){const rr=jt?[{protocol:jt}]:[],nr=yield this.agent.dwn.processRequest({store:!1,target:e,author:e,messageType:DwnInterface.MessagesQuery,granteeDid:At,messageParams:{filters:rr,cursor:Nt,permissionGrantId:tr}});try{er=yield this.agent.rpc.sendDwnRequest({dwnUrl:kt,targetDid:e,message:nr.message})}catch{}}else if(Bt==="push"){const rr=jt?[{protocol:jt}]:[];er=(yield this.agent.dwn.processRequest({author:e,target:e,messageType:DwnInterface.MessagesQuery,granteeDid:At,messageParams:{filters:rr,cursor:Nt,permissionGrantId:tr}})).reply}const zt=(Lt=er.entries)!==null&&Lt!==void 0?Lt:[];return er.cursor&&this.setCursor(e,kt,Bt,er.cursor,jt),zt})}getDwnMessage({author:e,delegateDid:At,protocol:kt,messageCid:Bt}){return __awaiter$k(this,void 0,void 0,function*(){let Nt;if(At)try{Nt=(yield this._permissionsApi.getPermissionForRequest({connectedDid:e,messageType:DwnInterface.MessagesRead,delegateDid:At,protocol:kt,cached:!0})).grant.id}catch(tr){console.error("SyncEngineLevel: push - Error fetching MessagesRead permission grant for delegate DID",tr);return}let{reply:jt}=yield this.agent.dwn.processRequest({author:e,target:e,messageType:DwnInterface.MessagesRead,granteeDid:At,messageParams:{messageCid:Bt,permissionGrantId:Nt}});if(jt.status.code!==200||!jt.entry)return;const Lt=jt.entry;let er={message:Lt.message};if(isRecordsWrite(Lt)&&Lt.data){const tr=yield NodeStream$1.consumeToBytes({readable:Lt.data});er.data=new Blob([tr],{type:Lt.message.descriptor.dataFormat})}return er})}getSyncPeerState({syncDirection:e}){var At,kt,Bt,Nt;return __awaiter$k(this,void 0,void 0,function*(){const jt=[];try{for(var Lt=!0,er=__asyncValues(this._db.sublevel("registeredIdentities").iterator()),tr;tr=yield er.next(),At=tr.done,!At;Lt=!0){Nt=tr.value,Lt=!1;const[zt,rr]=Nt,{protocols:nr,delegateDid:ir}=yield new Promise(dr=>{try{const{protocols:ur,delegateDid:fr}=JSON.parse(rr);dr({protocols:ur,delegateDid:fr})}catch{dr({protocols:[]})}}),ar=yield getDwnServiceEndpointUrls(zt,this.agent.did);if(ar.length!==0)for(let dr of ar)if(nr.length===0){const ur=yield this.getCursor(zt,dr,e);jt.push({did:zt,delegateDid:ir,dwnUrl:dr,cursor:ur})}else for(const ur of nr){const fr=yield this.getCursor(zt,dr,e,ur);jt.push({did:zt,delegateDid:ir,dwnUrl:dr,cursor:fr,protocol:ur})}}}catch(zt){kt={error:zt}}finally{try{!Lt&&!At&&(Bt=er.return)&&(yield Bt.call(er))}finally{if(kt)throw kt.error}}return jt})}getCursor(e,At,kt,Bt){return __awaiter$k(this,void 0,void 0,function*(){const Nt=Bt?`${e}~${At}~${kt}-${Bt}`:`${e}~${At}~${kt}`,jt=this.getCursorStore();try{const Lt=yield jt.get(Nt);if(Lt)return JSON.parse(Lt)}catch(Lt){if(Lt.notFound)return}})}setCursor(e,At,kt,Bt,Nt){return __awaiter$k(this,void 0,void 0,function*(){const jt=Nt?`${e}~${At}~${kt}-${Nt}`:`${e}~${At}~${kt}`;yield this.getCursorStore().put(jt,JSON.stringify(Bt))})}messageExists(e,At){return __awaiter$k(this,void 0,void 0,function*(){const kt=this.getMessageStore(e);try{return yield kt.get(At),!0}catch(Bt){if(Bt.notFound)return!1;throw Bt}})}addMessage(e,At){return __awaiter$k(this,void 0,void 0,function*(){return yield this.getMessageStore(e).put(At,"")})}getMessageStore(e){return this._db.sublevel("history").sublevel(e).sublevel("messages")}getCursorStore(){return this._db.sublevel("cursors")}getPushQueue(){return this._db.sublevel("pushQueue")}getPullQueue(){return this._db.sublevel("pullQueue")}}var __awaiter$j=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$6=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};function buildOidcUrl({baseURL:xt,endpoint:e,authParam:At,tokenParam:kt}){switch(e){case"pushedAuthorizationRequest":return concatenateUrl(xt,"par");case"authorize":if(!At)throw new Error("authParam must be providied when building a token URL");return concatenateUrl(xt,`authorize/${At}.jwt`);case"callback":return concatenateUrl(xt,"callback");case"token":if(!kt)throw new Error("tokenParam must be providied when building a token URL");return concatenateUrl(xt,`token/${kt}.jwt`);default:throw new Error(`No matches for endpoint specified: ${e}`)}}function generateCodeChallenge(){return __awaiter$j(this,void 0,void 0,function*(){const xt=CryptoUtils$1.randomBytes(32),e=yield Sha256$2.digest({data:xt}),At=Convert$1.uint8Array(e).toBase64Url();return{codeChallengeBytes:e,codeChallengeBase64Url:At}})}function createAuthRequest(xt){return __awaiter$j(this,void 0,void 0,function*(){const e=CryptoUtils$1.randomBytes(16),At=CryptoUtils$1.randomBytes(16);return Object.assign(Object.assign({},xt),{nonce:Convert$1.uint8Array(At).toBase64Url(),response_type:"id_token",response_mode:"direct_post",state:Convert$1.uint8Array(e).toBase64Url(),client_metadata:{subject_syntax_types_supported:["did:dht","did:jwk"]}})})}function encryptAuthRequest({jwt:xt,encryptionKey:e}){return __awaiter$j(this,void 0,void 0,function*(){const At={alg:"dir",cty:"JWT",enc:"XC20P",typ:"JWT"},kt=CryptoUtils$1.randomBytes(24),Bt=Convert$1.object(At).toUint8Array(),Nt=Convert$1.string(xt).toUint8Array(),Lt=xchacha20poly1305(e,kt,Bt).encrypt(Nt),er=Lt.subarray(0,-16),tr=Lt.subarray(-16);return[Convert$1.object(At).toBase64Url(),"",Convert$1.uint8Array(kt).toBase64Url(),Convert$1.uint8Array(er).toBase64Url(),Convert$1.uint8Array(tr).toBase64Url()].join(".")})}function createResponseObject(xt){return __awaiter$j(this,void 0,void 0,function*(){const e=Math.floor(Date.now()/1e3);return Object.assign(Object.assign({},xt),{iat:e,exp:e+600})})}function signJwt({did:xt,data:e}){return __awaiter$j(this,void 0,void 0,function*(){const At=Convert$1.object({alg:"EdDSA",kid:xt.document.verificationMethod[0].id,typ:"JWT"}).toBase64Url(),kt=Convert$1.object(e).toBase64Url(),Nt=yield(yield xt.getSigner()).sign({data:Convert$1.string(`${At}.${kt}`).toUint8Array()}),jt=Convert$1.uint8Array(Nt).toBase64Url();return`${At}.${kt}.${jt}`})}function verifyJwt({jwt:xt}){var e,At;return __awaiter$j(this,void 0,void 0,function*(){const[kt,Bt,Nt]=xt.split("."),jt=Convert$1.base64Url(kt).toObject();if(!jt.kid)throw new Error("OIDC: Object could not be verified due to missing 'kid' header value.");const{didDocument:Lt}=yield DidJwk$2.resolve(jt.kid.split("#")[0]);if(!Lt)throw new Error("OIDC: Object could not be verified due to Client DID resolution issue.");const{publicKeyJwk:er}=(At=(e=Lt.verificationMethod)===null||e===void 0?void 0:e.find(nr=>nr.id===jt.kid))!==null&&At!==void 0?At:{};if(!er)throw new Error("OIDC: Object could not be verified due to missing public key in DID document.");if(!(yield new EdDsaAlgorithm$4().verify({key:er,signature:Convert$1.base64Url(Nt).toUint8Array(),data:Convert$1.string(`${kt}.${Bt}`).toUint8Array()})))throw new Error("OIDC: Object failed verification due to invalid signature.");return Convert$1.base64Url(Bt).toObject()})}const getAuthRequest=(xt,e)=>__awaiter$j(void 0,void 0,void 0,function*(){const kt=yield(yield fetch(xt)).text(),Bt=decryptAuthRequest({jwe:kt,encryption_key:e});return yield verifyJwt({jwt:Bt})});function decryptAuthRequest({jwe:xt,encryption_key:e}){const[At,,kt,Bt,Nt]=xt.split("."),jt=Convert$1.base64Url(e).toUint8Array(),er=Convert$1.base64Url(At).toUint8Array(),tr=Convert$1.base64Url(kt).toUint8Array(),zt=Convert$1.base64Url(Bt).toUint8Array(),rr=Convert$1.base64Url(Nt).toUint8Array(),nr=new Uint8Array([...zt,...rr]),ar=xchacha20poly1305(jt,tr,er).decrypt(nr);return Convert$1.uint8Array(ar).toString()}function decryptAuthResponse(xt,e,At){return __awaiter$j(this,void 0,void 0,function*(){const[kt,,Bt,Nt,jt]=e.split("."),Lt=Convert$1.base64Url(kt).toObject(),er=yield DidJwk$2.resolve(Lt.kid.split("#")[0]),tr=yield Oidc.deriveSharedKey(xt,er.didDocument),zt=Object.assign(Object.assign({},Lt),{pin:At}),rr=Convert$1.object(zt).toUint8Array(),nr=Convert$1.base64Url(Bt).toUint8Array(),ir=Convert$1.base64Url(Nt).toUint8Array(),ar=Convert$1.base64Url(jt).toUint8Array(),dr=new Uint8Array([...ir,...ar]),fr=xchacha20poly1305(tr,nr,rr).decrypt(dr);return Convert$1.uint8Array(fr).toString()})}function deriveSharedKey(xt,e){var At,kt;return __awaiter$j(this,void 0,void 0,function*(){const Bt=yield xt.export(),Nt=(At=e.verificationMethod)===null||At===void 0?void 0:At[0].publicKeyJwk,jt=(kt=Bt.privateKeys)===null||kt===void 0?void 0:kt[0];Nt.alg="EdDSA";const Lt=yield Ed25519$2.convertPublicKeyToX25519({publicKey:Nt}),er=yield Ed25519$2.convertPrivateKeyToX25519({privateKey:jt}),tr=yield X25519$2.sharedSecret({privateKeyA:er,publicKeyB:Lt}),zt=yield crypto.subtle.importKey("raw",tr,{name:"HKDF"},!1,["deriveBits"]),rr=yield crypto.subtle.deriveBits({name:"HKDF",hash:"SHA-256",info:new Uint8Array,salt:new Uint8Array},zt,256);return new Uint8Array(rr)})}function encryptAuthResponse({jwt:xt,encryptionKey:e,delegateDidKeyId:At,randomPin:kt}){const Bt={alg:"dir",cty:"JWT",enc:"XC20P",typ:"JWT",kid:At},Nt=CryptoUtils$1.randomBytes(24),jt=Convert$1.object(Object.assign(Object.assign({},Bt),{pin:kt})).toUint8Array(),Lt=Convert$1.string(xt).toUint8Array(),tr=xchacha20poly1305(e,Nt,jt).encrypt(Lt),zt=tr.subarray(0,-16),rr=tr.subarray(-16);return[Convert$1.object(Bt).toBase64Url(),"",Convert$1.uint8Array(Nt).toBase64Url(),Convert$1.uint8Array(zt).toBase64Url(),Convert$1.uint8Array(rr).toBase64Url()].join(".")}function shouldUseDelegatePermission(xt){return isRecordPermissionScope(xt)?!0:xt.interface===DwnInterfaceName.Protocols&&xt.method===DwnMethodName.Configure}function createPermissionGrants(xt,e,At,kt){return __awaiter$j(this,void 0,void 0,function*(){const Bt=new AgentPermissionsApi({agent:At}),jt=(yield Promise.all(kt.map(er=>{const tr=shouldUseDelegatePermission(er);return Bt.createGrant({delegated:tr,store:!0,grantedTo:e.uri,scope:er,dateExpires:"2040-06-25T16:09:16.693356Z",author:xt})}))).map(er=>__awaiter$j(this,void 0,void 0,function*(){const tr=er.message,{encodedData:zt}=tr,rr=__rest$6(tr,["encodedData"]),nr=Convert$1.base64Url(zt).toUint8Array(),{reply:ir}=yield At.sendDwnRequest({author:xt,target:xt,messageType:DwnInterface.RecordsWrite,dataStream:new Blob([nr]),rawMessage:rr});if(ir.status.code!==202&&ir.status.code!==409)throw new Error(`Could not send the message. Error details: ${ir.status.detail}`);return er.message}));return yield Promise.all(jt)})}function prepareProtocol(xt,e,At){return __awaiter$j(this,void 0,void 0,function*(){const kt=yield e.processDwnRequest({author:xt,messageType:DwnInterface.ProtocolsQuery,target:xt,messageParams:{filter:{protocol:At.protocol}}});if(kt.reply.status.code!==200)throw new Error(`Could not fetch protocol: ${kt.reply.status.detail}`);if(kt.reply.entries===void 0||kt.reply.entries.length===0){const{reply:Bt,message:Nt}=yield e.sendDwnRequest({author:xt,target:xt,messageType:DwnInterface.ProtocolsConfigure,messageParams:{definition:At}});if(Bt.status.code!==202&&Bt.status.code!==409)throw new Error(`Could not send protocol: ${Bt.status.detail}`);yield e.processDwnRequest({author:xt,target:xt,messageType:DwnInterface.ProtocolsConfigure,rawMessage:Nt})}else{const Bt=kt.reply.entries[0],{reply:Nt}=yield e.sendDwnRequest({author:xt,target:xt,messageType:DwnInterface.ProtocolsConfigure,rawMessage:Bt});if(Nt.status.code!==202&&Nt.status.code!==409)throw new Error(`Could not send protocol: ${Nt.status.detail}`)}})}function submitAuthResponse(xt,e,At,kt){return __awaiter$j(this,void 0,void 0,function*(){const Bt=yield DidJwk$2.create(),Nt=yield Bt.export(),jt=e.permissionRequests.map(ar=>__awaiter$j(this,void 0,void 0,function*(){const{protocolDefinition:dr,permissionScopes:ur}=ar;if(!ur.every(lr=>"protocol"in lr&&lr.protocol===dr.protocol))throw new Error("All permission scopes must match the protocol uri they are provided with.");return yield prepareProtocol(xt,kt,dr),yield Oidc.createPermissionGrants(xt,Bt,kt,ur)})),Lt=(yield Promise.all(jt)).flat(),er=yield Oidc.createResponseObject({iss:xt,sub:Bt.uri,aud:e.client_id,nonce:e.nonce,delegateGrants:Lt,delegatePortableDid:Nt}),tr=yield Oidc.signJwt({did:Bt,data:er}),zt=yield DidJwk$2.resolve(e.client_id),rr=yield Oidc.deriveSharedKey(Bt,zt==null?void 0:zt.didDocument),nr=Oidc.encryptAuthResponse({jwt:tr,encryptionKey:rr,delegateDidKeyId:Bt.document.verificationMethod[0].id,randomPin:At}),ir=new URLSearchParams({id_token:nr,state:e.state}).toString();yield fetch(e.redirect_uri,{body:ir,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}})})}const Oidc={createAuthRequest,encryptAuthRequest,getAuthRequest,decryptAuthRequest,createPermissionGrants,createResponseObject,encryptAuthResponse,decryptAuthResponse,deriveSharedKey,signJwt,verifyJwt,buildOidcUrl,generateCodeChallenge,submitAuthResponse};var __awaiter$i=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};function initClient({connectServerUrl:xt,walletUri:e,permissionRequests:At,onWalletUriReady:kt,validatePin:Bt}){return __awaiter$i(this,void 0,void 0,function*(){const Nt=yield DidJwk$2.create(),jt=CryptoUtils$1.randomBytes(32),Lt=Oidc.buildOidcUrl({baseURL:xt,endpoint:"callback"}),er=yield Oidc.createAuthRequest({client_id:Nt.uri,scope:"openid did:jwk",permissionRequests:At,redirect_uri:Lt}),tr=yield Oidc.signJwt({did:Nt,data:er});if(!tr)throw new Error("Unable to sign requestObject");const zt=yield Oidc.encryptAuthRequest({jwt:tr,encryptionKey:jt}),rr=new URLSearchParams({request:zt}),nr=Oidc.buildOidcUrl({baseURL:xt,endpoint:"pushedAuthorizationRequest"}),ir=yield fetch(nr,{body:rr,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}});if(!ir.ok)throw new Error(`${ir.status}: ${ir.statusText}`);const ar=yield ir.json(),dr=new URL(e);dr.searchParams.set("request_uri",ar.request_uri),dr.searchParams.set("encryption_key",Convert$1.uint8Array(jt).toBase64Url()),kt(dr.toString());const ur=Oidc.buildOidcUrl({baseURL:xt,endpoint:"token",tokenParam:er.state}),fr=yield pollWithTtl(()=>fetch(ur));if(fr){const pr=yield fr==null?void 0:fr.text(),lr=yield Bt(),yr=yield Oidc.decryptAuthResponse(Nt,pr,lr),br=yield Oidc.verifyJwt({jwt:yr});return{delegateGrants:br.delegateGrants,delegatePortableDid:br.delegatePortableDid,connectedDid:br.iss}}})}function createPermissionRequestForProtocol({definition:xt,permissions:e}){const At=[];At.push({protocol:xt.protocol,interface:DwnInterfaceName.Protocols,method:DwnMethodName.Query}),At.push({protocol:xt.protocol,interface:DwnInterfaceName.Messages,method:DwnMethodName.Read},{protocol:xt.protocol,interface:DwnInterfaceName.Messages,method:DwnMethodName.Query},{protocol:xt.protocol,interface:DwnInterfaceName.Messages,method:DwnMethodName.Subscribe});for(const kt of e)switch(kt){case"write":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Write});break;case"read":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Read});break;case"delete":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Delete});break;case"query":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Query});break;case"subscribe":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Records,method:DwnMethodName.Subscribe});break;case"configure":At.push({protocol:xt.protocol,interface:DwnInterfaceName.Protocols,method:DwnMethodName.Configure});break}return{protocolDefinition:xt,permissionScopes:At}}const WalletConnect={initClient,createPermissionRequestForProtocol};var DidVerificationRelationship;(function(xt){xt.authentication="authentication",xt.assertionMethod="assertionMethod",xt.keyAgreement="keyAgreement",xt.capabilityInvocation="capabilityInvocation",xt.capabilityDelegation="capabilityDelegation"})(DidVerificationRelationship||(DidVerificationRelationship={}));const EMPTY_DID_RESOLUTION_RESULT={"@context":"https://w3id.org/did-resolution/v1",didResolutionMetadata:{},didDocument:null,didDocumentMetadata:{}};class Did{constructor({method:e,id:At,path:kt,query:Bt,fragment:Nt,params:jt}){this.uri=`did:${e}:${At}`,this.method=e,this.id=At,this.path=kt,this.query=Bt,this.fragment=Nt,this.params=jt}static parse(e){if(!e)return null;const At=Did.DID_URI_PATTERN.exec(e);if(!At||!At.groups)return null;const{method:kt,id:Bt,path:Nt,query:jt,fragment:Lt}=At.groups,er={uri:`did:${kt}:${Bt}`,method:kt,id:Bt};if(Nt&&(er.path=Nt),jt&&(er.query=jt.slice(1)),Lt&&(er.fragment=Lt.slice(1)),jt){const tr={},zt=jt.slice(1).split("&");for(const rr of zt){const[nr,ir]=rr.split("=");tr[nr]=ir}er.params=tr}return er}}Did.METHOD_PATTERN="([a-z0-9]+)";Did.PCT_ENCODED_PATTERN="(?:%[0-9a-fA-F]{2})";Did.ID_CHAR_PATTERN=`(?:[a-zA-Z0-9._-]|${Did.PCT_ENCODED_PATTERN})`;Did.METHOD_ID_PATTERN=`((?:${Did.ID_CHAR_PATTERN}*:)*(${Did.ID_CHAR_PATTERN}+))`;Did.PATH_PATTERN="(/[^#?]*)?";Did.QUERY_PATTERN="([?][^#]*)?";Did.FRAGMENT_PATTERN="(#.*)?";Did.DID_URI_PATTERN=new RegExp(`^did:(?<method>${Did.METHOD_PATTERN}):(?<id>${Did.METHOD_ID_PATTERN})(?<path>${Did.PATH_PATTERN})(?<query>${Did.QUERY_PATTERN})(?<fragment>${Did.FRAGMENT_PATTERN})$`);class DidError extends Error{constructor(e,At){super(`${e}: ${At}`),this.code=e,this.name="DidError",Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,DidError)}}var DidErrorCode;(function(xt){xt.InvalidDid="invalidDid",xt.MethodNotSupported="methodNotSupported",xt.InternalError="internalError",xt.InvalidDidDocument="invalidDidDocument",xt.InvalidDidDocumentLength="invalidDidDocumentLength",xt.InvalidDidUrl="invalidDidUrl",xt.InvalidPreviousDidProof="invalidPreviousDidProof",xt.InvalidPublicKey="invalidPublicKey",xt.InvalidPublicKeyLength="invalidPublicKeyLength",xt.InvalidPublicKeyType="invalidPublicKeyType",xt.InvalidSignature="invalidSignature",xt.NotFound="notFound",xt.RepresentationNotSupported="representationNotSupported",xt.UnsupportedPublicKeyType="unsupportedPublicKeyType"})(DidErrorCode||(DidErrorCode={}));var __awaiter$h=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Sha256{static digest({data:e}){return __awaiter$h(this,void 0,void 0,function*(){return sha256(e)})}}class CryptoAlgorithm{}var __awaiter$g=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Sha2Algorithm extends CryptoAlgorithm{digest({algorithm:e,data:At}){return __awaiter$g(this,void 0,void 0,function*(){switch(e){case"SHA-256":return yield Sha256.digest({data:At})}})}}function canonicalize(xt){const e=kt=>{if(kt!==null&&typeof kt=="object"&&!Array.isArray(kt)){const Bt=Object.keys(kt).sort(),Nt={};for(const jt of Bt)Nt[jt]=e(kt[jt]);return Nt}return kt},At=e(xt);return JSON.stringify(At)}var __awaiter$f=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const KEY_URI_PREFIX_JWK="urn:jwk:";function computeJwkThumbprint({jwk:xt}){return __awaiter$f(this,void 0,void 0,function*(){const e=xt.kty;let At;if(e==="EC")At={crv:xt.crv,kty:xt.kty,x:xt.x,y:xt.y};else if(e==="oct")At={k:xt.k,kty:xt.kty};else if(e==="OKP")At={crv:xt.crv,kty:xt.kty,x:xt.x};else if(e==="RSA")At={e:xt.e,kty:xt.kty,n:xt.n};else throw new Error(`Unsupported key type: ${e}`);removeUndefinedProperties$1(At);const kt=canonicalize(At),Bt=Convert$1.string(kt).toUint8Array(),Nt=yield Sha256.digest({data:Bt});return Convert$1.uint8Array(Nt).toBase64Url()})}function isEcPrivateJwk(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"crv"in xt&&"x"in xt&&"d"in xt)||xt.kty!=="EC"||typeof xt.d!="string"||typeof xt.x!="string")}function isEcPublicJwk(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"crv"in xt&&"x"in xt)||"d"in xt||xt.kty!=="EC"||typeof xt.x!="string")}function isOkpPrivateJwk(xt){return!(!xt||typeof xt!="object"||!("kty"in xt&&"crv"in xt&&"x"in xt&&"d"in xt)||xt.kty!=="OKP"||typeof xt.d!="string"||typeof xt.x!="string")}function isOkpPublicJwk(xt){return!(!xt||typeof xt!="object"||"d"in xt||!("kty"in xt&&"crv"in xt&&"x"in xt)||xt.kty!=="OKP"||typeof xt.x!="string")}function isPrivateJwk(xt){if(!xt||typeof xt!="object")return!1;switch(xt.kty){case"EC":case"OKP":case"RSA":return"d"in xt;case"oct":return"k"in xt;default:return!1}}var __awaiter$e=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$5=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class Secp256k1{static adjustSignatureToLowS({signature:e}){return __awaiter$e(this,void 0,void 0,function*(){const At=secp256k1.Signature.fromCompact(e);return At.hasHighS()?At.normalizeS().toCompactRawBytes():e})}static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$e(this,void 0,void 0,function*(){const At=yield Secp256k1.getCurvePoint({keyBytes:e}),kt={kty:"EC",crv:"secp256k1",d:Convert$1.uint8Array(e).toBase64Url(),x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return kt.kid=yield computeJwkThumbprint({jwk:kt}),kt})}static bytesToPublicKey({publicKeyBytes:e}){return __awaiter$e(this,void 0,void 0,function*(){const At=yield Secp256k1.getCurvePoint({keyBytes:e}),kt={kty:"EC",crv:"secp256k1",x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return kt.kid=yield computeJwkThumbprint({jwk:kt}),kt})}static compressPublicKey({publicKeyBytes:e}){return __awaiter$e(this,void 0,void 0,function*(){return secp256k1.ProjectivePoint.fromHex(e).toRawBytes(!0)})}static computePublicKey({key:e}){return __awaiter$e(this,void 0,void 0,function*(){const At=yield Secp256k1.privateKeyToBytes({privateKey:e}),kt=yield Secp256k1.getCurvePoint({keyBytes:At}),Bt={kty:"EC",crv:"secp256k1",x:Convert$1.uint8Array(kt.x).toBase64Url(),y:Convert$1.uint8Array(kt.y).toBase64Url()};return Bt.kid=yield computeJwkThumbprint({jwk:Bt}),Bt})}static convertDerToCompactSignature({derSignature:e}){return __awaiter$e(this,void 0,void 0,function*(){return secp256k1.Signature.fromDER(e).toCompactRawBytes()})}static decompressPublicKey({publicKeyBytes:e}){return __awaiter$e(this,void 0,void 0,function*(){return secp256k1.ProjectivePoint.fromHex(e).toRawBytes(!1)})}static generateKey(){return __awaiter$e(this,void 0,void 0,function*(){const e=secp256k1.utils.randomPrivateKey(),At=yield Secp256k1.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static getPublicKey({key:e}){var At;return __awaiter$e(this,void 0,void 0,function*(){if(!(isEcPrivateJwk(e)&&e.crv==="secp256k1"))throw new Error("Secp256k1: The provided key is not a secp256k1 private JWK.");let kt=__rest$5(e,["d"]);return(At=kt.kid)!==null&&At!==void 0||(kt.kid=yield computeJwkThumbprint({jwk:kt})),kt})}static privateKeyToBytes({privateKey:e}){return __awaiter$e(this,void 0,void 0,function*(){if(!isEcPrivateJwk(e))throw new Error("Secp256k1: The provided key is not a valid EC private key.");return Convert$1.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return __awaiter$e(this,void 0,void 0,function*(){if(!(isEcPublicJwk(e)&&e.y))throw new Error("Secp256k1: The provided key is not a valid EC public key.");const At=new Uint8Array([4]),kt=Convert$1.base64Url(e.x).toUint8Array(),Bt=Convert$1.base64Url(e.y).toUint8Array();return new Uint8Array([...At,...kt,...Bt])})}static sharedSecret({privateKeyA:e,publicKeyB:At}){return __awaiter$e(this,void 0,void 0,function*(){if("x"in e&&"x"in At&&e.x===At.x)throw new Error("Secp256k1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const kt=yield Secp256k1.privateKeyToBytes({privateKey:e}),Bt=yield Secp256k1.publicKeyToBytes({publicKey:At});return secp256k1.getSharedSecret(kt,Bt,!0).slice(1)})}static sign({data:e,key:At}){return __awaiter$e(this,void 0,void 0,function*(){const kt=yield Secp256k1.privateKeyToBytes({privateKey:At}),Bt=sha256(e);return secp256k1.sign(Bt,kt).toCompactRawBytes()})}static validatePrivateKey({privateKeyBytes:e}){return __awaiter$e(this,void 0,void 0,function*(){return secp256k1.utils.isValidPrivateKey(e)})}static validatePublicKey({publicKeyBytes:e}){return __awaiter$e(this,void 0,void 0,function*(){try{secp256k1.ProjectivePoint.fromHex(e).assertValidity()}catch{return!1}return!0})}static verify({key:e,signature:At,data:kt}){return __awaiter$e(this,void 0,void 0,function*(){const Bt=yield Secp256k1.publicKeyToBytes({publicKey:e}),Nt=sha256(kt);return secp256k1.verify(At,Nt,Bt,{lowS:!1})})}static getCurvePoint({keyBytes:e}){return __awaiter$e(this,void 0,void 0,function*(){e.byteLength===32&&(e=secp256k1.getPublicKey(e));const At=secp256k1.ProjectivePoint.fromHex(e),kt=numberToBytesBE(At.x,32),Bt=numberToBytesBE(At.y,32);return{x:kt,y:Bt}})}}var __awaiter$d=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$4=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class Secp256r1{static adjustSignatureToLowS({signature:e}){return __awaiter$d(this,void 0,void 0,function*(){const At=secp256r1.Signature.fromCompact(e);return At.hasHighS()?At.normalizeS().toCompactRawBytes():e})}static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$d(this,void 0,void 0,function*(){const At=yield Secp256r1.getCurvePoint({keyBytes:e}),kt={kty:"EC",crv:"P-256",d:Convert$1.uint8Array(e).toBase64Url(),x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return kt.kid=yield computeJwkThumbprint({jwk:kt}),kt})}static bytesToPublicKey({publicKeyBytes:e}){return __awaiter$d(this,void 0,void 0,function*(){const At=yield Secp256r1.getCurvePoint({keyBytes:e}),kt={kty:"EC",crv:"P-256",x:Convert$1.uint8Array(At.x).toBase64Url(),y:Convert$1.uint8Array(At.y).toBase64Url()};return kt.kid=yield computeJwkThumbprint({jwk:kt}),kt})}static compressPublicKey({publicKeyBytes:e}){return __awaiter$d(this,void 0,void 0,function*(){return secp256r1.ProjectivePoint.fromHex(e).toRawBytes(!0)})}static computePublicKey({key:e}){return __awaiter$d(this,void 0,void 0,function*(){const At=yield Secp256r1.privateKeyToBytes({privateKey:e}),kt=yield Secp256r1.getCurvePoint({keyBytes:At}),Bt={kty:"EC",crv:"P-256",x:Convert$1.uint8Array(kt.x).toBase64Url(),y:Convert$1.uint8Array(kt.y).toBase64Url()};return Bt.kid=yield computeJwkThumbprint({jwk:Bt}),Bt})}static convertDerToCompactSignature({derSignature:e}){return __awaiter$d(this,void 0,void 0,function*(){return secp256r1.Signature.fromDER(e).toCompactRawBytes()})}static decompressPublicKey({publicKeyBytes:e}){return __awaiter$d(this,void 0,void 0,function*(){return secp256r1.ProjectivePoint.fromHex(e).toRawBytes(!1)})}static generateKey(){return __awaiter$d(this,void 0,void 0,function*(){const e=secp256r1.utils.randomPrivateKey(),At=yield Secp256r1.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static getPublicKey({key:e}){var At;return __awaiter$d(this,void 0,void 0,function*(){if(!(isEcPrivateJwk(e)&&e.crv==="P-256"))throw new Error("Secp256r1: The provided key is not a 'P-256' private JWK.");let kt=__rest$4(e,["d"]);return(At=kt.kid)!==null&&At!==void 0||(kt.kid=yield computeJwkThumbprint({jwk:kt})),kt})}static privateKeyToBytes({privateKey:e}){return __awaiter$d(this,void 0,void 0,function*(){if(!isEcPrivateJwk(e))throw new Error("Secp256r1: The provided key is not a valid EC private key.");return Convert$1.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return __awaiter$d(this,void 0,void 0,function*(){if(!(isEcPublicJwk(e)&&e.y))throw new Error("Secp256r1: The provided key is not a valid EC public key.");const At=new Uint8Array([4]),kt=Convert$1.base64Url(e.x).toUint8Array(),Bt=Convert$1.base64Url(e.y).toUint8Array();return new Uint8Array([...At,...kt,...Bt])})}static sharedSecret({privateKeyA:e,publicKeyB:At}){return __awaiter$d(this,void 0,void 0,function*(){if("x"in e&&"x"in At&&e.x===At.x)throw new Error("Secp256r1: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const kt=yield Secp256r1.privateKeyToBytes({privateKey:e}),Bt=yield Secp256r1.publicKeyToBytes({publicKey:At});return secp256r1.getSharedSecret(kt,Bt,!0).slice(1)})}static sign({data:e,key:At}){return __awaiter$d(this,void 0,void 0,function*(){const kt=yield Secp256r1.privateKeyToBytes({privateKey:At}),Bt=sha256(e);return secp256r1.sign(Bt,kt).toCompactRawBytes()})}static validatePrivateKey({privateKeyBytes:e}){return __awaiter$d(this,void 0,void 0,function*(){return secp256r1.utils.isValidPrivateKey(e)})}static validatePublicKey({publicKeyBytes:e}){return __awaiter$d(this,void 0,void 0,function*(){try{secp256r1.ProjectivePoint.fromHex(e).assertValidity()}catch{return!1}return!0})}static verify({key:e,signature:At,data:kt}){return __awaiter$d(this,void 0,void 0,function*(){const Bt=yield Secp256r1.publicKeyToBytes({publicKey:e}),Nt=sha256(kt);return secp256r1.verify(At,Nt,Bt,{lowS:!1})})}static getCurvePoint({keyBytes:e}){return __awaiter$d(this,void 0,void 0,function*(){e.byteLength===32&&(e=secp256r1.getPublicKey(e));const At=secp256r1.ProjectivePoint.fromHex(e),kt=numberToBytesBE(At.x,32),Bt=numberToBytesBE(At.y,32);return{x:kt,y:Bt}})}}var __awaiter$c=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class EcdsaAlgorithm extends CryptoAlgorithm{computePublicKey({key:e}){return __awaiter$c(this,void 0,void 0,function*(){if(!isEcPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const At=yield Secp256k1.computePublicKey({key:e});return At.alg="ES256K",At}case"P-256":{const At=yield Secp256r1.computePublicKey({key:e});return At.alg="ES256",At}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}generateKey({algorithm:e}){return __awaiter$c(this,void 0,void 0,function*(){switch(e){case"ES256K":case"secp256k1":{const At=yield Secp256k1.generateKey();return At.alg="ES256K",At}case"ES256":case"secp256r1":{const At=yield Secp256r1.generateKey();return At.alg="ES256",At}}})}getPublicKey({key:e}){return __awaiter$c(this,void 0,void 0,function*(){if(!isEcPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":{const At=yield Secp256k1.getPublicKey({key:e});return At.alg="ES256K",At}case"P-256":{const At=yield Secp256r1.getPublicKey({key:e});return At.alg="ES256",At}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}sign({key:e,data:At}){return __awaiter$c(this,void 0,void 0,function*(){if(!isEcPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) private key.");switch(e.crv){case"secp256k1":return yield Secp256k1.sign({key:e,data:At});case"P-256":return yield Secp256r1.sign({key:e,data:At});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}verify({key:e,signature:At,data:kt}){return __awaiter$c(this,void 0,void 0,function*(){if(!isEcPublicJwk(e))throw new TypeError("Invalid key provided. Must be an elliptic curve (EC) public key.");switch(e.crv){case"secp256k1":return yield Secp256k1.verify({key:e,signature:At,data:kt});case"P-256":return yield Secp256r1.verify({key:e,signature:At,data:kt});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}}var __awaiter$b=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$3=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class Ed25519{static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$b(this,void 0,void 0,function*(){const At=ed25519.getPublicKey(e),kt={crv:"Ed25519",d:Convert$1.uint8Array(e).toBase64Url(),kty:"OKP",x:Convert$1.uint8Array(At).toBase64Url()};return kt.kid=yield computeJwkThumbprint({jwk:kt}),kt})}static bytesToPublicKey({publicKeyBytes:e}){return __awaiter$b(this,void 0,void 0,function*(){const At={kty:"OKP",crv:"Ed25519",x:Convert$1.uint8Array(e).toBase64Url()};return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static computePublicKey({key:e}){return __awaiter$b(this,void 0,void 0,function*(){const At=yield Ed25519.privateKeyToBytes({privateKey:e}),kt=ed25519.getPublicKey(At),Bt={kty:"OKP",crv:"Ed25519",x:Convert$1.uint8Array(kt).toBase64Url()};return Bt.kid=yield computeJwkThumbprint({jwk:Bt}),Bt})}static convertPrivateKeyToX25519({privateKey:e}){return __awaiter$b(this,void 0,void 0,function*(){const At=yield Ed25519.privateKeyToBytes({privateKey:e}),kt=edwardsToMontgomeryPriv(At),Bt=x25519.getPublicKey(kt),Nt={kty:"OKP",crv:"X25519",d:Convert$1.uint8Array(kt).toBase64Url(),x:Convert$1.uint8Array(Bt).toBase64Url()};return Nt.kid=yield computeJwkThumbprint({jwk:Nt}),Nt})}static convertPublicKeyToX25519({publicKey:e}){return __awaiter$b(this,void 0,void 0,function*(){const At=yield Ed25519.publicKeyToBytes({publicKey:e});if(!(yield Ed25519.validatePublicKey({publicKeyBytes:At})))throw new Error("Ed25519: Invalid public key.");const Bt=edwardsToMontgomeryPub(At),Nt={kty:"OKP",crv:"X25519",x:Convert$1.uint8Array(Bt).toBase64Url()};return Nt.kid=yield computeJwkThumbprint({jwk:Nt}),Nt})}static generateKey(){return __awaiter$b(this,void 0,void 0,function*(){const e=ed25519.utils.randomPrivateKey(),At=yield Ed25519.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static getPublicKey({key:e}){var At;return __awaiter$b(this,void 0,void 0,function*(){if(!(isOkpPrivateJwk(e)&&e.crv==="Ed25519"))throw new Error("Ed25519: The provided key is not an Ed25519 private JWK.");let kt=__rest$3(e,["d"]);return(At=kt.kid)!==null&&At!==void 0||(kt.kid=yield computeJwkThumbprint({jwk:kt})),kt})}static privateKeyToBytes({privateKey:e}){return __awaiter$b(this,void 0,void 0,function*(){if(!isOkpPrivateJwk(e))throw new Error("Ed25519: The provided key is not a valid OKP private key.");return Convert$1.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return __awaiter$b(this,void 0,void 0,function*(){if(!isOkpPublicJwk(e))throw new Error("Ed25519: The provided key is not a valid OKP public key.");return Convert$1.base64Url(e.x).toUint8Array()})}static sign({key:e,data:At}){return __awaiter$b(this,void 0,void 0,function*(){const kt=yield Ed25519.privateKeyToBytes({privateKey:e});return ed25519.sign(At,kt)})}static validatePublicKey({publicKeyBytes:e}){return __awaiter$b(this,void 0,void 0,function*(){try{ed25519.ExtendedPoint.fromHex(e).assertValidity()}catch{return!1}return!0})}static verify({key:e,signature:At,data:kt}){return __awaiter$b(this,void 0,void 0,function*(){const Bt=yield Ed25519.publicKeyToBytes({publicKey:e});return ed25519.verify(At,kt,Bt)})}}var __awaiter$a=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class EdDsaAlgorithm extends CryptoAlgorithm{computePublicKey({key:e}){return __awaiter$a(this,void 0,void 0,function*(){if(!isOkpPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const At=yield Ed25519.computePublicKey({key:e});return At.alg="EdDSA",At}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}generateKey({algorithm:e}){return __awaiter$a(this,void 0,void 0,function*(){switch(e){case"Ed25519":{const At=yield Ed25519.generateKey();return At.alg="EdDSA",At}}})}getPublicKey({key:e}){return __awaiter$a(this,void 0,void 0,function*(){if(!isOkpPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":{const At=yield Ed25519.getPublicKey({key:e});return At.alg="EdDSA",At}default:throw new Error(`Unsupported curve: ${e.crv}`)}})}sign({key:e,data:At}){return __awaiter$a(this,void 0,void 0,function*(){if(!isOkpPrivateJwk(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) private key.");switch(e.crv){case"Ed25519":return yield Ed25519.sign({key:e,data:At});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}verify({key:e,signature:At,data:kt}){return __awaiter$a(this,void 0,void 0,function*(){if(!isOkpPublicJwk(e))throw new TypeError("Invalid key provided. Must be an octet key pair (OKP) public key.");switch(e.crv){case"Ed25519":return yield Ed25519.verify({key:e,signature:At,data:kt});default:throw new Error(`Unsupported curve: ${e.crv}`)}})}}var __awaiter$9=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};const supportedAlgorithms={Ed25519:{implementation:EdDsaAlgorithm,names:["Ed25519"]},secp256k1:{implementation:EcdsaAlgorithm,names:["ES256K","secp256k1"]},secp256r1:{implementation:EcdsaAlgorithm,names:["ES256","secp256r1"]},"SHA-256":{implementation:Sha2Algorithm,names:["SHA-256"]}};class LocalKeyManager{constructor(e){var At;this._algorithmInstances=new Map,this._keyStore=(At=e==null?void 0:e.keyStore)!==null&&At!==void 0?At:new MemoryStore$1}digest({algorithm:e,data:At}){return __awaiter$9(this,void 0,void 0,function*(){return yield this.getAlgorithm({algorithm:e}).digest({algorithm:e,data:At})})}exportKey({keyUri:e}){return __awaiter$9(this,void 0,void 0,function*(){return yield this.getPrivateKey({keyUri:e})})}generateKey({algorithm:e}){return __awaiter$9(this,void 0,void 0,function*(){const kt=yield this.getAlgorithm({algorithm:e}).generateKey({algorithm:e});if((kt==null?void 0:kt.kid)===void 0)throw new Error("Generated key is missing a required property: kid");const Bt=`${KEY_URI_PREFIX_JWK}${kt.kid}`;return yield this._keyStore.set(Bt,kt),Bt})}getKeyUri({key:e}){return __awaiter$9(this,void 0,void 0,function*(){const At=yield computeJwkThumbprint({jwk:e});return`${KEY_URI_PREFIX_JWK}${At}`})}getPublicKey({keyUri:e}){return __awaiter$9(this,void 0,void 0,function*(){const At=yield this.getPrivateKey({keyUri:e}),kt=this.getAlgorithmName({key:At});return yield this.getAlgorithm({algorithm:kt}).getPublicKey({key:At})})}importKey({key:e}){var At;return __awaiter$9(this,void 0,void 0,function*(){if(!isPrivateJwk(e))throw new TypeError("Invalid key provided. Must be a private key in JWK format.");const kt=structuredClone(e);(At=kt.kid)!==null&&At!==void 0||(kt.kid=yield computeJwkThumbprint({jwk:kt}));const Bt=yield this.getKeyUri({key:kt});return yield this._keyStore.set(Bt,kt),Bt})}sign({keyUri:e,data:At}){return __awaiter$9(this,void 0,void 0,function*(){const kt=yield this.getPrivateKey({keyUri:e}),Bt=this.getAlgorithmName({key:kt});return this.getAlgorithm({algorithm:Bt}).sign({data:At,key:kt})})}verify({key:e,signature:At,data:kt}){return __awaiter$9(this,void 0,void 0,function*(){const Bt=this.getAlgorithmName({key:e});return this.getAlgorithm({algorithm:Bt}).verify({key:e,signature:At,data:kt})})}getAlgorithm({algorithm:e}){var At;const kt=(At=supportedAlgorithms[e])===null||At===void 0?void 0:At.implementation;if(!kt)throw new Error(`Algorithm not supported: ${e}`);return this._algorithmInstances.has(kt)||this._algorithmInstances.set(kt,new kt),this._algorithmInstances.get(kt)}getAlgorithmName({key:e}){const At=e.alg,kt=e.crv;for(const Bt in supportedAlgorithms){const Nt=supportedAlgorithms[Bt];if(At&&Nt.names.includes(At))return Bt;if(kt&&Nt.names.includes(kt))return Bt}throw new Error(`Unable to determine algorithm based on provided input: alg=${At}, crv=${kt}`)}getPrivateKey({keyUri:e}){return __awaiter$9(this,void 0,void 0,function*(){const At=yield this._keyStore.get(e);if(!At)throw new Error(`Key not found: ${e}`);return At})}}function getJoseSignatureAlgorithmFromPublicKey(xt){const e={Ed25519:"EdDSA","P-256":"ES256","P-384":"ES384","P-521":"ES512",secp256k1:"ES256K"};if(xt.alg&&Object.values(e).includes(xt.alg))return xt.alg;if(xt.crv&&Object.keys(e).includes(xt.crv))return e[xt.crv];throw new Error(`Unable to determine algorithm based on provided input: alg=${xt.alg}, crv=${xt.crv}. Supported 'alg' values: ${Object.values(e).join(", ")}. Supported 'crv' values: ${Object.keys(e).join(", ")}.`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=xt=>new Uint32Array(xt.buffer,xt.byteOffset,Math.floor(xt.byteLength/4));function isBytes$1(xt){return xt instanceof Uint8Array||xt!=null&&typeof xt=="object"&&xt.constructor.name==="Uint8Array"}const isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes(xt){if(typeof xt!="string")throw new Error(`utf8ToBytes expected string, got ${typeof xt}`);return new Uint8Array(new TextEncoder().encode(xt))}function toBytes(xt){if(typeof xt=="string")xt=utf8ToBytes(xt);else if(isBytes$1(xt))xt=xt.slice();else throw new Error(`expected Uint8Array, got ${typeof xt}`);return xt}function ensureBytes(xt,e){if(!isBytes$1(xt))throw new Error("Uint8Array expected");if(xt.length!==e)throw new Error(`Uint8Array length ${e} expected`)}function isBytes(xt){return xt!=null&&typeof xt=="object"&&(xt instanceof Uint8Array||xt.constructor.name==="Uint8Array")}function bytes(xt,...e){if(!isBytes(xt))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(xt.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${xt.length}`)}function exists(xt,e=!0){if(xt.destroyed)throw new Error("Hash instance has been destroyed");if(e&&xt.finished)throw new Error("Hash#digest() has already been called")}function output(xt,e){bytes(xt);const At=e.outputLen;if(xt.length<At)throw new Error(`digestInto() expects output buffer of length at least ${At}`)}var __awaiter$8=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$2=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};class X25519{static bytesToPrivateKey({privateKeyBytes:e}){return __awaiter$8(this,void 0,void 0,function*(){const At=x25519.getPublicKey(e),kt={kty:"OKP",crv:"X25519",d:Convert$1.uint8Array(e).toBase64Url(),x:Convert$1.uint8Array(At).toBase64Url()};return kt.kid=yield computeJwkThumbprint({jwk:kt}),kt})}static bytesToPublicKey({publicKeyBytes:e}){return __awaiter$8(this,void 0,void 0,function*(){const At={kty:"OKP",crv:"X25519",x:Convert$1.uint8Array(e).toBase64Url()};return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static computePublicKey({key:e}){return __awaiter$8(this,void 0,void 0,function*(){const At=yield X25519.privateKeyToBytes({privateKey:e}),kt=x25519.getPublicKey(At),Bt={kty:"OKP",crv:"X25519",x:Convert$1.uint8Array(kt).toBase64Url()};return Bt.kid=yield computeJwkThumbprint({jwk:Bt}),Bt})}static generateKey(){return __awaiter$8(this,void 0,void 0,function*(){const e=x25519.utils.randomPrivateKey(),At=yield X25519.bytesToPrivateKey({privateKeyBytes:e});return At.kid=yield computeJwkThumbprint({jwk:At}),At})}static getPublicKey({key:e}){var At;return __awaiter$8(this,void 0,void 0,function*(){if(!(isOkpPrivateJwk(e)&&e.crv==="X25519"))throw new Error("X25519: The provided key is not an X25519 private JWK.");let kt=__rest$2(e,["d"]);return(At=kt.kid)!==null&&At!==void 0||(kt.kid=yield computeJwkThumbprint({jwk:kt})),kt})}static privateKeyToBytes({privateKey:e}){return __awaiter$8(this,void 0,void 0,function*(){if(!isOkpPrivateJwk(e))throw new Error("X25519: The provided key is not a valid OKP private key.");return Convert$1.base64Url(e.d).toUint8Array()})}static publicKeyToBytes({publicKey:e}){return __awaiter$8(this,void 0,void 0,function*(){if(!isOkpPublicJwk(e))throw new Error("X25519: The provided key is not a valid OKP public key.");return Convert$1.base64Url(e.x).toUint8Array()})}static sharedSecret({privateKeyA:e,publicKeyB:At}){return __awaiter$8(this,void 0,void 0,function*(){if("x"in e&&"x"in At&&e.x===At.x)throw new Error("X25519: ECDH shared secret cannot be computed from a single key pair's public and private keys.");const kt=yield X25519.privateKeyToBytes({privateKey:e}),Bt=yield X25519.publicKeyToBytes({publicKey:At});return x25519.getSharedSecret(kt,Bt)})}}const u8to16=(xt,e)=>xt[e++]&255|(xt[e++]&255)<<8;class Poly1305{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=toBytes(e),ensureBytes(e,32);const At=u8to16(e,0),kt=u8to16(e,2),Bt=u8to16(e,4),Nt=u8to16(e,6),jt=u8to16(e,8),Lt=u8to16(e,10),er=u8to16(e,12),tr=u8to16(e,14);this.r[0]=At&8191,this.r[1]=(At>>>13|kt<<3)&8191,this.r[2]=(kt>>>10|Bt<<6)&7939,this.r[3]=(Bt>>>7|Nt<<9)&8191,this.r[4]=(Nt>>>4|jt<<12)&255,this.r[5]=jt>>>1&8190,this.r[6]=(jt>>>14|Lt<<2)&8191,this.r[7]=(Lt>>>11|er<<5)&8065,this.r[8]=(er>>>8|tr<<8)&8191,this.r[9]=tr>>>5&127;for(let zt=0;zt<8;zt++)this.pad[zt]=u8to16(e,16+2*zt)}process(e,At,kt=!1){const Bt=kt?0:2048,{h:Nt,r:jt}=this,Lt=jt[0],er=jt[1],tr=jt[2],zt=jt[3],rr=jt[4],nr=jt[5],ir=jt[6],ar=jt[7],dr=jt[8],ur=jt[9],fr=u8to16(e,At+0),pr=u8to16(e,At+2),lr=u8to16(e,At+4),yr=u8to16(e,At+6),br=u8to16(e,At+8),Ar=u8to16(e,At+10),Pr=u8to16(e,At+12),kr=u8to16(e,At+14);let Ur=Nt[0]+(fr&8191),Hr=Nt[1]+((fr>>>13|pr<<3)&8191),Lr=Nt[2]+((pr>>>10|lr<<6)&8191),Sr=Nt[3]+((lr>>>7|yr<<9)&8191),_r=Nt[4]+((yr>>>4|br<<12)&8191),gr=Nt[5]+(br>>>1&8191),wr=Nt[6]+((br>>>14|Ar<<2)&8191),Dr=Nt[7]+((Ar>>>11|Pr<<5)&8191),xr=Nt[8]+((Pr>>>8|kr<<8)&8191),Ir=Nt[9]+(kr>>>5|Bt),$r=0,vr=$r+Ur*Lt+Hr*(5*ur)+Lr*(5*dr)+Sr*(5*ar)+_r*(5*ir);$r=vr>>>13,vr&=8191,vr+=gr*(5*nr)+wr*(5*rr)+Dr*(5*zt)+xr*(5*tr)+Ir*(5*er),$r+=vr>>>13,vr&=8191;let Er=$r+Ur*er+Hr*Lt+Lr*(5*ur)+Sr*(5*dr)+_r*(5*ar);$r=Er>>>13,Er&=8191,Er+=gr*(5*ir)+wr*(5*nr)+Dr*(5*rr)+xr*(5*zt)+Ir*(5*tr),$r+=Er>>>13,Er&=8191;let Tr=$r+Ur*tr+Hr*er+Lr*Lt+Sr*(5*ur)+_r*(5*dr);$r=Tr>>>13,Tr&=8191,Tr+=gr*(5*ar)+wr*(5*ir)+Dr*(5*nr)+xr*(5*rr)+Ir*(5*zt),$r+=Tr>>>13,Tr&=8191;let Rr=$r+Ur*zt+Hr*tr+Lr*er+Sr*Lt+_r*(5*ur);$r=Rr>>>13,Rr&=8191,Rr+=gr*(5*dr)+wr*(5*ar)+Dr*(5*ir)+xr*(5*nr)+Ir*(5*rr),$r+=Rr>>>13,Rr&=8191;let Mr=$r+Ur*rr+Hr*zt+Lr*tr+Sr*er+_r*Lt;$r=Mr>>>13,Mr&=8191,Mr+=gr*(5*ur)+wr*(5*dr)+Dr*(5*ar)+xr*(5*ir)+Ir*(5*nr),$r+=Mr>>>13,Mr&=8191;let Gr=$r+Ur*nr+Hr*rr+Lr*zt+Sr*tr+_r*er;$r=Gr>>>13,Gr&=8191,Gr+=gr*Lt+wr*(5*ur)+Dr*(5*dr)+xr*(5*ar)+Ir*(5*ir),$r+=Gr>>>13,Gr&=8191;let Br=$r+Ur*ir+Hr*nr+Lr*rr+Sr*zt+_r*tr;$r=Br>>>13,Br&=8191,Br+=gr*er+wr*Lt+Dr*(5*ur)+xr*(5*dr)+Ir*(5*ar),$r+=Br>>>13,Br&=8191;let Cr=$r+Ur*ar+Hr*ir+Lr*nr+Sr*rr+_r*zt;$r=Cr>>>13,Cr&=8191,Cr+=gr*tr+wr*er+Dr*Lt+xr*(5*ur)+Ir*(5*dr),$r+=Cr>>>13,Cr&=8191;let jr=$r+Ur*dr+Hr*ar+Lr*ir+Sr*nr+_r*rr;$r=jr>>>13,jr&=8191,jr+=gr*zt+wr*tr+Dr*er+xr*Lt+Ir*(5*ur),$r+=jr>>>13,jr&=8191;let Yr=$r+Ur*ur+Hr*dr+Lr*ar+Sr*ir+_r*nr;$r=Yr>>>13,Yr&=8191,Yr+=gr*rr+wr*zt+Dr*tr+xr*er+Ir*Lt,$r+=Yr>>>13,Yr&=8191,$r=($r<<2)+$r|0,$r=$r+vr|0,vr=$r&8191,$r=$r>>>13,Er+=$r,Nt[0]=vr,Nt[1]=Er,Nt[2]=Tr,Nt[3]=Rr,Nt[4]=Mr,Nt[5]=Gr,Nt[6]=Br,Nt[7]=Cr,Nt[8]=jr,Nt[9]=Yr}finalize(){const{h:e,pad:At}=this,kt=new Uint16Array(10);let Bt=e[1]>>>13;e[1]&=8191;for(let Lt=2;Lt<10;Lt++)e[Lt]+=Bt,Bt=e[Lt]>>>13,e[Lt]&=8191;e[0]+=Bt*5,Bt=e[0]>>>13,e[0]&=8191,e[1]+=Bt,Bt=e[1]>>>13,e[1]&=8191,e[2]+=Bt,kt[0]=e[0]+5,Bt=kt[0]>>>13,kt[0]&=8191;for(let Lt=1;Lt<10;Lt++)kt[Lt]=e[Lt]+Bt,Bt=kt[Lt]>>>13,kt[Lt]&=8191;kt[9]-=8192;let Nt=(Bt^1)-1;for(let Lt=0;Lt<10;Lt++)kt[Lt]&=Nt;Nt=~Nt;for(let Lt=0;Lt<10;Lt++)e[Lt]=e[Lt]&Nt|kt[Lt];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let jt=e[0]+At[0];e[0]=jt&65535;for(let Lt=1;Lt<8;Lt++)jt=(e[Lt]+At[Lt]|0)+(jt>>>16)|0,e[Lt]=jt&65535}update(e){exists(this);const{buffer:At,blockLen:kt}=this;e=toBytes(e);const Bt=e.length;for(let Nt=0;Nt<Bt;){const jt=Math.min(kt-this.pos,Bt-Nt);if(jt===kt){for(;kt<=Bt-Nt;Nt+=kt)this.process(e,Nt);continue}At.set(e.subarray(Nt,Nt+jt),this.pos),this.pos+=jt,Nt+=jt,this.pos===kt&&(this.process(At,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){exists(this),output(e,this),this.finished=!0;const{buffer:At,h:kt}=this;let{pos:Bt}=this;if(Bt){for(At[Bt++]=1;Bt<16;Bt++)At[Bt]=0;this.process(At,0,!0)}this.finalize();let Nt=0;for(let jt=0;jt<8;jt++)e[Nt++]=kt[jt]>>>0,e[Nt++]=kt[jt]>>>8;return e}digest(){const{buffer:e,outputLen:At}=this;this.digestInto(e);const kt=e.slice(0,At);return this.destroy(),kt}}function wrapConstructorWithKey(xt){const e=(kt,Bt)=>xt(Bt).update(toBytes(kt)).digest(),At=xt(new Uint8Array(32));return e.outputLen=At.outputLen,e.blockLen=At.blockLen,e.create=kt=>xt(kt),e}wrapConstructorWithKey(xt=>new Poly1305(xt));const sigma16=utf8ToBytes("expand 16-byte k"),sigma32=utf8ToBytes("expand 32-byte k");u32(sigma16);u32(sigma32);function extractDidFragment(xt){if(typeof xt=="string"&&xt.length!==0)return xt.split("#").pop()}function getVerificationMethods({didDocument:xt}){var e,At;if(!xt)throw new TypeError("Required parameter missing: 'didDocument'");const kt=[];return kt.push(...(At=(e=xt.verificationMethod)===null||e===void 0?void 0:e.filter(isDidVerificationMethod))!==null&&At!==void 0?At:[]),Object.keys(DidVerificationRelationship).forEach(Bt=>{var Nt,jt;kt.push(...(jt=(Nt=xt[Bt])===null||Nt===void 0?void 0:Nt.filter(isDidVerificationMethod))!==null&&jt!==void 0?jt:[])}),kt}function getVerificationMethodTypes({didDocument:xt}){const At=getVerificationMethods({didDocument:xt}).map(kt=>kt.type);return[...new Set(At)]}function getVerificationRelationshipsById({didDocument:xt,methodId:e}){const At=[];return Object.keys(DidVerificationRelationship).forEach(kt=>{if(Array.isArray(xt[kt])){const Bt=xt[kt],Nt=extractDidFragment(e);Bt.some(Lt=>{const er=extractDidFragment(Lt)===Nt,tr=isDidVerificationMethod(Lt)&&extractDidFragment(Lt.id)===Nt;return er||tr})&&At.push(kt)}}),At}function isDidVerificationMethod(xt){return!(!xt||typeof xt!="object"||xt===null||!("id"in xt&&"type"in xt&&"controller"in xt)||typeof xt.id!="string"||typeof xt.type!="string"||typeof xt.controller!="string")}function keyBytesToMultibaseId({keyBytes:xt,multicodecCode:e,multicodecName:At}){const kt=Multicodec$1.addPrefix({code:e,data:xt,name:At}),Bt=Convert$1.uint8Array(kt).toBase58Btc();return Convert$1.base58Btc(Bt).toMultibase()}function multibaseIdToKeyBytes({multibaseKeyId:xt}){try{const e=Convert$1.multibase(xt).toBase58Btc(),At=Convert$1.base58Btc(e).toUint8Array(),{code:kt,data:Bt,name:Nt}=Multicodec$1.removePrefix({prefixedData:At});return{keyBytes:Bt,multicodecCode:kt,multicodecName:Nt}}catch{throw new DidError(DidErrorCode.InvalidDid,`Invalid multibase identifier: ${xt}`)}}var __awaiter$7=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class BearerDid{constructor({uri:e,document:At,metadata:kt,keyManager:Bt}){this.uri=e,this.document=At,this.metadata=kt,this.keyManager=Bt}export(){return __awaiter$7(this,void 0,void 0,function*(){if(!(Array.isArray(this.document.verificationMethod)&&this.document.verificationMethod.length>0))throw new Error(`DID document for '${this.uri}' is missing verification methods`);let e={uri:this.uri,document:this.document,metadata:this.metadata};if("exportKey"in this.keyManager&&typeof this.keyManager.exportKey=="function"){const At=[];for(let kt of this.document.verificationMethod){if(!kt.publicKeyJwk)throw new Error(`Verification method '${kt.id}' does not contain a public key in JWK format`);const Bt=yield this.keyManager.getKeyUri({key:kt.publicKeyJwk}),Nt=yield this.keyManager.exportKey({keyUri:Bt});At.push(Object.assign({},Nt))}e.privateKeys=At}return e})}getSigner(e){return __awaiter$7(this,void 0,void 0,function*(){var At;const kt=(At=this.document.verificationMethod)===null||At===void 0?void 0:At.find(er=>{var tr,zt;return extractDidFragment(er.id)===((tr=extractDidFragment(e==null?void 0:e.methodId))!==null&&tr!==void 0?tr:extractDidFragment((zt=this.document.assertionMethod)===null||zt===void 0?void 0:zt[0]))});if(!(kt&&kt.publicKeyJwk))throw new DidError(DidErrorCode.InternalError,"A verification method intended for signing could not be determined from the DID Document");const Bt=yield this.keyManager.getKeyUri({key:kt.publicKeyJwk}),Nt=yield this.keyManager.getPublicKey({keyUri:Bt}),jt=this.keyManager;return{algorithm:getJoseSignatureAlgorithmFromPublicKey(Nt),keyId:kt.id,sign(er){return __awaiter$7(this,arguments,void 0,function*({data:tr}){return yield jt.sign({data:tr,keyUri:Bt})})},verify(er){return __awaiter$7(this,arguments,void 0,function*({data:tr,signature:zt}){return yield jt.verify({data:tr,key:Nt,signature:zt})})}}})}static import(e){return __awaiter$7(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager}){var Bt;const Nt=getVerificationMethods({didDocument:At.document});if(Nt.length===0)throw new DidError(DidErrorCode.InvalidDidDocument,"At least one verification method is required but 0 were given");for(let Lt of(Bt=At.privateKeys)!==null&&Bt!==void 0?Bt:[])yield kt.importKey({key:Lt});for(let Lt of Nt){if(!Lt.publicKeyJwk)throw new Error(`Verification method '${Lt.id}' does not contain a public key in JWK format`);const er=yield kt.getKeyUri({key:Lt.publicKeyJwk});yield kt.getPublicKey({keyUri:er})}return new BearerDid({uri:At.uri,document:At.document,metadata:At.metadata,keyManager:kt})})}}var __awaiter$6=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class DidMethod{static getSigningMethod(e){return __awaiter$6(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement getSigningMethod()")})}static resolve(e,At){return __awaiter$6(this,void 0,void 0,function*(){throw new Error("Not implemented: Classes extending DidMethod must implement resolve()")})}}var __awaiter$5=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},__rest$1=function(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At};const DEFAULT_GATEWAY_URI$1="https://diddht.tbddev.org",DID_DHT_SPECIFICATION_VERSION=0,DNS_RECORD_TTL=7200,PROPERTY_SEPARATOR=";",VALUE_SEPARATOR=",";var DidDhtRegisteredDidType;(function(xt){xt[xt.Discoverable=0]="Discoverable",xt[xt.Organization=1]="Organization",xt[xt.Government=2]="Government",xt[xt.Corporation=3]="Corporation",xt[xt.LocalBusiness=4]="LocalBusiness",xt[xt.SoftwarePackage=5]="SoftwarePackage",xt[xt.WebApp=6]="WebApp",xt[xt.FinancialInstitution=7]="FinancialInstitution"})(DidDhtRegisteredDidType||(DidDhtRegisteredDidType={}));var DidDhtRegisteredKeyType;(function(xt){xt[xt.Ed25519=0]="Ed25519",xt[xt.secp256k1=1]="secp256k1",xt[xt.secp256r1=2]="secp256r1",xt[xt.X25519=3]="X25519"})(DidDhtRegisteredKeyType||(DidDhtRegisteredKeyType={}));var DidDhtVerificationRelationship;(function(xt){xt.authentication="auth",xt.assertionMethod="asm",xt.capabilityDelegation="del",xt.capabilityInvocation="inv",xt.keyAgreement="agm"})(DidDhtVerificationRelationship||(DidDhtVerificationRelationship={}));const AlgorithmToKeyTypeMap$2={Ed25519:DidDhtRegisteredKeyType.Ed25519,ES256K:DidDhtRegisteredKeyType.secp256k1,ES256:DidDhtRegisteredKeyType.secp256r1,"P-256":DidDhtRegisteredKeyType.secp256r1,secp256k1:DidDhtRegisteredKeyType.secp256k1,secp256r1:DidDhtRegisteredKeyType.secp256r1,X25519:DidDhtRegisteredKeyType.X25519},KeyTypeToDefaultAlgorithmMap={[DidDhtRegisteredKeyType.Ed25519]:"Ed25519",[DidDhtRegisteredKeyType.secp256k1]:"ES256K",[DidDhtRegisteredKeyType.secp256r1]:"ES256",[DidDhtRegisteredKeyType.X25519]:"ECDH-ES+A256KW"};class DidDht extends DidMethod{static create(){return __awaiter$5(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager,options:At={}}={}){var kt,Bt,Nt,jt,Lt,er,tr,zt,rr,nr,ir;if(!((kt=At.verificationMethods)===null||kt===void 0)&&kt.some(br=>!(br.algorithm in AlgorithmToKeyTypeMap$2)))throw new Error("One or more verification method algorithms are not supported");const ar=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt.filter(br=>"id"in br).map(br=>br.id);if(ar&&ar.length!==new Set(ar).size)throw new Error("One or more verification method IDs are not unique");if(!((Nt=At.services)===null||Nt===void 0)&&Nt.some(br=>!br.id||!br.type||!br.serviceEndpoint))throw new Error("One or more services are missing required properties");const dr=yield e.generateKey({algorithm:"Ed25519"}),ur=yield e.getPublicKey({keyUri:dr}),fr=yield DidDhtUtils.identityKeyToIdentifier({identityKey:ur}),pr=Object.assign(Object.assign({id:fr},At.alsoKnownAs&&{alsoKnownAs:At.alsoKnownAs}),At.controllers&&{controller:At.controllers}),lr=[...(jt=At.verificationMethods)!==null&&jt!==void 0?jt:[]];lr!=null&&lr.some(br=>{var Ar;return((Ar=br.id)===null||Ar===void 0?void 0:Ar.split("#").pop())==="0"})||lr.unshift({algorithm:"Ed25519",id:"0",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]});for(const br of lr){const Ar=br.id&&br.id.split("#").pop()==="0"?dr:yield e.generateKey({algorithm:br.algorithm}),Pr=yield e.getPublicKey({keyUri:Ar});let kr=(er=(Lt=br.id)!==null&&Lt!==void 0?Lt:Pr.kid)!==null&&er!==void 0?er:yield computeJwkThumbprint({jwk:Pr});kr=`${fr}#${extractDidFragment(kr)}`,(tr=pr.verificationMethod)!==null&&tr!==void 0||(pr.verificationMethod=[]),pr.verificationMethod.push({id:kr,type:"JsonWebKey",controller:(zt=br.controller)!==null&&zt!==void 0?zt:fr,publicKeyJwk:Pr});for(const Ur of(rr=br.purposes)!==null&&rr!==void 0?rr:[])pr[Ur]||(pr[Ur]=[]),pr[Ur].push(kr)}(nr=At.services)===null||nr===void 0||nr.forEach(br=>{var Ar;(Ar=pr.service)!==null&&Ar!==void 0||(pr.service=[]),br.id=`${fr}#${br.id.split("#").pop()}`,pr.service.push(br)});const yr=new BearerDid({uri:fr,document:pr,metadata:Object.assign({published:!1},At.types&&{types:At.types}),keyManager:e});if(!((ir=At.publish)!==null&&ir!==void 0)||ir){const br=yield DidDht.publish({did:yr,gatewayUri:At.gatewayUri});yr.metadata=br.didDocumentMetadata}return yr})}static import(e){return __awaiter$5(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager}){var Bt;const Nt=Did.parse(At.uri);if((Nt==null?void 0:Nt.method)!==DidDht.methodName)throw new DidError(DidErrorCode.MethodNotSupported,"Method not supported");const jt=yield BearerDid.import({portableDid:At,keyManager:kt});if(!(!((Bt=jt.document.verificationMethod)===null||Bt===void 0)&&Bt.some(Lt=>{var er;return((er=Lt.id)===null||er===void 0?void 0:er.split("#").pop())==="0"})))throw new DidError(DidErrorCode.InvalidDidDocument,"DID document must contain an Identity Key");return jt})}static getSigningMethod(e){return __awaiter$5(this,arguments,void 0,function*({didDocument:At,methodId:kt="#0"}){var Bt;const Nt=Did.parse(At.id);if(Nt&&Nt.method!==this.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${Nt.method}`);const jt=(Bt=At.verificationMethod)===null||Bt===void 0?void 0:Bt.find(Lt=>{var er,tr;return extractDidFragment(Lt.id)===((er=extractDidFragment(kt))!==null&&er!==void 0?er:extractDidFragment((tr=At.assertionMethod)===null||tr===void 0?void 0:tr[0]))});if(!(jt&&jt.publicKeyJwk))throw new DidError(DidErrorCode.InternalError,"A verification method intended for signing could not be determined from the DID Document");return jt})}static publish(e){return __awaiter$5(this,arguments,void 0,function*({did:At,gatewayUri:kt=DEFAULT_GATEWAY_URI$1}){return yield DidDhtDocument.put({did:At,gatewayUri:kt})})}static resolve(e){return __awaiter$5(this,arguments,void 0,function*(At,kt={}){var Bt;const Nt=(Bt=kt==null?void 0:kt.gatewayUri)!==null&&Bt!==void 0?Bt:DEFAULT_GATEWAY_URI$1;try{yield DidDhtUtils.identifierToIdentityKey({didUri:At});const{didDocument:jt,didDocumentMetadata:Lt}=yield DidDhtDocument.get({didUri:At,gatewayUri:Nt});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didDocument:jt,didDocumentMetadata:Lt})}catch(jt){if(!(jt instanceof DidError))throw new Error(jt);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:Object.assign({error:jt.code},jt.message&&{errorMessage:jt.message})})}})}}DidDht.methodName="dht";class DidDhtDocument{static get(e){return __awaiter$5(this,arguments,void 0,function*({didUri:At,gatewayUri:kt}){const Bt=DidDhtUtils.identifierToIdentityKeyBytes({didUri:At}),Nt=yield DidDhtDocument.pkarrGet({gatewayUri:kt,publicKeyBytes:Bt}),jt=yield DidDhtUtils.parseBep44GetMessage({bep44Message:Nt}),Lt=yield DidDhtDocument.fromDnsPacket({didUri:At,dnsPacket:jt});return Lt.didDocumentMetadata.versionId=Nt.seq.toString(),Lt})}static put(e){return __awaiter$5(this,arguments,void 0,function*({did:At,gatewayUri:kt}){const Bt=yield DidDhtDocument.toDnsPacket({didDocument:At.document,didMetadata:At.metadata,authoritativeGatewayUris:[kt]}),Nt=yield DidDhtUtils.createBep44PutMessage({dnsPacket:Bt,publicKeyBytes:DidDhtUtils.identifierToIdentityKeyBytes({didUri:At.uri}),signer:yield At.getSigner({methodId:"0"})}),jt=yield DidDhtDocument.pkarrPut({gatewayUri:kt,bep44Message:Nt});return{didDocument:At.document,didDocumentMetadata:Object.assign(Object.assign({},At.metadata),{published:jt,versionId:Nt.seq.toString()}),didRegistrationMetadata:{}}})}static pkarrGet(e){return __awaiter$5(this,arguments,void 0,function*({gatewayUri:At,publicKeyBytes:kt}){const Bt=Convert$1.uint8Array(kt).toBase32Z(),Nt=new URL(Bt,At).href;let jt;try{if(jt=yield fetch(Nt,{method:"GET"}),!jt.ok)throw new DidError(DidErrorCode.NotFound,`Pkarr record not found for: ${Bt}`)}catch(tr){throw tr instanceof DidError?tr:new DidError(DidErrorCode.InternalError,`Failed to fetch Pkarr record: ${tr.message}`)}const Lt=yield jt.arrayBuffer();if(!Lt)throw new DidError(DidErrorCode.NotFound,`Pkarr record not found for: ${Bt}`);if(Lt.byteLength<72)throw new DidError(DidErrorCode.InvalidDidDocumentLength,`Pkarr response must be at least 72 bytes but got: ${Lt.byteLength}`);if(Lt.byteLength>1072)throw new DidError(DidErrorCode.InvalidDidDocumentLength,`Pkarr response exceeds 1000 byte limit: ${Lt.byteLength}`);return{k:kt,seq:Number(new DataView(Lt).getBigUint64(64)),sig:new Uint8Array(Lt,0,64),v:new Uint8Array(Lt,72)}})}static pkarrPut(e){return __awaiter$5(this,arguments,void 0,function*({gatewayUri:At,bep44Message:kt}){const Bt=Convert$1.uint8Array(kt.k).toBase32Z(),Nt=new URL(Bt,At).href,jt=new Uint8Array(kt.v.length+72);jt.set(kt.sig,0),new DataView(jt.buffer).setBigUint64(kt.sig.length,BigInt(kt.seq)),jt.set(kt.v,kt.sig.length+8);let Lt;try{Lt=yield fetch(Nt,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:jt})}catch(er){throw new DidError(DidErrorCode.InternalError,`Failed to put Pkarr record for identifier ${Bt}: ${er.message}`)}return Lt.ok})}static fromDnsPacket(e){return __awaiter$5(this,arguments,void 0,function*({didUri:At,dnsPacket:kt}){var Bt,Nt,jt;const Lt={id:At},er={published:!0},tr=new Map;for(const zt of(Bt=kt==null?void 0:kt.answers)!==null&&Bt!==void 0?Bt:[]){if(zt.type!=="TXT")continue;const rr=zt.name.split(".")[0].substring(1);switch(!0){case rr.startsWith("aka"):{const nr=DidDhtUtils.parseTxtDataToString(zt.data);Lt.alsoKnownAs=nr.split(VALUE_SEPARATOR);break}case rr.startsWith("cnt"):{const nr=DidDhtUtils.parseTxtDataToString(zt.data);Lt.controller=nr.includes(VALUE_SEPARATOR)?nr.split(VALUE_SEPARATOR):nr;break}case rr.startsWith("k"):{const{id:nr,t:ir,k:ar,c:dr,a:ur}=DidDhtUtils.parseTxtDataToObject(zt.data),fr=Convert$1.base64Url(ar).toUint8Array(),pr=DidDhtRegisteredKeyType[Number(ir)];let lr=yield DidDhtUtils.keyConverter(pr).bytesToPublicKey({publicKeyBytes:fr});lr.alg=ur||KeyTypeToDefaultAlgorithmMap[Number(ir)];const yr=rr==="k0"?"0":nr!==void 0?nr:yield computeJwkThumbprint({jwk:lr});(Nt=Lt.verificationMethod)!==null&&Nt!==void 0||(Lt.verificationMethod=[]);const br=`${At}#${yr}`;Lt.verificationMethod.push({id:br,type:"JsonWebKey",controller:dr??At,publicKeyJwk:lr}),tr.set(rr,br);break}case rr.startsWith("s"):{const nr=DidDhtUtils.parseTxtDataToObject(zt.data),{id:ir,t:ar,se:dr}=nr,ur=__rest$1(nr,["id","t","se"]),fr=dr.includes(VALUE_SEPARATOR)?dr.split(VALUE_SEPARATOR):[dr],pr=Object.fromEntries(Object.entries(ur).map(([lr,yr])=>[lr,yr.includes(VALUE_SEPARATOR)?yr.split(VALUE_SEPARATOR):yr]));(jt=Lt.service)!==null&&jt!==void 0||(Lt.service=[]),Lt.service.push(Object.assign(Object.assign({},pr),{id:`${At}#${ir}`,type:ar,serviceEndpoint:fr}));break}case rr.startsWith("typ"):{const{id:nr}=DidDhtUtils.parseTxtDataToObject(zt.data);er.types=nr.split(VALUE_SEPARATOR).map(ir=>Number(ir));break}case rr.startsWith("did"):{const nr=pr=>pr.split(VALUE_SEPARATOR).map(lr=>tr.get(lr)).filter(lr=>typeof lr=="string"),{auth:ir,asm:ar,del:dr,inv:ur,agm:fr}=DidDhtUtils.parseTxtDataToObject(zt.data);ir&&(Lt.authentication=nr(ir)),ar&&(Lt.assertionMethod=nr(ar)),dr&&(Lt.capabilityDelegation=nr(dr)),ur&&(Lt.capabilityInvocation=nr(ur)),fr&&(Lt.keyAgreement=nr(fr));break}}}return{didDocument:Lt,didDocumentMetadata:er,didResolutionMetadata:{}}})}static toDnsPacket(e){return __awaiter$5(this,arguments,void 0,function*({didDocument:At,didMetadata:kt,authoritativeGatewayUris:Bt,previousDidProof:Nt}){var jt,Lt,er,tr,zt;const rr=[],nr=[],ir=new Map,ar=[],dr=[];if(Nt!==void 0){const{signature:pr,previousDid:lr}=Nt;yield DidDhtUtils.validatePreviousDidProof({newDid:At.id,previousDidProof:Nt}),rr.push({type:"TXT",name:"_prv._did.",ttl:DNS_RECORD_TTL,data:`id=${lr};s=${pr}`})}if(At.alsoKnownAs&&rr.push({type:"TXT",name:"_aka._did.",ttl:DNS_RECORD_TTL,data:At.alsoKnownAs.join(VALUE_SEPARATOR)}),At.controller){const pr=Array.isArray(At.controller)?At.controller.join(VALUE_SEPARATOR):At.controller;rr.push({type:"TXT",name:"_cnt._did.",ttl:DNS_RECORD_TTL,data:pr})}for(const[pr,lr]of(Lt=(jt=At.verificationMethod)===null||jt===void 0?void 0:jt.entries())!==null&&Lt!==void 0?Lt:[]){const yr=`k${pr}`;dr.push(yr);let br=lr.id.split("#").pop();ir.set(br,yr);const Ar=lr.publicKeyJwk;if(!(Ar!=null&&Ar.crv&&Ar.crv in AlgorithmToKeyTypeMap$2))throw new DidError(DidErrorCode.InvalidPublicKeyType,`Verification method '${lr.id}' contains an unsupported key type: ${(er=Ar==null?void 0:Ar.crv)!==null&&er!==void 0?er:"undefined"}`);const Pr=DidDhtRegisteredKeyType[Ar.crv],kr=yield DidDhtUtils.keyConverter(Ar.crv).publicKeyToBytes({publicKey:Ar}),Ur=Convert$1.uint8Array(kr).toBase64Url(),Hr=[`t=${Pr}`,`k=${Ur}`];br!=="0"&&(yield computeJwkThumbprint({jwk:Ar}))!==br&&Hr.unshift(`id=${br}`),Ar.alg!==KeyTypeToDefaultAlgorithmMap[Pr]&&Hr.push(`a=${Ar.alg}`),lr.controller!==At.id&&Hr.push(`c=${lr.controller}`),rr.push({type:"TXT",name:`_${yr}._did.`,ttl:DNS_RECORD_TTL,data:Hr.join(PROPERTY_SEPARATOR)})}(tr=At.service)===null||tr===void 0||tr.forEach((pr,lr)=>{const yr=`s${lr}`;ar.push(yr);let{id:br,type:Ar,serviceEndpoint:Pr}=pr,kr=__rest$1(pr,["id","type","serviceEndpoint"]);br=extractDidFragment(br),Pr=Array.isArray(Pr)?Pr.join(","):Pr;const Hr=Object.entries(Object.assign({id:br,t:Ar,se:Pr},kr)).map(([Sr,_r])=>`${Sr}=${_r}`).join(PROPERTY_SEPARATOR),Lr=DidDhtUtils.chunkDataIfNeeded(Hr);rr.push({type:"TXT",name:`_${yr}._did.`,ttl:DNS_RECORD_TTL,data:Lr})});const ur=[`v=${DID_DHT_SPECIFICATION_VERSION}`];if(dr.length&&ur.push(`vm=${dr.join(VALUE_SEPARATOR)}`),Object.keys(DidVerificationRelationship).forEach(pr=>{var lr;const yr=(lr=At[pr])===null||lr===void 0?void 0:lr.map(br=>ir.get(br.split("#").pop()));if(yr){const br=DidDhtVerificationRelationship[pr];ur.push(`${br}=${yr.join(VALUE_SEPARATOR)}`)}}),ar.length&&ur.push(`svc=${ar.join(VALUE_SEPARATOR)}`),!((zt=kt.types)===null||zt===void 0)&&zt.length){const lr=kt.types.map(yr=>typeof yr=="string"?DidDhtRegisteredDidType[yr]:yr);rr.push({type:"TXT",name:"_typ._did.",ttl:DNS_RECORD_TTL,data:`id=${lr.join(VALUE_SEPARATOR)}`})}rr.push({type:"TXT",name:"_did."+DidDhtDocument.getUniqueDidSuffix(At.id)+".",ttl:DNS_RECORD_TTL,data:ur.join(PROPERTY_SEPARATOR)});for(const pr of Bt||[])nr.push({type:"NS",name:"_did."+DidDhtDocument.getUniqueDidSuffix(At.id)+".",ttl:DNS_RECORD_TTL,data:pr+"."});return{id:0,type:"response",flags:AUTHORITATIVE_ANSWER,answers:[...rr,...nr]}})}static getUniqueDidSuffix(e){return e.split(":")[2]}}class DidDhtUtils{static createBep44PutMessage(e){return __awaiter$5(this,arguments,void 0,function*({dnsPacket:At,publicKeyBytes:kt,signer:Bt}){const Nt=Math.ceil(Date.now()/1e3),jt=encode$2(At),Lt=bencode.encode({seq:Nt,v:jt}).subarray(1,-1);if(Lt.length>1e3)throw new DidError(DidErrorCode.InvalidDidDocumentLength,`DNS packet exceeds the 1000 byte maximum size: ${Lt.length} bytes`);const er=yield Bt.sign({data:Lt});return{k:kt,seq:Nt,sig:er,v:jt}})}static identifierToIdentityKey(e){return __awaiter$5(this,arguments,void 0,function*({didUri:At}){let kt=DidDhtUtils.identifierToIdentityKeyBytes({didUri:At});return yield Ed25519.bytesToPublicKey({publicKeyBytes:kt})})}static identifierToIdentityKeyBytes({didUri:e}){const At=Did.parse(e);if(!At)throw new DidError(DidErrorCode.InvalidDid,`Invalid DID URI: ${e}`);if(At.method!==DidDht.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${At.method}`);let kt;try{kt=Convert$1.base32Z(At.id).toUint8Array()}catch{throw new DidError(DidErrorCode.InvalidPublicKey,"Failed to decode method-specific identifier")}if(kt.length!==32)throw new DidError(DidErrorCode.InvalidPublicKeyLength,`Invalid public key length: ${kt.length}`);return kt}static identityKeyToIdentifier(e){return __awaiter$5(this,arguments,void 0,function*({identityKey:At}){const kt=yield Ed25519.publicKeyToBytes({publicKey:At}),Bt=Convert$1.uint8Array(kt).toBase32Z();return`did:${DidDht.methodName}:${Bt}`})}static keyConverter(e){const kt={Ed25519,"P-256":{publicKeyToBytes:Bt=>__awaiter$5(this,[Bt],void 0,function*({publicKey:Nt}){const jt=yield Secp256r1.publicKeyToBytes({publicKey:Nt});return yield Secp256r1.compressPublicKey({publicKeyBytes:jt})}),bytesToPublicKey:Secp256r1.bytesToPublicKey,privateKeyToBytes:Secp256r1.privateKeyToBytes,bytesToPrivateKey:Secp256r1.bytesToPrivateKey},secp256k1:{publicKeyToBytes:Bt=>__awaiter$5(this,[Bt],void 0,function*({publicKey:Nt}){const jt=yield Secp256k1.publicKeyToBytes({publicKey:Nt});return yield Secp256k1.compressPublicKey({publicKeyBytes:jt})}),bytesToPublicKey:Secp256k1.bytesToPublicKey,privateKeyToBytes:Secp256k1.privateKeyToBytes,bytesToPrivateKey:Secp256k1.bytesToPrivateKey},X25519}[e];if(!kt)throw new DidError(DidErrorCode.InvalidPublicKeyType,`Unsupported curve: ${e}`);return kt}static parseBep44GetMessage(e){return __awaiter$5(this,arguments,void 0,function*({bep44Message:At}){const kt=yield Ed25519.bytesToPublicKey({publicKeyBytes:At.k}),Bt=bencode.encode({seq:At.seq,v:At.v}).subarray(1,-1);if(!(yield Ed25519.verify({key:kt,signature:At.sig,data:Bt})))throw new DidError(DidErrorCode.InvalidSignature,"Invalid signature for DHT BEP44 message");return decode$1(At.v)})}static parseTxtDataToObject(e){return this.parseTxtDataToString(e).split(PROPERTY_SEPARATOR).reduce((At,kt)=>{const[Bt,Nt]=kt.split("=");return At[Bt]=Nt,At},{})}static parseTxtDataToString(e){if(typeof e=="string")return e;if(e instanceof Uint8Array)return Convert$1.uint8Array(e).toString();if(Array.isArray(e))return e.map(At=>this.parseTxtDataToString(At)).join("");throw new DidError(DidErrorCode.InternalError,"Pkarr returned DNS TXT record with invalid data type")}static validatePreviousDidProof(e){return __awaiter$5(this,arguments,void 0,function*({newDid:At,previousDidProof:kt}){const Bt=yield DidDhtUtils.identifierToIdentityKey({didUri:kt.previousDid}),Nt=DidDhtUtils.identifierToIdentityKeyBytes({didUri:At}),jt=Convert$1.base64Url(kt.signature).toUint8Array();if(!(yield Ed25519.verify({key:Bt,data:Nt,signature:jt})))throw new DidError(DidErrorCode.InvalidPreviousDidProof,"The previous DID proof is invalid.")})}static chunkDataIfNeeded(e){if(e.length<=255)return e;const At=[];for(let kt=0;kt<e.length;kt+=255)At.push(e.slice(kt,kt+255));return At}}var __awaiter$4=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},DidIonRegisteredKeyType;(function(xt){xt.Ed25519="Ed25519",xt.secp256k1="secp256k1",xt.secp256r1="secp256r1",xt.X25519="X25519"})(DidIonRegisteredKeyType||(DidIonRegisteredKeyType={}));const AlgorithmToKeyTypeMap$1={Ed25519:DidIonRegisteredKeyType.Ed25519,ES256K:DidIonRegisteredKeyType.secp256k1,ES256:DidIonRegisteredKeyType.secp256r1,"P-256":DidIonRegisteredKeyType.secp256r1,secp256k1:DidIonRegisteredKeyType.secp256k1,secp256r1:DidIonRegisteredKeyType.secp256r1},DEFAULT_GATEWAY_URI="https://ion.tbd.engineering";class DidIon extends DidMethod{static create(){return __awaiter$4(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager,options:At={}}={}){var kt,Bt,Nt,jt,Lt,er,tr;if(!((kt=At.verificationMethods)===null||kt===void 0)&&kt.some(br=>!(br.algorithm in AlgorithmToKeyTypeMap$1)))throw new Error("One or more verification method algorithms are not supported");const zt=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt.filter(br=>"id"in br).map(br=>br.id);if(zt&&zt.length!==new Set(zt).size)throw new Error("One or more verification method IDs are not unique");if(!((Nt=At.services)===null||Nt===void 0)&&Nt.some(br=>!br.id||!br.type||!br.serviceEndpoint))throw new Error("One or more services are missing required properties");const rr={algorithm:"Ed25519",purposes:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]},nr=[];for(const br of(jt=At.verificationMethods)!==null&&jt!==void 0?jt:[rr]){const Ar=yield e.generateKey({algorithm:br.algorithm}),Pr=yield e.getPublicKey({keyUri:Ar});nr.push({id:br.id,publicKeyJwk:Pr,purposes:(Lt=br.purposes)!==null&&Lt!==void 0?Lt:["authentication","assertionMethod","capabilityDelegation","capabilityInvocation"]})}const ir=yield e.generateKey({algorithm:DidIonRegisteredKeyType.secp256k1}),ar=yield e.getPublicKey({keyUri:ir}),dr=yield e.generateKey({algorithm:DidIonRegisteredKeyType.secp256k1}),ur=yield e.getPublicKey({keyUri:dr}),fr=yield DidIonUtils.computeLongFormDidUri({recoveryKey:ar,updateKey:ur,services:(er=At.services)!==null&&er!==void 0?er:[],verificationMethods:nr}),{didDocument:pr,didResolutionMetadata:lr}=yield DidIon.resolve(fr,{gatewayUri:At.gatewayUri});if(pr===null)throw new Error(`Unable to resolve DID during creation: ${lr==null?void 0:lr.error}`);const yr=new BearerDid({uri:fr,document:pr,metadata:{published:!1,canonicalId:fr.split(":",3).join(":"),recoveryKey:ar,updateKey:ur},keyManager:e});if(!((tr=At.publish)!==null&&tr!==void 0)||tr){const br=yield DidIon.publish({did:yr,gatewayUri:At.gatewayUri});yr.metadata=br.didDocumentMetadata}return yr})}static getSigningMethod(e){return __awaiter$4(this,arguments,void 0,function*({didDocument:At,methodId:kt}){var Bt;const Nt=Did.parse(At.id);if(Nt&&Nt.method!==this.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${Nt.method}`);const jt=(Bt=At.verificationMethod)===null||Bt===void 0?void 0:Bt.find(Lt=>{var er;return Lt.id===(kt??((er=At.assertionMethod)===null||er===void 0?void 0:er[0]))});if(!(jt&&jt.publicKeyJwk))throw new DidError(DidErrorCode.InternalError,"A verification method intended for signing could not be determined from the DID Document");return jt})}static import(e){return __awaiter$4(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager}){const Bt=Did.parse(At.uri);if((Bt==null?void 0:Bt.method)!==DidIon.methodName)throw new DidError(DidErrorCode.MethodNotSupported,"Method not supported");return yield BearerDid.import({portableDid:At,keyManager:kt})})}static publish(e){return __awaiter$4(this,arguments,void 0,function*({did:At,gatewayUri:kt=DEFAULT_GATEWAY_URI}){var Bt,Nt,jt;const Lt=(Nt=(Bt=At.document.verificationMethod)===null||Bt===void 0?void 0:Bt.map(zt=>({id:zt.id,publicKeyJwk:zt.publicKeyJwk,purposes:getVerificationRelationshipsById({didDocument:At.document,methodId:zt.id})})))!==null&&Nt!==void 0?Nt:[],er=yield DidIonUtils.createIonDocument({services:(jt=At.document.service)!==null&&jt!==void 0?jt:[],verificationMethods:Lt}),tr=yield DidIonUtils.constructCreateRequest({ionDocument:er,recoveryKey:At.metadata.recoveryKey,updateKey:At.metadata.updateKey});try{const zt=DidIonUtils.appendPathToUrl({baseUrl:kt,path:"/operations"}),rr=yield fetch(zt,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(tr)});return{didDocument:At.document,didDocumentMetadata:Object.assign(Object.assign({},At.metadata),{published:rr.ok}),didRegistrationMetadata:{}}}catch{return{didDocument:null,didDocumentMetadata:{published:!1},didRegistrationMetadata:{error:DidErrorCode.InternalError,errorMessage:`Failed to publish DID document for: ${At.uri}`}}}})}static resolve(e){return __awaiter$4(this,arguments,void 0,function*(At,kt={}){var Bt,Nt;const jt=Did.parse(At);if(!jt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"invalidDid"}});if(jt.method!==DidIon.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"methodNotSupported"}});const Lt=(Bt=kt==null?void 0:kt.gatewayUri)!==null&&Bt!==void 0?Bt:DEFAULT_GATEWAY_URI;try{const er=DidIonUtils.appendPathToUrl({baseUrl:Lt,path:`/identifiers/${At}`}),tr=yield fetch(er);if(!tr.ok)throw new DidError(DidErrorCode.NotFound,`Unable to find DID document for: ${At}`);const{didDocument:zt,didDocumentMetadata:rr}=yield tr.json();return Object.assign(Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),zt&&{didDocument:zt}),{didDocumentMetadata:Object.assign({published:(Nt=rr==null?void 0:rr.method)===null||Nt===void 0?void 0:Nt.published},rr)})}catch(er){if(!(er instanceof DidError))throw new Error(er);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:Object.assign({error:er.code},er.message&&{errorMessage:er.message})})}})}}DidIon.methodName="ion";class DidIonUtils{static appendPathToUrl({baseUrl:e,path:At}){const kt=new URL(e);return kt.pathname=kt.pathname.endsWith("/")?kt.pathname:kt.pathname+"/",kt.pathname+=At.startsWith("/")?At.substring(1):At,kt.toString()}static computeLongFormDidUri(e){return __awaiter$4(this,arguments,void 0,function*({recoveryKey:At,updateKey:kt,services:Bt,verificationMethods:Nt}){const jt=yield DidIonUtils.createIonDocument({services:Bt,verificationMethods:Nt}),Lt=DidIonUtils.normalizeJwk(At),er=DidIonUtils.normalizeJwk(kt);return yield IonDid.createLongFormDid({document:jt,recoveryKey:Lt,updateKey:er})})}static constructCreateRequest(e){return __awaiter$4(this,arguments,void 0,function*({ionDocument:At,recoveryKey:kt,updateKey:Bt}){return yield IonRequest.createCreateRequest({document:At,recoveryKey:DidIonUtils.normalizeJwk(kt),updateKey:DidIonUtils.normalizeJwk(Bt)})})}static createIonDocument(e){return __awaiter$4(this,arguments,void 0,function*({services:At,verificationMethods:kt}){var Bt,Nt;const jt=[];for(const tr of kt){let zt=(Nt=(Bt=tr.id)!==null&&Bt!==void 0?Bt:tr.publicKeyJwk.kid)!==null&&Nt!==void 0?Nt:yield computeJwkThumbprint({jwk:tr.publicKeyJwk});zt=`${zt.split("#").pop()}`;const rr={id:zt,publicKeyJwk:DidIonUtils.normalizeJwk(tr.publicKeyJwk),purposes:tr.purposes,type:"JsonWebKey2020"};jt.push(rr)}const Lt=At.map(tr=>Object.assign(Object.assign({},tr),{id:`${tr.id.split("#").pop()}`}));return{publicKeys:jt,services:Lt}})}static normalizeJwk(e){const At=e.kty;let kt;if(At==="EC")kt={crv:e.crv,kty:e.kty,x:e.x,y:e.y};else if(At==="oct")kt={k:e.k,kty:e.kty};else if(At==="OKP")kt={crv:e.crv,kty:e.kty,x:e.x};else if(At==="RSA")kt={e:e.e,kty:e.kty,n:e.n};else throw new Error(`Unsupported key type: ${At}`);return kt}}var __awaiter$3=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class DidJwk extends DidMethod{static create(){return __awaiter$3(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager,options:At={}}={}){var kt,Bt,Nt,jt;if(At.algorithm&&At.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(At.verificationMethods&&At.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Lt=(jt=(kt=At.algorithm)!==null&&kt!==void 0?kt:(Nt=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt[0])===null||Nt===void 0?void 0:Nt.algorithm)!==null&&jt!==void 0?jt:"Ed25519",er=yield e.generateKey({algorithm:Lt}),tr=yield e.getPublicKey({keyUri:er}),zt=Convert$1.object(tr).toBase64Url(),rr=`did:${DidJwk.methodName}:${zt}`,ir=(yield DidJwk.resolve(rr)).didDocument;return new BearerDid({uri:rr,document:ir,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$3(this,arguments,void 0,function*({didDocument:At}){var kt;const Bt=Did.parse(At.id);if(Bt&&Bt.method!==this.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${Bt.method}`);const[Nt]=(kt=At.verificationMethod)!==null&&kt!==void 0?kt:[];if(!(Nt&&Nt.publicKeyJwk))throw new DidError(DidErrorCode.InternalError,"A verification method intended for signing could not be determined from the DID Document");return Nt})}static import(e){return __awaiter$3(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager}){const Bt=Did.parse(At.uri);if((Bt==null?void 0:Bt.method)!==DidJwk.methodName)throw new DidError(DidErrorCode.MethodNotSupported,"Method not supported");const Nt=yield BearerDid.import({portableDid:At,keyManager:kt});if(Nt.document.verificationMethod.length!==1)throw new DidError(DidErrorCode.InvalidDidDocument,"DID document must contain exactly one verification method");return Nt})}static resolve(e,At){return __awaiter$3(this,void 0,void 0,function*(){const kt=Did.parse(e);let Bt;try{Bt=Convert$1.base64Url(kt.id).toObject()}catch{}if(!kt||!Bt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"invalidDid"}});if(kt.method!==DidJwk.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"methodNotSupported"}});const Nt={"@context":["https://www.w3.org/ns/did/v1"],id:kt.uri},jt=`${Nt.id}#0`;switch(Nt.verificationMethod=[{id:jt,type:"JsonWebKey",controller:Nt.id,publicKeyJwk:Bt}],Nt.authentication=[jt],Nt.assertionMethod=[jt],Nt.capabilityInvocation=[jt],Nt.capabilityDelegation=[jt],Nt.keyAgreement=[jt],Bt.use){case"sig":{delete Nt.keyAgreement;break}case"enc":{delete Nt.authentication,delete Nt.assertionMethod,delete Nt.capabilityInvocation,delete Nt.capabilityDelegation;break}}return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didDocument:Nt})})}}DidJwk.methodName="jwk";var __awaiter$2=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})},DidKeyRegisteredKeyType;(function(xt){xt.Ed25519="Ed25519",xt.secp256k1="secp256k1",xt.secp256r1="secp256r1",xt.X25519="X25519"})(DidKeyRegisteredKeyType||(DidKeyRegisteredKeyType={}));const DidKeyVerificationMethodType={Ed25519VerificationKey2020:"https://w3id.org/security/suites/ed25519-2020/v1",JsonWebKey2020:"https://w3id.org/security/suites/jws-2020/v1",X25519KeyAgreementKey2020:"https://w3id.org/security/suites/x25519-2020/v1"},AlgorithmToKeyTypeMap={Ed25519:DidKeyRegisteredKeyType.Ed25519,ES256K:DidKeyRegisteredKeyType.secp256k1,ES256:DidKeyRegisteredKeyType.secp256r1,"P-256":DidKeyRegisteredKeyType.secp256r1,secp256k1:DidKeyRegisteredKeyType.secp256k1,secp256r1:DidKeyRegisteredKeyType.secp256r1,X25519:DidKeyRegisteredKeyType.X25519};class DidKey extends DidMethod{static create(){return __awaiter$2(this,arguments,void 0,function*({keyManager:e=new LocalKeyManager,options:At={}}={}){var kt,Bt,Nt,jt;if(At.algorithm&&At.verificationMethods)throw new Error("The 'algorithm' and 'verificationMethods' options are mutually exclusive");if(At.verificationMethods&&At.verificationMethods.length!==1)throw new Error("The 'verificationMethods' option must contain exactly one entry");const Lt=(jt=(kt=At.algorithm)!==null&&kt!==void 0?kt:(Nt=(Bt=At.verificationMethods)===null||Bt===void 0?void 0:Bt[0])===null||Nt===void 0?void 0:Nt.algorithm)!==null&&jt!==void 0?jt:"Ed25519",er=yield e.generateKey({algorithm:Lt}),tr=yield e.getPublicKey({keyUri:er}),zt=yield DidKeyUtils.publicKeyToMultibaseId({publicKey:tr}),rr=`did:${DidKey.methodName}:${zt}`,ir=(yield DidKey.resolve(rr,At)).didDocument;return new BearerDid({uri:rr,document:ir,metadata:{},keyManager:e})})}static getSigningMethod(e){return __awaiter$2(this,arguments,void 0,function*({didDocument:At}){var kt;const Bt=Did.parse(At.id);if(Bt&&Bt.method!==this.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${Bt.method}`);const[Nt]=At.assertionMethod||[],jt=(kt=At.verificationMethod)===null||kt===void 0?void 0:kt.find(Lt=>Lt.id===Nt);if(!(jt&&jt.publicKeyJwk))throw new DidError(DidErrorCode.InternalError,"A verification method intended for signing could not be determined from the DID Document");return jt})}static import(e){return __awaiter$2(this,arguments,void 0,function*({portableDid:At,keyManager:kt=new LocalKeyManager}){const Bt=Did.parse(At.uri);if((Bt==null?void 0:Bt.method)!==DidKey.methodName)throw new DidError(DidErrorCode.MethodNotSupported,"Method not supported");const Nt=yield BearerDid.import({portableDid:At,keyManager:kt});if(Nt.document.verificationMethod.length!==1)throw new DidError(DidErrorCode.InvalidDidDocument,"DID document must contain exactly one verification method");return Nt})}static resolve(e,At){return __awaiter$2(this,void 0,void 0,function*(){try{const kt=yield DidKey.createDocument({didUri:e,options:At});return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didDocument:kt})}catch(kt){if(!(kt instanceof DidError))throw new Error(kt);return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:Object.assign({error:kt.code},kt.message&&{errorMessage:kt.message})})}})}static createDocument(e){return __awaiter$2(this,arguments,void 0,function*({didUri:At,options:kt={}}){const{defaultContext:Bt="https://www.w3.org/ns/did/v1",enableEncryptionKeyDerivation:Nt=!1,enableExperimentalPublicKeyTypes:jt=!1,publicKeyFormat:Lt="JsonWebKey2020"}=kt,er={id:""},tr=Did.parse(At);if(!tr)throw new DidError(DidErrorCode.InvalidDid,`Invalid DID URI: ${At}`);const zt=tr.id;if(tr.method!==DidKey.methodName)throw new DidError(DidErrorCode.MethodNotSupported,`Method not supported: ${tr.method}`);if(!DidKey.validateIdentifier(tr))throw new DidError(DidErrorCode.InvalidDid,`Invalid DID URI: ${At}`);const rr=yield DidKey.createSignatureMethod({didUri:At,multibaseValue:zt,options:{enableExperimentalPublicKeyTypes:jt,publicKeyFormat:Lt}});if(er.id=tr.uri,er.verificationMethod=[rr],er.authentication=[rr.id],er.assertionMethod=[rr.id],er.capabilityInvocation=[rr.id],er.capabilityDelegation=[rr.id],Nt===!0){const ar=Lt==="Ed25519VerificationKey2020"?"X25519KeyAgreementKey2020":"JsonWebKey2020",dr=yield this.createEncryptionMethod({didUri:At,multibaseValue:zt,options:{enableExperimentalPublicKeyTypes:jt,publicKeyFormat:ar}});er.verificationMethod.push(dr),er.keyAgreement=[dr.id]}const nr=[Bt];return getVerificationMethodTypes({didDocument:er}).forEach(ar=>{const dr=DidKeyVerificationMethodType[ar];nr.push(dr)}),er["@context"]=nr,er})}static createEncryptionMethod(e){return __awaiter$2(this,arguments,void 0,function*({didUri:At,multibaseValue:kt,options:Bt}){const{enableExperimentalPublicKeyTypes:Nt,publicKeyFormat:jt}=Bt,Lt={id:"",type:"",controller:""},{keyBytes:er,multicodecCode:tr}=yield DidKey.deriveEncryptionKey({multibaseValue:kt}),zt=er.byteLength,rr=DidKeyUtils.MULTICODEC_PUBLIC_KEY_LENGTH[tr];if(zt!==rr)throw new DidError(DidErrorCode.InvalidPublicKeyLength,`Expected ${zt} bytes. Actual: ${rr}`);const nr=keyBytesToMultibaseId({keyBytes:er,multicodecCode:tr});Lt.id=`${At}#${nr}`;try{new URL(Lt.id)}catch{throw new DidError(DidErrorCode.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(jt in DidKeyVerificationMethodType))throw new DidError(DidErrorCode.UnsupportedPublicKeyType,`Unsupported format: ${jt}`);if(Nt===!1&&!["Multikey","JsonWebKey2020","X25519KeyAgreementKey2020"].includes(jt))throw new DidError(DidErrorCode.InvalidPublicKeyType,`Specified '${jt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Lt.type=jt,Lt.controller=At,jt==="X25519KeyAgreementKey2020"&&(Lt.publicKeyMultibase=nr),jt==="JsonWebKey2020"){const{crv:ar}=yield DidKeyUtils.multicodecToJwk({code:tr});Lt.publicKeyJwk=yield DidKeyUtils.keyConverter(ar).bytesToPublicKey({publicKeyBytes:er})}return Lt})}static createSignatureMethod(e){return __awaiter$2(this,arguments,void 0,function*({didUri:At,multibaseValue:kt,options:Bt}){const{enableExperimentalPublicKeyTypes:Nt,publicKeyFormat:jt}=Bt,Lt={id:"",type:"",controller:""},{keyBytes:er,multicodecCode:tr,multicodecName:zt}=multibaseIdToKeyBytes({multibaseKeyId:kt}),rr=er.byteLength,nr=DidKeyUtils.MULTICODEC_PUBLIC_KEY_LENGTH[tr];if(rr!==nr)throw new DidError(DidErrorCode.InvalidPublicKeyLength,`Expected ${rr} bytes. Actual: ${nr}`);let ir=!1;switch(zt){case"secp256k1-pub":ir=yield Secp256k1.validatePublicKey({publicKeyBytes:er});break;case"ed25519-pub":ir=yield Ed25519.validatePublicKey({publicKeyBytes:er});break;case"x25519-pub":ir=!0;break}if(!ir)throw new DidError(DidErrorCode.InvalidPublicKey,"Invalid public key detected.");Lt.id=`${At}#${kt}`;try{new URL(Lt.id)}catch{throw new DidError(DidErrorCode.InvalidDidUrl,"Verification Method ID is not a valid DID URL.")}if(!(jt in DidKeyVerificationMethodType))throw new DidError(DidErrorCode.UnsupportedPublicKeyType,`Unsupported format: ${jt}`);if(Nt===!1&&!["Multikey","JsonWebKey2020","Ed25519VerificationKey2020"].includes(jt))throw new DidError(DidErrorCode.InvalidPublicKeyType,`Specified '${jt}' without setting enableExperimentalPublicKeyTypes to true.`);if(Lt.type=jt,Lt.controller=At,jt==="Ed25519VerificationKey2020"&&(Lt.publicKeyMultibase=kt),jt==="JsonWebKey2020"){const{crv:dr}=yield DidKeyUtils.multicodecToJwk({code:tr});Lt.publicKeyJwk=yield DidKeyUtils.keyConverter(dr).bytesToPublicKey({publicKeyBytes:er})}return Lt})}static deriveEncryptionKey(e){return __awaiter$2(this,arguments,void 0,function*({multibaseValue:At}){let kt={keyBytes:new Uint8Array,multicodecCode:0};const{keyBytes:Bt,multicodecCode:Nt}=multibaseIdToKeyBytes({multibaseKeyId:At});if(Nt===237){const jt=yield DidKeyUtils.keyConverter("Ed25519").bytesToPublicKey({publicKeyBytes:Bt}),Lt=yield Ed25519.convertPublicKeyToX25519({publicKey:jt});kt={keyBytes:yield DidKeyUtils.keyConverter("Ed25519").publicKeyToBytes({publicKey:Lt}),multicodecCode:236}}return kt})}static validateIdentifier(e){const{method:At,id:kt}=e,[Bt]=e.uri.split(":",1);return Bt==="did"&&At==="key"&&Number("1")>0&&universalTypeOf$1(kt)==="String"&&kt.startsWith("z")}}DidKey.methodName="key";class DidKeyUtils{static jwkToMulticodec(e){return __awaiter$2(this,arguments,void 0,function*({jwk:At}){const kt=[];At.crv&&(kt.push(At.crv),At.d?kt.push("private"):kt.push("public"));const Bt=kt.join(":"),Nt=DidKeyUtils.JWK_TO_MULTICODEC[Bt];if(Nt===void 0)throw new Error(`Unsupported JWK to Multicodec conversion: '${Bt}'`);return{code:Multicodec$1.getCodeFromName({name:Nt}),name:Nt}})}static keyCompressor(e){const kt={"P-256":Secp256r1.compressPublicKey,secp256k1:Secp256k1.compressPublicKey}[e];if(!kt)throw new DidError(DidErrorCode.InvalidPublicKeyType,`Unsupported curve: ${e}`);return kt}static keyConverter(e){const kt={Ed25519,"P-256":Secp256r1,secp256k1:Secp256k1,X25519}[e];if(!kt)throw new DidError(DidErrorCode.InvalidPublicKeyType,`Unsupported curve: ${e}`);return kt}static multicodecToJwk(e){return __awaiter$2(this,arguments,void 0,function*({code:At,name:kt}){if(!(kt?!At:At))throw new Error("Either 'name' or 'code' must be defined, but not both.");kt=kt===void 0?Multicodec$1.getNameFromCode({code:At}):kt;const Bt=kt,Nt=DidKeyUtils.MULTICODEC_TO_JWK[Bt];if(Nt===void 0)throw new Error("Unsupported Multicodec to JWK conversion");return Object.assign({},Nt)})}static publicKeyToMultibaseId(e){return __awaiter$2(this,arguments,void 0,function*({publicKey:At}){var kt;if(!(At!=null&&At.crv&&At.crv in AlgorithmToKeyTypeMap))throw new DidError(DidErrorCode.InvalidPublicKeyType,`Public key contains an unsupported key type: ${(kt=At==null?void 0:At.crv)!==null&&kt!==void 0?kt:"undefined"}`);let Bt=yield DidKeyUtils.keyConverter(At.crv).publicKeyToBytes({publicKey:At});/^(secp256k1|P-256|P-384|P-521)$/.test(At.crv)&&(Bt=yield DidKeyUtils.keyCompressor(At.crv)({publicKeyBytes:Bt}));const{name:Nt}=yield DidKeyUtils.jwkToMulticodec({jwk:At});return keyBytesToMultibaseId({keyBytes:Bt,multicodecName:Nt})})}}DidKeyUtils.JWK_TO_MULTICODEC={"Ed25519:public":"ed25519-pub","Ed25519:private":"ed25519-priv","secp256k1:public":"secp256k1-pub","secp256k1:private":"secp256k1-priv","X25519:public":"x25519-pub","X25519:private":"x25519-priv"};DidKeyUtils.MULTICODEC_PUBLIC_KEY_LENGTH={231:33,236:32,237:32};DidKeyUtils.MULTICODEC_TO_JWK={"ed25519-pub":{crv:"Ed25519",kty:"OKP",x:""},"ed25519-priv":{crv:"Ed25519",kty:"OKP",x:"",d:""},"secp256k1-pub":{crv:"secp256k1",kty:"EC",x:"",y:""},"secp256k1-priv":{crv:"secp256k1",kty:"EC",x:"",y:"",d:""},"x25519-pub":{crv:"X25519",kty:"OKP",x:""},"x25519-priv":{crv:"X25519",kty:"OKP",x:"",d:""}};var __awaiter$1=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class DidWeb extends DidMethod{static resolve(e,At){return __awaiter$1(this,void 0,void 0,function*(){const kt=Did.parse(e);if(!kt)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"invalidDid"}});if(kt.method!==DidWeb.methodName)return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"methodNotSupported"}});let Bt=`https://${kt.id.replace(/:/g,"/")}`;Bt=decodeURIComponent(Bt);const Nt=kt.id.includes(":")?`${Bt}/did.json`:`${Bt}/.well-known/did.json`;try{const jt=yield fetch(Nt);if(!jt.ok)throw new Error("HTTP error status code returned");const Lt=yield jt.json();return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didDocument:Lt})}catch{return Object.assign(Object.assign({},EMPTY_DID_RESOLUTION_RESULT),{didResolutionMetadata:{error:"notFound"}})}})}}DidWeb.methodName="web";var __awaiter=function(xt,e,At,kt){function Bt(Nt){return Nt instanceof At?Nt:new At(function(jt){jt(Nt)})}return new(At||(At=Promise))(function(Nt,jt){function Lt(zt){try{tr(kt.next(zt))}catch(rr){jt(rr)}}function er(zt){try{tr(kt.throw(zt))}catch(rr){jt(rr)}}function tr(zt){zt.done?Nt(zt.value):Bt(zt.value).then(Lt,er)}tr((kt=kt.apply(xt,e||[])).next())})};class Web5UserAgent{constructor(e){this._agentDid=e.agentDid,this.crypto=e.cryptoApi,this.did=e.didApi,this.dwn=e.dwnApi,this.identity=e.identityApi,this.keyManager=e.keyManager,this.permissions=e.permissionsApi,this.rpc=e.rpcClient,this.sync=e.syncApi,this.vault=e.agentVault,this.did.agent=this,this.dwn.agent=this,this.identity.agent=this,this.keyManager.agent=this,this.permissions.agent=this,this.sync.agent=this}get agentDid(){if(this._agentDid===void 0)throw new Error('Web5UserAgent: The "agentDid" property is not set. Ensure the agent is properly initialized and a DID is assigned.');return this._agentDid}set agentDid(e){this._agentDid=e}static create({dataPath:e="DATA/AGENT",agentDid:At,agentVault:kt,cryptoApi:Bt,didApi:Nt,dwnApi:jt,identityApi:Lt,keyManager:er,permissionsApi:tr,rpcClient:zt,syncApi:rr}={}){return __awaiter(this,void 0,void 0,function*(){return kt??(kt=new HdIdentityVault({keyDerivationWorkFactor:21e4,store:new LevelStore$1({location:`${e}/VAULT_STORE`})})),Bt??(Bt=new AgentCryptoApi),Nt??(Nt=new AgentDidApi({didMethods:[DidDht,DidJwk],resolverCache:new AgentDidResolverCache({location:`${e}/DID_RESOLVERCACHE`}),store:new DwnDidStore})),jt??(jt=new AgentDwnApi({dwn:yield AgentDwnApi.createDwn({dataPath:e,didResolver:Nt})})),Lt??(Lt=new AgentIdentityApi({store:new DwnIdentityStore})),er??(er=new LocalKeyManager$1({keyStore:new DwnKeyStore})),tr??(tr=new AgentPermissionsApi),zt??(zt=new Web5RpcClient),rr??(rr=new AgentSyncApi({syncEngine:new SyncEngineLevel({dataPath:e})})),new Web5UserAgent({agentDid:At,agentVault:kt,cryptoApi:Bt,didApi:Nt,dwnApi:jt,keyManager:er,permissionsApi:tr,identityApi:Lt,rpcClient:zt,syncApi:rr})})}firstLaunch(){return __awaiter(this,void 0,void 0,function*(){return(yield this.vault.isInitialized())===!1})}initialize({password:e,recoveryPhrase:At,dwnEndpoints:kt}){return __awaiter(this,void 0,void 0,function*(){return At=yield this.vault.initialize({password:e,recoveryPhrase:At,dwnEndpoints:kt}),At})}processDidRequest(e){return __awaiter(this,void 0,void 0,function*(){return this.did.processRequest(e)})}processDwnRequest(e){return __awaiter(this,void 0,void 0,function*(){return this.dwn.processRequest(e)})}processVcRequest(e){return __awaiter(this,void 0,void 0,function*(){throw new Error("Not implemented")})}sendDidRequest(e){return __awaiter(this,void 0,void 0,function*(){throw new Error("Not implemented")})}sendDwnRequest(e){return __awaiter(this,void 0,void 0,function*(){return this.dwn.sendRequest(e)})}sendVcRequest(e){return __awaiter(this,void 0,void 0,function*(){throw new Error("Not implemented")})}start({password:e}){return __awaiter(this,void 0,void 0,function*(){this.vault.isLocked()&&(yield this.vault.unlock({password:e})),this.agentDid=yield this.vault.getDid()})}}const tasksProtocolSchema="https://schema.org/TaskSample",tasksProtocolTypeTaskSchema="https://schema.org/TaskSample/schemas/name",tasksProtocolDefinition={published:!0,protocol:tasksProtocolSchema,types:{task:{dataFormats:["application/json"],schema:tasksProtocolTypeTaskSchema}},structure:{task:{$tags:{$requiredTags:["completed"],completed:{type:"boolean"}}}}},task={definition:tasksProtocolDefinition,uri:tasksProtocolSchema,schemas:{task:tasksProtocolTypeTaskSchema}},protocolSchema="https://schema.org/ProfileSample",protocolTypeNameSchema="https://schema.org/ProfileSample/schemas/name",profileDefinition={published:!0,protocol:protocolSchema,types:{name:{dataFormats:["application/json"],schema:protocolTypeNameSchema},avatar:{dataFormats:["image/gif","image/png","image/jpeg"]}},structure:{name:{},avatar:{}}},profile={definition:profileDefinition,uri:protocolSchema,schemas:{name:protocolTypeNameSchema}},byUri={[profileDefinition.protocol]:profile,[tasksProtocolDefinition.protocol]:task},installProtocols=async(xt,e)=>{const At=await xt.protocols.query({message:{}}),kt=[];console.info(JSON.stringify(profileDefinition),{profile});try{for(const Nt in byUri)if(At.protocols.find(Lt=>Nt===Lt.definition.protocol))console.info("protocol already installed: "+Nt);else{console.info("installing protocol: "+Nt);const Lt=byUri[Nt].definition;kt.push(xt.protocols.configure({message:{definition:Lt}}))}const Bt=await Promise.all(kt);try{await Promise.all(Bt.map(({protocol:Nt})=>Nt==null?void 0:Nt.send(e)))}catch(Nt){return console.log("remote push of configuration failed",Nt),!0}}catch(Bt){return console.log("local install of configuration failed",Bt),!1}return!0},Web5Context=reactExports.createContext({previouslyConnected:!1,isConnecting:!1,protocolsInitialized:!1}),Web5Provider=({children:xt})=>{const[e,At]=reactExports.useState(!1),[kt,Bt]=reactExports.useState(!1),[Nt,jt]=reactExports.useState(!1),[Lt,er]=reactExports.useState(void 0);reactExports.useEffect(()=>{const nr=localStorage.getItem("previouslyConnected");nr&&At(nr==="true"),window.addEventListener("storage",ir=>{ir.key==="previouslyConnected"&&At(ir.newValue==="true")})},[At]),reactExports.useEffect(()=>{Lt&&!kt&&installProtocols(Lt.web5.dwn,Lt.did).then(nr=>{Bt(nr)})},[Lt,kt]);const tr=async(nr,ir,ar)=>{jt(!0);const dr=await Web5UserAgent.create();await dr.firstLaunch()&&await dr.initialize({password:"insecure-static-phrase",dwnEndpoints:["https://dwn.tbddev.org/latest"]}),await dr.start({password:"insecure-static-phrase"});const ur=await dr.identity.import({portableIdentity:{portableDid:ir,metadata:{connectedDid:nr,name:"Default",tenant:ir.uri,uri:ir.uri}}});await dr.identity.manage({portableIdentity:await ur.export()});const fr=await Web5.processConnectedGrants({agent:dr,delegateDid:ir.uri,grants:ar});await dr.sync.registerIdentity({did:nr,options:{protocols:fr,delegateDid:ir.uri}}),await dr.sync.sync("pull");const lr={web5:new Web5({agent:dr,connectedDid:nr,delegateDid:ir.uri}),did:nr};return localStorage.setItem("previouslyConnected","true"),er(lr),jt(!1),lr},zt=async nr=>{const ir=await Web5.connect({walletConnectOptions:nr,sync:"15s"});return window.web5=ir,localStorage.setItem("previouslyConnected","true"),er(ir),jt(!1),ir},rr=async()=>{jt(!0);try{const nr={techPreview:{dwnEndpoints:["http://localhost:3000"]},sync:"15s"},ir=await Web5.connect(nr);return window.web5=ir,localStorage.setItem("previouslyConnected","true"),er(ir),jt(!1),ir}catch(nr){throw jt(!1),nr}};return jsxRuntimeExports.jsx(Web5Context.Provider,{value:{previouslyConnected:e,protocolsInitialized:kt,walletConnect:zt,processDelegateIdentity:tr,connect:rr,web5Connection:Lt,isConnecting:Nt},children:xt})},useWeb5=()=>{const xt=reactExports.useContext(Web5Context);if(!xt)throw new Error("useWeb5 must be used within a Web5Provider");const{web5Connection:e,isConnecting:At,connect:kt,previouslyConnected:Bt,walletConnect:Nt,processDelegateIdentity:jt}=xt,Lt=e!==void 0;return{web5Connection:e,isConnecting:At,connect:kt,dwn:e==null?void 0:e.web5.dwn,did:e==null?void 0:e.did,isConnected:Lt,previouslyConnected:Bt,walletConnect:Nt,processDelegateIdentity:jt}},typographyVariants=cva("",{variants:{variant:{h1:"scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl",h2:"scroll-m-20 border-b pb-2 text-3xl font-semibold tracking-tight first:mt-0",h3:"scroll-m-20 text-2xl font-semibold tracking-tight",h4:"scroll-m-20 text-xl font-semibold tracking-tight",p:"leading-7 [&:not(:first-child)]:mt-6",blockquote:"mt-6 border-l-2 pl-6 italic",table:"w-full [&_td]:border [&_td]:px-4 [&_td]:py-2 [&_td]:text-left [&_td]:[&[align=center]]:text-center [&_td]:[&[align=right]]:text-right [&_th]:border [&_th]:px-4 [&_th]:py-2 [&_th]:text-left [&_th]:font-bold [&_th]:[&[align=center]]:text-center [&_th]:[&[align=right]]:text-right [&_tr]:m-0 [&_tr]:border-t [&_tr]:p-0 even:[&_tr]:bg-muted",list:"my-6 ml-6 list-disc [&>li]:mt-2",code:"relative rounded bg-muted px-[0.3rem] py-[0.2rem] font-mono text-sm font-semibold",lead:"text-xl text-muted-foreground",large:"text-lg font-semibold",small:"text-sm font-medium leading-none",muted:"text-sm text-muted-foreground",anchor:"font-medium text-primary underline underline-offset-4"}}}),variantToTag={h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",blockquote:"blockquote",table:"table",list:"ul",code:"code",lead:"p",large:"div",small:"p",muted:"p",anchor:"a"},Typography=React.forwardRef(({variant:xt="p",children:e,className:At,as:kt=void 0,asChild:Bt=!1,disableSelect:Nt=!1,...jt},Lt)=>{const er=Bt?Slot:kt??variantToTag[xt];return jsxRuntimeExports.jsx(er,{className:cn(typographyVariants({variant:xt,className:At}),Nt?"select-none":""),ref:Lt,...jt,children:e})});Typography.displayName="Typography";const Input=reactExports.forwardRef(({className:xt,type:e,...At},kt)=>jsxRuntimeExports.jsx("input",{type:e,className:cn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",xt),ref:kt,...At}));Input.displayName="Input";var __defProp=Object.defineProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(xt,e,At)=>e in xt?__defProp(xt,e,{enumerable:!0,configurable:!0,writable:!0,value:At}):xt[e]=At,__spreadValues=(xt,e)=>{for(var At in e||(e={}))__hasOwnProp.call(e,At)&&__defNormalProp(xt,At,e[At]);if(__getOwnPropSymbols)for(var At of __getOwnPropSymbols(e))__propIsEnum.call(e,At)&&__defNormalProp(xt,At,e[At]);return xt},__objRest=(xt,e)=>{var At={};for(var kt in xt)__hasOwnProp.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&__getOwnPropSymbols)for(var kt of __getOwnPropSymbols(xt))e.indexOf(kt)<0&&__propIsEnum.call(xt,kt)&&(At[kt]=xt[kt]);return At};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var qrcodegen;(xt=>{const e=class _i{constructor(er,tr,zt,rr){if(this.version=er,this.errorCorrectionLevel=tr,this.modules=[],this.isFunction=[],er<_i.MIN_VERSION||er>_i.MAX_VERSION)throw new RangeError("Version value out of range");if(rr<-1||rr>7)throw new RangeError("Mask value out of range");this.size=er*4+17;let nr=[];for(let ar=0;ar<this.size;ar++)nr.push(!1);for(let ar=0;ar<this.size;ar++)this.modules.push(nr.slice()),this.isFunction.push(nr.slice());this.drawFunctionPatterns();const ir=this.addEccAndInterleave(zt);if(this.drawCodewords(ir),rr==-1){let ar=1e9;for(let dr=0;dr<8;dr++){this.applyMask(dr),this.drawFormatBits(dr);const ur=this.getPenaltyScore();ur<ar&&(rr=dr,ar=ur),this.applyMask(dr)}}Bt(0<=rr&&rr<=7),this.mask=rr,this.applyMask(rr),this.drawFormatBits(rr),this.isFunction=[]}static encodeText(er,tr){const zt=xt.QrSegment.makeSegments(er);return _i.encodeSegments(zt,tr)}static encodeBinary(er,tr){const zt=xt.QrSegment.makeBytes(er);return _i.encodeSegments([zt],tr)}static encodeSegments(er,tr,zt=1,rr=40,nr=-1,ir=!0){if(!(_i.MIN_VERSION<=zt&&zt<=rr&&rr<=_i.MAX_VERSION)||nr<-1||nr>7)throw new RangeError("Invalid value");let ar,dr;for(ar=zt;;ar++){const lr=_i.getNumDataCodewords(ar,tr)*8,yr=jt.getTotalBits(er,ar);if(yr<=lr){dr=yr;break}if(ar>=rr)throw new RangeError("Data too long")}for(const lr of[_i.Ecc.MEDIUM,_i.Ecc.QUARTILE,_i.Ecc.HIGH])ir&&dr<=_i.getNumDataCodewords(ar,lr)*8&&(tr=lr);let ur=[];for(const lr of er){At(lr.mode.modeBits,4,ur),At(lr.numChars,lr.mode.numCharCountBits(ar),ur);for(const yr of lr.getData())ur.push(yr)}Bt(ur.length==dr);const fr=_i.getNumDataCodewords(ar,tr)*8;Bt(ur.length<=fr),At(0,Math.min(4,fr-ur.length),ur),At(0,(8-ur.length%8)%8,ur),Bt(ur.length%8==0);for(let lr=236;ur.length<fr;lr^=253)At(lr,8,ur);let pr=[];for(;pr.length*8<ur.length;)pr.push(0);return ur.forEach((lr,yr)=>pr[yr>>>3]|=lr<<7-(yr&7)),new _i(ar,tr,pr,nr)}getModule(er,tr){return 0<=er&&er<this.size&&0<=tr&&tr<this.size&&this.modules[tr][er]}getModules(){return this.modules}drawFunctionPatterns(){for(let zt=0;zt<this.size;zt++)this.setFunctionModule(6,zt,zt%2==0),this.setFunctionModule(zt,6,zt%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const er=this.getAlignmentPatternPositions(),tr=er.length;for(let zt=0;zt<tr;zt++)for(let rr=0;rr<tr;rr++)zt==0&&rr==0||zt==0&&rr==tr-1||zt==tr-1&&rr==0||this.drawAlignmentPattern(er[zt],er[rr]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(er){const tr=this.errorCorrectionLevel.formatBits<<3|er;let zt=tr;for(let nr=0;nr<10;nr++)zt=zt<<1^(zt>>>9)*1335;const rr=(tr<<10|zt)^21522;Bt(rr>>>15==0);for(let nr=0;nr<=5;nr++)this.setFunctionModule(8,nr,kt(rr,nr));this.setFunctionModule(8,7,kt(rr,6)),this.setFunctionModule(8,8,kt(rr,7)),this.setFunctionModule(7,8,kt(rr,8));for(let nr=9;nr<15;nr++)this.setFunctionModule(14-nr,8,kt(rr,nr));for(let nr=0;nr<8;nr++)this.setFunctionModule(this.size-1-nr,8,kt(rr,nr));for(let nr=8;nr<15;nr++)this.setFunctionModule(8,this.size-15+nr,kt(rr,nr));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let er=this.version;for(let zt=0;zt<12;zt++)er=er<<1^(er>>>11)*7973;const tr=this.version<<12|er;Bt(tr>>>18==0);for(let zt=0;zt<18;zt++){const rr=kt(tr,zt),nr=this.size-11+zt%3,ir=Math.floor(zt/3);this.setFunctionModule(nr,ir,rr),this.setFunctionModule(ir,nr,rr)}}drawFinderPattern(er,tr){for(let zt=-4;zt<=4;zt++)for(let rr=-4;rr<=4;rr++){const nr=Math.max(Math.abs(rr),Math.abs(zt)),ir=er+rr,ar=tr+zt;0<=ir&&ir<this.size&&0<=ar&&ar<this.size&&this.setFunctionModule(ir,ar,nr!=2&&nr!=4)}}drawAlignmentPattern(er,tr){for(let zt=-2;zt<=2;zt++)for(let rr=-2;rr<=2;rr++)this.setFunctionModule(er+rr,tr+zt,Math.max(Math.abs(rr),Math.abs(zt))!=1)}setFunctionModule(er,tr,zt){this.modules[tr][er]=zt,this.isFunction[tr][er]=!0}addEccAndInterleave(er){const tr=this.version,zt=this.errorCorrectionLevel;if(er.length!=_i.getNumDataCodewords(tr,zt))throw new RangeError("Invalid argument");const rr=_i.NUM_ERROR_CORRECTION_BLOCKS[zt.ordinal][tr],nr=_i.ECC_CODEWORDS_PER_BLOCK[zt.ordinal][tr],ir=Math.floor(_i.getNumRawDataModules(tr)/8),ar=rr-ir%rr,dr=Math.floor(ir/rr);let ur=[];const fr=_i.reedSolomonComputeDivisor(nr);for(let lr=0,yr=0;lr<rr;lr++){let br=er.slice(yr,yr+dr-nr+(lr<ar?0:1));yr+=br.length;const Ar=_i.reedSolomonComputeRemainder(br,fr);lr<ar&&br.push(0),ur.push(br.concat(Ar))}let pr=[];for(let lr=0;lr<ur[0].length;lr++)ur.forEach((yr,br)=>{(lr!=dr-nr||br>=ar)&&pr.push(yr[lr])});return Bt(pr.length==ir),pr}drawCodewords(er){if(er.length!=Math.floor(_i.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let tr=0;for(let zt=this.size-1;zt>=1;zt-=2){zt==6&&(zt=5);for(let rr=0;rr<this.size;rr++)for(let nr=0;nr<2;nr++){const ir=zt-nr,dr=(zt+1&2)==0?this.size-1-rr:rr;!this.isFunction[dr][ir]&&tr<er.length*8&&(this.modules[dr][ir]=kt(er[tr>>>3],7-(tr&7)),tr++)}}Bt(tr==er.length*8)}applyMask(er){if(er<0||er>7)throw new RangeError("Mask value out of range");for(let tr=0;tr<this.size;tr++)for(let zt=0;zt<this.size;zt++){let rr;switch(er){case 0:rr=(zt+tr)%2==0;break;case 1:rr=tr%2==0;break;case 2:rr=zt%3==0;break;case 3:rr=(zt+tr)%3==0;break;case 4:rr=(Math.floor(zt/3)+Math.floor(tr/2))%2==0;break;case 5:rr=zt*tr%2+zt*tr%3==0;break;case 6:rr=(zt*tr%2+zt*tr%3)%2==0;break;case 7:rr=((zt+tr)%2+zt*tr%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[tr][zt]&&rr&&(this.modules[tr][zt]=!this.modules[tr][zt])}}getPenaltyScore(){let er=0;for(let nr=0;nr<this.size;nr++){let ir=!1,ar=0,dr=[0,0,0,0,0,0,0];for(let ur=0;ur<this.size;ur++)this.modules[nr][ur]==ir?(ar++,ar==5?er+=_i.PENALTY_N1:ar>5&&er++):(this.finderPenaltyAddHistory(ar,dr),ir||(er+=this.finderPenaltyCountPatterns(dr)*_i.PENALTY_N3),ir=this.modules[nr][ur],ar=1);er+=this.finderPenaltyTerminateAndCount(ir,ar,dr)*_i.PENALTY_N3}for(let nr=0;nr<this.size;nr++){let ir=!1,ar=0,dr=[0,0,0,0,0,0,0];for(let ur=0;ur<this.size;ur++)this.modules[ur][nr]==ir?(ar++,ar==5?er+=_i.PENALTY_N1:ar>5&&er++):(this.finderPenaltyAddHistory(ar,dr),ir||(er+=this.finderPenaltyCountPatterns(dr)*_i.PENALTY_N3),ir=this.modules[ur][nr],ar=1);er+=this.finderPenaltyTerminateAndCount(ir,ar,dr)*_i.PENALTY_N3}for(let nr=0;nr<this.size-1;nr++)for(let ir=0;ir<this.size-1;ir++){const ar=this.modules[nr][ir];ar==this.modules[nr][ir+1]&&ar==this.modules[nr+1][ir]&&ar==this.modules[nr+1][ir+1]&&(er+=_i.PENALTY_N2)}let tr=0;for(const nr of this.modules)tr=nr.reduce((ir,ar)=>ir+(ar?1:0),tr);const zt=this.size*this.size,rr=Math.ceil(Math.abs(tr*20-zt*10)/zt)-1;return Bt(0<=rr&&rr<=9),er+=rr*_i.PENALTY_N4,Bt(0<=er&&er<=2568888),er}getAlignmentPatternPositions(){if(this.version==1)return[];{const er=Math.floor(this.version/7)+2,tr=this.version==32?26:Math.ceil((this.version*4+4)/(er*2-2))*2;let zt=[6];for(let rr=this.size-7;zt.length<er;rr-=tr)zt.splice(1,0,rr);return zt}}static getNumRawDataModules(er){if(er<_i.MIN_VERSION||er>_i.MAX_VERSION)throw new RangeError("Version number out of range");let tr=(16*er+128)*er+64;if(er>=2){const zt=Math.floor(er/7)+2;tr-=(25*zt-10)*zt-55,er>=7&&(tr-=36)}return Bt(208<=tr&&tr<=29648),tr}static getNumDataCodewords(er,tr){return Math.floor(_i.getNumRawDataModules(er)/8)-_i.ECC_CODEWORDS_PER_BLOCK[tr.ordinal][er]*_i.NUM_ERROR_CORRECTION_BLOCKS[tr.ordinal][er]}static reedSolomonComputeDivisor(er){if(er<1||er>255)throw new RangeError("Degree out of range");let tr=[];for(let rr=0;rr<er-1;rr++)tr.push(0);tr.push(1);let zt=1;for(let rr=0;rr<er;rr++){for(let nr=0;nr<tr.length;nr++)tr[nr]=_i.reedSolomonMultiply(tr[nr],zt),nr+1<tr.length&&(tr[nr]^=tr[nr+1]);zt=_i.reedSolomonMultiply(zt,2)}return tr}static reedSolomonComputeRemainder(er,tr){let zt=tr.map(rr=>0);for(const rr of er){const nr=rr^zt.shift();zt.push(0),tr.forEach((ir,ar)=>zt[ar]^=_i.reedSolomonMultiply(ir,nr))}return zt}static reedSolomonMultiply(er,tr){if(er>>>8||tr>>>8)throw new RangeError("Byte out of range");let zt=0;for(let rr=7;rr>=0;rr--)zt=zt<<1^(zt>>>7)*285,zt^=(tr>>>rr&1)*er;return Bt(zt>>>8==0),zt}finderPenaltyCountPatterns(er){const tr=er[1];Bt(tr<=this.size*3);const zt=tr>0&&er[2]==tr&&er[3]==tr*3&&er[4]==tr&&er[5]==tr;return(zt&&er[0]>=tr*4&&er[6]>=tr?1:0)+(zt&&er[6]>=tr*4&&er[0]>=tr?1:0)}finderPenaltyTerminateAndCount(er,tr,zt){return er&&(this.finderPenaltyAddHistory(tr,zt),tr=0),tr+=this.size,this.finderPenaltyAddHistory(tr,zt),this.finderPenaltyCountPatterns(zt)}finderPenaltyAddHistory(er,tr){tr[0]==0&&(er+=this.size),tr.pop(),tr.unshift(er)}};e.MIN_VERSION=1,e.MAX_VERSION=40,e.PENALTY_N1=3,e.PENALTY_N2=3,e.PENALTY_N3=40,e.PENALTY_N4=10,e.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],e.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],xt.QrCode=e;function At(Lt,er,tr){if(er<0||er>31||Lt>>>er)throw new RangeError("Value out of range");for(let zt=er-1;zt>=0;zt--)tr.push(Lt>>>zt&1)}function kt(Lt,er){return(Lt>>>er&1)!=0}function Bt(Lt){if(!Lt)throw new Error("Assertion error")}const Nt=class lo{constructor(er,tr,zt){if(this.mode=er,this.numChars=tr,this.bitData=zt,tr<0)throw new RangeError("Invalid argument");this.bitData=zt.slice()}static makeBytes(er){let tr=[];for(const zt of er)At(zt,8,tr);return new lo(lo.Mode.BYTE,er.length,tr)}static makeNumeric(er){if(!lo.isNumeric(er))throw new RangeError("String contains non-numeric characters");let tr=[];for(let zt=0;zt<er.length;){const rr=Math.min(er.length-zt,3);At(parseInt(er.substring(zt,zt+rr),10),rr*3+1,tr),zt+=rr}return new lo(lo.Mode.NUMERIC,er.length,tr)}static makeAlphanumeric(er){if(!lo.isAlphanumeric(er))throw new RangeError("String contains unencodable characters in alphanumeric mode");let tr=[],zt;for(zt=0;zt+2<=er.length;zt+=2){let rr=lo.ALPHANUMERIC_CHARSET.indexOf(er.charAt(zt))*45;rr+=lo.ALPHANUMERIC_CHARSET.indexOf(er.charAt(zt+1)),At(rr,11,tr)}return zt<er.length&&At(lo.ALPHANUMERIC_CHARSET.indexOf(er.charAt(zt)),6,tr),new lo(lo.Mode.ALPHANUMERIC,er.length,tr)}static makeSegments(er){return er==""?[]:lo.isNumeric(er)?[lo.makeNumeric(er)]:lo.isAlphanumeric(er)?[lo.makeAlphanumeric(er)]:[lo.makeBytes(lo.toUtf8ByteArray(er))]}static makeEci(er){let tr=[];if(er<0)throw new RangeError("ECI assignment value out of range");if(er<128)At(er,8,tr);else if(er<16384)At(2,2,tr),At(er,14,tr);else if(er<1e6)At(6,3,tr),At(er,21,tr);else throw new RangeError("ECI assignment value out of range");return new lo(lo.Mode.ECI,0,tr)}static isNumeric(er){return lo.NUMERIC_REGEX.test(er)}static isAlphanumeric(er){return lo.ALPHANUMERIC_REGEX.test(er)}getData(){return this.bitData.slice()}static getTotalBits(er,tr){let zt=0;for(const rr of er){const nr=rr.mode.numCharCountBits(tr);if(rr.numChars>=1<<nr)return 1/0;zt+=4+nr+rr.bitData.length}return zt}static toUtf8ByteArray(er){er=encodeURI(er);let tr=[];for(let zt=0;zt<er.length;zt++)er.charAt(zt)!="%"?tr.push(er.charCodeAt(zt)):(tr.push(parseInt(er.substring(zt+1,zt+3),16)),zt+=2);return tr}};Nt.NUMERIC_REGEX=/^[0-9]*$/,Nt.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,Nt.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let jt=Nt;xt.QrSegment=Nt})(qrcodegen||(qrcodegen={}));(xt=>{(e=>{const At=class{constructor(Bt,Nt){this.ordinal=Bt,this.formatBits=Nt}};At.LOW=new At(0,1),At.MEDIUM=new At(1,0),At.QUARTILE=new At(2,3),At.HIGH=new At(3,2),e.Ecc=At})(xt.QrCode||(xt.QrCode={}))})(qrcodegen||(qrcodegen={}));(xt=>{(e=>{const At=class{constructor(Bt,Nt){this.modeBits=Bt,this.numBitsCharCount=Nt}numCharCountBits(Bt){return this.numBitsCharCount[Math.floor((Bt+7)/17)]}};At.NUMERIC=new At(1,[10,12,14]),At.ALPHANUMERIC=new At(2,[9,11,13]),At.BYTE=new At(4,[8,16,16]),At.KANJI=new At(8,[8,10,12]),At.ECI=new At(7,[0,0,0]),e.Mode=At})(xt.QrSegment||(xt.QrSegment={}))})(qrcodegen||(qrcodegen={}));var qrcodegen_default=qrcodegen;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var ERROR_LEVEL_MAP={L:qrcodegen_default.QrCode.Ecc.LOW,M:qrcodegen_default.QrCode.Ecc.MEDIUM,Q:qrcodegen_default.QrCode.Ecc.QUARTILE,H:qrcodegen_default.QrCode.Ecc.HIGH},DEFAULT_SIZE=128,DEFAULT_LEVEL="L",DEFAULT_BGCOLOR="#FFFFFF",DEFAULT_FGCOLOR="#000000",DEFAULT_INCLUDEMARGIN=!1,DEFAULT_MINVERSION=1,SPEC_MARGIN_SIZE=4,DEFAULT_MARGIN_SIZE=0,DEFAULT_IMG_SCALE=.1;function generatePath(xt,e=0){const At=[];return xt.forEach(function(kt,Bt){let Nt=null;kt.forEach(function(jt,Lt){if(!jt&&Nt!==null){At.push(`M${Nt+e} ${Bt+e}h${Lt-Nt}v1H${Nt+e}z`),Nt=null;return}if(Lt===kt.length-1){if(!jt)return;Nt===null?At.push(`M${Lt+e},${Bt+e} h1v1H${Lt+e}z`):At.push(`M${Nt+e},${Bt+e} h${Lt+1-Nt}v1H${Nt+e}z`);return}jt&&Nt===null&&(Nt=Lt)})}),At.join("")}function excavateModules(xt,e){return xt.slice().map((At,kt)=>kt<e.y||kt>=e.y+e.h?At:At.map((Bt,Nt)=>Nt<e.x||Nt>=e.x+e.w?Bt:!1))}function getImageSettings(xt,e,At,kt){if(kt==null)return null;const Bt=xt.length+At*2,Nt=Math.floor(e*DEFAULT_IMG_SCALE),jt=Bt/e,Lt=(kt.width||Nt)*jt,er=(kt.height||Nt)*jt,tr=kt.x==null?xt.length/2-Lt/2:kt.x*jt,zt=kt.y==null?xt.length/2-er/2:kt.y*jt,rr=kt.opacity==null?1:kt.opacity;let nr=null;if(kt.excavate){let ar=Math.floor(tr),dr=Math.floor(zt),ur=Math.ceil(Lt+tr-ar),fr=Math.ceil(er+zt-dr);nr={x:ar,y:dr,w:ur,h:fr}}const ir=kt.crossOrigin;return{x:tr,y:zt,h:er,w:Lt,excavation:nr,opacity:rr,crossOrigin:ir}}function getMarginSize(xt,e){return e!=null?Math.max(Math.floor(e),0):xt?SPEC_MARGIN_SIZE:DEFAULT_MARGIN_SIZE}function useQRCode({value:xt,level:e,minVersion:At,includeMargin:kt,marginSize:Bt,imageSettings:Nt,size:jt}){let Lt=React.useMemo(()=>{const nr=qrcodegen_default.QrSegment.makeSegments(xt);return qrcodegen_default.QrCode.encodeSegments(nr,ERROR_LEVEL_MAP[e],At)},[xt,e,At]);const{cells:er,margin:tr,numCells:zt,calculatedImageSettings:rr}=React.useMemo(()=>{let nr=Lt.getModules();const ir=getMarginSize(kt,Bt),ar=nr.length+ir*2,dr=getImageSettings(nr,jt,ir,Nt);return{cells:nr,margin:ir,numCells:ar,calculatedImageSettings:dr}},[Lt,jt,Nt,kt,Bt]);return{qrcode:Lt,margin:tr,cells:er,numCells:zt,calculatedImageSettings:rr}}var SUPPORTS_PATH2D=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),QRCodeCanvas=React.forwardRef(function xt(e,At){const kt=e,{value:Bt,size:Nt=DEFAULT_SIZE,level:jt=DEFAULT_LEVEL,bgColor:Lt=DEFAULT_BGCOLOR,fgColor:er=DEFAULT_FGCOLOR,includeMargin:tr=DEFAULT_INCLUDEMARGIN,minVersion:zt=DEFAULT_MINVERSION,marginSize:rr,imageSettings:nr}=kt,ar=__objRest(kt,["value","size","level","bgColor","fgColor","includeMargin","minVersion","marginSize","imageSettings"]),{style:dr}=ar,ur=__objRest(ar,["style"]),fr=nr==null?void 0:nr.src,pr=React.useRef(null),lr=React.useRef(null),yr=React.useCallback(_r=>{pr.current=_r,typeof At=="function"?At(_r):At&&(At.current=_r)},[At]),[br,Ar]=React.useState(!1),{margin:Pr,cells:kr,numCells:Ur,calculatedImageSettings:Hr}=useQRCode({value:Bt,level:jt,minVersion:zt,includeMargin:tr,marginSize:rr,imageSettings:nr,size:Nt});React.useEffect(()=>{if(pr.current!=null){const _r=pr.current,gr=_r.getContext("2d");if(!gr)return;let wr=kr;const Dr=lr.current,xr=Hr!=null&&Dr!==null&&Dr.complete&&Dr.naturalHeight!==0&&Dr.naturalWidth!==0;xr&&Hr.excavation!=null&&(wr=excavateModules(kr,Hr.excavation));const Ir=window.devicePixelRatio||1;_r.height=_r.width=Nt*Ir;const $r=Nt/Ur*Ir;gr.scale($r,$r),gr.fillStyle=Lt,gr.fillRect(0,0,Ur,Ur),gr.fillStyle=er,SUPPORTS_PATH2D?gr.fill(new Path2D(generatePath(wr,Pr))):kr.forEach(function(vr,Er){vr.forEach(function(Tr,Rr){Tr&&gr.fillRect(Rr+Pr,Er+Pr,1,1)})}),Hr&&(gr.globalAlpha=Hr.opacity),xr&&gr.drawImage(Dr,Hr.x+Pr,Hr.y+Pr,Hr.w,Hr.h)}}),React.useEffect(()=>{Ar(!1)},[fr]);const Lr=__spreadValues({height:Nt,width:Nt},dr);let Sr=null;return fr!=null&&(Sr=React.createElement("img",{src:fr,key:fr,style:{display:"none"},onLoad:()=>{Ar(!0)},ref:lr,crossOrigin:Hr==null?void 0:Hr.crossOrigin})),React.createElement(React.Fragment,null,React.createElement("canvas",__spreadValues({style:Lr,height:Nt,width:Nt,ref:yr,role:"img"},ur)),Sr)});QRCodeCanvas.displayName="QRCodeCanvas";var QRCodeSVG=React.forwardRef(function xt(e,At){const kt=e,{value:Bt,size:Nt=DEFAULT_SIZE,level:jt=DEFAULT_LEVEL,bgColor:Lt=DEFAULT_BGCOLOR,fgColor:er=DEFAULT_FGCOLOR,includeMargin:tr=DEFAULT_INCLUDEMARGIN,minVersion:zt=DEFAULT_MINVERSION,title:rr,marginSize:nr,imageSettings:ir}=kt,ar=__objRest(kt,["value","size","level","bgColor","fgColor","includeMargin","minVersion","title","marginSize","imageSettings"]),{margin:dr,cells:ur,numCells:fr,calculatedImageSettings:pr}=useQRCode({value:Bt,level:jt,minVersion:zt,includeMargin:tr,marginSize:nr,imageSettings:ir,size:Nt});let lr=ur,yr=null;ir!=null&&pr!=null&&(pr.excavation!=null&&(lr=excavateModules(ur,pr.excavation)),yr=React.createElement("image",{href:ir.src,height:pr.h,width:pr.w,x:pr.x+dr,y:pr.y+dr,preserveAspectRatio:"none",opacity:pr.opacity,crossOrigin:pr.crossOrigin}));const br=generatePath(lr,dr);return React.createElement("svg",__spreadValues({height:Nt,width:Nt,viewBox:`0 0 ${fr} ${fr}`,ref:At,role:"img"},ar),!!rr&&React.createElement("title",null,rr),React.createElement("path",{fill:Lt,d:`M0,0 h${fr}v${fr}H0z`,shapeRendering:"crispEdges"}),React.createElement("path",{fill:er,d:br,shapeRendering:"crispEdges"}),yr)});QRCodeSVG.displayName="QRCodeSVG";const ConnectQR=({close:xt,value:e})=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("a",{href:e,children:[jsxRuntimeExports.jsx(Typography,{variant:"h3",children:"Scan QR Code"}),jsxRuntimeExports.jsx(QRCodeCanvas,{value:e,size:256,className:"mt-4 p-2 bg-primary",bgColor:"rgb(250,204, 21)",fgColor:"rgb(41,37,36)"})]}),jsxRuntimeExports.jsx("div",{className:"mt-4",children:jsxRuntimeExports.jsxs(Button,{onClick:()=>xt(),children:["Cancel ",jsxRuntimeExports.jsx(X$1,{className:"ml-2 h-4 w-4"})]})})]}),ConnectPin=({onChange:xt,value:e,close:At,submit:kt})=>{const Bt=()=>{e.length!==0&&kt(e)};return jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Typography,{variant:"p",children:"Please enter the PIN on your wallet"}),jsxRuntimeExports.jsx("div",{className:"mt-2",children:jsxRuntimeExports.jsx(Input,{value:e,readOnly:!0,className:"w-full p-2 border rounded text-center text-lg",placeholder:"Enter PIN"})}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[[1,2,3,4,5,6,7,8,9].map(Nt=>jsxRuntimeExports.jsx("button",{className:"p-2 border-1 rounded text-primary flex justify-center items-center",onClick:()=>xt(e+Nt.toString()),children:Nt},Nt)),jsxRuntimeExports.jsx("button",{className:"p-2 border-1 rounded text-primary flex justify-center items-center",onClick:()=>xt(""),children:jsxRuntimeExports.jsx(Trash2,{className:"h-6 w-6"})}),jsxRuntimeExports.jsx("button",{className:"p-2 border-1 rounded text-primary flex justify-center items-center",onClick:()=>xt(e+"0"),children:"0"}),jsxRuntimeExports.jsx("button",{className:"p-2 border-1 rounded text-primary flex justify-center items-center",onClick:()=>xt(e.slice(0,-1)),children:jsxRuntimeExports.jsx(Delete,{className:"h-6 w-6"})}),e.length>0&&jsxRuntimeExports.jsx("button",{className:"p-2 border rounded col-span-3 mt-2 bg-primary text-secondary hover:bg-primary-dark",onClick:Bt,children:"Submit"})||jsxRuntimeExports.jsx("button",{className:"p-2 border rounded col-span-3 mt-2 bg-primary text-secondary hover:bg-primary-dark",onClick:()=>At(),children:"Cancel"})]})]})},popupContent=`
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connecting...</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: Arial, sans-serif;
      text-align: center;
      background: #000;
      color: #fff;
    }
    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .text {
      font-size: 16px;
      color: #333;
    }
    .spinner {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
      font-size: 2em;
    }
      .spinner div {
        position: relative;
        width: 2em;
        height: 2em;
        margin: 0.1em 0.25em 0 0;
      }
      .spinner div::after,
      .spinner div::before {
        content: '';  
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 0.1em solid #FFF;
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        animation: spinner 2s linear infinite;
      }
      .spinner div::after {
        animation-delay: 1s;
      }
    @keyframes spinner {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(1);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="spinner">
      <div></div>
    </div>
    <div id="message">Locating wallets...</div>
  </div>
</body>
</html>
`,ConnectSelector=({close:xt})=>{const{connect:e,walletConnect:At}=useWeb5(),[kt,Bt]=reactExports.useState("loading"),[Nt,jt]=reactExports.useState(""),[Lt,er]=reactExports.useState("");reactExports.useEffect(()=>{Nt.length>0&&Bt("showQR")},[Nt]),reactExports.useEffect(()=>{kt==="done"&&setTimeout(xt,500)},[kt,xt]),reactExports.useEffect(()=>{e!==void 0&&At!==void 0&&Bt("init")},[e,At]);const tr=async()=>{if(e){Bt("loading");try{await e()}catch(rr){toastError("Error creating new DID",rr)}finally{xt()}}},zt=()=>{Lt.length!==0&&(Bt("loading"),postMessage({type:"pinSubmitted",pin:Lt},window.parent.origin))};return jsxRuntimeExports.jsxs("div",{className:"bg-secondary text-primary  p-6 rounded-lg",children:[kt==="loading"&&jsxRuntimeExports.jsx(LoaderCircle,{className:"animate-spin h-12 w-12 text-primary"}),kt==="init"&&jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"flex justify-between items-center mb-4",children:jsxRuntimeExports.jsx(Typography,{variant:"h3",children:"Connect to a Wallet"})}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col space-y-4",children:[jsxRuntimeExports.jsxs(Button,{onClick:()=>tr(),children:["Create A New DID ",jsxRuntimeExports.jsx(UserRound,{className:"ml-2 h-4 w-4"})]}),jsxRuntimeExports.jsxs(Button,{onClick:()=>Bt("wallet"),children:["Connect To a Wallet ",jsxRuntimeExports.jsx(WalletMinimal,{className:"ml-2 h-4 w-4"})]}),jsxRuntimeExports.jsxs(Button,{onClick:()=>xt(),children:["Cancel",jsxRuntimeExports.jsx(X$1,{className:"ml-2 h-4 w-4"})]})]})]}),kt==="wallet"&&jsxRuntimeExports.jsx(WalletSelector,{walletConnect:At,setQrCodeText:jt,setState:Bt}),kt==="showQR"&&jsxRuntimeExports.jsx(ConnectQR,{value:Nt,close:xt}),kt==="showPin"&&jsxRuntimeExports.jsx(ConnectPin,{value:Lt,onChange:er,close:xt,submit:zt}),kt==="done"&&jsxRuntimeExports.jsx("div",{children:"Done"})]})},WalletSelector=({setQrCodeText:xt,walletConnect:e,setState:At})=>{const{processDelegateIdentity:kt}=useWeb5(),[Bt,Nt]=reactExports.useState(!1),[jt,Lt]=reactExports.useState(!1),[er,tr]=reactExports.useState(""),[zt,rr]=reactExports.useState(null),[nr,ir]=reactExports.useState(""),[ar,dr]=reactExports.useState([]),ur=async()=>{At("loading");try{await e({connectServerUrl:"https://dwn.tbddev.org/latest/connect",walletUri:"web5://connect",permissionRequests:[{protocolDefinition:profileDefinition},{protocolDefinition:tasksProtocolDefinition}],onWalletUriReady:yr=>{xt(yr)},validatePin:async()=>(At("showPin"),new Promise(yr=>{const br=Ar=>{Ar.data.type==="pinSubmitted"&&(removeEventListener("message",br),yr(Ar.data.pin))};addEventListener("message",br)}))})}catch(yr){toastError("Error connecting to wallet",yr)}finally{At("done")}},fr=reactExports.useCallback(()=>[tasksProtocolDefinition,profileDefinition].map(br=>WalletConnect.createPermissionRequestForProtocol({definition:br,permissions:["read","write","delete","query","subscribe"]})),[]),pr=reactExports.useCallback(yr=>{Lt(!0);try{const br=Pr=>{const{type:kr,grants:Ur,delegateDid:Hr}=Pr.data;if(Pr.origin===yr)if(kr==="dweb-connect-loaded"){const Lr={type:"dweb-connect-authorization-request",did:nr,permissions:fr()};zt==null||zt.postMessage(Lr,yr)}else kr==="dweb-connect-authorization-response"&&(window.removeEventListener("message",br),kt&&(kt(nr,Hr,Ur),At("done")))};window.addEventListener("message",br);const Ar=setInterval(()=>{zt!=null&&zt.closed&&(clearInterval(Ar),window.removeEventListener("message",br))},500);zt.location.href=yr+"/dweb-connect#origin="+location.origin}catch{setTimeout(()=>zt==null?void 0:zt.close(),500),ir(""),rr(null),dr([])}finally{Lt(!1),dr([]),Nt(!1)}},[nr,zt,kt,fr,At]);reactExports.useEffect(()=>{nr&&(async()=>{try{const Ar=await(await fetch(`https://dweb/${nr}/read/protocols/${Convert.string("https://areweweb5yet.com/protocols/profile").toBase64Url()}/connect`)).json(),Pr=Ar==null?void 0:Ar.webWallets;if(!(Pr!=null&&Pr.length))return;if(Pr.length===1)return pr(Pr[0]);dr(Pr)}catch{ir(""),dr([]),Nt(!1)}})()},[nr,pr]);const lr=async yr=>{const br=/(?:[^@]*@)?(did:[a-z0-9]+:[a-zA-Z0-9-]+)/;tr(yr.target.value);const Ar=yr.target.value.match(br);if(yr.isTrusted&&Ar){Nt(!0);const Pr=Ar[1];ir(Pr);const kr=500,Ur=600,Hr=(screen.width-kr)/2,Lr=(screen.height-Ur)/2,Sr=window.open("","_blank",`popup=true,width=${kr},height=${Ur},left=${Hr},top=${Lr}`);Sr==null||Sr.document.write(popupContent),rr(Sr)}};return Bt&&jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(LoaderCircle,{className:"animate-spin h-12 w-12 text-primary"})})||jsxRuntimeExports.jsxs("div",{className:"flex flex-col justify-between",children:[ar.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-col",children:ar.map(yr=>jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(Button,{disabled:jt,onClick:()=>pr(yr),children:yr})},yr))}),ar.length===0&&jsxRuntimeExports.jsxs("div",{className:"flex flex-col justify-between",children:[jsxRuntimeExports.jsx(Input,{value:er,onChange:lr,name:"email",placeholder:"DID or Wallet URL"}),jsxRuntimeExports.jsx(Typography,{className:"mt-1",children:"-or-"}),jsxRuntimeExports.jsx(Button,{onClick:ur,className:"mt-4",children:"QR Code"})]})]})},Web5Connection=({connectButtonClassName:xt})=>{const{did:e,isConnecting:At}=useWeb5(),[kt,Bt]=reactExports.useState(!1),Nt=()=>{localStorage.clear(),indexedDB.databases().then(jt=>{jt.forEach(Lt=>{indexedDB.deleteDatabase(Lt.name)})}),window.location.reload()};return e?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{children:["Hi, ",e.substring(0,16),"...!"]}),jsxRuntimeExports.jsx(Button,{variant:"outline",onClick:Nt,children:"Disconnect"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button,{variant:"outline",className:xt,disabled:At,onClick:()=>Bt(!0),children:At?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Connecting ",jsxRuntimeExports.jsx(LoaderCircle,{className:"ml-2 h-4 w-4 animate-spin"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:["Connect ",jsxRuntimeExports.jsx(LogIn,{className:"ml-2 h-4 w-4"})]})}),kt&&jsxRuntimeExports.jsx(ConnectionOption,{setIsOpen:Bt})]})},ConnectionOption=({setIsOpen:xt})=>jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:jsxRuntimeExports.jsx(ConnectSelector,{close:()=>xt(!1)})});function composeEventHandlers(xt,e,{checkForDefaultPrevented:At=!0}={}){return function(Bt){if(xt==null||xt(Bt),At===!1||!Bt.defaultPrevented)return e==null?void 0:e(Bt)}}function createContextScope(xt,e=[]){let At=[];function kt(Nt,jt){const Lt=reactExports.createContext(jt),er=At.length;At=[...At,jt];function tr(rr){const{scope:nr,children:ir,...ar}=rr,dr=(nr==null?void 0:nr[xt][er])||Lt,ur=reactExports.useMemo(()=>ar,Object.values(ar));return jsxRuntimeExports.jsx(dr.Provider,{value:ur,children:ir})}function zt(rr,nr){const ir=(nr==null?void 0:nr[xt][er])||Lt,ar=reactExports.useContext(ir);if(ar)return ar;if(jt!==void 0)return jt;throw new Error(`\`${rr}\` must be used within \`${Nt}\``)}return tr.displayName=Nt+"Provider",[tr,zt]}const Bt=()=>{const Nt=At.map(jt=>reactExports.createContext(jt));return function(Lt){const er=(Lt==null?void 0:Lt[xt])||Nt;return reactExports.useMemo(()=>({[`__scope${xt}`]:{...Lt,[xt]:er}}),[Lt,er])}};return Bt.scopeName=xt,[kt,composeContextScopes(Bt,...e)]}function composeContextScopes(...xt){const e=xt[0];if(xt.length===1)return e;const At=()=>{const kt=xt.map(Bt=>({useScope:Bt(),scopeName:Bt.scopeName}));return function(Nt){const jt=kt.reduce((Lt,{useScope:er,scopeName:tr})=>{const rr=er(Nt)[`__scope${tr}`];return{...Lt,...rr}},{});return reactExports.useMemo(()=>({[`__scope${e.scopeName}`]:jt}),[jt])}};return At.scopeName=e.scopeName,At}function useCallbackRef$1(xt){const e=reactExports.useRef(xt);return reactExports.useEffect(()=>{e.current=xt}),reactExports.useMemo(()=>(...At)=>{var kt;return(kt=e.current)==null?void 0:kt.call(e,...At)},[])}function useControllableState({prop:xt,defaultProp:e,onChange:At=()=>{}}){const[kt,Bt]=useUncontrolledState({defaultProp:e,onChange:At}),Nt=xt!==void 0,jt=Nt?xt:kt,Lt=useCallbackRef$1(At),er=reactExports.useCallback(tr=>{if(Nt){const rr=typeof tr=="function"?tr(xt):tr;rr!==xt&&Lt(rr)}else Bt(tr)},[Nt,xt,Bt,Lt]);return[jt,er]}function useUncontrolledState({defaultProp:xt,onChange:e}){const At=reactExports.useState(xt),[kt]=At,Bt=reactExports.useRef(kt),Nt=useCallbackRef$1(e);return reactExports.useEffect(()=>{Bt.current!==kt&&(Nt(kt),Bt.current=kt)},[kt,Bt,Nt]),At}var NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Primitive=NODES.reduce((xt,e)=>{const At=reactExports.forwardRef((kt,Bt)=>{const{asChild:Nt,...jt}=kt,Lt=Nt?Slot:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),jsxRuntimeExports.jsx(Lt,{...jt,ref:Bt})});return At.displayName=`Primitive.${e}`,{...xt,[e]:At}},{});function dispatchDiscreteCustomEvent(xt,e){xt&&reactDomExports.flushSync(()=>xt.dispatchEvent(e))}function createCollection(xt){const e=xt+"CollectionProvider",[At,kt]=createContextScope(e),[Bt,Nt]=At(e,{collectionRef:{current:null},itemMap:new Map}),jt=ir=>{const{scope:ar,children:dr}=ir,ur=React.useRef(null),fr=React.useRef(new Map).current;return jsxRuntimeExports.jsx(Bt,{scope:ar,itemMap:fr,collectionRef:ur,children:dr})};jt.displayName=e;const Lt=xt+"CollectionSlot",er=React.forwardRef((ir,ar)=>{const{scope:dr,children:ur}=ir,fr=Nt(Lt,dr),pr=useComposedRefs(ar,fr.collectionRef);return jsxRuntimeExports.jsx(Slot,{ref:pr,children:ur})});er.displayName=Lt;const tr=xt+"CollectionItemSlot",zt="data-radix-collection-item",rr=React.forwardRef((ir,ar)=>{const{scope:dr,children:ur,...fr}=ir,pr=React.useRef(null),lr=useComposedRefs(ar,pr),yr=Nt(tr,dr);return React.useEffect(()=>(yr.itemMap.set(pr,{ref:pr,...fr}),()=>void yr.itemMap.delete(pr))),jsxRuntimeExports.jsx(Slot,{[zt]:"",ref:lr,children:ur})});rr.displayName=tr;function nr(ir){const ar=Nt(xt+"CollectionConsumer",ir);return React.useCallback(()=>{const ur=ar.collectionRef.current;if(!ur)return[];const fr=Array.from(ur.querySelectorAll(`[${zt}]`));return Array.from(ar.itemMap.values()).sort((yr,br)=>fr.indexOf(yr.ref.current)-fr.indexOf(br.ref.current))},[ar.collectionRef,ar.itemMap])}return[{Provider:jt,Slot:er,ItemSlot:rr},nr,kt]}var DirectionContext=reactExports.createContext(void 0);function useDirection(xt){const e=reactExports.useContext(DirectionContext);return xt||e||"ltr"}function useEscapeKeydown(xt,e=globalThis==null?void 0:globalThis.document){const At=useCallbackRef$1(xt);reactExports.useEffect(()=>{const kt=Bt=>{Bt.key==="Escape"&&At(Bt)};return e.addEventListener("keydown",kt,{capture:!0}),()=>e.removeEventListener("keydown",kt,{capture:!0})},[At,e])}var DISMISSABLE_LAYER_NAME="DismissableLayer",CONTEXT_UPDATE="dismissableLayer.update",POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",FOCUS_OUTSIDE="dismissableLayer.focusOutside",originalBodyPointerEvents,DismissableLayerContext=reactExports.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),DismissableLayer=reactExports.forwardRef((xt,e)=>{const{disableOutsidePointerEvents:At=!1,onEscapeKeyDown:kt,onPointerDownOutside:Bt,onFocusOutside:Nt,onInteractOutside:jt,onDismiss:Lt,...er}=xt,tr=reactExports.useContext(DismissableLayerContext),[zt,rr]=reactExports.useState(null),nr=(zt==null?void 0:zt.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,ir]=reactExports.useState({}),ar=useComposedRefs(e,Pr=>rr(Pr)),dr=Array.from(tr.layers),[ur]=[...tr.layersWithOutsidePointerEventsDisabled].slice(-1),fr=dr.indexOf(ur),pr=zt?dr.indexOf(zt):-1,lr=tr.layersWithOutsidePointerEventsDisabled.size>0,yr=pr>=fr,br=usePointerDownOutside(Pr=>{const kr=Pr.target,Ur=[...tr.branches].some(Hr=>Hr.contains(kr));!yr||Ur||(Bt==null||Bt(Pr),jt==null||jt(Pr),Pr.defaultPrevented||Lt==null||Lt())},nr),Ar=useFocusOutside(Pr=>{const kr=Pr.target;[...tr.branches].some(Hr=>Hr.contains(kr))||(Nt==null||Nt(Pr),jt==null||jt(Pr),Pr.defaultPrevented||Lt==null||Lt())},nr);return useEscapeKeydown(Pr=>{pr===tr.layers.size-1&&(kt==null||kt(Pr),!Pr.defaultPrevented&&Lt&&(Pr.preventDefault(),Lt()))},nr),reactExports.useEffect(()=>{if(zt)return At&&(tr.layersWithOutsidePointerEventsDisabled.size===0&&(originalBodyPointerEvents=nr.body.style.pointerEvents,nr.body.style.pointerEvents="none"),tr.layersWithOutsidePointerEventsDisabled.add(zt)),tr.layers.add(zt),dispatchUpdate(),()=>{At&&tr.layersWithOutsidePointerEventsDisabled.size===1&&(nr.body.style.pointerEvents=originalBodyPointerEvents)}},[zt,nr,At,tr]),reactExports.useEffect(()=>()=>{zt&&(tr.layers.delete(zt),tr.layersWithOutsidePointerEventsDisabled.delete(zt),dispatchUpdate())},[zt,tr]),reactExports.useEffect(()=>{const Pr=()=>ir({});return document.addEventListener(CONTEXT_UPDATE,Pr),()=>document.removeEventListener(CONTEXT_UPDATE,Pr)},[]),jsxRuntimeExports.jsx(Primitive.div,{...er,ref:ar,style:{pointerEvents:lr?yr?"auto":"none":void 0,...xt.style},onFocusCapture:composeEventHandlers(xt.onFocusCapture,Ar.onFocusCapture),onBlurCapture:composeEventHandlers(xt.onBlurCapture,Ar.onBlurCapture),onPointerDownCapture:composeEventHandlers(xt.onPointerDownCapture,br.onPointerDownCapture)})});DismissableLayer.displayName=DISMISSABLE_LAYER_NAME;var BRANCH_NAME="DismissableLayerBranch",DismissableLayerBranch=reactExports.forwardRef((xt,e)=>{const At=reactExports.useContext(DismissableLayerContext),kt=reactExports.useRef(null),Bt=useComposedRefs(e,kt);return reactExports.useEffect(()=>{const Nt=kt.current;if(Nt)return At.branches.add(Nt),()=>{At.branches.delete(Nt)}},[At.branches]),jsxRuntimeExports.jsx(Primitive.div,{...xt,ref:Bt})});DismissableLayerBranch.displayName=BRANCH_NAME;function usePointerDownOutside(xt,e=globalThis==null?void 0:globalThis.document){const At=useCallbackRef$1(xt),kt=reactExports.useRef(!1),Bt=reactExports.useRef(()=>{});return reactExports.useEffect(()=>{const Nt=Lt=>{if(Lt.target&&!kt.current){let er=function(){handleAndDispatchCustomEvent(POINTER_DOWN_OUTSIDE,At,tr,{discrete:!0})};const tr={originalEvent:Lt};Lt.pointerType==="touch"?(e.removeEventListener("click",Bt.current),Bt.current=er,e.addEventListener("click",Bt.current,{once:!0})):er()}else e.removeEventListener("click",Bt.current);kt.current=!1},jt=window.setTimeout(()=>{e.addEventListener("pointerdown",Nt)},0);return()=>{window.clearTimeout(jt),e.removeEventListener("pointerdown",Nt),e.removeEventListener("click",Bt.current)}},[e,At]),{onPointerDownCapture:()=>kt.current=!0}}function useFocusOutside(xt,e=globalThis==null?void 0:globalThis.document){const At=useCallbackRef$1(xt),kt=reactExports.useRef(!1);return reactExports.useEffect(()=>{const Bt=Nt=>{Nt.target&&!kt.current&&handleAndDispatchCustomEvent(FOCUS_OUTSIDE,At,{originalEvent:Nt},{discrete:!1})};return e.addEventListener("focusin",Bt),()=>e.removeEventListener("focusin",Bt)},[e,At]),{onFocusCapture:()=>kt.current=!0,onBlurCapture:()=>kt.current=!1}}function dispatchUpdate(){const xt=new CustomEvent(CONTEXT_UPDATE);document.dispatchEvent(xt)}function handleAndDispatchCustomEvent(xt,e,At,{discrete:kt}){const Bt=At.originalEvent.target,Nt=new CustomEvent(xt,{bubbles:!1,cancelable:!0,detail:At});e&&Bt.addEventListener(xt,e,{once:!0}),kt?dispatchDiscreteCustomEvent(Bt,Nt):Bt.dispatchEvent(Nt)}var count$1=0;function useFocusGuards(){reactExports.useEffect(()=>{const xt=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",xt[0]??createFocusGuard()),document.body.insertAdjacentElement("beforeend",xt[1]??createFocusGuard()),count$1++,()=>{count$1===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),count$1--}},[])}function createFocusGuard(){const xt=document.createElement("span");return xt.setAttribute("data-radix-focus-guard",""),xt.tabIndex=0,xt.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",xt}var AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",EVENT_OPTIONS$1={bubbles:!1,cancelable:!0},FOCUS_SCOPE_NAME="FocusScope",FocusScope=reactExports.forwardRef((xt,e)=>{const{loop:At=!1,trapped:kt=!1,onMountAutoFocus:Bt,onUnmountAutoFocus:Nt,...jt}=xt,[Lt,er]=reactExports.useState(null),tr=useCallbackRef$1(Bt),zt=useCallbackRef$1(Nt),rr=reactExports.useRef(null),nr=useComposedRefs(e,dr=>er(dr)),ir=reactExports.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;reactExports.useEffect(()=>{if(kt){let dr=function(lr){if(ir.paused||!Lt)return;const yr=lr.target;Lt.contains(yr)?rr.current=yr:focus(rr.current,{select:!0})},ur=function(lr){if(ir.paused||!Lt)return;const yr=lr.relatedTarget;yr!==null&&(Lt.contains(yr)||focus(rr.current,{select:!0}))},fr=function(lr){if(document.activeElement===document.body)for(const br of lr)br.removedNodes.length>0&&focus(Lt)};document.addEventListener("focusin",dr),document.addEventListener("focusout",ur);const pr=new MutationObserver(fr);return Lt&&pr.observe(Lt,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",dr),document.removeEventListener("focusout",ur),pr.disconnect()}}},[kt,Lt,ir.paused]),reactExports.useEffect(()=>{if(Lt){focusScopesStack.add(ir);const dr=document.activeElement;if(!Lt.contains(dr)){const fr=new CustomEvent(AUTOFOCUS_ON_MOUNT,EVENT_OPTIONS$1);Lt.addEventListener(AUTOFOCUS_ON_MOUNT,tr),Lt.dispatchEvent(fr),fr.defaultPrevented||(focusFirst$2(removeLinks(getTabbableCandidates(Lt)),{select:!0}),document.activeElement===dr&&focus(Lt))}return()=>{Lt.removeEventListener(AUTOFOCUS_ON_MOUNT,tr),setTimeout(()=>{const fr=new CustomEvent(AUTOFOCUS_ON_UNMOUNT,EVENT_OPTIONS$1);Lt.addEventListener(AUTOFOCUS_ON_UNMOUNT,zt),Lt.dispatchEvent(fr),fr.defaultPrevented||focus(dr??document.body,{select:!0}),Lt.removeEventListener(AUTOFOCUS_ON_UNMOUNT,zt),focusScopesStack.remove(ir)},0)}}},[Lt,tr,zt,ir]);const ar=reactExports.useCallback(dr=>{if(!At&&!kt||ir.paused)return;const ur=dr.key==="Tab"&&!dr.altKey&&!dr.ctrlKey&&!dr.metaKey,fr=document.activeElement;if(ur&&fr){const pr=dr.currentTarget,[lr,yr]=getTabbableEdges(pr);lr&&yr?!dr.shiftKey&&fr===yr?(dr.preventDefault(),At&&focus(lr,{select:!0})):dr.shiftKey&&fr===lr&&(dr.preventDefault(),At&&focus(yr,{select:!0})):fr===pr&&dr.preventDefault()}},[At,kt,ir.paused]);return jsxRuntimeExports.jsx(Primitive.div,{tabIndex:-1,...jt,ref:nr,onKeyDown:ar})});FocusScope.displayName=FOCUS_SCOPE_NAME;function focusFirst$2(xt,{select:e=!1}={}){const At=document.activeElement;for(const kt of xt)if(focus(kt,{select:e}),document.activeElement!==At)return}function getTabbableEdges(xt){const e=getTabbableCandidates(xt),At=findVisible(e,xt),kt=findVisible(e.reverse(),xt);return[At,kt]}function getTabbableCandidates(xt){const e=[],At=document.createTreeWalker(xt,NodeFilter.SHOW_ELEMENT,{acceptNode:kt=>{const Bt=kt.tagName==="INPUT"&&kt.type==="hidden";return kt.disabled||kt.hidden||Bt?NodeFilter.FILTER_SKIP:kt.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;At.nextNode();)e.push(At.currentNode);return e}function findVisible(xt,e){for(const At of xt)if(!isHidden(At,{upTo:e}))return At}function isHidden(xt,{upTo:e}){if(getComputedStyle(xt).visibility==="hidden")return!0;for(;xt;){if(e!==void 0&&xt===e)return!1;if(getComputedStyle(xt).display==="none")return!0;xt=xt.parentElement}return!1}function isSelectableInput(xt){return xt instanceof HTMLInputElement&&"select"in xt}function focus(xt,{select:e=!1}={}){if(xt&&xt.focus){const At=document.activeElement;xt.focus({preventScroll:!0}),xt!==At&&isSelectableInput(xt)&&e&&xt.select()}}var focusScopesStack=createFocusScopesStack();function createFocusScopesStack(){let xt=[];return{add(e){const At=xt[0];e!==At&&(At==null||At.pause()),xt=arrayRemove(xt,e),xt.unshift(e)},remove(e){var At;xt=arrayRemove(xt,e),(At=xt[0])==null||At.resume()}}}function arrayRemove(xt,e){const At=[...xt],kt=At.indexOf(e);return kt!==-1&&At.splice(kt,1),At}function removeLinks(xt){return xt.filter(e=>e.tagName!=="A")}var useLayoutEffect2=globalThis!=null&&globalThis.document?reactExports.useLayoutEffect:()=>{},useReactId=React$1.useId||(()=>{}),count=0;function useId(xt){const[e,At]=reactExports.useState(useReactId());return useLayoutEffect2(()=>{At(kt=>kt??String(count++))},[xt]),e?`radix-${e}`:""}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=xt=>({x:xt,y:xt}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(xt,e,At){return max(xt,min(e,At))}function evaluate(xt,e){return typeof xt=="function"?xt(e):xt}function getSide(xt){return xt.split("-")[0]}function getAlignment(xt){return xt.split("-")[1]}function getOppositeAxis(xt){return xt==="x"?"y":"x"}function getAxisLength(xt){return xt==="y"?"height":"width"}function getSideAxis(xt){return["top","bottom"].includes(getSide(xt))?"y":"x"}function getAlignmentAxis(xt){return getOppositeAxis(getSideAxis(xt))}function getAlignmentSides(xt,e,At){At===void 0&&(At=!1);const kt=getAlignment(xt),Bt=getAlignmentAxis(xt),Nt=getAxisLength(Bt);let jt=Bt==="x"?kt===(At?"end":"start")?"right":"left":kt==="start"?"bottom":"top";return e.reference[Nt]>e.floating[Nt]&&(jt=getOppositePlacement(jt)),[jt,getOppositePlacement(jt)]}function getExpandedPlacements(xt){const e=getOppositePlacement(xt);return[getOppositeAlignmentPlacement(xt),e,getOppositeAlignmentPlacement(e)]}function getOppositeAlignmentPlacement(xt){return xt.replace(/start|end/g,e=>oppositeAlignmentMap[e])}function getSideList(xt,e,At){const kt=["left","right"],Bt=["right","left"],Nt=["top","bottom"],jt=["bottom","top"];switch(xt){case"top":case"bottom":return At?e?Bt:kt:e?kt:Bt;case"left":case"right":return e?Nt:jt;default:return[]}}function getOppositeAxisPlacements(xt,e,At,kt){const Bt=getAlignment(xt);let Nt=getSideList(getSide(xt),At==="start",kt);return Bt&&(Nt=Nt.map(jt=>jt+"-"+Bt),e&&(Nt=Nt.concat(Nt.map(getOppositeAlignmentPlacement)))),Nt}function getOppositePlacement(xt){return xt.replace(/left|right|bottom|top/g,e=>oppositeSideMap[e])}function expandPaddingObject(xt){return{top:0,right:0,bottom:0,left:0,...xt}}function getPaddingObject(xt){return typeof xt!="number"?expandPaddingObject(xt):{top:xt,right:xt,bottom:xt,left:xt}}function rectToClientRect(xt){const{x:e,y:At,width:kt,height:Bt}=xt;return{width:kt,height:Bt,top:At,left:e,right:e+kt,bottom:At+Bt,x:e,y:At}}function computeCoordsFromPlacement(xt,e,At){let{reference:kt,floating:Bt}=xt;const Nt=getSideAxis(e),jt=getAlignmentAxis(e),Lt=getAxisLength(jt),er=getSide(e),tr=Nt==="y",zt=kt.x+kt.width/2-Bt.width/2,rr=kt.y+kt.height/2-Bt.height/2,nr=kt[Lt]/2-Bt[Lt]/2;let ir;switch(er){case"top":ir={x:zt,y:kt.y-Bt.height};break;case"bottom":ir={x:zt,y:kt.y+kt.height};break;case"right":ir={x:kt.x+kt.width,y:rr};break;case"left":ir={x:kt.x-Bt.width,y:rr};break;default:ir={x:kt.x,y:kt.y}}switch(getAlignment(e)){case"start":ir[jt]-=nr*(At&&tr?-1:1);break;case"end":ir[jt]+=nr*(At&&tr?-1:1);break}return ir}const computePosition$1=async(xt,e,At)=>{const{placement:kt="bottom",strategy:Bt="absolute",middleware:Nt=[],platform:jt}=At,Lt=Nt.filter(Boolean),er=await(jt.isRTL==null?void 0:jt.isRTL(e));let tr=await jt.getElementRects({reference:xt,floating:e,strategy:Bt}),{x:zt,y:rr}=computeCoordsFromPlacement(tr,kt,er),nr=kt,ir={},ar=0;for(let dr=0;dr<Lt.length;dr++){const{name:ur,fn:fr}=Lt[dr],{x:pr,y:lr,data:yr,reset:br}=await fr({x:zt,y:rr,initialPlacement:kt,placement:nr,strategy:Bt,middlewareData:ir,rects:tr,platform:jt,elements:{reference:xt,floating:e}});zt=pr??zt,rr=lr??rr,ir={...ir,[ur]:{...ir[ur],...yr}},br&&ar<=50&&(ar++,typeof br=="object"&&(br.placement&&(nr=br.placement),br.rects&&(tr=br.rects===!0?await jt.getElementRects({reference:xt,floating:e,strategy:Bt}):br.rects),{x:zt,y:rr}=computeCoordsFromPlacement(tr,nr,er)),dr=-1)}return{x:zt,y:rr,placement:nr,strategy:Bt,middlewareData:ir}};async function detectOverflow(xt,e){var At;e===void 0&&(e={});const{x:kt,y:Bt,platform:Nt,rects:jt,elements:Lt,strategy:er}=xt,{boundary:tr="clippingAncestors",rootBoundary:zt="viewport",elementContext:rr="floating",altBoundary:nr=!1,padding:ir=0}=evaluate(e,xt),ar=getPaddingObject(ir),ur=Lt[nr?rr==="floating"?"reference":"floating":rr],fr=rectToClientRect(await Nt.getClippingRect({element:(At=await(Nt.isElement==null?void 0:Nt.isElement(ur)))==null||At?ur:ur.contextElement||await(Nt.getDocumentElement==null?void 0:Nt.getDocumentElement(Lt.floating)),boundary:tr,rootBoundary:zt,strategy:er})),pr=rr==="floating"?{x:kt,y:Bt,width:jt.floating.width,height:jt.floating.height}:jt.reference,lr=await(Nt.getOffsetParent==null?void 0:Nt.getOffsetParent(Lt.floating)),yr=await(Nt.isElement==null?void 0:Nt.isElement(lr))?await(Nt.getScale==null?void 0:Nt.getScale(lr))||{x:1,y:1}:{x:1,y:1},br=rectToClientRect(Nt.convertOffsetParentRelativeRectToViewportRelativeRect?await Nt.convertOffsetParentRelativeRectToViewportRelativeRect({elements:Lt,rect:pr,offsetParent:lr,strategy:er}):pr);return{top:(fr.top-br.top+ar.top)/yr.y,bottom:(br.bottom-fr.bottom+ar.bottom)/yr.y,left:(fr.left-br.left+ar.left)/yr.x,right:(br.right-fr.right+ar.right)/yr.x}}const arrow$3=xt=>({name:"arrow",options:xt,async fn(e){const{x:At,y:kt,placement:Bt,rects:Nt,platform:jt,elements:Lt,middlewareData:er}=e,{element:tr,padding:zt=0}=evaluate(xt,e)||{};if(tr==null)return{};const rr=getPaddingObject(zt),nr={x:At,y:kt},ir=getAlignmentAxis(Bt),ar=getAxisLength(ir),dr=await jt.getDimensions(tr),ur=ir==="y",fr=ur?"top":"left",pr=ur?"bottom":"right",lr=ur?"clientHeight":"clientWidth",yr=Nt.reference[ar]+Nt.reference[ir]-nr[ir]-Nt.floating[ar],br=nr[ir]-Nt.reference[ir],Ar=await(jt.getOffsetParent==null?void 0:jt.getOffsetParent(tr));let Pr=Ar?Ar[lr]:0;(!Pr||!await(jt.isElement==null?void 0:jt.isElement(Ar)))&&(Pr=Lt.floating[lr]||Nt.floating[ar]);const kr=yr/2-br/2,Ur=Pr/2-dr[ar]/2-1,Hr=min(rr[fr],Ur),Lr=min(rr[pr],Ur),Sr=Hr,_r=Pr-dr[ar]-Lr,gr=Pr/2-dr[ar]/2+kr,wr=clamp(Sr,gr,_r),Dr=!er.arrow&&getAlignment(Bt)!=null&&gr!==wr&&Nt.reference[ar]/2-(gr<Sr?Hr:Lr)-dr[ar]/2<0,xr=Dr?gr<Sr?gr-Sr:gr-_r:0;return{[ir]:nr[ir]+xr,data:{[ir]:wr,centerOffset:gr-wr-xr,...Dr&&{alignmentOffset:xr}},reset:Dr}}}),flip$2=function(xt){return xt===void 0&&(xt={}),{name:"flip",options:xt,async fn(e){var At,kt;const{placement:Bt,middlewareData:Nt,rects:jt,initialPlacement:Lt,platform:er,elements:tr}=e,{mainAxis:zt=!0,crossAxis:rr=!0,fallbackPlacements:nr,fallbackStrategy:ir="bestFit",fallbackAxisSideDirection:ar="none",flipAlignment:dr=!0,...ur}=evaluate(xt,e);if((At=Nt.arrow)!=null&&At.alignmentOffset)return{};const fr=getSide(Bt),pr=getSideAxis(Lt),lr=getSide(Lt)===Lt,yr=await(er.isRTL==null?void 0:er.isRTL(tr.floating)),br=nr||(lr||!dr?[getOppositePlacement(Lt)]:getExpandedPlacements(Lt)),Ar=ar!=="none";!nr&&Ar&&br.push(...getOppositeAxisPlacements(Lt,dr,ar,yr));const Pr=[Lt,...br],kr=await detectOverflow(e,ur),Ur=[];let Hr=((kt=Nt.flip)==null?void 0:kt.overflows)||[];if(zt&&Ur.push(kr[fr]),rr){const gr=getAlignmentSides(Bt,jt,yr);Ur.push(kr[gr[0]],kr[gr[1]])}if(Hr=[...Hr,{placement:Bt,overflows:Ur}],!Ur.every(gr=>gr<=0)){var Lr,Sr;const gr=(((Lr=Nt.flip)==null?void 0:Lr.index)||0)+1,wr=Pr[gr];if(wr)return{data:{index:gr,overflows:Hr},reset:{placement:wr}};let Dr=(Sr=Hr.filter(xr=>xr.overflows[0]<=0).sort((xr,Ir)=>xr.overflows[1]-Ir.overflows[1])[0])==null?void 0:Sr.placement;if(!Dr)switch(ir){case"bestFit":{var _r;const xr=(_r=Hr.filter(Ir=>{if(Ar){const $r=getSideAxis(Ir.placement);return $r===pr||$r==="y"}return!0}).map(Ir=>[Ir.placement,Ir.overflows.filter($r=>$r>0).reduce(($r,vr)=>$r+vr,0)]).sort((Ir,$r)=>Ir[1]-$r[1])[0])==null?void 0:_r[0];xr&&(Dr=xr);break}case"initialPlacement":Dr=Lt;break}if(Bt!==Dr)return{reset:{placement:Dr}}}return{}}}};function getSideOffsets(xt,e){return{top:xt.top-e.height,right:xt.right-e.width,bottom:xt.bottom-e.height,left:xt.left-e.width}}function isAnySideFullyClipped(xt){return sides.some(e=>xt[e]>=0)}const hide$2=function(xt){return xt===void 0&&(xt={}),{name:"hide",options:xt,async fn(e){const{rects:At}=e,{strategy:kt="referenceHidden",...Bt}=evaluate(xt,e);switch(kt){case"referenceHidden":{const Nt=await detectOverflow(e,{...Bt,elementContext:"reference"}),jt=getSideOffsets(Nt,At.reference);return{data:{referenceHiddenOffsets:jt,referenceHidden:isAnySideFullyClipped(jt)}}}case"escaped":{const Nt=await detectOverflow(e,{...Bt,altBoundary:!0}),jt=getSideOffsets(Nt,At.floating);return{data:{escapedOffsets:jt,escaped:isAnySideFullyClipped(jt)}}}default:return{}}}}};async function convertValueToCoords(xt,e){const{placement:At,platform:kt,elements:Bt}=xt,Nt=await(kt.isRTL==null?void 0:kt.isRTL(Bt.floating)),jt=getSide(At),Lt=getAlignment(At),er=getSideAxis(At)==="y",tr=["left","top"].includes(jt)?-1:1,zt=Nt&&er?-1:1,rr=evaluate(e,xt);let{mainAxis:nr,crossAxis:ir,alignmentAxis:ar}=typeof rr=="number"?{mainAxis:rr,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...rr};return Lt&&typeof ar=="number"&&(ir=Lt==="end"?ar*-1:ar),er?{x:ir*zt,y:nr*tr}:{x:nr*tr,y:ir*zt}}const offset$2=function(xt){return xt===void 0&&(xt=0),{name:"offset",options:xt,async fn(e){var At,kt;const{x:Bt,y:Nt,placement:jt,middlewareData:Lt}=e,er=await convertValueToCoords(e,xt);return jt===((At=Lt.offset)==null?void 0:At.placement)&&(kt=Lt.arrow)!=null&&kt.alignmentOffset?{}:{x:Bt+er.x,y:Nt+er.y,data:{...er,placement:jt}}}}},shift$2=function(xt){return xt===void 0&&(xt={}),{name:"shift",options:xt,async fn(e){const{x:At,y:kt,placement:Bt}=e,{mainAxis:Nt=!0,crossAxis:jt=!1,limiter:Lt={fn:ur=>{let{x:fr,y:pr}=ur;return{x:fr,y:pr}}},...er}=evaluate(xt,e),tr={x:At,y:kt},zt=await detectOverflow(e,er),rr=getSideAxis(getSide(Bt)),nr=getOppositeAxis(rr);let ir=tr[nr],ar=tr[rr];if(Nt){const ur=nr==="y"?"top":"left",fr=nr==="y"?"bottom":"right",pr=ir+zt[ur],lr=ir-zt[fr];ir=clamp(pr,ir,lr)}if(jt){const ur=rr==="y"?"top":"left",fr=rr==="y"?"bottom":"right",pr=ar+zt[ur],lr=ar-zt[fr];ar=clamp(pr,ar,lr)}const dr=Lt.fn({...e,[nr]:ir,[rr]:ar});return{...dr,data:{x:dr.x-At,y:dr.y-kt}}}}},limitShift$2=function(xt){return xt===void 0&&(xt={}),{options:xt,fn(e){const{x:At,y:kt,placement:Bt,rects:Nt,middlewareData:jt}=e,{offset:Lt=0,mainAxis:er=!0,crossAxis:tr=!0}=evaluate(xt,e),zt={x:At,y:kt},rr=getSideAxis(Bt),nr=getOppositeAxis(rr);let ir=zt[nr],ar=zt[rr];const dr=evaluate(Lt,e),ur=typeof dr=="number"?{mainAxis:dr,crossAxis:0}:{mainAxis:0,crossAxis:0,...dr};if(er){const lr=nr==="y"?"height":"width",yr=Nt.reference[nr]-Nt.floating[lr]+ur.mainAxis,br=Nt.reference[nr]+Nt.reference[lr]-ur.mainAxis;ir<yr?ir=yr:ir>br&&(ir=br)}if(tr){var fr,pr;const lr=nr==="y"?"width":"height",yr=["top","left"].includes(getSide(Bt)),br=Nt.reference[rr]-Nt.floating[lr]+(yr&&((fr=jt.offset)==null?void 0:fr[rr])||0)+(yr?0:ur.crossAxis),Ar=Nt.reference[rr]+Nt.reference[lr]+(yr?0:((pr=jt.offset)==null?void 0:pr[rr])||0)-(yr?ur.crossAxis:0);ar<br?ar=br:ar>Ar&&(ar=Ar)}return{[nr]:ir,[rr]:ar}}}},size$2=function(xt){return xt===void 0&&(xt={}),{name:"size",options:xt,async fn(e){const{placement:At,rects:kt,platform:Bt,elements:Nt}=e,{apply:jt=()=>{},...Lt}=evaluate(xt,e),er=await detectOverflow(e,Lt),tr=getSide(At),zt=getAlignment(At),rr=getSideAxis(At)==="y",{width:nr,height:ir}=kt.floating;let ar,dr;tr==="top"||tr==="bottom"?(ar=tr,dr=zt===(await(Bt.isRTL==null?void 0:Bt.isRTL(Nt.floating))?"start":"end")?"left":"right"):(dr=tr,ar=zt==="end"?"top":"bottom");const ur=ir-er.top-er.bottom,fr=nr-er.left-er.right,pr=min(ir-er[ar],ur),lr=min(nr-er[dr],fr),yr=!e.middlewareData.shift;let br=pr,Ar=lr;if(rr?Ar=zt||yr?min(lr,fr):fr:br=zt||yr?min(pr,ur):ur,yr&&!zt){const kr=max(er.left,0),Ur=max(er.right,0),Hr=max(er.top,0),Lr=max(er.bottom,0);rr?Ar=nr-2*(kr!==0||Ur!==0?kr+Ur:max(er.left,er.right)):br=ir-2*(Hr!==0||Lr!==0?Hr+Lr:max(er.top,er.bottom))}await jt({...e,availableWidth:Ar,availableHeight:br});const Pr=await Bt.getDimensions(Nt.floating);return nr!==Pr.width||ir!==Pr.height?{reset:{rects:!0}}:{}}}};function getNodeName(xt){return isNode(xt)?(xt.nodeName||"").toLowerCase():"#document"}function getWindow(xt){var e;return(xt==null||(e=xt.ownerDocument)==null?void 0:e.defaultView)||window}function getDocumentElement(xt){var e;return(e=(isNode(xt)?xt.ownerDocument:xt.document)||window.document)==null?void 0:e.documentElement}function isNode(xt){return xt instanceof Node||xt instanceof getWindow(xt).Node}function isElement(xt){return xt instanceof Element||xt instanceof getWindow(xt).Element}function isHTMLElement(xt){return xt instanceof HTMLElement||xt instanceof getWindow(xt).HTMLElement}function isShadowRoot(xt){return typeof ShadowRoot>"u"?!1:xt instanceof ShadowRoot||xt instanceof getWindow(xt).ShadowRoot}function isOverflowElement(xt){const{overflow:e,overflowX:At,overflowY:kt,display:Bt}=getComputedStyle$1(xt);return/auto|scroll|overlay|hidden|clip/.test(e+kt+At)&&!["inline","contents"].includes(Bt)}function isTableElement(xt){return["table","td","th"].includes(getNodeName(xt))}function isTopLayer(xt){return[":popover-open",":modal"].some(e=>{try{return xt.matches(e)}catch{return!1}})}function isContainingBlock(xt){const e=isWebKit(),At=getComputedStyle$1(xt);return At.transform!=="none"||At.perspective!=="none"||(At.containerType?At.containerType!=="normal":!1)||!e&&(At.backdropFilter?At.backdropFilter!=="none":!1)||!e&&(At.filter?At.filter!=="none":!1)||["transform","perspective","filter"].some(kt=>(At.willChange||"").includes(kt))||["paint","layout","strict","content"].some(kt=>(At.contain||"").includes(kt))}function getContainingBlock(xt){let e=getParentNode(xt);for(;isHTMLElement(e)&&!isLastTraversableNode(e);){if(isTopLayer(e))return null;if(isContainingBlock(e))return e;e=getParentNode(e)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(xt){return["html","body","#document"].includes(getNodeName(xt))}function getComputedStyle$1(xt){return getWindow(xt).getComputedStyle(xt)}function getNodeScroll(xt){return isElement(xt)?{scrollLeft:xt.scrollLeft,scrollTop:xt.scrollTop}:{scrollLeft:xt.scrollX,scrollTop:xt.scrollY}}function getParentNode(xt){if(getNodeName(xt)==="html")return xt;const e=xt.assignedSlot||xt.parentNode||isShadowRoot(xt)&&xt.host||getDocumentElement(xt);return isShadowRoot(e)?e.host:e}function getNearestOverflowAncestor(xt){const e=getParentNode(xt);return isLastTraversableNode(e)?xt.ownerDocument?xt.ownerDocument.body:xt.body:isHTMLElement(e)&&isOverflowElement(e)?e:getNearestOverflowAncestor(e)}function getOverflowAncestors(xt,e,At){var kt;e===void 0&&(e=[]),At===void 0&&(At=!0);const Bt=getNearestOverflowAncestor(xt),Nt=Bt===((kt=xt.ownerDocument)==null?void 0:kt.body),jt=getWindow(Bt);return Nt?e.concat(jt,jt.visualViewport||[],isOverflowElement(Bt)?Bt:[],jt.frameElement&&At?getOverflowAncestors(jt.frameElement):[]):e.concat(Bt,getOverflowAncestors(Bt,[],At))}function getCssDimensions(xt){const e=getComputedStyle$1(xt);let At=parseFloat(e.width)||0,kt=parseFloat(e.height)||0;const Bt=isHTMLElement(xt),Nt=Bt?xt.offsetWidth:At,jt=Bt?xt.offsetHeight:kt,Lt=round(At)!==Nt||round(kt)!==jt;return Lt&&(At=Nt,kt=jt),{width:At,height:kt,$:Lt}}function unwrapElement(xt){return isElement(xt)?xt:xt.contextElement}function getScale(xt){const e=unwrapElement(xt);if(!isHTMLElement(e))return createCoords(1);const At=e.getBoundingClientRect(),{width:kt,height:Bt,$:Nt}=getCssDimensions(e);let jt=(Nt?round(At.width):At.width)/kt,Lt=(Nt?round(At.height):At.height)/Bt;return(!jt||!Number.isFinite(jt))&&(jt=1),(!Lt||!Number.isFinite(Lt))&&(Lt=1),{x:jt,y:Lt}}const noOffsets=createCoords(0);function getVisualOffsets(xt){const e=getWindow(xt);return!isWebKit()||!e.visualViewport?noOffsets:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function shouldAddVisualOffsets(xt,e,At){return e===void 0&&(e=!1),!At||e&&At!==getWindow(xt)?!1:e}function getBoundingClientRect(xt,e,At,kt){e===void 0&&(e=!1),At===void 0&&(At=!1);const Bt=xt.getBoundingClientRect(),Nt=unwrapElement(xt);let jt=createCoords(1);e&&(kt?isElement(kt)&&(jt=getScale(kt)):jt=getScale(xt));const Lt=shouldAddVisualOffsets(Nt,At,kt)?getVisualOffsets(Nt):createCoords(0);let er=(Bt.left+Lt.x)/jt.x,tr=(Bt.top+Lt.y)/jt.y,zt=Bt.width/jt.x,rr=Bt.height/jt.y;if(Nt){const nr=getWindow(Nt),ir=kt&&isElement(kt)?getWindow(kt):kt;let ar=nr,dr=ar.frameElement;for(;dr&&kt&&ir!==ar;){const ur=getScale(dr),fr=dr.getBoundingClientRect(),pr=getComputedStyle$1(dr),lr=fr.left+(dr.clientLeft+parseFloat(pr.paddingLeft))*ur.x,yr=fr.top+(dr.clientTop+parseFloat(pr.paddingTop))*ur.y;er*=ur.x,tr*=ur.y,zt*=ur.x,rr*=ur.y,er+=lr,tr+=yr,ar=getWindow(dr),dr=ar.frameElement}}return rectToClientRect({width:zt,height:rr,x:er,y:tr})}function convertOffsetParentRelativeRectToViewportRelativeRect(xt){let{elements:e,rect:At,offsetParent:kt,strategy:Bt}=xt;const Nt=Bt==="fixed",jt=getDocumentElement(kt),Lt=e?isTopLayer(e.floating):!1;if(kt===jt||Lt&&Nt)return At;let er={scrollLeft:0,scrollTop:0},tr=createCoords(1);const zt=createCoords(0),rr=isHTMLElement(kt);if((rr||!rr&&!Nt)&&((getNodeName(kt)!=="body"||isOverflowElement(jt))&&(er=getNodeScroll(kt)),isHTMLElement(kt))){const nr=getBoundingClientRect(kt);tr=getScale(kt),zt.x=nr.x+kt.clientLeft,zt.y=nr.y+kt.clientTop}return{width:At.width*tr.x,height:At.height*tr.y,x:At.x*tr.x-er.scrollLeft*tr.x+zt.x,y:At.y*tr.y-er.scrollTop*tr.y+zt.y}}function getClientRects(xt){return Array.from(xt.getClientRects())}function getWindowScrollBarX(xt){return getBoundingClientRect(getDocumentElement(xt)).left+getNodeScroll(xt).scrollLeft}function getDocumentRect(xt){const e=getDocumentElement(xt),At=getNodeScroll(xt),kt=xt.ownerDocument.body,Bt=max(e.scrollWidth,e.clientWidth,kt.scrollWidth,kt.clientWidth),Nt=max(e.scrollHeight,e.clientHeight,kt.scrollHeight,kt.clientHeight);let jt=-At.scrollLeft+getWindowScrollBarX(xt);const Lt=-At.scrollTop;return getComputedStyle$1(kt).direction==="rtl"&&(jt+=max(e.clientWidth,kt.clientWidth)-Bt),{width:Bt,height:Nt,x:jt,y:Lt}}function getViewportRect(xt,e){const At=getWindow(xt),kt=getDocumentElement(xt),Bt=At.visualViewport;let Nt=kt.clientWidth,jt=kt.clientHeight,Lt=0,er=0;if(Bt){Nt=Bt.width,jt=Bt.height;const tr=isWebKit();(!tr||tr&&e==="fixed")&&(Lt=Bt.offsetLeft,er=Bt.offsetTop)}return{width:Nt,height:jt,x:Lt,y:er}}function getInnerBoundingClientRect(xt,e){const At=getBoundingClientRect(xt,!0,e==="fixed"),kt=At.top+xt.clientTop,Bt=At.left+xt.clientLeft,Nt=isHTMLElement(xt)?getScale(xt):createCoords(1),jt=xt.clientWidth*Nt.x,Lt=xt.clientHeight*Nt.y,er=Bt*Nt.x,tr=kt*Nt.y;return{width:jt,height:Lt,x:er,y:tr}}function getClientRectFromClippingAncestor(xt,e,At){let kt;if(e==="viewport")kt=getViewportRect(xt,At);else if(e==="document")kt=getDocumentRect(getDocumentElement(xt));else if(isElement(e))kt=getInnerBoundingClientRect(e,At);else{const Bt=getVisualOffsets(xt);kt={...e,x:e.x-Bt.x,y:e.y-Bt.y}}return rectToClientRect(kt)}function hasFixedPositionAncestor(xt,e){const At=getParentNode(xt);return At===e||!isElement(At)||isLastTraversableNode(At)?!1:getComputedStyle$1(At).position==="fixed"||hasFixedPositionAncestor(At,e)}function getClippingElementAncestors(xt,e){const At=e.get(xt);if(At)return At;let kt=getOverflowAncestors(xt,[],!1).filter(Lt=>isElement(Lt)&&getNodeName(Lt)!=="body"),Bt=null;const Nt=getComputedStyle$1(xt).position==="fixed";let jt=Nt?getParentNode(xt):xt;for(;isElement(jt)&&!isLastTraversableNode(jt);){const Lt=getComputedStyle$1(jt),er=isContainingBlock(jt);!er&&Lt.position==="fixed"&&(Bt=null),(Nt?!er&&!Bt:!er&&Lt.position==="static"&&!!Bt&&["absolute","fixed"].includes(Bt.position)||isOverflowElement(jt)&&!er&&hasFixedPositionAncestor(xt,jt))?kt=kt.filter(zt=>zt!==jt):Bt=Lt,jt=getParentNode(jt)}return e.set(xt,kt),kt}function getClippingRect(xt){let{element:e,boundary:At,rootBoundary:kt,strategy:Bt}=xt;const jt=[...At==="clippingAncestors"?isTopLayer(e)?[]:getClippingElementAncestors(e,this._c):[].concat(At),kt],Lt=jt[0],er=jt.reduce((tr,zt)=>{const rr=getClientRectFromClippingAncestor(e,zt,Bt);return tr.top=max(rr.top,tr.top),tr.right=min(rr.right,tr.right),tr.bottom=min(rr.bottom,tr.bottom),tr.left=max(rr.left,tr.left),tr},getClientRectFromClippingAncestor(e,Lt,Bt));return{width:er.right-er.left,height:er.bottom-er.top,x:er.left,y:er.top}}function getDimensions(xt){const{width:e,height:At}=getCssDimensions(xt);return{width:e,height:At}}function getRectRelativeToOffsetParent(xt,e,At){const kt=isHTMLElement(e),Bt=getDocumentElement(e),Nt=At==="fixed",jt=getBoundingClientRect(xt,!0,Nt,e);let Lt={scrollLeft:0,scrollTop:0};const er=createCoords(0);if(kt||!kt&&!Nt)if((getNodeName(e)!=="body"||isOverflowElement(Bt))&&(Lt=getNodeScroll(e)),kt){const rr=getBoundingClientRect(e,!0,Nt,e);er.x=rr.x+e.clientLeft,er.y=rr.y+e.clientTop}else Bt&&(er.x=getWindowScrollBarX(Bt));const tr=jt.left+Lt.scrollLeft-er.x,zt=jt.top+Lt.scrollTop-er.y;return{x:tr,y:zt,width:jt.width,height:jt.height}}function isStaticPositioned(xt){return getComputedStyle$1(xt).position==="static"}function getTrueOffsetParent(xt,e){return!isHTMLElement(xt)||getComputedStyle$1(xt).position==="fixed"?null:e?e(xt):xt.offsetParent}function getOffsetParent(xt,e){const At=getWindow(xt);if(isTopLayer(xt))return At;if(!isHTMLElement(xt)){let Bt=getParentNode(xt);for(;Bt&&!isLastTraversableNode(Bt);){if(isElement(Bt)&&!isStaticPositioned(Bt))return Bt;Bt=getParentNode(Bt)}return At}let kt=getTrueOffsetParent(xt,e);for(;kt&&isTableElement(kt)&&isStaticPositioned(kt);)kt=getTrueOffsetParent(kt,e);return kt&&isLastTraversableNode(kt)&&isStaticPositioned(kt)&&!isContainingBlock(kt)?At:kt||getContainingBlock(xt)||At}const getElementRects=async function(xt){const e=this.getOffsetParent||getOffsetParent,At=this.getDimensions,kt=await At(xt.floating);return{reference:getRectRelativeToOffsetParent(xt.reference,await e(xt.floating),xt.strategy),floating:{x:0,y:0,width:kt.width,height:kt.height}}};function isRTL(xt){return getComputedStyle$1(xt).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function observeMove(xt,e){let At=null,kt;const Bt=getDocumentElement(xt);function Nt(){var Lt;clearTimeout(kt),(Lt=At)==null||Lt.disconnect(),At=null}function jt(Lt,er){Lt===void 0&&(Lt=!1),er===void 0&&(er=1),Nt();const{left:tr,top:zt,width:rr,height:nr}=xt.getBoundingClientRect();if(Lt||e(),!rr||!nr)return;const ir=floor(zt),ar=floor(Bt.clientWidth-(tr+rr)),dr=floor(Bt.clientHeight-(zt+nr)),ur=floor(tr),pr={rootMargin:-ir+"px "+-ar+"px "+-dr+"px "+-ur+"px",threshold:max(0,min(1,er))||1};let lr=!0;function yr(br){const Ar=br[0].intersectionRatio;if(Ar!==er){if(!lr)return jt();Ar?jt(!1,Ar):kt=setTimeout(()=>{jt(!1,1e-7)},1e3)}lr=!1}try{At=new IntersectionObserver(yr,{...pr,root:Bt.ownerDocument})}catch{At=new IntersectionObserver(yr,pr)}At.observe(xt)}return jt(!0),Nt}function autoUpdate(xt,e,At,kt){kt===void 0&&(kt={});const{ancestorScroll:Bt=!0,ancestorResize:Nt=!0,elementResize:jt=typeof ResizeObserver=="function",layoutShift:Lt=typeof IntersectionObserver=="function",animationFrame:er=!1}=kt,tr=unwrapElement(xt),zt=Bt||Nt?[...tr?getOverflowAncestors(tr):[],...getOverflowAncestors(e)]:[];zt.forEach(fr=>{Bt&&fr.addEventListener("scroll",At,{passive:!0}),Nt&&fr.addEventListener("resize",At)});const rr=tr&&Lt?observeMove(tr,At):null;let nr=-1,ir=null;jt&&(ir=new ResizeObserver(fr=>{let[pr]=fr;pr&&pr.target===tr&&ir&&(ir.unobserve(e),cancelAnimationFrame(nr),nr=requestAnimationFrame(()=>{var lr;(lr=ir)==null||lr.observe(e)})),At()}),tr&&!er&&ir.observe(tr),ir.observe(e));let ar,dr=er?getBoundingClientRect(xt):null;er&&ur();function ur(){const fr=getBoundingClientRect(xt);dr&&(fr.x!==dr.x||fr.y!==dr.y||fr.width!==dr.width||fr.height!==dr.height)&&At(),dr=fr,ar=requestAnimationFrame(ur)}return At(),()=>{var fr;zt.forEach(pr=>{Bt&&pr.removeEventListener("scroll",At),Nt&&pr.removeEventListener("resize",At)}),rr==null||rr(),(fr=ir)==null||fr.disconnect(),ir=null,er&&cancelAnimationFrame(ar)}}const offset$1=offset$2,shift$1=shift$2,flip$1=flip$2,size$1=size$2,hide$1=hide$2,arrow$2=arrow$3,limitShift$1=limitShift$2,computePosition=(xt,e,At)=>{const kt=new Map,Bt={platform,...At},Nt={...Bt.platform,_c:kt};return computePosition$1(xt,e,{...Bt,platform:Nt})};var index=typeof document<"u"?reactExports.useLayoutEffect:reactExports.useEffect;function deepEqual(xt,e){if(xt===e)return!0;if(typeof xt!=typeof e)return!1;if(typeof xt=="function"&&xt.toString()===e.toString())return!0;let At,kt,Bt;if(xt&&e&&typeof xt=="object"){if(Array.isArray(xt)){if(At=xt.length,At!==e.length)return!1;for(kt=At;kt--!==0;)if(!deepEqual(xt[kt],e[kt]))return!1;return!0}if(Bt=Object.keys(xt),At=Bt.length,At!==Object.keys(e).length)return!1;for(kt=At;kt--!==0;)if(!{}.hasOwnProperty.call(e,Bt[kt]))return!1;for(kt=At;kt--!==0;){const Nt=Bt[kt];if(!(Nt==="_owner"&&xt.$$typeof)&&!deepEqual(xt[Nt],e[Nt]))return!1}return!0}return xt!==xt&&e!==e}function getDPR(xt){return typeof window>"u"?1:(xt.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(xt,e){const At=getDPR(xt);return Math.round(e*At)/At}function useLatestRef(xt){const e=reactExports.useRef(xt);return index(()=>{e.current=xt}),e}function useFloating(xt){xt===void 0&&(xt={});const{placement:e="bottom",strategy:At="absolute",middleware:kt=[],platform:Bt,elements:{reference:Nt,floating:jt}={},transform:Lt=!0,whileElementsMounted:er,open:tr}=xt,[zt,rr]=reactExports.useState({x:0,y:0,strategy:At,placement:e,middlewareData:{},isPositioned:!1}),[nr,ir]=reactExports.useState(kt);deepEqual(nr,kt)||ir(kt);const[ar,dr]=reactExports.useState(null),[ur,fr]=reactExports.useState(null),pr=reactExports.useCallback(xr=>{xr!==Ar.current&&(Ar.current=xr,dr(xr))},[]),lr=reactExports.useCallback(xr=>{xr!==Pr.current&&(Pr.current=xr,fr(xr))},[]),yr=Nt||ar,br=jt||ur,Ar=reactExports.useRef(null),Pr=reactExports.useRef(null),kr=reactExports.useRef(zt),Ur=er!=null,Hr=useLatestRef(er),Lr=useLatestRef(Bt),Sr=reactExports.useCallback(()=>{if(!Ar.current||!Pr.current)return;const xr={placement:e,strategy:At,middleware:nr};Lr.current&&(xr.platform=Lr.current),computePosition(Ar.current,Pr.current,xr).then(Ir=>{const $r={...Ir,isPositioned:!0};_r.current&&!deepEqual(kr.current,$r)&&(kr.current=$r,reactDomExports.flushSync(()=>{rr($r)}))})},[nr,e,At,Lr]);index(()=>{tr===!1&&kr.current.isPositioned&&(kr.current.isPositioned=!1,rr(xr=>({...xr,isPositioned:!1})))},[tr]);const _r=reactExports.useRef(!1);index(()=>(_r.current=!0,()=>{_r.current=!1}),[]),index(()=>{if(yr&&(Ar.current=yr),br&&(Pr.current=br),yr&&br){if(Hr.current)return Hr.current(yr,br,Sr);Sr()}},[yr,br,Sr,Hr,Ur]);const gr=reactExports.useMemo(()=>({reference:Ar,floating:Pr,setReference:pr,setFloating:lr}),[pr,lr]),wr=reactExports.useMemo(()=>({reference:yr,floating:br}),[yr,br]),Dr=reactExports.useMemo(()=>{const xr={position:At,left:0,top:0};if(!wr.floating)return xr;const Ir=roundByDPR(wr.floating,zt.x),$r=roundByDPR(wr.floating,zt.y);return Lt?{...xr,transform:"translate("+Ir+"px, "+$r+"px)",...getDPR(wr.floating)>=1.5&&{willChange:"transform"}}:{position:At,left:Ir,top:$r}},[At,Lt,wr.floating,zt.x,zt.y]);return reactExports.useMemo(()=>({...zt,update:Sr,refs:gr,elements:wr,floatingStyles:Dr}),[zt,Sr,gr,wr,Dr])}const arrow$1=xt=>{function e(At){return{}.hasOwnProperty.call(At,"current")}return{name:"arrow",options:xt,fn(At){const{element:kt,padding:Bt}=typeof xt=="function"?xt(At):xt;return kt&&e(kt)?kt.current!=null?arrow$2({element:kt.current,padding:Bt}).fn(At):{}:kt?arrow$2({element:kt,padding:Bt}).fn(At):{}}}},offset=(xt,e)=>({...offset$1(xt),options:[xt,e]}),shift=(xt,e)=>({...shift$1(xt),options:[xt,e]}),limitShift=(xt,e)=>({...limitShift$1(xt),options:[xt,e]}),flip=(xt,e)=>({...flip$1(xt),options:[xt,e]}),size=(xt,e)=>({...size$1(xt),options:[xt,e]}),hide=(xt,e)=>({...hide$1(xt),options:[xt,e]}),arrow=(xt,e)=>({...arrow$1(xt),options:[xt,e]});var NAME$1="Arrow",Arrow$1=reactExports.forwardRef((xt,e)=>{const{children:At,width:kt=10,height:Bt=5,...Nt}=xt;return jsxRuntimeExports.jsx(Primitive.svg,{...Nt,ref:e,width:kt,height:Bt,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:xt.asChild?At:jsxRuntimeExports.jsx("polygon",{points:"0,0 30,0 15,10"})})});Arrow$1.displayName=NAME$1;var Root$3=Arrow$1;function useSize(xt){const[e,At]=reactExports.useState(void 0);return useLayoutEffect2(()=>{if(xt){At({width:xt.offsetWidth,height:xt.offsetHeight});const kt=new ResizeObserver(Bt=>{if(!Array.isArray(Bt)||!Bt.length)return;const Nt=Bt[0];let jt,Lt;if("borderBoxSize"in Nt){const er=Nt.borderBoxSize,tr=Array.isArray(er)?er[0]:er;jt=tr.inlineSize,Lt=tr.blockSize}else jt=xt.offsetWidth,Lt=xt.offsetHeight;At({width:jt,height:Lt})});return kt.observe(xt,{box:"border-box"}),()=>kt.unobserve(xt)}else At(void 0)},[xt]),e}var POPPER_NAME="Popper",[createPopperContext,createPopperScope]=createContextScope(POPPER_NAME),[PopperProvider,usePopperContext]=createPopperContext(POPPER_NAME),Popper=xt=>{const{__scopePopper:e,children:At}=xt,[kt,Bt]=reactExports.useState(null);return jsxRuntimeExports.jsx(PopperProvider,{scope:e,anchor:kt,onAnchorChange:Bt,children:At})};Popper.displayName=POPPER_NAME;var ANCHOR_NAME$1="PopperAnchor",PopperAnchor=reactExports.forwardRef((xt,e)=>{const{__scopePopper:At,virtualRef:kt,...Bt}=xt,Nt=usePopperContext(ANCHOR_NAME$1,At),jt=reactExports.useRef(null),Lt=useComposedRefs(e,jt);return reactExports.useEffect(()=>{Nt.onAnchorChange((kt==null?void 0:kt.current)||jt.current)}),kt?null:jsxRuntimeExports.jsx(Primitive.div,{...Bt,ref:Lt})});PopperAnchor.displayName=ANCHOR_NAME$1;var CONTENT_NAME$2="PopperContent",[PopperContentProvider,useContentContext]=createPopperContext(CONTENT_NAME$2),PopperContent=reactExports.forwardRef((xt,e)=>{var Cr,jr,Yr,Qr,Jr,Wr;const{__scopePopper:At,side:kt="bottom",sideOffset:Bt=0,align:Nt="center",alignOffset:jt=0,arrowPadding:Lt=0,avoidCollisions:er=!0,collisionBoundary:tr=[],collisionPadding:zt=0,sticky:rr="partial",hideWhenDetached:nr=!1,updatePositionStrategy:ir="optimized",onPlaced:ar,...dr}=xt,ur=usePopperContext(CONTENT_NAME$2,At),[fr,pr]=reactExports.useState(null),lr=useComposedRefs(e,Nr=>pr(Nr)),[yr,br]=reactExports.useState(null),Ar=useSize(yr),Pr=(Ar==null?void 0:Ar.width)??0,kr=(Ar==null?void 0:Ar.height)??0,Ur=kt+(Nt!=="center"?"-"+Nt:""),Hr=typeof zt=="number"?zt:{top:0,right:0,bottom:0,left:0,...zt},Lr=Array.isArray(tr)?tr:[tr],Sr=Lr.length>0,_r={padding:Hr,boundary:Lr.filter(isNotNull),altBoundary:Sr},{refs:gr,floatingStyles:wr,placement:Dr,isPositioned:xr,middlewareData:Ir}=useFloating({strategy:"fixed",placement:Ur,whileElementsMounted:(...Nr)=>autoUpdate(...Nr,{animationFrame:ir==="always"}),elements:{reference:ur.anchor},middleware:[offset({mainAxis:Bt+kr,alignmentAxis:jt}),er&&shift({mainAxis:!0,crossAxis:!1,limiter:rr==="partial"?limitShift():void 0,..._r}),er&&flip({..._r}),size({..._r,apply:({elements:Nr,rects:Vr,availableWidth:Xr,availableHeight:qr})=>{const{width:Or,height:Fr}=Vr.reference,Zr=Nr.floating.style;Zr.setProperty("--radix-popper-available-width",`${Xr}px`),Zr.setProperty("--radix-popper-available-height",`${qr}px`),Zr.setProperty("--radix-popper-anchor-width",`${Or}px`),Zr.setProperty("--radix-popper-anchor-height",`${Fr}px`)}}),yr&&arrow({element:yr,padding:Lt}),transformOrigin({arrowWidth:Pr,arrowHeight:kr}),nr&&hide({strategy:"referenceHidden",..._r})]}),[$r,vr]=getSideAndAlignFromPlacement(Dr),Er=useCallbackRef$1(ar);useLayoutEffect2(()=>{xr&&(Er==null||Er())},[xr,Er]);const Tr=(Cr=Ir.arrow)==null?void 0:Cr.x,Rr=(jr=Ir.arrow)==null?void 0:jr.y,Mr=((Yr=Ir.arrow)==null?void 0:Yr.centerOffset)!==0,[Gr,Br]=reactExports.useState();return useLayoutEffect2(()=>{fr&&Br(window.getComputedStyle(fr).zIndex)},[fr]),jsxRuntimeExports.jsx("div",{ref:gr.setFloating,"data-radix-popper-content-wrapper":"",style:{...wr,transform:xr?wr.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Gr,"--radix-popper-transform-origin":[(Qr=Ir.transformOrigin)==null?void 0:Qr.x,(Jr=Ir.transformOrigin)==null?void 0:Jr.y].join(" "),...((Wr=Ir.hide)==null?void 0:Wr.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:xt.dir,children:jsxRuntimeExports.jsx(PopperContentProvider,{scope:At,placedSide:$r,onArrowChange:br,arrowX:Tr,arrowY:Rr,shouldHideArrow:Mr,children:jsxRuntimeExports.jsx(Primitive.div,{"data-side":$r,"data-align":vr,...dr,ref:lr,style:{...dr.style,animation:xr?void 0:"none"}})})})});PopperContent.displayName=CONTENT_NAME$2;var ARROW_NAME$2="PopperArrow",OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},PopperArrow=reactExports.forwardRef(function xt(e,At){const{__scopePopper:kt,...Bt}=e,Nt=useContentContext(ARROW_NAME$2,kt),jt=OPPOSITE_SIDE[Nt.placedSide];return jsxRuntimeExports.jsx("span",{ref:Nt.onArrowChange,style:{position:"absolute",left:Nt.arrowX,top:Nt.arrowY,[jt]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[Nt.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[Nt.placedSide],visibility:Nt.shouldHideArrow?"hidden":void 0},children:jsxRuntimeExports.jsx(Root$3,{...Bt,ref:At,style:{...Bt.style,display:"block"}})})});PopperArrow.displayName=ARROW_NAME$2;function isNotNull(xt){return xt!==null}var transformOrigin=xt=>({name:"transformOrigin",options:xt,fn(e){var ur,fr,pr;const{placement:At,rects:kt,middlewareData:Bt}=e,jt=((ur=Bt.arrow)==null?void 0:ur.centerOffset)!==0,Lt=jt?0:xt.arrowWidth,er=jt?0:xt.arrowHeight,[tr,zt]=getSideAndAlignFromPlacement(At),rr={start:"0%",center:"50%",end:"100%"}[zt],nr=(((fr=Bt.arrow)==null?void 0:fr.x)??0)+Lt/2,ir=(((pr=Bt.arrow)==null?void 0:pr.y)??0)+er/2;let ar="",dr="";return tr==="bottom"?(ar=jt?rr:`${nr}px`,dr=`${-er}px`):tr==="top"?(ar=jt?rr:`${nr}px`,dr=`${kt.floating.height+er}px`):tr==="right"?(ar=`${-er}px`,dr=jt?rr:`${ir}px`):tr==="left"&&(ar=`${kt.floating.width+er}px`,dr=jt?rr:`${ir}px`),{data:{x:ar,y:dr}}}});function getSideAndAlignFromPlacement(xt){const[e,At="center"]=xt.split("-");return[e,At]}var Root2$1=Popper,Anchor=PopperAnchor,Content=PopperContent,Arrow=PopperArrow,PORTAL_NAME$2="Portal",Portal$1=reactExports.forwardRef((xt,e)=>{var Lt;const{container:At,...kt}=xt,[Bt,Nt]=reactExports.useState(!1);useLayoutEffect2(()=>Nt(!0),[]);const jt=At||Bt&&((Lt=globalThis==null?void 0:globalThis.document)==null?void 0:Lt.body);return jt?ReactDOM.createPortal(jsxRuntimeExports.jsx(Primitive.div,{...kt,ref:e}),jt):null});Portal$1.displayName=PORTAL_NAME$2;function useStateMachine(xt,e){return reactExports.useReducer((At,kt)=>e[At][kt]??At,xt)}var Presence=xt=>{const{present:e,children:At}=xt,kt=usePresence(e),Bt=typeof At=="function"?At({present:kt.isPresent}):reactExports.Children.only(At),Nt=useComposedRefs(kt.ref,getElementRef(Bt));return typeof At=="function"||kt.isPresent?reactExports.cloneElement(Bt,{ref:Nt}):null};Presence.displayName="Presence";function usePresence(xt){const[e,At]=reactExports.useState(),kt=reactExports.useRef({}),Bt=reactExports.useRef(xt),Nt=reactExports.useRef("none"),jt=xt?"mounted":"unmounted",[Lt,er]=useStateMachine(jt,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return reactExports.useEffect(()=>{const tr=getAnimationName(kt.current);Nt.current=Lt==="mounted"?tr:"none"},[Lt]),useLayoutEffect2(()=>{const tr=kt.current,zt=Bt.current;if(zt!==xt){const nr=Nt.current,ir=getAnimationName(tr);xt?er("MOUNT"):ir==="none"||(tr==null?void 0:tr.display)==="none"?er("UNMOUNT"):er(zt&&nr!==ir?"ANIMATION_OUT":"UNMOUNT"),Bt.current=xt}},[xt,er]),useLayoutEffect2(()=>{if(e){const tr=rr=>{const ir=getAnimationName(kt.current).includes(rr.animationName);rr.target===e&&ir&&reactDomExports.flushSync(()=>er("ANIMATION_END"))},zt=rr=>{rr.target===e&&(Nt.current=getAnimationName(kt.current))};return e.addEventListener("animationstart",zt),e.addEventListener("animationcancel",tr),e.addEventListener("animationend",tr),()=>{e.removeEventListener("animationstart",zt),e.removeEventListener("animationcancel",tr),e.removeEventListener("animationend",tr)}}else er("ANIMATION_END")},[e,er]),{isPresent:["mounted","unmountSuspended"].includes(Lt),ref:reactExports.useCallback(tr=>{tr&&(kt.current=getComputedStyle(tr)),At(tr)},[])}}function getAnimationName(xt){return(xt==null?void 0:xt.animationName)||"none"}function getElementRef(xt){var kt,Bt;let e=(kt=Object.getOwnPropertyDescriptor(xt.props,"ref"))==null?void 0:kt.get,At=e&&"isReactWarning"in e&&e.isReactWarning;return At?xt.ref:(e=(Bt=Object.getOwnPropertyDescriptor(xt,"ref"))==null?void 0:Bt.get,At=e&&"isReactWarning"in e&&e.isReactWarning,At?xt.props.ref:xt.props.ref||xt.ref)}var ENTRY_FOCUS="rovingFocusGroup.onEntryFocus",EVENT_OPTIONS={bubbles:!1,cancelable:!0},GROUP_NAME$2="RovingFocusGroup",[Collection$1,useCollection$1,createCollectionScope$1]=createCollection(GROUP_NAME$2),[createRovingFocusGroupContext,createRovingFocusGroupScope]=createContextScope(GROUP_NAME$2,[createCollectionScope$1]),[RovingFocusProvider,useRovingFocusContext]=createRovingFocusGroupContext(GROUP_NAME$2),RovingFocusGroup=reactExports.forwardRef((xt,e)=>jsxRuntimeExports.jsx(Collection$1.Provider,{scope:xt.__scopeRovingFocusGroup,children:jsxRuntimeExports.jsx(Collection$1.Slot,{scope:xt.__scopeRovingFocusGroup,children:jsxRuntimeExports.jsx(RovingFocusGroupImpl,{...xt,ref:e})})}));RovingFocusGroup.displayName=GROUP_NAME$2;var RovingFocusGroupImpl=reactExports.forwardRef((xt,e)=>{const{__scopeRovingFocusGroup:At,orientation:kt,loop:Bt=!1,dir:Nt,currentTabStopId:jt,defaultCurrentTabStopId:Lt,onCurrentTabStopIdChange:er,onEntryFocus:tr,preventScrollOnEntryFocus:zt=!1,...rr}=xt,nr=reactExports.useRef(null),ir=useComposedRefs(e,nr),ar=useDirection(Nt),[dr=null,ur]=useControllableState({prop:jt,defaultProp:Lt,onChange:er}),[fr,pr]=reactExports.useState(!1),lr=useCallbackRef$1(tr),yr=useCollection$1(At),br=reactExports.useRef(!1),[Ar,Pr]=reactExports.useState(0);return reactExports.useEffect(()=>{const kr=nr.current;if(kr)return kr.addEventListener(ENTRY_FOCUS,lr),()=>kr.removeEventListener(ENTRY_FOCUS,lr)},[lr]),jsxRuntimeExports.jsx(RovingFocusProvider,{scope:At,orientation:kt,dir:ar,loop:Bt,currentTabStopId:dr,onItemFocus:reactExports.useCallback(kr=>ur(kr),[ur]),onItemShiftTab:reactExports.useCallback(()=>pr(!0),[]),onFocusableItemAdd:reactExports.useCallback(()=>Pr(kr=>kr+1),[]),onFocusableItemRemove:reactExports.useCallback(()=>Pr(kr=>kr-1),[]),children:jsxRuntimeExports.jsx(Primitive.div,{tabIndex:fr||Ar===0?-1:0,"data-orientation":kt,...rr,ref:ir,style:{outline:"none",...xt.style},onMouseDown:composeEventHandlers(xt.onMouseDown,()=>{br.current=!0}),onFocus:composeEventHandlers(xt.onFocus,kr=>{const Ur=!br.current;if(kr.target===kr.currentTarget&&Ur&&!fr){const Hr=new CustomEvent(ENTRY_FOCUS,EVENT_OPTIONS);if(kr.currentTarget.dispatchEvent(Hr),!Hr.defaultPrevented){const Lr=yr().filter(Dr=>Dr.focusable),Sr=Lr.find(Dr=>Dr.active),_r=Lr.find(Dr=>Dr.id===dr),wr=[Sr,_r,...Lr].filter(Boolean).map(Dr=>Dr.ref.current);focusFirst$1(wr,zt)}}br.current=!1}),onBlur:composeEventHandlers(xt.onBlur,()=>pr(!1))})})}),ITEM_NAME$2="RovingFocusGroupItem",RovingFocusGroupItem=reactExports.forwardRef((xt,e)=>{const{__scopeRovingFocusGroup:At,focusable:kt=!0,active:Bt=!1,tabStopId:Nt,...jt}=xt,Lt=useId(),er=Nt||Lt,tr=useRovingFocusContext(ITEM_NAME$2,At),zt=tr.currentTabStopId===er,rr=useCollection$1(At),{onFocusableItemAdd:nr,onFocusableItemRemove:ir}=tr;return reactExports.useEffect(()=>{if(kt)return nr(),()=>ir()},[kt,nr,ir]),jsxRuntimeExports.jsx(Collection$1.ItemSlot,{scope:At,id:er,focusable:kt,active:Bt,children:jsxRuntimeExports.jsx(Primitive.span,{tabIndex:zt?0:-1,"data-orientation":tr.orientation,...jt,ref:e,onMouseDown:composeEventHandlers(xt.onMouseDown,ar=>{kt?tr.onItemFocus(er):ar.preventDefault()}),onFocus:composeEventHandlers(xt.onFocus,()=>tr.onItemFocus(er)),onKeyDown:composeEventHandlers(xt.onKeyDown,ar=>{if(ar.key==="Tab"&&ar.shiftKey){tr.onItemShiftTab();return}if(ar.target!==ar.currentTarget)return;const dr=getFocusIntent(ar,tr.orientation,tr.dir);if(dr!==void 0){if(ar.metaKey||ar.ctrlKey||ar.altKey||ar.shiftKey)return;ar.preventDefault();let fr=rr().filter(pr=>pr.focusable).map(pr=>pr.ref.current);if(dr==="last")fr.reverse();else if(dr==="prev"||dr==="next"){dr==="prev"&&fr.reverse();const pr=fr.indexOf(ar.currentTarget);fr=tr.loop?wrapArray$1(fr,pr+1):fr.slice(pr+1)}setTimeout(()=>focusFirst$1(fr))}})})})});RovingFocusGroupItem.displayName=ITEM_NAME$2;var MAP_KEY_TO_FOCUS_INTENT={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function getDirectionAwareKey(xt,e){return e!=="rtl"?xt:xt==="ArrowLeft"?"ArrowRight":xt==="ArrowRight"?"ArrowLeft":xt}function getFocusIntent(xt,e,At){const kt=getDirectionAwareKey(xt.key,At);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(kt))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(kt)))return MAP_KEY_TO_FOCUS_INTENT[kt]}function focusFirst$1(xt,e=!1){const At=document.activeElement;for(const kt of xt)if(kt===At||(kt.focus({preventScroll:e}),document.activeElement!==At))return}function wrapArray$1(xt,e){return xt.map((At,kt)=>xt[(e+kt)%xt.length])}var Root$2=RovingFocusGroup,Item=RovingFocusGroupItem,getDefaultParent=function(xt){if(typeof document>"u")return null;var e=Array.isArray(xt)?xt[0]:xt;return e.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(xt){return xt&&(xt.host||unwrapHost(xt.parentNode))},correctTargets=function(xt,e){return e.map(function(At){if(xt.contains(At))return At;var kt=unwrapHost(At);return kt&&xt.contains(kt)?kt:(console.error("aria-hidden",At,"in not contained inside",xt,". Doing nothing"),null)}).filter(function(At){return!!At})},applyAttributeToOthers=function(xt,e,At,kt){var Bt=correctTargets(e,Array.isArray(xt)?xt:[xt]);markerMap[At]||(markerMap[At]=new WeakMap);var Nt=markerMap[At],jt=[],Lt=new Set,er=new Set(Bt),tr=function(rr){!rr||Lt.has(rr)||(Lt.add(rr),tr(rr.parentNode))};Bt.forEach(tr);var zt=function(rr){!rr||er.has(rr)||Array.prototype.forEach.call(rr.children,function(nr){if(Lt.has(nr))zt(nr);else try{var ir=nr.getAttribute(kt),ar=ir!==null&&ir!=="false",dr=(counterMap.get(nr)||0)+1,ur=(Nt.get(nr)||0)+1;counterMap.set(nr,dr),Nt.set(nr,ur),jt.push(nr),dr===1&&ar&&uncontrolledNodes.set(nr,!0),ur===1&&nr.setAttribute(At,"true"),ar||nr.setAttribute(kt,"true")}catch(fr){console.error("aria-hidden: cannot operate on ",nr,fr)}})};return zt(e),Lt.clear(),lockCount++,function(){jt.forEach(function(rr){var nr=counterMap.get(rr)-1,ir=Nt.get(rr)-1;counterMap.set(rr,nr),Nt.set(rr,ir),nr||(uncontrolledNodes.has(rr)||rr.removeAttribute(kt),uncontrolledNodes.delete(rr)),ir||rr.removeAttribute(At)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(xt,e,At){At===void 0&&(At="data-aria-hidden");var kt=Array.from(Array.isArray(xt)?xt:[xt]),Bt=getDefaultParent(xt);return Bt?(kt.push.apply(kt,Array.from(Bt.querySelectorAll("[aria-live]"))),applyAttributeToOthers(kt,Bt,At,"aria-hidden")):function(){return null}},__assign=function(){return __assign=Object.assign||function(e){for(var At,kt=1,Bt=arguments.length;kt<Bt;kt++){At=arguments[kt];for(var Nt in At)Object.prototype.hasOwnProperty.call(At,Nt)&&(e[Nt]=At[Nt])}return e},__assign.apply(this,arguments)};function __rest(xt,e){var At={};for(var kt in xt)Object.prototype.hasOwnProperty.call(xt,kt)&&e.indexOf(kt)<0&&(At[kt]=xt[kt]);if(xt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Bt=0,kt=Object.getOwnPropertySymbols(xt);Bt<kt.length;Bt++)e.indexOf(kt[Bt])<0&&Object.prototype.propertyIsEnumerable.call(xt,kt[Bt])&&(At[kt[Bt]]=xt[kt[Bt]]);return At}function __spreadArray(xt,e,At){if(At||arguments.length===2)for(var kt=0,Bt=e.length,Nt;kt<Bt;kt++)(Nt||!(kt in e))&&(Nt||(Nt=Array.prototype.slice.call(e,0,kt)),Nt[kt]=e[kt]);return xt.concat(Nt||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(xt,e){return typeof xt=="function"?xt(e):xt&&(xt.current=e),xt}function useCallbackRef(xt,e){var At=reactExports.useState(function(){return{value:xt,callback:e,facade:{get current(){return At.value},set current(kt){var Bt=At.value;Bt!==kt&&(At.value=kt,At.callback(kt,Bt))}}}})[0];return At.callback=e,At.facade}var useIsomorphicLayoutEffect=typeof window<"u"?reactExports.useLayoutEffect:reactExports.useEffect,currentValues=new WeakMap;function useMergeRefs(xt,e){var At=useCallbackRef(null,function(kt){return xt.forEach(function(Bt){return assignRef(Bt,kt)})});return useIsomorphicLayoutEffect(function(){var kt=currentValues.get(At);if(kt){var Bt=new Set(kt),Nt=new Set(xt),jt=At.current;Bt.forEach(function(Lt){Nt.has(Lt)||assignRef(Lt,null)}),Nt.forEach(function(Lt){Bt.has(Lt)||assignRef(Lt,jt)})}currentValues.set(At,xt)},[xt]),At}function ItoI(xt){return xt}function innerCreateMedium(xt,e){e===void 0&&(e=ItoI);var At=[],kt=!1,Bt={read:function(){if(kt)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return At.length?At[At.length-1]:xt},useMedium:function(Nt){var jt=e(Nt,kt);return At.push(jt),function(){At=At.filter(function(Lt){return Lt!==jt})}},assignSyncMedium:function(Nt){for(kt=!0;At.length;){var jt=At;At=[],jt.forEach(Nt)}At={push:function(Lt){return Nt(Lt)},filter:function(){return At}}},assignMedium:function(Nt){kt=!0;var jt=[];if(At.length){var Lt=At;At=[],Lt.forEach(Nt),jt=At}var er=function(){var zt=jt;jt=[],zt.forEach(Nt)},tr=function(){return Promise.resolve().then(er)};tr(),At={push:function(zt){jt.push(zt),tr()},filter:function(zt){return jt=jt.filter(zt),At}}}};return Bt}function createSidecarMedium(xt){xt===void 0&&(xt={});var e=innerCreateMedium(null);return e.options=__assign({async:!0,ssr:!1},xt),e}var SideCar$1=function(xt){var e=xt.sideCar,At=__rest(xt,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var kt=e.read();if(!kt)throw new Error("Sidecar medium not found");return reactExports.createElement(kt,__assign({},At))};SideCar$1.isSideCarExport=!0;function exportSidecar(xt,e){return xt.useMedium(e),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=reactExports.forwardRef(function(xt,e){var At=reactExports.useRef(null),kt=reactExports.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),Bt=kt[0],Nt=kt[1],jt=xt.forwardProps,Lt=xt.children,er=xt.className,tr=xt.removeScrollBar,zt=xt.enabled,rr=xt.shards,nr=xt.sideCar,ir=xt.noIsolation,ar=xt.inert,dr=xt.allowPinchZoom,ur=xt.as,fr=ur===void 0?"div":ur,pr=xt.gapMode,lr=__rest(xt,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),yr=nr,br=useMergeRefs([At,e]),Ar=__assign(__assign({},lr),Bt);return reactExports.createElement(reactExports.Fragment,null,zt&&reactExports.createElement(yr,{sideCar:effectCar,removeScrollBar:tr,shards:rr,noIsolation:ir,inert:ar,setCallbacks:Nt,allowPinchZoom:!!dr,lockRef:At,gapMode:pr}),jt?reactExports.cloneElement(reactExports.Children.only(Lt),__assign(__assign({},Ar),{ref:br})):reactExports.createElement(fr,__assign({},Ar,{className:er,ref:br}),Lt))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var getNonce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var xt=document.createElement("style");xt.type="text/css";var e=getNonce();return e&&xt.setAttribute("nonce",e),xt}function injectStyles(xt,e){xt.styleSheet?xt.styleSheet.cssText=e:xt.appendChild(document.createTextNode(e))}function insertStyleTag(xt){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(xt)}var stylesheetSingleton=function(){var xt=0,e=null;return{add:function(At){xt==0&&(e=makeStyleTag())&&(injectStyles(e,At),insertStyleTag(e)),xt++},remove:function(){xt--,!xt&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},styleHookSingleton=function(){var xt=stylesheetSingleton();return function(e,At){reactExports.useEffect(function(){return xt.add(e),function(){xt.remove()}},[e&&At])}},styleSingleton=function(){var xt=styleHookSingleton(),e=function(At){var kt=At.styles,Bt=At.dynamic;return xt(kt,Bt),null};return e},zeroGap={left:0,top:0,right:0,gap:0},parse=function(xt){return parseInt(xt||"",10)||0},getOffset=function(xt){var e=window.getComputedStyle(document.body),At=e[xt==="padding"?"paddingLeft":"marginLeft"],kt=e[xt==="padding"?"paddingTop":"marginTop"],Bt=e[xt==="padding"?"paddingRight":"marginRight"];return[parse(At),parse(kt),parse(Bt)]},getGapWidth=function(xt){if(xt===void 0&&(xt="margin"),typeof window>"u")return zeroGap;var e=getOffset(xt),At=document.documentElement.clientWidth,kt=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,kt-At+e[2]-e[0])}},Style=styleSingleton(),lockAttribute="data-scroll-locked",getStyles=function(xt,e,At,kt){var Bt=xt.left,Nt=xt.top,jt=xt.right,Lt=xt.gap;return At===void 0&&(At="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(kt,`;
   padding-right: `).concat(Lt,"px ").concat(kt,`;
  }
  body[`).concat(lockAttribute,`] {
    overflow: hidden `).concat(kt,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(kt,";"),At==="margin"&&`
    padding-left: `.concat(Bt,`px;
    padding-top: `).concat(Nt,`px;
    padding-right: `).concat(jt,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(Lt,"px ").concat(kt,`;
    `),At==="padding"&&"padding-right: ".concat(Lt,"px ").concat(kt,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(Lt,"px ").concat(kt,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(Lt,"px ").concat(kt,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(kt,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(kt,`;
  }
  
  body[`).concat(lockAttribute,`] {
    `).concat(removedBarSizeVariable,": ").concat(Lt,`px;
  }
`)},getCurrentUseCounter=function(){var xt=parseInt(document.body.getAttribute(lockAttribute)||"0",10);return isFinite(xt)?xt:0},useLockAttribute=function(){reactExports.useEffect(function(){return document.body.setAttribute(lockAttribute,(getCurrentUseCounter()+1).toString()),function(){var xt=getCurrentUseCounter()-1;xt<=0?document.body.removeAttribute(lockAttribute):document.body.setAttribute(lockAttribute,xt.toString())}},[])},RemoveScrollBar=function(xt){var e=xt.noRelative,At=xt.noImportant,kt=xt.gapMode,Bt=kt===void 0?"margin":kt;useLockAttribute();var Nt=reactExports.useMemo(function(){return getGapWidth(Bt)},[Bt]);return reactExports.createElement(Style,{styles:getStyles(Nt,!e,Bt,At?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(xt){return xt.tagName==="TEXTAREA"},elementCanBeScrolled=function(xt,e){var At=window.getComputedStyle(xt);return At[e]!=="hidden"&&!(At.overflowY===At.overflowX&&!alwaysContainsScroll(xt)&&At[e]==="visible")},elementCouldBeVScrolled=function(xt){return elementCanBeScrolled(xt,"overflowY")},elementCouldBeHScrolled=function(xt){return elementCanBeScrolled(xt,"overflowX")},locationCouldBeScrolled=function(xt,e){var At=e.ownerDocument,kt=e;do{typeof ShadowRoot<"u"&&kt instanceof ShadowRoot&&(kt=kt.host);var Bt=elementCouldBeScrolled(xt,kt);if(Bt){var Nt=getScrollVariables(xt,kt),jt=Nt[1],Lt=Nt[2];if(jt>Lt)return!0}kt=kt.parentNode}while(kt&&kt!==At.body);return!1},getVScrollVariables=function(xt){var e=xt.scrollTop,At=xt.scrollHeight,kt=xt.clientHeight;return[e,At,kt]},getHScrollVariables=function(xt){var e=xt.scrollLeft,At=xt.scrollWidth,kt=xt.clientWidth;return[e,At,kt]},elementCouldBeScrolled=function(xt,e){return xt==="v"?elementCouldBeVScrolled(e):elementCouldBeHScrolled(e)},getScrollVariables=function(xt,e){return xt==="v"?getVScrollVariables(e):getHScrollVariables(e)},getDirectionFactor=function(xt,e){return xt==="h"&&e==="rtl"?-1:1},handleScroll=function(xt,e,At,kt,Bt){var Nt=getDirectionFactor(xt,window.getComputedStyle(e).direction),jt=Nt*kt,Lt=At.target,er=e.contains(Lt),tr=!1,zt=jt>0,rr=0,nr=0;do{var ir=getScrollVariables(xt,Lt),ar=ir[0],dr=ir[1],ur=ir[2],fr=dr-ur-Nt*ar;(ar||fr)&&elementCouldBeScrolled(xt,Lt)&&(rr+=fr,nr+=ar),Lt instanceof ShadowRoot?Lt=Lt.host:Lt=Lt.parentNode}while(!er&&Lt!==document.body||er&&(e.contains(Lt)||e===Lt));return(zt&&(Math.abs(rr)<1||!Bt)||!zt&&(Math.abs(nr)<1||!Bt))&&(tr=!0),tr},getTouchXY=function(xt){return"changedTouches"in xt?[xt.changedTouches[0].clientX,xt.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(xt){return[xt.deltaX,xt.deltaY]},extractRef=function(xt){return xt&&"current"in xt?xt.current:xt},deltaCompare=function(xt,e){return xt[0]===e[0]&&xt[1]===e[1]},generateStyle=function(xt){return`
  .block-interactivity-`.concat(xt,` {pointer-events: none;}
  .allow-interactivity-`).concat(xt,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(xt){var e=reactExports.useRef([]),At=reactExports.useRef([0,0]),kt=reactExports.useRef(),Bt=reactExports.useState(idCounter++)[0],Nt=reactExports.useState(styleSingleton)[0],jt=reactExports.useRef(xt);reactExports.useEffect(function(){jt.current=xt},[xt]),reactExports.useEffect(function(){if(xt.inert){document.body.classList.add("block-interactivity-".concat(Bt));var dr=__spreadArray([xt.lockRef.current],(xt.shards||[]).map(extractRef),!0).filter(Boolean);return dr.forEach(function(ur){return ur.classList.add("allow-interactivity-".concat(Bt))}),function(){document.body.classList.remove("block-interactivity-".concat(Bt)),dr.forEach(function(ur){return ur.classList.remove("allow-interactivity-".concat(Bt))})}}},[xt.inert,xt.lockRef.current,xt.shards]);var Lt=reactExports.useCallback(function(dr,ur){if("touches"in dr&&dr.touches.length===2)return!jt.current.allowPinchZoom;var fr=getTouchXY(dr),pr=At.current,lr="deltaX"in dr?dr.deltaX:pr[0]-fr[0],yr="deltaY"in dr?dr.deltaY:pr[1]-fr[1],br,Ar=dr.target,Pr=Math.abs(lr)>Math.abs(yr)?"h":"v";if("touches"in dr&&Pr==="h"&&Ar.type==="range")return!1;var kr=locationCouldBeScrolled(Pr,Ar);if(!kr)return!0;if(kr?br=Pr:(br=Pr==="v"?"h":"v",kr=locationCouldBeScrolled(Pr,Ar)),!kr)return!1;if(!kt.current&&"changedTouches"in dr&&(lr||yr)&&(kt.current=br),!br)return!0;var Ur=kt.current||br;return handleScroll(Ur,ur,dr,Ur==="h"?lr:yr,!0)},[]),er=reactExports.useCallback(function(dr){var ur=dr;if(!(!lockStack.length||lockStack[lockStack.length-1]!==Nt)){var fr="deltaY"in ur?getDeltaXY(ur):getTouchXY(ur),pr=e.current.filter(function(br){return br.name===ur.type&&(br.target===ur.target||ur.target===br.shadowParent)&&deltaCompare(br.delta,fr)})[0];if(pr&&pr.should){ur.cancelable&&ur.preventDefault();return}if(!pr){var lr=(jt.current.shards||[]).map(extractRef).filter(Boolean).filter(function(br){return br.contains(ur.target)}),yr=lr.length>0?Lt(ur,lr[0]):!jt.current.noIsolation;yr&&ur.cancelable&&ur.preventDefault()}}},[]),tr=reactExports.useCallback(function(dr,ur,fr,pr){var lr={name:dr,delta:ur,target:fr,should:pr,shadowParent:getOutermostShadowParent(fr)};e.current.push(lr),setTimeout(function(){e.current=e.current.filter(function(yr){return yr!==lr})},1)},[]),zt=reactExports.useCallback(function(dr){At.current=getTouchXY(dr),kt.current=void 0},[]),rr=reactExports.useCallback(function(dr){tr(dr.type,getDeltaXY(dr),dr.target,Lt(dr,xt.lockRef.current))},[]),nr=reactExports.useCallback(function(dr){tr(dr.type,getTouchXY(dr),dr.target,Lt(dr,xt.lockRef.current))},[]);reactExports.useEffect(function(){return lockStack.push(Nt),xt.setCallbacks({onScrollCapture:rr,onWheelCapture:rr,onTouchMoveCapture:nr}),document.addEventListener("wheel",er,nonPassive),document.addEventListener("touchmove",er,nonPassive),document.addEventListener("touchstart",zt,nonPassive),function(){lockStack=lockStack.filter(function(dr){return dr!==Nt}),document.removeEventListener("wheel",er,nonPassive),document.removeEventListener("touchmove",er,nonPassive),document.removeEventListener("touchstart",zt,nonPassive)}},[]);var ir=xt.removeScrollBar,ar=xt.inert;return reactExports.createElement(reactExports.Fragment,null,ar?reactExports.createElement(Nt,{styles:generateStyle(Bt)}):null,ir?reactExports.createElement(RemoveScrollBar,{gapMode:xt.gapMode}):null)}function getOutermostShadowParent(xt){for(var e=null;xt!==null;)xt instanceof ShadowRoot&&(e=xt.host,xt=xt.host),xt=xt.parentNode;return e}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=reactExports.forwardRef(function(xt,e){return reactExports.createElement(RemoveScroll,__assign({},xt,{ref:e,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;var SELECTION_KEYS=["Enter"," "],FIRST_KEYS=["ArrowDown","PageUp","Home"],LAST_KEYS=["ArrowUp","PageDown","End"],FIRST_LAST_KEYS=[...FIRST_KEYS,...LAST_KEYS],SUB_OPEN_KEYS={ltr:[...SELECTION_KEYS,"ArrowRight"],rtl:[...SELECTION_KEYS,"ArrowLeft"]},SUB_CLOSE_KEYS={ltr:["ArrowLeft"],rtl:["ArrowRight"]},MENU_NAME="Menu",[Collection,useCollection,createCollectionScope]=createCollection(MENU_NAME),[createMenuContext,createMenuScope]=createContextScope(MENU_NAME,[createCollectionScope,createPopperScope,createRovingFocusGroupScope]),usePopperScope=createPopperScope(),useRovingFocusGroupScope=createRovingFocusGroupScope(),[MenuProvider,useMenuContext]=createMenuContext(MENU_NAME),[MenuRootProvider,useMenuRootContext]=createMenuContext(MENU_NAME),Menu=xt=>{const{__scopeMenu:e,open:At=!1,children:kt,dir:Bt,onOpenChange:Nt,modal:jt=!0}=xt,Lt=usePopperScope(e),[er,tr]=reactExports.useState(null),zt=reactExports.useRef(!1),rr=useCallbackRef$1(Nt),nr=useDirection(Bt);return reactExports.useEffect(()=>{const ir=()=>{zt.current=!0,document.addEventListener("pointerdown",ar,{capture:!0,once:!0}),document.addEventListener("pointermove",ar,{capture:!0,once:!0})},ar=()=>zt.current=!1;return document.addEventListener("keydown",ir,{capture:!0}),()=>{document.removeEventListener("keydown",ir,{capture:!0}),document.removeEventListener("pointerdown",ar,{capture:!0}),document.removeEventListener("pointermove",ar,{capture:!0})}},[]),jsxRuntimeExports.jsx(Root2$1,{...Lt,children:jsxRuntimeExports.jsx(MenuProvider,{scope:e,open:At,onOpenChange:rr,content:er,onContentChange:tr,children:jsxRuntimeExports.jsx(MenuRootProvider,{scope:e,onClose:reactExports.useCallback(()=>rr(!1),[rr]),isUsingKeyboardRef:zt,dir:nr,modal:jt,children:kt})})})};Menu.displayName=MENU_NAME;var ANCHOR_NAME="MenuAnchor",MenuAnchor=reactExports.forwardRef((xt,e)=>{const{__scopeMenu:At,...kt}=xt,Bt=usePopperScope(At);return jsxRuntimeExports.jsx(Anchor,{...Bt,...kt,ref:e})});MenuAnchor.displayName=ANCHOR_NAME;var PORTAL_NAME$1="MenuPortal",[PortalProvider,usePortalContext]=createMenuContext(PORTAL_NAME$1,{forceMount:void 0}),MenuPortal=xt=>{const{__scopeMenu:e,forceMount:At,children:kt,container:Bt}=xt,Nt=useMenuContext(PORTAL_NAME$1,e);return jsxRuntimeExports.jsx(PortalProvider,{scope:e,forceMount:At,children:jsxRuntimeExports.jsx(Presence,{present:At||Nt.open,children:jsxRuntimeExports.jsx(Portal$1,{asChild:!0,container:Bt,children:kt})})})};MenuPortal.displayName=PORTAL_NAME$1;var CONTENT_NAME$1="MenuContent",[MenuContentProvider,useMenuContentContext]=createMenuContext(CONTENT_NAME$1),MenuContent=reactExports.forwardRef((xt,e)=>{const At=usePortalContext(CONTENT_NAME$1,xt.__scopeMenu),{forceMount:kt=At.forceMount,...Bt}=xt,Nt=useMenuContext(CONTENT_NAME$1,xt.__scopeMenu),jt=useMenuRootContext(CONTENT_NAME$1,xt.__scopeMenu);return jsxRuntimeExports.jsx(Collection.Provider,{scope:xt.__scopeMenu,children:jsxRuntimeExports.jsx(Presence,{present:kt||Nt.open,children:jsxRuntimeExports.jsx(Collection.Slot,{scope:xt.__scopeMenu,children:jt.modal?jsxRuntimeExports.jsx(MenuRootContentModal,{...Bt,ref:e}):jsxRuntimeExports.jsx(MenuRootContentNonModal,{...Bt,ref:e})})})})}),MenuRootContentModal=reactExports.forwardRef((xt,e)=>{const At=useMenuContext(CONTENT_NAME$1,xt.__scopeMenu),kt=reactExports.useRef(null),Bt=useComposedRefs(e,kt);return reactExports.useEffect(()=>{const Nt=kt.current;if(Nt)return hideOthers(Nt)},[]),jsxRuntimeExports.jsx(MenuContentImpl,{...xt,ref:Bt,trapFocus:At.open,disableOutsidePointerEvents:At.open,disableOutsideScroll:!0,onFocusOutside:composeEventHandlers(xt.onFocusOutside,Nt=>Nt.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>At.onOpenChange(!1)})}),MenuRootContentNonModal=reactExports.forwardRef((xt,e)=>{const At=useMenuContext(CONTENT_NAME$1,xt.__scopeMenu);return jsxRuntimeExports.jsx(MenuContentImpl,{...xt,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>At.onOpenChange(!1)})}),MenuContentImpl=reactExports.forwardRef((xt,e)=>{const{__scopeMenu:At,loop:kt=!1,trapFocus:Bt,onOpenAutoFocus:Nt,onCloseAutoFocus:jt,disableOutsidePointerEvents:Lt,onEntryFocus:er,onEscapeKeyDown:tr,onPointerDownOutside:zt,onFocusOutside:rr,onInteractOutside:nr,onDismiss:ir,disableOutsideScroll:ar,...dr}=xt,ur=useMenuContext(CONTENT_NAME$1,At),fr=useMenuRootContext(CONTENT_NAME$1,At),pr=usePopperScope(At),lr=useRovingFocusGroupScope(At),yr=useCollection(At),[br,Ar]=reactExports.useState(null),Pr=reactExports.useRef(null),kr=useComposedRefs(e,Pr,ur.onContentChange),Ur=reactExports.useRef(0),Hr=reactExports.useRef(""),Lr=reactExports.useRef(0),Sr=reactExports.useRef(null),_r=reactExports.useRef("right"),gr=reactExports.useRef(0),wr=ar?ReactRemoveScroll:reactExports.Fragment,Dr=ar?{as:Slot,allowPinchZoom:!0}:void 0,xr=$r=>{var Cr,jr;const vr=Hr.current+$r,Er=yr().filter(Yr=>!Yr.disabled),Tr=document.activeElement,Rr=(Cr=Er.find(Yr=>Yr.ref.current===Tr))==null?void 0:Cr.textValue,Mr=Er.map(Yr=>Yr.textValue),Gr=getNextMatch(Mr,vr,Rr),Br=(jr=Er.find(Yr=>Yr.textValue===Gr))==null?void 0:jr.ref.current;(function Yr(Qr){Hr.current=Qr,window.clearTimeout(Ur.current),Qr!==""&&(Ur.current=window.setTimeout(()=>Yr(""),1e3))})(vr),Br&&setTimeout(()=>Br.focus())};reactExports.useEffect(()=>()=>window.clearTimeout(Ur.current),[]),useFocusGuards();const Ir=reactExports.useCallback($r=>{var Er,Tr;return _r.current===((Er=Sr.current)==null?void 0:Er.side)&&isPointerInGraceArea($r,(Tr=Sr.current)==null?void 0:Tr.area)},[]);return jsxRuntimeExports.jsx(MenuContentProvider,{scope:At,searchRef:Hr,onItemEnter:reactExports.useCallback($r=>{Ir($r)&&$r.preventDefault()},[Ir]),onItemLeave:reactExports.useCallback($r=>{var vr;Ir($r)||((vr=Pr.current)==null||vr.focus(),Ar(null))},[Ir]),onTriggerLeave:reactExports.useCallback($r=>{Ir($r)&&$r.preventDefault()},[Ir]),pointerGraceTimerRef:Lr,onPointerGraceIntentChange:reactExports.useCallback($r=>{Sr.current=$r},[]),children:jsxRuntimeExports.jsx(wr,{...Dr,children:jsxRuntimeExports.jsx(FocusScope,{asChild:!0,trapped:Bt,onMountAutoFocus:composeEventHandlers(Nt,$r=>{var vr;$r.preventDefault(),(vr=Pr.current)==null||vr.focus({preventScroll:!0})}),onUnmountAutoFocus:jt,children:jsxRuntimeExports.jsx(DismissableLayer,{asChild:!0,disableOutsidePointerEvents:Lt,onEscapeKeyDown:tr,onPointerDownOutside:zt,onFocusOutside:rr,onInteractOutside:nr,onDismiss:ir,children:jsxRuntimeExports.jsx(Root$2,{asChild:!0,...lr,dir:fr.dir,orientation:"vertical",loop:kt,currentTabStopId:br,onCurrentTabStopIdChange:Ar,onEntryFocus:composeEventHandlers(er,$r=>{fr.isUsingKeyboardRef.current||$r.preventDefault()}),preventScrollOnEntryFocus:!0,children:jsxRuntimeExports.jsx(Content,{role:"menu","aria-orientation":"vertical","data-state":getOpenState(ur.open),"data-radix-menu-content":"",dir:fr.dir,...pr,...dr,ref:kr,style:{outline:"none",...dr.style},onKeyDown:composeEventHandlers(dr.onKeyDown,$r=>{const Er=$r.target.closest("[data-radix-menu-content]")===$r.currentTarget,Tr=$r.ctrlKey||$r.altKey||$r.metaKey,Rr=$r.key.length===1;Er&&($r.key==="Tab"&&$r.preventDefault(),!Tr&&Rr&&xr($r.key));const Mr=Pr.current;if($r.target!==Mr||!FIRST_LAST_KEYS.includes($r.key))return;$r.preventDefault();const Br=yr().filter(Cr=>!Cr.disabled).map(Cr=>Cr.ref.current);LAST_KEYS.includes($r.key)&&Br.reverse(),focusFirst(Br)}),onBlur:composeEventHandlers(xt.onBlur,$r=>{$r.currentTarget.contains($r.target)||(window.clearTimeout(Ur.current),Hr.current="")}),onPointerMove:composeEventHandlers(xt.onPointerMove,whenMouse($r=>{const vr=$r.target,Er=gr.current!==$r.clientX;if($r.currentTarget.contains(vr)&&Er){const Tr=$r.clientX>gr.current?"right":"left";_r.current=Tr,gr.current=$r.clientX}}))})})})})})})});MenuContent.displayName=CONTENT_NAME$1;var GROUP_NAME$1="MenuGroup",MenuGroup=reactExports.forwardRef((xt,e)=>{const{__scopeMenu:At,...kt}=xt;return jsxRuntimeExports.jsx(Primitive.div,{role:"group",...kt,ref:e})});MenuGroup.displayName=GROUP_NAME$1;var LABEL_NAME$1="MenuLabel",MenuLabel=reactExports.forwardRef((xt,e)=>{const{__scopeMenu:At,...kt}=xt;return jsxRuntimeExports.jsx(Primitive.div,{...kt,ref:e})});MenuLabel.displayName=LABEL_NAME$1;var ITEM_NAME$1="MenuItem",ITEM_SELECT="menu.itemSelect",MenuItem=reactExports.forwardRef((xt,e)=>{const{disabled:At=!1,onSelect:kt,...Bt}=xt,Nt=reactExports.useRef(null),jt=useMenuRootContext(ITEM_NAME$1,xt.__scopeMenu),Lt=useMenuContentContext(ITEM_NAME$1,xt.__scopeMenu),er=useComposedRefs(e,Nt),tr=reactExports.useRef(!1),zt=()=>{const rr=Nt.current;if(!At&&rr){const nr=new CustomEvent(ITEM_SELECT,{bubbles:!0,cancelable:!0});rr.addEventListener(ITEM_SELECT,ir=>kt==null?void 0:kt(ir),{once:!0}),dispatchDiscreteCustomEvent(rr,nr),nr.defaultPrevented?tr.current=!1:jt.onClose()}};return jsxRuntimeExports.jsx(MenuItemImpl,{...Bt,ref:er,disabled:At,onClick:composeEventHandlers(xt.onClick,zt),onPointerDown:rr=>{var nr;(nr=xt.onPointerDown)==null||nr.call(xt,rr),tr.current=!0},onPointerUp:composeEventHandlers(xt.onPointerUp,rr=>{var nr;tr.current||(nr=rr.currentTarget)==null||nr.click()}),onKeyDown:composeEventHandlers(xt.onKeyDown,rr=>{const nr=Lt.searchRef.current!=="";At||nr&&rr.key===" "||SELECTION_KEYS.includes(rr.key)&&(rr.currentTarget.click(),rr.preventDefault())})})});MenuItem.displayName=ITEM_NAME$1;var MenuItemImpl=reactExports.forwardRef((xt,e)=>{const{__scopeMenu:At,disabled:kt=!1,textValue:Bt,...Nt}=xt,jt=useMenuContentContext(ITEM_NAME$1,At),Lt=useRovingFocusGroupScope(At),er=reactExports.useRef(null),tr=useComposedRefs(e,er),[zt,rr]=reactExports.useState(!1),[nr,ir]=reactExports.useState("");return reactExports.useEffect(()=>{const ar=er.current;ar&&ir((ar.textContent??"").trim())},[Nt.children]),jsxRuntimeExports.jsx(Collection.ItemSlot,{scope:At,disabled:kt,textValue:Bt??nr,children:jsxRuntimeExports.jsx(Item,{asChild:!0,...Lt,focusable:!kt,children:jsxRuntimeExports.jsx(Primitive.div,{role:"menuitem","data-highlighted":zt?"":void 0,"aria-disabled":kt||void 0,"data-disabled":kt?"":void 0,...Nt,ref:tr,onPointerMove:composeEventHandlers(xt.onPointerMove,whenMouse(ar=>{kt?jt.onItemLeave(ar):(jt.onItemEnter(ar),ar.defaultPrevented||ar.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:composeEventHandlers(xt.onPointerLeave,whenMouse(ar=>jt.onItemLeave(ar))),onFocus:composeEventHandlers(xt.onFocus,()=>rr(!0)),onBlur:composeEventHandlers(xt.onBlur,()=>rr(!1))})})})}),CHECKBOX_ITEM_NAME$1="MenuCheckboxItem",MenuCheckboxItem=reactExports.forwardRef((xt,e)=>{const{checked:At=!1,onCheckedChange:kt,...Bt}=xt;return jsxRuntimeExports.jsx(ItemIndicatorProvider,{scope:xt.__scopeMenu,checked:At,children:jsxRuntimeExports.jsx(MenuItem,{role:"menuitemcheckbox","aria-checked":isIndeterminate$1(At)?"mixed":At,...Bt,ref:e,"data-state":getCheckedState(At),onSelect:composeEventHandlers(Bt.onSelect,()=>kt==null?void 0:kt(isIndeterminate$1(At)?!0:!At),{checkForDefaultPrevented:!1})})})});MenuCheckboxItem.displayName=CHECKBOX_ITEM_NAME$1;var RADIO_GROUP_NAME$1="MenuRadioGroup",[RadioGroupProvider,useRadioGroupContext]=createMenuContext(RADIO_GROUP_NAME$1,{value:void 0,onValueChange:()=>{}}),MenuRadioGroup=reactExports.forwardRef((xt,e)=>{const{value:At,onValueChange:kt,...Bt}=xt,Nt=useCallbackRef$1(kt);return jsxRuntimeExports.jsx(RadioGroupProvider,{scope:xt.__scopeMenu,value:At,onValueChange:Nt,children:jsxRuntimeExports.jsx(MenuGroup,{...Bt,ref:e})})});MenuRadioGroup.displayName=RADIO_GROUP_NAME$1;var RADIO_ITEM_NAME$1="MenuRadioItem",MenuRadioItem=reactExports.forwardRef((xt,e)=>{const{value:At,...kt}=xt,Bt=useRadioGroupContext(RADIO_ITEM_NAME$1,xt.__scopeMenu),Nt=At===Bt.value;return jsxRuntimeExports.jsx(ItemIndicatorProvider,{scope:xt.__scopeMenu,checked:Nt,children:jsxRuntimeExports.jsx(MenuItem,{role:"menuitemradio","aria-checked":Nt,...kt,ref:e,"data-state":getCheckedState(Nt),onSelect:composeEventHandlers(kt.onSelect,()=>{var jt;return(jt=Bt.onValueChange)==null?void 0:jt.call(Bt,At)},{checkForDefaultPrevented:!1})})})});MenuRadioItem.displayName=RADIO_ITEM_NAME$1;var ITEM_INDICATOR_NAME="MenuItemIndicator",[ItemIndicatorProvider,useItemIndicatorContext]=createMenuContext(ITEM_INDICATOR_NAME,{checked:!1}),MenuItemIndicator=reactExports.forwardRef((xt,e)=>{const{__scopeMenu:At,forceMount:kt,...Bt}=xt,Nt=useItemIndicatorContext(ITEM_INDICATOR_NAME,At);return jsxRuntimeExports.jsx(Presence,{present:kt||isIndeterminate$1(Nt.checked)||Nt.checked===!0,children:jsxRuntimeExports.jsx(Primitive.span,{...Bt,ref:e,"data-state":getCheckedState(Nt.checked)})})});MenuItemIndicator.displayName=ITEM_INDICATOR_NAME;var SEPARATOR_NAME$1="MenuSeparator",MenuSeparator=reactExports.forwardRef((xt,e)=>{const{__scopeMenu:At,...kt}=xt;return jsxRuntimeExports.jsx(Primitive.div,{role:"separator","aria-orientation":"horizontal",...kt,ref:e})});MenuSeparator.displayName=SEPARATOR_NAME$1;var ARROW_NAME$1="MenuArrow",MenuArrow=reactExports.forwardRef((xt,e)=>{const{__scopeMenu:At,...kt}=xt,Bt=usePopperScope(At);return jsxRuntimeExports.jsx(Arrow,{...Bt,...kt,ref:e})});MenuArrow.displayName=ARROW_NAME$1;var SUB_NAME="MenuSub",[MenuSubProvider,useMenuSubContext]=createMenuContext(SUB_NAME),SUB_TRIGGER_NAME$1="MenuSubTrigger",MenuSubTrigger=reactExports.forwardRef((xt,e)=>{const At=useMenuContext(SUB_TRIGGER_NAME$1,xt.__scopeMenu),kt=useMenuRootContext(SUB_TRIGGER_NAME$1,xt.__scopeMenu),Bt=useMenuSubContext(SUB_TRIGGER_NAME$1,xt.__scopeMenu),Nt=useMenuContentContext(SUB_TRIGGER_NAME$1,xt.__scopeMenu),jt=reactExports.useRef(null),{pointerGraceTimerRef:Lt,onPointerGraceIntentChange:er}=Nt,tr={__scopeMenu:xt.__scopeMenu},zt=reactExports.useCallback(()=>{jt.current&&window.clearTimeout(jt.current),jt.current=null},[]);return reactExports.useEffect(()=>zt,[zt]),reactExports.useEffect(()=>{const rr=Lt.current;return()=>{window.clearTimeout(rr),er(null)}},[Lt,er]),jsxRuntimeExports.jsx(MenuAnchor,{asChild:!0,...tr,children:jsxRuntimeExports.jsx(MenuItemImpl,{id:Bt.triggerId,"aria-haspopup":"menu","aria-expanded":At.open,"aria-controls":Bt.contentId,"data-state":getOpenState(At.open),...xt,ref:composeRefs(e,Bt.onTriggerChange),onClick:rr=>{var nr;(nr=xt.onClick)==null||nr.call(xt,rr),!(xt.disabled||rr.defaultPrevented)&&(rr.currentTarget.focus(),At.open||At.onOpenChange(!0))},onPointerMove:composeEventHandlers(xt.onPointerMove,whenMouse(rr=>{Nt.onItemEnter(rr),!rr.defaultPrevented&&!xt.disabled&&!At.open&&!jt.current&&(Nt.onPointerGraceIntentChange(null),jt.current=window.setTimeout(()=>{At.onOpenChange(!0),zt()},100))})),onPointerLeave:composeEventHandlers(xt.onPointerLeave,whenMouse(rr=>{var ir,ar;zt();const nr=(ir=At.content)==null?void 0:ir.getBoundingClientRect();if(nr){const dr=(ar=At.content)==null?void 0:ar.dataset.side,ur=dr==="right",fr=ur?-5:5,pr=nr[ur?"left":"right"],lr=nr[ur?"right":"left"];Nt.onPointerGraceIntentChange({area:[{x:rr.clientX+fr,y:rr.clientY},{x:pr,y:nr.top},{x:lr,y:nr.top},{x:lr,y:nr.bottom},{x:pr,y:nr.bottom}],side:dr}),window.clearTimeout(Lt.current),Lt.current=window.setTimeout(()=>Nt.onPointerGraceIntentChange(null),300)}else{if(Nt.onTriggerLeave(rr),rr.defaultPrevented)return;Nt.onPointerGraceIntentChange(null)}})),onKeyDown:composeEventHandlers(xt.onKeyDown,rr=>{var ir;const nr=Nt.searchRef.current!=="";xt.disabled||nr&&rr.key===" "||SUB_OPEN_KEYS[kt.dir].includes(rr.key)&&(At.onOpenChange(!0),(ir=At.content)==null||ir.focus(),rr.preventDefault())})})})});MenuSubTrigger.displayName=SUB_TRIGGER_NAME$1;var SUB_CONTENT_NAME$1="MenuSubContent",MenuSubContent=reactExports.forwardRef((xt,e)=>{const At=usePortalContext(CONTENT_NAME$1,xt.__scopeMenu),{forceMount:kt=At.forceMount,...Bt}=xt,Nt=useMenuContext(CONTENT_NAME$1,xt.__scopeMenu),jt=useMenuRootContext(CONTENT_NAME$1,xt.__scopeMenu),Lt=useMenuSubContext(SUB_CONTENT_NAME$1,xt.__scopeMenu),er=reactExports.useRef(null),tr=useComposedRefs(e,er);return jsxRuntimeExports.jsx(Collection.Provider,{scope:xt.__scopeMenu,children:jsxRuntimeExports.jsx(Presence,{present:kt||Nt.open,children:jsxRuntimeExports.jsx(Collection.Slot,{scope:xt.__scopeMenu,children:jsxRuntimeExports.jsx(MenuContentImpl,{id:Lt.contentId,"aria-labelledby":Lt.triggerId,...Bt,ref:tr,align:"start",side:jt.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:zt=>{var rr;jt.isUsingKeyboardRef.current&&((rr=er.current)==null||rr.focus()),zt.preventDefault()},onCloseAutoFocus:zt=>zt.preventDefault(),onFocusOutside:composeEventHandlers(xt.onFocusOutside,zt=>{zt.target!==Lt.trigger&&Nt.onOpenChange(!1)}),onEscapeKeyDown:composeEventHandlers(xt.onEscapeKeyDown,zt=>{jt.onClose(),zt.preventDefault()}),onKeyDown:composeEventHandlers(xt.onKeyDown,zt=>{var ir;const rr=zt.currentTarget.contains(zt.target),nr=SUB_CLOSE_KEYS[jt.dir].includes(zt.key);rr&&nr&&(Nt.onOpenChange(!1),(ir=Lt.trigger)==null||ir.focus(),zt.preventDefault())})})})})})});MenuSubContent.displayName=SUB_CONTENT_NAME$1;function getOpenState(xt){return xt?"open":"closed"}function isIndeterminate$1(xt){return xt==="indeterminate"}function getCheckedState(xt){return isIndeterminate$1(xt)?"indeterminate":xt?"checked":"unchecked"}function focusFirst(xt){const e=document.activeElement;for(const At of xt)if(At===e||(At.focus(),document.activeElement!==e))return}function wrapArray(xt,e){return xt.map((At,kt)=>xt[(e+kt)%xt.length])}function getNextMatch(xt,e,At){const Bt=e.length>1&&Array.from(e).every(tr=>tr===e[0])?e[0]:e,Nt=At?xt.indexOf(At):-1;let jt=wrapArray(xt,Math.max(Nt,0));Bt.length===1&&(jt=jt.filter(tr=>tr!==At));const er=jt.find(tr=>tr.toLowerCase().startsWith(Bt.toLowerCase()));return er!==At?er:void 0}function isPointInPolygon(xt,e){const{x:At,y:kt}=xt;let Bt=!1;for(let Nt=0,jt=e.length-1;Nt<e.length;jt=Nt++){const Lt=e[Nt].x,er=e[Nt].y,tr=e[jt].x,zt=e[jt].y;er>kt!=zt>kt&&At<(tr-Lt)*(kt-er)/(zt-er)+Lt&&(Bt=!Bt)}return Bt}function isPointerInGraceArea(xt,e){if(!e)return!1;const At={x:xt.clientX,y:xt.clientY};return isPointInPolygon(At,e)}function whenMouse(xt){return e=>e.pointerType==="mouse"?xt(e):void 0}var Root3=Menu,Anchor2=MenuAnchor,Portal=MenuPortal,Content2$1=MenuContent,Group=MenuGroup,Label$2=MenuLabel,Item2$1=MenuItem,CheckboxItem=MenuCheckboxItem,RadioGroup=MenuRadioGroup,RadioItem=MenuRadioItem,ItemIndicator=MenuItemIndicator,Separator=MenuSeparator,Arrow2=MenuArrow,SubTrigger=MenuSubTrigger,SubContent=MenuSubContent,DROPDOWN_MENU_NAME="DropdownMenu",[createDropdownMenuContext,createDropdownMenuScope]=createContextScope(DROPDOWN_MENU_NAME,[createMenuScope]),useMenuScope=createMenuScope(),[DropdownMenuProvider,useDropdownMenuContext]=createDropdownMenuContext(DROPDOWN_MENU_NAME),DropdownMenu$1=xt=>{const{__scopeDropdownMenu:e,children:At,dir:kt,open:Bt,defaultOpen:Nt,onOpenChange:jt,modal:Lt=!0}=xt,er=useMenuScope(e),tr=reactExports.useRef(null),[zt=!1,rr]=useControllableState({prop:Bt,defaultProp:Nt,onChange:jt});return jsxRuntimeExports.jsx(DropdownMenuProvider,{scope:e,triggerId:useId(),triggerRef:tr,contentId:useId(),open:zt,onOpenChange:rr,onOpenToggle:reactExports.useCallback(()=>rr(nr=>!nr),[rr]),modal:Lt,children:jsxRuntimeExports.jsx(Root3,{...er,open:zt,onOpenChange:rr,dir:kt,modal:Lt,children:At})})};DropdownMenu$1.displayName=DROPDOWN_MENU_NAME;var TRIGGER_NAME="DropdownMenuTrigger",DropdownMenuTrigger$1=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,disabled:kt=!1,...Bt}=xt,Nt=useDropdownMenuContext(TRIGGER_NAME,At),jt=useMenuScope(At);return jsxRuntimeExports.jsx(Anchor2,{asChild:!0,...jt,children:jsxRuntimeExports.jsx(Primitive.button,{type:"button",id:Nt.triggerId,"aria-haspopup":"menu","aria-expanded":Nt.open,"aria-controls":Nt.open?Nt.contentId:void 0,"data-state":Nt.open?"open":"closed","data-disabled":kt?"":void 0,disabled:kt,...Bt,ref:composeRefs(e,Nt.triggerRef),onPointerDown:composeEventHandlers(xt.onPointerDown,Lt=>{!kt&&Lt.button===0&&Lt.ctrlKey===!1&&(Nt.onOpenToggle(),Nt.open||Lt.preventDefault())}),onKeyDown:composeEventHandlers(xt.onKeyDown,Lt=>{kt||(["Enter"," "].includes(Lt.key)&&Nt.onOpenToggle(),Lt.key==="ArrowDown"&&Nt.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(Lt.key)&&Lt.preventDefault())})})})});DropdownMenuTrigger$1.displayName=TRIGGER_NAME;var PORTAL_NAME="DropdownMenuPortal",DropdownMenuPortal=xt=>{const{__scopeDropdownMenu:e,...At}=xt,kt=useMenuScope(e);return jsxRuntimeExports.jsx(Portal,{...kt,...At})};DropdownMenuPortal.displayName=PORTAL_NAME;var CONTENT_NAME="DropdownMenuContent",DropdownMenuContent$1=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useDropdownMenuContext(CONTENT_NAME,At),Nt=useMenuScope(At),jt=reactExports.useRef(!1);return jsxRuntimeExports.jsx(Content2$1,{id:Bt.contentId,"aria-labelledby":Bt.triggerId,...Nt,...kt,ref:e,onCloseAutoFocus:composeEventHandlers(xt.onCloseAutoFocus,Lt=>{var er;jt.current||(er=Bt.triggerRef.current)==null||er.focus(),jt.current=!1,Lt.preventDefault()}),onInteractOutside:composeEventHandlers(xt.onInteractOutside,Lt=>{const er=Lt.detail.originalEvent,tr=er.button===0&&er.ctrlKey===!0,zt=er.button===2||tr;(!Bt.modal||zt)&&(jt.current=!0)}),style:{...xt.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});DropdownMenuContent$1.displayName=CONTENT_NAME;var GROUP_NAME="DropdownMenuGroup",DropdownMenuGroup=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(Group,{...Bt,...kt,ref:e})});DropdownMenuGroup.displayName=GROUP_NAME;var LABEL_NAME="DropdownMenuLabel",DropdownMenuLabel$1=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(Label$2,{...Bt,...kt,ref:e})});DropdownMenuLabel$1.displayName=LABEL_NAME;var ITEM_NAME="DropdownMenuItem",DropdownMenuItem$1=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(Item2$1,{...Bt,...kt,ref:e})});DropdownMenuItem$1.displayName=ITEM_NAME;var CHECKBOX_ITEM_NAME="DropdownMenuCheckboxItem",DropdownMenuCheckboxItem$1=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(CheckboxItem,{...Bt,...kt,ref:e})});DropdownMenuCheckboxItem$1.displayName=CHECKBOX_ITEM_NAME;var RADIO_GROUP_NAME="DropdownMenuRadioGroup",DropdownMenuRadioGroup=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(RadioGroup,{...Bt,...kt,ref:e})});DropdownMenuRadioGroup.displayName=RADIO_GROUP_NAME;var RADIO_ITEM_NAME="DropdownMenuRadioItem",DropdownMenuRadioItem$1=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(RadioItem,{...Bt,...kt,ref:e})});DropdownMenuRadioItem$1.displayName=RADIO_ITEM_NAME;var INDICATOR_NAME$1="DropdownMenuItemIndicator",DropdownMenuItemIndicator=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(ItemIndicator,{...Bt,...kt,ref:e})});DropdownMenuItemIndicator.displayName=INDICATOR_NAME$1;var SEPARATOR_NAME="DropdownMenuSeparator",DropdownMenuSeparator$1=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(Separator,{...Bt,...kt,ref:e})});DropdownMenuSeparator$1.displayName=SEPARATOR_NAME;var ARROW_NAME="DropdownMenuArrow",DropdownMenuArrow=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(Arrow2,{...Bt,...kt,ref:e})});DropdownMenuArrow.displayName=ARROW_NAME;var SUB_TRIGGER_NAME="DropdownMenuSubTrigger",DropdownMenuSubTrigger$1=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(SubTrigger,{...Bt,...kt,ref:e})});DropdownMenuSubTrigger$1.displayName=SUB_TRIGGER_NAME;var SUB_CONTENT_NAME="DropdownMenuSubContent",DropdownMenuSubContent$1=reactExports.forwardRef((xt,e)=>{const{__scopeDropdownMenu:At,...kt}=xt,Bt=useMenuScope(At);return jsxRuntimeExports.jsx(SubContent,{...Bt,...kt,ref:e,style:{...xt.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});DropdownMenuSubContent$1.displayName=SUB_CONTENT_NAME;var Root2=DropdownMenu$1,Trigger=DropdownMenuTrigger$1,Portal2=DropdownMenuPortal,Content2=DropdownMenuContent$1,Label2=DropdownMenuLabel$1,Item2=DropdownMenuItem$1,CheckboxItem2=DropdownMenuCheckboxItem$1,RadioItem2=DropdownMenuRadioItem$1,ItemIndicator2=DropdownMenuItemIndicator,Separator2=DropdownMenuSeparator$1,SubTrigger2=DropdownMenuSubTrigger$1,SubContent2=DropdownMenuSubContent$1;const DropdownMenu=Root2,DropdownMenuTrigger=Trigger,DropdownMenuSubTrigger=reactExports.forwardRef(({className:xt,inset:e,children:At,...kt},Bt)=>jsxRuntimeExports.jsxs(SubTrigger2,{ref:Bt,className:cn("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",e&&"pl-8",xt),...kt,children:[At,jsxRuntimeExports.jsx(ChevronRight,{className:"ml-auto h-4 w-4"})]}));DropdownMenuSubTrigger.displayName=SubTrigger2.displayName;const DropdownMenuSubContent=reactExports.forwardRef(({className:xt,...e},At)=>jsxRuntimeExports.jsx(SubContent2,{ref:At,className:cn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",xt),...e}));DropdownMenuSubContent.displayName=SubContent2.displayName;const DropdownMenuContent=reactExports.forwardRef(({className:xt,sideOffset:e=4,...At},kt)=>jsxRuntimeExports.jsx(Portal2,{children:jsxRuntimeExports.jsx(Content2,{ref:kt,sideOffset:e,className:cn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",xt),...At})}));DropdownMenuContent.displayName=Content2.displayName;const DropdownMenuItem=reactExports.forwardRef(({className:xt,inset:e,...At},kt)=>jsxRuntimeExports.jsx(Item2,{ref:kt,className:cn("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e&&"pl-8",xt),...At}));DropdownMenuItem.displayName=Item2.displayName;const DropdownMenuCheckboxItem=reactExports.forwardRef(({className:xt,children:e,checked:At,...kt},Bt)=>jsxRuntimeExports.jsxs(CheckboxItem2,{ref:Bt,className:cn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",xt),checked:At,...kt,children:[jsxRuntimeExports.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:jsxRuntimeExports.jsx(ItemIndicator2,{children:jsxRuntimeExports.jsx(Check,{className:"h-4 w-4"})})}),e]}));DropdownMenuCheckboxItem.displayName=CheckboxItem2.displayName;const DropdownMenuRadioItem=reactExports.forwardRef(({className:xt,children:e,...At},kt)=>jsxRuntimeExports.jsxs(RadioItem2,{ref:kt,className:cn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",xt),...At,children:[jsxRuntimeExports.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:jsxRuntimeExports.jsx(ItemIndicator2,{children:jsxRuntimeExports.jsx(Circle,{className:"h-2 w-2 fill-current"})})}),e]}));DropdownMenuRadioItem.displayName=RadioItem2.displayName;const DropdownMenuLabel=reactExports.forwardRef(({className:xt,inset:e,...At},kt)=>jsxRuntimeExports.jsx(Label2,{ref:kt,className:cn("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",xt),...At}));DropdownMenuLabel.displayName=Label2.displayName;const DropdownMenuSeparator=reactExports.forwardRef(({className:xt,...e},At)=>jsxRuntimeExports.jsx(Separator2,{ref:At,className:cn("-mx-1 my-1 h-px bg-muted",xt),...e}));DropdownMenuSeparator.displayName=Separator2.displayName;const initialState={theme:"system",setTheme:()=>null},ThemeProviderContext=reactExports.createContext(initialState);function ThemeProvider({children:xt,defaultTheme:e="system",storageKey:At="vite-ui-theme",...kt}){const[Bt,Nt]=reactExports.useState(()=>localStorage.getItem(At)||e);reactExports.useEffect(()=>{const Lt=window.document.documentElement;if(Lt.classList.remove("light","dark"),Bt==="system"){const er=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";Lt.classList.add(er);return}Lt.classList.add(Bt),Lt.style.setProperty("color-scheme",Bt)},[Bt]);const jt={theme:Bt,setTheme:Lt=>{localStorage.setItem(At,Lt),Nt(Lt)}};return jsxRuntimeExports.jsx(ThemeProviderContext.Provider,{...kt,value:jt,children:xt})}const useTheme=()=>{const xt=reactExports.useContext(ThemeProviderContext);if(xt===void 0)throw new Error("useTheme must be used within a ThemeProvider");return xt};function ModeToggle(){const{setTheme:xt}=useTheme();return jsxRuntimeExports.jsxs(DropdownMenu,{children:[jsxRuntimeExports.jsx(DropdownMenuTrigger,{asChild:!0,children:jsxRuntimeExports.jsxs(Button,{variant:"outline",size:"icon",children:[jsxRuntimeExports.jsx(Sun,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),jsxRuntimeExports.jsx(Moon,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),jsxRuntimeExports.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),jsxRuntimeExports.jsxs(DropdownMenuContent,{align:"end",children:[jsxRuntimeExports.jsx(DropdownMenuItem,{onClick:()=>xt("light"),children:"Light"}),jsxRuntimeExports.jsx(DropdownMenuItem,{onClick:()=>xt("dark"),children:"Dark"}),jsxRuntimeExports.jsx(DropdownMenuItem,{onClick:()=>xt("system"),children:"System"})]})]})}const SidebarButton=()=>{const[xt,e]=reactExports.useState(!1);return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",className:"m-2",onClick:()=>e(!xt),children:jsxRuntimeExports.jsx(Menu$1,{className:"h-6 w-6"})}),xt&&jsxRuntimeExports.jsx("div",{className:"sidebar-overlay",onClick:()=>e(!1)}),jsxRuntimeExports.jsxs("div",{className:`sidebar-content ${xt?"open":"closed"}`,children:[jsxRuntimeExports.jsx("div",{className:"absolute right-4 top-2",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",onClick:()=>e(!xt),children:jsxRuntimeExports.jsx(X$1,{className:"h-6 w-6"})})}),jsxRuntimeExports.jsx(Sidebar,{className:"mt-8 min-h-full",onItemClick:()=>e(!1)})]})]})},Sidebar=({className:xt,onItemClick:e})=>{const{isConnected:At}=useWeb5();return jsxRuntimeExports.jsxs("nav",{className:cn("pb-12 flex flex-col justify-between",xt),children:[jsxRuntimeExports.jsx("div",{className:"space-y-4 py-4",children:jsxRuntimeExports.jsxs("div",{className:"px-3 py-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between mb-2 px-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold tracking-tight",children:"My DWA"}),jsxRuntimeExports.jsx(ModeToggle,{})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx(SidebarMenuItem,{onItemClick:e,icon:House,label:"Home",path:"/"}),At&&jsxRuntimeExports.jsx(SidebarMenuItem,{onItemClick:e,icon:Settings,label:"Settings",path:"/settings"}),jsxRuntimeExports.jsx(SidebarMenuItem,{onItemClick:e,icon:LifeBuoy,label:"About",path:"/about"})]})]})}),jsxRuntimeExports.jsx("div",{className:"p-4",children:jsxRuntimeExports.jsx(Web5Connection,{connectButtonClassName:"w-full justify-between"})})]})},SidebarMenuItem=({icon:xt,label:e,path:At,onItemClick:kt})=>{const Bt=useNavigate(),Lt=useLocation().pathname===At?"secondary":"ghost";return jsxRuntimeExports.jsxs(Button,{variant:Lt,className:"w-full justify-start",onClick:()=>{Bt(At),kt==null||kt()},children:[jsxRuntimeExports.jsx(xt,{className:"mr-2 h-4 w-4"}),e]})},drlReadProtocolUrl=(xt,e,At)=>{const kt=encodeURIComponent(`${e}`);return`https://dweb/${xt}/read/protocols/${kt}/${At}`},drlReadProtocol=async(xt,e,At)=>{const kt=drlReadProtocolUrl(xt,e,At);return fetch(kt)},drlReadProtocolJson=async(xt,e,At)=>{const kt=await drlReadProtocol(xt,e,At);return console.info("drlReadProtocolJson",{res:kt}),handleJsonResponse(kt)},handleJsonResponse=async xt=>{if(xt.ok)return xt.json();{const e=await xt.text().catch(At=>At);throw new Error(`${xt.status} ${e}`)}};var NAME="Label",Label$1=reactExports.forwardRef((xt,e)=>jsxRuntimeExports.jsx(Primitive.label,{...xt,ref:e,onMouseDown:At=>{var Bt;At.target.closest("button, input, select, textarea")||((Bt=xt.onMouseDown)==null||Bt.call(xt,At),!At.defaultPrevented&&At.detail>1&&At.preventDefault())}}));Label$1.displayName=NAME;var Root$1=Label$1;const labelVariants=cva("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Label=reactExports.forwardRef(({className:xt,...e},At)=>jsxRuntimeExports.jsx(Root$1,{ref:At,className:cn(labelVariants(),xt),...e}));Label.displayName=Root$1.displayName;const ProfileSettings=()=>{const{dwn:xt,did:e}=useWeb5(),[At,kt]=reactExports.useState(!1),[Bt,Nt]=reactExports.useState(!1),[jt,Lt]=reactExports.useState(""),[er,tr]=reactExports.useState(!1),[zt,rr]=reactExports.useState(),[nr,ir]=reactExports.useState(),ar=reactExports.useRef(null);if(reactExports.useEffect(()=>{e&&dr()},[e]),!xt||!e)return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:"Web5 not initialized"});const dr=async()=>{try{const br=await drlReadProtocolJson(e,profile.uri,"name");Lt(br==null?void 0:br.displayName),tr(!0)}catch(br){console.info("fail to load profile, it's ok if it's not found",br)}},ur=br=>{var Pr;const Ar=(Pr=br.target.files)==null?void 0:Pr[0];Ar&&(rr(Ar),Nt(!0))},fr=br=>{jt!==br.target.value&&(Lt(br.target.value),Nt(!0))},pr=async br=>{var Ar;br.preventDefault(),kt(!0);try{const Pr=await xt.records.create({data:{displayName:jt},message:{published:!0,recipient:e,schema:profile.schemas.name,dataFormat:"application/json",protocol:profile.uri,protocolPath:"name"}});console.info({res:Pr}),(Ar=Pr.record)==null||Ar.send(),await lr(),Nt(!1),toastSuccess("Profile updated")}catch(Pr){console.error(Pr),toastError("There was a problem saving your profile info",Pr)}kt(!1)},lr=async()=>{const br=zt;if(!br)return;let Ar;const Pr=br?new Blob([br],{type:br.type}):void 0;try{Pr&&(Ar=await yr(Pr))}catch(kr){console.log(kr),toastError("There was a problem saving your profile image",kr)}return Ar},yr=async br=>{const{record:Ar,status:Pr}=await xt.records.create({data:br,message:{published:!0,recipient:e,dataFormat:br.type,protocol:profile.uri,protocolPath:"avatar"}});return console.info({record:Ar,status:Pr}),Ar==null||Ar.send(),Ar};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Typography,{variant:"h2",className:"my-4",children:"My Profile Settings"}),jsxRuntimeExports.jsxs("form",{onSubmit:pr,children:[jsxRuntimeExports.jsxs("div",{className:"flex gap-4 items-center m-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative w-32 h-32",children:[zt?jsxRuntimeExports.jsx("img",{src:URL.createObjectURL(zt),alt:"Avatar",className:"rounded-full w-full h-full object-cover cursor-pointer",onClick:()=>{var br;return(br=ar.current)==null?void 0:br.click()}}):er&&!nr?jsxRuntimeExports.jsx("img",{src:drlReadProtocolUrl(e,profile.uri,"avatar"),alt:"Avatar",onError:br=>ir(br.type),className:"rounded-full w-full h-full object-cover cursor-pointer",onClick:()=>{var br;return(br=ar.current)==null?void 0:br.click()}}):jsxRuntimeExports.jsx("div",{className:"rounded-full w-full h-full object-cover cursor-pointer",onClick:()=>{var br;return(br=ar.current)==null?void 0:br.click()},children:jsxRuntimeExports.jsx(User,{className:"w-full h-full"})}),jsxRuntimeExports.jsx(Input,{type:"file",id:"avatar",className:"hidden",ref:ar,onChange:ur})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Label,{htmlFor:"displayName",children:"Display Name"}),jsxRuntimeExports.jsx(Input,{id:"displayName",placeholder:"John Smith",value:jt,required:!0,onChange:fr,disabled:At})]})]}),jsxRuntimeExports.jsx("div",{className:"text-right",children:jsxRuntimeExports.jsxs(Button,{type:"submit",disabled:!Bt||At,children:["Save"," ",At?jsxRuntimeExports.jsx(LoaderCircle,{className:"w-4 h-4 mr-2 animate-spin"}):null]})})]})]})},SettingsPage=()=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Typography,{variant:"h1",children:"Settings"}),jsxRuntimeExports.jsx(ProfileSettings,{})]}),workplaceImage="/dwa-demo/assets/workplace-Dn_WYwng.svg",BLANK_TASK={title:"",completed:!1};class TodoDwnRepository{constructor(e){this.dwn=e}async listTasks(){const e=await this.listTasksRecords();return(await Promise.all(e.map(async kt=>{const{title:Bt,completed:Nt}=await kt.data.json();return{id:kt.id,title:Bt,completed:Nt}}))).map(kt=>({id:kt.id,title:kt.title,completed:kt.completed}))}async createTask(e){const{status:At,record:kt}=await this.dwn.records.create({data:e,message:{protocol:tasksProtocolDefinition.protocol,protocolPath:"task",schema:tasksProtocolDefinition.types.task.schema,dataFormat:tasksProtocolDefinition.types.task.dataFormats[0],published:!0,tags:{completed:e.completed}}});if(At.code!==202)throw Error(At.detail);kt&&await kt.send()}async updateTask(e){if(!e.id)throw new Error("Task ID is required");const At=await this.findTaskRecord(e.id);if(!At)throw new Error("Task not found");const kt={...e};delete kt.id;const{status:Bt}=await At.update({data:kt,tags:{completed:e.completed}});if(Bt.code!==202)throw Error(Bt.detail);await At.send()}async deleteTask(e){const At=await this.findTaskRecord(e);if(!At)throw new Error("Task not found");return await At.delete(),At.send()}async findTaskRecord(e){const{record:At}=await this.dwn.records.read({protocol:tasksProtocolDefinition.protocol,message:{filter:{recordId:e}}});return At.id?At:void 0}async listTasksRecords(){const{records:e}=await this.dwn.records.query({protocol:tasksProtocolDefinition.protocol,message:{filter:{protocol:tasksProtocolDefinition.protocol,protocolPath:"task",dataFormat:"application/json"}}});return e||[]}}function Skeleton({className:xt,...e}){return jsxRuntimeExports.jsx("div",{className:cn("animate-pulse rounded-md bg-muted",xt),...e})}const TaskListLoader=()=>jsxRuntimeExports.jsxs("div",{className:"flex flex-col space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-[250px]"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-[200px]"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-[250px]"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-[200px]"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-[250px]"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-[200px]"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-[250px]"}),jsxRuntimeExports.jsx(Skeleton,{className:"h-4 w-[200px]"})]})]});function usePrevious(xt){const e=reactExports.useRef({value:xt,previous:xt});return reactExports.useMemo(()=>(e.current.value!==xt&&(e.current.previous=e.current.value,e.current.value=xt),e.current.previous),[xt])}var CHECKBOX_NAME="Checkbox",[createCheckboxContext,createCheckboxScope]=createContextScope(CHECKBOX_NAME),[CheckboxProvider,useCheckboxContext]=createCheckboxContext(CHECKBOX_NAME),Checkbox$1=reactExports.forwardRef((xt,e)=>{const{__scopeCheckbox:At,name:kt,checked:Bt,defaultChecked:Nt,required:jt,disabled:Lt,value:er="on",onCheckedChange:tr,...zt}=xt,[rr,nr]=reactExports.useState(null),ir=useComposedRefs(e,lr=>nr(lr)),ar=reactExports.useRef(!1),dr=rr?!!rr.closest("form"):!0,[ur=!1,fr]=useControllableState({prop:Bt,defaultProp:Nt,onChange:tr}),pr=reactExports.useRef(ur);return reactExports.useEffect(()=>{const lr=rr==null?void 0:rr.form;if(lr){const yr=()=>fr(pr.current);return lr.addEventListener("reset",yr),()=>lr.removeEventListener("reset",yr)}},[rr,fr]),jsxRuntimeExports.jsxs(CheckboxProvider,{scope:At,state:ur,disabled:Lt,children:[jsxRuntimeExports.jsx(Primitive.button,{type:"button",role:"checkbox","aria-checked":isIndeterminate(ur)?"mixed":ur,"aria-required":jt,"data-state":getState(ur),"data-disabled":Lt?"":void 0,disabled:Lt,value:er,...zt,ref:ir,onKeyDown:composeEventHandlers(xt.onKeyDown,lr=>{lr.key==="Enter"&&lr.preventDefault()}),onClick:composeEventHandlers(xt.onClick,lr=>{fr(yr=>isIndeterminate(yr)?!0:!yr),dr&&(ar.current=lr.isPropagationStopped(),ar.current||lr.stopPropagation())})}),dr&&jsxRuntimeExports.jsx(BubbleInput,{control:rr,bubbles:!ar.current,name:kt,value:er,checked:ur,required:jt,disabled:Lt,style:{transform:"translateX(-100%)"}})]})});Checkbox$1.displayName=CHECKBOX_NAME;var INDICATOR_NAME="CheckboxIndicator",CheckboxIndicator=reactExports.forwardRef((xt,e)=>{const{__scopeCheckbox:At,forceMount:kt,...Bt}=xt,Nt=useCheckboxContext(INDICATOR_NAME,At);return jsxRuntimeExports.jsx(Presence,{present:kt||isIndeterminate(Nt.state)||Nt.state===!0,children:jsxRuntimeExports.jsx(Primitive.span,{"data-state":getState(Nt.state),"data-disabled":Nt.disabled?"":void 0,...Bt,ref:e,style:{pointerEvents:"none",...xt.style}})})});CheckboxIndicator.displayName=INDICATOR_NAME;var BubbleInput=xt=>{const{control:e,checked:At,bubbles:kt=!0,...Bt}=xt,Nt=reactExports.useRef(null),jt=usePrevious(At),Lt=useSize(e);return reactExports.useEffect(()=>{const er=Nt.current,tr=window.HTMLInputElement.prototype,rr=Object.getOwnPropertyDescriptor(tr,"checked").set;if(jt!==At&&rr){const nr=new Event("click",{bubbles:kt});er.indeterminate=isIndeterminate(At),rr.call(er,isIndeterminate(At)?!1:At),er.dispatchEvent(nr)}},[jt,At,kt]),jsxRuntimeExports.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:isIndeterminate(At)?!1:At,...Bt,tabIndex:-1,ref:Nt,style:{...xt.style,...Lt,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function isIndeterminate(xt){return xt==="indeterminate"}function getState(xt){return isIndeterminate(xt)?"indeterminate":xt?"checked":"unchecked"}var Root=Checkbox$1,Indicator=CheckboxIndicator;const Checkbox=reactExports.forwardRef(({className:xt,...e},At)=>jsxRuntimeExports.jsx(Root,{ref:At,className:cn("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",xt),...e,children:jsxRuntimeExports.jsx(Indicator,{className:cn("flex items-center justify-center text-current"),children:jsxRuntimeExports.jsx(Check,{className:"h-4 w-4"})})}));Checkbox.displayName=Root.displayName;const TaskItem=({task:xt,handleToggleTaskCompletion:e,setTaskInput:At,handleDeleteTask:kt,disabled:Bt})=>jsxRuntimeExports.jsxs("div",{className:"mb-2 w-full flex justify-between items-center pb-2 last:mb-0 last:pb-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex cursor-pointer",onClick:()=>e(xt),children:[jsxRuntimeExports.jsx(Checkbox,{checked:xt.completed,className:"w-8 h-8",disabled:Bt}),jsxRuntimeExports.jsx("p",{className:cn("text-lg font-medium ml-2",xt.completed&&"line-through text-muted-foreground",Bt&&"text-muted-foreground"),children:xt.title})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx(Button,{variant:"ghost",className:"ml-4",size:"icon",disabled:Bt,onClick:()=>At({...xt}),children:jsxRuntimeExports.jsx(Pencil,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx(Button,{variant:"destructive",className:"ml-2",size:"icon",disabled:Bt,onClick:()=>kt(xt.id),children:jsxRuntimeExports.jsx(Trash,{className:"w-4 h-4"})})]})]},xt.id),TaskForm=({taskInput:xt,setTaskInput:e,handleTaskSubmit:At,isLoading:kt})=>jsxRuntimeExports.jsx("form",{onSubmit:At,children:jsxRuntimeExports.jsxs("div",{className:"flex w-full max-w-sm items-center space-x-2",children:[jsxRuntimeExports.jsx(Input,{placeholder:"Add a new task",value:xt.title,required:!0,onChange:Bt=>e({...xt,title:Bt.target.value})}),jsxRuntimeExports.jsxs(Button,{type:"submit",disabled:kt,children:[xt.id?"Update":"Add"," Task"]}),jsxRuntimeExports.jsx(Button,{type:"reset",variant:"ghost",onClick:()=>e({...BLANK_TASK}),disabled:kt,children:jsxRuntimeExports.jsx(Ban,{className:"w-4 h-4"})})]})}),TodoList=()=>{const{dwn:xt}=useWeb5(),[e,At]=reactExports.useState([]),[kt,Bt]=reactExports.useState({...BLANK_TASK}),[Nt,jt]=reactExports.useState(!1),Lt=reactExports.useMemo(()=>{if(xt)return new TodoDwnRepository(xt)},[xt]),er=reactExports.useCallback(async()=>{if(Lt){jt(!0);try{const ar=await Lt.listTasks();At(ar)}catch(ar){toastError("Error loading tasks",ar)}jt(!1)}},[Lt]);if(reactExports.useEffect(()=>{Lt&&er()},[Lt,er]),!Lt)return jsxRuntimeExports.jsx("div",{children:"Invalid Web5 connection"});const tr=async ar=>{ar.preventDefault(),kt.id?await rr(kt):await zt(kt)},zt=async ar=>{jt(!0);try{await Lt.createTask(ar),Bt({...BLANK_TASK}),toastSuccess("Task created successfully")}catch(dr){toastError("Error creating task",dr)}jt(!1),er()},rr=async ar=>{jt(!0);try{await Lt.updateTask(ar),Bt({...BLANK_TASK}),toastSuccess("Task updated successfully")}catch(dr){toastError("Error updating task",dr)}jt(!1),er()},nr=async ar=>{jt(!0);try{await Lt.deleteTask(ar),toastSuccess("Task removed successfully")}catch(dr){toastError("Error removing task",dr)}jt(!1),er()},ir=async ar=>{await rr({...ar,completed:!ar.completed}),await er()};return jsxRuntimeExports.jsxs("div",{className:"space-y-8",children:[jsxRuntimeExports.jsx(Typography,{variant:"h1",children:"My Tasks"}),jsxRuntimeExports.jsxs("div",{className:"w-full max-w-lg",children:[Nt&&e.length===0&&jsxRuntimeExports.jsx(TaskListLoader,{}),e.map(ar=>jsxRuntimeExports.jsx(TaskItem,{task:ar,handleToggleTaskCompletion:ir,setTaskInput:Bt,handleDeleteTask:nr,disabled:Nt},ar.id))]}),jsxRuntimeExports.jsx(TaskForm,{taskInput:kt,setTaskInput:Bt,handleTaskSubmit:tr,isLoading:Nt})]})},HomePage=()=>{const{isConnected:xt,previouslyConnected:e,connect:At,isConnecting:kt}=useWeb5();return reactExports.useEffect(()=>{At&&!kt&&!xt&&e===!0&&At()},[e,At,xt,kt]),jsxRuntimeExports.jsx("div",{className:"w-full",children:xt?jsxRuntimeExports.jsx(TodoList,{}):jsxRuntimeExports.jsxs("div",{className:"text-center space-y-8",children:[jsxRuntimeExports.jsx("h1",{className:"text-4xl font-bold",children:"DWA Starter"}),jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("img",{src:workplaceImage,className:"max-h-72 mx-auto",alt:"DWA"})}),jsxRuntimeExports.jsx(Web5Connection,{}),jsxRuntimeExports.jsx(Typography,{variant:"p",children:"Connect your DWA to get started"})]})})},AboutPage=()=>jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Typography,{variant:"h1",children:"DWA Starter React"}),jsxRuntimeExports.jsx(Typography,{variant:"p",children:"Decentralized Web App: it's a Web5 Progressive Web App."}),jsxRuntimeExports.jsx(Typography,{variant:"h2",children:"Why PWA?"}),jsxRuntimeExports.jsx(Typography,{variant:"p",children:"It's a perfect match with Web5 DWNs since a PWA can work offline and DWN has a synced local storage."}),jsxRuntimeExports.jsx(Typography,{variant:"p",children:"Aside from that, the advanced PWA capabilities such as modifying fetch requests allow us to extract the most such as displaying images with DRLs in the traditional `src` attribute."})]});function useMediaQuery(xt){const[e,At]=reactExports.useState(!1);return reactExports.useEffect(()=>{function kt(Nt){At(Nt.matches)}const Bt=matchMedia(xt);return Bt.addEventListener("change",kt),At(Bt.matches),()=>Bt.removeEventListener("change",kt)},[xt]),e}var P=["light","dark"],E="(prefers-color-scheme: dark)",L=reactExports.createContext(void 0),D={setTheme:xt=>{},themes:[]},j=()=>{var xt;return(xt=reactExports.useContext(L))!=null?xt:D};reactExports.memo(({forcedTheme:xt,storageKey:e,attribute:At,enableSystem:kt,enableColorScheme:Bt,defaultTheme:Nt,value:jt,attrs:Lt,nonce:er})=>{let tr=Nt==="system",zt=At==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${Lt.map(ar=>`'${ar}'`).join(",")})`};`:`var d=document.documentElement,n='${At}',s='setAttribute';`,rr=Bt?P.includes(Nt)&&Nt?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${Nt}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",nr=(ar,dr=!1,ur=!0)=>{let fr=jt?jt[ar]:ar,pr=dr?ar+"|| ''":`'${fr}'`,lr="";return Bt&&ur&&!dr&&P.includes(ar)&&(lr+=`d.style.colorScheme = '${ar}';`),At==="class"?dr||fr?lr+=`c.add(${pr})`:lr+="null":fr&&(lr+=`d[s](n,${pr})`),lr},ir=xt?`!function(){${zt}${nr(xt)}}()`:kt?`!function(){try{${zt}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${tr})){var t='${E}',m=window.matchMedia(t);if(m.media!==t||m.matches){${nr("dark")}}else{${nr("light")}}}else if(e){${jt?`var x=${JSON.stringify(jt)};`:""}${nr(jt?"x[e]":"e",!0)}}${tr?"":"else{"+nr(Nt,!1,!1)+"}"}${rr}}catch(e){}}()`:`!function(){try{${zt}var e=localStorage.getItem('${e}');if(e){${jt?`var x=${JSON.stringify(jt)};`:""}${nr(jt?"x[e]":"e",!0)}}else{${nr(Nt,!1,!1)};}${rr}}catch(t){}}();`;return reactExports.createElement("script",{nonce:er,dangerouslySetInnerHTML:{__html:ir}})});const Toaster=({...xt})=>{const{theme:e="system"}=j();return jsxRuntimeExports.jsx(Te$1,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...xt})},App=()=>{const xt=useMediaQuery("(min-width: 768px)");return jsxRuntimeExports.jsx(BrowserRouter,{basename:"/dwa-demo",children:jsxRuntimeExports.jsx(ThemeProvider,{defaultTheme:"dark",storageKey:"vite-ui-theme",children:jsxRuntimeExports.jsx(Web5Provider,{children:jsxRuntimeExports.jsxs("div",{className:"flex md:min-h-screen",children:[xt&&jsxRuntimeExports.jsx(Sidebar,{className:"min-h-screen fixed w-64"}),jsxRuntimeExports.jsxs("div",{className:`p-4 w-full ${xt?"ml-64":""}`,children:[!xt&&jsxRuntimeExports.jsx(SidebarButton,{}),jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/about",element:jsxRuntimeExports.jsx(AboutPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/settings",element:jsxRuntimeExports.jsx(SettingsPage,{})}),jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(HomePage,{})})]})]}),jsxRuntimeExports.jsx(PWABadge,{}),jsxRuntimeExports.jsx(Toaster,{})]})})})})};client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}))});export default Fl();
